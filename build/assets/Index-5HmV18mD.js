import{R as O,r as U,m as je,l as He,j as i,T as Je,ag as ne,B as pe,at as ns,w as ie,au as Ne,av as ls,aw as os,ax as qe,ay as Me,az as Ie,aA as cs,I as it,ac as us,ae as ds,t as rt,aB as fs,aC as hs,aD as ms,S as bt,F as gs,G as ys,J as xs,K as ps}from"./index-BGfvYRXr.js";import{d as vs,L as bs}from"./LiveMapTopBar-fIRcemyA.js";import{V as _s}from"./VehicleMenu-fSlVbIr9.js";import{g as Xe,a as _t,M as Ze,d as js,L as Vs,t as Ss}from"./LeftSideBar2-gG5286Kd.js";import"./Loader-DlN3cbmx.js";import"./LiveMapServices-CANH-RxM.js";import"./Socket-Bai6kHrq.js";import{T as Q,P as As}from"./Parameters-BePd37jg.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{d as Es}from"./Add-Dup6cAo7.js";import{c as ws,a as be,d as jt,e as Fs}from"./index.esm-aGeh_iNE.js";import{B as re,F as Ce,a as De,L as Cs,O as Ds,I as ks}from"./menu2-B1-qv907.js";import{T as Ue,M as ke,a as he,P as qs}from"./TextField-NNn4hDqm.js";import{M as Lt,D as Ot,a as Ts,T as Ls}from"./TablePagination-DHTcoQ6P.js";import{D as Ut,a as Os,E as Us,T as Se}from"./Edit-YiLEI0CB.js";import{T as Ps,a as Ns}from"./TableHead-DR_kdcfd.js";import{T as Ms,b as Vt,a as Is}from"./TableRow-DCaFeSYx.js";import{V as Rs}from"./VehicleGroups-D2YcYNSs.js";import"./createSvgIcon-XrmYzTvf.js";import"./useControlled-BQCM1uJm.js";import"./jcb-aCHXMCXy.js";import"./index-DfTMTiOY.js";import"./index-Bn3kFeAj.js";import"./index-YH8fbuq9.js";import"./Card-CChfvMTt.js";import"./CardContent-BVuWmqAn.js";var Oe=e=>e.type==="checkbox",_e=e=>e instanceof Date,J=e=>e==null;const Pt=e=>typeof e=="object";var $=e=>!J(e)&&!Array.isArray(e)&&Pt(e)&&!_e(e),Nt=e=>$(e)&&e.target?Oe(e.target)?e.target.checked:e.target.value:e,Bs=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,Mt=(e,s)=>e.has(Bs(s)),Ws=e=>{const s=e.constructor&&e.constructor.prototype;return $(s)&&s.hasOwnProperty("isPrototypeOf")},nt=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function te(e){let s;const t=Array.isArray(e);if(e instanceof Date)s=new Date(e);else if(e instanceof Set)s=new Set(e);else if(!(nt&&(e instanceof Blob||e instanceof FileList))&&(t||$(e)))if(s=t?[]:{},!t&&!Ws(e))s=e;else for(const a in e)e.hasOwnProperty(a)&&(s[a]=te(e[a]));else return e;return s}var Ge=e=>Array.isArray(e)?e.filter(Boolean):[],B=e=>e===void 0,f=(e,s,t)=>{if(!s||!$(e))return t;const a=Ge(s.split(/[,[\].]+?/)).reduce((o,n)=>J(o)?o:o[n],e);return B(a)||a===e?B(e[s])?t:e[s]:a},le=e=>typeof e=="boolean",lt=e=>/^\w*$/.test(e),It=e=>Ge(e.replace(/["|']|\]/g,"").split(/\.|\[/)),L=(e,s,t)=>{let a=-1;const o=lt(s)?[s]:It(s),n=o.length,u=n-1;for(;++a<n;){const g=o[a];let V=t;if(a!==u){const m=e[g];V=$(m)||Array.isArray(m)?m:isNaN(+o[a+1])?{}:[]}if(g==="__proto__")return;e[g]=V,e=e[g]}return e};const Re={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},ce={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},fe={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},$s=O.createContext(null),ot=()=>O.useContext($s);var Rt=(e,s,t,a=!0)=>{const o={defaultValues:s._defaultValues};for(const n in e)Object.defineProperty(o,n,{get:()=>{const u=n;return s._proxyFormState[u]!==ce.all&&(s._proxyFormState[u]=!a||ce.all),t&&(t[u]=!0),e[u]}});return o},se=e=>$(e)&&!Object.keys(e).length,Bt=(e,s,t,a)=>{t(e);const{name:o,...n}=e;return se(n)||Object.keys(n).length>=Object.keys(s).length||Object.keys(n).find(u=>s[u]===(!a||ce.all))},Te=e=>Array.isArray(e)?e:[e],Wt=(e,s,t)=>!e||!s||e===s||Te(e).some(a=>a&&(t?a===s:a.startsWith(s)||s.startsWith(a)));function ct(e){const s=O.useRef(e);s.current=e,O.useEffect(()=>{const t=!e.disabled&&s.current.subject&&s.current.subject.subscribe({next:s.current.next});return()=>{t&&t.unsubscribe()}},[e.disabled])}function Hs(e){const s=ot(),{control:t=s.control,disabled:a,name:o,exact:n}=e||{},[u,g]=O.useState(t._formState),V=O.useRef(!0),m=O.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),b=O.useRef(o);return b.current=o,ct({disabled:a,next:y=>V.current&&Wt(b.current,y.name,n)&&Bt(y,m.current,t._updateFormState)&&g({...t._formState,...y}),subject:t._subjects.state}),O.useEffect(()=>(V.current=!0,m.current.isValid&&t._updateValid(!0),()=>{V.current=!1}),[t]),Rt(u,t,m.current,!1)}var de=e=>typeof e=="string",$t=(e,s,t,a,o)=>de(e)?(a&&s.watch.add(e),f(t,e,o)):Array.isArray(e)?e.map(n=>(a&&s.watch.add(n),f(t,n))):(a&&(s.watchAll=!0),t);function Gs(e){const s=ot(),{control:t=s.control,name:a,defaultValue:o,disabled:n,exact:u}=e||{},g=O.useRef(a);g.current=a,ct({disabled:n,subject:t._subjects.values,next:b=>{Wt(g.current,b.name,u)&&m(te($t(g.current,t._names,b.values||t._formValues,!1,o)))}});const[V,m]=O.useState(t._getWatch(a,o));return O.useEffect(()=>t._removeUnmounted()),V}function zs(e){const s=ot(),{name:t,disabled:a,control:o=s.control,shouldUnregister:n}=e,u=Mt(o._names.array,t),g=Gs({control:o,name:t,defaultValue:f(o._formValues,t,f(o._defaultValues,t,e.defaultValue)),exact:!0}),V=Hs({control:o,name:t,exact:!0}),m=O.useRef(o.register(t,{...e.rules,value:g,...le(e.disabled)?{disabled:e.disabled}:{}}));return O.useEffect(()=>{const b=o._options.shouldUnregister||n,y=(R,W)=>{const D=f(o._fields,R);D&&D._f&&(D._f.mount=W)};if(y(t,!0),b){const R=te(f(o._options.defaultValues,t));L(o._defaultValues,t,R),B(f(o._formValues,t))&&L(o._formValues,t,R)}return()=>{(u?b&&!o._state.action:b)?o.unregister(t):y(t,!1)}},[t,o,u,n]),O.useEffect(()=>{f(o._fields,t)&&o._updateDisabledField({disabled:a,fields:o._fields,name:t,value:f(o._fields,t)._f.value})},[a,t,o]),{field:{name:t,value:g,...le(a)||V.disabled?{disabled:V.disabled||a}:{},onChange:O.useCallback(b=>m.current.onChange({target:{value:Nt(b),name:t},type:Re.CHANGE}),[t]),onBlur:O.useCallback(()=>m.current.onBlur({target:{value:f(o._formValues,t),name:t},type:Re.BLUR}),[t,o]),ref:O.useCallback(b=>{const y=f(o._fields,t);y&&b&&(y._f.ref={focus:()=>b.focus(),select:()=>b.select(),setCustomValidity:R=>b.setCustomValidity(R),reportValidity:()=>b.reportValidity()})},[o._fields,t])},formState:V,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!f(V.errors,t)},isDirty:{enumerable:!0,get:()=>!!f(V.dirtyFields,t)},isTouched:{enumerable:!0,get:()=>!!f(V.touchedFields,t)},isValidating:{enumerable:!0,get:()=>!!f(V.validatingFields,t)},error:{enumerable:!0,get:()=>f(V.errors,t)}})}}const ue=e=>e.render(zs(e));var Ht=(e,s,t,a,o)=>s?{...t[e],types:{...t[e]&&t[e].types?t[e].types:{},[a]:o||!0}}:{},St=e=>({isOnSubmit:!e||e===ce.onSubmit,isOnBlur:e===ce.onBlur,isOnChange:e===ce.onChange,isOnAll:e===ce.all,isOnTouch:e===ce.onTouched}),At=(e,s,t)=>!t&&(s.watchAll||s.watch.has(e)||[...s.watch].some(a=>e.startsWith(a)&&/^\.\w+/.test(e.slice(a.length))));const Le=(e,s,t,a)=>{for(const o of t||Object.keys(e)){const n=f(e,o);if(n){const{_f:u,...g}=n;if(u){if(u.refs&&u.refs[0]&&s(u.refs[0],o)&&!a)return!0;if(u.ref&&s(u.ref,u.name)&&!a)return!0;if(Le(g,s))break}else if($(g)&&Le(g,s))break}}};var Ys=(e,s,t)=>{const a=Te(f(e,t));return L(a,"root",s[t]),L(e,t,a),e},ut=e=>e.type==="file",me=e=>typeof e=="function",Be=e=>{if(!nt)return!1;const s=e?e.ownerDocument:0;return e instanceof(s&&s.defaultView?s.defaultView.HTMLElement:HTMLElement)},Pe=e=>de(e),dt=e=>e.type==="radio",We=e=>e instanceof RegExp;const Et={value:!1,isValid:!1},wt={value:!0,isValid:!0};var Gt=e=>{if(Array.isArray(e)){if(e.length>1){const s=e.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:s,isValid:!!s.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!B(e[0].attributes.value)?B(e[0].value)||e[0].value===""?wt:{value:e[0].value,isValid:!0}:wt:Et}return Et};const Ft={isValid:!1,value:null};var zt=e=>Array.isArray(e)?e.reduce((s,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:s,Ft):Ft;function Ct(e,s,t="validate"){if(Pe(e)||Array.isArray(e)&&e.every(Pe)||le(e)&&!e)return{type:t,message:Pe(e)?e:"",ref:s}}var Ae=e=>$(e)&&!We(e)?e:{value:e,message:""},Dt=async(e,s,t,a,o)=>{const{ref:n,refs:u,required:g,maxLength:V,minLength:m,min:b,max:y,pattern:R,validate:W,name:D,valueAsNumber:H,mount:G,disabled:ae}=e._f,F=f(s,D);if(!G||ae)return{};const A=u?u[0]:n,P=w=>{a&&A.reportValidity&&(A.setCustomValidity(le(w)?"":w||""),A.reportValidity())},E={},T=dt(n),X=Oe(n),oe=T||X,M=(H||ut(n))&&B(n.value)&&B(F)||Be(n)&&n.value===""||F===""||Array.isArray(F)&&!F.length,I=Ht.bind(null,D,t,E),Z=(w,k,_,x=fe.maxLength,v=fe.minLength)=>{const S=w?k:_;E[D]={type:w?x:v,message:S,ref:n,...I(w?x:v,S)}};if(o?!Array.isArray(F)||!F.length:g&&(!oe&&(M||J(F))||le(F)&&!F||X&&!Gt(u).isValid||T&&!zt(u).isValid)){const{value:w,message:k}=Pe(g)?{value:!!g,message:g}:Ae(g);if(w&&(E[D]={type:fe.required,message:k,ref:A,...I(fe.required,k)},!t))return P(k),E}if(!M&&(!J(b)||!J(y))){let w,k;const _=Ae(y),x=Ae(b);if(!J(F)&&!isNaN(F)){const v=n.valueAsNumber||F&&+F;J(_.value)||(w=v>_.value),J(x.value)||(k=v<x.value)}else{const v=n.valueAsDate||new Date(F),S=ee=>new Date(new Date().toDateString()+" "+ee),N=n.type=="time",q=n.type=="week";de(_.value)&&F&&(w=N?S(F)>S(_.value):q?F>_.value:v>new Date(_.value)),de(x.value)&&F&&(k=N?S(F)<S(x.value):q?F<x.value:v<new Date(x.value))}if((w||k)&&(Z(!!w,_.message,x.message,fe.max,fe.min),!t))return P(E[D].message),E}if((V||m)&&!M&&(de(F)||o&&Array.isArray(F))){const w=Ae(V),k=Ae(m),_=!J(w.value)&&F.length>+w.value,x=!J(k.value)&&F.length<+k.value;if((_||x)&&(Z(_,w.message,k.message),!t))return P(E[D].message),E}if(R&&!M&&de(F)){const{value:w,message:k}=Ae(R);if(We(w)&&!F.match(w)&&(E[D]={type:fe.pattern,message:k,ref:n,...I(fe.pattern,k)},!t))return P(k),E}if(W){if(me(W)){const w=await W(F,s),k=Ct(w,A);if(k&&(E[D]={...k,...I(fe.validate,k.message)},!t))return P(k.message),E}else if($(W)){let w={};for(const k in W){if(!se(w)&&!t)break;const _=Ct(await W[k](F,s),A,k);_&&(w={..._,...I(k,_.message)},P(_.message),t&&(E[D]=w))}if(!se(w)&&(E[D]={ref:A,...w},!t))return E}}return P(!0),E};function Ks(e,s){const t=s.slice(0,-1).length;let a=0;for(;a<t;)e=B(e)?a++:e[s[a++]];return e}function Qs(e){for(const s in e)if(e.hasOwnProperty(s)&&!B(e[s]))return!1;return!0}function z(e,s){const t=Array.isArray(s)?s:lt(s)?[s]:It(s),a=t.length===1?e:Ks(e,t),o=t.length-1,n=t[o];return a&&delete a[n],o!==0&&($(a)&&se(a)||Array.isArray(a)&&Qs(a))&&z(e,t.slice(0,-1)),e}var et=()=>{let e=[];return{get observers(){return e},next:o=>{for(const n of e)n.next&&n.next(o)},subscribe:o=>(e.push(o),{unsubscribe:()=>{e=e.filter(n=>n!==o)}}),unsubscribe:()=>{e=[]}}},at=e=>J(e)||!Pt(e);function xe(e,s){if(at(e)||at(s))return e===s;if(_e(e)&&_e(s))return e.getTime()===s.getTime();const t=Object.keys(e),a=Object.keys(s);if(t.length!==a.length)return!1;for(const o of t){const n=e[o];if(!a.includes(o))return!1;if(o!=="ref"){const u=s[o];if(_e(n)&&_e(u)||$(n)&&$(u)||Array.isArray(n)&&Array.isArray(u)?!xe(n,u):n!==u)return!1}}return!0}var Yt=e=>e.type==="select-multiple",Js=e=>dt(e)||Oe(e),tt=e=>Be(e)&&e.isConnected,Kt=e=>{for(const s in e)if(me(e[s]))return!0;return!1};function $e(e,s={}){const t=Array.isArray(e);if($(e)||t)for(const a in e)Array.isArray(e[a])||$(e[a])&&!Kt(e[a])?(s[a]=Array.isArray(e[a])?[]:{},$e(e[a],s[a])):J(e[a])||(s[a]=!0);return s}function Qt(e,s,t){const a=Array.isArray(e);if($(e)||a)for(const o in e)Array.isArray(e[o])||$(e[o])&&!Kt(e[o])?B(s)||at(t[o])?t[o]=Array.isArray(e[o])?$e(e[o],[]):{...$e(e[o])}:Qt(e[o],J(s)?{}:s[o],t[o]):t[o]=!xe(e[o],s[o]);return t}var we=(e,s)=>Qt(e,s,$e(s)),Jt=(e,{valueAsNumber:s,valueAsDate:t,setValueAs:a})=>B(e)?e:s?e===""?NaN:e&&+e:t&&de(e)?new Date(e):a?a(e):e;function st(e){const s=e.ref;if(!(e.refs?e.refs.every(t=>t.disabled):s.disabled))return ut(s)?s.files:dt(s)?zt(e.refs).value:Yt(s)?[...s.selectedOptions].map(({value:t})=>t):Oe(s)?Gt(e.refs).value:Jt(B(s.value)?e.ref.value:s.value,e)}var Xs=(e,s,t,a)=>{const o={};for(const n of e){const u=f(s,n);u&&L(o,n,u._f)}return{criteriaMode:t,names:[...e],fields:o,shouldUseNativeValidation:a}},Fe=e=>B(e)?e:We(e)?e.source:$(e)?We(e.value)?e.value.source:e.value:e;const kt="AsyncFunction";var Zs=e=>(!e||!e.validate)&&!!(me(e.validate)&&e.validate.constructor.name===kt||$(e.validate)&&Object.values(e.validate).find(s=>s.constructor.name===kt)),er=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function qt(e,s,t){const a=f(e,t);if(a||lt(t))return{error:a,name:t};const o=t.split(".");for(;o.length;){const n=o.join("."),u=f(s,n),g=f(e,n);if(u&&!Array.isArray(u)&&t!==n)return{name:t};if(g&&g.type)return{name:n,error:g};o.pop()}return{name:t}}var tr=(e,s,t,a,o)=>o.isOnAll?!1:!t&&o.isOnTouch?!(s||e):(t?a.isOnBlur:o.isOnBlur)?!e:(t?a.isOnChange:o.isOnChange)?e:!0,sr=(e,s)=>!Ge(f(e,s)).length&&z(e,s);const rr={mode:ce.onSubmit,reValidateMode:ce.onChange,shouldFocusError:!0};function ar(e={}){let s={...rr,...e},t={submitCount:0,isDirty:!1,isLoading:me(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},a={},o=$(s.defaultValues)||$(s.values)?te(s.defaultValues||s.values)||{}:{},n=s.shouldUnregister?{}:te(o),u={action:!1,mount:!1,watch:!1},g={mount:new Set,unMount:new Set,array:new Set,watch:new Set},V,m=0;const b={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},y={values:et(),array:et(),state:et()},R=St(s.mode),W=St(s.reValidateMode),D=s.criteriaMode===ce.all,H=r=>l=>{clearTimeout(m),m=setTimeout(r,l)},G=async r=>{if(!e.disabled&&(b.isValid||r)){const l=s.resolver?se((await oe()).errors):await I(a,!0);l!==t.isValid&&y.state.next({isValid:l})}},ae=(r,l)=>{!e.disabled&&(b.isValidating||b.validatingFields)&&((r||Array.from(g.mount)).forEach(c=>{c&&(l?L(t.validatingFields,c,l):z(t.validatingFields,c))}),y.state.next({validatingFields:t.validatingFields,isValidating:!se(t.validatingFields)}))},F=(r,l=[],c,p,h=!0,d=!0)=>{if(p&&c&&!e.disabled){if(u.action=!0,d&&Array.isArray(f(a,r))){const j=c(f(a,r),p.argA,p.argB);h&&L(a,r,j)}if(d&&Array.isArray(f(t.errors,r))){const j=c(f(t.errors,r),p.argA,p.argB);h&&L(t.errors,r,j),sr(t.errors,r)}if(b.touchedFields&&d&&Array.isArray(f(t.touchedFields,r))){const j=c(f(t.touchedFields,r),p.argA,p.argB);h&&L(t.touchedFields,r,j)}b.dirtyFields&&(t.dirtyFields=we(o,n)),y.state.next({name:r,isDirty:w(r,l),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else L(n,r,l)},A=(r,l)=>{L(t.errors,r,l),y.state.next({errors:t.errors})},P=r=>{t.errors=r,y.state.next({errors:t.errors,isValid:!1})},E=(r,l,c,p)=>{const h=f(a,r);if(h){const d=f(n,r,B(c)?f(o,r):c);B(d)||p&&p.defaultChecked||l?L(n,r,l?d:st(h._f)):x(r,d),u.mount&&G()}},T=(r,l,c,p,h)=>{let d=!1,j=!1;const C={name:r};if(!e.disabled){const Y=!!(f(a,r)&&f(a,r)._f&&f(a,r)._f.disabled);if(!c||p){b.isDirty&&(j=t.isDirty,t.isDirty=C.isDirty=w(),d=j!==C.isDirty);const K=Y||xe(f(o,r),l);j=!!(!Y&&f(t.dirtyFields,r)),K||Y?z(t.dirtyFields,r):L(t.dirtyFields,r,!0),C.dirtyFields=t.dirtyFields,d=d||b.dirtyFields&&j!==!K}if(c){const K=f(t.touchedFields,r);K||(L(t.touchedFields,r,c),C.touchedFields=t.touchedFields,d=d||b.touchedFields&&K!==c)}d&&h&&y.state.next(C)}return d?C:{}},X=(r,l,c,p)=>{const h=f(t.errors,r),d=b.isValid&&le(l)&&t.isValid!==l;if(e.delayError&&c?(V=H(()=>A(r,c)),V(e.delayError)):(clearTimeout(m),V=null,c?L(t.errors,r,c):z(t.errors,r)),(c?!xe(h,c):h)||!se(p)||d){const j={...p,...d&&le(l)?{isValid:l}:{},errors:t.errors,name:r};t={...t,...j},y.state.next(j)}},oe=async r=>{ae(r,!0);const l=await s.resolver(n,s.context,Xs(r||g.mount,a,s.criteriaMode,s.shouldUseNativeValidation));return ae(r),l},M=async r=>{const{errors:l}=await oe(r);if(r)for(const c of r){const p=f(l,c);p?L(t.errors,c,p):z(t.errors,c)}else t.errors=l;return l},I=async(r,l,c={valid:!0})=>{for(const p in r){const h=r[p];if(h){const{_f:d,...j}=h;if(d){const C=g.array.has(d.name),Y=h._f&&Zs(h._f);Y&&b.validatingFields&&ae([p],!0);const K=await Dt(h,n,D,s.shouldUseNativeValidation&&!l,C);if(Y&&b.validatingFields&&ae([p]),K[d.name]&&(c.valid=!1,l))break;!l&&(f(K,d.name)?C?Ys(t.errors,K,d.name):L(t.errors,d.name,K[d.name]):z(t.errors,d.name))}!se(j)&&await I(j,l,c)}}return c.valid},Z=()=>{for(const r of g.unMount){const l=f(a,r);l&&(l._f.refs?l._f.refs.every(c=>!tt(c)):!tt(l._f.ref))&&ze(r)}g.unMount=new Set},w=(r,l)=>!e.disabled&&(r&&l&&L(n,r,l),!xe(Ee(),o)),k=(r,l,c)=>$t(r,g,{...u.mount?n:B(l)?o:de(r)?{[r]:l}:l},c,l),_=r=>Ge(f(u.mount?n:o,r,e.shouldUnregister?f(o,r,[]):[])),x=(r,l,c={})=>{const p=f(a,r);let h=l;if(p){const d=p._f;d&&(!d.disabled&&L(n,r,Jt(l,d)),h=Be(d.ref)&&J(l)?"":l,Yt(d.ref)?[...d.ref.options].forEach(j=>j.selected=h.includes(j.value)):d.refs?Oe(d.ref)?d.refs.length>1?d.refs.forEach(j=>(!j.defaultChecked||!j.disabled)&&(j.checked=Array.isArray(h)?!!h.find(C=>C===j.value):h===j.value)):d.refs[0]&&(d.refs[0].checked=!!h):d.refs.forEach(j=>j.checked=j.value===h):ut(d.ref)?d.ref.value="":(d.ref.value=h,d.ref.type||y.values.next({name:r,values:{...n}})))}(c.shouldDirty||c.shouldTouch)&&T(r,h,c.shouldTouch,c.shouldDirty,!0),c.shouldValidate&&ee(r)},v=(r,l,c)=>{for(const p in l){const h=l[p],d=`${r}.${p}`,j=f(a,d);(g.array.has(r)||$(h)||j&&!j._f)&&!_e(h)?v(d,h,c):x(d,h,c)}},S=(r,l,c={})=>{const p=f(a,r),h=g.array.has(r),d=te(l);L(n,r,d),h?(y.array.next({name:r,values:{...n}}),(b.isDirty||b.dirtyFields)&&c.shouldDirty&&y.state.next({name:r,dirtyFields:we(o,n),isDirty:w(r,d)})):p&&!p._f&&!J(d)?v(r,d,c):x(r,d,c),At(r,g)&&y.state.next({...t}),y.values.next({name:u.mount?r:void 0,values:{...n}})},N=async r=>{u.mount=!0;const l=r.target;let c=l.name,p=!0;const h=f(a,c),d=()=>l.type?st(h._f):Nt(r),j=C=>{p=Number.isNaN(C)||_e(C)&&isNaN(C.getTime())||xe(C,f(n,c,C))};if(h){let C,Y;const K=d(),ve=r.type===Re.BLUR||r.type===Re.FOCUS_OUT,rs=!er(h._f)&&!s.resolver&&!f(t.errors,c)&&!h._f.deps||tr(ve,f(t.touchedFields,c),t.isSubmitted,W,R),Ke=At(c,g,ve);L(n,c,K),ve?(h._f.onBlur&&h._f.onBlur(r),V&&V(0)):h._f.onChange&&h._f.onChange(r);const Qe=T(c,K,ve,!1),as=!se(Qe)||Ke;if(!ve&&y.values.next({name:c,type:r.type,values:{...n}}),rs)return b.isValid&&(e.mode==="onBlur"?ve&&G():G()),as&&y.state.next({name:c,...Ke?{}:Qe});if(!ve&&Ke&&y.state.next({...t}),s.resolver){const{errors:pt}=await oe([c]);if(j(K),p){const is=qt(t.errors,a,c),vt=qt(pt,a,is.name||c);C=vt.error,c=vt.name,Y=se(pt)}}else ae([c],!0),C=(await Dt(h,n,D,s.shouldUseNativeValidation))[c],ae([c]),j(K),p&&(C?Y=!1:b.isValid&&(Y=await I(a,!0)));p&&(h._f.deps&&ee(h._f.deps),X(c,Y,C,Qe))}},q=(r,l)=>{if(f(t.errors,l)&&r.focus)return r.focus(),1},ee=async(r,l={})=>{let c,p;const h=Te(r);if(s.resolver){const d=await M(B(r)?r:h);c=se(d),p=r?!h.some(j=>f(d,j)):c}else r?(p=(await Promise.all(h.map(async d=>{const j=f(a,d);return await I(j&&j._f?{[d]:j}:j)}))).every(Boolean),!(!p&&!t.isValid)&&G()):p=c=await I(a);return y.state.next({...!de(r)||b.isValid&&c!==t.isValid?{}:{name:r},...s.resolver||!r?{isValid:c}:{},errors:t.errors}),l.shouldFocus&&!p&&Le(a,q,r?h:g.mount),p},Ee=r=>{const l={...u.mount?n:o};return B(r)?l:de(r)?f(l,r):r.map(c=>f(l,c))},Ve=(r,l)=>({invalid:!!f((l||t).errors,r),isDirty:!!f((l||t).dirtyFields,r),error:f((l||t).errors,r),isValidating:!!f(t.validatingFields,r),isTouched:!!f((l||t).touchedFields,r)}),Zt=r=>{r&&Te(r).forEach(l=>z(t.errors,l)),y.state.next({errors:r?t.errors:{}})},ft=(r,l,c)=>{const p=(f(a,r,{_f:{}})._f||{}).ref,h=f(t.errors,r)||{},{ref:d,message:j,type:C,...Y}=h;L(t.errors,r,{...Y,...l,ref:p}),y.state.next({name:r,errors:t.errors,isValid:!1}),c&&c.shouldFocus&&p&&p.focus&&p.focus()},es=(r,l)=>me(r)?y.values.subscribe({next:c=>r(k(void 0,l),c)}):k(r,l,!0),ze=(r,l={})=>{for(const c of r?Te(r):g.mount)g.mount.delete(c),g.array.delete(c),l.keepValue||(z(a,c),z(n,c)),!l.keepError&&z(t.errors,c),!l.keepDirty&&z(t.dirtyFields,c),!l.keepTouched&&z(t.touchedFields,c),!l.keepIsValidating&&z(t.validatingFields,c),!s.shouldUnregister&&!l.keepDefaultValue&&z(o,c);y.values.next({values:{...n}}),y.state.next({...t,...l.keepDirty?{isDirty:w()}:{}}),!l.keepIsValid&&G()},ht=({disabled:r,name:l,field:c,fields:p,value:h})=>{if(le(r)&&u.mount||r){const d=r?void 0:B(h)?st(c?c._f:f(p,l)._f):h;L(n,l,d),T(l,d,!1,!1,!0)}},Ye=(r,l={})=>{let c=f(a,r);const p=le(l.disabled)||le(e.disabled);return L(a,r,{...c||{},_f:{...c&&c._f?c._f:{ref:{name:r}},name:r,mount:!0,...l}}),g.mount.add(r),c?ht({field:c,disabled:le(l.disabled)?l.disabled:e.disabled,name:r,value:l.value}):E(r,!0,l.value),{...p?{disabled:l.disabled||e.disabled}:{},...s.progressive?{required:!!l.required,min:Fe(l.min),max:Fe(l.max),minLength:Fe(l.minLength),maxLength:Fe(l.maxLength),pattern:Fe(l.pattern)}:{},name:r,onChange:N,onBlur:N,ref:h=>{if(h){Ye(r,l),c=f(a,r);const d=B(h.value)&&h.querySelectorAll&&h.querySelectorAll("input,select,textarea")[0]||h,j=Js(d),C=c._f.refs||[];if(j?C.find(Y=>Y===d):d===c._f.ref)return;L(a,r,{_f:{...c._f,...j?{refs:[...C.filter(tt),d,...Array.isArray(f(o,r))?[{}]:[]],ref:{type:d.type,name:r}}:{ref:d}}}),E(r,!1,void 0,d)}else c=f(a,r,{}),c._f&&(c._f.mount=!1),(s.shouldUnregister||l.shouldUnregister)&&!(Mt(g.array,r)&&u.action)&&g.unMount.add(r)}}},mt=()=>s.shouldFocusError&&Le(a,q,g.mount),ts=r=>{le(r)&&(y.state.next({disabled:r}),Le(a,(l,c)=>{const p=f(a,c);p&&(l.disabled=p._f.disabled||r,Array.isArray(p._f.refs)&&p._f.refs.forEach(h=>{h.disabled=p._f.disabled||r}))},0,!1))},gt=(r,l)=>async c=>{let p;c&&(c.preventDefault&&c.preventDefault(),c.persist&&c.persist());let h=te(n);if(y.state.next({isSubmitting:!0}),s.resolver){const{errors:d,values:j}=await oe();t.errors=d,h=j}else await I(a);if(z(t.errors,"root"),se(t.errors)){y.state.next({errors:{}});try{await r(h,c)}catch(d){p=d}}else l&&await l({...t.errors},c),mt(),setTimeout(mt);if(y.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:se(t.errors)&&!p,submitCount:t.submitCount+1,errors:t.errors}),p)throw p},ss=(r,l={})=>{f(a,r)&&(B(l.defaultValue)?S(r,te(f(o,r))):(S(r,l.defaultValue),L(o,r,te(l.defaultValue))),l.keepTouched||z(t.touchedFields,r),l.keepDirty||(z(t.dirtyFields,r),t.isDirty=l.defaultValue?w(r,te(f(o,r))):w()),l.keepError||(z(t.errors,r),b.isValid&&G()),y.state.next({...t}))},yt=(r,l={})=>{const c=r?te(r):o,p=te(c),h=se(r),d=h?o:p;if(l.keepDefaultValues||(o=c),!l.keepValues){if(l.keepDirtyValues){const j=new Set([...g.mount,...Object.keys(we(o,n))]);for(const C of Array.from(j))f(t.dirtyFields,C)?L(d,C,f(n,C)):S(C,f(d,C))}else{if(nt&&B(r))for(const j of g.mount){const C=f(a,j);if(C&&C._f){const Y=Array.isArray(C._f.refs)?C._f.refs[0]:C._f.ref;if(Be(Y)){const K=Y.closest("form");if(K){K.reset();break}}}}a={}}n=e.shouldUnregister?l.keepDefaultValues?te(o):{}:te(d),y.array.next({values:{...d}}),y.values.next({values:{...d}})}g={mount:l.keepDirtyValues?g.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},u.mount=!b.isValid||!!l.keepIsValid||!!l.keepDirtyValues,u.watch=!!e.shouldUnregister,y.state.next({submitCount:l.keepSubmitCount?t.submitCount:0,isDirty:h?!1:l.keepDirty?t.isDirty:!!(l.keepDefaultValues&&!xe(r,o)),isSubmitted:l.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:h?{}:l.keepDirtyValues?l.keepDefaultValues&&n?we(o,n):t.dirtyFields:l.keepDefaultValues&&r?we(o,r):l.keepDirty?t.dirtyFields:{},touchedFields:l.keepTouched?t.touchedFields:{},errors:l.keepErrors?t.errors:{},isSubmitSuccessful:l.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1})},xt=(r,l)=>yt(me(r)?r(n):r,l);return{control:{register:Ye,unregister:ze,getFieldState:Ve,handleSubmit:gt,setError:ft,_executeSchema:oe,_getWatch:k,_getDirty:w,_updateValid:G,_removeUnmounted:Z,_updateFieldArray:F,_updateDisabledField:ht,_getFieldArray:_,_reset:yt,_resetDefaultValues:()=>me(s.defaultValues)&&s.defaultValues().then(r=>{xt(r,s.resetOptions),y.state.next({isLoading:!1})}),_updateFormState:r=>{t={...t,...r}},_disableForm:ts,_subjects:y,_proxyFormState:b,_setErrors:P,get _fields(){return a},get _formValues(){return n},get _state(){return u},set _state(r){u=r},get _defaultValues(){return o},get _names(){return g},set _names(r){g=r},get _formState(){return t},set _formState(r){t=r},get _options(){return s},set _options(r){s={...s,...r}}},trigger:ee,register:Ye,handleSubmit:gt,watch:es,setValue:S,getValues:Ee,reset:xt,resetField:ss,clearErrors:Zt,unregister:ze,setError:ft,setFocus:(r,l={})=>{const c=f(a,r),p=c&&c._f;if(p){const h=p.refs?p.refs[0]:p.ref;h.focus&&(h.focus(),l.shouldSelect&&h.select())}},getFieldState:Ve}}function ir(e={}){const s=O.useRef(),t=O.useRef(),[a,o]=O.useState({isDirty:!1,isValidating:!1,isLoading:me(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:me(e.defaultValues)?void 0:e.defaultValues});s.current||(s.current={...ar(e),formState:a});const n=s.current.control;return n._options=e,ct({subject:n._subjects.state,next:u=>{Bt(u,n._proxyFormState,n._updateFormState,!0)&&o({...n._formState})}}),O.useEffect(()=>n._disableForm(e.disabled),[n,e.disabled]),O.useEffect(()=>{if(n._proxyFormState.isDirty){const u=n._getDirty();u!==a.isDirty&&n._subjects.state.next({isDirty:u})}},[n,a.isDirty]),O.useEffect(()=>{e.values&&!xe(e.values,t.current)?(n._reset(e.values,n._options.resetOptions),t.current=e.values,o(u=>({...u}))):n._resetDefaultValues()},[e.values,n]),O.useEffect(()=>{e.errors&&n._setErrors(e.errors)},[e.errors,n]),O.useEffect(()=>{n._state.mount||(n._updateValid(),n._state.mount=!0),n._state.watch&&(n._state.watch=!1,n._subjects.state.next({...n._formState})),n._removeUnmounted()}),O.useEffect(()=>{e.shouldUnregister&&n._subjects.values.next({values:n._getWatch()})},[e.shouldUnregister,n]),O.useEffect(()=>{s.current&&(s.current.watch=s.current.watch.bind({}))},[a]),s.current.formState=Rt(a,n),s.current}const Tt=(e,s,t)=>{if(e&&"reportValidity"in e){const a=f(t,s);e.setCustomValidity(a&&a.message||""),e.reportValidity()}},Xt=(e,s)=>{for(const t in s.fields){const a=s.fields[t];a&&a.ref&&"reportValidity"in a.ref?Tt(a.ref,t,e):a.refs&&a.refs.forEach(o=>Tt(o,t,e))}},nr=(e,s)=>{s.shouldUseNativeValidation&&Xt(e,s);const t={};for(const a in e){const o=f(s.fields,a),n=Object.assign(e[a]||{},{ref:o&&o.ref});if(lr(s.names||Object.keys(e),a)){const u=Object.assign({},f(t,a));L(u,"root",n),L(t,a,u)}else L(t,a,n)}return t},lr=(e,s)=>e.some(t=>t.startsWith(s+"."));function or(e,s,t){return s===void 0&&(s={}),t===void 0&&(t={}),function(a,o,n){try{return Promise.resolve(function(u,g){try{var V=(s.context,Promise.resolve(e[t.mode==="sync"?"validateSync":"validate"](a,Object.assign({abortEarly:!1},s,{context:o}))).then(function(m){return n.shouldUseNativeValidation&&Xt({},n),{values:t.raw?a:m,errors:{}}}))}catch(m){return g(m)}return V&&V.then?V.then(void 0,g):V}(0,function(u){if(!u.inner)throw u;return{values:{},errors:nr((g=u,V=!n.shouldUseNativeValidation&&n.criteriaMode==="all",(g.inner||[]).reduce(function(m,b){if(m[b.path]||(m[b.path]={message:b.message,type:b.type}),V){var y=m[b.path].types,R=y&&y[b.type];m[b.path]=Ht(b.path,V,m,b.type,R?[].concat(R,b.message):b.message)}return m},{})),n)};var g,V}))}catch(u){return Promise.reject(u)}}}const cr=ws().shape({name:be().required("Name is required"),vehicle_model:jt().required("Vehicle model is required"),operator:be().required("Operator is required"),equipment_type:be().required("Equipment type is required"),serial_no:be().required("Serial No is required."),chassis_no:be().required("Chassis No is required."),odometer:jt().required("Odometer is required."),status:be().required("Status is required"),oem:be().required("OEM is required"),attachment:Fs().nullable()});function ur(){var _;const{handleSubmit:e,control:s,formState:{errors:t},reset:a}=ir({resolver:or(cr),defaultValues:{name:"",vehicle_model:"",operator:"",equipment_type:"",serial_no:"",chassis_no:"",odometer:"",status:"Assigned",oem:"",attachment:null}}),[o,n]=U.useState([]),{oemList:u,userList:g,equipmentTypes:V,UpdatedEqipmentData:m,isUpdateEqipment:b,isAddEqipment:y}=je(x=>x.equipment),[R,W]=U.useState(null),[D,H]=U.useState(null),[G,ae]=U.useState(""),[F,A]=U.useState(null),[P,E]=U.useState("Upload Attachment"),T=He();U.useEffect(()=>{console.log("equipmentTypes",V)},[V]),U.useEffect(()=>{if(console.log("UpdatedEqipmentData",m),m){a({name:m.name,vehicle_model:m.vehicle_model.id,operator:m.operator.id,equipment_type:m.equipment_type.id,serial_no:m.serial_no,chassis_no:m.chassis_no,odometer:m.odometer,status:m.status,oem:m.vehicle_model.oem,attachment:m.attachment});let x=[];x.push(m.vehicle_model),n(x),H(m.operator.id),A(m.attachment),E("edit")}},[m,a]);const X=async x=>{console.log("form data",x);const v=new FormData;if(Object.keys(x).forEach(S=>v.append(S,x[S])),!m)T(ns(v)).unwrap().then(()=>{ie.success("Equipment added successfully"),a(),T(Ne())}).catch(S=>{var N,q;ie.error("Failed to add equipment"),console.error("Error adding equipment:",S),((N=S==null?void 0:S.attachment)==null?void 0:N.length)>0&&S.attachment.map(ee=>ie.error(`Error: ${ee}`)),((q=S==null?void 0:S.name)==null?void 0:q.length)>0&&S.name.map(ee=>ie.error(`Error: ${ee}`))});else{const S=m.id;if(console.log("payload in action",v),typeof x.attachment=="string"){let q=await ls(x.attachment);console.log("file conversion",q),x.attachment=q}let N=new FormData;Object.keys(x).forEach(q=>{q==="attachment"&&x.attachment instanceof Blob?N.append(q,x.attachment,"attachment.jpg"):N.append(q,x[q])});for(let[q,ee]of N.entries())console.log(q,ee);T(os({formData:N,id:S})).unwrap().then(()=>{ie.success("Equipment updated successfully"),a(),T(Ne()),T(qe(null)),T(Me(!1)),T(Ie(!1))}).catch(q=>{var ee,Ee;ie.error("Failed to update equipment"),console.error("Error updating equipment:",q),((ee=q==null?void 0:q.attachment)==null?void 0:ee.length)>0&&q.attachment.map(Ve=>ie.error(`Error: ${Ve}`)),((Ee=q==null?void 0:q.name)==null?void 0:Ee.length)>0&&q.name.map(Ve=>ie.error(`Error: ${Ve}`))})}},oe=async x=>{try{const v=await T(cs({oem_id:x}));v!=null&&v.payload&&n(v.payload.map(S=>({id:S.id,name:S.name,oem:S.oem})))}catch(v){console.error("Error while getting submodels:",v)}},M=x=>W(x.currentTarget),I=()=>{T(qe(null)),W(null)},Z=g==null?void 0:g.filter(x=>`${x.first_name} ${x.last_name}`.toLowerCase().includes(G.toLowerCase())),w=x=>{H(x),I()},k=()=>{T(Ie(!1)),T(Me(!1)),T(qe(null)),console.log("Form Canceled")};return i.jsxs(re,{component:"form",onSubmit:e(X),sx:{p:3,backgroundColor:"#fff",borderRadius:2,boxShadow:3},children:[i.jsx(Je,{variant:"h6",sx:{mb:2},children:"Add New Equipment"}),i.jsxs(ne,{container:!0,spacing:2,children:[i.jsx(ne,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"name",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Name",fullWidth:!0,variant:"outlined",error:!!t.name,helperText:(v=t.name)==null?void 0:v.message})}})}),i.jsx(ne,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"oem",control:s,render:({field:x})=>i.jsxs(Ce,{fullWidth:!0,variant:"outlined",error:!!t.oem,children:[i.jsx(De,{children:"OEM"}),i.jsxs(ke,{...x,label:"OEM",onChange:v=>{x.onChange(v.target.value),oe(v.target.value)},children:[i.jsx(he,{value:"",children:"Select OEM"}),u==null?void 0:u.map((v,S)=>i.jsx(he,{value:v.id,children:v.name},S))]})]})})}),i.jsx(ne,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"vehicle_model",control:s,render:({field:x})=>i.jsxs(Ce,{fullWidth:!0,variant:"outlined",error:!!t.vehicle_model,children:[i.jsx(De,{children:"Vehicle Model"}),i.jsx(ke,{...x,label:"Vehicle Model",children:o.map(v=>i.jsx(he,{value:v.id,children:v.name},v.id))})]})})}),i.jsxs(ne,{item:!0,xs:12,sm:6,children:[i.jsx(ue,{name:"operator",control:s,render:({field:x})=>i.jsxs(i.Fragment,{children:[i.jsx(pe,{fullWidth:!0,onClick:M,sx:{textAlign:"left",border:1,p:1.5},children:D?`${D.first_name} ${D.last_name}`:"Select Operator"}),i.jsx(qs,{open:!!R,anchorEl:R,onClose:I,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{maxHeight:300,overflowY:"auto"}},children:i.jsxs(Cs,{children:[i.jsx(Xe,{children:i.jsx(Ds,{autoFocus:!0,placeholder:"Search user",fullWidth:!0,value:G,onChange:v=>ae(v.target.value)})}),Z.length>0?Z.map((v,S)=>i.jsx(Xe,{button:!0,onClick:()=>{w(v),x.onChange(v.id)},children:i.jsx(_t,{primary:`${v.first_name} ${v.last_name}`,secondary:v.email})},S)):i.jsx(Xe,{children:i.jsx(_t,{primary:"No Operator found"})})]})})]})}),i.jsx(Je,{variant:"caption",color:"error",children:(_=t.operator)==null?void 0:_.message})]}),i.jsx(ne,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"equipment_type",control:s,render:({field:x})=>i.jsxs(Ce,{fullWidth:!0,variant:"outlined",error:!!t.equipment_type,children:[i.jsx(De,{children:"Equipment Types"}),i.jsxs(ke,{...x,label:"Equipment Type",onChange:v=>{x.onChange(v.target.value)},children:[i.jsx(he,{value:"",children:"Select Equipment Type"}),V==null?void 0:V.map((v,S)=>i.jsx(he,{value:v.id,children:v.name},S))]})]})})}),i.jsx(ne,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"serial_no",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Serial Number",fullWidth:!0,variant:"outlined",error:!!t.serial_no,helperText:(v=t.serial_no)==null?void 0:v.message})}})}),i.jsx(ne,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"chassis_no",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Chassis Number",fullWidth:!0,variant:"outlined",error:!!t.chassis_no,helperText:(v=t.chassis_no)==null?void 0:v.message})}})}),i.jsx(ne,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"odometer",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Odometer",fullWidth:!0,type:"number",variant:"outlined",error:!!t.odometer,helperText:(v=t.odometer)==null?void 0:v.message})}})}),i.jsx(ne,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"status",control:s,render:({field:x})=>i.jsxs(Ce,{fullWidth:!0,variant:"outlined",error:!!t.status,children:[i.jsx(De,{children:"Status"}),i.jsxs(ke,{...x,label:"Status",children:[i.jsx(he,{value:"Assigned",children:"Assigned"}),i.jsx(he,{value:"Unassigned",children:"Unassigned"})]})]})})}),i.jsxs(ne,{item:!0,xs:12,sm:6,children:[i.jsx(ue,{name:"attachment",control:s,render:({field:x})=>i.jsxs(pe,{variant:"outlined",component:"label",fullWidth:!0,children:[P,i.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:v=>{const S=v.target.files[0];if(x.onChange(S),S){const N=URL.createObjectURL(S);A(N),E(S.name)}}})]})}),F&&i.jsxs(re,{mt:2,textAlign:"center",children:[i.jsx(Je,{variant:"subtitle1",children:"Uploaded Image:"}),i.jsx("img",{src:F,alt:"Preview",style:{width:"100%",maxHeight:"300px",objectFit:"contain"}})]})]}),i.jsxs(ne,{item:!0,xs:12,children:[i.jsx(pe,{color:"primary",sx:{marginRight:"10px",border:"1px solid #f6f6f6"},onClick:k,children:"Cancel"}),i.jsx(pe,{variant:"contained",color:"primary",type:"submit",children:m?"Update":"Submit"})]})]})]})}const dr=({open:e,onClose:s,onConfirm:t})=>i.jsxs(Lt,{open:e,onClose:s,children:[i.jsx(Ut,{children:"Confirm Deletion"}),i.jsx(Ot,{children:i.jsxs(Os,{children:["Are you sure you want to delete this vehicle data?"," ",i.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),i.jsxs(Ts,{children:[i.jsx(pe,{onClick:s,color:"primary",children:"Cancel"}),i.jsx(pe,{onClick:t,color:"secondary",children:"Delete"})]})]}),fr="http://134.209.145.234/api/v1",hr={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},mr=({equipmentData:e})=>{const s=He(),{isUpdateEqipment:t}=je(m=>m.equipment),[a,o]=U.useState(!1),n=()=>{console.log("equipmentData",e);const m=localStorage.getItem("role");us.includes(m)?(s(Ie(!t)),s(qe(e))):ie.error(`Sorry! Your role is ${m}. You're not allowed to add, edit or delete the vehicle`)},u=async()=>{console.log("Vehicle data deleting");try{await ds.delete(`${fr}/vehicles/delete/${vehicleData.id}/`),ie.success("Vehicle data deleted successfully!"),s(Ne())}catch(m){console.error("Error deleting vehicle data:",m),ie.error("Failed to delete vehicle data. Please try again.")}o(!1)},g=()=>{o(!1)},V={color:"#686868"};return i.jsxs(re,{sx:hr,children:[i.jsx(it,{onClick:n,children:i.jsx(Us,{sx:V})}),i.jsx(dr,{open:a,onClose:g,onConfirm:u})]})},gr=[{id:"all",name:"All"},{id:"assigned",name:"Assigned"},{id:"unassigned",name:"Unassigned"}],yr={assigned:!1,unAssgined:!1,all:!0},xr=()=>{const{isAddEqipment:e,equipmentTypes:s,isUpdateEqipment:t}=je(D=>D.equipment),[a,o]=U.useState(""),[n,u]=U.useState(yr),[g,V]=U.useState("");let m=He();U.useEffect(()=>{console.log("searchQuery",g)},[g]);const b=()=>{console.log("Add eqpmnt"),m(Me(!e))},y=()=>{m(Me(!1)),m(Ie(!1)),m(qe(null))},R=D=>{console.log("equipment type selected",D),o(D.id)},W=D=>{const H={assigned:D.id==="assigned",unassigned:D.id==="unassigned",all:D.id==="all"};u(H)};return i.jsxs(re,{sx:{bgcolor:"white",height:"89vh",m:"15px",borderRadius:"10px"},children:[i.jsx(pr,{handleAdd:b,handleFilters:W,appliedFilters:n}),i.jsx(Ze,{}),i.jsxs(re,{sx:{display:"flex",width:"100%",gap:"30px",padding:"10px"},children:[i.jsx(vr,{searchQuery:g,setSearchQuery:V}),i.jsx(br,{equipmentTypes:s,handleOnChange:R,selectedValue:a})]}),i.jsx(Ze,{}),i.jsx(_r,{appliedFilters:n,selectedEquipmentType:a,searchQuery:g}),i.jsx(Ze,{}),i.jsxs(Lt,{open:e||t,onClose:y,maxWidth:"md",fullWidth:!0,children:[i.jsxs(Ut,{children:["Add Equipment",i.jsx(it,{"aria-label":"close",onClick:y,sx:{position:"absolute",right:8,top:8,color:D=>D.palette.grey[500]},children:i.jsx(vs,{})})]}),i.jsx(Ot,{children:i.jsx(ur,{})})]})]})},pr=({handleAdd:e,handleFilters:s,appliedFilters:t})=>i.jsxs(re,{sx:{display:"flex",justifyContent:"space-between",padding:"10px"},children:[i.jsx(re,{children:gr.map(a=>i.jsx(pe,{onClick:()=>{s(a)},sx:{background:t[a.id]?"lightblue":"transparent",color:t[a.id]?"white":"black",ml:"3px","&:hover":{background:t[a.id]?rt.bgColor:"lightgrey"}},children:a.name},a.id))}),i.jsxs(pe,{onClick:e,sx:{color:"black",background:rt.bgColor},children:[i.jsx(Es,{}),"Equipment"]})]}),vr=({setSearchQuery:e,searchQuery:s})=>i.jsxs(re,{component:"form",border:"1px solid #000000",backgroundColor:"white",borderRadius:"20px",opacity:"75%",m:"3px",width:300,children:[i.jsx(ks,{sx:{my:.5,mx:2},placeholder:"Search equipments...",value:s,onChange:t=>e(t.target.value)}),i.jsx(it,{type:"submit",sx:{p:1},children:i.jsx(js,{})})]}),br=({equipmentTypes:e,handleOnChange:s,selectedValue:t})=>i.jsx(re,{sx:{width:"200px"},children:i.jsxs(Ce,{fullWidth:!0,children:[i.jsx(De,{id:"equipment-type-label",children:"Equipment Type"}),i.jsxs(ke,{labelId:"equipment-type-label",id:"equipment-type-select",label:"Equipment Type",value:t,onChange:a=>{const o=e.find(n=>n.id===a.target.value);s(o||{id:"",name:"No Equipment"})},children:[i.jsx(he,{value:"",children:"No Equipment"}),e&&e.length>0&&e.map(a=>i.jsx(he,{value:a.id,children:a.name},a.id))]})]})}),ge={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},ye={fontSize:"14px",padding:"10px"},_r=({appliedFilters:e,selectedEquipmentType:s,searchQuery:t})=>{const a=[5,10,25],[o,n]=U.useState(0),[u,g]=U.useState(10),{equipmentList:V}=je(A=>A.equipment),[m,b]=U.useState("asc"),[y,R]=U.useState(""),W=(A,P)=>{n(P)},D=A=>{g(parseInt(A.target.value,10)),n(0)},H=A=>{b(y===A&&m==="asc"?"desc":"asc"),R(A)},G=(A,P)=>P.split(".").reduce((E,T)=>E&&E[T],A),F=(A=>[...A].sort((P,E)=>{const T=G(P,y)||"",X=G(E,y)||"";return T<X?m==="asc"?-1:1:T>X?m==="asc"?1:-1:0}))(V.filter(A=>{const P=e.all||e.assigned&&A.status.toLowerCase()==="assigned"||e.unassigned&&A.status.toLowerCase()==="unassigned"||e.archived&&A.archived===!0,E=!s||A.equipment_type.id===s,T=!t||A.name.toLowerCase().includes(t.toLowerCase())||A.serial_no.toLowerCase().includes(t.toLowerCase())||A.operator.email&&A.operator.email.toLowerCase().includes(t.toLowerCase())||A.equipment_type.name.toLowerCase().includes(t.toLowerCase());return P&&E&&T}));return i.jsxs(re,{children:[i.jsx(Ps,{sx:{height:"66vh",bgcolor:"white",borderRadius:"10px"},children:i.jsxs(Ms,{stickyHeader:!0,children:[i.jsx(Ns,{children:i.jsxs(Vt,{children:[i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:y==="name",direction:y==="name"?m:"asc",onClick:()=>H("name"),children:"Name"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:y==="vehicle_model.name",direction:y==="vehicle_model.name"?m:"asc",onClick:()=>H("vehicle_model.name"),children:"Model"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:y==="serial_no",direction:y==="serial_no"?m:"asc",onClick:()=>H("serial_no"),children:"Serial"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:y==="operator.name",direction:y==="operator.name"?m:"asc",onClick:()=>H("operator.name"),children:"Operator"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:y==="equipment_type.name",direction:y==="equipment_type.name"?m:"asc",onClick:()=>H("equipment_type.name"),children:"Equipment Name"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:y==="status",direction:y==="status"?m:"asc",onClick:()=>H("status"),children:"Status"})}),i.jsx(Q,{sx:ge,children:"Open Issues"}),i.jsx(Q,{sx:ge,children:"Action"})]})}),i.jsx(Is,{children:F.slice(o*u,o*u+u).map((A,P)=>{var E,T,X;return i.jsxs(Vt,{hover:!0,children:[i.jsx(Q,{sx:ye,children:A.name||"N/A"}),i.jsx(Q,{sx:ye,children:((E=A.vehicle_model)==null?void 0:E.name)||"N/A"}),i.jsx(Q,{sx:ye,children:A.serial_no||"N/A"}),i.jsx(Q,{sx:ye,children:((T=A.operator)==null?void 0:T.name)||"N/A"}),i.jsx(Q,{sx:ye,children:((X=A.equipment_type)==null?void 0:X.name)||"N/A"}),i.jsx(Q,{sx:ye,children:A.status||"N/A"}),i.jsx(Q,{sx:ye,children:P+1}),i.jsx(Q,{sx:ye,children:i.jsx(mr,{equipmentData:A})})]},P)})})]})}),i.jsx(Ls,{component:"div",rowsPerPageOptions:a,count:F.length,rowsPerPage:u,page:o,onPageChange:W,onRowsPerPageChange:D,sx:{bgcolor:"white",borderTop:"1px solid #e0e0e0",boxShadow:"0px -2px 5px rgba(0,0,0,0.1)",mt:1,borderRadius:"0 0 10px 10px"}})]})},jr=xr;function Zr(){const{locationData:e,selectedVehicle:s,selectedParameterList:t}=je(M=>M.liveMap),{mode:a,selectedVehicleGroup:o}=je(M=>M.dashboard),n=Ss(a),[u,g]=U.useState([]),{w_customer_id:V}=je(M=>M.auth),[m,b]=U.useState(),[y,R]=U.useState(!1),[W,D]=U.useState(!1),[H,G]=U.useState([]);U.useState(!0);const[ae,F]=U.useState(!1),[A,P]=U.useState(!1);let E=He();U.useEffect(()=>{T(),E(fs()),E(hs()),E(ms()),E(Ne())},[E]),U.useEffect(()=>{G([]),E(bt([{reg_id:"",imei:"",params:[]}]))},[s]);const T=async()=>{try{F(!0);let M=[],I=[];const Z=await E(gs({w_customer_id:V}));if(Array.isArray(Z.payload)){Z.payload.forEach(_=>{var x,v,S,N;Array.isArray(_.imei)&&_.imei.length>0&&((x=_.imei[0])!=null&&x.mac_id)?(M.push({id:_.id,label:_.registration_id,value:(v=_.imei[0])==null?void 0:v.mac_id,vehilce_type:_==null?void 0:_.segment,chassis_no:_==null?void 0:_.chassis_no,engine_no:_==null?void 0:_.engine_no,workShop:_==null?void 0:_.workshop,registration_id:_==null?void 0:_.registration_id,sell_date:_==null?void 0:_.sell_date,customer_name:_==null?void 0:_.customer_name,vehicle_model:(S=_==null?void 0:_.vehicle_model)==null?void 0:S.name,vehicle_group:_==null?void 0:_.vehicle_group}),I.push((N=_.imei[0])==null?void 0:N.mac_id)):console.error("IMEI data not found for item:",_)});const w="one",k=I;I.length>0&&E(ys({type:w,imei:k})),g(M),E(xs(M)),F(!1),E(ps({w_customer_id:V}))}else F(!1),console.error("Unexpected data format:",Z),ie.error("Unexpected data format:")}catch(M){console.error("Error fetching vehicle data:",M),ie.error(`Error fetching vehicle data: ${M}`)}},X=async M=>{const{label:I,imei:Z,id:w,reg_id:k,checked:_}=M;b(N=>N.map(q=>q.id===w?{...q,checked:!_}:q));let x=[...H],v=[...H];if(!_)e.forEach(N=>{N.latestDocument.imei===Z&&(x.push({label:I,value:N.latestDocument[I==="maininputvoltage"?"mainInputVoltage":I]}),v=x,G(x))});else{let N=H.filter(q=>q.label!==I);v=N,G(N)}console.log("tempParamList",v),E(bt([{reg_id:k,imei:Z,params:v}]))},oe=u.filter(M=>Object.keys(o).length===0||M.vehicle_group===o.id);return i.jsxs("div",{className:"app",children:[i.jsx(Vs,{}),i.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[i.jsx(bs,{title:"Equipments",setShowVehicles:R,showVehicles:y,setShowVehiclesGroup:P,showVehiclesGroup:A}),i.jsx(Rs,{setShowVehiclesGroup:P,showVehiclesGroup:A}),i.jsxs(re,{style:{display:"flex",width:"100%",height:"95vh"},children:[i.jsx(re,{style:{width:y||W?"80%":"100%",background:rt.bgShadow},children:i.jsx(jr,{})}),y&&i.jsx(re,{style:{width:"20%",backgroundColor:n.grey[100]},children:i.jsx(_s,{vehicleData:oe,title:"Live Map",setParameterData:b,loadingVehicle:ae,setShowVehicles:R,showVehicles:y,showParameters:W,setShowParameters:D})}),W&&i.jsx(re,{style:{width:"20%",backgroundColor:n.grey[100]},children:i.jsx(As,{parametersData:m,setParameterData:b,handleParameterChange:X})})]})]})]})}export{Zr as default};
