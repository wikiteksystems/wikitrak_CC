import{o as Be,p as Ve,q as A,w as ye,x as se,y as ze,z as Ge,A as He,r as f,B as qe,C as H,j as e,D as J,E as Ue,F as be,H as Z,I as ee,J as We,K as de,L as q,M as pe,N as ke,T as N,a as L,G as Q,b as G,u as X,s as ve,_ as z,O as W,t as Te,P as Ye,Q as Je,R as Xe,S as je,i as ue,U as Ke,V as ne,W as Qe,X as Ze,Y as we,Z as le,$ as et,h as tt,k as ot,l as rt,m as st,n as nt,v as lt}from"./index-CGrmQS83.js";import{d as at,a as it,b as ct,c as dt,L as pt}from"./LightModeOutlined-EqS_Pfga.js";import{s as ae}from"./Socket-0N_gnJcr.js";import{p as ut,R as ht,L as gt,X as xt,Y as ft,a as mt,b as yt,T as bt}from"./LineChart-vvxK4M-0.js";import{t as U,d as vt}from"./Search-Dl2wE8I5.js";import{B as y,C as Pe}from"./CircularProgress-Bxv6Btru.js";import{P as jt}from"./Paper-CrwX-xev.js";import{c as wt,S as St}from"./Switch-Dbdrfmtw.js";import{c as Ct,I as De}from"./IconButton-B-vKMJ1H.js";import{r as kt,m as Tt,a as Pt}from"./mergeSlotProps-Bl6akIF8.js";import{C as Ie}from"./index-uddef2Og.js";import{u as Dt,G as It,M as At}from"./esm-DmccSKmI.js";import{u as Ae,f as Me,F as Mt,I as Lt,O as Ft,a as Rt}from"./OutlinedInput-DcPA-z1d.js";import{d as Se}from"./index-DRlVZ4Mb.js";import{D as _t}from"./DateTimePicker-DddGeWnx.js";import{r as he}from"./createSvgIcon-Cufub-H9.js";import{T as $t,a as Et,d as Nt,b as Ot,c as ie}from"./TableRow-BdsfpU1L.js";import{d as Bt,G as Vt}from"./GeofencAlert-BBUeZwkB.js";import"./index-C4v4NU_P.js";import"./roundedArrow-B14lZ5wJ.js";import"./button-B1fgYnFo.js";const zt=["component","direction","spacing","divider","children","className","useFlexGap"],Gt=Be(),Ht=Ve("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,o)=>o.root});function qt(t){return Ue({props:t,name:"MuiStack",defaultTheme:Gt})}function Ut(t,o){const r=f.Children.toArray(t).filter(Boolean);return r.reduce((n,m,a)=>(n.push(m),a<r.length-1&&n.push(f.cloneElement(o,{key:`separator-${a}`})),n),[])}const Wt=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],Yt=({ownerState:t,theme:o})=>{let r=A({display:"flex",flexDirection:"column"},ye({theme:o},se({values:t.direction,breakpoints:o.breakpoints.values}),n=>({flexDirection:n})));if(t.spacing){const n=ze(o),m=Object.keys(o.breakpoints.values).reduce((b,c)=>((typeof t.spacing=="object"&&t.spacing[c]!=null||typeof t.direction=="object"&&t.direction[c]!=null)&&(b[c]=!0),b),{}),a=se({values:t.direction,base:m}),u=se({values:t.spacing,base:m});typeof a=="object"&&Object.keys(a).forEach((b,c,h)=>{if(!a[b]){const j=c>0?a[h[c-1]]:"column";a[b]=j}}),r=Ge(r,ye({theme:o},u,(b,c)=>t.useFlexGap?{gap:be(n,b)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Wt(c?a[c]:t.direction)}`]:be(n,b)}}))}return r=He(o.breakpoints,r),r};function Jt(t={}){const{createStyledComponent:o=Ht,useThemeProps:r=qt,componentName:n="MuiStack"}=t,m=()=>Z({root:["root"]},b=>ee(n,b),{}),a=o(Yt);return f.forwardRef(function(b,c){const h=r(b),g=qe(h),{component:j="div",direction:d="column",spacing:l=0,divider:w,children:S,className:T,useFlexGap:x=!1}=g,p=H(g,zt),P={direction:d,spacing:l,useFlexGap:x},C=m();return e.jsx(a,A({as:j,ownerState:P,ref:c,className:J(C.root,T)},p,{children:w?Ut(S,w):S}))})}const Xt=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],Kt=["component","slots","slotProps"],Qt=["component"];function Zt(t,o){const{className:r,elementType:n,ownerState:m,externalForwardedProps:a,getSlotOwnerState:u,internalForwardedProps:i}=o,b=H(o,Xt),{component:c,slots:h={[t]:void 0},slotProps:g={[t]:void 0}}=a,j=H(a,Kt),d=h[t]||n,l=kt(g[t],m),w=Tt(A({className:r},b,{externalForwardedProps:t==="root"?j:void 0,externalSlotProps:l})),{props:{component:S},internalRef:T}=w,x=H(w.props,Qt),p=We(T,l==null?void 0:l.ref,o.ref),P=u?u(x):{},C=A({},m,P),R=t==="root"?S||c:S,F=Pt(d,A({},t==="root"&&!c&&!h[t]&&i,t!=="root"&&!h[t]&&i,x,R&&{as:R},{ref:p}),C);return Object.keys(P).forEach(I=>{delete F[I]}),[d,F]}const eo=Ct(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function to(t){return ee("MuiAvatar",t)}de("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const oo=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],ro=wt(),so=t=>{const{classes:o,variant:r,colorDefault:n}=t;return Z({root:["root",r,n&&"colorDefault"],img:["img"],fallback:["fallback"]},to,o)},no=q("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,o[r.variant],r.colorDefault&&o.colorDefault]}})(({theme:t})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:A({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:A({backgroundColor:t.palette.grey[400]},t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})))}]})),lo=q("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(t,o)=>o.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),ao=q(eo,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(t,o)=>o.fallback})({width:"75%",height:"75%"});function io({crossOrigin:t,referrerPolicy:o,src:r,srcSet:n}){const[m,a]=f.useState(!1);return f.useEffect(()=>{if(!r&&!n)return;a(!1);let u=!0;const i=new Image;return i.onload=()=>{u&&a("loaded")},i.onerror=()=>{u&&a("error")},i.crossOrigin=t,i.referrerPolicy=o,i.src=r,n&&(i.srcset=n),()=>{u=!1}},[t,o,r,n]),m}const co=f.forwardRef(function(o,r){const n=ro({props:o,name:"MuiAvatar"}),{alt:m,children:a,className:u,component:i="div",slots:b={},slotProps:c={},imgProps:h,sizes:g,src:j,srcSet:d,variant:l="circular"}=n,w=H(n,oo);let S=null;const T=io(A({},h,{src:j,srcSet:d})),x=j||d,p=x&&T!=="error",P=A({},n,{colorDefault:!p,component:i,variant:l}),C=so(P),[R,F]=Zt("img",{className:C.img,elementType:lo,externalForwardedProps:{slots:b,slotProps:{img:A({},h,c.img)}},additionalProps:{alt:m,src:j,srcSet:d,sizes:g},ownerState:P});return p?S=e.jsx(R,A({},F)):a||a===0?S=a:x&&m?S=m[0]:S=e.jsx(ao,{ownerState:P,className:C.fallback}),e.jsx(no,A({as:i,ownerState:P,className:J(C.root,u),ref:r},w,{children:S}))}),po=co,uo=Jt({createStyledComponent:q("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,o)=>o.root}),useThemeProps:t=>pe({props:t,name:"MuiStack"})}),ho=uo;function go(t){return ee("MuiFormControlLabel",t)}const xo=de("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),Y=xo,fo=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],mo=t=>{const{classes:o,disabled:r,labelPlacement:n,error:m,required:a}=t,u={root:["root",r&&"disabled",`labelPlacement${ke(n)}`,m&&"error",a&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",m&&"error"]};return Z(u,go,o)},yo=q("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[{[`& .${Y.label}`]:o.label},o.root,o[`labelPlacement${ke(r.labelPlacement)}`]]}})(({theme:t,ownerState:o})=>A({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${Y.disabled}`]:{cursor:"default"}},o.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},o.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},o.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${Y.label}`]:{[`&.${Y.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})),bo=q("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,o)=>o.asterisk})(({theme:t})=>({[`&.${Y.error}`]:{color:(t.vars||t).palette.error.main}})),vo=f.forwardRef(function(o,r){var n,m;const a=pe({props:o,name:"MuiFormControlLabel"}),{className:u,componentsProps:i={},control:b,disabled:c,disableTypography:h,label:g,labelPlacement:j="end",required:d,slotProps:l={}}=a,w=H(a,fo),S=Ae(),T=(n=c??b.props.disabled)!=null?n:S==null?void 0:S.disabled,x=d??b.props.required,p={disabled:T,required:x};["checked","name","onChange","value","inputRef"].forEach(D=>{typeof b.props[D]>"u"&&typeof a[D]<"u"&&(p[D]=a[D])});const P=Me({props:a,muiFormControl:S,states:["error"]}),C=A({},a,{disabled:T,labelPlacement:j,required:x,error:P.error}),R=mo(C),F=(m=l.typography)!=null?m:i.typography;let I=g;return I!=null&&I.type!==N&&!h&&(I=e.jsx(N,A({component:"span"},F,{className:J(R.label,F==null?void 0:F.className),children:I}))),e.jsxs(yo,A({className:J(R.root,u),ownerState:C,ref:r},w,{children:[f.cloneElement(b,p),x?e.jsxs(ho,{display:"block",children:[I,e.jsxs(bo,{ownerState:C,"aria-hidden":!0,className:R.asterisk,children:["â€‰","*"]})]}):I]}))}),jo=vo;function wo(t){return ee("MuiFormGroup",t)}de("MuiFormGroup",["root","row","error"]);const So=["className","row"],Co=t=>{const{classes:o,row:r,error:n}=t;return Z({root:["root",r&&"row",n&&"error"]},wo,o)},ko=q("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,r.row&&o.row]}})(({ownerState:t})=>A({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),To=f.forwardRef(function(o,r){const n=pe({props:o,name:"MuiFormGroup"}),{className:m,row:a=!1}=n,u=H(n,So),i=Ae(),b=Me({props:n,muiFormControl:i,states:["error"]}),c=A({},n,{row:a,error:b.error}),h=Co(c);return e.jsx(ko,A({className:J(h.root,m),ownerState:c,ref:r},u))}),Po=To,Do=({imeiNo:t})=>{const{selectedVehicle:o,parameterData:r,ivnPid:n,locationData:m,vehicleList:a,onlineVehicle:u}=L(x=>x.liveMap),{ivnParameters:i,mode:b}=L(x=>x.dashboard),c=U(b),[h,g]=f.useState(),[j,d]=f.useState(!1),[l,w]=f.useState();f.useState({mainInputVoltage:0,ignition:0,speed:0}),f.useEffect(()=>{S()},[o]);const S=()=>{var x,p,P;if(m.length>0){let C=m.find(R=>R.latestDocument.imei===o.imei);C?(g((x=C==null?void 0:C.latestDocument)==null?void 0:x.speed),d((p=C==null?void 0:C.latestDocument)==null?void 0:p.ignition),w((P=C==null?void 0:C.latestDocument)==null?void 0:P.mainInputVoltage)):(g(0),d(0),w(0))}else g(0),d(0),w(0)},T=()=>{console.log("onlineVehicle",u),console.log("imeiNo",t);let x=0;return u.length>0&&u.forEach(p=>{t!=null&&t.includes(String(p))&&x++}),console.log("count",x),x};return e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{mx:"10px",pt:"10px",color:c.grey[400]},children:e.jsx("b",{children:o==null?void 0:o.reg_id})}),e.jsx(y,{sx:{backgroundColor:c.grey[200],height:"12vh",borderRadius:"8px",p:"5px"},children:e.jsx(y,{sx:{},children:e.jsx(Q,{container:!0,spacing:3,mt:"2.5px",children:e.jsx(Q,{item:!0,xs:12,children:e.jsx(Q,{container:!0,justifyContent:"space-around",spacing:3,children:[{label:"Online/Offline Vehicles",value:`${T()} / ${a.length-T()}`},{label:"Speed",value:h,unit:"km/h"},{label:"Main Input Voltage",value:parseFloat(l).toFixed(2),unit:"voltage"},{label:"Ignition",value:j?"on":"off"}].map((x,p)=>e.jsx(Q,{item:!0,children:e.jsxs(jt,{sx:{height:70,width:250,backgroundColor:c.grey[100],color:c.grey[400],display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px"},children:[e.jsxs(y,{children:[e.jsx(N,{variant:"h6",sx:{fontSize:"12px"},children:x.label}),e.jsxs(N,{variant:"h6",sx:{fontSize:"18px",fontWeight:"bold"},children:[x.value," ",x==null?void 0:x.unit]})]}),e.jsx(po,{src:ut,sx:{width:20,height:20}})]})},p))})})})})})]})},ce=({title:t,selectedTripData:o})=>{const{mode:r,loading:n}=L(c=>c.dashboard),{selectedVehicle:m}=L(c=>c.liveMap),[a,u]=f.useState([]);f.useEffect(()=>{let c=o.map(g=>{let j={...g};return j.ignition=j.ignition?1:0,j});const h=b(c);u(h)},[o]);const i=U(r),b=c=>{let h=null;return c.forEach(g=>{const j=new Date(g.createdAt);h&&h.toDateString()===j.toDateString()?(g.date=G(g.createdAt).format("HH:mm:ss"),g.ignition=g.ignition?1:0):(g.date=G(g.createdAt).format("DD-MM-YYYY"),g.ignition=g.ignition?1:0),h=j}),c};return e.jsx(y,{sx:{ml:"2rem",border:i.grey[300],fontSize:"13px",height:"24vh",color:i.grey[400],backgroundColor:i.grey[100],borderRadius:"5px"},children:a&&a.length>0?e.jsx(ht,{children:e.jsxs(gt,{data:a,margin:{top:15,right:10,left:-25,bottom:0},children:[e.jsx(xt,{dataKey:"date",stroke:i.grey[400]}),e.jsx(ft,{stroke:i.grey[400]}),e.jsx(mt,{type:"monotone",dataKey:t,dot:!1,stroke:"#EF5B05",strokeWidth:2}),e.jsx(yt,{layout:"horizontal",verticalAlign:"top",align:"center"}),e.jsx(bt,{})]})}):e.jsx(Ie,{style:{background:i.grey[100],width:"400px",height:"100px",margin:"auto",marginTop:"10px"},children:Object.keys(m).length===0?e.jsx(N,{textAlign:"center",align:"center",mt:"20px",color:i.grey[600],children:"Please Select a Vehicle"}):n?e.jsx(Pe,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(N,{textAlign:"center",color:i.grey[600],children:"Sorry! No Trips Available"})})})},Io=()=>{const t=X(),{center:o,selectedParameterList:r,selectedVehicle:n,vehicleList:m,tractorIcon:a,icons:u,locationData:i,ivnPid:b,placesData:c}=L(D=>D.liveMap),{mode:h}=L(D=>D.dashboard),{isLoaded:g,loadError:j}=Dt({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"}),[d,l]=f.useState(null),[w,S]=f.useState(!0),[T,x]=f.useState(5),[p,P]=f.useState(),C=U(h);f.useEffect(()=>{if(w)P(i);else{let D=i==null?void 0:i.filter(_=>(_==null?void 0:_._id)===(n==null?void 0:n.imei));P(D)}},[i,n,w]);const R=()=>{if(!w)t(ve({lat:21,lng:78})),x(4),S(_=>!_);else{const D=i.find(_=>_.latestDocument.imei===n.imei);if(D){console.log(D.latestDocument,"getCenter");const{lat:_,lng:te}=D.latestDocument;t(ve({lat:_,lng:te})),x(12),S(oe=>!oe)}else z.error("Data is not available for selected vehicle")}};if(f.useEffect(()=>{g&&l(window.google.maps)},[g,i]),j)return"Error loading maps";if(!g)return"Loading maps";const F={height:"41.5vh",width:"99%",marginTop:"0px",marginLeft:"10px"},I=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}];return d?e.jsxs("div",{children:[e.jsxs(y,{sx:{ml:"10px",fontSize:"20px",display:"flex",justifyContent:"space-between",color:C.grey[400]},children:[e.jsx("b",{children:"Live Map"}),e.jsx(Po,{sx:{marginLeft:0,paddingTop:0,color:C.grey[400]},children:e.jsx(jo,{control:e.jsx(St,{checked:w,onChange:R}),label:w?"Group":"Individual"})})]}),e.jsx(It,{mapContainerStyle:F,zoom:T,center:o,options:{mapTypeControl:!1,styles:h?I:""},children:p&&p.length>0&&p.map((D,_)=>e.jsx(At,{position:{lat:D.latestDocument.lat,lng:D.latestDocument.lng},icon:{fillColor:"red",fillOpacity:2,strokeWeight:1,scale:2}},_))})]}):null},Ao=({vehicleData:t})=>{const o=["Engine RPM","Engine coolant temperature","Battery Potential"],r=X(),{selectedVehicle:n}=L(d=>d.liveMap),{startDate:m,endDate:a,mode:u}=L(d=>d.dashboard),[i,b]=f.useState(""),c=U(u),h=t.length>0&&t.filter(d=>d.label.toLowerCase().includes(i.toLowerCase())),g=d=>{b(d.target.value)},j=async d=>{var x;r(Ye({imei:d.value,reg_id:d.label}));let l={imei:d.value,startDate:Se().subtract(5,"day"),endDate:Se()};r(Je(l));let w=d.label;const S=await r(Xe({registration_id:w}));let T=[];if(S&&S.payload.length>0&&((x=S.payload)==null||x.map(p=>{p.ivn_parameter.length>0&&T.push(p.ivn_parameter[0])})),T.length>0){let p=T.filter(P=>o.includes(P.pid_description));r(je(p))}else r(je([]))};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(y,{sx:{align:"center",my:"15px",ml:"20px"},children:e.jsxs(Mt,{sx:{width:"90%",backgroundColor:"white",borderRadius:"5px"},variant:"outlined",children:[e.jsx(Lt,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px"},children:"Search"}),e.jsx(Ft,{onChange:d=>g(d),inputProps:{style:{padding:7}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(Rt,{position:"end",children:e.jsx(De,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(vt,{})})}),label:"Search"})]})}),h.length>0&&h.map((d,l)=>e.jsx(y,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(W,{variant:"outlined",onClick:()=>{j(d)},sx:{width:"90%",bgcolor:d.label===n.reg_id?Te.bgColor:"undefined",color:d.label===n.reg_id?"#DAE0EE":c.grey[400]},children:d.label})},l))]})})};var ge={},Mo=ue;Object.defineProperty(ge,"__esModule",{value:!0});var Le=ge.default=void 0,Lo=Mo(he()),Fo=e;Le=ge.default=(0,Lo.default)((0,Fo.jsx)("path",{d:"M10.02 6 8.61 7.41 13.19 12l-4.58 4.59L10.02 18l6-6z"}),"NavigateNextOutlined");var xe={},Ro=ue;Object.defineProperty(xe,"__esModule",{value:!0});var Fe=xe.default=void 0,_o=Ro(he()),$o=e;Fe=xe.default=(0,_o.default)((0,$o.jsx)("path",{d:"M15.61 7.41 14.2 6l-6 6 6 6 1.41-1.41L11.03 12z"}),"NavigateBeforeOutlined");var fe={},Eo=ue;Object.defineProperty(fe,"__esModule",{value:!0});var Re=fe.default=void 0,No=Eo(he()),Ce=e;Re=fe.default=(0,No.default)([(0,Ce.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7M7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9"},"0"),(0,Ce.jsx)("circle",{cx:"12",cy:"9",r:"2.5"},"1")],"LocationOnOutlined");const Oo=()=>{const t=X(),o=Ke(),{tripList:r,selectedTripData:n,loading:m,trips:a,activeIndex:u,searchText:i,mode:b}=L(s=>s.dashboard),{selectedVehicle:c}=L(s=>s.liveMap),[h,g]=f.useState(0),[j,d]=f.useState(0),[l,w]=f.useState(0),[S,T]=f.useState(0),[x,p]=f.useState("0"),[P,C]=f.useState(0),[R,F]=f.useState(!1),I=U(b),D=()=>{g(s=>s+3)},_=()=>{g(s=>Math.max(s-5,0))};f.useEffect(()=>{const s=te(r);if(s.length>0){t(ne(s[0]));const v=r&&r.length>0&&r.filter(k=>k.formatedDate.toLowerCase().includes(i.toLowerCase()));v.length>0&&re(0,v[0])}t(Qe(s))},[r]),f.useEffect(()=>{if(n.length>0){const s=n.map(k=>({lat:parseFloat(k.lat),lng:parseFloat(k.lng)})),v=new window.google.maps.Polygon({paths:s});me(v)}},[n]);const te=s=>{const v=new Set,k=[];return s.forEach(M=>{v.has(M.formatedDate)||(v.add(M.formatedDate),k.push(M.formatedDate))}),k},O=r&&r.length>0&&r.filter(s=>s.formatedDate.toLowerCase().includes(i.toLowerCase())),oe=s=>{if(O&&O.length>0){const v=r&&r.length>0&&r.filter(k=>k.formatedDate.toLowerCase().includes(s.toLowerCase()));t(le(0)),t(ne(s)),re(0,v[0])}else t(le(null)),t(ne(s))},re=async(s,v)=>{var $;console.log("item",v);let k={imei:c.imei,startDate:v.startDate,endDate:v.endDate};F(!0);const M=await Ze(k);(($=M==null?void 0:M.data)==null?void 0:$.documents.length)>0?(t(we(M.data.documents[0].data)),_e(M.data.documents[0].data),F(!1)):(T(0),w(0),C(0),d(0),p("0"),t(we([])),F(!1)),t(le(s))},_e=s=>{let v=0,k=0;s.map((E,K)=>{E.packetType==="HB"&&v++,E.packetType==="HA"&&k++}),d(v),w(k);let M=$e(new Date(s[0].createdAt).toISOString(),new Date(s[s.length-1].createdAt).toISOString());console.log("hours: ",M),p(M);const $=Ee(s);C($);const B=s.map(E=>({lat:parseFloat(E.lat),lng:parseFloat(E.lng)})),V=new window.google.maps.Polygon({paths:B});me(V)};function $e(s,v){var k=G(s),M=G(v);console.log("startDate-------->",s,v);let $=G.duration(M.diff(k)),B=$.hours(),V=$.minutes(),E=$.seconds(),K=`${B}h ${V}m ${E}s`;return console.log("string",K),K}function Ee(s){let v=0;for(let k=0;k<s.length-1;k++){const M=s[k].lat,$=s[k].lng,B=s[k+1].lat,V=s[k+1].lng;v+=Ne(M,$,B,V)}return v}function Ne(s,v,k,M){const B=(k-s)*Math.PI/180,V=(M-v)*Math.PI/180,E=Math.sin(B/2)*Math.sin(B/2)+Math.cos(s*Math.PI/180)*Math.cos(k*Math.PI/180)*Math.sin(V/2)*Math.sin(V/2);return 6371*(2*Math.atan2(Math.sqrt(E),Math.sqrt(1-E)))}const me=s=>{if(!window.google||!window.google.maps.geometry){console.log("not loaded");return}const k=window.google.maps.geometry.spherical.computeArea(s.getPath())/4046.86;T(k)},Oe=s=>{u!==null?s===u?o("/trip-monitor"):z.error("Trip not selected"):z.error("Please select the trip")};return e.jsxs(e.Fragment,{children:[e.jsxs(y,{sx:{width:"95%",display:"flex",overflow:"auto",mx:"10px"},children:[e.jsx("div",{style:{display:"flex"},children:a&&a.length>0&&a.slice(h,h+5).map((s,v)=>e.jsx(y,{sx:{backgroundColor:i===s?"#EF5B05":"white",color:i===s?"white":"#EF5B05",mx:"5px",p:"5px",borderRadius:"5px",width:"90px",height:"25px",textAlign:"center",cursor:"pointer"},onClick:()=>{oe(s)},children:s},v))}),h!==0&&e.jsx("button",{onClick:_,style:{marginLeft:"5px",backgroundColor:"white",color:"black"},disabled:h===0,children:e.jsx(Fe,{})}),!(h+5>=a.length)&&e.jsx("button",{onClick:D,style:{marginLeft:"5px",backgroundColor:"white",color:"black"},disabled:h+5>=a.length,children:e.jsx(Le,{})})]}),e.jsx(y,{children:O&&O.length>0?e.jsx($t,{sx:{maxHeight:210,height:210,width:"98%",ml:"10px",mt:"10px",borderRadius:"5px",border:"1px solid #dbdad5"},children:e.jsx(Et,{stickyHeader:!0,"aria-label":"sticky table",children:e.jsx(Nt,{children:O&&O.length>0&&O.map((s,v)=>e.jsxs(Ot,{sx:{backgroundColor:u===v?"#DAE0EE":I.grey[100]},children:[e.jsxs(ie,{align:"left",style:{fontSize:"12px",padding:10,color:u===v?"black":I.grey[400],cursor:"pointer"},onClick:()=>{re(v,s)},children:[v+1,". ",s.startLocation," to ",s.endLocation]}),e.jsxs(ie,{align:"right",style:{fontSize:"12px",padding:10,color:u===v?"black":I.grey[400]},children:[s!=null&&s.startDate?G(new Date(s.startDate).toISOString()).format("LT"):""," ","to"," ",s!=null&&s.endDate?G(new Date(s.endDate).toISOString()).format("LT"):"----"]}),e.jsx(ie,{align:"right",style:{fontSize:"12px",padding:10,color:u===v?"black":I.grey[400]},children:e.jsx("span",{title:"Navigate to map",style:{cursor:"pointer"},onClick:()=>{Oe(v)},children:e.jsx(Re,{})})})]}))})})}):e.jsx(y,{sx:{height:210,display:"flex",justifyContent:"center",alignItems:"center",color:I.grey[400],margin:"auto"},children:e.jsx(Ie,{style:{background:I.grey[100],width:"400px",height:"100px"},children:Object.keys(c).length===0?e.jsx(N,{textAlign:"center",align:"center",mt:"20px",color:I.grey[600],children:"Please Select a Vehicle"}):m?e.jsx(Pe,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(N,{textAlign:"center",color:I.grey[600],children:"Sorry! No Trips Available"})})})}),n.length>0&&e.jsx(y,{sx:{my:"0px"},children:e.jsxs(y,{sx:{display:"flex",mx:"5px",mt:"5px"},children:[e.jsxs(y,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Braking"}),e.jsx("div",{children:"0"})]}),e.jsxs(y,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Acceleration"}),e.jsx("div",{children:"0"})]}),e.jsxs(y,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Running Hrs"}),e.jsx("div",{children:x})]}),e.jsxs(y,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Distance"}),e.jsx("div",{children:parseFloat(parseFloat(P).toFixed(2))})]})]})})]})},Bo=()=>{const{mode:t}=L(r=>r.dashboard),o=U(t);return e.jsxs(y,{children:[e.jsxs(y,{sx:{display:"flex",ml:"5px"},children:[e.jsx(y,{sx:{m:"5px",fontSize:"20px",width:"60%",color:o.grey[400]},children:e.jsx("b",{children:"Trip History"})}),e.jsx(y,{children:e.jsx(_t,{})})]}),e.jsx(y,{sx:{my:"5px"},children:e.jsx(Oo,{})})]})},Vo=({title:t,setShowVehicles:o,showVehicles:r,setShowNotification:n,showNotification:m})=>{JSON.parse(localStorage.getItem("w_userDetails"));const a=X(),{collapsed:u}=L(j=>j.auth),{selectedVehicle:i,tractorIcon:b}=L(j=>j.liveMap),{mode:c}=L(j=>j.dashboard),h=()=>{console.log("clicked"),a(tt(!u))},g={fontSize:"26px",fontWeight:500,lineHeight:"18.38px",color:"#fff",textAlign:"center",paddingTop:"11px"};return e.jsxs(y,{style:{display:"flex",justifyContent:"space-between",paddingRight:"20px",backgroundColor:Te.bgColor,alignItems:"center",textAlign:"center",height:"60px",color:"white"},children:[e.jsxs(y,{style:{display:"flex",justifyContent:"space-between",gap:"10px"},children:[u?e.jsx(W,{onClick:h,sx:{color:"white"},children:e.jsx(at,{style:{width:"30px",height:"30px"}})}):e.jsx(W,{onClick:h,sx:{color:"white"},children:e.jsx(it,{style:{width:"30px",height:"30px"}})}),e.jsx(N,{style:g,children:t})]}),e.jsxs(y,{style:{display:"flex",gap:"5px",alignItems:"center"},children:[e.jsxs(W,{variant:"outlined",size:"small",sx:{color:r?"white":"black",backgroundColor:r?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:()=>{o(!r),t==="Live Map"&&setShowParameters(!1),t==="Trip Monitor"&&setSideBarTrip(!1),t==="Parameter Monitor"&&setShowParameters(!1),t==="Dashboard"&&n(!1)},children:[e.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",style:{marginRight:"5px"},children:e.jsx("path",{d:b.path1})}),Object.keys(i).length>0?i.reg_id:"Vehicles"]}),e.jsx(y,{children:e.jsx(W,{onClick:()=>{console.log("clicked"),o(!1),n(!m)},children:e.jsx(Bt,{sx:{cursor:"pointer",color:"white"}})})}),e.jsx(De,{onClick:()=>{a(et(!c))},sx:{color:"white"},children:c?e.jsx(ct,{}):e.jsx(dt,{})})]})]})},dr=()=>{const{w_customer_id:t}=L(l=>l.auth),{mode:o,selectedTripData:r}=L(l=>l.dashboard),[n,m]=f.useState(()=>{const l=sessionStorage.getItem("imeiNo");return l?JSON.parse(l):[]}),a=X(),u=U(o),[i,b]=f.useState([]),[c,h]=f.useState(!1),[g,j]=f.useState(!1);f.useEffect(()=>{d()},[]),f.useEffect(()=>{sessionStorage.setItem("imeiNo",JSON.stringify(n))},[n]),f.useEffect(()=>{ae.on("geofenceAlert",l=>{(l==null?void 0:l.imei)!==null&&n.find(T=>parseInt(T)===(l==null?void 0:l.imei))&&(console.log("geofence"),z.error(`Type: ${l==null?void 0:l.type} ${l==null?void 0:l.msg} ${l==null?void 0:l.imei}`,{id:"geofence",autoClose:5e3}))}),ae.on("speedAlert",l=>{(l==null?void 0:l.imei)!==null&&n.find(T=>parseInt(T)===(l==null?void 0:l.imei))&&z.error(`${l==null?void 0:l.msg} ${l==null?void 0:l.imei}`,{id:"speed",autoClose:5e3})})},[ae]);const d=async()=>{try{let l=[],w=[];const S=await a(ot({w_customer_id:t}));if(Array.isArray(S.payload)){S.payload.forEach(p=>{var P,C;Array.isArray(p.imei)&&p.imei.length>0?(l.push({id:p.id,label:p.registration_id,value:(P=p==null?void 0:p.imei[0])==null?void 0:P.mac_id}),w.push((C=p.imei[0])==null?void 0:C.mac_id)):(console.error("IMEI data not found for item:",p),z.error(`IMEI Number not found for the vehicle: ${p==null?void 0:p.registration_id}`))}),m(w);const T="one",x=w;w.length>0&&(a(rt({type:T,imei:x})),a(st(x))),b(l),a(nt({w_customer_id:t})),a(lt({}))}else console.error("Unexpected data format:",S),z.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),z.error(`Error fetching vehicle data: ${l}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(pt,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Vo,{title:"Dashboard",showVehicles:c,setShowVehicles:h,setShowNotification:j,showNotification:g}),e.jsxs("div",{style:{height:"92vh",backgroundColor:u.grey[100],padding:"10px"},children:[c&&e.jsx(y,{sx:{position:"fixed",width:"250px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:u.grey[100]},children:e.jsx(Ao,{vehicleData:i})}),g&&e.jsx(y,{sx:{position:"fixed",width:"300px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:u.grey[100]},children:e.jsx(Vt,{})}),e.jsx(y,{sx:{height:"21%"},children:e.jsx(Do,{imeiNo:n})}),e.jsxs(y,{sx:{display:"flex",height:"50%"},children:[e.jsx(y,{sx:{width:"50%",border:"1px solid #E8E8E8",padding:"2px",borderRadius:"5px"},children:e.jsx(Bo,{})}),e.jsx(y,{sx:{width:"50%"},children:e.jsx(Io,{})})]}),e.jsxs(y,{sx:{display:"flex",height:"30%",mt:"5px",pt:"10px"},children:[e.jsx(y,{style:{width:"33%"},children:e.jsx(ce,{title:"speed",selectedTripData:r})}),e.jsx(y,{style:{width:"33%"},children:e.jsx(ce,{title:"mainInputVoltage",selectedTripData:r})}),e.jsx(y,{style:{width:"33%"},children:e.jsx(ce,{title:"ignition",selectedTripData:r})})]})]})]})]})};export{dr as default};
