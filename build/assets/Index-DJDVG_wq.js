import{r as f,j as e,a7 as D,k,t as H,T as M,B as C,q as R,ae as A,i as O,D as V,E as I,F as L,H as B,K as _}from"./index-8wlzEUpk.js";import{L as G,t as U}from"./LeftSideBar2-Y3Ki9fIK.js";import{V as F}from"./VehicleMenu-6I0BD9Mr.js";import{d as Y}from"./dayjs.min-BNqEpEzF.js";import{S as P,D as K}from"./index-Cpk8YvGQ.js";import{R as N,B as W,y as X,X as $,Y as q,z,E as J,F as Q}from"./TopBar-Cf57A1w0.js";import{V as Z}from"./VehicleGroups-D9rNUdxB.js";import{B as x}from"./menu2-BKBEZUg9.js";import{S as ee}from"./Switch-BCsDcCFA.js";import"./createSvgIcon-CTJcwSQn.js";import"./useControlled-BpK2VRqc.js";import"./index-BW4E5BxC.js";import"./customParseFormat-C70IKQ2E.js";import"./index-CO2ysH2Z.js";import"./NotificationsNone-Du4gJbWG.js";import"./SwitchBase-D-POHkYR.js";const{RangePicker:T}=K,te=()=>{const c=Y(),n=c.startOf("day"),u=c.endOf("day");return{defaultStartDate:n,defaultEndDate:u,defaultStartDateString:n.format("MM/DD/YYYY HH:mm:ss"),defaultEndDateString:u.format("MM/DD/YYYY HH:mm:ss")}},oe=({setEndDate:c,setStartDate:n,selectedDate:u})=>{const[d,m]=f.useState(te()),[g,s]=f.useState([d.defaultStartDate,d.defaultEndDate]);f.useEffect(()=>{if(u){const t=Y(),o=t.startOf("day").format("MM/DD/YYYY HH:mm:ss"),i=t.endOf("day").format("MM/DD/YYYY HH:mm:ss");n(o),c(i),s([t.startOf("day"),t.endOf("day")]),console.log(o,"defaultStartDateString"),console.log(i,"defaultEndDateString")}else n(d.defaultStartDateString),c(d.defaultEndDateString),s([d.defaultStartDate,d.defaultEndDate])},[u]);const w=(t,o)=>{t?(n(o[0]),c(o[1]),s(t)):(n(null),c(null),s([]),console.log("Clear date"))},v=t=>t&&t>Y().endOf("day");return e.jsx(P,{direction:"vertical",size:12,children:u?e.jsx(T,{showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm",onChange:w,disabledDate:v,value:g,disabled:!0,style:{color:"white",padding:"8px"}}):e.jsx(T,{showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm",onChange:w,disabledDate:v,value:g,style:{padding:"8px"}})})},ae=oe;var re={exports:{}};(function(c,n){(function(u,d){d()})(D,function(){function u(t,o){return typeof o>"u"?o={autoBom:!1}:typeof o!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\uFEFF",t],{type:t.type}):t}function d(t,o,i){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="blob",a.onload=function(){v(a.response,o,i)},a.onerror=function(){console.error("could not download file")},a.send()}function m(t){var o=new XMLHttpRequest;o.open("HEAD",t,!1);try{o.send()}catch{}return 200<=o.status&&299>=o.status}function g(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(o)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof D=="object"&&D.global===D?D:void 0,w=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),v=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!w?function(t,o,i){var a=s.URL||s.webkitURL,p=document.createElement("a");o=o||t.name||"download",p.download=o,p.rel="noopener",typeof t=="string"?(p.href=t,p.origin===location.origin?g(p):m(p.href)?d(t,o,i):g(p,p.target="_blank")):(p.href=a.createObjectURL(t),setTimeout(function(){a.revokeObjectURL(p.href)},4e4),setTimeout(function(){g(p)},0))}:"msSaveOrOpenBlob"in navigator?function(t,o,i){if(o=o||t.name||"download",typeof t!="string")navigator.msSaveOrOpenBlob(u(t,i),o);else if(m(t))d(t,o,i);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout(function(){g(a)})}}:function(t,o,i,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof t=="string")return d(t,o,i);var p=t.type==="application/octet-stream",h=/constructor/i.test(s.HTMLElement)||s.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||p&&h||w)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var r=y.result;r=j?r:r.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=r:location=r,a=null},y.readAsDataURL(t)}else{var S=s.URL||s.webkitURL,l=S.createObjectURL(t);a?a.location=l:location.href=l,a=null,setTimeout(function(){S.revokeObjectURL(l)},4e4)}});s.saveAs=v.saveAs=v,c.exports=v})})(re);function ne({getReport:c,selectedDate:n,setEndDate:u,setStartDate:d,setSelectDate:m}){const{selectedVehicle:g}=k(s=>s.liveMap);return e.jsxs(x,{sx:{bgcolor:H.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"left",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",height:"60px",gap:"15px"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",border:"1px solid white",padding:"3px",borderRadius:"8px",ml:"5px"},children:[e.jsx(ee,{defaultChecked:n,onChange:()=>m(!n)}),e.jsx(M,{sx:{color:n?"white":"black",padding:"5px",borderRadius:"5px",fontWeight:"500"},children:n?"Today's Report":"Select Date-Time"})]}),e.jsx(ae,{setStartDate:d,setEndDate:u,selectedDate:n}),e.jsx(C,{disabled:n,sx:{color:"black",background:"white","&:hover":{color:"white"}},onClick:()=>{Object.keys(g).length>0?c():R.error("Please Select Vehicle.")},children:"Generate-Report"})]})}const se=[{metric:"Km Driven",value:350},{metric:"Hrs Driven",value:8},{metric:"Idle Time",value:10},{metric:"Overspeed Time",value:100},{metric:"Avg. Speed",value:50},{metric:"Mileage",value:40},{metric:"Outward Alerts",value:500},{metric:"Inward Alerts",value:100}],ie=()=>e.jsx(N,{width:"100%",height:280,children:e.jsxs(W,{data:se,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"metric"}),e.jsx(q,{}),e.jsx(z,{}),e.jsx(J,{dataKey:"value",fill:"#82ca9d"})]})}),ce=ie;function le({handleBack:c}){return e.jsxs(x,{sx:{background:"",width:"100%",height:"content-fit"},children:[e.jsx(C,{onClick:c,children:"go back"}),e.jsx(x,{children:"VehicleReport Content area"}),e.jsx(ce,{})]})}function de({handleBack:c}){return e.jsxs(x,{children:[e.jsx(C,{onClick:c,children:"go back"}),e.jsx(x,{children:"InspectionReport Content area"})]})}function pe({handleBack:c}){return e.jsxs(x,{children:[e.jsx(C,{onClick:c,children:"go back"}),e.jsx(x,{children:"ServiceReport Content area"})]})}const ue="http://127.0.0.1:3031";function he({showCard:c}){k(l=>l.dashboard);const{selectedVehicle:n}=k(l=>l.liveMap),[u,d]=f.useState(),[m,g]=f.useState(),[s,w]=f.useState(!0),[v,t]=f.useState({}),[o,i]=f.useState(!1),[a,p]=f.useState(null);f.useEffect(()=>{console.log(u,"startDate"),console.log(m,"endDate")},[m]),f.useEffect(()=>{n&&Object.keys(n).length>0&&s&&m&&h()},[n,m]);const h=async()=>{var l;try{i(!0);const r={imei:[n==null?void 0:n.imei],startDate:u,endDate:m};console.log(r,"payload");const b=await A.post(`${ue}/ccServer/location/getReport`,r),E=((l=b==null?void 0:b.data)==null?void 0:l.data)||{};t(E)}catch(r){console.error(r),R.error("Failed to fetch report data.")}finally{i(!1)}},j=l=>{console.log("report type",l),p(l)},y=()=>{p(null)},S=[{id:"vehicle",name:"Vehicle"},{id:"inspection",name:"Inspection"},{id:"service",name:"Service"}];return e.jsxs(e.Fragment,{children:[c&&e.jsx(ne,{getReport:h,selectedDate:s,setEndDate:g,setStartDate:d,setSelectDate:w}),e.jsx(x,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignItems:"center",gap:2,padding:2},children:a?a==="Vehicle"?e.jsx(le,{handleBack:y}):a==="Service"?e.jsx(pe,{handleBack:y}):a==="Inspection"?e.jsx(de,{handleBack:y}):e.jsx(M,{children:"No report type selected."}):S.map(l=>e.jsx(x,{sx:{width:"300px",height:"150px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"white",borderRadius:"10px",boxShadow:"0px 4px 10px rgba(0, 0, 0, 0.1)",transition:"transform 0.3s, box-shadow 0.3s",cursor:"pointer","&:hover":{transform:"scale(1.05)",boxShadow:"0px 6px 15px rgba(0, 0, 0, 0.2)"}},onClick:()=>j(l.name),children:e.jsxs(M,{sx:{color:"black",fontWeight:"bold"},children:["Generate ",l.name," Report"]})},l.id))})]})}function Ye(){const{mode:c,showVehicles:n,selectedVehicleGroup:u}=k(h=>h.dashboard),{w_customer_id:d}=k(h=>h.auth),[m,g]=f.useState([]),[s,w]=f.useState(!0),[v,t]=f.useState(!1),o=U(c);let i=O();f.useEffect(()=>{a()},[]);const a=async()=>{try{let h=[],j=[];const y=await i(V({w_customer_id:d}));if(Array.isArray(y.payload)){y.payload.forEach(r=>{var b,E;Array.isArray(r.imei)&&r.imei.length>0?(h.push({id:r.id,label:r.registration_id,value:(b=r==null?void 0:r.imei[0])==null?void 0:b.mac_id,workShop:r==null?void 0:r.workshop,vehicle_group:r==null?void 0:r.vehicle_group}),j.push((E=r.imei[0])==null?void 0:E.mac_id)):(console.error("IMEI data not found for item:",r),R.error(`IMEI Number not found for the vehicle: ${r==null?void 0:r.registration_id}`))});const S="one",l=j;j.length>0&&(i(I({type:S,imei:l})),i(L(l))),g(h),i(B({w_customer_id:d})),i(_({}))}else console.error("Unexpected data format:",y),R.error("Unexpected data format:")}catch(h){console.error("Error fetching vehicle data:",h),R.error(`Error fetching vehicle data: ${h}`)}},p=m.filter(h=>Object.keys(u).length===0||h.vehicle_group===u.id);return e.jsxs("div",{className:"app",children:[e.jsx(G,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:o.grey[100]},children:[e.jsx(Q,{title:"Report",setShowVehiclesGroup:t,showVehiclesGroup:v}),e.jsx(Z,{setShowVehiclesGroup:t,showVehiclesGroup:v}),e.jsxs(x,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(x,{style:{display:"flex",width:"100%",height:"95vh"},children:e.jsx(x,{style:{width:n?"85%":"100%"},children:e.jsx(he,{showCard:s})})}),n&&e.jsx(x,{sx:{position:"fixed",width:"18%",right:"0px",height:"90vh",zIndex:9999,backgroundColor:o.grey[100],borderLeft:`1px solid ${o.grey[300]}`,borderRadius:"2px"},children:e.jsx(F,{vehicleData:p})})]})]})]})}export{Ye as default};
