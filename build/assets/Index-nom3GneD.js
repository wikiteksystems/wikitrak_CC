import{r as d,j as n,u as V,a as R,t as X,T as m,B as q,R as sa,_ as Z,Q as H,S as ea,U as oa,n as na,o as la}from"./index-NSaVhu1Q.js";import{L as ca}from"./Close-DpjR4xt1.js";import{L as da}from"./LiveMapTopBar-CYWl4rdJ.js";import{V as ra}from"./VehicleMenu-CzAWwnhw.js";import{P as _,u as ha,G as ga,a as I}from"./esm-CggiB5SI.js";import{T as ua,d as aa,D as ia}from"./DateTimePicker-BkCQu_Jn.js";import{B as M,C as ta}from"./CircularProgress-rkAC4pXE.js";import{B as pa}from"./button-gEgKdFR3.js";import"./createSvgIcon-CMu6ck8n.js";import"./createSvgIcon-NK_pmS8T.js";import"./index-_0Aopxou.js";import"./OutlinedInput-CKZv5UBt.js";import"./IconButton-DDpnFjDT.js";function xa({trip:o,tripPlay:b,setTripPlay:P,setSpeed:B}){const[h,l]=d.useState([]),[A,T]=d.useState(0),[p,G]=d.useState([]),[v,C]=d.useState([null]);return d.useEffect(()=>{var j;B((j=o==null?void 0:o.data[2])==null?void 0:j.speed)},[o]),d.useEffect(()=>{var L,x,y,f;C([null]);const j=[];if(o&&(o!=null&&o.data)&&((L=o==null?void 0:o.data)==null?void 0:L.length)>0&&((x=o==null?void 0:o.data)==null||x.map(S=>{j.push(S.speed).toFixed(2)}),G(j)),o&&(o!=null&&o.data)&&((y=o==null?void 0:o.data)==null?void 0:y.length)>0){const S=(f=o==null?void 0:o.data)==null?void 0:f.map(g=>({lat:parseFloat(g.lat),lng:parseFloat(g.lng)}));l(S),C(S.slice(0))}},[o]),d.useEffect(()=>{if(b){const j=h.length,L=9e3,x=1e4,y=L/x;let f=0;const S=setInterval(()=>{if(f<x){const g=f/x,E=Math.floor(g*j);T(E),B(p[E]),f++}else clearInterval(S)},y);return()=>clearInterval(S)}},[b]),n.jsxs("div",{children:[v.length>0&&n.jsx(n.Fragment,{children:n.jsx(_,{path:v,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4}})}),b&&n.jsx(_,{path:h.slice(0,A+1),options:{strokeColor:"green",strokeOpacity:1,strokeWeight:4,zIndex:1e3,geodesic:!0}})]})}const fa=({selectedTrip:o,center:b,showCard:P})=>{var z,a,s,c;V();const{isLoaded:B,loadError:h}=ha({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"});R(t=>t.liveMap);const{singleTrip_Data:l,tripLoading:A}=R(t=>t.tripMonitor),T=d.useRef(null),[p,G]=d.useState(null),[v,C]=d.useState(null),[j,L]=d.useState([]);d.useState([]);const[x,y]=d.useState(!1),[f,S]=d.useState(0),[g,E]=d.useState(!1);d.useEffect(()=>{p&&v&&p.fitBounds(v)},[p,v,l]),d.useEffect(()=>{var t,u;if(l&&((t=l==null?void 0:l.documents)==null?void 0:t.length)>0){const r=new window.google.maps.LatLngBounds;(u=l==null?void 0:l.documents)==null||u.forEach(e=>{var D,k,U,K,Q,J,Y;const i=new window.google.maps.LatLng(parseFloat((D=e==null?void 0:e.data[0])==null?void 0:D.lat),parseFloat((k=e==null?void 0:e.data[0])==null?void 0:k.lng)),w=new window.google.maps.LatLng(parseFloat((K=e==null?void 0:e.data[((U=e==null?void 0:e.data)==null?void 0:U.length)-1])==null?void 0:K.lat),parseFloat((J=e==null?void 0:e.data[((Q=e==null?void 0:e.data)==null?void 0:Q.length)-1])==null?void 0:J.lng));r.extend(i),r.extend(w),S((Y=e==null?void 0:e.data[0])==null?void 0:Y.speed)}),C(r)}y(!1),O()},[l]);const O=()=>{if(l&&l.documents&&l.documents.length>0){const t=(e,i)=>{const D=new Date(e.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:e.createdAt.substring(0,10),Time:D,value:e[i]}},r=["speed","mainInputVoltage","ignition"].map(e=>({label:e==="speed"?"Speed":e==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:N(),data:l.documents[0].data.map(i=>t(i,e))}));L(r)}else L([])},N=()=>"#"+Math.floor(Math.random()*16777215).toString(16),$=()=>{var t;if(((t=l==null?void 0:l.documents)==null?void 0:t.length)>0)y(!x),S(0);else return Z.error("Please Select Trip",{id:"trip error"})},F=()=>{if(l!=null&&l.documents)E(!g);else return Z.error("Please Select Trip",{id:"trip error"})};if(h)return"Error loading maps";if(!B)return"Loading maps";const W={width:"100%",height:P?"87vh":"93vh"};return n.jsxs(n.Fragment,{children:[A&&n.jsx(M,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:n.jsx(ta,{})}),P&&n.jsxs(M,{sx:{bgcolor:X.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"left",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",height:"60px",gap:"15px",paddingLeft:"30px"},children:[n.jsxs(m,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:["Speed ",f," KM/H"]}),n.jsxs(q,{style:{height:"38px",padding:"5px 20px"},sx:{background:x?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:x?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{$()},children:[x?"Pause":"Play","-Trip"]}),n.jsxs(q,{style:{height:"38px",padding:"5px 20px"},sx:{background:g?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:g?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{F()},children:[g?"Hide":"Show","-Graph"]})]}),n.jsxs(ga,{ref:T,mapContainerStyle:W,zoom:10,center:b,onLoad:t=>G(t),children:[l&&((z=l==null?void 0:l.documents)==null?void 0:z.length)>0&&((a=l==null?void 0:l.documents)==null?void 0:a.map((t,u)=>{var r,e,i,w,D,k;return n.jsxs(sa.Fragment,{children:[n.jsx(I,{position:{lat:parseFloat((r=t==null?void 0:t.data[0])==null?void 0:r.lat),lng:parseFloat((e=t==null?void 0:t.data[0])==null?void 0:e.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}}),n.jsx(xa,{trip:t,tripPlay:x,setTripPlay:y,setSpeed:S}),n.jsx(I,{position:{lat:parseFloat((w=t==null?void 0:t.data[((i=t==null?void 0:t.data)==null?void 0:i.length)-1])==null?void 0:w.lat),lng:parseFloat((k=t==null?void 0:t.data[((D=t==null?void 0:t.data)==null?void 0:D.length)-1])==null?void 0:k.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}})]},u)})),n.jsx("div",{style:{position:"relative",top:320,left:15,color:"green"},children:((c=(s=j[0])==null?void 0:s.data)==null?void 0:c.length)>0&&g&&n.jsx(ua,{item:j})})]})]})},Sa=fa;function Da({filteredTrips:o,setFilteredTrips:b,setCenter:P,setSelectedTrip:B}){const{selectedVehicle:h}=R(a=>a.liveMap),{tripHistory:l}=R(a=>a.tripMonitor),[A,T]=d.useState(),[p,G]=d.useState(),[v,C]=d.useState(!1),[j,L]=d.useState(0),[x,y]=d.useState(),[f,S]=d.useState(),[g,E]=d.useState(0);let O=V();d.useEffect(()=>{!p&&!A&&b([]),N()},[p]),d.useEffect(()=>{var a;if(l&&((a=l==null?void 0:l.documents)==null?void 0:a.length)>0){const s=[];l.documents.forEach(c=>{let t;c.data.forEach(u=>{const r=u.createdAt.split("T")[0];t=s.find(e=>e.label===r),t||(t={label:r,data:[]},s.push(t))}),t.data.push({trip:t.data.length+1,tripData:c==null?void 0:c.data,startLocation:c==null?void 0:c.startLocation,endLocation:c==null?void 0:c.endLocation})}),b(s)}else l&&b([])},[l]),d.useEffect(()=>{o&&o.length>0&&(y(o[0].label),L(0))},[o]),d.useEffect(()=>{var a,s,c,t,u,r,e,i,w;if(o&&o.length>0){const D=(c=(s=(a=o[0])==null?void 0:a.data[0])==null?void 0:s.tripData[0])==null?void 0:c.startDate,k=(w=(i=(t=o[0])==null?void 0:t.data[0])==null?void 0:i.tripData[((e=(r=(u=o[0])==null?void 0:u.data[0])==null?void 0:r.tripData)==null?void 0:e.length)-1])==null?void 0:w.endDate,U={imei:h==null?void 0:h.imei,startDate:D,endDate:k};O(H({data:U}))}},[o]),d.useEffect(()=>{if(!o)return;const s=o.filter(c=>c.label===x).map(c=>c.data);s.length>0&&(S(s),E(0))},[x]);const N=async()=>{if(p&&Object.keys(h).length>0)try{C(!0);const a=aa(A+"12:00:00").toISOString(),s=aa(p+" 23:59:59").toISOString(),c={imei:h==null?void 0:h.imei,startDate:a,endDate:s};console.log("payload",c),S([]),await O(ea({data:c})),C(!1)}catch(a){C(!1),console.log("error in TripDetail",a)}},$=(a,s)=>{var c,t,u,r,e;if(E(a===g?null:a),B([s]),P({lat:(c=s==null?void 0:s.tripData[0])==null?void 0:c.lat,lng:(t=s==null?void 0:s.tripData[0])==null?void 0:t.lng}),p&&Object.keys(h).length>0){const i=(u=s==null?void 0:s.tripData[0])==null?void 0:u.startDate,w=(e=s==null?void 0:s.tripData[((r=s==null?void 0:s.tripData)==null?void 0:r.length)-1])==null?void 0:e.endDate,D={imei:h==null?void 0:h.imei,startDate:i,endDate:w};O(H({data:D}))}},F=(a,s)=>{var c,t,u,r,e,i;if(L(s),y(a.label),o&&o.length>0){const w=(t=(c=a==null?void 0:a.data[0])==null?void 0:c.tripData[0])==null?void 0:t.startDate,D=(i=(e=a==null?void 0:a.data[0])==null?void 0:e.tripData[((r=(u=a==null?void 0:a.data[0])==null?void 0:u.tripData)==null?void 0:r.length)-1])==null?void 0:i.endDate,k={imei:h==null?void 0:h.imei,startDate:w,endDate:D};O(H({data:k}))}},W=a=>{const s=new Date(a),c=s.getHours(),t=s.getMinutes(),u=c<10?`0${c}`:c,r=t<10?`0${t}`:t,e=c>=12?"PM":"AM";return`${u}:${r} ${e}`},z={marginLeft:"15px",fontWeight:"bold",fontSize:"18px",fontFamily:"ubuntu"};return n.jsxs("div",{style:{padding:"10px"},children:[n.jsx(ia,{setStartDate:T,setEndDate:G}),v?n.jsx("div",{style:{width:"100%",margin:"38%"},children:n.jsx(ta,{})}):n.jsxs(M,{className:"scrollbar-container",style:{display:"flex",overflowX:"auto",marginTop:"50px",marginBottom:"50px",gap:"10px",flexDirection:"column"},children:[n.jsxs(M,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px",alignItems:"center"},children:[!p&&n.jsx(m,{style:z,children:"Please Select Date"}),!v&&p&&o.length===0&&n.jsx(m,{style:z,children:"No Trip Found"}),o&&p&&o.map((a,s)=>n.jsx(M,{children:n.jsx(pa,{onClick:()=>{F(a,s)},style:{background:j===s?X.bgColor:"transparent",color:j===s?"white":"#666666",height:"45px",fontWeight:700,fontSize:"13px"},children:a.label})},s))]}),n.jsx(M,{style:{display:"flex",flexDirection:"column",height:"70vh"},children:x&&!v&&p&&f&&(f==null?void 0:f.length)>0&&f[0].map((a,s)=>{var c,t,u,r,e,i,w,D,k;return n.jsxs(M,{sx:{margin:"2px",border:"1px solid #E8E8E8",background:g===s?X.bgShadow:"transparent",color:g===s?"black":"#666666",borderRadius:"5px",padding:"12px","&:hover":{background:X.bgShadow,color:"black"}},onClick:()=>{g!==s&&($(s,a),E(s))},children:[n.jsxs(m,{children:[a.trip,".",((a==null?void 0:a.startLocation)||"").split(" ").slice(0,3).join(" ")," ","to"," ",((a==null?void 0:a.endLocation)||"").split(" ").slice(0,3).join(" ")]}),n.jsxs(m,{children:[W((c=a==null?void 0:a.tripData[0])==null?void 0:c.startDate)," /"," ",W((u=a==null?void 0:a.tripData[((t=a==null?void 0:a.tripData)==null?void 0:t.length)-1])==null?void 0:u.endDate)]}),n.jsxs(m,{children:["(",oa((r=a==null?void 0:a.tripData[0])==null?void 0:r.lat,(e=a==null?void 0:a.tripData[0])==null?void 0:e.lng,(w=a==null?void 0:a.tripData[((i=a==null?void 0:a.tripData)==null?void 0:i.length)-1])==null?void 0:w.lat,(k=a==null?void 0:a.tripData[((D=a==null?void 0:a.tripData)==null?void 0:D.length)-1])==null?void 0:k.lng)," ","km)"]})]},s)})})]})]})}function Fa(){const{w_customer_id:o}=R(g=>g.auth),{collapsed:b}=R(g=>g.auth),[P,B]=d.useState(!1),[h,l]=d.useState(!1),[A,T]=d.useState([]),[p,G]=d.useState(!1),[v,C]=d.useState([]),[j,L]=d.useState({lat:18.516726,lng:73.856255}),[x,y]=d.useState([]);let f=V();d.useEffect(()=>{S()},[]);const S=async()=>{let g=[],E=[];(await f(na({w_customer_id:o}))).payload.map(F=>{g.push({id:F.id,label:F.registration_id,value:F.imei[0].mac_id}),E.push(F.imei[0].mac_id)});const N="one",$=E;E.length>0&&f(la({type:N,imei:$})),T(g)};return n.jsxs("div",{className:"app",children:[n.jsx(ca,{}),n.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[n.jsx(da,{title:"Trip Monitor",setShowVehicles:B,showVehicles:P,setShowCard:l,showCard:h,sideBarTrip:p,setSideBarTrip:G}),n.jsxs(M,{style:{display:"flex",width:"100%",height:"95vh"},children:[n.jsx(M,{style:{width:P||p?"80%":"100%"},children:n.jsx(Sa,{center:j,showCard:h})}),P&&n.jsx(M,{style:{width:b?"25%":"20%"},children:n.jsx(ra,{vehicleData:A,title:"Live Monitor"})}),n.jsx(M,{style:{width:b?"25%":"20%",display:p?"block":"none"},children:n.jsx(Da,{setCenter:L,filteredTrips:v,setFilteredTrips:C,setSelectedTrip:y})})]})]})]})}export{Fa as default};
