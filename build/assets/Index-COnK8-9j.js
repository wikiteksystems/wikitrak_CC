import{J as ye,L as Me,M as be,w as he,r as a,N as Ce,D as ve,j as e,E as ke,I as Ae,t as Te,T as D,P as H,u as ue,a as B,ag as Pe,a5 as Le,_ as V,ah as pe,ai as De,aj as Fe,X as de,c as q,W as xe,ak as Ie,al as Ee,$ as fe,a0 as me,l as Re,m as Ne}from"./index-DwHu308G.js";import{L as Ye}from"./LightModeOutlined-Ck3lP4Di.js";import{L as _e}from"./LiveMapTopBar-oOsTEx4n.js";import{V as Oe}from"./VehicleMenu-BRFVGeTW.js";import{P as we,a as ge,u as Be,G as Ve,b as Ue}from"./esm-Bl2QDx92.js";import"./index-4iofaOUD.js";import{t as We}from"./3W-fvB8OITn.js";import{T as ze}from"./TripGraph-Ce8RMswX.js";import{B as j,C as je}from"./CircularProgress-n5HnSe5F.js";import{D as $e,d as Ge,a as He}from"./ArrowForwardIos-DB-AaWmn.js";import{t as Se}from"./RegionSelector-D6pjBFBy.js";import{M as qe}from"./Modal-Cs7fpFCT.js";import{C as Ke}from"./Card-DjpK9zwV.js";import{C as Xe}from"./CardContent-wyacEhlu.js";/* empty css           */import"./proj-XQwXs9DQ.js";import"./createSvgIcon-Bjx8o5hf.js";import"./IconButton-CSyoeEGl.js";import"./jcb-aCHXMCXy.js";import"./index-Dhv0-4XX.js";import"./index-Cb2th2CO.js";import"./OutlinedInput-BBEQN4mV.js";import"./Paper-xodoZ36R.js";function Je(n){return ye("MuiCardActions",n)}Me("MuiCardActions",["root","spacing"]);const Qe=["disableSpacing","className"],Ze=n=>{const{classes:f,disableSpacing:S}=n;return Ae({root:["root",!S&&"spacing"]},Je,f)},et=be("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(n,f)=>{const{ownerState:S}=n;return[f.root,!S.disableSpacing&&f.spacing]}})(({ownerState:n})=>he({display:"flex",alignItems:"center",padding:8},!n.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),tt=a.forwardRef(function(f,S){const m=Ce({props:f,name:"MuiCardActions"}),{disableSpacing:g=!1,className:b}=m,y=ve(m,Qe),k=he({},m,{disableSpacing:g}),P=Ze(k);return e.jsx(et,he({className:ke(P.root,b),ownerState:k,ref:S},y))}),st=tt;function ot({trip:n,tripPlay:f,setTripPlay:S,setSpeed:m}){const[g,b]=a.useState([]),[y,k]=a.useState(0),[P,t]=a.useState([]),[L,A]=a.useState([null]),$=a.useRef(null);a.useEffect(()=>{A([null]);const w=[];if(n&&n.length>0&&(n==null||n.map(r=>{w.push(r.speed).toFixed(2)}),t(w)),n&&(n==null?void 0:n.length)>0){const r=n==null?void 0:n.map(v=>({lat:parseFloat(v.lat),lng:parseFloat(v.lng)}));b(r),A(r.slice(0))}},[n]),a.useEffect(()=>{if(f){const w=g.length,r=9e3,v=1e4,N=performance.now();let F=0;const I=u=>{const Y=u-N,_=Math.max(0,Math.min(Y/r,1)),E=Math.min(Math.floor(_*w),w-1);E!==$.current&&(k(E),m(P[E]),$.current=E),F<v&&(requestAnimationFrame(I),F++)};return requestAnimationFrame(I),()=>{}}},[f]);const M=a.useMemo(()=>{var w,r;return{lat:parseFloat((w=g[y])==null?void 0:w.lat),lng:parseFloat((r=g[y])==null?void 0:r.lng)}},[g,y]),U=a.useMemo(()=>({url:We,size:new window.google.maps.Size(35,35),scaledSize:new window.google.maps.Size(35,35),fillOpacity:2,strokeWeight:1,scale:2}),[]);return e.jsxs("div",{children:[L.length>0&&e.jsx(e.Fragment,{children:e.jsx(we,{path:L,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4}})}),f&&e.jsxs(e.Fragment,{children:[e.jsx(we,{path:g.slice(0,y+1),options:{strokeColor:"green",strokeOpacity:1,strokeWeight:4,zIndex:1e3,geodesic:!0}}),e.jsx(ge,{position:M,icon:U},y)]})]})}function nt({tripPlay:n,speed:f,totalDistance:S,Acreage:m,filterCoordinates:g,handleTrip:b,showGraph:y,handleShowGraph:k}){return e.jsxs(j,{sx:{bgcolor:Te.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",gap:"5px",paddingLeft:"5px",padding:"10px 10px"},children:[e.jsxs(j,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px",width:"150px",display:"flex",justifyContent:"space-evenly"},children:[e.jsx(D,{children:"Speed"}),e.jsxs(D,{children:[n?f:0," KM/H"]})]}),e.jsxs(D,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px"},children:["Total-Distance ",S," KM"]}),e.jsxs(D,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:[parseFloat(m).toFixed(2)," acre"]}),e.jsxs(H,{sx:{background:"white",border:"1px solid white",borderRadius:"5px",padding:"5px 20px",color:"black"},onClick:()=>{g()},children:[" ","Calculate Acerage"]}),e.jsxs(H,{sx:{background:n?"transparent":"white",border:"1px solid white",borderRadius:"5px",height:"38px",padding:"5px 20px",color:n?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{b()},children:[n?"Pause":"Play","-Trip"]}),e.jsxs(H,{style:{height:"38px",padding:"5px 20px"},sx:{background:y?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:y?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{k()},children:[y?"Hide":"Show","-Graph"]})]})}const at=({selectedTrip:n,center:f,showCard:S})=>{var K,X;const m=ue(),{isLoaded:g,loadError:b}=Be({googleMapsApiKey:"AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA"}),{Acreage:y}=B(s=>s.tripMonitor);B(s=>s.liveMap);const{singleTrip_Data:k,tripLoading:P}=B(s=>s.tripMonitor),{selectedTripData:t,mode:L,styles:A}=B(s=>s.dashboard),$=a.useRef(null),[M,U]=a.useState(null),[w,r]=a.useState(null),[v,N]=a.useState([]);a.useState([]);const[F,I]=a.useState(!1),[u,Y]=a.useState(0),[_,E]=a.useState(!1),[G,se]=a.useState(0),[oe,ne]=a.useState([]),[ae,re]=a.useState([]);a.useState([]),a.useEffect(()=>{M&&w&&M.fitBounds(w)},[M,w,t]),a.useEffect(()=>{if(console.log("selectedTripData",t),(t==null?void 0:t.length)>0){const s=le({selectedTripData:t});se(s)}},[t]);const le=({selectedTripData:s})=>{const d=s.reduce((l,c,i)=>{if(i===0)return l;const x=s[i-1],p=Pe(x.lat,x.lng,c.lat,c.lng);return l+p},0);return d==null?void 0:d.toFixed(2)};a.useEffect(()=>{var s,d,l,c,i;if(t&&(t==null?void 0:t.length)>0){const x=new window.google.maps.LatLngBounds,p=new window.google.maps.LatLng(parseFloat((s=t[0])==null?void 0:s.lat),parseFloat((d=t[0])==null?void 0:d.lng)),C=new window.google.maps.LatLng(parseFloat((l=t[(t==null?void 0:t.length)-1])==null?void 0:l.lat),parseFloat((c=t[(t==null?void 0:t.length)-1])==null?void 0:c.lng));x.extend(p),x.extend(C),Y((i=t[0])==null?void 0:i.speed),r(x)}I(!1),J()},[t]);const J=()=>{if(t&&t.length>0){const s=(c,i)=>{const p=new Date(c.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:c.createdAt.substring(0,10),Time:p,value:c[i]}},l=["speed","mainInputVoltage","ignition"].map(c=>({label:c==="speed"?"Speed":c==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:Q(),data:t.map(i=>s(i,c))}));N(l)}else N([])},Q=()=>"#"+Math.floor(Math.random()*16777215).toString(16),Z=()=>{var s;if((t==null?void 0:t.length)>0)I(!F),Y(0);else return((s=Object.keys(t))==null?void 0:s.length)===0?V.error("Please Select Vehicle",{id:"vehicle"}):V.error("Please Select Trip",{id:"trip error"})},ee=()=>{var s;if((t==null?void 0:t.length)>0)E(!_);else return((s=Object.keys(t))==null?void 0:s.length)===0?V.error("Please Select Vehicle",{id:"vehicle"}):V.error("Please Select Trip",{id:"trip error"})};if(b)return"Error loading maps";if(!g)return"Loading maps";const o={width:"100%",height:S?"87vh":"93vh"},h=s=>{if(!window.google||!window.google.maps.geometry){console.log("not loaded");return}const l=window.google.maps.geometry.spherical.computeArea(s.getPath())/4046.86;m(pe(l))},T=()=>{const l=[];t.length>0&&t.map((i,x)=>{let p={latitude:i.lat,longitude:i.lng},C=[];t.map(R=>{const z={latitude:R.lat,longitude:R.lng};if(z.latitude!==p.latitude&&z.longitude!==p.longitude){const ce=te(i.lat,i.lng,R.lat,R.lng);ce<20&&ce>10&&C.push(R)}}),C.length>10&&l.push(i)});const c=l.map(i=>({lat:parseFloat(i.lat),lng:parseFloat(i.lng)}));if(l&&l.length>0){re(l);const i=ie(c),x=O(i),p=new window.google.maps.Polygon({paths:x});h(p)}else m(pe(0))},O=s=>{s.sort((c,i)=>c.lng-i.lng||c.lat-i.lat);const d=[],l=[];for(const c of s){for(;d.length>=2&&W(d[d.length-2],d[d.length-1],c)<=0;)d.pop();d.push(c)}for(let c=s.length-1;c>=0;c--){const i=s[c];for(;l.length>=2&&W(l[l.length-2],l[l.length-1],i)<=0;)l.pop();l.push(i)}return[...d.slice(0,-1),...l.slice(0,-1)]},W=(s,d,l)=>(d.lat-s.lat)*(l.lng-s.lng)-(d.lng-s.lng)*(l.lat-s.lat),ie=s=>{const d=(p,C,R)=>{const z=(C.lat-p.lat)*(R.lng-C.lng)-(C.lng-p.lng)*(R.lat-C.lat);return z===0?0:z>0?1:2},l=s.reduce((p,C)=>C.lng<p.lng?C:p);let c=[],i=l,x;do{c.push(i),x=s[0]===i?s[1]:s[0];for(let p=0;p<s.length;p++)d(i,x,s[p])===2&&(x=s[p]);i=x}while(i!==l);return c};function te(s,d,l,c){const x=s*Math.PI/180,p=l*Math.PI/180,C=(l-s)*Math.PI/180,R=(c-d)*Math.PI/180,z=Math.sin(C/2)*Math.sin(C/2)+Math.cos(x)*Math.cos(p)*Math.sin(R/2)*Math.sin(R/2);return 6371e3*(2*Math.atan2(Math.sqrt(z),Math.sqrt(1-z)))}return e.jsxs(e.Fragment,{children:[P&&e.jsx(j,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:e.jsx(je,{})}),S&&e.jsx(nt,{tripPlay:F,speed:u,totalDistance:G,Acreage:y,filterCoordinate:T,handleTrip:Z,showGraph:_,handleShowGraph:ee}),e.jsxs(Ve,{ref:$,mapContainerStyle:o,zoom:10,center:f,onLoad:s=>U(s),options:{styles:L?A:""},children:[e.jsx(Ue,{paths:oe,options:{fillColor:"#00FF00",fillOpacity:.4,strokeColor:"#000",strokeOpacity:1,strokeWeight:2}}),t&&(t==null?void 0:t.length)>0&&(t==null?void 0:t.map((s,d)=>{var l,c,i,x;return e.jsxs(Le.Fragment,{children:[e.jsx(ge,{position:{lat:parseFloat((l=t[0])==null?void 0:l.lat),lng:parseFloat((c=t[0])==null?void 0:c.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}}),e.jsx(ot,{trip:t,tripPlay:F,setTripPlay:I,setSpeed:Y}),e.jsx(ge,{position:{lat:parseFloat((i=t[(t==null?void 0:t.length)-1])==null?void 0:i.lat),lng:parseFloat((x=t[(t==null?void 0:t.length)-1])==null?void 0:x.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}})]},d)})),e.jsx("div",{style:{position:"relative",top:320,left:15,color:"green"},children:((X=(K=v[0])==null?void 0:K.data)==null?void 0:X.length)>0&&_&&e.jsx(ze,{item:v})})]})]})},rt=at,lt=()=>{var J,Q,Z,ee;const n=ue(),{tripList:f,selectedTripData:S,loading:m,trips:g,activeIndex:b,searchText:y,mode:k,isNavigate:P,allTripList:t,trip_payload:L,page:A}=B(o=>o.dashboard),{selectedVehicle:$}=B(o=>o.liveMap),M=Se(k),[U,w]=a.useState(!1),[r,v]=a.useState({}),[N,F]=a.useState(""),[I,u]=a.useState(0);a.useEffect(()=>{console.log("trips",g),(g==null?void 0:g.length)>0&&F(g[0])},[g]),a.useEffect(()=>{console.log("allTripList",t);const o=_(t);n(De(o))},[t]),a.useEffect(()=>{!(S.length>0)&&P&&b!==null&&G.length>0&&Y(G[b])},[S,P]);const Y=async o=>{var O;let h={imei:$.imei,startDate:o.startDate,endDate:o.endDate};const T=await Fe(h);((O=T==null?void 0:T.data)==null?void 0:O.documents.length)>0?(n(P(!1)),n(de(T.data.documents[0].data))):(n(P(!1)),n(de([])))},_=o=>{const h=new Set,T=[];return o.forEach(O=>{const W=q(O.startTime).format("YYYY-MM-DD");h.has(W)||(h.add(W),T.push(W))}),T},E=(o,h)=>{n(xe(null)),n(Ie(o)),n(Ee(!1)),F(o),u(h)},G=t.filter(o=>q(o.startTime).format("YYYY-MM-DD")===N),se=async(o,h)=>{n(de(h.data)),n(xe(o)),n(pe(0))},oe=o=>{v(o),w(!0)},ne=()=>{w(!1),v({})},ae=o=>o?o.split(" ").slice(0,2).join(" "):"",re=async()=>{const o={...L,page:A+1};try{(await n(fe(o))).error?V.error("No Trip! within selected date"):n(me(A+1))}catch{V.error("No Trip! within selected date")}},le=()=>{if(A<=1)return;const o={...L,page:A-1};n(me(A-1)),n(fe(o))};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsxs(j,{children:[e.jsx(j,{sx:{color:M.grey[400]},children:"Select Date"}),e.jsx(j,{sx:{mt:1},children:e.jsx($e,{})})]}),m?e.jsx("div",{style:{width:"100%",margin:"38%"},children:e.jsx(je,{})}):e.jsxs(e.Fragment,{children:[e.jsx(j,{children:e.jsx(j,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:t&&(t==null?void 0:t.length)>0?e.jsx(e.Fragment,{children:g.map((o,h)=>e.jsx(j,{children:e.jsx(H,{onClick:()=>{E(o,h)},style:{backgroundColor:I===h?M.grey[300]:M.grey[200],color:I===h?"black":M.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:o})},h))}):e.jsx(D,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),e.jsxs(j,{sx:{height:"70vh",width:"100%",overflowY:"auto"},children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(H,{disabled:A<=1,onClick:le,children:e.jsx(Ge,{})}),e.jsx(H,{disabled:!(L!=null&&L.imei),onClick:re,children:e.jsx(He,{})})]}),G&&G.length>0&&G.map((o,h)=>{var te,K,X,s;const T=(K=(te=o==null?void 0:o.startLocation)==null?void 0:te.address)==null?void 0:K.address,O=(s=(X=o==null?void 0:o.endLocation)==null?void 0:X.address)==null?void 0:s.address,W=T?`${T.town||T.city||""}`:"",ie=O?`${O.town||O.city||""}`:"";return e.jsxs(j,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:b===h?"black":M.grey[400],backgroundColor:b===h?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:k?M.grey[300]:M.grey[200]}},onClick:()=>se(h,o),children:[e.jsxs(D,{sx:{cursor:"text"},children:[h+1,". ",ae(W)," to"," ",ae(ie)," ",e.jsx("span",{style:{color:k?"orange":"blue",cursor:"pointer"},onClick:d=>{d.stopPropagation(),oe(o)},children:"...see more"})]}),e.jsxs(D,{children:[o!=null&&o.startTime?q(new Date(o.startTime).toISOString()).format("LT"):""," ","/"," ",o!=null&&o.endTime?q(new Date(o.endTime).toISOString()).format("LT"):"----"]})]},h)})]})]})]}),e.jsx(qe,{open:U,onClose:ne,children:e.jsxs(Ke,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[e.jsxs(Xe,{children:[e.jsx(D,{variant:"h6",component:"div",children:"Trip Details"}),e.jsxs(D,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Location:"})," ",((Q=(J=r==null?void 0:r.startLocation)==null?void 0:J.address)==null?void 0:Q.display_name)||"N/A"]}),e.jsxs(D,{sx:{mt:2},children:[e.jsx("strong",{children:"End Location:"})," ",((ee=(Z=r==null?void 0:r.endLocation)==null?void 0:Z.address)==null?void 0:ee.display_name)||"N/A"]}),e.jsxs(D,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Time:"})," ",r!=null&&r.startTime?q(new Date(r.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),e.jsxs(D,{sx:{mt:2},children:[e.jsx("strong",{children:"End Time:"})," ",r!=null&&r.endTime?q(new Date(r.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),e.jsx(st,{children:e.jsx(H,{onClick:ne,children:"Close"})})]})})]})},it=lt;function It(){const{w_customer_id:n}=B(r=>r.auth),{collapsed:f}=B(r=>r.auth),{mode:S}=B(r=>r.dashboard),[m,g]=a.useState(!1),[b,y]=a.useState(!0),[k,P]=a.useState([]),[t,L]=a.useState(!1);a.useState([]);const[A,$]=a.useState({lat:18.516726,lng:73.856255});a.useState([]);const M=Se(S);let U=ue();a.useEffect(()=>{w()},[]);const w=async()=>{try{let r=[],v=[];const N=await U(Re({w_customer_id:n}));if(Array.isArray(N.payload)){N.payload.forEach(u=>{var Y,_,E;Array.isArray(u.imei)&&u.imei.length>0&&((Y=u.imei[0])!=null&&Y.mac_id)?(r.push({id:u.id,label:u.registration_id,value:(_=u.imei[0])==null?void 0:_.mac_id,workShop:u==null?void 0:u.workshop}),v.push((E=u.imei[0])==null?void 0:E.mac_id)):(console.error("IMEI data not found for item:",u),V.error(`IMEI Number not found for the vehicle: ${u==null?void 0:u.registration_id}`))});const F="one",I=v;v.length>0&&U(Ne({type:F,imei:I})),P(r)}else console.error("Unexpected data format:",N),V.error("Unexpected data format:")}catch(r){console.error("Error fetching vehicle data:",r),V.error(`Error fetching vehicle data: ${r}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(Ye,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(_e,{title:"Trip Monitor",setShowVehicles:g,showVehicles:m,setShowCard:y,showCard:b,sideBarTrip:t,setSideBarTrip:L}),e.jsxs(j,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(j,{style:{width:m||t?"80%":"100%"},children:e.jsx(rt,{center:A,showCard:b})}),m&&e.jsx(j,{style:{width:"20%",backgroundColor:M.grey[100]},children:e.jsx(Oe,{vehicleData:k,title:"Live Monitor"})}),e.jsx(j,{style:{width:f?"22%":"20%",display:t?"block":"none",backgroundColor:M.grey[100]},children:e.jsx(it,{})})]})]})]})}export{It as default};
