import{i as V,j as e,a as w,u as N,t as x,T as _,a7 as xe,a8 as ve,r as s,v as fe,O as G,a9 as Z,k as me,l as ge}from"./index-aWVyNFdz.js";import{L as je}from"./LightModeOutlined-YfS23p7q.js";import{L as be}from"./LiveMapTopBar-DNZSmFnU.js";import{V as Se}from"./VehicleMenu-C-fmz-ol.js";import{u as ye,G as _e,M as ee}from"./esm-B2TNW_n2.js";import we from"./Loader-Dse11Gno.js";import{r as M}from"./createSvgIcon-S0yIrnfq.js";import{B as c}from"./CircularProgress-B5CBkM-P.js";import{s as B}from"./Socket-0N_gnJcr.js";import{P as Ve}from"./Parameters-D30JV4pR.js";import{t as Me}from"./theme-RPmPHUCj.js";import"./Search-CWBvErjU.js";import"./index-yx7Hnk-O.js";import"./roundedArrow-C8BAk40u.js";import"./TextArea-CgVo-FS6.js";import"./IconButton-D59FS7b8.js";import"./index-C97nd8B7.js";import"./Card-OWd4Q-EE.js";import"./Paper-DtcAkWEm.js";var T={},Le=V;Object.defineProperty(T,"__esModule",{value:!0});var te=T.default=void 0,Ce=Le(M()),De=e;te=T.default=(0,Ce.default)((0,De.jsx)("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4"}),"Restaurant");var W={},$e=V;Object.defineProperty(W,"__esModule",{value:!0});var ae=W.default=void 0,He=$e(M()),Pe=e;ae=W.default=(0,He.default)((0,Pe.jsx)("path",{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3m12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4"}),"Hotel");var X={},Re=V;Object.defineProperty(X,"__esModule",{value:!0});var se=X.default=void 0,ke=Re(M()),Oe=e;se=X.default=(0,ke.default)((0,Oe.jsx)("path",{d:"m19.77 7.23.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77M12 10H6V5h6zm6 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalGasStation");var U={},ze=V;Object.defineProperty(U,"__esModule",{value:!0});var oe=U.default=void 0,Ee=ze(M()),Ie=e;oe=U.default=(0,Ee.default)((0,Ie.jsx)("path",{d:"M16.22 12c.68 0 1.22-.54 1.22-1.22 0-.67-.54-1.22-1.22-1.22S15 10.11 15 10.78c0 .68.55 1.22 1.22 1.22m-9.66-1.22c0 .67.54 1.22 1.22 1.22S9 11.46 9 10.78c0-.67-.54-1.22-1.22-1.22s-1.22.55-1.22 1.22M7.61 4 6.28 8h11.43l-1.33-4zm8.67-1s.54.01.92.54c.02.02.03.04.05.07.07.11.14.24.19.4.22.65 1.56 4.68 1.56 4.68v6.5c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81V14H7v1.19c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81v-6.5S6.34 4.67 6.55 4c.05-.16.12-.28.19-.4.03-.02.04-.04.06-.06.38-.53.92-.54.92-.54zM4 17.01h16V19h-7v3h-2v-3H4z"}),"CarRepair");var J={},Ae=V;Object.defineProperty(J,"__esModule",{value:!0});var re=J.default=void 0,qe=Ae(M()),Fe=e;re=J.default=(0,qe.default)((0,Fe.jsx)("path",{d:"M21 5h-2.64l1.14-3.14L17.15 1l-1.46 4H3v2l2 6-2 6v2h18v-2l-2-6 2-6zm-3.9 8.63L18.89 19H5.11l1.79-5.37.21-.63-.21-.63L5.11 7h13.78l-1.79 5.37-.21.63zM13 9h-2v3H8v2h3v3h2v-3h3v-2h-3z"}),"LocalPharmacyOutlined");var K={},Ge=V;Object.defineProperty(K,"__esModule",{value:!0});var ie=K.default=void 0,Be=Ge(M()),Ne=e;ie=K.default=(0,Be.default)((0,Ne.jsx)("path",{d:"M8 9v1.5h2.25V15h1.5v-4.5H14V9zM6 9H3c-.55 0-1 .45-1 1v5h1.5v-1.5h2V15H7v-5c0-.55-.45-1-1-1m-.5 3h-2v-1.5h2zM21 9h-4.5c-.55 0-1 .45-1 1v5H17v-4.5h1V14h1.5v-3.51h1V15H22v-5c0-.55-.45-1-1-1"}),"AtmOutlined");const Te=({setPlace:v,place:r})=>{const{center:L}=w(u=>u.liveMap),h=N(),p=async u=>{r===u?(h(xe([])),v("")):(v(u),h(ve({center:L,clickedPlace:u})))};return e.jsxs(c,{sx:{position:"absolute",top:"1vh",left:"20%",display:"flex",justifyContent:"center"},children:[e.jsx(c,{sx:{bgcolor:r==="restaurants"?x.bgColor:"white",color:r==="restaurants"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{p("restaurants")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(te,{style:{height:"17px",position:"relative",top:"1px"}}),"Restaurants"]})}),e.jsx(c,{sx:{bgcolor:r==="hotels"?x.bgColor:"white",color:r==="hotels"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{p("hotels")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(ae,{style:{height:"17px",position:"relative",top:"1px"}}),"Hotels"]})}),e.jsx(c,{sx:{bgcolor:r==="hospitals"?x.bgColor:"white",color:r==="hospitals"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{p("hospitals")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(re,{style:{height:"17px",position:"relative",top:"1px"}}),"Hospitals"]})}),e.jsx(c,{sx:{bgcolor:r==="atm"?x.bgColor:"white",color:r==="atm"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{p("atm")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(ie,{style:{height:"17px",position:"relative",top:"1px"}}),"ATMs"]})}),e.jsx(c,{sx:{bgcolor:r==="car_repair"?x.bgColor:"white",color:r==="car_repair"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{p("car_repair")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(oe,{style:{height:"17px",position:"relative",top:"1px"}}),"Service center"]})}),e.jsx(c,{sx:{bgcolor:r==="gasstation"?x.bgColor:"white",color:r==="gasstation"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{p("gasstation")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(se,{style:{height:"17px",position:"relative",top:"1px"}}),"Gas Stations"]})})]})},We=Te;function Xe({showCard:v}){const{center:r,selectedParameterList:L,selectedVehicle:h,vehicleList:p,icons:u,locationData:f,placesData:C,imeiNumbers:Q,onlineVehicle:m}=w(t=>t.liveMap),{mode:D,styles:A}=w(t=>t.dashboard),[$,q]=s.useState(null),[b,H]=s.useState(""),[P,O]=s.useState([]),[S,z]=s.useState([]),[g,l]=s.useState(),[i,y]=s.useState(),R=N(),{isLoaded:j,loadError:d}=ye({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU",loadingElement:e.jsx(we,{})});if(s.useEffect(()=>{j&&q(window.google.maps)},[j]),s.useEffect(()=>{l(f)},[f]),s.useEffect(()=>{y(L)},[L]),s.useEffect(()=>(B.on("locationinfo",t=>{if(console.log("locationinfo",t),g.map(o=>{if(o.latestDocument.imei===t.imei){const a={lat:o.latestDocument.lat,lng:o.latestDocument.lng},n=500,E=60,F=n/(1e3/E),le=(t.lat-a.lat)/F,ne=(t.lng-a.lng)/F;let I=0;const ce=setInterval(()=>{const pe=a.lat+le*I,he=a.lng+ne*I,ue={...o,latestDocument:{...o.latestDocument,lat:pe,lng:he}};I++,I>=F&&clearInterval(ce),l(de=>de.map(Y=>Y.latestDocument.imei===t.imei?ue:Y))},1e3/E)}return o}),String(t==null?void 0:t.imei)===String(i[0].imei)){const o=i[0].params.map(a=>{let n=a.label;return{...a,value:t[n]}});y([{...i[0],params:o}])}}),()=>{B.off("locationinfo")}),[B,g]),s.useEffect(()=>{R(fe({}))},[h]),s.useEffect(()=>{if(f.length>0&&m.length>0){const t=[],o=[];f.forEach(a=>{m.some(E=>String(E)===String(a._id))?t.push(a):o.push(a)}),O(t),z(o)}else O([]),z([])},[f,m]),s.useEffect(()=>{console.log("onVehicles",P),console.log("offVehicles",S)},[P]),d)return"Error loading maps";if(!j)return"Loading maps";if(!$)return null;const k={height:v?"87vh":"95vh",width:"100%"};return e.jsxs(e.Fragment,{children:[v&&e.jsx(c,{sx:{bgcolor:x.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:i[0].params.length>0?e.jsxs(e.Fragment,{children:[i[0].params.length>0&&e.jsxs(G,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",i[0].reg_id]}),i.length>0&&i[0].params.map((t,o)=>(console.log("item",t),e.jsx(G,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:t.label==="speed"?`${t.label} : ${t.value} km/h`:t.label==="mainInputVoltage"?`${t.label} : ${t.value} voltage`:t.label==="ignition"?`${t.label} : ${t.value===!0?"On":"Off"}`:`${t.label} : ${t.value}`},o)))]}):e.jsx(e.Fragment,{children:e.jsx(G,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})}),e.jsxs(_e,{mapContainerStyle:k,zoom:10,center:r,options:{styles:D?A:""},children:[Object.keys(h).length>0&&e.jsx(We,{setPlace:H,place:b}),C&&C.length>0&&C.map((t,o)=>{var a,n;return e.jsx(ee,{position:{lat:parseFloat((a=t==null?void 0:t.location)==null?void 0:a.lat),lng:parseFloat((n=t==null?void 0:t.location)==null?void 0:n.lng)},animation:"BOUNCE",icon:{path:u[`${b}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},o)}),g&&g.length>0&&g.map((t,o)=>e.jsx(ee,{position:{lat:t.latestDocument.lat,lng:t.latestDocument.lng},icon:{path:Ue.path1,fillColor:Object.keys(h).length>0&&h.imei===t.latestDocument.imei?"green":x.bgColor,fillOpacity:2,strokeWeight:1,scale:2}},o))]})]})}const Ue={path1:"M20 11c-.18 0-.36.03-.53.05L17.41 9H20V6l-3.72 1.86L13.41 5H9v2h3.59l2 2H11l-4 2-2-2H0v2h4c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4l2 2h3l3.49-6.1 1.01 1.01c-.91.73-1.5 1.84-1.5 3.09 0 2.21 1.79 4 4 4s4-1.79 4-4-1.79-4-4-4M4 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m16 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"};function xt(){const{locationData:v,selectedVehicle:r,selectedParameterList:L}=w(l=>l.liveMap),{mode:h}=w(l=>l.dashboard),p=Me(h),[u,f]=s.useState([]),{w_customer_id:C}=w(l=>l.auth),[Q,m]=s.useState(),[D,A]=s.useState(!1),[$,q]=s.useState(!1),[b,H]=s.useState([]),[P,O]=s.useState(!1);let S=N();s.useEffect(()=>{z()},[]),s.useEffect(()=>{H([]),S(Z([{reg_id:"",imei:"",params:[]}]))},[r]);const z=async()=>{let l=[],i=[];(await S(me({w_customer_id:C}))).payload.map(d=>{l.push({id:d.id,label:d.registration_id,value:d.imei[0].mac_id}),i.push(d.imei[0].mac_id)});const R="one",j=i;i.length>0&&S(ge({type:R,imei:j})),f(l)},g=async l=>{const{label:i,imei:y,_id:R,reg_id:j,checked:d}=l;m(a=>a.map(n=>n._id===R?{...n,checked:!d}:n));let k=[...b],t=[...b];if(!d)v.forEach(a=>{a.latestDocument.imei===y&&(k.push({label:i,value:a.latestDocument[i]}),t=k,H(k))});else{let a=b.filter(n=>n.label!==i);t=a,H(a)}console.log("tempParamList",t),S(Z([{reg_id:j,imei:y,params:t}]))};return e.jsxs("div",{className:"app",children:[e.jsx(je,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(be,{title:"Live Map",setShowVehicles:A,showVehicles:D,showParameters:$,setShowParameters:q,setShowCard:O,showCard:P}),e.jsxs(c,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(c,{style:{width:D||$?"80%":"100%"},children:e.jsx(Xe,{showCard:P})}),D&&e.jsx(c,{style:{width:"20%",backgroundColor:p.grey[100]},children:e.jsx(Se,{vehicleData:u,title:"Live Map",setParameterData:m})}),$&&e.jsx(c,{style:{width:"20%",backgroundColor:p.grey[100]},children:e.jsx(Ve,{parametersData:Q,setParameterData:m,handleParameterChange:g})})]})]})]})}export{xt as default};
