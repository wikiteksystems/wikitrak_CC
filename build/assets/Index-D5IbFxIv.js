import{r as c,j as n,u as V,a as m,t as X,T as O,B as q,R as ta,_ as Z,Q as H,S as sa,U as ea,n as oa,o as na}from"./index-82UQ7N0y.js";import{L as la}from"./Close-CEshFBiu.js";import{L as ca}from"./LiveMapTopBar-CDW1TFn_.js";import{V as da}from"./VehicleMenu-Dmv8Ln1o.js";import{P as _,u as ra,G as ha,a as I}from"./esm-d9adJaLt.js";import{T as ga,D as ua}from"./DateTimePicker-DKWEGI2e.js";import{B as M,C as aa}from"./CircularProgress-BF_Dc4W8.js";import{B as ia}from"./button-CLDMulo2.js";import"./createSvgIcon-B_zrMQMU.js";import"./createSvgIcon-BSMykeJ2.js";import"./index-DgiN1u7U.js";import"./OutlinedInput-Czs0r2xQ.js";import"./IconButton-BO2TCzBO.js";function pa({trip:e,tripPlay:y,setTripPlay:P,setSpeed:B}){const[h,l]=c.useState([]),[A,T]=c.useState(0),[p,G]=c.useState([]),[v,C]=c.useState([null]);return c.useEffect(()=>{var S;B((S=e==null?void 0:e.data[2])==null?void 0:S.speed)},[e]),c.useEffect(()=>{var L,x,b,w;C([null]);const S=[];if(e&&(e!=null&&e.data)&&((L=e==null?void 0:e.data)==null?void 0:L.length)>0&&((x=e==null?void 0:e.data)==null||x.map(D=>{S.push(D.speed).toFixed(2)}),G(S)),e&&(e!=null&&e.data)&&((b=e==null?void 0:e.data)==null?void 0:b.length)>0){const D=(w=e==null?void 0:e.data)==null?void 0:w.map(g=>({lat:parseFloat(g.lat),lng:parseFloat(g.lng)}));l(D),C(D.slice(0))}},[e]),c.useEffect(()=>{if(y){const S=h.length,L=9e3,x=1e4,b=L/x;let w=0;const D=setInterval(()=>{if(w<x){const g=w/x,E=Math.floor(g*S);T(E),B(p[E]),w++}else clearInterval(D)},b);return()=>clearInterval(D)}},[y]),n.jsxs("div",{children:[v.length>0&&n.jsx(n.Fragment,{children:n.jsx(_,{path:v,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4}})}),y&&n.jsx(_,{path:h.slice(0,A+1),options:{strokeColor:"green",strokeOpacity:1,strokeWeight:4,zIndex:1e3,geodesic:!0}})]})}const xa=({selectedTrip:e,center:y,showCard:P})=>{var z,a,o,d;V();const{isLoaded:B,loadError:h}=ra({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"});m(t=>t.liveMap);const{singleTrip_Data:l,tripLoading:A}=m(t=>t.tripMonitor),T=c.useRef(null),[p,G]=c.useState(null),[v,C]=c.useState(null),[S,L]=c.useState([]);c.useState([]);const[x,b]=c.useState(!1),[w,D]=c.useState(0),[g,E]=c.useState(!1);c.useEffect(()=>{p&&v&&p.fitBounds(v)},[p,v,l]),c.useEffect(()=>{var t,u;if(l&&((t=l==null?void 0:l.documents)==null?void 0:t.length)>0){const r=new window.google.maps.LatLngBounds;(u=l==null?void 0:l.documents)==null||u.forEach(s=>{var f,k,U,K,Q,J,Y;const i=new window.google.maps.LatLng(parseFloat((f=s==null?void 0:s.data[0])==null?void 0:f.lat),parseFloat((k=s==null?void 0:s.data[0])==null?void 0:k.lng)),j=new window.google.maps.LatLng(parseFloat((K=s==null?void 0:s.data[((U=s==null?void 0:s.data)==null?void 0:U.length)-1])==null?void 0:K.lat),parseFloat((J=s==null?void 0:s.data[((Q=s==null?void 0:s.data)==null?void 0:Q.length)-1])==null?void 0:J.lng));r.extend(i),r.extend(j),D((Y=s==null?void 0:s.data[0])==null?void 0:Y.speed)}),C(r)}b(!1),R()},[l]);const R=()=>{if(l&&l.documents&&l.documents.length>0){const t=(s,i)=>{const f=new Date(s.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:s.createdAt.substring(0,10),Time:f,value:s[i]}},r=["speed","mainInputVoltage","ignition"].map(s=>({label:s==="speed"?"Speed":s==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:N(),data:l.documents[0].data.map(i=>t(i,s))}));L(r)}else L([])},N=()=>"#"+Math.floor(Math.random()*16777215).toString(16),$=()=>{var t;if(((t=l==null?void 0:l.documents)==null?void 0:t.length)>0)b(!x),D(0);else return Z.error("Please Select Trip",{id:"trip error"})},F=()=>{if(l!=null&&l.documents)E(!g);else return Z.error("Please Select Trip",{id:"trip error"})};if(h)return"Error loading maps";if(!B)return"Loading maps";const W={width:"100%",height:P?"87vh":"93vh"};return n.jsxs(n.Fragment,{children:[A&&n.jsx(M,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:n.jsx(aa,{})}),P&&n.jsxs(M,{sx:{bgcolor:X.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"left",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",height:"60px",gap:"15px",paddingLeft:"30px"},children:[n.jsxs(O,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:["Speed ",w," KM/H"]}),n.jsxs(q,{style:{height:"38px",padding:"5px 20px"},sx:{background:x?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:x?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{$()},children:[x?"Pause":"Play","-Trip"]}),n.jsxs(q,{style:{height:"38px",padding:"5px 20px"},sx:{background:g?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:g?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{F()},children:[g?"Hide":"Show","-Graph"]})]}),n.jsxs(ha,{ref:T,mapContainerStyle:W,zoom:10,center:y,onLoad:t=>G(t),children:[l&&((z=l==null?void 0:l.documents)==null?void 0:z.length)>0&&((a=l==null?void 0:l.documents)==null?void 0:a.map((t,u)=>{var r,s,i,j,f,k;return n.jsxs(ta.Fragment,{children:[n.jsx(I,{position:{lat:parseFloat((r=t==null?void 0:t.data[0])==null?void 0:r.lat),lng:parseFloat((s=t==null?void 0:t.data[0])==null?void 0:s.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}}),n.jsx(pa,{trip:t,tripPlay:x,setTripPlay:b,setSpeed:D}),n.jsx(I,{position:{lat:parseFloat((j=t==null?void 0:t.data[((i=t==null?void 0:t.data)==null?void 0:i.length)-1])==null?void 0:j.lat),lng:parseFloat((k=t==null?void 0:t.data[((f=t==null?void 0:t.data)==null?void 0:f.length)-1])==null?void 0:k.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}})]},u)})),n.jsx("div",{style:{position:"relative",top:320,left:15,color:"green"},children:((d=(o=S[0])==null?void 0:o.data)==null?void 0:d.length)>0&&g&&n.jsx(ga,{item:S})})]})]})},fa=xa;function Sa({filteredTrips:e,setFilteredTrips:y,setCenter:P,setSelectedTrip:B}){const{selectedVehicle:h}=m(a=>a.liveMap),{tripHistory:l}=m(a=>a.tripMonitor),[A,T]=c.useState(),[p,G]=c.useState(),[v,C]=c.useState(!1),[S,L]=c.useState(0),[x,b]=c.useState(),[w,D]=c.useState(),[g,E]=c.useState(0);let R=V();c.useEffect(()=>{!p&&!A&&y([]),N()},[p]),c.useEffect(()=>{var a;if(l&&((a=l==null?void 0:l.documents)==null?void 0:a.length)>0){const o=[];l.documents.forEach(d=>{let t;d.data.forEach(u=>{const r=u.createdAt.split("T")[0];t=o.find(s=>s.label===r),t||(t={label:r,data:[]},o.push(t))}),t.data.push({trip:t.data.length+1,tripData:d==null?void 0:d.data,startLocation:d==null?void 0:d.startLocation,endLocation:d==null?void 0:d.endLocation})}),y(o)}else l&&y([])},[l]),c.useEffect(()=>{e&&e.length>0&&(b(e[0].label),L(0))},[e]),c.useEffect(()=>{var a,o,d,t,u,r,s,i,j;if(e&&e.length>0){const f=(d=(o=(a=e[0])==null?void 0:a.data[0])==null?void 0:o.tripData[0])==null?void 0:d.startDate,k=(j=(i=(t=e[0])==null?void 0:t.data[0])==null?void 0:i.tripData[((s=(r=(u=e[0])==null?void 0:u.data[0])==null?void 0:r.tripData)==null?void 0:s.length)-1])==null?void 0:j.endDate,U={imei:h==null?void 0:h.imei,startDate:f,endDate:k};R(H({data:U}))}},[e]),c.useEffect(()=>{if(!e)return;const o=e.filter(d=>d.label===x).map(d=>d.data);o.length>0&&(D(o),E(0))},[x]);const N=async()=>{if(p&&Object.keys(h).length>0)try{C(!0);const a={imei:h==null?void 0:h.imei,startDate:A,endDate:p};await R(sa({data:a})),C(!1)}catch(a){C(!1),console.log("error in TripDetail",a)}},$=(a,o)=>{var d,t,u,r,s;if(E(a===g?null:a),B([o]),P({lat:(d=o==null?void 0:o.tripData[0])==null?void 0:d.lat,lng:(t=o==null?void 0:o.tripData[0])==null?void 0:t.lng}),p&&Object.keys(h).length>0){const i=(u=o==null?void 0:o.tripData[0])==null?void 0:u.startDate,j=(s=o==null?void 0:o.tripData[((r=o==null?void 0:o.tripData)==null?void 0:r.length)-1])==null?void 0:s.endDate,f={imei:h==null?void 0:h.imei,startDate:i,endDate:j};R(H({data:f}))}},F=(a,o)=>{var d,t,u,r,s,i;if(L(o),b(a.label),e&&e.length>0){const j=(t=(d=a==null?void 0:a.data[0])==null?void 0:d.tripData[0])==null?void 0:t.startDate,f=(i=(s=a==null?void 0:a.data[0])==null?void 0:s.tripData[((r=(u=a==null?void 0:a.data[0])==null?void 0:u.tripData)==null?void 0:r.length)-1])==null?void 0:i.endDate,k={imei:h==null?void 0:h.imei,startDate:j,endDate:f};R(H({data:k}))}},W=a=>{const o=new Date(a),d=o.getHours(),t=o.getMinutes(),u=d<10?`0${d}`:d,r=t<10?`0${t}`:t,s=d>=12?"PM":"AM";return`${u}:${r} ${s}`},z={marginLeft:"15px",fontWeight:"bold",fontSize:"18px",fontFamily:"ubuntu"};return n.jsxs("div",{style:{padding:"10px"},children:[n.jsx(ua,{setStartDate:T,setEndDate:G}),v?n.jsx("div",{style:{width:"100%",margin:"38%"},children:n.jsx(aa,{})}):n.jsxs(M,{className:"scrollbar-container",style:{display:"flex",overflowX:"auto",marginTop:"50px",marginBottom:"50px",gap:"10px",flexDirection:"column"},children:[n.jsxs(M,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px",alignItems:"center"},children:[!p&&n.jsx(O,{style:z,children:"Please Select Date"}),!v&&p&&e.length===0&&n.jsx(O,{style:z,children:"No Trip Found"}),e&&p&&e.map((a,o)=>n.jsx(M,{children:n.jsx(ia,{onClick:()=>{F(a,o)},style:{background:S===o?X.bgColor:"transparent",color:S===o?"white":"#666666",height:"45px",fontWeight:700,fontSize:"13px"},children:a.label})},o))]}),n.jsx(M,{style:{display:"flex",flexDirection:"column",height:"70vh"},children:x&&!v&&p&&w&&w[0].map((a,o)=>{var d,t,u,r,s,i,j,f,k;return n.jsxs(M,{sx:{margin:"2px",border:"1px solid #E8E8E8",background:g===o?X.bgShadow:"transparent",color:g===o?"black":"#666666",borderRadius:"5px",padding:"12px","&:hover":{background:X.bgShadow,color:"black"}},onClick:()=>{g!==o&&($(o,a),E(o))},children:[n.jsxs(O,{children:[a.trip,".",((a==null?void 0:a.startLocation)||"").split(" ").slice(0,3).join(" ")," ","to"," ",((a==null?void 0:a.endLocation)||"").split(" ").slice(0,3).join(" ")]}),n.jsxs(O,{children:[W((d=a==null?void 0:a.tripData[0])==null?void 0:d.startDate)," /"," ",W((u=a==null?void 0:a.tripData[((t=a==null?void 0:a.tripData)==null?void 0:t.length)-1])==null?void 0:u.endDate)]}),n.jsxs(O,{children:["(",ea((r=a==null?void 0:a.tripData[0])==null?void 0:r.lat,(s=a==null?void 0:a.tripData[0])==null?void 0:s.lng,(j=a==null?void 0:a.tripData[((i=a==null?void 0:a.tripData)==null?void 0:i.length)-1])==null?void 0:j.lat,(k=a==null?void 0:a.tripData[((f=a==null?void 0:a.tripData)==null?void 0:f.length)-1])==null?void 0:k.lng)," ","km)"]})]},o)})})]})]})}function Aa(){const{w_customer_id:e}=m(g=>g.auth),{collapsed:y}=m(g=>g.auth),[P,B]=c.useState(!1),[h,l]=c.useState(!1),[A,T]=c.useState([]),[p,G]=c.useState(!1),[v,C]=c.useState([]),[S,L]=c.useState({lat:18.516726,lng:73.856255}),[x,b]=c.useState([]);let w=V();c.useEffect(()=>{D()},[]);const D=async()=>{let g=[],E=[];(await w(oa({w_customer_id:e}))).payload.map(F=>{g.push({id:F.id,label:F.registration_id,value:F.imei[0].mac_id}),E.push(F.imei[0].mac_id)});const N="one",$=E;E.length>0&&w(na({type:N,imei:$})),T(g)};return n.jsxs("div",{className:"app",children:[n.jsx(la,{}),n.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[n.jsx(ca,{title:"Trip Monitor",setShowVehicles:B,showVehicles:P,setShowCard:l,showCard:h,sideBarTrip:p,setSideBarTrip:G}),n.jsxs(M,{style:{display:"flex",width:"100%",height:"95vh"},children:[n.jsx(M,{style:{width:P||p?"80%":"100%"},children:n.jsx(fa,{center:S,showCard:h})}),P&&n.jsx(M,{style:{width:y?"25%":"20%"},children:n.jsx(da,{vehicleData:A,title:"Live Monitor"})}),n.jsx(M,{style:{width:y?"25%":"20%",display:p?"block":"none"},children:n.jsx(Sa,{setCenter:L,filteredTrips:v,setFilteredTrips:C,setSelectedTrip:b})})]})]})]})}export{Aa as default};
