import{p as $e,q as Oe,w as M,x as ye,y as re,z as Be,A as Ve,B as ze,r as p,C as Ge,D as q,j as e,E as X,F as qe,H as ve,I as Q,J as Z,K as He,L as ce,M as H,N as de,O as Te,T as z,a as N,G as K,c as G,u as ee,b as be,_ as V,P as je,t as Ue,Q as We,R as Ye,S as Xe,U as Se,i as pe,V as Je,W as se,X as Ke,Y as Qe,Z as we,$ as ne,a0 as Ze,l as et,m as tt,n as ot,o as rt,v as st}from"./index-Dd5O25NJ.js";import{L as nt}from"./LightModeOutlined-DDx2Rx2I.js";import{s as le}from"./Socket-0N_gnJcr.js";import{p as lt,R as at,L as it,X as ct,Y as dt,a as pt,b as ut,T as ht}from"./LineChart-CG7w6aVl.js";import{t as U,d as gt}from"./Search-YvtTYn1Q.js";import{B as y,C as ue}from"./CircularProgress-DDtA4O1n.js";import{P as mt}from"./Paper-DDzyGW5p.js";import{c as xt,S as ft}from"./Switch-Cx5nak4g.js";import{c as yt,I as vt}from"./IconButton-CyvlakxD.js";import{r as bt,m as jt,a as St}from"./mergeSlotProps-BeACeMmQ.js";import{C as Pe}from"./index-D0i1Ois_.js";import{u as wt,G as Ct,M as kt}from"./esm-6KE22fkC.js";import{u as De,f as Ie,F as Tt,I as Pt,O as Dt,a as It}from"./OutlinedInput-Bl1re5Hz.js";import{d as Ce}from"./index-DJr9dsEl.js";import{D as At}from"./DateTimePicker-BN9lczAP.js";import{r as he}from"./createSvgIcon-CPJ04Nu6.js";import{T as Ft,a as Lt,d as Mt,b as Rt,c as ae}from"./TableRow-BacN8BEW.js";import{T as Nt}from"./TopBar-D75DdY4R.js";import{G as Et}from"./GeofencAlert-DqrJOHyG.js";import"./index-Bt5rwmSi.js";import"./roundedArrow-DJIdObUx.js";import"./button-BQgjyNUa.js";import"./NotificationsNone-HBt1dSNo.js";const _t=["component","direction","spacing","divider","children","className","useFlexGap"],$t=$e(),Ot=Oe("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,o)=>o.root});function Bt(t){return qe({props:t,name:"MuiStack",defaultTheme:$t})}function Vt(t,o){const r=p.Children.toArray(t).filter(Boolean);return r.reduce((n,u,a)=>(n.push(u),a<r.length-1&&n.push(p.cloneElement(o,{key:`separator-${a}`})),n),[])}const zt=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],Gt=({ownerState:t,theme:o})=>{let r=M({display:"flex",flexDirection:"column"},ye({theme:o},re({values:t.direction,breakpoints:o.breakpoints.values}),n=>({flexDirection:n})));if(t.spacing){const n=Be(o),u=Object.keys(o.breakpoints.values).reduce((v,d)=>((typeof t.spacing=="object"&&t.spacing[d]!=null||typeof t.direction=="object"&&t.direction[d]!=null)&&(v[d]=!0),v),{}),a=re({values:t.direction,base:u}),x=re({values:t.spacing,base:u});typeof a=="object"&&Object.keys(a).forEach((v,d,m)=>{if(!a[v]){const S=d>0?a[m[d-1]]:"column";a[v]=S}}),r=Ve(r,ye({theme:o},x,(v,d)=>t.useFlexGap?{gap:ve(n,v)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${zt(d?a[d]:t.direction)}`]:ve(n,v)}}))}return r=ze(o.breakpoints,r),r};function qt(t={}){const{createStyledComponent:o=Ot,useThemeProps:r=Bt,componentName:n="MuiStack"}=t,u=()=>Q({root:["root"]},v=>Z(n,v),{}),a=o(Gt);return p.forwardRef(function(v,d){const m=r(v),h=Ge(m),{component:S="div",direction:C="column",spacing:l=0,divider:b,children:i,className:k,useFlexGap:I=!1}=h,g=q(h,_t),P={direction:C,spacing:l,useFlexGap:I},D=u();return e.jsx(a,M({as:S,ownerState:P,ref:d,className:X(D.root,k)},g,{children:b?Vt(i,b):i}))})}const Ht=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],Ut=["component","slots","slotProps"],Wt=["component"];function Yt(t,o){const{className:r,elementType:n,ownerState:u,externalForwardedProps:a,getSlotOwnerState:x,internalForwardedProps:c}=o,v=q(o,Ht),{component:d,slots:m={[t]:void 0},slotProps:h={[t]:void 0}}=a,S=q(a,Ut),C=m[t]||n,l=bt(h[t],u),b=jt(M({className:r},v,{externalForwardedProps:t==="root"?S:void 0,externalSlotProps:l})),{props:{component:i},internalRef:k}=b,I=q(b.props,Wt),g=He(k,l==null?void 0:l.ref,o.ref),P=x?x(I):{},D=M({},u,P),j=t==="root"?i||d:i,A=St(C,M({},t==="root"&&!d&&!m[t]&&c,t!=="root"&&!m[t]&&c,I,j&&{as:j},{ref:g}),D);return Object.keys(P).forEach(L=>{delete A[L]}),[C,A]}const Xt=yt(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function Jt(t){return Z("MuiAvatar",t)}ce("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const Kt=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],Qt=xt(),Zt=t=>{const{classes:o,variant:r,colorDefault:n}=t;return Q({root:["root",r,n&&"colorDefault"],img:["img"],fallback:["fallback"]},Jt,o)},eo=H("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,o[r.variant],r.colorDefault&&o.colorDefault]}})(({theme:t})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:M({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:M({backgroundColor:t.palette.grey[400]},t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})))}]})),to=H("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(t,o)=>o.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),oo=H(Xt,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(t,o)=>o.fallback})({width:"75%",height:"75%"});function ro({crossOrigin:t,referrerPolicy:o,src:r,srcSet:n}){const[u,a]=p.useState(!1);return p.useEffect(()=>{if(!r&&!n)return;a(!1);let x=!0;const c=new Image;return c.onload=()=>{x&&a("loaded")},c.onerror=()=>{x&&a("error")},c.crossOrigin=t,c.referrerPolicy=o,c.src=r,n&&(c.srcset=n),()=>{x=!1}},[t,o,r,n]),u}const so=p.forwardRef(function(o,r){const n=Qt({props:o,name:"MuiAvatar"}),{alt:u,children:a,className:x,component:c="div",slots:v={},slotProps:d={},imgProps:m,sizes:h,src:S,srcSet:C,variant:l="circular"}=n,b=q(n,Kt);let i=null;const k=ro(M({},m,{src:S,srcSet:C})),I=S||C,g=I&&k!=="error",P=M({},n,{colorDefault:!g,component:c,variant:l}),D=Zt(P),[j,A]=Yt("img",{className:D.img,elementType:to,externalForwardedProps:{slots:v,slotProps:{img:M({},m,d.img)}},additionalProps:{alt:u,src:S,srcSet:C,sizes:h},ownerState:P});return g?i=e.jsx(j,M({},A)):a||a===0?i=a:I&&u?i=u[0]:i=e.jsx(oo,{ownerState:P,className:D.fallback}),e.jsx(eo,M({as:c,ownerState:P,className:X(D.root,x),ref:r},b,{children:i}))}),no=so,lo=qt({createStyledComponent:H("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,o)=>o.root}),useThemeProps:t=>de({props:t,name:"MuiStack"})}),ao=lo;function io(t){return Z("MuiFormControlLabel",t)}const co=ce("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),Y=co,po=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],uo=t=>{const{classes:o,disabled:r,labelPlacement:n,error:u,required:a}=t,x={root:["root",r&&"disabled",`labelPlacement${Te(n)}`,u&&"error",a&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",u&&"error"]};return Q(x,io,o)},ho=H("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[{[`& .${Y.label}`]:o.label},o.root,o[`labelPlacement${Te(r.labelPlacement)}`]]}})(({theme:t,ownerState:o})=>M({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${Y.disabled}`]:{cursor:"default"}},o.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},o.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},o.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${Y.label}`]:{[`&.${Y.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})),go=H("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,o)=>o.asterisk})(({theme:t})=>({[`&.${Y.error}`]:{color:(t.vars||t).palette.error.main}})),mo=p.forwardRef(function(o,r){var n,u;const a=de({props:o,name:"MuiFormControlLabel"}),{className:x,componentsProps:c={},control:v,disabled:d,disableTypography:m,label:h,labelPlacement:S="end",required:C,slotProps:l={}}=a,b=q(a,po),i=De(),k=(n=d??v.props.disabled)!=null?n:i==null?void 0:i.disabled,I=C??v.props.required,g={disabled:k,required:I};["checked","name","onChange","value","inputRef"].forEach(F=>{typeof v.props[F]>"u"&&typeof a[F]<"u"&&(g[F]=a[F])});const P=Ie({props:a,muiFormControl:i,states:["error"]}),D=M({},a,{disabled:k,labelPlacement:S,required:I,error:P.error}),j=uo(D),A=(u=l.typography)!=null?u:c.typography;let L=h;return L!=null&&L.type!==z&&!m&&(L=e.jsx(z,M({component:"span"},A,{className:X(j.label,A==null?void 0:A.className),children:L}))),e.jsxs(ho,M({className:X(j.root,x),ownerState:D,ref:r},b,{children:[p.cloneElement(v,g),I?e.jsxs(ao,{display:"block",children:[L,e.jsxs(go,{ownerState:D,"aria-hidden":!0,className:j.asterisk,children:["â€‰","*"]})]}):L]}))}),xo=mo;function fo(t){return Z("MuiFormGroup",t)}ce("MuiFormGroup",["root","row","error"]);const yo=["className","row"],vo=t=>{const{classes:o,row:r,error:n}=t;return Q({root:["root",r&&"row",n&&"error"]},fo,o)},bo=H("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,r.row&&o.row]}})(({ownerState:t})=>M({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),jo=p.forwardRef(function(o,r){const n=de({props:o,name:"MuiFormGroup"}),{className:u,row:a=!1}=n,x=q(n,yo),c=De(),v=Ie({props:n,muiFormControl:c,states:["error"]}),d=M({},n,{row:a,error:v.error}),m=vo(d);return e.jsx(bo,M({className:X(m.root,u),ownerState:d,ref:r},x))}),So=jo,wo=({imeiNo:t})=>{const{selectedVehicle:o,parameterData:r,ivnPid:n,locationData:u,vehicleList:a,onlineVehicle:x}=N(j=>j.liveMap),{ivnParameters:c,mode:v}=N(j=>j.dashboard),d=U(v),[m,h]=p.useState(),[S,C]=p.useState(!1),[l,b]=p.useState();p.useState({mainInputVoltage:0,ignition:0,speed:0});const[i,k]=p.useState("Not Available"),[I,g]=p.useState("Offline");p.useEffect(()=>{P()},[o]);const P=()=>{var j,A,L,F;if((u==null?void 0:u.length)>0){console.log("locationData",u);let T=u==null?void 0:u.find(W=>W.latestDocument.imei===o.imei);T?(h((j=T==null?void 0:T.latestDocument)==null?void 0:j.speed),C((A=T==null?void 0:T.latestDocument)==null?void 0:A.ignition),b((L=T==null?void 0:T.latestDocument)==null?void 0:L.mainInputVoltage),k((F=T==null?void 0:T.latestDocument)==null?void 0:F.venderId)):(h(0),C(0),b(0),k("Not Available"))}else h(0),C(0),b(0),k("Not Available")};p.useEffect(()=>{Object.keys(o).length>0&&D()},[o]);const D=()=>{if(Object.keys(o).length>0)if(x&&x.length>0){const j=x.some(A=>parseInt(A)===parseInt(o==null?void 0:o.imei));g(j?"Online":"Offline")}else g("Offline");else g("Offline")};return e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{mx:"10px",pt:"10px",color:d.grey[400]},children:e.jsx("b",{children:o==null?void 0:o.reg_id})}),e.jsx(y,{sx:{backgroundColor:d.grey[200],height:"12vh",borderRadius:"8px",p:"5px"},children:e.jsx(y,{sx:{},children:e.jsx(K,{container:!0,spacing:3,mt:"2.5px",children:e.jsx(K,{item:!0,xs:12,children:e.jsx(K,{container:!0,justifyContent:"space-around",spacing:3,children:[{label:"VenderId",value:i},{label:"Speed",value:m,unit:"km/h"},{label:"Main Input Voltage",value:parseFloat(l).toFixed(2),unit:"voltage"},{label:"Current Status",value:I}].map((j,A)=>e.jsx(K,{item:!0,children:e.jsxs(mt,{sx:{height:70,width:250,backgroundColor:d.grey[100],color:d.grey[400],display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px"},children:[e.jsxs(y,{children:[e.jsx(z,{variant:"h6",sx:{fontSize:"12px"},children:j.label}),e.jsxs(z,{variant:"h6",sx:{fontSize:"18px",fontWeight:"bold"},children:[j.value," ",j==null?void 0:j.unit]})]}),e.jsx(no,{src:lt,sx:{width:20,height:20}})]})},A))})})})})})]})},ie=({title:t,selectedTripData:o})=>{const{mode:r,loading:n}=N(d=>d.dashboard),{selectedVehicle:u}=N(d=>d.liveMap),[a,x]=p.useState([]);p.useEffect(()=>{let d=o.map(h=>{let S={...h};return S.ignition=S.ignition?1:0,S});const m=v(d);x(m)},[o]);const c=U(r),v=d=>{let m=null;return d.forEach(h=>{const S=new Date(h.createdAt);m&&m.toDateString()===S.toDateString()?(h.date=G(h.createdAt).format("HH:mm:ss"),h.ignition=h.ignition?1:0):(h.date=G(h.createdAt).format("DD-MM-YYYY"),h.ignition=h.ignition?1:0),m=S}),d};return e.jsx(y,{sx:{ml:"2rem",border:c.grey[300],fontSize:"13px",height:"24vh",color:c.grey[400],backgroundColor:c.grey[100],borderRadius:"5px"},children:a&&a.length>0?e.jsx(at,{children:e.jsxs(it,{data:a,margin:{top:15,right:10,left:-25,bottom:0},children:[e.jsx(ct,{dataKey:"date",stroke:c.grey[400]}),e.jsx(dt,{stroke:c.grey[400]}),e.jsx(pt,{type:"monotone",dataKey:t,dot:!1,stroke:"#EF5B05",strokeWidth:2}),e.jsx(ut,{layout:"horizontal",verticalAlign:"top",align:"center"}),e.jsx(ht,{})]})}):e.jsx(Pe,{style:{background:c.grey[100],width:"400px",height:"100px",margin:"auto",marginTop:"10px"},children:Object.keys(u).length===0?e.jsx(z,{textAlign:"center",align:"center",mt:"20px",color:c.grey[600],children:"Please Select a Vehicle"}):n?e.jsx(ue,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(z,{textAlign:"center",color:c.grey[600],children:"Sorry! No Trips Available"})})})},Co=()=>{const t=ee(),{center:o,selectedParameterList:r,selectedVehicle:n,vehicleList:u,tractorIcon:a,icons:x,locationData:c,ivnPid:v,placesData:d}=N(F=>F.liveMap),{mode:m}=N(F=>F.dashboard),{isLoaded:h,loadError:S}=wt({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"}),[C,l]=p.useState(null),[b,i]=p.useState(!0),[k,I]=p.useState(5),[g,P]=p.useState(),D=U(m);p.useEffect(()=>{if(b)P(c);else{let F=c==null?void 0:c.filter(T=>(T==null?void 0:T._id)===(n==null?void 0:n.imei));P(F)}},[c,n,b]);const j=()=>{if(!b)t(be({lat:21,lng:78})),I(4),i(T=>!T);else{const F=c.find(T=>T.latestDocument.imei===n.imei);if(F){console.log(F.latestDocument,"getCenter");const{lat:T,lng:W}=F.latestDocument;t(be({lat:T,lng:W})),I(12),i(te=>!te)}else V.error("Data is not available for selected vehicle")}};if(p.useEffect(()=>{h&&l(window.google.maps)},[h,c]),S)return"Error loading maps";if(!h)return"Loading maps";const A={height:"41.5vh",width:"99%",marginTop:"0px",marginLeft:"10px"},L=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}];return C?e.jsxs("div",{children:[e.jsxs(y,{sx:{ml:"10px",fontSize:"20px",display:"flex",justifyContent:"space-between",color:D.grey[400]},children:[e.jsx("b",{children:"Live Map"}),e.jsx(So,{sx:{marginLeft:0,paddingTop:0,color:D.grey[400]},children:e.jsx(xo,{control:e.jsx(ft,{checked:b,onChange:j}),label:b?"Group":"Individual"})})]}),e.jsx(Ct,{mapContainerStyle:A,zoom:k,center:o,options:{mapTypeControl:!1,styles:m?L:""},children:g&&g.length>0&&g.map((F,T)=>e.jsx(kt,{position:{lat:F.latestDocument.lat,lng:F.latestDocument.lng},icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png",scaledSize:new google.maps.Size(32,32),fillColor:"red",fillOpacity:2,strokeWeight:1,scale:2}},T))})]}):null},ko=({vehicleData:t})=>{const o=["Engine RPM","Engine coolant temperature","Battery Potential"],r=ee(),{selectedVehicle:n,loading:u}=N(i=>i.liveMap),{startDate:a,endDate:x,mode:c}=N(i=>i.dashboard),[v,d]=p.useState(""),m=U(c),h=p.useRef(null),S=p.useRef(0),C=t.length>0&&t.filter(i=>i.label.toLowerCase().includes(v.toLowerCase())),l=i=>{d(i.target.value)},b=async i=>{var D;h.current&&(S.current=h.current.scrollTop),r(We({imei:i.value,reg_id:i.label}));let k={imei:i.value,startDate:Ce().subtract(5,"day"),endDate:Ce()};r(Ye(k));let I=i.label;const g=await r(Xe({registration_id:I}));let P=[];if(g&&g.payload.length>0&&((D=g.payload)==null||D.map(j=>{j.ivn_parameter.length>0&&P.push(j.ivn_parameter[0])})),P.length>0){let j=P.filter(A=>o.includes(A.pid_description));r(Se(j))}else r(Se([]));setTimeout(()=>{h.current&&(h.current.scrollTop=S.current)},0)};return p.useEffect(()=>{h.current&&(h.current.scrollTop=S.current)},[u,C,n]),e.jsx(e.Fragment,{children:u?e.jsx("div",{children:e.jsx(y,{sx:{display:"flex",justifyContent:"center",height:"88vh",alignItems:"center"},children:e.jsx(ue,{})})}):e.jsxs("div",{ref:h,style:{overflowY:"auto",height:"90vh"},children:[e.jsx(y,{sx:{align:"center",my:"15px",ml:"20px"},children:e.jsxs(Tt,{sx:{width:"90%",backgroundColor:"white",borderRadius:"5px"},variant:"outlined",children:[e.jsx(Pt,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px"},children:"Search"}),e.jsx(Dt,{onChange:i=>l(i),inputProps:{style:{padding:7}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(It,{position:"end",children:e.jsx(vt,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(gt,{})})}),label:"Search"})]})}),e.jsx(y,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsxs(je,{variant:"outlined",sx:{width:"90%",color:m.grey[400],"&:hover":{color:"#DAE0EE"}},children:["Total Vehicle: ",C.length]})}),C.length>0&&C.map((i,k)=>e.jsx(y,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(je,{variant:"outlined",onClick:()=>b(i),sx:{width:"90%",bgcolor:i.label===n.reg_id?Ue.bgColor:"undefined",color:i.label===n.reg_id?"#DAE0EE":m.grey[400]},children:i.label})},k))]})})};var ge={},To=pe;Object.defineProperty(ge,"__esModule",{value:!0});var Ae=ge.default=void 0,Po=To(he()),Do=e;Ae=ge.default=(0,Po.default)((0,Do.jsx)("path",{d:"M10.02 6 8.61 7.41 13.19 12l-4.58 4.59L10.02 18l6-6z"}),"NavigateNextOutlined");var me={},Io=pe;Object.defineProperty(me,"__esModule",{value:!0});var Fe=me.default=void 0,Ao=Io(he()),Fo=e;Fe=me.default=(0,Ao.default)((0,Fo.jsx)("path",{d:"M15.61 7.41 14.2 6l-6 6 6 6 1.41-1.41L11.03 12z"}),"NavigateBeforeOutlined");var xe={},Lo=pe;Object.defineProperty(xe,"__esModule",{value:!0});var Le=xe.default=void 0,Mo=Lo(he()),ke=e;Le=xe.default=(0,Mo.default)([(0,ke.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7M7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9"},"0"),(0,ke.jsx)("circle",{cx:"12",cy:"9",r:"2.5"},"1")],"LocationOnOutlined");const Ro=()=>{const t=ee(),o=Je(),{tripList:r,selectedTripData:n,loading:u,trips:a,activeIndex:x,searchText:c,mode:v}=N(s=>s.dashboard),{selectedVehicle:d}=N(s=>s.liveMap),[m,h]=p.useState(0),[S,C]=p.useState(0),[l,b]=p.useState(0),[i,k]=p.useState(0),[I,g]=p.useState("0"),[P,D]=p.useState(0),[j,A]=p.useState(!1),L=U(v),F=()=>{h(s=>s+3)},T=()=>{h(s=>Math.max(s-5,0))};p.useEffect(()=>{const s=W(r);if(s.length>0){t(se(s[0]));const f=r&&r.length>0&&r.filter(w=>w.formatedDate.toLowerCase().includes(c.toLowerCase()));f.length>0&&oe(0,f[0])}t(Ke(s))},[r]),p.useEffect(()=>{if(n.length>0){const s=n.map(w=>({lat:parseFloat(w.lat),lng:parseFloat(w.lng)})),f=new window.google.maps.Polygon({paths:s});fe(f)}},[n]);const W=s=>{const f=new Set,w=[];return s.forEach(R=>{f.has(R.formatedDate)||(f.add(R.formatedDate),w.push(R.formatedDate))}),w},$=r&&r.length>0&&r.filter(s=>s.formatedDate.toLowerCase().includes(c.toLowerCase())),te=s=>{if($&&$.length>0){const f=r&&r.length>0&&r.filter(w=>w.formatedDate.toLowerCase().includes(s.toLowerCase()));t(ne(0)),t(se(s)),oe(0,f[0])}else t(ne(null)),t(se(s))},oe=async(s,f)=>{var E;console.log("item",f);let w={imei:d.imei,startDate:f.startDate,endDate:f.endDate};A(!0);const R=await Qe(w);((E=R==null?void 0:R.data)==null?void 0:E.documents.length)>0?(t(we(R.data.documents[0].data)),Me(R.data.documents[0].data),A(!1)):(k(0),b(0),D(0),C(0),g("0"),t(we([])),A(!1)),t(ne(s))},Me=s=>{let f=0,w=0;s.map((_,J)=>{_.packetType==="HB"&&f++,_.packetType==="HA"&&w++}),C(f),b(w);let R=Re(new Date(s[0].createdAt).toISOString(),new Date(s[s.length-1].createdAt).toISOString());console.log("hours: ",R),g(R);const E=Ne(s);D(E);const O=s.map(_=>({lat:parseFloat(_.lat),lng:parseFloat(_.lng)})),B=new window.google.maps.Polygon({paths:O});fe(B)};function Re(s,f){var w=G(s),R=G(f);console.log("startDate-------->",s,f);let E=G.duration(R.diff(w)),O=E.hours(),B=E.minutes(),_=E.seconds(),J=`${O}h ${B}m ${_}s`;return console.log("string",J),J}function Ne(s){let f=0;for(let w=0;w<s.length-1;w++){const R=s[w].lat,E=s[w].lng,O=s[w+1].lat,B=s[w+1].lng;f+=Ee(R,E,O,B)}return f}function Ee(s,f,w,R){const O=(w-s)*Math.PI/180,B=(R-f)*Math.PI/180,_=Math.sin(O/2)*Math.sin(O/2)+Math.cos(s*Math.PI/180)*Math.cos(w*Math.PI/180)*Math.sin(B/2)*Math.sin(B/2);return 6371*(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)))}const fe=s=>{if(!window.google||!window.google.maps.geometry){console.log("not loaded");return}const w=window.google.maps.geometry.spherical.computeArea(s.getPath())/4046.86;k(w)},_e=s=>{x!==null?s===x?(t(Ze(!0)),o("/trip-monitor")):V.error("Trip not selected"):V.error("Please select the trip")};return e.jsxs(e.Fragment,{children:[e.jsxs(y,{sx:{width:"95%",display:"flex",overflow:"auto",mx:"10px"},children:[e.jsx("div",{style:{display:"flex"},children:a&&a.length>0&&a.slice(m,m+5).map((s,f)=>e.jsx(y,{sx:{backgroundColor:c===s?"#EF5B05":"white",color:c===s?"white":"#EF5B05",mx:"5px",p:"5px",borderRadius:"5px",width:"90px",height:"25px",textAlign:"center",cursor:"pointer"},onClick:()=>{te(s)},children:s},f))}),m!==0&&e.jsx("button",{onClick:T,style:{marginLeft:"5px",backgroundColor:"white",color:"black"},disabled:m===0,children:e.jsx(Fe,{})}),!(m+5>=a.length)&&e.jsx("button",{onClick:F,style:{marginLeft:"5px",backgroundColor:"white",color:"black"},disabled:m+5>=a.length,children:e.jsx(Ae,{})})]}),e.jsx(y,{children:$&&$.length>0?e.jsx(Ft,{sx:{maxHeight:210,height:210,width:"98%",ml:"10px",mt:"10px",borderRadius:"5px",border:"1px solid #dbdad5"},children:e.jsx(Lt,{stickyHeader:!0,"aria-label":"sticky table",children:e.jsx(Mt,{children:$&&$.length>0&&$.map((s,f)=>e.jsxs(Rt,{sx:{backgroundColor:x===f?"#DAE0EE":L.grey[100]},children:[e.jsxs(ae,{align:"left",style:{fontSize:"12px",padding:10,color:x===f?"black":L.grey[400],cursor:"pointer"},onClick:()=>{oe(f,s)},children:[f+1,". ",s.startLocation," to ",s.endLocation]}),e.jsxs(ae,{align:"right",style:{fontSize:"12px",padding:10,color:x===f?"black":L.grey[400]},children:[s!=null&&s.startDate?G(new Date(s.startDate).toISOString()).format("LT"):""," ","to"," ",s!=null&&s.endDate?G(new Date(s.endDate).toISOString()).format("LT"):"----"]}),e.jsx(ae,{align:"right",style:{fontSize:"12px",padding:10,color:x===f?"black":L.grey[400]},children:e.jsx("span",{title:"Navigate to map",style:{cursor:"pointer"},onClick:()=>{_e(f)},children:e.jsx(Le,{})})})]},f))})})}):e.jsx(y,{sx:{height:210,display:"flex",justifyContent:"center",alignItems:"center",color:L.grey[400],margin:"auto"},children:e.jsx(Pe,{style:{background:L.grey[100],width:"400px",height:"100px"},children:Object.keys(d).length===0?e.jsx(z,{textAlign:"center",align:"center",mt:"20px",color:L.grey[600],children:"Please Select a Vehicle"}):u?e.jsx(ue,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(z,{textAlign:"center",color:L.grey[600],children:"Sorry! No Trips Available"})})})}),n.length>0&&e.jsx(y,{sx:{my:"0px"},children:e.jsxs(y,{sx:{display:"flex",mx:"5px",mt:"5px"},children:[e.jsxs(y,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Braking"}),e.jsx("div",{children:"0"})]}),e.jsxs(y,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Acceleration"}),e.jsx("div",{children:"0"})]}),e.jsxs(y,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Running Hrs"}),e.jsx("div",{children:I})]}),e.jsxs(y,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Distance"}),e.jsx("div",{children:parseFloat(parseFloat(P).toFixed(2))})]})]})})]})},No=()=>{const{mode:t}=N(r=>r.dashboard),o=U(t);return e.jsxs(y,{children:[e.jsxs(y,{sx:{display:"flex",ml:"5px"},children:[e.jsx(y,{sx:{m:"5px",fontSize:"20px",width:"60%",color:o.grey[400]},children:e.jsx("b",{children:"Trip History"})}),e.jsx(y,{children:e.jsx(At,{})})]}),e.jsx(y,{sx:{my:"5px"},children:e.jsx(Ro,{})})]})},lr=()=>{const{w_customer_id:t}=N(l=>l.auth),{mode:o,selectedTripData:r}=N(l=>l.dashboard),[n,u]=p.useState(()=>{const l=sessionStorage.getItem("imeiNo");return l?JSON.parse(l):[]}),a=ee(),x=U(o),[c,v]=p.useState([]),[d,m]=p.useState(!1),[h,S]=p.useState(!1);p.useEffect(()=>{C()},[]),p.useEffect(()=>{sessionStorage.setItem("imeiNo",JSON.stringify(n))},[n]),p.useEffect(()=>{le.on("geofenceAlert",l=>{(l==null?void 0:l.imei)!==null&&n.find(k=>parseInt(k)===(l==null?void 0:l.imei))&&(console.log("geofence"),V.error(`Type: ${l==null?void 0:l.type} ${l==null?void 0:l.msg} ${l==null?void 0:l.imei}`,{id:"geofence",autoClose:5e3}))}),le.on("speedAlert",l=>{(l==null?void 0:l.imei)!==null&&n.find(k=>parseInt(k)===(l==null?void 0:l.imei))&&V.error(`${l==null?void 0:l.msg} ${l==null?void 0:l.imei}`,{id:"speed",autoClose:5e3})})},[le]);const C=async()=>{try{let l=[],b=[];const i=await a(et({w_customer_id:t}));if(Array.isArray(i.payload)){i.payload.forEach(g=>{var P,D;Array.isArray(g.imei)&&g.imei.length>0?(l.push({id:g.id,label:g.registration_id,value:(P=g==null?void 0:g.imei[0])==null?void 0:P.mac_id}),b.push((D=g.imei[0])==null?void 0:D.mac_id)):(console.error("IMEI data not found for item:",g),V.error(`IMEI Number not found for the vehicle: ${g==null?void 0:g.registration_id}`))}),u(b);const k="one",I=b;b.length>0&&(a(tt({type:k,imei:I})),a(ot(I))),v(l),a(rt({w_customer_id:t})),a(st({}))}else console.error("Unexpected data format:",i),V.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),V.error(`Error fetching vehicle data: ${l}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(nt,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Nt,{title:"Dashboard",showVehicles:d,setShowVehicles:m,setShowNotification:S,showNotification:h}),e.jsxs("div",{style:{height:"92vh",backgroundColor:x.grey[100],padding:"10px"},children:[d&&e.jsx(y,{sx:{position:"fixed",width:"250px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:x.grey[100],overflowY:"auto",scrollBehavior:"smooth",scrollbarWidth:"thin"},children:e.jsx(ko,{vehicleData:c})}),h&&e.jsx(y,{sx:{position:"fixed",width:"300px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:x.grey[100]},children:e.jsx(Et,{})}),e.jsx(y,{sx:{height:"21%"},children:e.jsx(wo,{imeiNo:n})}),e.jsxs(y,{sx:{display:"flex",height:"50%"},children:[e.jsx(y,{sx:{width:"50%",border:"1px solid #E8E8E8",padding:"2px",borderRadius:"5px"},children:e.jsx(No,{})}),e.jsx(y,{sx:{width:"50%"},children:e.jsx(Co,{})})]}),e.jsxs(y,{sx:{display:"flex",height:"30%",mt:"5px",pt:"10px"},children:[e.jsx(y,{style:{width:"33%"},children:e.jsx(ie,{title:"speed",selectedTripData:r})}),e.jsx(y,{style:{width:"33%"},children:e.jsx(ie,{title:"mainInputVoltage",selectedTripData:r})}),e.jsx(y,{style:{width:"33%"},children:e.jsx(ie,{title:"ignition",selectedTripData:r})})]})]})]})]})};export{lr as default};
