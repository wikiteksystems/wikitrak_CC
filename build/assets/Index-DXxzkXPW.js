import{i as y,j as e,a as I,u as G,t as x,T as _,x as he,y as ue,r as s,v as de,B,n as xe,o as ve,z as fe}from"./index-CKWYCORY.js";import{L as me}from"./Close-CHiDuXio.js";import{L as ge}from"./LiveMapTopBar-BQAoLz0m.js";import{V as je}from"./VehicleMenu-BftgNlJi.js";import{u as be,G as Se,M as Q}from"./esm-4vjKRHCL.js";import _e from"./Loader-D9bFNfrA.js";import{r as w}from"./createSvgIcon-CZy3drTR.js";import{B as n}from"./CircularProgress-JfJbNfGD.js";import{s as F}from"./Socket-0N_gnJcr.js";import{P as ye}from"./Parameters-B6Uw1dys.js";import"./index-nvMZeVxZ.js";import"./OutlinedInput-DVHsV0QY.js";import"./createSvgIcon-Bd57n-7W.js";import"./IconButton-BP542iq6.js";import"./index-BgOY4zkh.js";import"./Card-Cxq4iYrF.js";import"./Paper-Bz12D--8.js";var N={},we=y;Object.defineProperty(N,"__esModule",{value:!0});var Y=N.default=void 0,Ve=we(w()),Me=e;Y=N.default=(0,Ve.default)((0,Me.jsx)("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4"}),"Restaurant");var T={},Le=y;Object.defineProperty(T,"__esModule",{value:!0});var Z=T.default=void 0,De=Le(w()),$e=e;Z=T.default=(0,De.default)((0,$e.jsx)("path",{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3m12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4"}),"Hotel");var W={},Ce=y;Object.defineProperty(W,"__esModule",{value:!0});var ee=W.default=void 0,He=Ce(w()),Pe=e;ee=W.default=(0,He.default)((0,Pe.jsx)("path",{d:"m19.77 7.23.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77M12 10H6V5h6zm6 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalGasStation");var X={},Re=y;Object.defineProperty(X,"__esModule",{value:!0});var te=X.default=void 0,ke=Re(w()),ze=e;te=X.default=(0,ke.default)((0,ze.jsx)("path",{d:"M16.22 12c.68 0 1.22-.54 1.22-1.22 0-.67-.54-1.22-1.22-1.22S15 10.11 15 10.78c0 .68.55 1.22 1.22 1.22m-9.66-1.22c0 .67.54 1.22 1.22 1.22S9 11.46 9 10.78c0-.67-.54-1.22-1.22-1.22s-1.22.55-1.22 1.22M7.61 4 6.28 8h11.43l-1.33-4zm8.67-1s.54.01.92.54c.02.02.03.04.05.07.07.11.14.24.19.4.22.65 1.56 4.68 1.56 4.68v6.5c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81V14H7v1.19c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81v-6.5S6.34 4.67 6.55 4c.05-.16.12-.28.19-.4.03-.02.04-.04.06-.06.38-.53.92-.54.92-.54zM4 17.01h16V19h-7v3h-2v-3H4z"}),"CarRepair");var U={},Oe=y;Object.defineProperty(U,"__esModule",{value:!0});var ae=U.default=void 0,Ee=Oe(w()),Ie=e;ae=U.default=(0,Ee.default)((0,Ie.jsx)("path",{d:"M21 5h-2.64l1.14-3.14L17.15 1l-1.46 4H3v2l2 6-2 6v2h18v-2l-2-6 2-6zm-3.9 8.63L18.89 19H5.11l1.79-5.37.21-.63-.21-.63L5.11 7h13.78l-1.79 5.37-.21.63zM13 9h-2v3H8v2h3v3h2v-3h3v-2h-3z"}),"LocalPharmacyOutlined");var J={},Ae=y;Object.defineProperty(J,"__esModule",{value:!0});var se=J.default=void 0,qe=Ae(w()),Be=e;se=J.default=(0,qe.default)((0,Be.jsx)("path",{d:"M8 9v1.5h2.25V15h1.5v-4.5H14V9zM6 9H3c-.55 0-1 .45-1 1v5h1.5v-1.5h2V15H7v-5c0-.55-.45-1-1-1m-.5 3h-2v-1.5h2zM21 9h-4.5c-.55 0-1 .45-1 1v5H17v-4.5h1V14h1.5v-3.51h1V15H22v-5c0-.55-.45-1-1-1"}),"AtmOutlined");const Fe=({setPlace:v,place:r})=>{const{center:V}=I(u=>u.liveMap),p=G(),h=async u=>{r===u?(p(he([])),v("")):(v(u),p(ue({center:V,clickedPlace:u})))};return e.jsxs(n,{sx:{position:"absolute",top:"1vh",left:"20%",display:"flex",justifyContent:"center"},children:[e.jsx(n,{sx:{bgcolor:r==="restaurants"?x.bgColor:"white",color:r==="restaurants"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("restaurants")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(Y,{style:{height:"17px",position:"relative",top:"1px"}}),"Restaurants"]})}),e.jsx(n,{sx:{bgcolor:r==="hotels"?x.bgColor:"white",color:r==="hotels"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("hotels")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(Z,{style:{height:"17px",position:"relative",top:"1px"}}),"Hotels"]})}),e.jsx(n,{sx:{bgcolor:r==="hospitals"?x.bgColor:"white",color:r==="hospitals"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("hospitals")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(ae,{style:{height:"17px",position:"relative",top:"1px"}}),"Hospitals"]})}),e.jsx(n,{sx:{bgcolor:r==="atm"?x.bgColor:"white",color:r==="atm"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("atm")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(se,{style:{height:"17px",position:"relative",top:"1px"}}),"ATMs"]})}),e.jsx(n,{sx:{bgcolor:r==="car_repair"?x.bgColor:"white",color:r==="car_repair"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("car_repair")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(te,{style:{height:"17px",position:"relative",top:"1px"}}),"Service center"]})}),e.jsx(n,{sx:{bgcolor:r==="gasstation"?x.bgColor:"white",color:r==="gasstation"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("gasstation")},children:e.jsxs(_,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(ee,{style:{height:"17px",position:"relative",top:"1px"}}),"Gas Stations"]})})]})},Ge=Fe;function Ne({showCard:v}){const{center:r,selectedParameterList:V,selectedVehicle:p,vehicleList:h,icons:u,locationData:f,placesData:m,imeiNumbers:R,onlineVehicle:M}=I(t=>t.liveMap),[L,A]=s.useState(null),[b,D]=s.useState(""),[$,k]=s.useState([]),[C,z]=s.useState([]),[g,c]=s.useState(),[i,S]=s.useState(),H=G(),{isLoaded:j,loadError:d}=be({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU",loadingElement:e.jsx(_e,{})});if(s.useEffect(()=>{j&&A(window.google.maps)},[j]),s.useEffect(()=>{c(f)},[f]),s.useEffect(()=>{S(V)},[V]),s.useEffect(()=>(F.on("locationinfo",t=>{if(console.log("locationinfo",t),g.map(o=>{if(o.latestDocument.imei===t.imei){const a={lat:o.latestDocument.lat,lng:o.latestDocument.lng},l=500,O=60,q=l/(1e3/O),oe=(t.lat-a.lat)/q,re=(t.lng-a.lng)/q;let E=0;const ie=setInterval(()=>{const le=a.lat+oe*E,ne=a.lng+re*E,ce={...o,latestDocument:{...o.latestDocument,lat:le,lng:ne}};E++,E>=q&&clearInterval(ie),c(pe=>pe.map(K=>K.latestDocument.imei===t.imei?ce:K))},1e3/O)}return o}),String(t==null?void 0:t.imei)===String(i[0].imei)){const o=i[0].params.map(a=>{let l=a.label;return{...a,value:t[l]}});S([{...i[0],params:o}])}}),()=>{F.off("locationinfo")}),[F,g]),s.useEffect(()=>{H(de({}))},[p]),s.useEffect(()=>{if(f.length>0&&M.length>0){const t=[],o=[];f.forEach(a=>{M.some(O=>String(O)===String(a._id))?t.push(a):o.push(a)}),k(t),z(o)}else k([]),z([])},[f,M]),s.useEffect(()=>{console.log("onVehicles",$),console.log("offVehicles",C)},[$]),d)return"Error loading maps";if(!j)return"Loading maps";if(!L)return null;const P={height:v?"87vh":"95vh",width:"100%"};return e.jsxs(e.Fragment,{children:[v&&e.jsx(n,{sx:{bgcolor:x.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:i[0].params.length>0?e.jsxs(e.Fragment,{children:[i[0].params.length>0&&e.jsxs(B,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",i[0].reg_id]}),i.length>0&&i[0].params.map((t,o)=>(console.log("item",t),e.jsx(B,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:t.label==="speed"?`${t.label} : ${t.value} km/h`:t.label==="mainInputVoltage"?`${t.label} : ${t.value} voltage`:t.label==="ignition"?`${t.label} : ${t.value===!0?"On":"Off"}`:`${t.label} : ${t.value}`},o)))]}):e.jsx(e.Fragment,{children:e.jsx(B,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})}),e.jsxs(Se,{mapContainerStyle:P,zoom:10,center:r,children:[Object.keys(p).length>0&&e.jsx(Ge,{setPlace:D,place:b}),m&&m.length>0&&m.map((t,o)=>{var a,l;return e.jsx(Q,{position:{lat:parseFloat((a=t==null?void 0:t.location)==null?void 0:a.lat),lng:parseFloat((l=t==null?void 0:t.location)==null?void 0:l.lng)},animation:"BOUNCE",icon:{path:u[`${b}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},o)}),g&&g.length>0&&g.map((t,o)=>e.jsx(Q,{position:{lat:t.latestDocument.lat,lng:t.latestDocument.lng},icon:{path:Te.path1,fillColor:Object.keys(p).length>0&&p.imei===t.latestDocument.imei?"green":x.bgColor,fillOpacity:2,strokeWeight:1,scale:2}},o))]})]})}const Te={path1:"M20 11c-.18 0-.36.03-.53.05L17.41 9H20V6l-3.72 1.86L13.41 5H9v2h3.59l2 2H11l-4 2-2-2H0v2h4c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4l2 2h3l3.49-6.1 1.01 1.01c-.91.73-1.5 1.84-1.5 3.09 0 2.21 1.79 4 4 4s4-1.79 4-4-1.79-4-4-4M4 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m16 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"};function ct(){const{locationData:v,selectedVehicle:r,selectedParameterList:V}=I(c=>c.liveMap),[p,h]=s.useState([]),{w_customer_id:u}=I(c=>c.auth),[f,m]=s.useState(),[R,M]=s.useState(!1),[L,A]=s.useState(!1),[b,D]=s.useState([]),[$,k]=s.useState(!1);let C=G();s.useEffect(()=>{z()},[]),s.useEffect(()=>{D([])},[r]);const z=async()=>{let c=[],i=[];(await C(xe({w_customer_id:u}))).payload.map(d=>{c.push({id:d.id,label:d.registration_id,value:d.imei[0].mac_id}),i.push(d.imei[0].mac_id)});const H="one",j=i;i.length>0&&C(ve({type:H,imei:j})),h(c)},g=async c=>{const{label:i,imei:S,_id:H,reg_id:j,checked:d}=c;m(a=>a.map(l=>l._id===H?{...l,checked:!d}:l));let P=[...b],t=[...b];if(!d)v.forEach(a=>{a.latestDocument.imei===S&&(P.push({label:i,value:a.latestDocument[i]}),t=P,D(P))});else{let a=b.filter(l=>l.label!==i);t=a,D(a)}console.log("tempParamList",t),C(fe([{reg_id:j,imei:S,params:t}]))};return e.jsxs("div",{className:"app",children:[e.jsx(me,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(ge,{title:"Live Map",setShowVehicles:M,showVehicles:R,showParameters:L,setShowParameters:A,setShowCard:k,showCard:$}),e.jsxs(n,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(n,{style:{width:R||L?"80%":"100%"},children:e.jsx(Ne,{showCard:$})}),R&&e.jsx(n,{style:{width:"20%"},children:e.jsx(je,{vehicleData:p,title:"Live Map",setParameterData:m})}),L&&e.jsx(n,{style:{width:"20%"},children:e.jsx(ye,{parametersData:f,setParameterData:m,handleParameterChange:g})})]})]})]})}export{ct as default};
