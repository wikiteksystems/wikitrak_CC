import{p as Ve,q as Be,w as R,x as ye,y as se,z as ze,A as Ge,B as qe,r as i,C as He,D as U,j as e,E as Q,F as Ue,H as be,I as ee,J as te,K as We,L as de,M as W,N as pe,O as Ie,T as G,a as _,G as Z,c as H,u as oe,P as je,t as Ye,Q as Xe,R as Je,S as we,i as ue,U as Ke,V as ne,W as Qe,X as Ze,Y as Se,Z as ae,$ as et,_ as z,b as Ce,l as tt,m as ot,n as rt,o as st,v as nt}from"./index-CB2caPtQ.js";import{L as at}from"./LightModeOutlined-qi0z6xns.js";import{s as le}from"./Socket-0N_gnJcr.js";import{p as lt,R as it,L as ct,X as dt,Y as pt,a as ut,b as ht,T as gt}from"./LineChart-BwEaaLGF.js";import{t as Y,d as xt}from"./Search-Cf60xK1F.js";import{B as v,C as he}from"./CircularProgress-DKmmWfww.js";import{P as ft}from"./Paper-tcZZLN3c.js";import{c as mt,S as vt}from"./Switch-CTydxWy_.js";import{c as yt,I as bt}from"./IconButton-cf6EpcN5.js";import{r as jt,m as wt,a as St}from"./mergeSlotProps-BDJbx6qQ.js";import{C as Ae}from"./index-CCe2I8lo.js";import{d as Pe}from"./index-BUvVPk_e.js";import{u as Le,f as Fe,F as Ct,I as Pt,O as kt,a as Dt}from"./OutlinedInput-B4fTUg8N.js";import{D as It}from"./DateTimePicker-B3iW8qEu.js";import{r as ge}from"./createSvgIcon-h7cY2R_O.js";import{T as At,a as Lt,d as Ft,b as Mt,c as ie}from"./TableRow-rqSC_qnh.js";import{T as Rt}from"./TopBar-BE69dcwm.js";import{G as Tt}from"./GeofencAlert-Befpb-ug.js";import{V as Et,F as Nt,P as _t,f as ke,S as $t,I as Ot,M as Vt,T as Bt,O as zt,a as Gt,b as qt}from"./Vector-BEQdHjna.js";import{u as Ht}from"./esm-BQ4BBSAR.js";import"./index-CuJWGfdk.js";import"./roundedArrow-D3ZSUAlm.js";import"./button-YRxhFyJQ.js";import"./NotificationsNone-D582VXoq.js";const Ut=["component","direction","spacing","divider","children","className","useFlexGap"],Wt=Ve(),Yt=Be("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,o)=>o.root});function Xt(t){return Ue({props:t,name:"MuiStack",defaultTheme:Wt})}function Jt(t,o){const s=i.Children.toArray(t).filter(Boolean);return s.reduce((n,u,l)=>(n.push(u),l<s.length-1&&n.push(i.cloneElement(o,{key:`separator-${l}`})),n),[])}const Kt=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],Qt=({ownerState:t,theme:o})=>{let s=R({display:"flex",flexDirection:"column"},ye({theme:o},se({values:t.direction,breakpoints:o.breakpoints.values}),n=>({flexDirection:n})));if(t.spacing){const n=ze(o),u=Object.keys(o.breakpoints.values).reduce((y,p)=>((typeof t.spacing=="object"&&t.spacing[p]!=null||typeof t.direction=="object"&&t.direction[p]!=null)&&(y[p]=!0),y),{}),l=se({values:t.direction,base:u}),x=se({values:t.spacing,base:u});typeof l=="object"&&Object.keys(l).forEach((y,p,f)=>{if(!l[y]){const P=p>0?l[f[p-1]]:"column";l[y]=P}}),s=Ge(s,ye({theme:o},x,(y,p)=>t.useFlexGap?{gap:be(n,y)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Kt(p?l[p]:t.direction)}`]:be(n,y)}}))}return s=qe(o.breakpoints,s),s};function Zt(t={}){const{createStyledComponent:o=Yt,useThemeProps:s=Xt,componentName:n="MuiStack"}=t,u=()=>ee({root:["root"]},y=>te(n,y),{}),l=o(Qt);return i.forwardRef(function(y,p){const f=s(y),h=He(f),{component:P="div",direction:C="column",spacing:a=0,divider:w,children:c,className:k,useFlexGap:I=!1}=h,g=U(h,Ut),A={direction:C,spacing:a,useFlexGap:I},D=u();return e.jsx(l,R({as:P,ownerState:A,ref:p,className:Q(D.root,k)},g,{children:w?Jt(c,w):c}))})}const eo=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],to=["component","slots","slotProps"],oo=["component"];function ro(t,o){const{className:s,elementType:n,ownerState:u,externalForwardedProps:l,getSlotOwnerState:x,internalForwardedProps:d}=o,y=U(o,eo),{component:p,slots:f={[t]:void 0},slotProps:h={[t]:void 0}}=l,P=U(l,to),C=f[t]||n,a=jt(h[t],u),w=wt(R({className:s},y,{externalForwardedProps:t==="root"?P:void 0,externalSlotProps:a})),{props:{component:c},internalRef:k}=w,I=U(w.props,oo),g=We(k,a==null?void 0:a.ref,o.ref),A=x?x(I):{},D=R({},u,A),b=t==="root"?c||p:c,L=St(C,R({},t==="root"&&!p&&!f[t]&&d,t!=="root"&&!f[t]&&d,I,b&&{as:b},{ref:g}),D);return Object.keys(A).forEach(F=>{delete L[F]}),[C,L]}const so=yt(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function no(t){return te("MuiAvatar",t)}de("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const ao=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],lo=mt(),io=t=>{const{classes:o,variant:s,colorDefault:n}=t;return ee({root:["root",s,n&&"colorDefault"],img:["img"],fallback:["fallback"]},no,o)},co=W("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,o[s.variant],s.colorDefault&&o.colorDefault]}})(({theme:t})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:R({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:R({backgroundColor:t.palette.grey[400]},t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})))}]})),po=W("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(t,o)=>o.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),uo=W(so,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(t,o)=>o.fallback})({width:"75%",height:"75%"});function ho({crossOrigin:t,referrerPolicy:o,src:s,srcSet:n}){const[u,l]=i.useState(!1);return i.useEffect(()=>{if(!s&&!n)return;l(!1);let x=!0;const d=new Image;return d.onload=()=>{x&&l("loaded")},d.onerror=()=>{x&&l("error")},d.crossOrigin=t,d.referrerPolicy=o,d.src=s,n&&(d.srcset=n),()=>{x=!1}},[t,o,s,n]),u}const go=i.forwardRef(function(o,s){const n=lo({props:o,name:"MuiAvatar"}),{alt:u,children:l,className:x,component:d="div",slots:y={},slotProps:p={},imgProps:f,sizes:h,src:P,srcSet:C,variant:a="circular"}=n,w=U(n,ao);let c=null;const k=ho(R({},f,{src:P,srcSet:C})),I=P||C,g=I&&k!=="error",A=R({},n,{colorDefault:!g,component:d,variant:a}),D=io(A),[b,L]=ro("img",{className:D.img,elementType:po,externalForwardedProps:{slots:y,slotProps:{img:R({},f,p.img)}},additionalProps:{alt:u,src:P,srcSet:C,sizes:h},ownerState:A});return g?c=e.jsx(b,R({},L)):l||l===0?c=l:I&&u?c=u[0]:c=e.jsx(uo,{ownerState:A,className:D.fallback}),e.jsx(co,R({as:d,ownerState:A,className:Q(D.root,x),ref:s},w,{children:c}))}),xo=go,fo=Zt({createStyledComponent:W("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,o)=>o.root}),useThemeProps:t=>pe({props:t,name:"MuiStack"})}),mo=fo;function vo(t){return te("MuiFormControlLabel",t)}const yo=de("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),K=yo,bo=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],jo=t=>{const{classes:o,disabled:s,labelPlacement:n,error:u,required:l}=t,x={root:["root",s&&"disabled",`labelPlacement${Ie(n)}`,u&&"error",l&&"required"],label:["label",s&&"disabled"],asterisk:["asterisk",u&&"error"]};return ee(x,vo,o)},wo=W("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[{[`& .${K.label}`]:o.label},o.root,o[`labelPlacement${Ie(s.labelPlacement)}`]]}})(({theme:t,ownerState:o})=>R({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${K.disabled}`]:{cursor:"default"}},o.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},o.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},o.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${K.label}`]:{[`&.${K.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})),So=W("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,o)=>o.asterisk})(({theme:t})=>({[`&.${K.error}`]:{color:(t.vars||t).palette.error.main}})),Co=i.forwardRef(function(o,s){var n,u;const l=pe({props:o,name:"MuiFormControlLabel"}),{className:x,componentsProps:d={},control:y,disabled:p,disableTypography:f,label:h,labelPlacement:P="end",required:C,slotProps:a={}}=l,w=U(l,bo),c=Le(),k=(n=p??y.props.disabled)!=null?n:c==null?void 0:c.disabled,I=C??y.props.required,g={disabled:k,required:I};["checked","name","onChange","value","inputRef"].forEach($=>{typeof y.props[$]>"u"&&typeof l[$]<"u"&&(g[$]=l[$])});const A=Fe({props:l,muiFormControl:c,states:["error"]}),D=R({},l,{disabled:k,labelPlacement:P,required:I,error:A.error}),b=jo(D),L=(u=a.typography)!=null?u:d.typography;let F=h;return F!=null&&F.type!==G&&!f&&(F=e.jsx(G,R({component:"span"},L,{className:Q(b.label,L==null?void 0:L.className),children:F}))),e.jsxs(wo,R({className:Q(b.root,x),ownerState:D,ref:s},w,{children:[i.cloneElement(y,g),I?e.jsxs(mo,{display:"block",children:[F,e.jsxs(So,{ownerState:D,"aria-hidden":!0,className:b.asterisk,children:["â€‰","*"]})]}):F]}))}),Po=Co;function ko(t){return te("MuiFormGroup",t)}de("MuiFormGroup",["root","row","error"]);const Do=["className","row"],Io=t=>{const{classes:o,row:s,error:n}=t;return ee({root:["root",s&&"row",n&&"error"]},ko,o)},Ao=W("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,s.row&&o.row]}})(({ownerState:t})=>R({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),Lo=i.forwardRef(function(o,s){const n=pe({props:o,name:"MuiFormGroup"}),{className:u,row:l=!1}=n,x=U(n,Do),d=Le(),y=Fe({props:n,muiFormControl:d,states:["error"]}),p=R({},n,{row:l,error:y.error}),f=Io(p);return e.jsx(Ao,R({className:Q(f.root,u),ownerState:p,ref:s},x))}),Fo=Lo,Mo=({imeiNo:t})=>{const{selectedVehicle:o,parameterData:s,ivnPid:n,locationData:u,vehicleList:l,onlineVehicle:x}=_(b=>b.liveMap),{ivnParameters:d,mode:y}=_(b=>b.dashboard),p=Y(y),[f,h]=i.useState(),[P,C]=i.useState(!1),[a,w]=i.useState();i.useState({mainInputVoltage:0,ignition:0,speed:0});const[c,k]=i.useState("Not Available"),[I,g]=i.useState("Offline");i.useEffect(()=>{A()},[o]);const A=()=>{var b,L,F,$;if((u==null?void 0:u.length)>0){console.log("locationData",u);let j=u==null?void 0:u.find(T=>T.latestDocument.imei===o.imei);j?(h((b=j==null?void 0:j.latestDocument)==null?void 0:b.speed),C((L=j==null?void 0:j.latestDocument)==null?void 0:L.ignition),w((F=j==null?void 0:j.latestDocument)==null?void 0:F.mainInputVoltage),k(($=j==null?void 0:j.latestDocument)==null?void 0:$.venderId)):(h(0),C(0),w(0),k("Not Available"))}else h(0),C(0),w(0),k("Not Available")};i.useEffect(()=>{Object.keys(o).length>0&&D()},[o]);const D=()=>{if(Object.keys(o).length>0)if(x&&x.length>0){const b=x.some(L=>parseInt(L)===parseInt(o==null?void 0:o.imei));g(b?"Online":"Offline")}else g("Offline");else g("Offline")};return e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{mx:"10px",pt:"10px",color:p.grey[400]},children:e.jsx("b",{children:o==null?void 0:o.reg_id})}),e.jsx(v,{sx:{backgroundColor:p.grey[200],height:"12vh",borderRadius:"8px",p:"5px"},children:e.jsx(v,{sx:{},children:e.jsx(Z,{container:!0,spacing:3,mt:"2.5px",children:e.jsx(Z,{item:!0,xs:12,children:e.jsx(Z,{container:!0,justifyContent:"space-around",spacing:3,children:[{label:"VenderId",value:c},{label:"Speed",value:f,unit:"km/h"},{label:"Main Input Voltage",value:parseFloat(a).toFixed(2),unit:"voltage"},{label:"Current Status",value:I}].map((b,L)=>e.jsx(Z,{item:!0,children:e.jsxs(ft,{sx:{height:70,width:250,backgroundColor:p.grey[100],color:p.grey[400],display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px"},children:[e.jsxs(v,{children:[e.jsx(G,{variant:"h6",sx:{fontSize:"12px"},children:b.label}),e.jsxs(G,{variant:"h6",sx:{fontSize:"18px",fontWeight:"bold"},children:[b.value," ",b==null?void 0:b.unit]})]}),e.jsx(xo,{src:lt,sx:{width:20,height:20}})]})},L))})})})})})]})},ce=({title:t,selectedTripData:o})=>{const{mode:s,loading:n}=_(p=>p.dashboard),{selectedVehicle:u}=_(p=>p.liveMap),[l,x]=i.useState([]);i.useEffect(()=>{let p=o.map(h=>{let P={...h};return P.ignition=P.ignition?1:0,P});const f=y(p);x(f)},[o]);const d=Y(s),y=p=>{let f=null;return p.forEach(h=>{const P=new Date(h.createdAt);f&&f.toDateString()===P.toDateString()?(h.date=H(h.createdAt).format("HH:mm:ss"),h.ignition=h.ignition?1:0):(h.date=H(h.createdAt).format("DD-MM-YYYY"),h.ignition=h.ignition?1:0),f=P}),p};return e.jsx(v,{sx:{ml:"2rem",border:d.grey[300],fontSize:"13px",height:"24vh",color:d.grey[400],backgroundColor:d.grey[100],borderRadius:"5px"},children:l&&l.length>0?e.jsx(it,{children:e.jsxs(ct,{data:l,margin:{top:15,right:10,left:-25,bottom:0},children:[e.jsx(dt,{dataKey:"date",stroke:d.grey[400]}),e.jsx(pt,{stroke:d.grey[400]}),e.jsx(ut,{type:"monotone",dataKey:t,dot:!1,stroke:"#EF5B05",strokeWidth:2}),e.jsx(ht,{layout:"horizontal",verticalAlign:"top",align:"center"}),e.jsx(gt,{})]})}):e.jsx(Ae,{style:{background:d.grey[100],width:"400px",height:"100px",margin:"auto",marginTop:"10px"},children:Object.keys(u).length===0?e.jsx(G,{textAlign:"center",align:"center",mt:"20px",color:d.grey[600],children:"Please Select a Vehicle"}):n?e.jsx(he,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(G,{textAlign:"center",color:d.grey[600],children:"Sorry! No Trips Available"})})})},Ro=({vehicleData:t})=>{const o=["Engine RPM","Engine coolant temperature","Battery Potential"],s=oe(),{selectedVehicle:n,loading:u}=_(c=>c.liveMap),{startDate:l,endDate:x,mode:d}=_(c=>c.dashboard),[y,p]=i.useState(""),f=Y(d),h=i.useRef(null),P=i.useRef(0),C=t.length>0&&t.filter(c=>c.label.toLowerCase().includes(y.toLowerCase())),a=c=>{p(c.target.value)},w=async c=>{var A;h.current&&(P.current=h.current.scrollTop),s(Xe({imei:c.value,reg_id:c.label})),c.value,Pe().subtract(5,"day"),Pe();let k=c.label;const I=await s(Je({registration_id:k}));let g=[];if(I&&I.payload.length>0&&((A=I.payload)==null||A.map(D=>{D.ivn_parameter.length>0&&g.push(D.ivn_parameter[0])})),g.length>0){let D=g.filter(b=>o.includes(b.pid_description));s(we(D))}else s(we([]));setTimeout(()=>{h.current&&(h.current.scrollTop=P.current)},0)};return i.useEffect(()=>{h.current&&(h.current.scrollTop=P.current)},[u,C,n]),e.jsx(e.Fragment,{children:u?e.jsx("div",{children:e.jsx(v,{sx:{display:"flex",justifyContent:"center",height:"88vh",alignItems:"center"},children:e.jsx(he,{})})}):e.jsxs("div",{ref:h,style:{overflowY:"auto",height:"90vh"},children:[e.jsx(v,{sx:{align:"center",my:"15px",ml:"20px"},children:e.jsxs(Ct,{sx:{width:"90%",backgroundColor:"white",borderRadius:"5px"},variant:"outlined",children:[e.jsx(Pt,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px"},children:"Search"}),e.jsx(kt,{onChange:c=>a(c),inputProps:{style:{padding:7}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(Dt,{position:"end",children:e.jsx(bt,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(xt,{})})}),label:"Search"})]})}),e.jsx(v,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsxs(je,{variant:"outlined",sx:{width:"90%",color:f.grey[400],"&:hover":{color:"#DAE0EE"}},children:["Total Vehicle: ",C.length]})}),C.length>0&&C.map((c,k)=>e.jsx(v,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(je,{variant:"outlined",onClick:()=>w(c),sx:{width:"90%",bgcolor:c.label===n.reg_id?Ye.bgColor:"undefined",color:c.label===n.reg_id?"#DAE0EE":f.grey[400]},children:c.label})},k))]})})};var xe={},To=ue;Object.defineProperty(xe,"__esModule",{value:!0});var Me=xe.default=void 0,Eo=To(ge()),No=e;Me=xe.default=(0,Eo.default)((0,No.jsx)("path",{d:"M10.02 6 8.61 7.41 13.19 12l-4.58 4.59L10.02 18l6-6z"}),"NavigateNextOutlined");var fe={},_o=ue;Object.defineProperty(fe,"__esModule",{value:!0});var Re=fe.default=void 0,$o=_o(ge()),Oo=e;Re=fe.default=(0,$o.default)((0,Oo.jsx)("path",{d:"M15.61 7.41 14.2 6l-6 6 6 6 1.41-1.41L11.03 12z"}),"NavigateBeforeOutlined");var me={},Vo=ue;Object.defineProperty(me,"__esModule",{value:!0});var Te=me.default=void 0,Bo=Vo(ge()),De=e;Te=me.default=(0,Bo.default)([(0,De.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7M7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9"},"0"),(0,De.jsx)("circle",{cx:"12",cy:"9",r:"2.5"},"1")],"LocationOnOutlined");const zo=()=>{const t=oe(),o=Ke(),{tripList:s,selectedTripData:n,loading:u,trips:l,activeIndex:x,searchText:d,mode:y}=_(r=>r.dashboard),{selectedVehicle:p}=_(r=>r.liveMap),[f,h]=i.useState(0),[P,C]=i.useState(0),[a,w]=i.useState(0),[c,k]=i.useState(0),[I,g]=i.useState("0"),[A,D]=i.useState(0),[b,L]=i.useState(!1),F=Y(y),$=()=>{h(r=>r+3)},j=()=>{h(r=>Math.max(r-5,0))};i.useEffect(()=>{const r=T(s);if(r.length>0){t(ne(r[0]));const m=s&&s.length>0&&s.filter(S=>S.formatedDate.toLowerCase().includes(d.toLowerCase()));m.length>0&&J(0,m[0])}t(Qe(r))},[s]),i.useEffect(()=>{if(n.length>0){const r=n.map(S=>({lat:parseFloat(S.lat),lng:parseFloat(S.lng)})),m=new window.google.maps.Polygon({paths:r});ve(m)}},[n]);const T=r=>{const m=new Set,S=[];return r.forEach(M=>{m.has(M.formatedDate)||(m.add(M.formatedDate),S.push(M.formatedDate))}),S},O=s&&s.length>0&&s.filter(r=>r.formatedDate.toLowerCase().includes(d.toLowerCase())),X=r=>{if(O&&O.length>0){const m=s&&s.length>0&&s.filter(S=>S.formatedDate.toLowerCase().includes(r.toLowerCase()));t(ae(0)),t(ne(r)),J(0,m[0])}else t(ae(null)),t(ne(r))},J=async(r,m)=>{var E;let S={imei:p.imei,startDate:m.startDate,endDate:m.endDate};L(!0);const M=await Ze(S);((E=M==null?void 0:M.data)==null?void 0:E.documents.length)>0?(t(Se(M.data.documents[0].data)),Ee(M.data.documents[0].data),L(!1)):(k(0),w(0),D(0),C(0),g("0"),t(Se([])),L(!1)),t(ae(r))},Ee=r=>{let m=0,S=0;r.map((N,q)=>{N.packetType==="HB"&&m++,N.packetType==="HA"&&S++}),C(m),w(S);let M=Ne(new Date(r[0].createdAt).toISOString(),new Date(r[r.length-1].createdAt).toISOString());console.log("hours: ",M),g(M);const E=_e(r);D(E);const V=r.map(N=>({lat:parseFloat(N.lat),lng:parseFloat(N.lng)})),B=new window.google.maps.Polygon({paths:V});ve(B)};function Ne(r,m){var S=H(r),M=H(m);console.log("startDate-------->",r,m);let E=H.duration(M.diff(S)),V=E.hours(),B=E.minutes(),N=E.seconds(),q=`${V}h ${B}m ${N}s`;return console.log("string",q),q}function _e(r){let m=0;for(let S=0;S<r.length-1;S++){const M=r[S].lat,E=r[S].lng,V=r[S+1].lat,B=r[S+1].lng;m+=$e(M,E,V,B)}return m}function $e(r,m,S,M){const V=(S-r)*Math.PI/180,B=(M-m)*Math.PI/180,N=Math.sin(V/2)*Math.sin(V/2)+Math.cos(r*Math.PI/180)*Math.cos(S*Math.PI/180)*Math.sin(B/2)*Math.sin(B/2);return 6371*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))}const ve=r=>{if(!window.google||!window.google.maps.geometry){console.log("not loaded");return}const S=window.google.maps.geometry.spherical.computeArea(r.getPath())/4046.86;k(S)},Oe=r=>{console.log("activeIndex",x),console.log("i",r),x!==null?r===x?(t(et(!0)),o("/trip-monitor")):z.error("Trip not selected"):z.error("Please select the trip")};return e.jsxs(e.Fragment,{children:[e.jsxs(v,{sx:{width:"95%",display:"flex",overflow:"auto",mx:"10px"},children:[e.jsx("div",{style:{display:"flex"},children:l&&l.length>0&&l.slice(f,f+5).map((r,m)=>e.jsx(v,{sx:{backgroundColor:d===r?"#EF5B05":"white",color:d===r?"white":"#EF5B05",mx:"5px",p:"5px",borderRadius:"5px",width:"90px",height:"25px",textAlign:"center",cursor:"pointer"},onClick:()=>{X(r)},children:r},m))}),f!==0&&e.jsx("button",{onClick:j,style:{marginLeft:"5px",backgroundColor:"white",color:"black"},disabled:f===0,children:e.jsx(Re,{})}),!(f+5>=l.length)&&e.jsx("button",{onClick:$,style:{marginLeft:"5px",backgroundColor:"white",color:"black"},disabled:f+5>=l.length,children:e.jsx(Me,{})})]}),e.jsx(v,{children:O&&O.length>0?e.jsx(At,{sx:{maxHeight:210,height:210,width:"98%",ml:"10px",mt:"10px",borderRadius:"5px",border:"1px solid #dbdad5"},children:e.jsx(Lt,{stickyHeader:!0,"aria-label":"sticky table",children:e.jsx(Ft,{children:O&&O.length>0&&O.map((r,m)=>{var S,M,E,V,B,N,q,re;return e.jsxs(Mt,{sx:{backgroundColor:x===m?"#DAE0EE":F.grey[100]},children:[e.jsxs(ie,{align:"left",style:{fontSize:"12px",padding:10,color:x===m?"black":F.grey[400],cursor:"pointer"},onClick:()=>{J(m,r)},children:[m+1,"."," ",`${(M=(S=r==null?void 0:r.startLocation)==null?void 0:S.address)==null?void 0:M.town}, ${(V=(E=r.startLocation)==null?void 0:E.address)==null?void 0:V.city}`," ","to "," ",`${(N=(B=r==null?void 0:r.endLocation)==null?void 0:B.address)==null?void 0:N.town}, ${(re=(q=r==null?void 0:r.endLocation)==null?void 0:q.address)==null?void 0:re.city}`]}),e.jsxs(ie,{align:"right",style:{fontSize:"12px",padding:10,color:x===m?"black":F.grey[400]},children:[r!=null&&r.startDate?H(new Date(r.startDate).toISOString()).format("LT"):""," ","to"," ",r!=null&&r.endDate?H(new Date(r.endDate).toISOString()).format("LT"):"----"]}),e.jsx(ie,{align:"right",style:{fontSize:"12px",padding:10,color:x===m?"black":F.grey[400]},children:e.jsx("span",{title:"Navigate to map",style:{cursor:"pointer"},onClick:()=>{Oe(m)},children:e.jsx(Te,{})})})]},m)})})})}):e.jsx(v,{sx:{height:210,display:"flex",justifyContent:"center",alignItems:"center",color:F.grey[400],margin:"auto"},children:e.jsx(Ae,{style:{background:F.grey[100],width:"400px",height:"100px"},children:Object.keys(p).length===0?e.jsx(G,{textAlign:"center",align:"center",mt:"20px",color:F.grey[600],children:"Please Select a Vehicle"}):u?e.jsx(he,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(G,{textAlign:"center",color:F.grey[600],children:"Sorry! No Trips Available"})})})}),n.length>0&&e.jsx(v,{sx:{my:"0px"},children:e.jsxs(v,{sx:{display:"flex",mx:"5px",mt:"5px"},children:[e.jsxs(v,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Braking"}),e.jsx("div",{children:"0"})]}),e.jsxs(v,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Acceleration"}),e.jsx("div",{children:"0"})]}),e.jsxs(v,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Running Hrs"}),e.jsx("div",{children:I})]}),e.jsxs(v,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Distance"}),e.jsx("div",{children:parseFloat(parseFloat(A).toFixed(2))})]})]})})]})},Go=()=>{const{mode:t}=_(s=>s.dashboard),o=Y(t);return e.jsxs(v,{children:[e.jsxs(v,{sx:{display:"flex",ml:"5px"},children:[e.jsx(v,{sx:{m:"5px",fontSize:"20px",width:"60%",color:o.grey[400]},children:e.jsx("b",{children:"Trip History"})}),e.jsx(v,{children:e.jsx(It,{})})]}),e.jsx(v,{sx:{my:"5px"},children:e.jsx(zo,{})})]})},qo=()=>{const t=oe(),{center:o,selectedParameterList:s,selectedVehicle:n,vehicleList:u,tractorIcon:l,icons:x,locationData:d,ivnPid:y,placesData:p}=_(j=>j.liveMap),{mode:f}=_(j=>j.dashboard),{isLoaded:h,loadError:P}=Ht({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"}),[C,a]=i.useState(null),[w,c]=i.useState(!0),[k,I]=i.useState(5),[g,A]=i.useState(),D=Y(f),b=i.useRef(null),L=i.useRef(new Et),F=()=>new Vt({target:b.current,layers:[new Bt({source:new zt,attributions:""}),new Gt({source:L.current})],view:new qt({center:ke([78,21]),zoom:k}),controls:[]});i.useEffect(()=>{h&&a(window.google.maps)},[h]),i.useEffect(()=>{if(w)A(d);else{let j=d==null?void 0:d.filter(T=>(T==null?void 0:T._id)===(n==null?void 0:n.imei));A(j)}},[d,n,w]),i.useEffect(()=>{if(b.current&&C){const j=F();return b.current=j,()=>{j&&j.setTarget(null)}}},[C]),i.useEffect(()=>{b.current&&g&&g.length>0&&(L.current.clear(),g.forEach(j=>{const{lat:T,lng:O}=j.latestDocument,X=new Nt({geometry:new _t(ke([O,T]))});X.setStyle(new $t({image:new Ot({src:"http://maps.google.com/mapfiles/ms/icons/red-dot.png",scale:1})})),L.current.addFeature(X)}))},[g]);const $=()=>{if(!w)t(Ce({lat:21,lng:78})),I(4),c(T=>!T);else{const j=d.find(T=>T.latestDocument.imei===n.imei);if(j){const{lat:T,lng:O}=j.latestDocument;t(Ce({lat:T,lng:O})),I(12),c(J=>!J)}else z.error("Data is not available for selected vehicle")}};return P?"Error loading maps":h?C?e.jsxs("div",{children:[e.jsxs(v,{sx:{ml:"10px",fontSize:"20px",display:"flex",justifyContent:"space-between",color:D.grey[400]},children:[e.jsx("b",{children:"Live Map"}),e.jsx(Fo,{sx:{marginLeft:0,paddingTop:0,color:D.grey[400]},children:e.jsx(Po,{control:e.jsx(vt,{checked:w,onChange:$}),label:w?"Group":"Individual"})})]}),e.jsx("div",{ref:b,style:{height:"41.5vh",width:"99%",marginTop:"0px",marginLeft:"10px"}})]}):"No map":"Loading maps"},xr=()=>{const{w_customer_id:t}=_(a=>a.auth),{mode:o,selectedTripData:s}=_(a=>a.dashboard),[n,u]=i.useState(()=>{const a=sessionStorage.getItem("imeiNo");return a?JSON.parse(a):[]}),l=oe(),x=Y(o),[d,y]=i.useState([]),[p,f]=i.useState(!1),[h,P]=i.useState(!1);i.useEffect(()=>{C()},[]),i.useEffect(()=>{sessionStorage.setItem("imeiNo",JSON.stringify(n))},[n]),i.useEffect(()=>{le.on("geofenceAlert",a=>{(a==null?void 0:a.imei)!==null&&n.find(k=>parseInt(k)===(a==null?void 0:a.imei))&&(console.log("geofence"),z.error(`Type: ${a==null?void 0:a.type} ${a==null?void 0:a.msg} ${a==null?void 0:a.imei}`,{id:"geofence",autoClose:5e3}))}),le.on("speedAlert",a=>{(a==null?void 0:a.imei)!==null&&n.find(k=>parseInt(k)===(a==null?void 0:a.imei))&&z.error(`${a==null?void 0:a.msg} ${a==null?void 0:a.imei}`,{id:"speed",autoClose:5e3})})},[le]);const C=async()=>{try{let a=[],w=[];const c=await l(tt({w_customer_id:t}));if(Array.isArray(c.payload)){c.payload.forEach(g=>{var A,D;Array.isArray(g.imei)&&g.imei.length>0?(a.push({id:g.id,label:g.registration_id,value:(A=g==null?void 0:g.imei[0])==null?void 0:A.mac_id}),w.push((D=g.imei[0])==null?void 0:D.mac_id)):(console.error("IMEI data not found for item:",g),z.error(`IMEI Number not found for the vehicle: ${g==null?void 0:g.registration_id}`))}),u(w);const k="one",I=w;w.length>0&&(l(ot({type:k,imei:I})),l(rt(I))),y(a),l(st({w_customer_id:t})),l(nt({}))}else console.error("Unexpected data format:",c),z.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),z.error(`Error fetching vehicle data: ${a}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(at,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Rt,{title:"Dashboard",showVehicles:p,setShowVehicles:f,setShowNotification:P,showNotification:h}),e.jsxs("div",{style:{height:"92vh",backgroundColor:x.grey[100],padding:"10px"},children:[p&&e.jsx(v,{sx:{position:"fixed",width:"250px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:x.grey[100],overflowY:"auto",scrollBehavior:"smooth",scrollbarWidth:"thin"},children:e.jsx(Ro,{vehicleData:d})}),h&&e.jsx(v,{sx:{position:"fixed",width:"300px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:x.grey[100]},children:e.jsx(Tt,{})}),e.jsx(v,{sx:{height:"21%"},children:e.jsx(Mo,{imeiNo:n})}),e.jsxs(v,{sx:{display:"flex",height:"50%"},children:[e.jsx(v,{sx:{width:"50%",border:"1px solid #E8E8E8",padding:"2px",borderRadius:"5px"},children:e.jsx(Go,{})}),e.jsx(v,{sx:{width:"50%"},children:e.jsx(qo,{})})]}),e.jsxs(v,{sx:{display:"flex",height:"30%",mt:"5px",pt:"10px"},children:[e.jsx(v,{style:{width:"33%"},children:e.jsx(ce,{title:"speed",selectedTripData:s})}),e.jsx(v,{style:{width:"33%"},children:e.jsx(ce,{title:"mainInputVoltage",selectedTripData:s})}),e.jsx(v,{style:{width:"33%"},children:e.jsx(ce,{title:"ignition",selectedTripData:s})})]})]})]})]})};export{xr as default};
