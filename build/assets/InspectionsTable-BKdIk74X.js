import{j as s,B as L,i as V,k as D,r as p,I as Y,ai as z,aS as N,aT as J,aR as K,w as j,ak as Q,aF as X,ad as Z}from"./index-DaJXyhBR.js";import{D as ee,a as se,b as ae,T as oe}from"./TablePagination-B7veUUTy.js";import{D as te,a as ne,E as re,T as y}from"./Edit-D84HsNa1.js";import{B as $}from"./menu2-DLS89sHM.js";import{T as ce,a as le}from"./TableHead-DKLmySYE.js";import{T as ie,b as A,a as ue}from"./TableRow-DnESN5TU.js";import{T as u}from"./TableCell-BCgAckm1.js";const de=({open:r,onClose:l,onConfirm:h})=>s.jsxs(ee,{open:r,onClose:l,children:[s.jsx(te,{children:"Confirm Deletion"}),s.jsx(se,{children:s.jsxs(ne,{children:["Are you sure you want to delete this vehicle data?"," ",s.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),s.jsxs(ae,{children:[s.jsx(L,{onClick:l,color:"primary",children:"Cancel"}),s.jsx(L,{onClick:h,color:"secondary",children:"Delete"})]})]}),pe="http://134.209.145.234/api/v1",he={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},xe=({inspectionData:r})=>{const l=V(),{isUpdateInspection:h}=D(c=>c.inspection),[x,f]=p.useState(!1),d=()=>{console.log("inspectionData",r);const c=localStorage.getItem("role");z.includes(c)?(l(N(!h)),l(J(r)),l(K(r))):j.error(`Sorry! Your role is ${c}. You're not allowed to add, edit or delete the vehicle`)},b=async()=>{console.log("Vehicle data deleting");try{await Q.delete(`${pe}/vehicles/delete/${vehicleData.id}/`),j.success("Vehicle data deleted successfully!"),l(X())}catch(c){console.error("Error deleting vehicle data:",c),j.error("Failed to delete vehicle data. Please try again.")}f(!1)},g=()=>{f(!1)},C={color:"#686868"};return s.jsxs($,{sx:he,children:[s.jsx(Y,{onClick:d,children:s.jsx(re,{sx:C})}),s.jsx(de,{open:x,onClose:g,onConfirm:b})]})},ge=[{id:"BDID",label:"BDID"},{id:"User",label:"User"},{id:"SubmissionDate",label:"Submission Date"},{id:"WorkshopGroup",label:"Workshop Group"},{id:"Status",label:"Status"}],fe=({where:r})=>{const{breakdowns:l}=D(e=>e.breakdown),{searchTerm:h}=D(e=>e.inspection),[x,f]=p.useState("asc"),[d,b]=p.useState("BDID"),[g,C]=p.useState(0),[c,R]=p.useState(5),[U,Ce]=p.useState({id:"",status:"",workshop:"",user:""}),O=e=>{f(d===e&&x==="asc"?"desc":"asc"),b(e)},E=(e,o)=>{C(o)},F=e=>{R(parseInt(e.target.value,10)),C(0)},M=(e,o,i)=>e.filter(a=>{var m,B,S,T,I,P,v;const t=i.toLowerCase(),n=(m=a==null?void 0:a.breakdown_id)==null?void 0:m.toLowerCase().includes(t),_=`${(S=(B=a==null?void 0:a.user)==null?void 0:B.us_user)==null?void 0:S.first_name} ${(I=(T=a==null?void 0:a.user)==null?void 0:T.us_user)==null?void 0:I.last_name}`.toLowerCase().includes(t),H=(P=a==null?void 0:a.status)==null?void 0:P.toLowerCase().includes(t),q=(v=a==null?void 0:a.workshop_group)==null?void 0:v.group_name.toLowerCase().includes(t);return!(i&&!(n||_||H||q)||o.id&&!a.breakdown_id.includes(o.id)||o.status&&a.status!==o.status||o.workshop&&a.workshop_group.group_name!==o.workshop||o.user&&!a.user.us_user.first_name.toLowerCase().includes(o.user.toLowerCase())&&!a.user.us_user.last_name.toLowerCase().includes(o.user.toLowerCase()))}),W=(e,o,i,a)=>{if(a==="User"){const t=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),n=`${o.user.us_user.first_name} ${o.user.us_user.last_name}`.toLowerCase();return i==="asc"?t.localeCompare(n):n.localeCompare(t)}if(a==="WorkshopGroup"){const t=e.workshop_group.group_name.toLowerCase(),n=o.workshop_group.group_name.toLowerCase();return i==="asc"?t.localeCompare(n):n.localeCompare(t)}if(a==="BDID"){const t=parseInt(e.breakdown_id.replace("BD-",""),10),n=parseInt(o.breakdown_id.replace("BD-",""),10);return i==="asc"?t-n:n-t}if(a==="SubmissionDate"){const t=new Date(e.submission_date),n=new Date(o.submission_date);return i==="asc"?t-n:n-t}if(a==="Status"){const t={Open:1,Close:2,Rejected:3},n=t[e.status]||0,_=t[o.status]||0;return i==="asc"?n-_:_-n}return 0},w=M(l.slice(),U,h).sort((e,o)=>W(e,o,x,d)),G=w.slice(g*c,g*c+c),k={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};return s.jsx($,{sx:{m:r!=="inspection report"&&"10px",width:r==="inspection report"?"60%":"99%"},children:s.jsxs(Z,{children:[s.jsx(ce,{sx:{height:r==="inspection report"?"50vh":"73vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(ie,{stickyHeader:!0,children:[s.jsx(le,{children:s.jsxs(A,{children:[ge.map(e=>s.jsx(u,{sx:k,children:s.jsx(y,{active:d===e.id,direction:d===e.id?x:"asc",onClick:()=>O(e.id),children:e.label})},e.id)),r!=="inspection report"&&s.jsx(u,{sx:k,children:s.jsx(y,{children:"Actions"})})]})}),s.jsx(ue,{children:G.map((e,o)=>s.jsxs(A,{children:[s.jsx(u,{children:e.breakdown_id}),s.jsx(u,{children:`${e.user.us_user.first_name} ${e.user.us_user.last_name}`}),s.jsx(u,{children:e.submission_date||"N/A"}),s.jsx(u,{children:e.workshop_group.group_name}),s.jsx(u,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),r!=="inspection report"&&s.jsx(u,{children:s.jsx(xe,{inspectionData:e})})]},o))})]})}),s.jsx(oe,{component:"div",count:w.length,page:g,onPageChange:E,rowsPerPage:c,onRowsPerPageChange:F,rowsPerPageOptions:[5,10,15]})]})})},Be=fe;export{Be as I};
