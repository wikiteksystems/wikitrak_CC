import{j as e,t as ae,B as le,k as W,r as c,T as ie,i as be,K as ke,q as ue,P as he,D as Ie,E as ye,G as Ce,H as Ee}from"./index-DA-fjRqR.js";import{d as Me,L as De}from"./LiveMapTopBar-BB0VPQgT.js";import{V as We}from"./VehicleMenu-FpRlI7vB.js";import{u as Ne,G as Ve,M as pe,I as Ae}from"./esm-DN75I2TF.js";import Pe from"./Loader-N8_fzJRU.js";import{L as Le}from"./LiveMapServices-bP9c2Qe3.js";import{s as ce}from"./Socket-0N_gnJcr.js";import{m as ge}from"./motorbike-Ci4voNFa.js";import{f as Oe}from"./4W-D15HTFB5.js";import{t as $e}from"./preet_tractor-Cgp22Ik3.js";import{B as b,C as xe}from"./menu2-BDIsDF75.js";import{d as Fe}from"./Info-CnoTdEKx.js";import{T as Ge,a as Re,b as D}from"./TableRow-CntMLYtx.js";import{T as p}from"./TableCell-BhEqFquR.js";import{P as ze}from"./Parameters-BZZGK9eF.js";import{L as Be,t as Ue}from"./LeftSideBar2-DaGkUiGB.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as He}from"./VehicleGroups-BQLbWBkN.js";import"./createSvgIcon-BAXyJ0N0.js";import"./useControlled-CzTOGtF5.js";import"./jcb-aCHXMCXy.js";import"./index-maAl6mxt.js";import"./index-CuBNweDq.js";import"./Card-Bf0AsLK2.js";import"./Skeleton-C6MO0gOU.js";import"./CardContent-CUEzpH0r.js";const Je="/assets/3W_liveMap-sJCozxTr.png";function Ke({activeParams:u}){return e.jsx(b,{sx:{bgcolor:ae.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:u&&u[0].params.length>0?e.jsxs(e.Fragment,{children:[u[0].params.length>0&&e.jsxs(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",u[0].reg_id]}),u.length>0&&u[0].params.map((n,j)=>{n.label==="maininputvoltage"&&console.log("item.label",n.label,n);const h=u[0].params.find(N=>N.label==="ignition"),o=h&&(h.value===!0||h.value===1)?n.value:0,C=n.label==="mainInputVoltage"||n.label==="maininputvoltage";return e.jsx(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:n.label==="speed"?`${n.label} : ${o} km/h`:C&&n.value!==void 0?`${n.label} : ${n.value} voltage`:n.label==="ignition"?`${n.label} : ${n.value===!0||(n==null?void 0:n.value)===1?"On":"Off"}`:`${n.label} : ${n.value!==void 0?n.value:""}`},j)})]}):e.jsx(e.Fragment,{children:e.jsx(le,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})})}const qe=({label:u,value:n})=>e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[e.jsx(ie,{variant:"body2",color:"textSecondary",children:u}),e.jsx(ie,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:n||"N/A"})]}),Xe=(u,n)=>(u==null?void 0:u.find(j=>{var h,o;return((o=(h=j.imei)==null?void 0:h[0])==null?void 0:o.mac_id)===n.imei}))||{},fe=({title:u,details:n})=>e.jsx(b,{sx:{width:"45%"},children:n.map(({label:j,value:h})=>e.jsx(qe,{label:j,value:h},j))});function Qe({handleVehicleInfo:u}){var k,F,m,I,V;const{collapsed:n}=W(_=>_.auth),{vehicleList:j,selectedVehicle:h}=W(_=>_.liveMap),[o,C]=c.useState({});c.useEffect(()=>{C(Xe(j,h))},[j,h]);const N=[{label:"Vehicle No:",value:o==null?void 0:o.registration_id},{label:"Model:",value:(k=o==null?void 0:o.vehicle_model)==null?void 0:k.name},{label:"IMEI No:",value:(m=(F=o==null?void 0:o.imei)==null?void 0:F[0])==null?void 0:m.mac_id},{label:"Chassis No:",value:o==null?void 0:o.chassis_no},{label:"Engine No:",value:o==null?void 0:o.engine_no}],d=[{label:"Customer Name:",value:(I=o==null?void 0:o.user)!=null&&I.us_user?`${o.user.us_user.first_name.charAt(0).toUpperCase()}${o.user.us_user.first_name.slice(1)} ${o.user.us_user.last_name.charAt(0).toUpperCase()}${o.user.us_user.last_name.slice(1)}`:null},{label:"Date of Sell:",value:o==null?void 0:o.sell_date},{label:"Workshop Name:",value:(V=o==null?void 0:o.workshop)==null?void 0:V.name}];return e.jsxs(b,{sx:{position:"absolute",top:"578px",left:n?"280px":"450px",zIndex:1,background:ae.bgShadow,p:2,borderRadius:2,color:"white",width:"60%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(ie,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),e.jsx(Me,{sx:{cursor:"pointer",color:"black"},onClick:u})]}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(fe,{title:"Vehicle Details",details:N}),e.jsx(fe,{title:"Customer Details",details:d})]})]})}const Ye="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function Ze({showCard:u,loadingVehicle:n}){const{center:j,selectedParameterList:h,selectedVehicle:o,vehicleList:C,icons:N,locationData:d,placesData:k,imeiNumbers:F,onlineVehicle:m,loading:I,services_loading:V}=W(s=>s.liveMap),{mode:_,styles:K,vehicles_details:g}=W(s=>s.dashboard),{collapsed:G}=W(s=>s.auth),[q,ne]=c.useState(null),[R,z]=c.useState(""),[B,U]=c.useState([]),[E,X]=c.useState([]),[y,H]=c.useState(),[i,w]=c.useState(),[v,A]=c.useState(null),[Q,l]=c.useState(""),[t,S]=c.useState(),[M,x]=c.useState(!1),P=be(),{isLoaded:re,loadError:je}=Ne({googleMapsApiKey:`${Ye}`,loadingElement:e.jsx(Pe,{})});c.useEffect(()=>{re&&ne(window.google.maps)},[re]),c.useEffect(()=>{if(console.log("locationData",d),Object.keys(o).length>0){console.log("selectedVehicle",o==null?void 0:o.imei);const s=d==null?void 0:d.filter(r=>{var a;return((a=r==null?void 0:r.latestDocument)==null?void 0:a.imei)==(o==null?void 0:o.imei)});console.log("filteredVehicle",s),H(s)}else H(d)},[d,o]),c.useEffect(()=>{w(h)},[h]),c.useEffect(()=>(ce.on("locationinfo",s=>{if(console.log("locationinfo",s),y==null||y.map(r=>{if(r.latestDocument.imei===s.imei){const a={lat:r.latestDocument.lat,lng:r.latestDocument.lng},f=500,L=60,$=f/(1e3/L),Y=(s.lat-a.lat)/$,Z=(s.lng-a.lng)/$;let O=0;const T=setInterval(()=>{const ee=a.lat+Y*O,se=a.lng+Z*O,oe={...r,latestDocument:{...r.latestDocument,lat:ee,lng:se}};O++,O>=$&&clearInterval(T),H(te=>te.map(J=>J.latestDocument.imei===s.imei?oe:J))},1e3/L)}return r}),String(s==null?void 0:s.imei)===String(i[0].imei)){const r=i[0].params.map(a=>{let f=a.label;return{...a,value:s[f]}});w([{...i[0],params:r}])}}),()=>{ce.off("locationinfo")}),[ce,y,i]),c.useEffect(()=>{P(ke({})),x(!0)},[o]),c.useEffect(()=>{if((d==null?void 0:d.length)>0&&m.length>0){const s=[],r=[];d==null||d.forEach(a=>{m.some(L=>String(L)===String(a._id))?s.push(a):r.push(a)}),U(s),X(r)}else U([]),X([])},[d,m]),c.useEffect(()=>{console.log("onVehicles",B),console.log("offVehicles",E)},[B]);const we=(s,r)=>{r&&l(r.latestDocument.imei),A(v===s?null:s)},me=s=>{if(console.log("reg id ",s),s){const r=C.filter(a=>{var f;return a.imei&&((f=a.imei[0])==null?void 0:f.mac_id)===s});return r&&r.length>0?r[0].registration_id:"IMEI doesn't exist."}else return"IMEI doesn't exist."},_e=s=>{const r=g&&(g==null?void 0:g.length)>0&&g.find(a=>(a==null?void 0:a.value)===s&&(a==null?void 0:a.vehilce_type));return r?r.vehilce_type:null},ve=s=>{const r=g&&(g==null?void 0:g.length)>0&&g.find(a=>(a==null?void 0:a.value)===s&&a);S(r||null)},de=()=>{Object.keys(o).length>0||M?x(!M):ue.error("Please select any vehicle")};if(je)return"Error loading maps";if(!re)return"Loading maps";if(!q)return null;const Se={height:u?"85vh":"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return e.jsxs(e.Fragment,{children:[u&&e.jsx(Ke,{activeParams:i}),e.jsx(b,{sx:{position:"absolute",top:"750px",left:G?"74px":"250px",zIndex:1,background:ae.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:e.jsxs(le,{sx:{color:"white"},onClick:de,children:[M?"Hide":"Show"," Vehicle Info",e.jsx(Fe,{})]})}),M===!0&&e.jsx(Qe,{handleVehicleInfo:de}),e.jsxs(Ve,{mapContainerStyle:Se,zoom:Object.keys(o).length>0?15:5.8,center:j,options:{styles:_?K:""},children:[Object.keys(o).length>0&&e.jsx(Le,{setPlace:z,place:R}),V||n?e.jsx(b,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(xe,{})}):k&&k.length>0&&k.map((s,r)=>{var a,f;return e.jsx(pe,{position:{lat:parseFloat((a=s==null?void 0:s.location)==null?void 0:a.lat),lng:parseFloat((f=s==null?void 0:s.location)==null?void 0:f.lng)},animation:window.google.maps.Animation.DROP,icon:{path:N[`${R}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},r)}),I||n?e.jsx(b,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(xe,{})}):y&&y.length>0&&y.map((s,r)=>{var f,L,$,Y,Z,O,T,ee,se,oe,te;const a=_e(s.latestDocument.imei);return e.jsx(pe,{position:{lat:s.latestDocument.lat,lng:s.latestDocument.lng},animation:window.google.maps.Animation.DROP,icon:{url:(()=>{switch(a){case"2W":return ge;case"3W":return Je;case"4W":return Oe;case"Tractor":return $e;default:return ge}})(),fillColor:Object.keys(o).length>0&&o.imei===s.latestDocument.imei?"green":ae.bgColor,fillOpacity:2,strokeWeight:1,scale:2.5,rotation:(f=s==null?void 0:s.latestDocument)==null?void 0:f.heading,size:new window.google.maps.Size(70,70),scaledSize:new window.google.maps.Size(70,70)},onClick:()=>{var J;we((J=s==null?void 0:s.latestDocument)==null?void 0:J._id,s),ve(s==null?void 0:s.latestDocument.imei)},children:v===((L=s==null?void 0:s.latestDocument)==null?void 0:L._id)&&e.jsx(Ae,{position:{lat:parseFloat(($=s==null?void 0:s.latestDocument)==null?void 0:$.lat),lng:parseFloat((Y=s==null?void 0:s.latestDocument)==null?void 0:Y.lng)},onCloseClick:()=>A(null),options:{maxWidth:"100%"},visible:v===s.id,children:e.jsx(e.Fragment,{children:e.jsx(Ge,{children:e.jsxs(Re,{children:[e.jsxs(D,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Vehicle No:"}),e.jsx(p,{children:me((Z=s==null?void 0:s.latestDocument)==null?void 0:Z.imei)})]}),e.jsxs(D,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Vehicle Model:"}),e.jsx(p,{children:t!=null&&t.vehicle_model?t==null?void 0:t.vehicle_model:"NA"})]}),e.jsxs(D,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"IMEI No:"}),e.jsx(p,{children:(O=s==null?void 0:s.latestDocument)==null?void 0:O.imei})]}),e.jsxs(D,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Chassis No:"}),e.jsx(p,{children:t!=null&&t.chassis_no?t==null?void 0:t.chassis_no:"NA"})]}),e.jsxs(D,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Engine No:"}),e.jsx(p,{children:t!=null&&t.engine_no?t==null?void 0:t.engine_no:"NA"})]}),e.jsxs(D,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Date of Sell:"}),e.jsx(p,{children:t!=null&&t.sell_date?t==null?void 0:t.sell_date:"NA"})]}),e.jsxs(D,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Workshop Name:"}),e.jsx(p,{children:(ee=(T=t==null?void 0:t.workShop)==null?void 0:T.city)!=null&&ee.name?`${(se=t==null?void 0:t.workShop)==null?void 0:se.name} (City: ${(te=(oe=t==null?void 0:t.workShop)==null?void 0:oe.city)==null?void 0:te.name})`:"NA"})]}),e.jsxs(D,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Customer Name:"}),e.jsx(p,{children:t!=null&&t.customer_name?t==null?void 0:t.customer_name:"NA"})]})]})})})},s.id)},r)})]})]})}function ys(){const{locationData:u,selectedVehicle:n,selectedParameterList:j}=W(i=>i.liveMap),{mode:h,selectedVehicleGroup:o}=W(i=>i.dashboard),C=Ue(h),[N,d]=c.useState([]),{w_customer_id:k}=W(i=>i.auth),[F,m]=c.useState(),[I,V]=c.useState(!1),[_,K]=c.useState(!1),[g,G]=c.useState([]),[q,ne]=c.useState(!0),[R,z]=c.useState(!1),[B,U]=c.useState(!1);let E=be();c.useEffect(()=>{X()},[]),c.useEffect(()=>{G([]),E(he([{reg_id:"",imei:"",params:[]}]))},[n]);const X=async()=>{try{z(!0);let i=[],w=[];const v=await E(Ie({w_customer_id:k}));if(Array.isArray(v.payload)){v.payload.forEach(l=>{var t,S,M,x;Array.isArray(l.imei)&&l.imei.length>0&&((t=l.imei[0])!=null&&t.mac_id)?(i.push({id:l.id,label:l.registration_id,value:(S=l.imei[0])==null?void 0:S.mac_id,vehilce_type:l==null?void 0:l.segment,chassis_no:l==null?void 0:l.chassis_no,engine_no:l==null?void 0:l.engine_no,workShop:l==null?void 0:l.workshop,registration_id:l==null?void 0:l.registration_id,sell_date:l==null?void 0:l.sell_date,customer_name:l==null?void 0:l.customer_name,vehicle_model:(M=l==null?void 0:l.vehicle_model)==null?void 0:M.name,vehicle_group:l==null?void 0:l.vehicle_group}),w.push((x=l.imei[0])==null?void 0:x.mac_id)):console.error("IMEI data not found for item:",l)});const A="one",Q=w;w.length>0&&E(ye({type:A,imei:Q})),d(i),E(Ce(i)),E(Ee({w_customer_id:k})),z(!1)}else z(!1),console.error("Unexpected data format:",v),ue.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),ue.error(`Error fetching vehicle data: ${i}`)}},y=async i=>{const{label:w,imei:v,id:A,reg_id:Q,checked:l}=i;m(x=>x.map(P=>P.id===A?{...P,checked:!l}:P));let t=[...g],S=[...g];if(!l)u.forEach(x=>{x.latestDocument.imei===v&&(t.push({label:w,value:x.latestDocument[w==="maininputvoltage"?"mainInputVoltage":w]}),S=t,G(t))});else{let x=g.filter(P=>P.label!==w);S=x,G(x)}console.log("tempParamList",S),E(he([{reg_id:Q,imei:v,params:S}]))},H=N.filter(i=>Object.keys(o).length===0||i.vehicle_group===o.id);return e.jsxs("div",{className:"app",children:[e.jsx(Be,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(De,{title:"Live Map",setShowVehicles:V,showVehicles:I,showParameters:_,setShowParameters:K,setShowCard:ne,showCard:q,setShowVehiclesGroup:U,showVehiclesGroup:B}),e.jsx(He,{setShowVehiclesGroup:U,showVehiclesGroup:B,where:"livemap"}),e.jsxs(b,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(b,{style:{width:I||_?"80%":"100%"},children:e.jsx(Ze,{showCard:q,loadingVehicle:R})}),I&&e.jsx(b,{style:{width:"20%",backgroundColor:C.grey[100]},children:e.jsx(We,{vehicleData:H,title:"Live Map",setParameterData:m,loadingVehicle:R,setShowVehicles:V,showVehicles:I,showParameters:_,setShowParameters:K})}),_&&e.jsx(b,{style:{width:"20%",backgroundColor:C.grey[100]},children:e.jsx(ze,{parametersData:F,setParameterData:m,handleParameterChange:y})})]})]})]})}export{ys as default};
