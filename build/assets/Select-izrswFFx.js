import{ak as L,N as A,al as F,am as C,ae as S,U as E,a2 as d,X as u,a as T,an as x,F as m,ab as b,j as v,ac as M}from"./Vector-BEQdHjna.js";const P={SELECT:"select"};class R extends M{constructor(e,t,n,s){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=s}}const y={};class _ extends L{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:A,this.addCondition_=e.addCondition?e.addCondition:F,this.removeCondition_=e.removeCondition?e.removeCondition:F,this.toggleCondition_=e.toggleCondition?e.toggleCondition:C,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:S,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:D(),this.features_=e.features||new E;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(s){return n.includes(s)}}else t=S;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[d(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[d(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(u.ADD,this.boundAddFeature_),this.features_.addEventListener(u.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(u.ADD,this.boundAddFeature_),this.features_.removeEventListener(u.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const n=this.getMap().getAllLayers().find(function(s){if(s instanceof T&&s.getSource()&&s.getSource().hasFeature(t))return s});n&&this.addFeatureLayerAssociation_(t,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=d(e);t in y||(y[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let s=t.length-1;s>=0;--s){const o=t[s];if(o!==this&&o instanceof _&&o.getStyle()&&o.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(o.getStyle());return}}const n=d(e);e.setStyle(y[n]),delete y[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[d(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),n=this.removeCondition_(e),s=this.toggleCondition_(e),o=!t&&!n&&!s,f=e.map,l=this.getFeatures(),c=[],r=[];if(o){x(this.featureLayerAssociation_),f.forEachFeatureAtPixel(e.pixel,(i,a)=>{if(!(!(i instanceof m)||!this.filter_(i,a)))return this.addFeatureLayerAssociation_(i,a),r.push(i),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let i=l.getLength()-1;i>=0;--i){const a=l.item(i),g=r.indexOf(a);g>-1?r.splice(g,1):(l.remove(a),c.push(a))}r.length!==0&&l.extend(r)}else{f.forEachFeatureAtPixel(e.pixel,(i,a)=>{if(!(!(i instanceof m)||!this.filter_(i,a)))return(t||s)&&!l.getArray().includes(i)?(this.addFeatureLayerAssociation_(i,a),r.push(i)):(n||s)&&l.getArray().includes(i)&&(c.push(i),this.removeFeatureLayerAssociation_(i)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let i=c.length-1;i>=0;--i)l.remove(c[i]);l.extend(r)}return(r.length>0||c.length>0)&&this.dispatchEvent(new R(P.SELECT,r,c,e)),!0}}function D(){const h=b();return v(h.Polygon,h.LineString),v(h.GeometryCollection,h.LineString),function(e){return e.getGeometry()?h[e.getGeometry().getType()]:null}}const k=_;export{k as S};
