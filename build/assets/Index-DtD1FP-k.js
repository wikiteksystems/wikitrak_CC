import{i as R,j as t,a as I,u as Q,t as b,T as S,a8 as Se,a9 as ye,r as a,v as _e,P as X,aa as ie,l as we,_ as J,m as Me}from"./index-DL9hLiOS.js";import{L as Ve}from"./LightModeOutlined-SzPNcP48.js";import{L as De}from"./LiveMapTopBar-DrSfdOgb.js";import{V as Ce}from"./VehicleMenu-DK--_ZOq.js";import{u as $e,G as ke,M as le,I as Pe}from"./esm-DGPCdfx1.js";import Le from"./Loader-CO8HJ64G.js";import{r as E}from"./createSvgIcon-BcS5_hPn.js";import{B as d}from"./CircularProgress-CwJAJQBH.js";import{s as K}from"./Socket-0N_gnJcr.js";import{P as Ie}from"./Parameters-D6wM5_PO.js";import{t as Re}from"./Search--ZZoCNX3.js";import"./jcb-aCHXMCXy.js";import"./index-CKUDLO0y.js";import"./roundedArrow-CcpaeF97.js";import"./TextArea-CqiGnL_R.js";import"./OutlinedInput-BZ3kL5AV.js";import"./IconButton-7VKsicx3.js";import"./index-CuH6tO3l.js";import"./Card-mya20it9.js";import"./Paper-Bv1Cqgr-.js";var Y={},Ee=R;Object.defineProperty(Y,"__esModule",{value:!0});var ne=Y.default=void 0,ze=Ee(E()),He=t;ne=Y.default=(0,ze.default)((0,He.jsx)("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4"}),"Restaurant");var Z={},Oe=R;Object.defineProperty(Z,"__esModule",{value:!0});var ce=Z.default=void 0,Ae=Oe(E()),Fe=t;ce=Z.default=(0,Ae.default)((0,Fe.jsx)("path",{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3m12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4"}),"Hotel");var ee={},qe=R;Object.defineProperty(ee,"__esModule",{value:!0});var pe=ee.default=void 0,Ne=qe(E()),Ge=t;pe=ee.default=(0,Ne.default)((0,Ge.jsx)("path",{d:"m19.77 7.23.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77M12 10H6V5h6zm6 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalGasStation");var te={},We=R;Object.defineProperty(te,"__esModule",{value:!0});var he=te.default=void 0,Be=We(E()),Te=t;he=te.default=(0,Be.default)((0,Te.jsx)("path",{d:"M16.22 12c.68 0 1.22-.54 1.22-1.22 0-.67-.54-1.22-1.22-1.22S15 10.11 15 10.78c0 .68.55 1.22 1.22 1.22m-9.66-1.22c0 .67.54 1.22 1.22 1.22S9 11.46 9 10.78c0-.67-.54-1.22-1.22-1.22s-1.22.55-1.22 1.22M7.61 4 6.28 8h11.43l-1.33-4zm8.67-1s.54.01.92.54c.02.02.03.04.05.07.07.11.14.24.19.4.22.65 1.56 4.68 1.56 4.68v6.5c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81V14H7v1.19c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81v-6.5S6.34 4.67 6.55 4c.05-.16.12-.28.19-.4.03-.02.04-.04.06-.06.38-.53.92-.54.92-.54zM4 17.01h16V19h-7v3h-2v-3H4z"}),"CarRepair");var oe={},Ue=R;Object.defineProperty(oe,"__esModule",{value:!0});var de=oe.default=void 0,Xe=Ue(E()),Je=t;de=oe.default=(0,Xe.default)((0,Je.jsx)("path",{d:"M21 5h-2.64l1.14-3.14L17.15 1l-1.46 4H3v2l2 6-2 6v2h18v-2l-2-6 2-6zm-3.9 8.63L18.89 19H5.11l1.79-5.37.21-.63-.21-.63L5.11 7h13.78l-1.79 5.37-.21.63zM13 9h-2v3H8v2h3v3h2v-3h3v-2h-3z"}),"LocalPharmacyOutlined");var se={},Ke=R;Object.defineProperty(se,"__esModule",{value:!0});var ue=se.default=void 0,Qe=Ke(E()),Ye=t;ue=se.default=(0,Qe.default)((0,Ye.jsx)("path",{d:"M8 9v1.5h2.25V15h1.5v-4.5H14V9zM6 9H3c-.55 0-1 .45-1 1v5h1.5v-1.5h2V15H7v-5c0-.55-.45-1-1-1m-.5 3h-2v-1.5h2zM21 9h-4.5c-.55 0-1 .45-1 1v5H17v-4.5h1V14h1.5v-3.51h1V15H22v-5c0-.55-.45-1-1-1"}),"AtmOutlined");const Ze=({setPlace:y,place:i})=>{const{center:z}=I(x=>x.liveMap),r=Q(),u=async x=>{i===x?(r(Se([])),y("")):(y(x),r(ye({center:z,clickedPlace:x})))};return t.jsxs(d,{sx:{position:"absolute",top:"1vh",left:"20%",display:"flex",justifyContent:"center"},children:[t.jsx(d,{sx:{bgcolor:i==="restaurants"?b.bgColor:"white",color:i==="restaurants"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{u("restaurants")},children:t.jsxs(S,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ne,{style:{height:"17px",position:"relative",top:"1px"}}),"Restaurants"]})}),t.jsx(d,{sx:{bgcolor:i==="hotels"?b.bgColor:"white",color:i==="hotels"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{u("hotels")},children:t.jsxs(S,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ce,{style:{height:"17px",position:"relative",top:"1px"}}),"Hotels"]})}),t.jsx(d,{sx:{bgcolor:i==="hospitals"?b.bgColor:"white",color:i==="hospitals"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{u("hospitals")},children:t.jsxs(S,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(de,{style:{height:"17px",position:"relative",top:"1px"}}),"Hospitals"]})}),t.jsx(d,{sx:{bgcolor:i==="atm"?b.bgColor:"white",color:i==="atm"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{u("atm")},children:t.jsxs(S,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ue,{style:{height:"17px",position:"relative",top:"1px"}}),"ATMs"]})}),t.jsx(d,{sx:{bgcolor:i==="car_repair"?b.bgColor:"white",color:i==="car_repair"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{u("car_repair")},children:t.jsxs(S,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(he,{style:{height:"17px",position:"relative",top:"1px"}}),"Service center"]})}),t.jsx(d,{sx:{bgcolor:i==="gasstation"?b.bgColor:"white",color:i==="gasstation"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{u("gasstation")},children:t.jsxs(S,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(pe,{style:{height:"17px",position:"relative",top:"1px"}}),"Gas Stations"]})})]})},et=Ze,tt="/assets/motorbike-Ve1wpD8A.png";function ot({showCard:y}){const{center:i,selectedParameterList:z,selectedVehicle:r,vehicleList:u,icons:x,locationData:c,placesData:H,imeiNumbers:ae,onlineVehicle:_}=I(e=>e.liveMap),{mode:O,styles:T}=I(e=>e.dashboard),[A,U]=a.useState(null),[k,F]=a.useState(""),[q,N]=a.useState([]),[P,G]=a.useState([]),[f,l]=a.useState(),[n,v]=a.useState(),[w,M]=a.useState(null),[p,j]=a.useState(""),g=Q(),{isLoaded:V,loadError:m}=$e({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU",loadingElement:t.jsx(Le,{})});a.useEffect(()=>{V&&U(window.google.maps)},[V]),a.useEffect(()=>{if(console.log("locationData",c),Object.keys(r).length>0){console.log("selectedVehicle",r==null?void 0:r.imei);const e=c==null?void 0:c.filter(o=>{var s;return((s=o==null?void 0:o.latestDocument)==null?void 0:s.imei)==(r==null?void 0:r.imei)});console.log("filteredVehicle",e),l(e)}else l(c)},[c,r]),a.useEffect(()=>{v(z)},[z]),a.useEffect(()=>(K.on("locationinfo",e=>{if(console.log("locationinfo",e),f==null||f.map(o=>{if(o.latestDocument.imei===e.imei){const s={lat:o.latestDocument.lat,lng:o.latestDocument.lng},h=500,C=60,L=h/(1e3/C),W=(e.lat-s.lat)/L,B=(e.lng-s.lng)/L;let $=0;const ve=setInterval(()=>{const ge=s.lat+W*$,me=s.lng+B*$,je={...o,latestDocument:{...o.latestDocument,lat:ge,lng:me}};$++,$>=L&&clearInterval(ve),l(be=>be.map(re=>re.latestDocument.imei===e.imei?je:re))},1e3/C)}return o}),String(e==null?void 0:e.imei)===String(n[0].imei)){const o=n[0].params.map(s=>{let h=s.label;return{...s,value:e[h]}});v([{...n[0],params:o}])}}),()=>{K.off("locationinfo")}),[K,f]),a.useEffect(()=>{g(_e({}))},[r]),a.useEffect(()=>{if((c==null?void 0:c.length)>0&&_.length>0){const e=[],o=[];c==null||c.forEach(s=>{_.some(C=>String(C)===String(s._id))?e.push(s):o.push(s)}),N(e),G(o)}else N([]),G([])},[c,_]),a.useEffect(()=>{console.log("onVehicles",q),console.log("offVehicles",P)},[q]);const D=(e,o)=>{o&&j(o.latestDocument.imei),M(w===e?null:e)},xe=e=>{if(console.log("reg id ",e),e){const o=u.filter(s=>{var h;return s.imei&&((h=s.imei[0])==null?void 0:h.mac_id)===e});return o&&o.length>0?o[0].registration_id:"IMEI doesn't exist."}else return"IMEI doesn't exist."};if(m)return"Error loading maps";if(!V)return"Loading maps";if(!A)return null;const fe={height:y?"87vh":"95vh",width:"100%",transition:"transform 0.5s ease-in-out"};return t.jsxs(t.Fragment,{children:[y&&t.jsx(d,{sx:{bgcolor:b.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:n[0].params.length>0?t.jsxs(t.Fragment,{children:[n[0].params.length>0&&t.jsxs(X,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",n[0].reg_id]}),n.length>0&&n[0].params.map((e,o)=>t.jsx(X,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:e.label==="speed"?`${e.label} : ${e.value} km/h`:e.label==="mainInputVoltage"?`${e.label} : ${e.value} voltage`:e.label==="ignition"?`${e.label} : ${e.value===!0?"On":"Off"}`:`${e.label} : ${e.value}`},o))]}):t.jsx(t.Fragment,{children:t.jsx(X,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})}),t.jsxs(ke,{mapContainerStyle:fe,zoom:Object.keys(r).length>0?15:5.8,center:i,options:{styles:O?T:""},children:[Object.keys(r).length>0&&t.jsx(et,{setPlace:F,place:k}),H&&H.length>0&&H.map((e,o)=>{var s,h;return t.jsx(le,{position:{lat:parseFloat((s=e==null?void 0:e.location)==null?void 0:s.lat),lng:parseFloat((h=e==null?void 0:e.location)==null?void 0:h.lng)},animation:window.google.maps.Animation.DROP,icon:{path:x[`${k}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},o)}),f&&f.length>0&&f.map((e,o)=>{var s,h,C,L,W,B;return t.jsx(le,{position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},animation:window.google.maps.Animation.DROP,icon:{url:tt,fillColor:Object.keys(r).length>0&&r.imei===e.latestDocument.imei?"green":b.bgColor,fillOpacity:2,strokeWeight:1,scale:2,rotation:(s=e==null?void 0:e.latestDocument)==null?void 0:s.heading,size:new window.google.maps.Size(55,55),scaledSize:new window.google.maps.Size(55,55)},onClick:()=>{var $;return D(($=e==null?void 0:e.latestDocument)==null?void 0:$._id,e)},children:w===((h=e==null?void 0:e.latestDocument)==null?void 0:h._id)&&t.jsx(Pe,{position:{lat:parseFloat((C=e==null?void 0:e.latestDocument)==null?void 0:C.lat),lng:parseFloat((L=e==null?void 0:e.latestDocument)==null?void 0:L.lng)},onCloseClick:()=>M(null),options:{maxWidth:"100%"},visible:w===e.id,children:t.jsxs(t.Fragment,{children:[t.jsxs(S,{children:["Vehicle No:"," ",xe((W=e==null?void 0:e.latestDocument)==null?void 0:W.imei)]}),t.jsxs(S,{children:["IMEI No: ",(B=e==null?void 0:e.latestDocument)==null?void 0:B.imei]})]})},e.id)},o)})]})]})}function _t(){const{locationData:y,selectedVehicle:i,selectedParameterList:z}=I(l=>l.liveMap),{mode:r}=I(l=>l.dashboard),u=Re(r),[x,c]=a.useState([]),{w_customer_id:H}=I(l=>l.auth),[ae,_]=a.useState(),[O,T]=a.useState(!1),[A,U]=a.useState(!1),[k,F]=a.useState([]),[q,N]=a.useState(!1);let P=Q();a.useEffect(()=>{G()},[]),a.useEffect(()=>{F([]),P(ie([{reg_id:"",imei:"",params:[]}]))},[i]);const G=async()=>{try{let l=[],n=[];const v=await P(we({w_customer_id:H}));if(Array.isArray(v.payload)){v.payload.forEach(p=>{var j,g,V;Array.isArray(p.imei)&&p.imei.length>0&&((j=p.imei[0])!=null&&j.mac_id)?(l.push({id:p.id,label:p.registration_id,value:(g=p.imei[0])==null?void 0:g.mac_id}),n.push((V=p.imei[0])==null?void 0:V.mac_id)):(console.error("IMEI data not found for item:",p),J.error(`IMEI Number not found for the vehicle: ${p==null?void 0:p.registration_id}`))});const w="one",M=n;n.length>0&&P(Me({type:w,imei:M})),c(l)}else console.error("Unexpected data format:",v),J.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),J.error(`Error fetching vehicle data: ${l}`)}},f=async l=>{const{label:n,imei:v,id:w,reg_id:M,checked:p}=l;_(m=>m.map(D=>D.id===w?{...D,checked:!p}:D));let j=[...k],g=[...k];if(!p)y.forEach(m=>{m.latestDocument.imei===v&&(j.push({label:n,value:m.latestDocument[n]}),g=j,F(j))});else{let m=k.filter(D=>D.label!==n);g=m,F(m)}console.log("tempParamList",g),P(ie([{reg_id:M,imei:v,params:g}]))};return t.jsxs("div",{className:"app",children:[t.jsx(Ve,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(De,{title:"Live Map",setShowVehicles:T,showVehicles:O,showParameters:A,setShowParameters:U,setShowCard:N,showCard:q}),t.jsxs(d,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(d,{style:{width:O||A?"80%":"100%"},children:t.jsx(ot,{showCard:q})}),O&&t.jsx(d,{style:{width:"20%",backgroundColor:u.grey[100]},children:t.jsx(Ce,{vehicleData:x,title:"Live Map",setParameterData:_})}),A&&t.jsx(d,{style:{width:"20%",backgroundColor:u.grey[100]},children:t.jsx(Ie,{parametersData:ae,setParameterData:_,handleParameterChange:f})})]})]})]})}export{_t as default};
