import{r as n,j as t,u as G,a as I,ae as oe,t as ae,T as B,O as A,a3 as ne,_ as E,W as re,X as _,Y as V,b as z,Z as N,V as ie,k as le,l as ce}from"./index-BzV_zUQW.js";import{L as de}from"./LightModeOutlined-BioNP8gg.js";import{L as he}from"./LiveMapTopBar-DkAa0-Tr.js";import{V as pe}from"./VehicleMenu-D-_xRA_m.js";import{P as W,u as ge,G as ue,a as U}from"./esm-BERO0GS8.js";import"./index-HM1-FgXG.js";import{T as xe}from"./TripGraph-C9miA9tc.js";import{B as h,C as X}from"./CircularProgress-woJxG7UZ.js";import{D as fe}from"./DateTimePicker-BgogkEZ2.js";import{t as q}from"./theme-CRjQBU0N.js";import"./createSvgIcon-CPsng49f.js";import"./IconButton-ZxMV7Jyu.js";import"./Search-D564Q4l9.js";import"./index-CLvFSviK.js";import"./roundedArrow-D5D8HQmm.js";import"./TextArea-DtBV0upR.js";import"./button-CFoUml1W.js";function me({trip:r,tripPlay:p,setTripPlay:D,setSpeed:w}){const[x,S]=n.useState([]),[L,e]=n.useState(0),[T,g]=n.useState([]),[P,y]=n.useState([null]);return n.useEffect(()=>{var f;w((f=r==null?void 0:r[2])==null?void 0:f.speed)},[r]),n.useEffect(()=>{y([null]);const f=[];if(r&&r.length>0&&(r==null||r.map(l=>{f.push(l.speed).toFixed(2)}),g(f)),r&&(r==null?void 0:r.length)>0){const l=r==null?void 0:r.map(u=>({lat:parseFloat(u.lat),lng:parseFloat(u.lng)}));S(l),y(l.slice(0))}},[r]),n.useEffect(()=>{if(p){const f=x.length,l=9e3,u=1e4,s=l/u;let a=0;const o=setInterval(()=>{if(a<u){const c=a/u,j=Math.floor(c*f);e(j),w(T[j]),a++}else clearInterval(o)},s);return()=>clearInterval(o)}},[p]),t.jsxs("div",{children:[P.length>0&&t.jsx(t.Fragment,{children:t.jsx(W,{path:P,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4}})}),p&&t.jsx(W,{path:x.slice(0,L+1),options:{strokeColor:"green",strokeOpacity:1,strokeWeight:4,zIndex:1e3,geodesic:!0}})]})}const Se=({selectedTrip:r,center:p,showCard:D})=>{var O,R;G();const{isLoaded:w,loadError:x}=ge({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"});I(i=>i.liveMap);const{singleTrip_Data:S,tripLoading:L}=I(i=>i.tripMonitor),{selectedTripData:e,mode:T,styles:g}=I(i=>i.dashboard),P=n.useRef(null),[y,f]=n.useState(null),[l,u]=n.useState(null),[s,a]=n.useState([]);n.useState([]);const[o,c]=n.useState(!1),[j,M]=n.useState(0),[b,K]=n.useState(!1),[H,Y]=n.useState(0);n.useEffect(()=>{y&&l&&y.fitBounds(l)},[y,l,e]),n.useEffect(()=>{if(console.log("selectedTripData",e),(e==null?void 0:e.length)>0){const i=$({selectedTripData:e});Y(i)}},[e]);const $=({selectedTripData:i})=>{const C=i.reduce((v,d,m)=>{if(m===0)return v;const k=i[m-1],F=oe(k.lat,k.lng,d.lat,d.lng);return v+F},0);return C==null?void 0:C.toFixed(2)};n.useEffect(()=>{var i,C,v,d,m;if(e&&(e==null?void 0:e.length)>0){const k=new window.google.maps.LatLngBounds,F=new window.google.maps.LatLng(parseFloat((i=e[0])==null?void 0:i.lat),parseFloat((C=e[0])==null?void 0:C.lng)),se=new window.google.maps.LatLng(parseFloat((v=e[(e==null?void 0:e.length)-1])==null?void 0:v.lat),parseFloat((d=e[(e==null?void 0:e.length)-1])==null?void 0:d.lng));k.extend(F),k.extend(se),M((m=e[0])==null?void 0:m.speed),u(k)}c(!1),J()},[e]);const J=()=>{if(e&&e.length>0){const i=(d,m)=>{const F=new Date(d.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:d.createdAt.substring(0,10),Time:F,value:d[m]}},v=["speed","mainInputVoltage","ignition"].map(d=>({label:d==="speed"?"Speed":d==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:Q(),data:e.map(m=>i(m,d))}));a(v)}else a([])},Q=()=>"#"+Math.floor(Math.random()*16777215).toString(16),Z=()=>{var i;if((e==null?void 0:e.length)>0)c(!o),M(0);else return((i=Object.keys(e))==null?void 0:i.length)===0?E.error("Please Select Vehicle",{id:"vehicle"}):E.error("Please Select Trip",{id:"trip error"})},ee=()=>{var i;if((e==null?void 0:e.length)>0)K(!b);else return((i=Object.keys(e))==null?void 0:i.length)===0?E.error("Please Select Vehicle",{id:"vehicle"}):E.error("Please Select Trip",{id:"trip error"})};if(x)return"Error loading maps";if(!w)return"Loading maps";const te={width:"100%",height:D?"87vh":"93vh"};return t.jsxs(t.Fragment,{children:[L&&t.jsx(h,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:t.jsx(X,{})}),D&&t.jsxs(h,{sx:{bgcolor:ae.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"left",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",height:"60px",gap:"15px",paddingLeft:"30px"},children:[t.jsxs(B,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:["Speed ",j," KM/H"]}),t.jsxs(B,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:["Total-Distance ",H," KM"]}),t.jsxs(A,{style:{height:"38px",padding:"5px 20px"},sx:{background:o?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:o?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{Z()},children:[o?"Pause":"Play","-Trip"]}),t.jsxs(A,{style:{height:"38px",padding:"5px 20px"},sx:{background:b?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:b?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{ee()},children:[b?"Hide":"Show","-Graph"]})]}),t.jsxs(ue,{ref:P,mapContainerStyle:te,zoom:10,center:p,onLoad:i=>f(i),options:{styles:T?g:""},children:[e&&(e==null?void 0:e.length)>0&&(e==null?void 0:e.map((i,C)=>{var v,d,m,k;return t.jsxs(ne.Fragment,{children:[t.jsx(U,{position:{lat:parseFloat((v=e[0])==null?void 0:v.lat),lng:parseFloat((d=e[0])==null?void 0:d.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}}),t.jsx(me,{trip:e,tripPlay:o,setTripPlay:c,setSpeed:M}),t.jsx(U,{position:{lat:parseFloat((m=e[(e==null?void 0:e.length)-1])==null?void 0:m.lat),lng:parseFloat((k=e[(e==null?void 0:e.length)-1])==null?void 0:k.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}})]},C)})),t.jsx("div",{style:{position:"relative",top:320,left:15,color:"green"},children:((R=(O=s[0])==null?void 0:O.data)==null?void 0:R.length)>0&&b&&t.jsx(xe,{item:s})})]})]})},je=Se,we=()=>{const r=G(),{tripList:p,selectedTripData:D,loading:w,trips:x,activeIndex:S,searchText:L,mode:e}=I(s=>s.dashboard),{selectedVehicle:T}=I(s=>s.liveMap),g=q(e);n.useEffect(()=>{const s=y(p);r(re(s))},[p]),n.useEffect(()=>{console.log("selectedTripData",D),D.length>0||S!==null&&l.length>0&&(console.log("selected trip",l[S]),P(l[S]))},[D]);const P=async s=>{var c;let a={imei:T.imei,startDate:s.startDate,endDate:s.endDate};const o=await _(a);((c=o==null?void 0:o.data)==null?void 0:c.documents.length)>0?r(V(o.data.documents[0].data)):r(V([]))};n.useState(0);const y=s=>{const a=new Set,o=[];return s.forEach(c=>{a.has(c.formatedDate)||(a.add(c.formatedDate),o.push(c.formatedDate))}),o},f=s=>{r(N(null)),r(ie(s))},l=p&&p.length>0&&p.filter(s=>s.formatedDate.toLowerCase().includes(L.toLowerCase())),u=async(s,a)=>{var c;let o={imei:T.imei,startDate:a.startDate,endDate:a.endDate};if(console.log("payload",o),o&&(o!=null&&o.imei)&&(o!=null&&o.startDate)&&(o!=null&&o.endDate)){const j=await _(o);((c=j==null?void 0:j.data)==null?void 0:c.documents.length)>0?r(V(j.data.documents[0].data)):r(V([])),r(N(s))}else E.error("Something is missing start or end date.",{id:"getTrip"})};return t.jsx(t.Fragment,{children:t.jsxs(h,{children:[t.jsxs(h,{children:[t.jsx(h,{sx:{color:g.grey[400]},children:"Select Date"}),t.jsx(h,{sx:{mt:1},children:t.jsx(fe,{})})]}),w?t.jsx("div",{style:{width:"100%",margin:"38%"},children:t.jsx(X,{})}):t.jsxs(t.Fragment,{children:[t.jsx(h,{children:t.jsx(h,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:x&&(x==null?void 0:x.length)>0?x.map((s,a)=>t.jsx(h,{children:t.jsx(A,{onClick:()=>{f(s)},style:{backgroundColor:L===s?g.grey[300]:g.grey[200],color:L===s?"black":g.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:s})},a)):t.jsx(B,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),t.jsx(h,{children:l&&l.length>0&&l.map((s,a)=>t.jsxs(h,{sx:{m:"5px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:S===a?"black":g.grey[400],backgroundColor:S===a?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:"#e8edea"}},onClick:()=>u(a,s),children:[t.jsxs(B,{children:[a+1,". ",s.startLocation," to ",s.endLocation]}),t.jsxs(B,{children:[s!=null&&s.startDate?z(new Date(s.startDate).toISOString()).format("LT"):""," ","/"," ",s!=null&&s.endDate?z(new Date(s.endDate).toISOString()).format("LT"):"----"]})]}))})]})]})})},ye=we;function Re(){const{w_customer_id:r}=I(a=>a.auth),{collapsed:p}=I(a=>a.auth),{mode:D}=I(a=>a.dashboard),[w,x]=n.useState(!1),[S,L]=n.useState(!1),[e,T]=n.useState([]),[g,P]=n.useState(!1);n.useState([]);const[y,f]=n.useState({lat:18.516726,lng:73.856255});n.useState([]);const l=q(D);let u=G();n.useEffect(()=>{s()},[]);const s=async()=>{let a=[],o=[];(await u(le({w_customer_id:r}))).payload.map(b=>{a.push({id:b.id,label:b.registration_id,value:b.imei[0].mac_id}),o.push(b.imei[0].mac_id)});const j="one",M=o;o.length>0&&u(ce({type:j,imei:M})),T(a)};return t.jsxs("div",{className:"app",children:[t.jsx(de,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(he,{title:"Trip Monitor",setShowVehicles:x,showVehicles:w,setShowCard:L,showCard:S,sideBarTrip:g,setSideBarTrip:P}),t.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(h,{style:{width:w||g?"80%":"100%"},children:t.jsx(je,{center:y,showCard:S})}),w&&t.jsx(h,{style:{width:"20%",backgroundColor:l.grey[100]},children:t.jsx(pe,{vehicleData:e,title:"Live Monitor"})}),t.jsx(h,{style:{width:p?"22%":"20%",display:g?"block":"none",backgroundColor:l.grey[100]},children:t.jsx(ye,{})})]})]})]})}export{Re as default};
