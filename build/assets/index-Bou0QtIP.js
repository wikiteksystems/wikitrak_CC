import{o as Be,p as Ve,q as M,w as fe,x as oe,y as ze,z as Ge,A as He,r as f,B as qe,C as z,j as e,D as W,E as Ue,F as ye,H as Q,I as Z,J as We,K as ie,L as G,M as ce,N as Ce,T as $,a as F,G as K,b as V,u as J,s as be,_ as Y,O as q,t as ke,P as Ye,Q as Je,R as Xe,S as ve,i as de,U as Ke,V as se,W as Qe,X as Ze,Y as je,Z as re,$ as et,h as tt,k as ot,l as st,m as rt,n as lt,v as nt}from"./index-D-FDkSDy.js";import{d as at,a as it,b as ct,c as dt,L as pt}from"./LightModeOutlined-DxQ98IV3.js";import{s as le}from"./Socket-0N_gnJcr.js";import{p as ut,R as ht,L as gt,X as xt,Y as mt,a as ft,b as yt,T as bt}from"./LineChart-D9V32ySF.js";import{u as Te,f as Pe,t as H,F as vt,I as jt,O as wt,a as St}from"./theme-l95ipxI8.js";import{B as m,C as De}from"./CircularProgress-C3vNCpCt.js";import{P as Ct}from"./Paper-79I20hkQ.js";import{c as kt,S as Tt}from"./Switch-CxlrbGDk.js";import{c as Pt,I as Ie}from"./IconButton-B0zRfXUT.js";import{r as Dt,m as It,a as Mt}from"./mergeSlotProps-raqXZrO-.js";import{C as Me}from"./index-DKZ06Bql.js";import{u as At,G as Ft,M as Lt}from"./esm-Cxj0JWIk.js";import{d as Rt}from"./Search-BJSieG0V.js";import{d as we}from"./index-B8UcDW5e.js";import{D as _t}from"./DateTimePicker-CmMsys8v.js";import{r as pe}from"./createSvgIcon-B2VI29Eg.js";import{T as $t,a as Nt,d as Et,b as Ot,c as ne}from"./TableRow-B6ShV0Re.js";import{d as Bt,G as Vt}from"./GeofencAlert-C6nHSg2r.js";import"./index-hpdY4lYc.js";import"./roundedArrow-N-lbH7kO.js";import"./button-CdA4b2Ay.js";const zt=["component","direction","spacing","divider","children","className","useFlexGap"],Gt=Be(),Ht=Ve("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,o)=>o.root});function qt(t){return Ue({props:t,name:"MuiStack",defaultTheme:Gt})}function Ut(t,o){const s=f.Children.toArray(t).filter(Boolean);return s.reduce((l,x,a)=>(l.push(x),a<s.length-1&&l.push(f.cloneElement(o,{key:`separator-${a}`})),l),[])}const Wt=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],Yt=({ownerState:t,theme:o})=>{let s=M({display:"flex",flexDirection:"column"},fe({theme:o},oe({values:t.direction,breakpoints:o.breakpoints.values}),l=>({flexDirection:l})));if(t.spacing){const l=ze(o),x=Object.keys(o.breakpoints.values).reduce((y,i)=>((typeof t.spacing=="object"&&t.spacing[i]!=null||typeof t.direction=="object"&&t.direction[i]!=null)&&(y[i]=!0),y),{}),a=oe({values:t.direction,base:x}),p=oe({values:t.spacing,base:x});typeof a=="object"&&Object.keys(a).forEach((y,i,u)=>{if(!a[y]){const v=i>0?a[u[i-1]]:"column";a[y]=v}}),s=Ge(s,fe({theme:o},p,(y,i)=>t.useFlexGap?{gap:ye(l,y)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Wt(i?a[i]:t.direction)}`]:ye(l,y)}}))}return s=He(o.breakpoints,s),s};function Jt(t={}){const{createStyledComponent:o=Ht,useThemeProps:s=qt,componentName:l="MuiStack"}=t,x=()=>Q({root:["root"]},y=>Z(l,y),{}),a=o(Yt);return f.forwardRef(function(y,i){const u=s(y),h=qe(u),{component:v="div",direction:d="column",spacing:n=0,divider:S,children:C,className:T,useFlexGap:g=!1}=h,j=z(h,zt),I={direction:d,spacing:n,useFlexGap:g},w=x();return e.jsx(a,M({as:v,ownerState:I,ref:i,className:W(w.root,T)},j,{children:S?Ut(C,S):C}))})}const Xt=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],Kt=["component","slots","slotProps"],Qt=["component"];function Zt(t,o){const{className:s,elementType:l,ownerState:x,externalForwardedProps:a,getSlotOwnerState:p,internalForwardedProps:c}=o,y=z(o,Xt),{component:i,slots:u={[t]:void 0},slotProps:h={[t]:void 0}}=a,v=z(a,Kt),d=u[t]||l,n=Dt(h[t],x),S=It(M({className:s},y,{externalForwardedProps:t==="root"?v:void 0,externalSlotProps:n})),{props:{component:C},internalRef:T}=S,g=z(S.props,Qt),j=We(T,n==null?void 0:n.ref,o.ref),I=p?p(g):{},w=M({},x,I),L=t==="root"?C||i:C,D=Mt(d,M({},t==="root"&&!i&&!u[t]&&c,t!=="root"&&!u[t]&&c,g,L&&{as:L},{ref:j}),w);return Object.keys(I).forEach(P=>{delete D[P]}),[d,D]}const eo=Pt(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function to(t){return Z("MuiAvatar",t)}ie("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const oo=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],so=kt(),ro=t=>{const{classes:o,variant:s,colorDefault:l}=t;return Q({root:["root",s,l&&"colorDefault"],img:["img"],fallback:["fallback"]},to,o)},lo=G("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,o[s.variant],s.colorDefault&&o.colorDefault]}})(({theme:t})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:M({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:M({backgroundColor:t.palette.grey[400]},t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})))}]})),no=G("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(t,o)=>o.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),ao=G(eo,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(t,o)=>o.fallback})({width:"75%",height:"75%"});function io({crossOrigin:t,referrerPolicy:o,src:s,srcSet:l}){const[x,a]=f.useState(!1);return f.useEffect(()=>{if(!s&&!l)return;a(!1);let p=!0;const c=new Image;return c.onload=()=>{p&&a("loaded")},c.onerror=()=>{p&&a("error")},c.crossOrigin=t,c.referrerPolicy=o,c.src=s,l&&(c.srcset=l),()=>{p=!1}},[t,o,s,l]),x}const co=f.forwardRef(function(o,s){const l=so({props:o,name:"MuiAvatar"}),{alt:x,children:a,className:p,component:c="div",slots:y={},slotProps:i={},imgProps:u,sizes:h,src:v,srcSet:d,variant:n="circular"}=l,S=z(l,oo);let C=null;const T=io(M({},u,{src:v,srcSet:d})),g=v||d,j=g&&T!=="error",I=M({},l,{colorDefault:!j,component:c,variant:n}),w=ro(I),[L,D]=Zt("img",{className:w.img,elementType:no,externalForwardedProps:{slots:y,slotProps:{img:M({},u,i.img)}},additionalProps:{alt:x,src:v,srcSet:d,sizes:h},ownerState:I});return j?C=e.jsx(L,M({},D)):a||a===0?C=a:g&&x?C=x[0]:C=e.jsx(ao,{ownerState:I,className:w.fallback}),e.jsx(lo,M({as:c,ownerState:I,className:W(w.root,p),ref:s},S,{children:C}))}),po=co,uo=Jt({createStyledComponent:G("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,o)=>o.root}),useThemeProps:t=>ce({props:t,name:"MuiStack"})}),ho=uo;function go(t){return Z("MuiFormControlLabel",t)}const xo=ie("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),U=xo,mo=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],fo=t=>{const{classes:o,disabled:s,labelPlacement:l,error:x,required:a}=t,p={root:["root",s&&"disabled",`labelPlacement${Ce(l)}`,x&&"error",a&&"required"],label:["label",s&&"disabled"],asterisk:["asterisk",x&&"error"]};return Q(p,go,o)},yo=G("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[{[`& .${U.label}`]:o.label},o.root,o[`labelPlacement${Ce(s.labelPlacement)}`]]}})(({theme:t,ownerState:o})=>M({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${U.disabled}`]:{cursor:"default"}},o.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},o.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},o.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${U.label}`]:{[`&.${U.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})),bo=G("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,o)=>o.asterisk})(({theme:t})=>({[`&.${U.error}`]:{color:(t.vars||t).palette.error.main}})),vo=f.forwardRef(function(o,s){var l,x;const a=ce({props:o,name:"MuiFormControlLabel"}),{className:p,componentsProps:c={},control:y,disabled:i,disableTypography:u,label:h,labelPlacement:v="end",required:d,slotProps:n={}}=a,S=z(a,mo),C=Te(),T=(l=i??y.props.disabled)!=null?l:C==null?void 0:C.disabled,g=d??y.props.required,j={disabled:T,required:g};["checked","name","onChange","value","inputRef"].forEach(N=>{typeof y.props[N]>"u"&&typeof a[N]<"u"&&(j[N]=a[N])});const I=Pe({props:a,muiFormControl:C,states:["error"]}),w=M({},a,{disabled:T,labelPlacement:v,required:g,error:I.error}),L=fo(w),D=(x=n.typography)!=null?x:c.typography;let P=h;return P!=null&&P.type!==$&&!u&&(P=e.jsx($,M({component:"span"},D,{className:W(L.label,D==null?void 0:D.className),children:P}))),e.jsxs(yo,M({className:W(L.root,p),ownerState:w,ref:s},S,{children:[f.cloneElement(y,j),g?e.jsxs(ho,{display:"block",children:[P,e.jsxs(bo,{ownerState:w,"aria-hidden":!0,className:L.asterisk,children:["â€‰","*"]})]}):P]}))}),jo=vo;function wo(t){return Z("MuiFormGroup",t)}ie("MuiFormGroup",["root","row","error"]);const So=["className","row"],Co=t=>{const{classes:o,row:s,error:l}=t;return Q({root:["root",s&&"row",l&&"error"]},wo,o)},ko=G("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,s.row&&o.row]}})(({ownerState:t})=>M({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),To=f.forwardRef(function(o,s){const l=ce({props:o,name:"MuiFormGroup"}),{className:x,row:a=!1}=l,p=z(l,So),c=Te(),y=Pe({props:l,muiFormControl:c,states:["error"]}),i=M({},l,{row:a,error:y.error}),u=Co(i);return e.jsx(ko,M({className:W(u.root,x),ownerState:i,ref:s},p))}),Po=To,Do=({imeiNo:t})=>{const{selectedVehicle:o,parameterData:s,ivnPid:l,locationData:x,vehicleList:a,onlineVehicle:p}=F(g=>g.liveMap),{ivnParameters:c,mode:y}=F(g=>g.dashboard),i=H(y),[u,h]=f.useState(),[v,d]=f.useState(!1),[n,S]=f.useState();f.useState({mainInputVoltage:0,ignition:0,speed:0}),f.useEffect(()=>{C()},[o]);const C=()=>{var g,j,I;if(x.length>0){let w=x.find(L=>L.latestDocument.imei===o.imei);w?(h((g=w==null?void 0:w.latestDocument)==null?void 0:g.speed),d((j=w==null?void 0:w.latestDocument)==null?void 0:j.ignition),S((I=w==null?void 0:w.latestDocument)==null?void 0:I.mainInputVoltage)):(h(0),d(0),S(0))}else h(0),d(0),S(0)},T=()=>{console.log("onlineVehicle",p),console.log("imeiNo",t);let g=0;return p.length>0&&p.forEach(j=>{t!=null&&t.includes(String(j))&&g++}),console.log("count",g),g};return e.jsxs(e.Fragment,{children:[e.jsx(m,{sx:{mx:"10px",pt:"10px",color:i.grey[400]},children:e.jsx("b",{children:o==null?void 0:o.reg_id})}),e.jsx(m,{sx:{backgroundColor:i.grey[200],height:"12vh",borderRadius:"8px",p:"5px"},children:e.jsx(m,{sx:{},children:e.jsx(K,{container:!0,spacing:3,mt:"2.5px",children:e.jsx(K,{item:!0,xs:12,children:e.jsx(K,{container:!0,justifyContent:"space-around",spacing:3,children:[{label:"Online/Offline Vehicles",value:`${T()} / ${a.length-T()}`},{label:"Speed",value:u,unit:"km/h"},{label:"Main Input Voltage",value:parseFloat(n).toFixed(2),unit:"voltage"},{label:"Ignition",value:v?"on":"off"}].map((g,j)=>e.jsx(K,{item:!0,children:e.jsxs(Ct,{sx:{height:70,width:250,backgroundColor:i.grey[100],color:i.grey[400],display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px"},children:[e.jsxs(m,{children:[e.jsx($,{variant:"h6",sx:{fontSize:"12px"},children:g.label}),e.jsxs($,{variant:"h6",sx:{fontSize:"18px",fontWeight:"bold"},children:[g.value," ",g==null?void 0:g.unit]})]}),e.jsx(po,{src:ut,sx:{width:20,height:20}})]})},j))})})})})})]})},ae=({title:t,selectedTripData:o})=>{const{mode:s,loading:l}=F(i=>i.dashboard),{selectedVehicle:x}=F(i=>i.liveMap),[a,p]=f.useState([]);f.useEffect(()=>{let i=o.map(h=>{let v={...h};return v.ignition=v.ignition?1:0,v});const u=y(i);p(u)},[o]);const c=H(s),y=i=>{let u=null;return i.forEach(h=>{const v=new Date(h.createdAt);u&&u.toDateString()===v.toDateString()?(h.date=V(h.createdAt).format("HH:mm:ss"),h.ignition=h.ignition?1:0):(h.date=V(h.createdAt).format("DD-MM-YYYY"),h.ignition=h.ignition?1:0),u=v}),i};return e.jsx(m,{sx:{ml:"2rem",border:c.grey[300],fontSize:"13px",height:"24vh",color:c.grey[400],backgroundColor:c.grey[100],borderRadius:"5px"},children:a&&a.length>0?e.jsx(ht,{children:e.jsxs(gt,{data:a,margin:{top:15,right:10,left:-25,bottom:0},children:[e.jsx(xt,{dataKey:"date",stroke:c.grey[400]}),e.jsx(mt,{stroke:c.grey[400]}),e.jsx(ft,{type:"monotone",dataKey:t,dot:!1,stroke:"#EF5B05",strokeWidth:2}),e.jsx(yt,{layout:"horizontal",verticalAlign:"top",align:"center"}),e.jsx(bt,{})]})}):e.jsx(Me,{style:{background:c.grey[100],width:"400px",height:"100px",margin:"auto",marginTop:"10px"},children:Object.keys(x).length===0?e.jsx($,{textAlign:"center",align:"center",mt:"20px",color:c.grey[600],children:"Please Select a Vehicle"}):l?e.jsx(De,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx($,{textAlign:"center",color:c.grey[600],children:"Sorry! No Trips Available"})})})},Io=()=>{const t=J(),{center:o,selectedParameterList:s,selectedVehicle:l,vehicleList:x,tractorIcon:a,icons:p,locationData:c,ivnPid:y,placesData:i}=F(D=>D.liveMap),{mode:u}=F(D=>D.dashboard),{isLoaded:h,loadError:v}=At({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"}),[d,n]=f.useState(null),[S,C]=f.useState(!0),[T,g]=f.useState(5),j=H(u),I=()=>{if(!S)t(be({lat:21,lng:78})),g(4),C(P=>!P);else{const D=c.find(P=>P.latestDocument.imei===l.imei);if(D){console.log(D.latestDocument,"getCenter");const{lat:P,lng:N}=D.latestDocument;t(be({lat:P,lng:N})),g(12),C(ee=>!ee)}else Y.error("Data is not available for selected vehicle")}};if(f.useEffect(()=>{h&&n(window.google.maps)},[h,c]),v)return"Error loading maps";if(!h)return"Loading maps";const w={height:"41.5vh",width:"99%",marginTop:"0px",marginLeft:"10px"},L=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}];return d?e.jsxs("div",{children:[e.jsxs(m,{sx:{ml:"10px",fontSize:"20px",display:"flex",justifyContent:"space-between",color:j.grey[400]},children:[e.jsx("b",{children:"Live Map"}),e.jsx(Po,{sx:{marginLeft:0,paddingTop:0,color:j.grey[400]},children:e.jsx(jo,{control:e.jsx(Tt,{checked:S,onChange:I}),label:S?"Group":"Individual"})})]}),e.jsx(Ft,{mapContainerStyle:w,zoom:T,center:o,options:{mapTypeControl:!1,styles:u?L:""},children:c&&c.length>0&&c.map((D,P)=>e.jsx(Lt,{position:{lat:D.latestDocument.lat,lng:D.latestDocument.lng},icon:{fillColor:"red",fillOpacity:2,strokeWeight:1,scale:2}},P))})]}):null},Mo=({vehicleData:t})=>{const o=["Engine RPM","Engine coolant temperature","Battery Potential"],s=J(),{selectedVehicle:l}=F(d=>d.liveMap),{startDate:x,endDate:a,mode:p}=F(d=>d.dashboard),[c,y]=f.useState(""),i=H(p),u=t.length>0&&t.filter(d=>d.label.toLowerCase().includes(c.toLowerCase())),h=d=>{y(d.target.value)},v=async d=>{var g;s(Ye({imei:d.value,reg_id:d.label}));let n={imei:d.value,startDate:we().subtract(5,"day"),endDate:we()};s(Je(n));let S=d.label;const C=await s(Xe({registration_id:S}));let T=[];if(C&&C.payload.length>0&&((g=C.payload)==null||g.map(j=>{j.ivn_parameter.length>0&&T.push(j.ivn_parameter[0])})),T.length>0){let j=T.filter(I=>o.includes(I.pid_description));s(ve(j))}else s(ve([]))};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(m,{sx:{align:"center",my:"15px",ml:"20px"},children:e.jsxs(vt,{sx:{width:"90%",backgroundColor:"white",borderRadius:"5px"},variant:"outlined",children:[e.jsx(jt,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px"},children:"Search"}),e.jsx(wt,{onChange:d=>h(d),inputProps:{style:{padding:7}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(St,{position:"end",children:e.jsx(Ie,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(Rt,{})})}),label:"Search"})]})}),u.length>0&&u.map((d,n)=>e.jsx(m,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(q,{variant:"outlined",onClick:()=>{v(d)},sx:{width:"90%",bgcolor:d.label===l.reg_id?ke.bgColor:"undefined",color:d.label===l.reg_id?"#DAE0EE":i.grey[400]},children:d.label})},n))]})})};var ue={},Ao=de;Object.defineProperty(ue,"__esModule",{value:!0});var Ae=ue.default=void 0,Fo=Ao(pe()),Lo=e;Ae=ue.default=(0,Fo.default)((0,Lo.jsx)("path",{d:"M10.02 6 8.61 7.41 13.19 12l-4.58 4.59L10.02 18l6-6z"}),"NavigateNextOutlined");var he={},Ro=de;Object.defineProperty(he,"__esModule",{value:!0});var Fe=he.default=void 0,_o=Ro(pe()),$o=e;Fe=he.default=(0,_o.default)((0,$o.jsx)("path",{d:"M15.61 7.41 14.2 6l-6 6 6 6 1.41-1.41L11.03 12z"}),"NavigateBeforeOutlined");var ge={},No=de;Object.defineProperty(ge,"__esModule",{value:!0});var Le=ge.default=void 0,Eo=No(pe()),Se=e;Le=ge.default=(0,Eo.default)([(0,Se.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7M7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9"},"0"),(0,Se.jsx)("circle",{cx:"12",cy:"9",r:"2.5"},"1")],"LocationOnOutlined");const Oo=()=>{const t=J(),o=Ke(),{tripList:s,selectedTripData:l,loading:x,trips:a,activeIndex:p,searchText:c,mode:y}=F(r=>r.dashboard),{selectedVehicle:i}=F(r=>r.liveMap),[u,h]=f.useState(0),[v,d]=f.useState(0),[n,S]=f.useState(0),[C,T]=f.useState(0),[g,j]=f.useState("0"),[I,w]=f.useState(0),[L,D]=f.useState(!1),P=H(y),N=()=>{h(r=>r+3)},xe=()=>{h(r=>Math.max(r-5,0))};f.useEffect(()=>{const r=ee(s);if(r.length>0){t(se(r[0]));const b=s&&s.length>0&&s.filter(k=>k.formatedDate.toLowerCase().includes(c.toLowerCase()));b.length>0&&te(0,b[0])}t(Qe(r))},[s]),f.useEffect(()=>{if(l.length>0){const r=l.map(k=>({lat:parseFloat(k.lat),lng:parseFloat(k.lng)})),b=new window.google.maps.Polygon({paths:r});me(b)}},[l]);const ee=r=>{const b=new Set,k=[];return r.forEach(A=>{b.has(A.formatedDate)||(b.add(A.formatedDate),k.push(A.formatedDate))}),k},B=s&&s.length>0&&s.filter(r=>r.formatedDate.toLowerCase().includes(c.toLowerCase())),Re=r=>{if(B&&B.length>0){const b=s&&s.length>0&&s.filter(k=>k.formatedDate.toLowerCase().includes(r.toLowerCase()));t(re(0)),t(se(r)),te(0,b[0])}else t(re(null)),t(se(r))},te=async(r,b)=>{var R;console.log("item",b);let k={imei:i.imei,startDate:b.startDate,endDate:b.endDate};D(!0);const A=await Ze(k);((R=A==null?void 0:A.data)==null?void 0:R.documents.length)>0?(t(je(A.data.documents[0].data)),_e(A.data.documents[0].data),D(!1)):(T(0),S(0),w(0),d(0),j("0"),t(je([])),D(!1)),t(re(r))},_e=r=>{let b=0,k=0;r.map((_,X)=>{_.packetType==="HB"&&b++,_.packetType==="HA"&&k++}),d(b),S(k);let A=$e(new Date(r[0].createdAt).toISOString(),new Date(r[r.length-1].createdAt).toISOString());console.log("hours: ",A),j(A);const R=Ne(r);w(R);const E=r.map(_=>({lat:parseFloat(_.lat),lng:parseFloat(_.lng)})),O=new window.google.maps.Polygon({paths:E});me(O)};function $e(r,b){var k=V(r),A=V(b);console.log("startDate-------->",r,b);let R=V.duration(A.diff(k)),E=R.hours(),O=R.minutes(),_=R.seconds(),X=`${E}h ${O}m ${_}s`;return console.log("string",X),X}function Ne(r){let b=0;for(let k=0;k<r.length-1;k++){const A=r[k].lat,R=r[k].lng,E=r[k+1].lat,O=r[k+1].lng;b+=Ee(A,R,E,O)}return b}function Ee(r,b,k,A){const E=(k-r)*Math.PI/180,O=(A-b)*Math.PI/180,_=Math.sin(E/2)*Math.sin(E/2)+Math.cos(r*Math.PI/180)*Math.cos(k*Math.PI/180)*Math.sin(O/2)*Math.sin(O/2);return 6371*(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)))}const me=r=>{if(!window.google||!window.google.maps.geometry){console.log("not loaded");return}const k=window.google.maps.geometry.spherical.computeArea(r.getPath())/4046.86;T(k)},Oe=r=>{p!==null?r===p?o("/trip-monitor"):Y.error("Trip not selected"):Y.error("Please select the trip")};return e.jsxs(e.Fragment,{children:[e.jsxs(m,{sx:{width:"95%",display:"flex",overflow:"auto",mx:"10px"},children:[e.jsx("div",{style:{display:"flex"},children:a&&a.length>0&&a.slice(u,u+5).map((r,b)=>e.jsx(m,{sx:{backgroundColor:c===r?"#EF5B05":"white",color:c===r?"white":"#EF5B05",mx:"5px",p:"5px",borderRadius:"5px",width:"90px",height:"25px",textAlign:"center",cursor:"pointer"},onClick:()=>{Re(r)},children:r},b))}),u!==0&&e.jsx("button",{onClick:xe,style:{marginLeft:"5px",backgroundColor:"white",color:"black"},disabled:u===0,children:e.jsx(Fe,{})}),!(u+5>=a.length)&&e.jsx("button",{onClick:N,style:{marginLeft:"5px",backgroundColor:"white",color:"black"},disabled:u+5>=a.length,children:e.jsx(Ae,{})})]}),e.jsx(m,{children:B&&B.length>0?e.jsx($t,{sx:{maxHeight:210,height:210,width:"98%",ml:"10px",mt:"10px",borderRadius:"5px",border:"1px solid #dbdad5"},children:e.jsx(Nt,{stickyHeader:!0,"aria-label":"sticky table",children:e.jsx(Et,{children:B&&B.length>0&&B.map((r,b)=>e.jsxs(Ot,{sx:{backgroundColor:p===b?"#DAE0EE":P.grey[100]},children:[e.jsxs(ne,{align:"left",style:{fontSize:"12px",padding:10,color:p===b?"black":P.grey[400],cursor:"pointer"},onClick:()=>{te(b,r)},children:[b+1,". ",r.startLocation," to ",r.endLocation]}),e.jsxs(ne,{align:"right",style:{fontSize:"12px",padding:10,color:p===b?"black":P.grey[400]},children:[r!=null&&r.startDate?V(new Date(r.startDate).toISOString()).format("LT"):""," ","to"," ",r!=null&&r.endDate?V(new Date(r.endDate).toISOString()).format("LT"):"----"]}),e.jsx(ne,{align:"right",style:{fontSize:"12px",padding:10,color:p===b?"black":P.grey[400]},children:e.jsx("span",{title:"Navigate to map",style:{cursor:"pointer"},onClick:()=>{Oe(b)},children:e.jsx(Le,{})})})]}))})})}):e.jsx(m,{sx:{height:210,display:"flex",justifyContent:"center",alignItems:"center",color:P.grey[400],margin:"auto"},children:e.jsx(Me,{style:{background:P.grey[100],width:"400px",height:"100px"},children:Object.keys(i).length===0?e.jsx($,{textAlign:"center",align:"center",mt:"20px",color:P.grey[600],children:"Please Select a Vehicle"}):x?e.jsx(De,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx($,{textAlign:"center",color:P.grey[600],children:"Sorry! No Trips Available"})})})}),l.length>0&&e.jsx(m,{sx:{my:"0px"},children:e.jsxs(m,{sx:{display:"flex",mx:"5px",mt:"5px"},children:[e.jsxs(m,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Braking"}),e.jsx("div",{children:"0"})]}),e.jsxs(m,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Acceleration"}),e.jsx("div",{children:"0"})]}),e.jsxs(m,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Running Hrs"}),e.jsx("div",{children:g})]}),e.jsxs(m,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Distance"}),e.jsx("div",{children:parseFloat(parseFloat(I).toFixed(2))})]})]})})]})},Bo=()=>{const{mode:t}=F(s=>s.dashboard),o=H(t);return e.jsxs(m,{children:[e.jsxs(m,{sx:{display:"flex",ml:"5px"},children:[e.jsx(m,{sx:{m:"5px",fontSize:"20px",width:"60%",color:o.grey[400]},children:e.jsx("b",{children:"Trip History"})}),e.jsx(m,{children:e.jsx(_t,{})})]}),e.jsx(m,{sx:{my:"5px"},children:e.jsx(Oo,{})})]})},Vo=({title:t,setShowVehicles:o,showVehicles:s,setShowNotification:l,showNotification:x})=>{JSON.parse(localStorage.getItem("w_userDetails"));const a=J(),{collapsed:p}=F(v=>v.auth),{selectedVehicle:c,tractorIcon:y}=F(v=>v.liveMap),{mode:i}=F(v=>v.dashboard),u=()=>{console.log("clicked"),a(tt(!p))},h={fontSize:"26px",fontWeight:500,lineHeight:"18.38px",color:"#fff",textAlign:"center",paddingTop:"11px"};return e.jsxs(m,{style:{display:"flex",justifyContent:"space-between",paddingRight:"20px",backgroundColor:ke.bgColor,alignItems:"center",textAlign:"center",height:"60px",color:"white"},children:[e.jsxs(m,{style:{display:"flex",justifyContent:"space-between",gap:"10px"},children:[p?e.jsx(q,{onClick:u,sx:{color:"white"},children:e.jsx(at,{style:{width:"30px",height:"30px"}})}):e.jsx(q,{onClick:u,sx:{color:"white"},children:e.jsx(it,{style:{width:"30px",height:"30px"}})}),e.jsx($,{style:h,children:t})]}),e.jsxs(m,{style:{display:"flex",gap:"5px",alignItems:"center"},children:[e.jsxs(q,{variant:"outlined",size:"small",sx:{color:s?"white":"black",backgroundColor:s?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:()=>{o(!s),t==="Live Map"&&setShowParameters(!1),t==="Trip Monitor"&&setSideBarTrip(!1),t==="Parameter Monitor"&&setShowParameters(!1),t==="Dashboard"&&l(!1)},children:[e.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",style:{marginRight:"5px"},children:e.jsx("path",{d:y.path1})}),Object.keys(c).length>0?c.reg_id:"Vehicles"]}),e.jsx(m,{children:e.jsx(q,{onClick:()=>{console.log("clicked"),o(!1),l(!x)},children:e.jsx(Bt,{sx:{cursor:"pointer",color:"white"}})})}),e.jsx(Ie,{onClick:()=>{a(et(!i))},sx:{color:"white"},children:i?e.jsx(ct,{}):e.jsx(dt,{})})]})]})},ds=()=>{const{w_customer_id:t}=F(n=>n.auth),{mode:o,selectedTripData:s}=F(n=>n.dashboard),[l,x]=f.useState(()=>{const n=sessionStorage.getItem("imeiNo");return n?JSON.parse(n):[]}),a=J(),p=H(o),[c,y]=f.useState([]),[i,u]=f.useState(!1),[h,v]=f.useState(!1);f.useEffect(()=>{d()},[]),f.useEffect(()=>{sessionStorage.setItem("imeiNo",JSON.stringify(l))},[l]),f.useEffect(()=>{le.on("geofenceAlert",n=>{(n==null?void 0:n.imei)!==null&&l.find(T=>parseInt(T)===(n==null?void 0:n.imei))&&(console.log("geofence"),Y.error(`Type: ${n==null?void 0:n.type} ${n==null?void 0:n.msg} ${n==null?void 0:n.imei}`,{id:"geofence",autoClose:5e3}))}),le.on("speedAlert",n=>{(n==null?void 0:n.imei)!==null&&l.find(T=>parseInt(T)===(n==null?void 0:n.imei))&&Y.error(`${n==null?void 0:n.msg} ${n==null?void 0:n.imei}`,{id:"speed",autoClose:5e3})})},[le]);const d=async()=>{let n=[],S=[];(await a(ot({w_customer_id:t}))).payload.map(j=>{var I,w;n.push({id:j.id,label:j.registration_id,value:(I=j.imei[0])==null?void 0:I.mac_id}),S.push((w=j.imei[0])==null?void 0:w.mac_id)}),x(S);const T="one",g=S;S.length>0&&(a(st({type:T,imei:g})),a(rt(g))),y(n),a(lt({w_customer_id:t})),a(nt({}))};return e.jsxs("div",{className:"app",children:[e.jsx(pt,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Vo,{title:"Dashboard",showVehicles:i,setShowVehicles:u,setShowNotification:v,showNotification:h}),e.jsxs("div",{style:{height:"92vh",backgroundColor:p.grey[100],padding:"10px"},children:[i&&e.jsx(m,{sx:{position:"fixed",width:"250px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:p.grey[100]},children:e.jsx(Mo,{vehicleData:c})}),h&&e.jsx(m,{sx:{position:"fixed",width:"300px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:p.grey[100]},children:e.jsx(Vt,{})}),e.jsx(m,{sx:{height:"21%"},children:e.jsx(Do,{imeiNo:l})}),e.jsxs(m,{sx:{display:"flex",height:"50%"},children:[e.jsx(m,{sx:{width:"50%",border:"1px solid #E8E8E8",padding:"2px",borderRadius:"5px"},children:e.jsx(Bo,{})}),e.jsx(m,{sx:{width:"50%"},children:e.jsx(Io,{})})]}),e.jsxs(m,{sx:{display:"flex",height:"30%",mt:"5px",pt:"10px"},children:[e.jsx(m,{style:{width:"33%"},children:e.jsx(ae,{title:"speed",selectedTripData:s})}),e.jsx(m,{style:{width:"33%"},children:e.jsx(ae,{title:"mainInputVoltage",selectedTripData:s})}),e.jsx(m,{style:{width:"33%"},children:e.jsx(ae,{title:"ignition",selectedTripData:s})})]})]})]})]})};export{ds as default};
