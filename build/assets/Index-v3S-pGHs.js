import{j as i,t as me,P as q,r as o,a as G,u as oe,v as Ae,a8 as ee,l as Ie,_ as X,m as ve,a0 as ye}from"./index-C6aVxtSD.js";import{L as Ee}from"./LightModeOutlined-CfIb7JC1.js";import{L as we}from"./LiveMapTopBar-MkhxuqAx.js";import{V as xe}from"./VehicleMenu-CmPTpXBL.js";import{d as Se,t as Pe}from"./Search-BfJjCIFL.js";import"./Loader-Cn6T0Y7L.js";import{s as z}from"./Socket-0N_gnJcr.js";import{P as Ce}from"./Parameters-BUgVVjbS.js";/* empty css           */import{B as Oe,C as be,r as Le,c as Be,u as Me,l as Fe,d as Re,o as De,e as ke,g as Ne,M as We,T as Te,O as je,b as He,f as Y,a as te,V as Ve,F as Ye,P as Ge,S as Qe,I as Je,h as Ue}from"./Vector-BEQdHjna.js";import{B as W,C as Ke}from"./CircularProgress-BEl1-D2a.js";import{S as se}from"./Select-izrswFFx.js";import{b as qe}from"./OutlinedInput-FezWvFu-.js";import{I as Xe}from"./IconButton-B6wRr4DP.js";import"./createSvgIcon-nf6WM_Nx.js";import"./jcb-aCHXMCXy.js";import"./index-BkHb5ygf.js";import"./roundedArrow-CdGJs-Ev.js";import"./TextArea-fMr3Qj6r.js";import"./index-TpMPGZMs.js";import"./Card-BXPefkxV.js";import"./Paper-BaWCleiZ.js";import"./CardContent-C2St2vKy.js";const ne="/assets/motorbike-Ve1wpD8A.png";function ze({activeParams:y}){return i.jsx(W,{sx:{bgcolor:me.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:y&&y[0].params.length>0?i.jsxs(i.Fragment,{children:[y[0].params.length>0&&i.jsxs(q,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",y[0].reg_id]}),y.length>0&&y[0].params.map((e,l)=>i.jsx(q,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:e.label==="speed"?`${e.label} : ${e.value} km/h`:e.label==="mainInputVoltage"?`${e.label} : ${e.value} voltage`:e.label==="ignition"?`${e.label} : ${e.value===!0||(e==null?void 0:e.value)===1?"On":"Off"}`:`${e.label} : ${e.value}`},l))]}):i.jsx(i.Fragment,{children:i.jsx(q,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})})}const f={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Ze extends Oe{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+be,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(f.ELEMENT,this.handleElementChanged),this.addChangeListener(f.MAP,this.handleMapChanged),this.addChangeListener(f.OFFSET,this.handleOffsetChanged),this.addChangeListener(f.POSITION,this.handlePositionChanged),this.addChangeListener(f.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(f.ELEMENT)}getId(){return this.id}getMap(){return this.get(f.MAP)||null}getOffset(){return this.get(f.OFFSET)}getPosition(){return this.get(f.POSITION)}getPositioning(){return this.get(f.POSITIONING)}handleElementChanged(){Le(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Be(this.element),Me(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Fe(e,Re.POSTRENDER,this.render,this),this.updatePixelPosition();const l=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?l.insertBefore(this.element,l.childNodes[0]||null):l.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(f.ELEMENT,e)}setMap(e){this.set(f.MAP,e)}setOffset(e){this.set(f.OFFSET,e)}setPosition(e){this.set(f.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const l=this.getMap();if(!l||!l.getTargetElement()||!this.get(f.POSITION))return;const a=this.getRect(l.getTargetElement(),l.getSize()),c=this.getElement(),d=this.getRect(c,[De(c),ke(c)]);e=e||{};const E=e.margin===void 0?20:e.margin;if(!Ne(a,d)){const g=d[0]-a[0],C=a[2]-d[2],w=d[1]-a[1],u=a[3]-d[3],x=[0,0];if(g<0?x[0]=g-E:C<0&&(x[0]=Math.abs(C)+E),w<0?x[1]=w-E:u<0&&(x[1]=Math.abs(u)+E),x[0]!==0||x[1]!==0){const T=l.getView().getCenterInternal(),O=l.getPixelFromCoordinateInternal(T);if(!O)return;const D=[O[0]+x[0],O[1]+x[1]],k=e.animation||{};l.getView().animateInternal({center:l.getCoordinateFromPixelInternal(D),duration:k.duration,easing:k.easing})}}}getRect(e,l){const a=e.getBoundingClientRect(),c=a.left+window.pageXOffset,d=a.top+window.pageYOffset;return[c,d,c+l[0],d+l[1]]}setPositioning(e){this.set(f.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),l=this.getPosition();if(!e||!e.isRendered()||!l){this.setVisible(!1);return}const a=e.getPixelFromCoordinate(l),c=e.getSize();this.updateRenderedPosition(a,c)}updateRenderedPosition(e,l){const a=this.element.style,c=this.getOffset(),d=this.getPositioning();this.setVisible(!0);const E=Math.round(e[0]+c[0])+"px",g=Math.round(e[1]+c[1])+"px";let C="0%",w="0%";d=="bottom-right"||d=="center-right"||d=="top-right"?C="-100%":(d=="bottom-center"||d=="center-center"||d=="top-center")&&(C="-50%"),d=="bottom-left"||d=="bottom-center"||d=="bottom-right"?w="-100%":(d=="center-left"||d=="center-center"||d=="center-right")&&(w="-50%");const u=`translate(${C}, ${w}) translate(${E}, ${g})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,a.transform=u)}getOptions(){return this.options}}const _e="/assets/3W-DS7zfQvi.png",$e="data:image/png;base64,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";function et({showCard:y,loadingVehicle:e}){const l=o.useRef(),a=o.useRef(),[c,d]=o.useState(null),{selectedParameterList:E,selectedVehicle:g,vehicleList:C,icons:w,locationData:u,placesData:x,imeiNumbers:T,onlineVehicle:O,loading:D,services_loading:k}=G(t=>t.liveMap),{mode:K,styles:Z,vehicles_details:b}=G(t=>t.dashboard);o.useState("");const[Q,F]=o.useState([]),[_,J]=o.useState([]),[h,S]=o.useState(),[v,j]=o.useState(),[H,p]=o.useState(null),[N,P]=o.useState(""),[m,L]=o.useState({lat:18.516726,lng:73.856255}),[B,ie]=o.useState(""),[re,ae]=o.useState(null),le=oe();o.useEffect(()=>{if(c){const t=document.getElementById("popup");t&&(t.style.background="white",t.style.padding="10px",t.style.borderRadius="8px",t.style.cursor="pointer")}},[c]),o.useEffect(()=>{var t,s,r,A;if(console.log("locationData",u),console.log("vehicles_details",b),Object.keys(g).length>0){console.log("selectedVehicle",g);const n=u==null?void 0:u.filter(I=>{var M;return((M=I==null?void 0:I.latestDocument)==null?void 0:M.imei)==(g==null?void 0:g.imei)});console.log("filteredVehicle",n),S(n),L({lat:(s=(t=n==null?void 0:n[0])==null?void 0:t.latestDocument)==null?void 0:s.lat,lng:(A=(r=n==null?void 0:n[0])==null?void 0:r.latestDocument)==null?void 0:A.lng})}else S(u)},[u,g]),o.useEffect(()=>{j(E)},[E]),o.useEffect(()=>(z.on("locationinfo",t=>{if(console.log("locationinfo",t),h==null||h.map(s=>{if(s.latestDocument.imei===t.imei){const r={lat:s.latestDocument.lat,lng:s.latestDocument.lng},A=500,n=60,I=A/(1e3/n),M=(t.lat-r.lat)/I,R=(t.lng-r.lng)/I;let V=0;const U=setInterval(()=>{const he=r.lat+M*V,pe=r.lng+R*V,fe={...s,latestDocument:{...s.latestDocument,lat:he,lng:pe}};V++,V>=I&&clearInterval(U),S(ge=>ge.map($=>$.latestDocument.imei===t.imei?fe:$))},1e3/n)}return s}),String(t==null?void 0:t.imei)===String(v[0].imei)){const s=v[0].params.map(r=>{let A=r.label;return{...r,value:t[A]}});j([{...v[0],params:s}])}}),()=>{z.off("locationinfo")}),[z,h,v]),o.useEffect(()=>{le(Ae({}))},[g]),o.useEffect(()=>{if((u==null?void 0:u.length)>0&&O.length>0){const t=[],s=[];u==null||u.forEach(r=>{O.some(n=>String(n)===String(r._id))?t.push(r):s.push(r)}),F(t),J(s)}else F([]),J([])},[u,O]),o.useEffect(()=>{const t=new We({target:l.current,layers:[new Te({source:new je})],view:new He({center:Y([m==null?void 0:m.lng,m==null?void 0:m.lat]),zoom:Object.keys(g).length>0?15:6})});ae(t),a.current=t;const s=document.createElement("div");s.id="popup",s.className="ol-popup",s.innerHTML='<div id="popup-content"></div><a href="#" id="popup-closer" className="ol-popup-closer"></a>',document.body.appendChild(s);const r=new Ze({element:s,autoPan:!0,autoPanAnimation:{duration:250}});return t.addOverlay(r),d(r),()=>{a.current&&a.current.setTarget(null),s&&s.parentNode&&s.parentNode.removeChild(s)}},[m]),o.useEffect(()=>{m&&a.current&&a.current.getView().setCenter(Y([m.lng,m.lat]))},[m]),o.useEffect(()=>{var t;if(a.current){let s=(t=a.current.getLayers().getArray().find(n=>n instanceof te))==null?void 0:t.getSource();if(s)s.clear();else{s=new Ve;const n=new te({source:s});a.current.addLayer(n)}h&&h.length>0&&h.forEach(n=>{const I=new Ye({geometry:new Ge(Y([n.latestDocument.lng,n.latestDocument.lat])),name:n.latestDocument.imei,vehicle:n}),M=ce(n.latestDocument.imei);if(I.setStyle(new Qe({image:new Je({anchor:[.5,1],src:(()=>{switch(M){case"2W":return ne;case"3W":return _e;case"4W":return $e;default:return ne}})(),scale:.1})})),s.addFeature(I),n.latestDocument.imei===H){const R=Y([n.latestDocument.lng,n.latestDocument.lat]);c.setPosition(R)}}),a.current.getInteractions().getArray().forEach(n=>{n instanceof se&&a.current.removeInteraction(n)});const A=new se({condition:Ue});a.current.addInteraction(A),A.on("select",function(n){if(n.selected.length>0){const I=n.selected[0],M=I.getGeometry().getCoordinates(),R=I.get("vehicle"),V=de(R.latestDocument.imei);if(p(R.latestDocument.imei),P(R.latestDocument.imei),c){c.setPosition(M);const U=document.getElementById("popup-content");U&&(U.innerHTML=`
                 <div>Vehicle No: ${V}</div>
                 <div>IMEI No: ${R.latestDocument.imei}</div>
               `)}}else p(null),P(""),c&&c.setPosition(void 0)})}},[h,H]),o.useEffect(()=>{const t=s=>{c&&!document.getElementById("popup").contains(s.target)&&(p(null),P(""),c.setPosition(void 0))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[c]);const ce=t=>{const s=b&&(b==null?void 0:b.length)>0&&b.find(r=>(r==null?void 0:r.value)===t&&(r==null?void 0:r.vehilce_type));return s?s.vehilce_type:null},de=t=>{const s=C.find(r=>{var A;return r.imei&&((A=r.imei[0])==null?void 0:A.mac_id)===t});return s?s.registration_id:"IMEI doesn't exist."},ue=async t=>{if(t.preventDefault(),B.trim()==="")return;const r=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${B}`)).json();if(r.length>0){const{lon:A,lat:n}=r[0],I=Y([parseFloat(A),parseFloat(n)]);re.getView().animate({center:I,zoom:15})}};return i.jsxs(i.Fragment,{children:[y&&i.jsx(ze,{activeParams:v}),(D||e)&&i.jsx(W,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:10},children:i.jsx(Ke,{})}),i.jsx("div",{ref:l,style:{width:"100%",height:"92vh"}}),i.jsxs(W,{component:"form",onSubmit:ue,border:"1px solid white",backgroundColor:"white",borderRadius:"3px",sx:{my:"6px",ml:"90px",position:"absolute",top:132,left:200,zIndex:1},children:[i.jsx(qe,{sx:{my:.5,mx:2},placeholder:"Search Locations",value:B,onChange:t=>ie(t.target.value)}),i.jsx(Xe,{type:"submit",sx:{p:1},children:i.jsx(Se,{})})]}),i.jsxs("div",{id:"popup",className:"ol-popup",style:{background:"white",padding:"10px",borderRadius:"8px"},children:[i.jsx("div",{id:"popup-content"}),i.jsx("a",{href:"#",id:"popup-closer",className:"ol-popup-closer"})]})]})}function St(){const{locationData:y,selectedVehicle:e,selectedParameterList:l}=G(h=>h.liveMap),{mode:a}=G(h=>h.dashboard),c=Pe(a),[d,E]=o.useState([]),{w_customer_id:g}=G(h=>h.auth),[C,w]=o.useState(),[u,x]=o.useState(!1),[T,O]=o.useState(!1),[D,k]=o.useState([]),[K,Z]=o.useState(!0),[b,Q]=o.useState(!1);let F=oe();o.useEffect(()=>{_()},[]),o.useEffect(()=>{k([]),F(ee([{reg_id:"",imei:"",params:[]}]))},[e]);const _=async()=>{try{Q(!0);let h=[],S=[];const v=await F(Ie({w_customer_id:g}));if(Array.isArray(v.payload)){v.payload.forEach(p=>{var N,P,m;Array.isArray(p.imei)&&p.imei.length>0&&((N=p.imei[0])!=null&&N.mac_id)?(h.push({id:p.id,label:p.registration_id,value:(P=p.imei[0])==null?void 0:P.mac_id,vehilce_type:p==null?void 0:p.segment}),S.push((m=p.imei[0])==null?void 0:m.mac_id)):(console.error("IMEI data not found for item:",p),X.error(`IMEI Number not found for the vehicle: ${p==null?void 0:p.registration_id}`))});const j="one",H=S;S.length>0&&F(ve({type:j,imei:H})),E(h),F(ye(h)),Q(!1)}else Q(!1),console.error("Unexpected data format:",v),X.error("Unexpected data format:")}catch(h){console.error("Error fetching vehicle data:",h),X.error(`Error fetching vehicle data: ${h}`)}},J=async h=>{const{label:S,imei:v,id:j,reg_id:H,checked:p}=h;w(L=>L.map(B=>B.id===j?{...B,checked:!p}:B));let N=[...D],P=[...D];if(!p)y.forEach(L=>{L.latestDocument.imei===v&&(N.push({label:S,value:L.latestDocument[S]}),P=N,k(N))});else{let L=D.filter(B=>B.label!==S);P=L,k(L)}console.log("tempParamList",P),F(ee([{reg_id:H,imei:v,params:P}]))};return i.jsxs("div",{className:"app",children:[i.jsx(Ee,{}),i.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[i.jsx(we,{title:"Live Map",setShowVehicles:x,showVehicles:u,showParameters:T,setShowParameters:O,setShowCard:Z,showCard:K}),i.jsxs(W,{style:{display:"flex",width:"100%",height:"95vh"},children:[i.jsx(W,{style:{width:u||T?"80%":"100%"},children:i.jsx(et,{showCard:K,loadingVehicle:b})}),u&&i.jsx(W,{style:{width:"20%",backgroundColor:c.grey[100]},children:i.jsx(xe,{vehicleData:d,title:"Live Map",setParameterData:w,loadingVehicle:b})}),T&&i.jsx(W,{style:{width:"20%",backgroundColor:c.grey[100]},children:i.jsx(Ce,{parametersData:C,setParameterData:w,handleParameterChange:J})})]})]})]})}export{St as default};
