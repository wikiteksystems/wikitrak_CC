import{j as i,t as ge,P as Q,r as o,a as W,u as oe,v as xe,a8 as ee,l as ve,_ as Y,m as ye,a0 as Pe}from"./index-CkEM2iZU.js";import{L as Ee}from"./LightModeOutlined-DwrSbFQO.js";import{L as Se}from"./LiveMapTopBar-C9_jyS6p.js";import{V as be}from"./VehicleMenu-UaiZ-db3.js";import{d as we,t as Ie}from"./Search-Lm4af4YY.js";import"./Loader-CTFUzGxG.js";import{s as U}from"./Socket-0N_gnJcr.js";import{P as Ce}from"./Parameters-CsB5kFBI.js";/* empty css           */import{B as Le,C as Oe,r as Me,c as je,u as Ne,l as Ve,d as De,o as Te,e as ke,g as _e,M as Fe,T as Ae,O as Re,b as Be,f as z,a as te,V as $e,F as ze,P as We,S as Ke,I as Ge,h as Xe}from"./Vector-BEQdHjna.js";import{B as F,C as He}from"./CircularProgress-DeZ2BqFl.js";import{S as se}from"./Select-izrswFFx.js";import{b as Qe}from"./OutlinedInput-BKRqVZbE.js";import{I as Ye}from"./IconButton-23MNsq5S.js";import"./createSvgIcon-C93OPwUN.js";import"./jcb-aCHXMCXy.js";import"./index-C5l955Kg.js";import"./roundedArrow-D9FeWgFs.js";import"./TextArea-ByKroLPF.js";import"./index-C0Mt995V.js";import"./Card-B3C2XIrL.js";import"./Paper-Cy36dRA1.js";import"./CardContent-DQKC1sY1.js";const ne="/assets/motorbike-Ve1wpD8A.png";function Ue({activeParams:y}){return i.jsx(F,{sx:{bgcolor:ge.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:y&&y[0].params.length>0?i.jsxs(i.Fragment,{children:[y[0].params.length>0&&i.jsxs(Q,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",y[0].reg_id]}),y.length>0&&y[0].params.map((e,l)=>i.jsx(Q,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:e.label==="speed"?`${e.label} : ${e.value} km/h`:e.label==="mainInputVoltage"?`${e.label} : ${e.value} voltage`:e.label==="ignition"?`${e.label} : ${e.value===!0||(e==null?void 0:e.value)===1?"On":"Off"}`:`${e.label} : ${e.value}`},l))]}):i.jsx(i.Fragment,{children:i.jsx(Q,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})})}const f={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class qe extends Le{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Oe,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(f.ELEMENT,this.handleElementChanged),this.addChangeListener(f.MAP,this.handleMapChanged),this.addChangeListener(f.OFFSET,this.handleOffsetChanged),this.addChangeListener(f.POSITION,this.handlePositionChanged),this.addChangeListener(f.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(f.ELEMENT)}getId(){return this.id}getMap(){return this.get(f.MAP)||null}getOffset(){return this.get(f.OFFSET)}getPosition(){return this.get(f.POSITION)}getPositioning(){return this.get(f.POSITIONING)}handleElementChanged(){Me(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(je(this.element),Ne(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Ve(e,De.POSTRENDER,this.render,this),this.updatePixelPosition();const l=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?l.insertBefore(this.element,l.childNodes[0]||null):l.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(f.ELEMENT,e)}setMap(e){this.set(f.MAP,e)}setOffset(e){this.set(f.OFFSET,e)}setPosition(e){this.set(f.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const l=this.getMap();if(!l||!l.getTargetElement()||!this.get(f.POSITION))return;const a=this.getRect(l.getTargetElement(),l.getSize()),c=this.getElement(),d=this.getRect(c,[Te(c),ke(c)]);e=e||{};const E=e.margin===void 0?20:e.margin;if(!_e(a,d)){const m=d[0]-a[0],C=a[2]-d[2],S=d[1]-a[1],h=a[3]-d[3],b=[0,0];if(m<0?b[0]=m-E:C<0&&(b[0]=Math.abs(C)+E),S<0?b[1]=S-E:h<0&&(b[1]=Math.abs(h)+E),b[0]!==0||b[1]!==0){const A=l.getView().getCenterInternal(),L=l.getPixelFromCoordinateInternal(A);if(!L)return;const T=[L[0]+b[0],L[1]+b[1]],k=e.animation||{};l.getView().animateInternal({center:l.getCoordinateFromPixelInternal(T),duration:k.duration,easing:k.easing})}}}getRect(e,l){const a=e.getBoundingClientRect(),c=a.left+window.pageXOffset,d=a.top+window.pageYOffset;return[c,d,c+l[0],d+l[1]]}setPositioning(e){this.set(f.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),l=this.getPosition();if(!e||!e.isRendered()||!l){this.setVisible(!1);return}const a=e.getPixelFromCoordinate(l),c=e.getSize();this.updateRenderedPosition(a,c)}updateRenderedPosition(e,l){const a=this.element.style,c=this.getOffset(),d=this.getPositioning();this.setVisible(!0);const E=Math.round(e[0]+c[0])+"px",m=Math.round(e[1]+c[1])+"px";let C="0%",S="0%";d=="bottom-right"||d=="center-right"||d=="top-right"?C="-100%":(d=="bottom-center"||d=="center-center"||d=="top-center")&&(C="-50%"),d=="bottom-left"||d=="bottom-center"||d=="bottom-right"?S="-100%":(d=="center-left"||d=="center-center"||d=="center-right")&&(S="-50%");const h=`translate(${C}, ${S}) translate(${E}, ${m})`;this.rendered.transform_!=h&&(this.rendered.transform_=h,a.transform=h)}getOptions(){return this.options}}const Je="/assets/3W-DS7zfQvi.png",Ze="/assets/4W-zFlpw5ld.png";function et({showCard:y,loadingVehicle:e}){const l=o.useRef(),a=o.useRef(),[c,d]=o.useState(null),{selectedParameterList:E,selectedVehicle:m,vehicleList:C,icons:S,locationData:h,placesData:b,imeiNumbers:A,onlineVehicle:L,loading:T,services_loading:k}=W(t=>t.liveMap),{mode:H,styles:q,vehicles_details:O}=W(t=>t.dashboard);o.useState("");const[K,V]=o.useState([]),[J,G]=o.useState([]),[u,w]=o.useState(),[P,R]=o.useState(),[B,p]=o.useState(null),[_,I]=o.useState(""),[g,M]=o.useState({lat:18.516726,lng:73.856255}),[j,ie]=o.useState(""),[re,ae]=o.useState(null),le=oe();o.useEffect(()=>{if(c){const t=document.getElementById("popup");t&&(t.style.background="white",t.style.padding="10px",t.style.borderRadius="8px",t.style.cursor="pointer")}},[c]),o.useEffect(()=>{var t,s,r,x;if(console.log("locationData",h),console.log("vehicles_details",O),Object.keys(m).length>0){console.log("selectedVehicle",m);const n=h==null?void 0:h.filter(v=>{var N;return((N=v==null?void 0:v.latestDocument)==null?void 0:N.imei)==(m==null?void 0:m.imei)});console.log("filteredVehicle",n),w(n),M({lat:(s=(t=n==null?void 0:n[0])==null?void 0:t.latestDocument)==null?void 0:s.lat,lng:(x=(r=n==null?void 0:n[0])==null?void 0:r.latestDocument)==null?void 0:x.lng})}else w(h)},[h,m]),o.useEffect(()=>{R(E)},[E]),o.useEffect(()=>(U.on("locationinfo",t=>{if(console.log("locationinfo",t),u==null||u.map(s=>{if(s.latestDocument.imei===t.imei){const r={lat:s.latestDocument.lat,lng:s.latestDocument.lng},x=500,n=60,v=x/(1e3/n),N=(t.lat-r.lat)/v,D=(t.lng-r.lng)/v;let $=0;const X=setInterval(()=>{const ue=r.lat+N*$,pe=r.lng+D*$,fe={...s,latestDocument:{...s.latestDocument,lat:ue,lng:pe}};$++,$>=v&&clearInterval(X),w(me=>me.map(Z=>Z.latestDocument.imei===t.imei?fe:Z))},1e3/n)}return s}),String(t==null?void 0:t.imei)===String(P[0].imei)){const s=P[0].params.map(r=>{let x=r.label;return{...r,value:t[x]}});R([{...P[0],params:s}])}}),()=>{U.off("locationinfo")}),[U,u,P]),o.useEffect(()=>{le(xe({}))},[m]),o.useEffect(()=>{if((h==null?void 0:h.length)>0&&L.length>0){const t=[],s=[];h==null||h.forEach(r=>{L.some(n=>String(n)===String(r._id))?t.push(r):s.push(r)}),V(t),G(s)}else V([]),G([])},[h,L]),o.useEffect(()=>{const t=new Fe({target:l.current,layers:[new Ae({source:new Re})],view:new Be({center:z([g==null?void 0:g.lng,g==null?void 0:g.lat]),zoom:Object.keys(m).length>0?15:6})});ae(t),a.current=t;const s=document.createElement("div");s.id="popup",s.className="ol-popup",s.innerHTML='<div id="popup-content"></div><a href="#" id="popup-closer" className="ol-popup-closer"></a>',document.body.appendChild(s);const r=new qe({element:s,autoPan:!0,autoPanAnimation:{duration:250}});return t.addOverlay(r),d(r),()=>{a.current&&a.current.setTarget(null),s&&s.parentNode&&s.parentNode.removeChild(s)}},[g]),o.useEffect(()=>{g&&a.current&&a.current.getView().setCenter(z([g.lng,g.lat]))},[g]),o.useEffect(()=>{var t;if(a.current){let s=(t=a.current.getLayers().getArray().find(n=>n instanceof te))==null?void 0:t.getSource();if(s)s.clear();else{s=new $e;const n=new te({source:s});a.current.addLayer(n)}u&&u.length>0&&u.forEach(n=>{const v=new ze({geometry:new We(z([n.latestDocument.lng,n.latestDocument.lat])),name:n.latestDocument.imei,vehicle:n}),N=ce(n.latestDocument.imei);if(v.setStyle(new Ke({image:new Ge({anchor:[.5,1],src:(()=>{switch(N){case"2W":return ne;case"3W":return Je;case"4W":return Ze;default:return ne}})(),scale:.1})})),s.addFeature(v),n.latestDocument.imei===B){const D=z([n.latestDocument.lng,n.latestDocument.lat]);c.setPosition(D)}}),a.current.getInteractions().getArray().forEach(n=>{n instanceof se&&a.current.removeInteraction(n)});const x=new se({condition:Xe});a.current.addInteraction(x),x.on("select",function(n){if(n.selected.length>0){const v=n.selected[0],N=v.getGeometry().getCoordinates(),D=v.get("vehicle"),$=de(D.latestDocument.imei);if(p(D.latestDocument.imei),I(D.latestDocument.imei),c){c.setPosition(N);const X=document.getElementById("popup-content");X&&(X.innerHTML=`
                 <div>Vehicle No: ${$}</div>
                 <div>IMEI No: ${D.latestDocument.imei}</div>
               `)}}else p(null),I(""),c&&c.setPosition(void 0)})}},[u,B]),o.useEffect(()=>{const t=s=>{c&&!document.getElementById("popup").contains(s.target)&&(p(null),I(""),c.setPosition(void 0))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[c]);const ce=t=>{const s=O&&(O==null?void 0:O.length)>0&&O.find(r=>(r==null?void 0:r.value)===t&&(r==null?void 0:r.vehilce_type));return s?s.vehilce_type:null},de=t=>{const s=C.find(r=>{var x;return r.imei&&((x=r.imei[0])==null?void 0:x.mac_id)===t});return s?s.registration_id:"IMEI doesn't exist."},he=async t=>{if(t.preventDefault(),j.trim()==="")return;const r=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${j}`)).json();if(r.length>0){const{lon:x,lat:n}=r[0],v=z([parseFloat(x),parseFloat(n)]);re.getView().animate({center:v,zoom:15})}};return i.jsxs(i.Fragment,{children:[y&&i.jsx(Ue,{activeParams:P}),(T||e)&&i.jsx(F,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:10},children:i.jsx(He,{})}),i.jsx("div",{ref:l,style:{width:"100%",height:y?"85vh":"93vh"}}),i.jsxs(F,{component:"form",onSubmit:he,border:"1px solid white",backgroundColor:"white",borderRadius:"3px",sx:{my:"6px",ml:"90px",position:"absolute",top:y?132:63,left:200,zIndex:1},children:[i.jsx(Qe,{sx:{my:.5,mx:2},placeholder:"Search Locations",value:j,onChange:t=>ie(t.target.value)}),i.jsx(Ye,{type:"submit",sx:{p:1},children:i.jsx(we,{})})]}),i.jsxs("div",{id:"popup",className:"ol-popup",style:{background:"white",padding:"10px",borderRadius:"8px"},children:[i.jsx("div",{id:"popup-content"}),i.jsx("a",{href:"#",id:"popup-closer",className:"ol-popup-closer"})]})]})}function wt(){const{locationData:y,selectedVehicle:e,selectedParameterList:l}=W(u=>u.liveMap),{mode:a}=W(u=>u.dashboard),c=Ie(a),[d,E]=o.useState([]),{w_customer_id:m}=W(u=>u.auth),[C,S]=o.useState(),[h,b]=o.useState(!1),[A,L]=o.useState(!1),[T,k]=o.useState([]),[H,q]=o.useState(!0),[O,K]=o.useState(!1);let V=oe();o.useEffect(()=>{J()},[]),o.useEffect(()=>{k([]),V(ee([{reg_id:"",imei:"",params:[]}]))},[e]);const J=async()=>{try{K(!0);let u=[],w=[];const P=await V(ve({w_customer_id:m}));if(Array.isArray(P.payload)){P.payload.forEach(p=>{var _,I,g;Array.isArray(p.imei)&&p.imei.length>0&&((_=p.imei[0])!=null&&_.mac_id)?(u.push({id:p.id,label:p.registration_id,value:(I=p.imei[0])==null?void 0:I.mac_id,vehilce_type:p==null?void 0:p.segment}),w.push((g=p.imei[0])==null?void 0:g.mac_id)):(console.error("IMEI data not found for item:",p),Y.error(`IMEI Number not found for the vehicle: ${p==null?void 0:p.registration_id}`))});const R="one",B=w;w.length>0&&V(ye({type:R,imei:B})),E(u),V(Pe(u)),K(!1)}else K(!1),console.error("Unexpected data format:",P),Y.error("Unexpected data format:")}catch(u){console.error("Error fetching vehicle data:",u),Y.error(`Error fetching vehicle data: ${u}`)}},G=async u=>{const{label:w,imei:P,id:R,reg_id:B,checked:p}=u;S(M=>M.map(j=>j.id===R?{...j,checked:!p}:j));let _=[...T],I=[...T];if(!p)y.forEach(M=>{M.latestDocument.imei===P&&(_.push({label:w,value:M.latestDocument[w]}),I=_,k(_))});else{let M=T.filter(j=>j.label!==w);I=M,k(M)}console.log("tempParamList",I),V(ee([{reg_id:B,imei:P,params:I}]))};return i.jsxs("div",{className:"app",children:[i.jsx(Ee,{}),i.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[i.jsx(Se,{title:"Live Map",setShowVehicles:b,showVehicles:h,showParameters:A,setShowParameters:L,setShowCard:q,showCard:H}),i.jsxs(F,{style:{display:"flex",width:"100%",height:"95vh"},children:[i.jsx(F,{style:{width:h||A?"80%":"100%"},children:i.jsx(et,{showCard:H,loadingVehicle:O})}),h&&i.jsx(F,{style:{width:"20%",backgroundColor:c.grey[100]},children:i.jsx(be,{vehicleData:d,title:"Live Map",setParameterData:S,loadingVehicle:O})}),A&&i.jsx(F,{style:{width:"20%",backgroundColor:c.grey[100]},children:i.jsx(Ce,{parametersData:C,setParameterData:S,handleParameterChange:G})})]})]})]})}export{wt as default};
