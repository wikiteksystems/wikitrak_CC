import{p as Ce,q as ke,w as I,x as se,y as W,z as De,A as Pe,B as Te,r as g,C as Ie,D as _,j as e,E as V,F as Fe,H as ne,I as G,J as Y,K as Ae,L as Z,M as $,N as ee,O as he,T as L,a as F,G as B,c as N,u as z,P as q,t as Re,Q as Me,R as Le,S as ae,i as ge,U as Ee,V as Q,W as xe,X as Ne,Y as _e,Z as $e,_ as M,$ as le,a0 as ie,b as ce,l as Oe,m as Ve,n as ze,a1 as Be,o as qe,v as Ge}from"./index-C0J5KT3H.js";import{L as Ye}from"./LightModeOutlined-BW34XPIq.js";import{s as X}from"./Socket-0N_gnJcr.js";import{p as Ue,R as He,L as We,X as Xe,Y as Je,a as Ke,b as Qe,T as Ze}from"./LineChart-PF_paWrC.js";import{t as E,d as et}from"./Search-D9wgoflv.js";import{B as b,C as te}from"./CircularProgress-nAflOzMD.js";import{P as tt}from"./Paper-PZgQk-1M.js";import{c as rt,S as ot}from"./Switch-DlbTQf1P.js";import{c as st,I as nt}from"./IconButton-BtPD9ajK.js";import{r as at,m as lt,a as it}from"./Modal-D_3Awd5z.js";import{C as ct}from"./index-BSF_A2wB.js";import{d as de}from"./index-D_74V0G8.js";import{u as fe,f as me,F as ye,I as ve,O as dt,a as pt}from"./OutlinedInput-JifRmEa6.js";import{d as ut,a as ht,D as gt}from"./ArrowForwardIos-Me5-Qys9.js";import{r as be}from"./createSvgIcon-MJCp1tbz.js";import{T as xt,a as ft,d as mt,b as yt,c as J}from"./TableRow-BaNQl-wx.js";import{C as vt}from"./Card-DBDCQ9Dr.js";import{S as bt,M as jt}from"./Select-CJhf5z5x.js";import{T as St}from"./TopBar-CePtWKaI.js";import{G as wt}from"./GeofencAlert-BsCD30kn.js";import{V as Ct,F as kt,P as Dt,f as pe,S as Pt,I as Tt,M as It,T as Ft,O as At,a as Rt,b as Mt}from"./Vector-BEQdHjna.js";import{u as Lt}from"./esm-CZd2cZ0J.js";import"./index-BsWoDyI1.js";import"./roundedArrow-CWs3z0ry.js";import"./button-VZJ0bjwJ.js";import"./NotificationsNone-EewIcISf.js";const Et=["component","direction","spacing","divider","children","className","useFlexGap"],Nt=Ce(),_t=ke("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,r)=>r.root});function $t(t){return Fe({props:t,name:"MuiStack",defaultTheme:Nt})}function Ot(t,r){const l=g.Children.toArray(t).filter(Boolean);return l.reduce((s,x,i)=>(s.push(x),i<l.length-1&&s.push(g.cloneElement(r,{key:`separator-${i}`})),s),[])}const Vt=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],zt=({ownerState:t,theme:r})=>{let l=I({display:"flex",flexDirection:"column"},se({theme:r},W({values:t.direction,breakpoints:r.breakpoints.values}),s=>({flexDirection:s})));if(t.spacing){const s=De(r),x=Object.keys(r.breakpoints.values).reduce((p,h)=>((typeof t.spacing=="object"&&t.spacing[h]!=null||typeof t.direction=="object"&&t.direction[h]!=null)&&(p[h]=!0),p),{}),i=W({values:t.direction,base:x}),v=W({values:t.spacing,base:x});typeof i=="object"&&Object.keys(i).forEach((p,h,j)=>{if(!i[p]){const S=h>0?i[j[h-1]]:"column";i[p]=S}}),l=Pe(l,se({theme:r},v,(p,h)=>t.useFlexGap?{gap:ne(s,p)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Vt(h?i[h]:t.direction)}`]:ne(s,p)}}))}return l=Te(r.breakpoints,l),l};function Bt(t={}){const{createStyledComponent:r=_t,useThemeProps:l=$t,componentName:s="MuiStack"}=t,x=()=>G({root:["root"]},p=>Y(s,p),{}),i=r(zt);return g.forwardRef(function(p,h){const j=l(p),f=Ie(j),{component:S="div",direction:w="column",spacing:n=0,divider:c,children:a,className:k,useFlexGap:D=!1}=f,u=_(f,Et),o={direction:w,spacing:n,useFlexGap:D},m=x();return e.jsx(i,I({as:S,ownerState:o,ref:h,className:V(m.root,k)},u,{children:c?Ot(a,c):a}))})}const qt=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],Gt=["component","slots","slotProps"],Yt=["component"];function Ut(t,r){const{className:l,elementType:s,ownerState:x,externalForwardedProps:i,getSlotOwnerState:v,internalForwardedProps:d}=r,p=_(r,qt),{component:h,slots:j={[t]:void 0},slotProps:f={[t]:void 0}}=i,S=_(i,Gt),w=j[t]||s,n=at(f[t],x),c=lt(I({className:l},p,{externalForwardedProps:t==="root"?S:void 0,externalSlotProps:n})),{props:{component:a},internalRef:k}=c,D=_(c.props,Yt),u=Ae(k,n==null?void 0:n.ref,r.ref),o=v?v(D):{},m=I({},x,o),y=t==="root"?a||h:a,P=it(w,I({},t==="root"&&!h&&!j[t]&&d,t!=="root"&&!j[t]&&d,D,y&&{as:y},{ref:u}),m);return Object.keys(o).forEach(T=>{delete P[T]}),[w,P]}const Ht=st(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function Wt(t){return Y("MuiAvatar",t)}Z("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const Xt=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],Jt=rt(),Kt=t=>{const{classes:r,variant:l,colorDefault:s}=t;return G({root:["root",l,s&&"colorDefault"],img:["img"],fallback:["fallback"]},Wt,r)},Qt=$("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:l}=t;return[r.root,r[l.variant],l.colorDefault&&r.colorDefault]}})(({theme:t})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:I({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:I({backgroundColor:t.palette.grey[400]},t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})))}]})),Zt=$("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(t,r)=>r.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),er=$(Ht,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(t,r)=>r.fallback})({width:"75%",height:"75%"});function tr({crossOrigin:t,referrerPolicy:r,src:l,srcSet:s}){const[x,i]=g.useState(!1);return g.useEffect(()=>{if(!l&&!s)return;i(!1);let v=!0;const d=new Image;return d.onload=()=>{v&&i("loaded")},d.onerror=()=>{v&&i("error")},d.crossOrigin=t,d.referrerPolicy=r,d.src=l,s&&(d.srcset=s),()=>{v=!1}},[t,r,l,s]),x}const rr=g.forwardRef(function(r,l){const s=Jt({props:r,name:"MuiAvatar"}),{alt:x,children:i,className:v,component:d="div",slots:p={},slotProps:h={},imgProps:j,sizes:f,src:S,srcSet:w,variant:n="circular"}=s,c=_(s,Xt);let a=null;const k=tr(I({},j,{src:S,srcSet:w})),D=S||w,u=D&&k!=="error",o=I({},s,{colorDefault:!u,component:d,variant:n}),m=Kt(o),[y,P]=Ut("img",{className:m.img,elementType:Zt,externalForwardedProps:{slots:p,slotProps:{img:I({},j,h.img)}},additionalProps:{alt:x,src:S,srcSet:w,sizes:f},ownerState:o});return u?a=e.jsx(y,I({},P)):i||i===0?a=i:D&&x?a=x[0]:a=e.jsx(er,{ownerState:o,className:m.fallback}),e.jsx(Qt,I({as:d,ownerState:o,className:V(m.root,v),ref:l},c,{children:a}))}),or=rr,sr=Bt({createStyledComponent:$("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,r)=>r.root}),useThemeProps:t=>ee({props:t,name:"MuiStack"})}),nr=sr;function ar(t){return Y("MuiFormControlLabel",t)}const lr=Z("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),O=lr,ir=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],cr=t=>{const{classes:r,disabled:l,labelPlacement:s,error:x,required:i}=t,v={root:["root",l&&"disabled",`labelPlacement${he(s)}`,x&&"error",i&&"required"],label:["label",l&&"disabled"],asterisk:["asterisk",x&&"error"]};return G(v,ar,r)},dr=$("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:l}=t;return[{[`& .${O.label}`]:r.label},r.root,r[`labelPlacement${he(l.labelPlacement)}`]]}})(({theme:t,ownerState:r})=>I({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${O.disabled}`]:{cursor:"default"}},r.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},r.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},r.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${O.label}`]:{[`&.${O.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})),pr=$("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,r)=>r.asterisk})(({theme:t})=>({[`&.${O.error}`]:{color:(t.vars||t).palette.error.main}})),ur=g.forwardRef(function(r,l){var s,x;const i=ee({props:r,name:"MuiFormControlLabel"}),{className:v,componentsProps:d={},control:p,disabled:h,disableTypography:j,label:f,labelPlacement:S="end",required:w,slotProps:n={}}=i,c=_(i,ir),a=fe(),k=(s=h??p.props.disabled)!=null?s:a==null?void 0:a.disabled,D=w??p.props.required,u={disabled:k,required:D};["checked","name","onChange","value","inputRef"].forEach(R=>{typeof p.props[R]>"u"&&typeof i[R]<"u"&&(u[R]=i[R])});const o=me({props:i,muiFormControl:a,states:["error"]}),m=I({},i,{disabled:k,labelPlacement:S,required:D,error:o.error}),y=cr(m),P=(x=n.typography)!=null?x:d.typography;let T=f;return T!=null&&T.type!==L&&!j&&(T=e.jsx(L,I({component:"span"},P,{className:V(y.label,P==null?void 0:P.className),children:T}))),e.jsxs(dr,I({className:V(y.root,v),ownerState:m,ref:l},c,{children:[g.cloneElement(p,u),D?e.jsxs(nr,{display:"block",children:[T,e.jsxs(pr,{ownerState:m,"aria-hidden":!0,className:y.asterisk,children:["â€‰","*"]})]}):T]}))}),hr=ur;function gr(t){return Y("MuiFormGroup",t)}Z("MuiFormGroup",["root","row","error"]);const xr=["className","row"],fr=t=>{const{classes:r,row:l,error:s}=t;return G({root:["root",l&&"row",s&&"error"]},gr,r)},mr=$("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:l}=t;return[r.root,l.row&&r.row]}})(({ownerState:t})=>I({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),yr=g.forwardRef(function(r,l){const s=ee({props:r,name:"MuiFormGroup"}),{className:x,row:i=!1}=s,v=_(s,xr),d=fe(),p=me({props:s,muiFormControl:d,states:["error"]}),h=I({},s,{row:i,error:p.error}),j=fr(h);return e.jsx(mr,I({className:V(j.root,x),ownerState:h,ref:l},v))}),vr=yr,br=({imeiNo:t})=>{const{selectedVehicle:r,parameterData:l,ivnPid:s,locationData:x,vehicleList:i,onlineVehicle:v}=F(y=>y.liveMap),{ivnParameters:d,mode:p}=F(y=>y.dashboard),h=E(p),[j,f]=g.useState(),[S,w]=g.useState(!1),[n,c]=g.useState();g.useState({mainInputVoltage:0,ignition:0,speed:0});const[a,k]=g.useState("Not Available"),[D,u]=g.useState("Offline");g.useEffect(()=>{o()},[r]);const o=()=>{var y,P,T,R;if((x==null?void 0:x.length)>0){console.log("locationData",x);let C=x==null?void 0:x.find(A=>A.latestDocument.imei===r.imei);C?(f((y=C==null?void 0:C.latestDocument)==null?void 0:y.speed),w((P=C==null?void 0:C.latestDocument)==null?void 0:P.ignition),c((T=C==null?void 0:C.latestDocument)==null?void 0:T.mainInputVoltage),k((R=C==null?void 0:C.latestDocument)==null?void 0:R.venderId)):(f(0),w(0),c(0),k("Not Available"))}else f(0),w(0),c(0),k("Not Available")};g.useEffect(()=>{Object.keys(r).length>0&&m()},[r]);const m=()=>{if(Object.keys(r).length>0)if(v&&v.length>0){const y=v.some(P=>parseInt(P)===parseInt(r==null?void 0:r.imei));u(y?"Online":"Offline")}else u("Offline");else u("Offline")};return e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{mx:"10px",pt:"10px",color:h.grey[400]},children:e.jsx("b",{children:r==null?void 0:r.reg_id})}),e.jsx(b,{sx:{backgroundColor:h.grey[200],height:"12vh",borderRadius:"8px",p:"5px"},children:e.jsx(b,{sx:{},children:e.jsx(B,{container:!0,spacing:3,mt:"2.5px",children:e.jsx(B,{item:!0,xs:12,children:e.jsx(B,{container:!0,justifyContent:"space-around",spacing:3,children:[{label:"VenderId",value:a},{label:"Speed",value:j,unit:"km/h"},{label:"Main Input Voltage",value:parseFloat(n).toFixed(2),unit:"voltage"},{label:"Current Status",value:D}].map((y,P)=>e.jsx(B,{item:!0,children:e.jsxs(tt,{sx:{height:70,width:250,backgroundColor:h.grey[100],color:h.grey[400],display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px"},children:[e.jsxs(b,{children:[e.jsx(L,{variant:"h6",sx:{fontSize:"12px"},children:y.label}),e.jsxs(L,{variant:"h6",sx:{fontSize:"18px",fontWeight:"bold"},children:[y.value," ",y==null?void 0:y.unit]})]}),e.jsx(or,{src:Ue,sx:{width:20,height:20}})]})},P))})})})})})]})},K=({title:t,selectedTripData:r})=>{const{mode:l,loading:s}=F(h=>h.dashboard),{selectedVehicle:x}=F(h=>h.liveMap),[i,v]=g.useState([]);g.useEffect(()=>{let h=r.map(f=>{let S={...f};return S.ignition=S.ignition?1:0,S});const j=p(h);v(j)},[r]);const d=E(l),p=h=>{let j=null;return h.forEach(f=>{const S=new Date(f.createdAt);j&&j.toDateString()===S.toDateString()?(f.date=N(f.createdAt).format("HH:mm:ss"),f.ignition=f.ignition?1:0):(f.date=N(f.createdAt).format("DD-MM-YYYY"),f.ignition=f.ignition?1:0),j=S}),h};return e.jsx(b,{sx:{ml:"2rem",border:d.grey[300],fontSize:"13px",height:"24vh",color:d.grey[400],backgroundColor:d.grey[100],borderRadius:"5px"},children:i&&i.length>0?e.jsx(He,{children:e.jsxs(We,{data:i,margin:{top:15,right:10,left:-25,bottom:0},children:[e.jsx(Xe,{dataKey:"date",stroke:d.grey[400]}),e.jsx(Je,{stroke:d.grey[400]}),e.jsx(Ke,{type:"monotone",dataKey:t,dot:!1,stroke:"#EF5B05",strokeWidth:2}),e.jsx(Qe,{layout:"horizontal",verticalAlign:"top",align:"center"}),e.jsx(Ze,{})]})}):e.jsx(ct,{style:{background:d.grey[100],width:"400px",height:"100px",margin:"auto",marginTop:"10px"},children:Object.keys(x).length===0?e.jsx(L,{textAlign:"center",align:"center",mt:"20px",color:d.grey[600],children:"Please Select a Vehicle"}):s?e.jsx(te,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(L,{textAlign:"center",color:d.grey[600],children:"Sorry! No Trips Available"})})})},jr=({vehicleData:t})=>{const r=["Engine RPM","Engine coolant temperature","Battery Potential"],l=z(),{selectedVehicle:s,loading:x}=F(a=>a.liveMap),{startDate:i,endDate:v,mode:d}=F(a=>a.dashboard),[p,h]=g.useState(""),j=E(d),f=g.useRef(null),S=g.useRef(0),w=t.length>0&&t.filter(a=>a.label.toLowerCase().includes(p.toLowerCase())),n=a=>{h(a.target.value)},c=async a=>{var o;f.current&&(S.current=f.current.scrollTop),l(Me({imei:a.value,reg_id:a.label})),a.value,de().subtract(5,"day"),de();let k=a.label;const D=await l(Le({registration_id:k}));let u=[];if(D&&D.payload.length>0&&((o=D.payload)==null||o.map(m=>{m.ivn_parameter.length>0&&u.push(m.ivn_parameter[0])})),u.length>0){let m=u.filter(y=>r.includes(y.pid_description));l(ae(m))}else l(ae([]));setTimeout(()=>{f.current&&(f.current.scrollTop=S.current)},0)};return g.useEffect(()=>{f.current&&(f.current.scrollTop=S.current)},[x,w,s]),e.jsx(e.Fragment,{children:x?e.jsx("div",{children:e.jsx(b,{sx:{display:"flex",justifyContent:"center",height:"88vh",alignItems:"center"},children:e.jsx(te,{})})}):e.jsxs("div",{ref:f,style:{overflowY:"auto",height:"90vh"},children:[e.jsx(b,{sx:{align:"center",my:"15px",ml:"20px"},children:e.jsxs(ye,{sx:{width:"90%",backgroundColor:"white",borderRadius:"5px"},variant:"outlined",children:[e.jsx(ve,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px"},children:"Search"}),e.jsx(dt,{onChange:a=>n(a),inputProps:{style:{padding:7}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(pt,{position:"end",children:e.jsx(nt,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(et,{})})}),label:"Search"})]})}),e.jsx(b,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsxs(q,{variant:"outlined",sx:{width:"90%",color:j.grey[400],"&:hover":{color:"#DAE0EE"}},children:["Total Vehicle: ",w.length]})}),w.length>0&&w.map((a,k)=>e.jsx(b,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(q,{variant:"outlined",onClick:()=>c(a),sx:{width:"90%",bgcolor:a.label===s.reg_id?Re.bgColor:"undefined",color:a.label===s.reg_id?"#DAE0EE":j.grey[400]},children:a.label})},k))]})})};var re={},Sr=ge;Object.defineProperty(re,"__esModule",{value:!0});var je=re.default=void 0,wr=Sr(be()),ue=e;je=re.default=(0,wr.default)([(0,ue.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7M7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9"},"0"),(0,ue.jsx)("circle",{cx:"12",cy:"9",r:"2.5"},"1")],"LocationOnOutlined");var oe={},Cr=ge;Object.defineProperty(oe,"__esModule",{value:!0});var Se=oe.default=void 0,kr=Cr(be()),Dr=e;Se=oe.default=(0,kr.default)((0,Dr.jsx)("path",{d:"m22 12-4-4v3H3v2h15v3z"}),"TrendingFlat");function Pr(){const{allTripList:t,loading:r,mode:l,activeIndex:s,selectedDate:x,selectedTripData:i}=F(o=>o.dashboard),{selectedVehicle:v}=F(o=>o.liveMap),[d,p]=g.useState([]),[h,j]=g.useState("0"),[f,S]=g.useState(0);let w=z();const n=Ee(),c=E(l);g.useEffect(()=>{const o=a(t);p(o),o.length>0&&Q(o[0])},[t]);const a=o=>{const m=new Set,y=[];return o.forEach(P=>{const T=N(P.startTime).format("YYYY-MM-DD");m.has(T)||(m.add(T),y.push(T))}),y},k=(o,m)=>{w(xe(m)),console.log("item, i",o,m),w(Ne(o.data));let y=_e(o==null?void 0:o.data);S(y);let P=$e(new Date(o==null?void 0:o.startTime).toISOString(),new Date(o==null?void 0:o.endTime).toISOString());j(P)},D=o=>{console.log("activeIndex",s),console.log("i",o),s!==null?o===s?n("/trip-monitor"):M.error("Trip not selected"):M.error("Please select the trip")},u=t.filter(o=>N(o.startTime).format("YYYY-MM-DD")===x);return e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{width:"95%",display:"flex",overflow:"auto",mx:"10px",mt:2},children:u&&u.length>0?e.jsx(xt,{sx:{maxHeight:250,height:250,width:"98%",ml:"10px",mt:"10px",borderRadius:"5px",border:"1px solid #dbdad5"},children:e.jsx(ft,{stickyHeader:!0,"aria-label":"sticky table",children:e.jsx(mt,{children:u.map((o,m)=>{var y,P,T,R;return e.jsxs(yt,{sx:{backgroundColor:s===m?"#DAE0EE":c.grey[100]},children:[e.jsxs(J,{align:"left",style:{fontSize:"12px",padding:10,color:s===m?"black":c.grey[400],cursor:"pointer"},onClick:()=>{k(o,m)},children:[m+1,"."," ",`${(P=(y=o==null?void 0:o.startLocation)==null?void 0:y.address)==null?void 0:P.display_name}`," ",e.jsx(b,{component:"span",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",verticalAlign:"middle"},children:e.jsx(Se,{})}),`${(R=(T=o==null?void 0:o.endLocation)==null?void 0:T.address)==null?void 0:R.display_name}`]}),e.jsxs(J,{align:"right",style:{fontSize:"12px",padding:10,color:s===m?"black":c.grey[400]},children:[o!=null&&o.startTime?N(new Date(o.startTime).toISOString()).format("LT"):""," ","to"," ",o!=null&&o.endTime?N(new Date(o.endTime).toISOString()).format("LT"):"----"]}),e.jsx(J,{align:"right",style:{fontSize:"12px",padding:10,color:s===m?"black":c.grey[400]},children:e.jsx("span",{title:"Navigate to map",style:{cursor:"pointer"},onClick:()=>{D(m)},children:e.jsx(je,{})})})]},m)})})})}):e.jsx(b,{sx:{height:210,display:"flex",justifyContent:"center",alignItems:"center",color:c.grey[400],margin:"auto"},children:e.jsx(vt,{style:{background:c.grey[100],width:"400px",height:"100px"},children:Object.keys(v).length===0?e.jsx(L,{textAlign:"center",align:"center",mt:"20px",color:c.grey[600],children:"Please Select a Vehicle"}):r?e.jsx(te,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(L,{textAlign:"center",color:c.grey[600],children:"Sorry! No Trips Available"})})})}),i.length>0&&e.jsx(b,{sx:{my:"0px"},children:e.jsxs(b,{sx:{display:"flex",mx:"5px",mt:"10px"},children:[e.jsxs(b,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Braking"}),e.jsx("div",{children:"0"})]}),e.jsxs(b,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Acceleration"}),e.jsx("div",{children:"0"})]}),e.jsxs(b,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Running Hrs"}),e.jsx("div",{children:h})]}),e.jsxs(b,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Distance"}),e.jsxs("div",{children:[parseFloat(parseFloat(f).toFixed(2))," km"]})]})]})})]})}function Tr(){const{allTripList:t,activeIndex:r,selectedDate:l,loading:s,mode:x,trip_payload:i,page:v}=F(c=>c.dashboard),d=z(),p=E(x),[h,j]=g.useState([]);g.useEffect(()=>{const c=f(t);j(c),c.length>0&&d(Q(c[0]))},[t,d]);const f=c=>{const a=new Set,k=[];return c.forEach(D=>{const u=N(D.startTime).format("YYYY-MM-DD");a.has(u)||(a.add(u),k.push(u))}),k},S=c=>{d(Q(c.target.value)),d(xe(null))},w=async()=>{const c={...i,page:v+1};try{(await d(le(c))).error?M.error("No Trip! within selected date"):d(ie(v+1))}catch{M.error("No Trip! within selected date")}},n=()=>{if(v<=1)return;const c={...i,page:v-1};d(ie(v-1)),d(le(c))};return e.jsx(b,{sx:{width:"50%",mx:"10px"},children:e.jsxs(ye,{fullWidth:!0,sx:{height:"10px","& .MuiInputBase-root":{height:"38px",backgroundColor:p.grey[500],color:p.grey[400]},"& .MuiInputLabel-root":{lineHeight:"15px",color:p.grey[400]}},children:[e.jsx(ve,{id:"select-date-label",children:"Trip's Date"}),e.jsxs(bt,{labelId:"select-date-label",value:l,label:"Select Date",onChange:S,sx:{height:"40px",fontSize:"14px",padding:"0 12px",backgroundColor:p.grey[500],color:p.grey[400],"& .MuiSelect-icon":{color:p.grey[400]}},children:[h.map((c,a)=>e.jsx(jt,{value:c,sx:{backgroundColor:p.grey[500],color:p.grey[400],"&:hover":{backgroundColor:p.grey[600],color:p.grey[300]},"&.Mui-selected":{backgroundColor:p.grey[600],color:p.grey[300],"&:hover":{backgroundColor:p.grey[600]}}},children:c},a)),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(q,{disabled:v<=1,onClick:n,children:e.jsx(ut,{})}),e.jsx(q,{disabled:!(i!=null&&i.imei),onClick:w,children:e.jsx(ht,{})})]})]})]})})}const Ir=()=>{const{mode:t}=F(l=>l.dashboard),r=E(t);return e.jsxs(b,{children:[e.jsxs(b,{sx:{display:"flex",ml:"5px",justifyContent:"center"},children:[e.jsx(b,{sx:{m:"5px",fontSize:"20px",width:"20%",color:r.grey[400]},children:e.jsx("b",{children:"Trip History"})}),e.jsx(Tr,{}),e.jsx(b,{children:e.jsx(gt,{})})]}),e.jsx(b,{sx:{my:"5px"},children:e.jsx(Pr,{})})]})},Fr=()=>{const t=z(),{center:r,selectedParameterList:l,selectedVehicle:s,vehicleList:x,tractorIcon:i,icons:v,locationData:d,ivnPid:p,placesData:h}=F(C=>C.liveMap),{mode:j}=F(C=>C.dashboard),{isLoaded:f,loadError:S}=Lt({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"}),[w,n]=g.useState(null),[c,a]=g.useState(!0),[k,D]=g.useState(5),[u,o]=g.useState(),m=E(j),y=g.useRef(null),P=g.useRef(new Ct),T=()=>new It({target:y.current,layers:[new Ft({source:new At,attributions:""}),new Rt({source:P.current})],view:new Mt({center:pe([78,21]),zoom:k}),controls:[]});g.useEffect(()=>{f&&n(window.google.maps)},[f]),g.useEffect(()=>{if(c)o(d);else{let C=d==null?void 0:d.filter(A=>(A==null?void 0:A._id)===(s==null?void 0:s.imei));o(C)}},[d,s,c]),g.useEffect(()=>{if(y.current&&w){const C=T();return y.current=C,()=>{C&&C.setTarget(null)}}},[w]),g.useEffect(()=>{y.current&&u&&u.length>0&&(P.current.clear(),u.forEach(C=>{const{lat:A,lng:U}=C.latestDocument,H=new kt({geometry:new Dt(pe([U,A]))});H.setStyle(new Pt({image:new Tt({src:"http://maps.google.com/mapfiles/ms/icons/red-dot.png",scale:1})})),P.current.addFeature(H)}))},[u]);const R=()=>{if(!c)t(ce({lat:21,lng:78})),D(4),a(A=>!A);else{const C=d.find(A=>A.latestDocument.imei===s.imei);if(C){const{lat:A,lng:U}=C.latestDocument;t(ce({lat:A,lng:U})),D(12),a(we=>!we)}else M.error("Data is not available for selected vehicle")}};return S?"Error loading maps":f?w?e.jsxs("div",{children:[e.jsxs(b,{sx:{ml:"10px",fontSize:"20px",display:"flex",justifyContent:"space-between",color:m.grey[400]},children:[e.jsx("b",{children:"Live Map"}),e.jsx(vr,{sx:{marginLeft:0,paddingTop:0,color:m.grey[400]},children:e.jsx(hr,{control:e.jsx(ot,{checked:c,onChange:R}),label:c?"Group":"Individual"})})]}),e.jsx("div",{ref:y,style:{height:"41.5vh",width:"99%",marginTop:"0px",marginLeft:"10px"}})]}):"No map":"Loading maps"},oo=()=>{const{w_customer_id:t}=F(n=>n.auth),{mode:r,selectedTripData:l}=F(n=>n.dashboard),[s,x]=g.useState(()=>{const n=sessionStorage.getItem("imeiNo");return n?JSON.parse(n):[]}),i=z(),v=E(r),[d,p]=g.useState([]),[h,j]=g.useState(!1),[f,S]=g.useState(!1);g.useEffect(()=>{w()},[]),g.useEffect(()=>{sessionStorage.setItem("imeiNo",JSON.stringify(s))},[s]),g.useEffect(()=>{X.on("geofenceAlert",n=>{(n==null?void 0:n.imei)!==null&&s.find(k=>parseInt(k)===(n==null?void 0:n.imei))&&(console.log("geofence"),M.error(`Type: ${n==null?void 0:n.type} ${n==null?void 0:n.msg} ${n==null?void 0:n.imei}`,{id:"geofence",autoClose:5e3}))}),X.on("speedAlert",n=>{(n==null?void 0:n.imei)!==null&&s.find(k=>parseInt(k)===(n==null?void 0:n.imei))&&M.error(`${n==null?void 0:n.msg} ${n==null?void 0:n.imei}`,{id:"speed",autoClose:5e3})})},[X]);const w=async()=>{try{let n=[],c=[];const a=await i(Oe({w_customer_id:t}));if(console.log("data",a),Array.isArray(a.payload)){a.payload.forEach(u=>{var o,m;Array.isArray(u.imei)&&u.imei.length>0?(n.push({id:u.id,label:u.registration_id,value:(o=u==null?void 0:u.imei[0])==null?void 0:o.mac_id,vehilce_type:u==null?void 0:u.segment}),c.push((m=u.imei[0])==null?void 0:m.mac_id),u.registration_id):(console.error("IMEI data not found for item:",u),M.error(`IMEI Number not found for the vehicle: ${u==null?void 0:u.registration_id}`))}),x(c);const k="one",D=c;c.length>0&&(i(Ve({type:k,imei:D})),i(ze(D))),p(n),i(Be(n)),i(qe({w_customer_id:t})),i(Ge({}))}else console.error("Unexpected data format:",a),M.error("Unexpected data format:")}catch(n){console.error("Error fetching vehicle data:",n),M.error(`Error fetching vehicle data: ${n}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(Ye,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(St,{title:"Dashboard",showVehicles:h,setShowVehicles:j,setShowNotification:S,showNotification:f}),e.jsxs("div",{style:{height:"92vh",backgroundColor:v.grey[100],padding:"10px"},children:[h&&e.jsx(b,{sx:{position:"fixed",width:"250px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:v.grey[100],overflowY:"auto",scrollBehavior:"smooth",scrollbarWidth:"thin"},children:e.jsx(jr,{vehicleData:d})}),f&&e.jsx(b,{sx:{position:"fixed",width:"300px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:v.grey[100]},children:e.jsx(wt,{})}),e.jsx(b,{sx:{height:"21%"},children:e.jsx(br,{imeiNo:s})}),e.jsxs(b,{sx:{display:"flex",height:"50%"},children:[e.jsx(b,{sx:{width:"50%",border:"1px solid #E8E8E8",padding:"2px",borderRadius:"5px"},children:e.jsx(Ir,{})}),e.jsx(b,{sx:{width:"50%"},children:e.jsx(Fr,{})})]}),e.jsxs(b,{sx:{display:"flex",height:"30%",mt:"5px",pt:"10px"},children:[e.jsx(b,{style:{width:"33%"},children:e.jsx(K,{title:"speed",selectedTripData:l})}),e.jsx(b,{style:{width:"33%"},children:e.jsx(K,{title:"mainInputVoltage",selectedTripData:l})}),e.jsx(b,{style:{width:"33%"},children:e.jsx(K,{title:"ignition",selectedTripData:l})})]})]})]})]})};export{oo as default};
