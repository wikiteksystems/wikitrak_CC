import{i as k,j as t,a as L,u as te,t as w,T as V,a9 as Ce,aa as $e,P as Y,r as l,v as Ie,ab as ce,l as Re,_ as Z,m as Le,a1 as ke}from"./index-BUGQRcLH.js";import{L as Pe}from"./LightModeOutlined-BQz76xco.js";import{L as Ee}from"./LiveMapTopBar-CaMJ-_pU.js";import{V as Oe}from"./VehicleMenu-DBcYt6sJ.js";import{u as ze,G as He,M as pe,I as Ae}from"./esm-uiUPgVex.js";import Fe from"./Loader-Bm74yPWf.js";import{r as P}from"./createSvgIcon-DCBbxJSk.js";import{B as h,C as ue}from"./CircularProgress-BxozFURZ.js";import{s as ee}from"./Socket-0N_gnJcr.js";import{m as he,f as We}from"./4W-CSnZ3_ps.js";import{t as qe}from"./ol-6TvppJQB.js";import{P as Ne}from"./Parameters-DNZN2KM7.js";import{t as Ge}from"./Search-CungJLJi.js";import"./proj-XQwXs9DQ.js";import"./jcb-aCHXMCXy.js";import"./index-DrM0VX2z.js";import"./index-BpiCMaNo.js";import"./IconButton-gYY4leoZ.js";import"./OutlinedInput-CdJ2FxGP.js";import"./index-CI24IKTI.js";import"./Card-9WrPfXMb.js";import"./Paper-CG34LR64.js";import"./CardContent-BDaFLAso.js";var oe={},Te=k;Object.defineProperty(oe,"__esModule",{value:!0});var de=oe.default=void 0,Be=Te(P()),Ue=t;de=oe.default=(0,Be.default)((0,Ue.jsx)("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4"}),"Restaurant");var se={},Je=k;Object.defineProperty(se,"__esModule",{value:!0});var fe=se.default=void 0,Ke=Je(P()),Xe=t;fe=se.default=(0,Ke.default)((0,Xe.jsx)("path",{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3m12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4"}),"Hotel");var ae={},Qe=k;Object.defineProperty(ae,"__esModule",{value:!0});var xe=ae.default=void 0,Ye=Qe(P()),Ze=t;xe=ae.default=(0,Ye.default)((0,Ze.jsx)("path",{d:"m19.77 7.23.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77M12 10H6V5h6zm6 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalGasStation");var re={},et=k;Object.defineProperty(re,"__esModule",{value:!0});var ve=re.default=void 0,tt=et(P()),ot=t;ve=re.default=(0,tt.default)((0,ot.jsx)("path",{d:"M16.22 12c.68 0 1.22-.54 1.22-1.22 0-.67-.54-1.22-1.22-1.22S15 10.11 15 10.78c0 .68.55 1.22 1.22 1.22m-9.66-1.22c0 .67.54 1.22 1.22 1.22S9 11.46 9 10.78c0-.67-.54-1.22-1.22-1.22s-1.22.55-1.22 1.22M7.61 4 6.28 8h11.43l-1.33-4zm8.67-1s.54.01.92.54c.02.02.03.04.05.07.07.11.14.24.19.4.22.65 1.56 4.68 1.56 4.68v6.5c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81V14H7v1.19c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81v-6.5S6.34 4.67 6.55 4c.05-.16.12-.28.19-.4.03-.02.04-.04.06-.06.38-.53.92-.54.92-.54zM4 17.01h16V19h-7v3h-2v-3H4z"}),"CarRepair");var le={},st=k;Object.defineProperty(le,"__esModule",{value:!0});var ge=le.default=void 0,at=st(P()),rt=t;ge=le.default=(0,at.default)((0,rt.jsx)("path",{d:"M21 5h-2.64l1.14-3.14L17.15 1l-1.46 4H3v2l2 6-2 6v2h18v-2l-2-6 2-6zm-3.9 8.63L18.89 19H5.11l1.79-5.37.21-.63-.21-.63L5.11 7h13.78l-1.79 5.37-.21.63zM13 9h-2v3H8v2h3v3h2v-3h3v-2h-3z"}),"LocalPharmacyOutlined");var ne={},lt=k;Object.defineProperty(ne,"__esModule",{value:!0});var me=ne.default=void 0,nt=lt(P()),it=t;me=ne.default=(0,nt.default)((0,it.jsx)("path",{d:"M8 9v1.5h2.25V15h1.5v-4.5H14V9zM6 9H3c-.55 0-1 .45-1 1v5h1.5v-1.5h2V15H7v-5c0-.55-.45-1-1-1m-.5 3h-2v-1.5h2zM21 9h-4.5c-.55 0-1 .45-1 1v5H17v-4.5h1V14h1.5v-3.51h1V15H22v-5c0-.55-.45-1-1-1"}),"AtmOutlined");const ct=({setPlace:p,place:o})=>{const{center:$}=L(x=>x.liveMap),f=te(),r=async x=>{o===x?(f(Ce([])),p("")):(p(x),f($e({center:$,clickedPlace:x})))};return t.jsxs(h,{sx:{position:"absolute",top:"1vh",left:"20%",display:"flex",justifyContent:"center"},children:[t.jsx(h,{sx:{bgcolor:o==="restaurants"?w.bgColor:"white",color:o==="restaurants"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{r("restaurants")},children:t.jsxs(V,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(de,{style:{height:"17px",position:"relative",top:"1px"}}),"Restaurants"]})}),t.jsx(h,{sx:{bgcolor:o==="hotels"?w.bgColor:"white",color:o==="hotels"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{r("hotels")},children:t.jsxs(V,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(fe,{style:{height:"17px",position:"relative",top:"1px"}}),"Hotels"]})}),t.jsx(h,{sx:{bgcolor:o==="hospitals"?w.bgColor:"white",color:o==="hospitals"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{r("hospitals")},children:t.jsxs(V,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ge,{style:{height:"17px",position:"relative",top:"1px"}}),"Hospitals"]})}),t.jsx(h,{sx:{bgcolor:o==="atm"?w.bgColor:"white",color:o==="atm"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{r("atm")},children:t.jsxs(V,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(me,{style:{height:"17px",position:"relative",top:"1px"}}),"ATMs"]})}),t.jsx(h,{sx:{bgcolor:o==="car_repair"?w.bgColor:"white",color:o==="car_repair"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{r("car_repair")},children:t.jsxs(V,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ve,{style:{height:"17px",position:"relative",top:"1px"}}),"Service center"]})}),t.jsx(h,{sx:{bgcolor:o==="gasstation"?w.bgColor:"white",color:o==="gasstation"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{r("gasstation")},children:t.jsxs(V,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(xe,{style:{height:"17px",position:"relative",top:"1px"}}),"Gas Stations"]})})]})},pt=ct;function ut({activeParams:p}){return t.jsx(h,{sx:{bgcolor:w.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:p&&p[0].params.length>0?t.jsxs(t.Fragment,{children:[p[0].params.length>0&&t.jsxs(Y,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",p[0].reg_id]}),p.length>0&&p[0].params.map((o,$)=>{o.label==="maininputvoltage"&&console.log("item.label",o.label,o);const f=p[0].params.find(E=>E.label==="ignition"),r=f&&(f.value===!0||f.value===1)?o.value:0,x=o.label==="mainInputVoltage"||o.label==="maininputvoltage";return t.jsx(Y,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:o.label==="speed"?`${o.label} : ${r} km/h`:x&&o.value!==void 0?`${o.label} : ${o.value} voltage`:o.label==="ignition"?`${o.label} : ${o.value===!0||(o==null?void 0:o.value)===1?"On":"Off"}`:`${o.label} : ${o.value!==void 0?o.value:""}`},$)})]}):t.jsx(t.Fragment,{children:t.jsx(Y,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})})}const ht="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function dt({showCard:p,loadingVehicle:o}){const{center:$,selectedParameterList:f,selectedVehicle:r,vehicleList:x,icons:E,locationData:u,placesData:O,imeiNumbers:q,onlineVehicle:M,loading:J,services_loading:z}=L(e=>e.liveMap),{mode:K,styles:H,vehicles_details:m}=L(e=>e.dashboard),[N,X]=l.useState(null),[A,F]=l.useState(""),[_,G]=l.useState([]),[Q,i]=l.useState([]),[c,v]=l.useState(),[j,I]=l.useState(),[n,g]=l.useState(null),[S,W]=l.useState(""),b=te(),{isLoaded:y,loadError:je}=ze({googleMapsApiKey:`${ht}`,loadingElement:t.jsx(Fe,{})});l.useEffect(()=>{y&&X(window.google.maps)},[y]),l.useEffect(()=>{if(console.log("locationData",u),Object.keys(r).length>0){console.log("selectedVehicle",r==null?void 0:r.imei);const e=u==null?void 0:u.filter(s=>{var a;return((a=s==null?void 0:s.latestDocument)==null?void 0:a.imei)==(r==null?void 0:r.imei)});console.log("filteredVehicle",e),v(e)}else v(u)},[u,r]),l.useEffect(()=>{I(f)},[f]),l.useEffect(()=>(ee.on("locationinfo",e=>{if(console.log("locationinfo",e),c==null||c.map(s=>{if(s.latestDocument.imei===e.imei){const a={lat:s.latestDocument.lat,lng:s.latestDocument.lng},d=500,D=60,R=d/(1e3/D),T=(e.lat-a.lat)/R,B=(e.lng-a.lng)/R;let C=0;const U=setInterval(()=>{const we=a.lat+T*C,Ve=a.lng+B*C,Me={...s,latestDocument:{...s.latestDocument,lat:we,lng:Ve}};C++,C>=R&&clearInterval(U),v(De=>De.map(ie=>ie.latestDocument.imei===e.imei?Me:ie))},1e3/D)}return s}),String(e==null?void 0:e.imei)===String(j[0].imei)){const s=j[0].params.map(a=>{let d=a.label;return{...a,value:e[d]}});I([{...j[0],params:s}])}}),()=>{ee.off("locationinfo")}),[ee,c,j]),l.useEffect(()=>{b(Ie({}))},[r]),l.useEffect(()=>{if((u==null?void 0:u.length)>0&&M.length>0){const e=[],s=[];u==null||u.forEach(a=>{M.some(D=>String(D)===String(a._id))?e.push(a):s.push(a)}),G(e),i(s)}else G([]),i([])},[u,M]),l.useEffect(()=>{console.log("onVehicles",_),console.log("offVehicles",Q)},[_]);const be=(e,s)=>{s&&W(s.latestDocument.imei),g(n===e?null:e)},ye=e=>{if(console.log("reg id ",e),e){const s=x.filter(a=>{var d;return a.imei&&((d=a.imei[0])==null?void 0:d.mac_id)===e});return s&&s.length>0?s[0].registration_id:"IMEI doesn't exist."}else return"IMEI doesn't exist."},_e=e=>{const s=m&&(m==null?void 0:m.length)>0&&m.find(a=>(a==null?void 0:a.value)===e&&(a==null?void 0:a.vehilce_type));return s?s.vehilce_type:null};if(je)return"Error loading maps";if(!y)return"Loading maps";if(!N)return null;const Se={height:p?"87vh":"95vh",width:"100%",transition:"transform 0.5s ease-in-out"};return t.jsxs(t.Fragment,{children:[p&&t.jsx(ut,{activeParams:j}),t.jsxs(He,{mapContainerStyle:Se,zoom:Object.keys(r).length>0?15:5.8,center:$,options:{styles:K?H:""},children:[Object.keys(r).length>0&&t.jsx(pt,{setPlace:F,place:A}),z||o?t.jsx(h,{sx:{position:"absolute",top:"50%",left:"50%"},children:t.jsx(ue,{})}):O&&O.length>0&&O.map((e,s)=>{var a,d;return t.jsx(pe,{position:{lat:parseFloat((a=e==null?void 0:e.location)==null?void 0:a.lat),lng:parseFloat((d=e==null?void 0:e.location)==null?void 0:d.lng)},animation:window.google.maps.Animation.DROP,icon:{path:E[`${A}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},s)}),J||o?t.jsx(h,{sx:{position:"absolute",top:"50%",left:"50%"},children:t.jsx(ue,{})}):c&&c.length>0&&c.map((e,s)=>{var d,D,R,T,B,C;const a=_e(e.latestDocument.imei);return t.jsx(pe,{position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},animation:window.google.maps.Animation.DROP,icon:{url:(()=>{switch(a){case"2W":return he;case"3W":return qe;case"4W":return We;default:return he}})(),fillColor:Object.keys(r).length>0&&r.imei===e.latestDocument.imei?"green":w.bgColor,fillOpacity:2,strokeWeight:1,scale:2,rotation:(d=e==null?void 0:e.latestDocument)==null?void 0:d.heading,size:new window.google.maps.Size(55,55),scaledSize:new window.google.maps.Size(55,55)},onClick:()=>{var U;return be((U=e==null?void 0:e.latestDocument)==null?void 0:U._id,e)},children:n===((D=e==null?void 0:e.latestDocument)==null?void 0:D._id)&&t.jsx(Ae,{position:{lat:parseFloat((R=e==null?void 0:e.latestDocument)==null?void 0:R.lat),lng:parseFloat((T=e==null?void 0:e.latestDocument)==null?void 0:T.lng)},onCloseClick:()=>g(null),options:{maxWidth:"100%"},visible:n===e.id,children:t.jsxs(t.Fragment,{children:[t.jsxs(V,{children:["Vehicle No:"," ",ye((B=e==null?void 0:e.latestDocument)==null?void 0:B.imei)]}),t.jsxs(V,{children:["IMEI No: ",(C=e==null?void 0:e.latestDocument)==null?void 0:C.imei]})]})},e.id)},s)})]})]})}function zt(){const{locationData:p,selectedVehicle:o,selectedParameterList:$}=L(i=>i.liveMap),{mode:f}=L(i=>i.dashboard),r=Ge(f),[x,E]=l.useState([]),{w_customer_id:u}=L(i=>i.auth),[O,q]=l.useState(),[M,J]=l.useState(!1),[z,K]=l.useState(!1),[H,m]=l.useState([]),[N,X]=l.useState(!0),[A,F]=l.useState(!1);let _=te();l.useEffect(()=>{G()},[]),l.useEffect(()=>{m([]),_(ce([{reg_id:"",imei:"",params:[]}]))},[o]);const G=async()=>{try{F(!0);let i=[],c=[];const v=await _(Re({w_customer_id:u}));if(Array.isArray(v.payload)){v.payload.forEach(n=>{var g,S,W;Array.isArray(n.imei)&&n.imei.length>0&&((g=n.imei[0])!=null&&g.mac_id)?(i.push({id:n.id,label:n.registration_id,value:(S=n.imei[0])==null?void 0:S.mac_id,vehilce_type:n==null?void 0:n.segment}),c.push((W=n.imei[0])==null?void 0:W.mac_id)):(console.error("IMEI data not found for item:",n),Z.error(`IMEI Number not found for the vehicle: ${n==null?void 0:n.registration_id}`))});const j="one",I=c;c.length>0&&_(Le({type:j,imei:I})),E(i),_(ke(i)),F(!1)}else F(!1),console.error("Unexpected data format:",v),Z.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),Z.error(`Error fetching vehicle data: ${i}`)}},Q=async i=>{const{label:c,imei:v,id:j,reg_id:I,checked:n}=i;q(b=>b.map(y=>y.id===j?{...y,checked:!n}:y));let g=[...H],S=[...H];if(!n)p.forEach(b=>{b.latestDocument.imei===v&&(g.push({label:c,value:b.latestDocument[c==="maininputvoltage"?"mainInputVoltage":c]}),S=g,m(g))});else{let b=H.filter(y=>y.label!==c);S=b,m(b)}console.log("tempParamList",S),_(ce([{reg_id:I,imei:v,params:S}]))};return t.jsxs("div",{className:"app",children:[t.jsx(Pe,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(Ee,{title:"Live Map",setShowVehicles:J,showVehicles:M,showParameters:z,setShowParameters:K,setShowCard:X,showCard:N}),t.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(h,{style:{width:M||z?"80%":"100%"},children:t.jsx(dt,{showCard:N,loadingVehicle:A})}),M&&t.jsx(h,{style:{width:"20%",backgroundColor:r.grey[100]},children:t.jsx(Oe,{vehicleData:x,title:"Live Map",setParameterData:q,loadingVehicle:A})}),z&&t.jsx(h,{style:{width:"20%",backgroundColor:r.grey[100]},children:t.jsx(Ne,{parametersData:O,setParameterData:q,handleParameterChange:Q})})]})]})]})}export{zt as default};
