import{a as C,r as t,u as Y,j as r,P as _,_ as x,t as a,T as q,b as z,Q as S,R as G,aV as k}from"./index-BgRXM3Uy.js";import{d as H,R as J,t as K}from"./RegionSelector-DuXLCr-8.js";import{B as d,C as U}from"./CircularProgress-BPVOJfOq.js";import{F as X,I as Z,O as ee,a as re}from"./OutlinedInput-RJPhpm2n.js";import{I as oe}from"./IconButton-CpWk3Goa.js";const ie=({vehicleData:h,title:b,setParameterData:R,loadingVehicle:T})=>{const{selectedVehicle:i,locationData:s,loading:u}=C(e=>e.liveMap),{mode:L}=C(e=>e.dashboard),l=K(L),[V,I]=t.useState(""),[g,A]=t.useState(""),c=t.useRef(null),f=t.useRef(0);let p=Y();t.useEffect(()=>{console.log("loading",u)},[u]),t.useEffect(()=>{console.log("vehicleData",h)},[h]),t.useEffect(()=>{c.current&&setTimeout(()=>{c.current.scrollTop=f.current},0)});const m=h.length>0&&h.filter(e=>{var o;return e.label.toLowerCase().includes(V.toLowerCase())&&(g===""||((o=e==null?void 0:e.workShop)==null?void 0:o.region)===g)}),E=async e=>{var j,v;if(c.current&&(f.current=c.current.scrollTop),(s==null?void 0:s.length)<=0)return x.error("Data not available for this vehicle",{id:"clipboard"});const o=s==null?void 0:s.filter(n=>n.latestDocument.imei===e.value);if((o==null?void 0:o.length)<=0)return x.error("Data not available for this vehicle",{id:"clipboard"});const{lat:M,lng:D}=((j=o==null?void 0:o[0])==null?void 0:j.latestDocument)??{},N={lat:M||k.lat,lng:D||k.lat};p(z(N)),p(S({imei:e.value,reg_id:e.label}));const W=e.label,$=await p(G({w_registration_id:W})),y=[];let Q=0;(v=$.payload)==null||v.map(n=>{n[n.parameter_type.toLowerCase()+"_parameter"].forEach(w=>{y.push({reg_id:e.label,imei:e.value,id:w.id,_id:n.id,key:Q++,label:n.parameter_type==="Telematic"&&w.short_name})})}),b==="Live Map"&&R(y)},B=e=>{I(e.target.value)},F=()=>{p(S({}))},O=e=>{A(e)},P={backgroundColor:l.grey[100],position:"relative",width:"100%",float:"right",height:"90vh",overflowY:"auto",scrollBehavior:"smooth",scrollbarWidth:"thin"};return r.jsx(r.Fragment,{children:r.jsx("div",{ref:c,style:P,children:u||T?r.jsx(d,{sx:{display:"flex",justifyContent:"center",height:"88vh",alignItems:"center"},children:r.jsx(U,{})}):r.jsxs(r.Fragment,{children:[r.jsx(d,{sx:{align:"center",my:"15px",ml:"20px"},children:r.jsxs(X,{sx:{width:"90%",backgroundColor:l.grey[500],borderRadius:"5px"},variant:"outlined",children:[r.jsx(Z,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:l.grey[400]},children:"Search"}),r.jsx(ee,{onChange:e=>B(e),inputProps:{style:{padding:7,color:l.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:r.jsx(re,{position:"end",children:r.jsx(oe,{"aria-label":"toggle password visibility",edge:"end",children:r.jsx(H,{style:{color:l.grey[400]}})})}),label:"Search"})]})}),r.jsx(J,{region:g,handleRegion:O}),b==="Live Map"&&r.jsx(d,{sx:{align:"center",my:"8px",ml:"20px"},children:r.jsx(_,{variant:"outlined",onClick:()=>{if(Object.keys(i).length>0)F();else return x.success("Already Selected To View All Vehicle Location.",{id:"already selected"})},sx:{width:"90%",bgcolor:Object.keys(i).length===0?a.bgColor:"undefined",color:Object.keys(i).length===0?"white":l.grey[400],border:`1px solid ${a.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:a.bgShadow}},children:"All Vehicles"})}),m.length>0?m.map((e,o)=>r.jsx(d,{sx:{align:"center",my:"8px",ml:"20px"},children:r.jsx(_,{variant:"outlined",onClick:()=>{E(e)},sx:{width:"90%",bgcolor:e.label===i.reg_id?a.bgColor:"undefined",color:e.label===i.reg_id?"white":l.grey[400],border:`1px solid ${a.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:a.bgShadow}},children:e.label})},o)):r.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh"},children:r.jsxs(q,{sx:{textAlign:"center",color:l.grey[400]},children:["Sorry! No vehicles in"," ",r.jsx("span",{style:{fontWeight:"bold"},children:g})," region"]})})]})})})};export{ie as V};
