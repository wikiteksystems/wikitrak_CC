import{i as R,j as t,a as P,u as Q,t as m,T as j,a7 as Se,a8 as _e,r as s,v as ye,P as X,a9 as ie,l as we,_ as J,m as Me}from"./index-BqNi_OjF.js";import{L as Ve}from"./LightModeOutlined-BwCQRwsf.js";import{L as De}from"./LiveMapTopBar-D9x6u_LV.js";import{V as Ce}from"./VehicleMenu-BRbN6-sm.js";import{u as Le,G as $e,M as le,I as ke}from"./esm-BsA0DFzN.js";import Ie from"./Loader-QVMqtaA8.js";import{r as E}from"./createSvgIcon-BjUJoQfT.js";import{B as p}from"./CircularProgress-BZodcYKn.js";import{s as K}from"./Socket-0N_gnJcr.js";import{P as Pe}from"./Parameters-DIvzMy9_.js";import{t as Re}from"./Search-CqfflqOy.js";import"./jcb-aCHXMCXy.js";import"./index-KvkLOwSI.js";import"./index-BroxGZtZ.js";import"./roundedArrow-DdLwIeMg.js";import"./TextArea-D0aUQ7HO.js";import"./OutlinedInput-7lk16080.js";import"./IconButton-BxZzzknn.js";import"./index-BQQWkeUA.js";import"./Card-CKcjqoRp.js";import"./Paper-Bk3MUCAr.js";var Y={},Ee=R;Object.defineProperty(Y,"__esModule",{value:!0});var ne=Y.default=void 0,ze=Ee(E()),He=t;ne=Y.default=(0,ze.default)((0,He.jsx)("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4"}),"Restaurant");var Z={},Oe=R;Object.defineProperty(Z,"__esModule",{value:!0});var ce=Z.default=void 0,Ae=Oe(E()),Fe=t;ce=Z.default=(0,Ae.default)((0,Fe.jsx)("path",{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3m12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4"}),"Hotel");var ee={},Ne=R;Object.defineProperty(ee,"__esModule",{value:!0});var pe=ee.default=void 0,qe=Ne(E()),Be=t;pe=ee.default=(0,qe.default)((0,Be.jsx)("path",{d:"m19.77 7.23.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77M12 10H6V5h6zm6 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalGasStation");var te={},Ge=R;Object.defineProperty(te,"__esModule",{value:!0});var he=te.default=void 0,We=Ge(E()),Te=t;he=te.default=(0,We.default)((0,Te.jsx)("path",{d:"M16.22 12c.68 0 1.22-.54 1.22-1.22 0-.67-.54-1.22-1.22-1.22S15 10.11 15 10.78c0 .68.55 1.22 1.22 1.22m-9.66-1.22c0 .67.54 1.22 1.22 1.22S9 11.46 9 10.78c0-.67-.54-1.22-1.22-1.22s-1.22.55-1.22 1.22M7.61 4 6.28 8h11.43l-1.33-4zm8.67-1s.54.01.92.54c.02.02.03.04.05.07.07.11.14.24.19.4.22.65 1.56 4.68 1.56 4.68v6.5c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81V14H7v1.19c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81v-6.5S6.34 4.67 6.55 4c.05-.16.12-.28.19-.4.03-.02.04-.04.06-.06.38-.53.92-.54.92-.54zM4 17.01h16V19h-7v3h-2v-3H4z"}),"CarRepair");var oe={},Ue=R;Object.defineProperty(oe,"__esModule",{value:!0});var de=oe.default=void 0,Xe=Ue(E()),Je=t;de=oe.default=(0,Xe.default)((0,Je.jsx)("path",{d:"M21 5h-2.64l1.14-3.14L17.15 1l-1.46 4H3v2l2 6-2 6v2h18v-2l-2-6 2-6zm-3.9 8.63L18.89 19H5.11l1.79-5.37.21-.63-.21-.63L5.11 7h13.78l-1.79 5.37-.21.63zM13 9h-2v3H8v2h3v3h2v-3h3v-2h-3z"}),"LocalPharmacyOutlined");var se={},Ke=R;Object.defineProperty(se,"__esModule",{value:!0});var ue=se.default=void 0,Qe=Ke(E()),Ye=t;ue=se.default=(0,Qe.default)((0,Ye.jsx)("path",{d:"M8 9v1.5h2.25V15h1.5v-4.5H14V9zM6 9H3c-.55 0-1 .45-1 1v5h1.5v-1.5h2V15H7v-5c0-.55-.45-1-1-1m-.5 3h-2v-1.5h2zM21 9h-4.5c-.55 0-1 .45-1 1v5H17v-4.5h1V14h1.5v-3.51h1V15H22v-5c0-.55-.45-1-1-1"}),"AtmOutlined");const Ze=({setPlace:b,place:r})=>{const{center:z}=P(u=>u.liveMap),d=Q(),h=async u=>{r===u?(d(Se([])),b("")):(b(u),d(_e({center:z,clickedPlace:u})))};return t.jsxs(p,{sx:{position:"absolute",top:"1vh",left:"20%",display:"flex",justifyContent:"center"},children:[t.jsx(p,{sx:{bgcolor:r==="restaurants"?m.bgColor:"white",color:r==="restaurants"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("restaurants")},children:t.jsxs(j,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ne,{style:{height:"17px",position:"relative",top:"1px"}}),"Restaurants"]})}),t.jsx(p,{sx:{bgcolor:r==="hotels"?m.bgColor:"white",color:r==="hotels"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("hotels")},children:t.jsxs(j,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ce,{style:{height:"17px",position:"relative",top:"1px"}}),"Hotels"]})}),t.jsx(p,{sx:{bgcolor:r==="hospitals"?m.bgColor:"white",color:r==="hospitals"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("hospitals")},children:t.jsxs(j,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(de,{style:{height:"17px",position:"relative",top:"1px"}}),"Hospitals"]})}),t.jsx(p,{sx:{bgcolor:r==="atm"?m.bgColor:"white",color:r==="atm"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("atm")},children:t.jsxs(j,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ue,{style:{height:"17px",position:"relative",top:"1px"}}),"ATMs"]})}),t.jsx(p,{sx:{bgcolor:r==="car_repair"?m.bgColor:"white",color:r==="car_repair"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("car_repair")},children:t.jsxs(j,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(he,{style:{height:"17px",position:"relative",top:"1px"}}),"Service center"]})}),t.jsx(p,{sx:{bgcolor:r==="gasstation"?m.bgColor:"white",color:r==="gasstation"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{h("gasstation")},children:t.jsxs(j,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(pe,{style:{height:"17px",position:"relative",top:"1px"}}),"Gas Stations"]})})]})},et=Ze,tt="/assets/motorbike-Ve1wpD8A.png";function ot({showCard:b}){const{center:r,selectedParameterList:z,selectedVehicle:d,vehicleList:h,icons:u,locationData:S,placesData:H,imeiNumbers:ae,onlineVehicle:_}=P(e=>e.liveMap),{mode:O,styles:T}=P(e=>e.dashboard),[A,U]=s.useState(null),[$,F]=s.useState(""),[N,q]=s.useState([]),[k,B]=s.useState([]),[y,i]=s.useState(),[l,x]=s.useState(),[w,M]=s.useState(null),[n,g]=s.useState(""),v=Q(),{isLoaded:V,loadError:f}=Le({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU",loadingElement:t.jsx(Ie,{})});s.useEffect(()=>{V&&U(window.google.maps)},[V]),s.useEffect(()=>{i(S)},[S]),s.useEffect(()=>{x(z)},[z]),s.useEffect(()=>(K.on("locationinfo",e=>{if(console.log("locationinfo",e),y.map(o=>{if(o.latestDocument.imei===e.imei){const a={lat:o.latestDocument.lat,lng:o.latestDocument.lng},c=500,C=60,I=c/(1e3/C),G=(e.lat-a.lat)/I,W=(e.lng-a.lng)/I;let L=0;const fe=setInterval(()=>{const ge=a.lat+G*L,me=a.lng+W*L,je={...o,latestDocument:{...o.latestDocument,lat:ge,lng:me}};L++,L>=I&&clearInterval(fe),i(be=>be.map(re=>re.latestDocument.imei===e.imei?je:re))},1e3/C)}return o}),String(e==null?void 0:e.imei)===String(l[0].imei)){const o=l[0].params.map(a=>{let c=a.label;return{...a,value:e[c]}});x([{...l[0],params:o}])}}),()=>{K.off("locationinfo")}),[K,y]),s.useEffect(()=>{v(ye({}))},[d]),s.useEffect(()=>{if(S.length>0&&_.length>0){const e=[],o=[];S.forEach(a=>{_.some(C=>String(C)===String(a._id))?e.push(a):o.push(a)}),q(e),B(o)}else q([]),B([])},[S,_]),s.useEffect(()=>{console.log("onVehicles",N),console.log("offVehicles",k)},[N]);const D=(e,o)=>{o&&g(o.latestDocument.imei),M(w===e?null:e)},xe=e=>{if(console.log("reg id ",e),e){const o=h.filter(a=>{var c;return a.imei&&((c=a.imei[0])==null?void 0:c.mac_id)===e});return o&&o.length>0?o[0].registration_id:"IMEI doesn't exist."}else return"IMEI doesn't exist."};if(f)return"Error loading maps";if(!V)return"Loading maps";if(!A)return null;const ve={height:b?"87vh":"95vh",width:"100%"};return t.jsxs(t.Fragment,{children:[b&&t.jsx(p,{sx:{bgcolor:m.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:l[0].params.length>0?t.jsxs(t.Fragment,{children:[l[0].params.length>0&&t.jsxs(X,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",l[0].reg_id]}),l.length>0&&l[0].params.map((e,o)=>t.jsx(X,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:e.label==="speed"?`${e.label} : ${e.value} km/h`:e.label==="mainInputVoltage"?`${e.label} : ${e.value} voltage`:e.label==="ignition"?`${e.label} : ${e.value===!0?"On":"Off"}`:`${e.label} : ${e.value}`},o))]}):t.jsx(t.Fragment,{children:t.jsx(X,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})}),t.jsxs($e,{mapContainerStyle:ve,zoom:10,center:r,options:{styles:O?T:""},children:[Object.keys(d).length>0&&t.jsx(et,{setPlace:F,place:$}),H&&H.length>0&&H.map((e,o)=>{var a,c;return t.jsx(le,{position:{lat:parseFloat((a=e==null?void 0:e.location)==null?void 0:a.lat),lng:parseFloat((c=e==null?void 0:e.location)==null?void 0:c.lng)},animation:"BOUNCE",icon:{path:u[`${$}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},o)}),y&&y.length>0&&y.map((e,o)=>{var a,c,C,I,G,W;return t.jsx(le,{position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},icon:{url:tt,fillColor:Object.keys(d).length>0&&d.imei===e.latestDocument.imei?"green":m.bgColor,fillOpacity:2,strokeWeight:1,scale:2,rotation:(a=e==null?void 0:e.latestDocument)==null?void 0:a.heading,size:new window.google.maps.Size(55,55),scaledSize:new window.google.maps.Size(55,55)},onClick:()=>{var L;return D((L=e==null?void 0:e.latestDocument)==null?void 0:L._id,e)},children:w===((c=e==null?void 0:e.latestDocument)==null?void 0:c._id)&&t.jsx(ke,{position:{lat:parseFloat((C=e==null?void 0:e.latestDocument)==null?void 0:C.lat),lng:parseFloat((I=e==null?void 0:e.latestDocument)==null?void 0:I.lng)},onCloseClick:()=>M(null),options:{maxWidth:"100%"},visible:w===e.id,children:t.jsxs(t.Fragment,{children:[t.jsxs(j,{children:["Vehicle No:"," ",xe((G=e==null?void 0:e.latestDocument)==null?void 0:G.imei)]}),t.jsxs(j,{children:["IMEI No: ",(W=e==null?void 0:e.latestDocument)==null?void 0:W.imei]})]})},e.id)},o)})]})]})}function wt(){const{locationData:b,selectedVehicle:r,selectedParameterList:z}=P(i=>i.liveMap),{mode:d}=P(i=>i.dashboard),h=Re(d),[u,S]=s.useState([]),{w_customer_id:H}=P(i=>i.auth),[ae,_]=s.useState(),[O,T]=s.useState(!1),[A,U]=s.useState(!1),[$,F]=s.useState([]),[N,q]=s.useState(!1);let k=Q();s.useEffect(()=>{B()},[]),s.useEffect(()=>{F([]),k(ie([{reg_id:"",imei:"",params:[]}]))},[r]);const B=async()=>{try{let i=[],l=[];const x=await k(we({w_customer_id:H}));if(Array.isArray(x.payload)){x.payload.forEach(n=>{var g,v,V;Array.isArray(n.imei)&&n.imei.length>0&&((g=n.imei[0])!=null&&g.mac_id)?(i.push({id:n.id,label:n.registration_id,value:(v=n.imei[0])==null?void 0:v.mac_id}),l.push((V=n.imei[0])==null?void 0:V.mac_id)):(console.error("IMEI data not found for item:",n),J.error(`IMEI Number not found for the vehicle: ${n==null?void 0:n.registration_id}`))});const w="one",M=l;l.length>0&&k(Me({type:w,imei:M})),S(i)}else console.error("Unexpected data format:",x),J.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),J.error(`Error fetching vehicle data: ${i}`)}},y=async i=>{const{label:l,imei:x,_id:w,reg_id:M,checked:n}=i;_(f=>f.map(D=>D._id===w?{...D,checked:!n}:D));let g=[...$],v=[...$];if(!n)b.forEach(f=>{f.latestDocument.imei===x&&(g.push({label:l,value:f.latestDocument[l]}),v=g,F(g))});else{let f=$.filter(D=>D.label!==l);v=f,F(f)}console.log("tempParamList",v),k(ie([{reg_id:M,imei:x,params:v}]))};return t.jsxs("div",{className:"app",children:[t.jsx(Ve,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(De,{title:"Live Map",setShowVehicles:T,showVehicles:O,showParameters:A,setShowParameters:U,setShowCard:q,showCard:N}),t.jsxs(p,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(p,{style:{width:O||A?"80%":"100%"},children:t.jsx(ot,{showCard:N})}),O&&t.jsx(p,{style:{width:"20%",backgroundColor:h.grey[100]},children:t.jsx(Ce,{vehicleData:u,title:"Live Map",setParameterData:_})}),A&&t.jsx(p,{style:{width:"20%",backgroundColor:h.grey[100]},children:t.jsx(Pe,{parametersData:ae,setParameterData:_,handleParameterChange:y})})]})]})]})}export{wt as default};
