import{r as f,w as Lt,i as Dt,j as i,a as D,u as ve,t as oe,P as Z,T as L,ar as Ae,s as Kt,h as Jt,as as Qt,at as we,_ as ee,au as Zt,av as es,l as ts,m as ss}from"./index-C0J5KT3H.js";import{A as kt,C as ze,x as ns,e as Ue,F as mt,o as is,t as Gt,y as rs,z as os,f as xt,d as as,a as ls,h as cs,b as ds,c as hs,L as us}from"./LightModeOutlined-BW34XPIq.js";import{r as Nt}from"./createSvgIcon-MJCp1tbz.js";import{d as gs}from"./NotificationsNone-EewIcISf.js";import{j as fs}from"./jcb-aCHXMCXy.js";import{B as C}from"./CircularProgress-nAflOzMD.js";import{I as Se}from"./IconButton-BtPD9ajK.js";import{V as ps}from"./VehicleMenu-Bux6O981.js";import{G as ms}from"./GeofencAlert-BsCD30kn.js";import{u as xs,c as ys,a as yt,b as Cs,d as _s,V as Ct,e as _t}from"./Form-D0jF6Spm.js";import{t as be,d as ws}from"./Search-D9wgoflv.js";import{T as wt}from"./TextField-gvk30Uds.js";import{a as St,b as Ss}from"./OutlinedInput-JifRmEa6.js";/* empty css           */import{i as vs,A as bs,D as js,E as Es,G as Fs,H as Ps,J as Bt,K as As,L as Ts,N as Is,Q as Vt,R as Rs,a as Ge,V as Ne,U as le,W as vt,X as bt,Y as jt,Z as Q,_ as Te,F as re,P as he,$ as me,a0 as Et,a1 as q,a2 as ne,a3 as ie,a4 as Be,a5 as Ms,a6 as Os,a7 as Ls,a8 as Ve,a9 as Ds,aa as ks,ab as Gs,ac as zt,ad as Ns,ae as Ft,af as Bs,f as xe,ag as Vs,S as ye,ah as Ce,z as Ie,ai as Re,M as zs,T as Us,O as qs,b as Xs,h as Ws,aj as Pt,I as Hs}from"./Vector-BEQdHjna.js";import{S as Ys}from"./Select-izrswFFx.js";import{S as _e}from"./Switch-DlbTQf1P.js";import{I as $s}from"./Select-CJhf5z5x.js";import{u as Ks,I as qe,T as Js}from"./TextArea-b4nMd3PQ.js";import{B as Qs,S as Zs}from"./button-VZJ0bjwJ.js";import"./Modal-D_3Awd5z.js";import"./Paper-PZgQk-1M.js";var en={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2Q889.47 375.11 816.7 305l-50.88 50.88C807.31 395.53 843.45 447.4 874.7 512 791.5 684.2 673.4 766 512 766q-72.67 0-133.87-22.38L323 798.75Q408 838 512 838q288.3 0 430.2-300.3a60.29 60.29 0 000-51.5zm-63.57-320.64L836 122.88a8 8 0 00-11.32 0L715.31 232.2Q624.86 186 512 186q-288.3 0-430.2 300.3a60.3 60.3 0 000 51.5q56.69 119.4 136.5 191.41L112.48 835a8 8 0 000 11.31L155.17 889a8 8 0 0011.31 0l712.15-712.12a8 8 0 000-11.32zM149.3 512C232.6 339.8 350.7 258 512 258c54.54 0 104.13 9.36 149.12 28.39l-70.3 70.3a176 176 0 00-238.13 238.13l-83.42 83.42C223.1 637.49 183.3 582.28 149.3 512zm246.7 0a112.11 112.11 0 01146.2-106.69L401.31 546.2A112 112 0 01396 512z"}},{tag:"path",attrs:{d:"M508 624c-3.46 0-6.87-.16-10.25-.47l-52.82 52.82a176.09 176.09 0 00227.42-227.42l-52.82 52.82c.31 3.38.47 6.79.47 10.25a111.94 111.94 0 01-112 112z"}}]},name:"eye-invisible",theme:"outlined"};const tn=en;var sn=function(e,t){return f.createElement(kt,Lt({},e,{ref:t,icon:tn}))},nn=f.forwardRef(sn);const rn=nn;var on={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"};const an=on;var ln=function(e,t){return f.createElement(kt,Lt({},e,{ref:t,icon:an}))},cn=f.forwardRef(ln);const dn=cn,hn=u=>{const{getPrefixCls:e,direction:t}=f.useContext(ze),{prefixCls:s,className:n}=u,r=e("input-group",s),a=e("input"),[l,c]=ns(a),o=Ue(r,{[`${r}-lg`]:u.size==="large",[`${r}-sm`]:u.size==="small",[`${r}-compact`]:u.compact,[`${r}-rtl`]:t==="rtl"},c,n),h=f.useContext(mt),g=f.useMemo(()=>Object.assign(Object.assign({},h),{isFormItemInput:!1}),[h]);return l(f.createElement("span",{className:o,style:u.style,onMouseEnter:u.onMouseEnter,onMouseLeave:u.onMouseLeave,onFocus:u.onFocus,onBlur:u.onBlur},f.createElement(mt.Provider,{value:g},u.children)))},un=hn;var gn=function(u,e){var t={};for(var s in u)Object.prototype.hasOwnProperty.call(u,s)&&e.indexOf(s)<0&&(t[s]=u[s]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(u);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(u,s[n])&&(t[s[n]]=u[s[n]]);return t};const fn=u=>u?f.createElement(dn,null):f.createElement(rn,null),pn={click:"onClick",hover:"onMouseOver"},mn=f.forwardRef((u,e)=>{const{visibilityToggle:t=!0}=u,s=typeof t=="object"&&t.visible!==void 0,[n,r]=f.useState(()=>s?t.visible:!1),a=f.useRef(null);f.useEffect(()=>{s&&r(t.visible)},[s,t]);const l=Ks(a),c=()=>{const{disabled:A}=u;A||(n&&l(),r(b=>{var k;const B=!b;return typeof t=="object"&&((k=t.onVisibleChange)===null||k===void 0||k.call(t,B)),B}))},o=A=>{const{action:b="click",iconRender:k=fn}=u,B=pn[b]||"",j=k(n),$={[B]:c,className:`${A}-icon`,key:"passwordIcon",onMouseDown:U=>{U.preventDefault()},onMouseUp:U=>{U.preventDefault()}};return f.cloneElement(f.isValidElement(j)?j:f.createElement("span",null,j),$)},{className:h,prefixCls:g,inputPrefixCls:m,size:d}=u,x=gn(u,["className","prefixCls","inputPrefixCls","size"]),{getPrefixCls:_}=f.useContext(ze),v=_("input",m),S=_("input-password",g),O=t&&o(S),w=Ue(S,h,{[`${S}-${d}`]:!!d}),z=Object.assign(Object.assign({},is(x,["suffix","iconRender","visibilityToggle"])),{type:n?"text":"password",className:w,prefixCls:v,suffix:O});return d&&(z.size=d),f.createElement(qe,Object.assign({ref:Gt(e,a)},z))}),xn=mn;var yn=function(u,e){var t={};for(var s in u)Object.prototype.hasOwnProperty.call(u,s)&&e.indexOf(s)<0&&(t[s]=u[s]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(u);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(u,s[n])&&(t[s[n]]=u[s[n]]);return t};const Cn=f.forwardRef((u,e)=>{const{prefixCls:t,inputPrefixCls:s,className:n,size:r,suffix:a,enterButton:l=!1,addonAfter:c,loading:o,disabled:h,onSearch:g,onChange:m,onCompositionStart:d,onCompositionEnd:x}=u,_=yn(u,["prefixCls","inputPrefixCls","className","size","suffix","enterButton","addonAfter","loading","disabled","onSearch","onChange","onCompositionStart","onCompositionEnd"]),{getPrefixCls:v,direction:S}=f.useContext(ze),O=f.useRef(!1),w=v("input-search",t),z=v("input",s),{compactSize:A}=rs(w,S),b=os(P=>{var I;return(I=r??A)!==null&&I!==void 0?I:P}),k=f.useRef(null),B=P=>{P&&P.target&&P.type==="click"&&g&&g(P.target.value,P,{source:"clear"}),m&&m(P)},j=P=>{var I;document.activeElement===((I=k.current)===null||I===void 0?void 0:I.input)&&P.preventDefault()},$=P=>{var I,X;g&&g((X=(I=k.current)===null||I===void 0?void 0:I.input)===null||X===void 0?void 0:X.value,P,{source:"input"})},U=P=>{O.current||o||$(P)},je=typeof l=="boolean"?f.createElement(Zs,null):null,G=`${w}-button`;let te;const E=l||{},Ee=E.type&&E.type.__ANT_BUTTON===!0;Ee||E.type==="button"?te=xt(E,Object.assign({onMouseDown:j,onClick:P=>{var I,X;(X=(I=E==null?void 0:E.props)===null||I===void 0?void 0:I.onClick)===null||X===void 0||X.call(I,P),$(P)},key:"enterButton"},Ee?{className:G,size:b}:{})):te=f.createElement(Qs,{className:G,type:l?"primary":void 0,size:b,disabled:h,key:"enterButton",onMouseDown:j,onClick:$,loading:o,icon:je},l),c&&(te=[te,xt(c,{key:"addonAfter"})]);const V=Ue(w,{[`${w}-rtl`]:S==="rtl",[`${w}-${b}`]:!!b,[`${w}-with-button`]:!!l},n),Fe=P=>{O.current=!0,d==null||d(P)},de=P=>{O.current=!1,x==null||x(P)};return f.createElement(qe,Object.assign({ref:Gt(k,e),onPressEnter:U},_,{size:b,onCompositionStart:Fe,onCompositionEnd:de,prefixCls:z,addonAfter:te,suffix:a,onChange:B,className:V,disabled:h}))}),_n=Cn,fe=qe;fe.Group=un;fe.Search=_n;fe.TextArea=Js;fe.Password=xn;const At=fe;var Xe={},wn=Dt;Object.defineProperty(Xe,"__esModule",{value:!0});var Ut=Xe.default=void 0,Sn=wn(Nt()),vn=i;Ut=Xe.default=(0,Sn.default)((0,vn.jsx)("path",{d:"M12 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c2.7 0 5.8 1.29 6 2H6c.23-.72 3.31-2 6-2m0-12C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 10c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonOutlined");class ge extends vs{constructor(e,t,s){super(),s!==void 0&&t===void 0?this.setFlatCoordinates(s,e):(t=t||0,this.setCenterAndRadius(e,t,s))}clone(){const e=new ge(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,s,n){const r=this.flatCoordinates,a=e-r[0],l=t-r[1],c=a*a+l*l;if(c<n){if(c===0)for(let o=0;o<this.stride;++o)s[o]=r[o];else{const o=this.getRadius()/Math.sqrt(c);s[0]=r[0]+o*a,s[1]=r[1]+o*l;for(let h=2;h<this.stride;++h)s[h]=r[h]}return s.length=this.stride,c}return n}containsXY(e,t){const s=this.flatCoordinates,n=e-s[0],r=t-s[1];return n*n+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,s=t[this.stride]-t[0];return bs(t[0]-s,t[1]-s,t[0]+s,t[1]+s,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(js(e,t)){const s=this.getCenter();return e[0]<=s[0]&&e[2]>=s[0]||e[1]<=s[1]&&e[3]>=s[1]?!0:Es(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,s=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+s;for(let r=1;r<t;++r)n[t+r]=e[r];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,s){this.setLayout(s,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let r=Fs(n,0,e,this.stride);n[r++]=n[0]+t;for(let a=1,l=this.stride;a<l;++a)n[r++]=n[a];n.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const s=this.getCenter(),n=this.getStride();this.setCenter(Ps(s,0,s.length,n,e,t,s)),this.changed()}}ge.prototype.transform;var We={},bn=Dt;Object.defineProperty(We,"__esModule",{value:!0});var qt=We.default=void 0,jn=bn(Nt()),En=i;qt=We.default=(0,jn.default)((0,En.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"Place");const Fn=({title:u,setShowContent:e,showContent:t,showMap:s,setShowMap:n,setShowGfBar:r,showGfBar:a,setShowGfAlert:l,showGfAlert:c})=>{const{collapsed:o}=D(v=>v.auth),{selectedVehicle:h}=D(v=>v.liveMap),{vehicleSideBar:g}=D(v=>v.geofence);f.useState(!1);const{mode:m}=D(v=>v.dashboard);JSON.parse(localStorage.getItem("w_userDetails"));const d=ve(),x=()=>{d(Jt(!o))},_=()=>{e({...t,vehicle:!t.vehicle}),r(!1),l(!1),d(Ae({data:!g}))};return i.jsxs(C,{display:"flex",justifyContent:"space-between",p:1,sx:{bgcolor:oe.bgColor,border:"1px solid white",borderRadius:"4px",height:"55px"},children:[i.jsxs(C,{style:{display:"flex",justifyContent:"space-between",gap:"10px",alignItems:"center"},children:[o?i.jsx(Z,{onClick:x,sx:{color:"white"},children:i.jsx(as,{style:{width:"30px",height:"30px"}})}):i.jsx(Z,{onClick:x,sx:{color:"white"},children:i.jsx(ls,{style:{width:"30px",height:"30px"}})}),i.jsx(C,{children:i.jsx("img",{src:`${cs}`,style:{width:"36px",height:"36px"}})}),i.jsx(L,{style:{fontSize:"20px",fontFamily:"ubuntu",fontWeight:"500",color:"#FFFFFF"},children:"WIKITRAK"})]}),i.jsx(C,{children:i.jsx(L,{variant:"h6",color:"white",fontWeight:"bold",sx:{ml:"15px",mt:"15px"},children:Object.keys(h).length>0&&s?`${u} - Geofence (${h.reg_id})`:i.jsxs(i.Fragment,{children:[u," ",Object.keys(h).length>0&&h.reg_id]})})}),i.jsxs(C,{sx:{display:"flex"},children:[i.jsxs(Z,{variant:"outlined",size:"small",sx:{color:t.vehicle?"white":"black",backgroundColor:t.vehicle?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:_,children:[i.jsx("img",{src:fs,style:{marginRight:"5px"}}),Object.keys(h).length>0?h.reg_id:"Vehicles"]}),s&&i.jsx(C,{children:i.jsx(Z,{variant:"outlined",size:"small",sx:{color:a?"white":"black",backgroundColor:a?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:()=>{l(!1),r(!a),d(Ae({data:!1}))},children:"Geofence"})}),i.jsx(C,{sx:{color:"white",mr:"10px"},children:i.jsxs(C,{sx:{display:"flex",marginTop:"14px",gap:"10px"},children:[i.jsx(C,{onClick:()=>{r(!1),l(!c),d(Ae({data:!1}))},children:i.jsx(gs,{sx:{cursor:"pointer",width:"30px",height:"30px"}})}),i.jsx(C,{onClick:()=>{e({...t,user:!t.user}),n(!1)},children:t.user?i.jsx(qt,{sx:{mr:"2px",cursor:"pointer",width:"30px",height:"30px"}}):i.jsx(Ut,{sx:{mr:"2px",cursor:"pointer",width:"30px",height:"30px"}})})]})}),i.jsx(Se,{onClick:()=>{d(Kt(!m))},sx:{color:"white"},children:m?i.jsx(ds,{}):i.jsx(hs,{})})]})]})},Pn=Fn,An=()=>{const u=ve(),e=xs("(min-width:600px)"),[t,s]=f.useState(!1),[n,r]=f.useState(!1),{mode:a}=D(g=>g.dashboard),l=be(a),c={new_password:"",confirmPassword:""},o=ys().shape({new_password:yt().required("Password is required").min(8,"Password must be at least 8 characters"),confirmPassword:yt().oneOf([Cs("new_password"),null],"Passwords must match").required("Confirm password is required")}),h=g=>{console.log("values",g);let m=g.confirmPassword;u(Qt({new_password:m}))};return i.jsx(C,{sx:{display:"flex",justifyContent:"center"},children:i.jsxs(C,{sx:{width:"30%"},children:[i.jsx(C,{sx:{align:"center"},children:i.jsx(L,{variant:"h5",sx:{mt:"25px",my:"",fontWeight:"bold",align:"center",color:l.grey[400]},children:"Change Password"})}),i.jsx(_s,{onSubmit:h,initialValues:c,validationSchema:o,children:({values:g,errors:m,touched:d,handleBlur:x,handleChange:_,handleSubmit:v})=>i.jsxs("form",{onSubmit:v,children:[i.jsxs(C,{display:"grid",gap:"15px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:e?void 0:"span 4"}},marginTop:"20px",children:[i.jsx(wt,{fullWidth:!0,variant:"outlined",type:t?"text":"password",label:"New Password",onBlur:x,onChange:_,value:g.new_password,name:"new_password",error:!!d.new_password&&!!m.new_password,helperText:d.new_password&&m.new_password,sx:{gridColumn:"span 4",backgroundColor:"white",borderRadius:"5px"},InputProps:{endAdornment:i.jsx(St,{position:"end",children:i.jsx(Se,{"aria-label":"toggle password visibility",onClick:()=>s(!t),edge:"end",children:t?i.jsx(Ct,{}):i.jsx(_t,{})})})}}),i.jsx(wt,{fullWidth:!0,variant:"outlined",type:n?"text":"password",label:"Confirm Password",onBlur:x,onChange:_,value:g.confirmPassword,name:"confirmPassword",error:!!d.confirmPassword&&!!m.confirmPassword,helperText:d.confirmPassword&&m.confirmPassword,sx:{gridColumn:"span 4",backgroundColor:"white",borderRadius:"5px"},InputProps:{endAdornment:i.jsx(St,{position:"end",children:i.jsx(Se,{"aria-label":"toggle password visibility",onClick:()=>r(!n),edge:"end",children:n?i.jsx(Ct,{}):i.jsx(_t,{})})})}})]}),i.jsx(C,{sx:{my:"29px"},children:i.jsx(Z,{type:"submit",sx:{background:oe.bgColor,width:"100%",p:"10px","&:hover":{background:oe.bgShadow,color:l.grey[100]}},variant:"contained",children:"submit"})})]})})]})})},Tn=()=>{const u=JSON.parse(localStorage.getItem("w_userDetails")),{mode:e}=D(s=>s.dashboard),t=be(e);return i.jsxs(C,{children:[i.jsxs(C,{sx:{backgroundColor:t.grey[200],m:"10px",borderRadius:"5px",height:"150px"},children:[i.jsx(C,{sx:{pl:"20px",pt:"10px",mb:"10px",color:`${t.grey[400]}`},children:i.jsx("b",{children:"User Settings"})}),i.jsxs(C,{sx:{display:"flex"},children:[i.jsx(C,{sx:{ml:"23px",mt:"11px",height:"70px",width:"70px",backgroundColor:"white",borderRadius:"50%"}}),i.jsxs(C,{sx:{height:"80px",width:"200px",display:"flex",justifyContent:"center",flexDirection:"column",mx:"20px",color:t.grey[400]},children:[i.jsx(C,{children:i.jsxs("b",{children:[" ",u&&u.first_name," ",u.last_name]})}),i.jsx(C,{children:u&&u.role})]})]})]}),i.jsx(C,{sx:{marginTop:"9%",alignContent:"center",textAlign:"center"},children:i.jsx(An,{})})]})},In=Tn,Rn="/assets/tractorIcon-zWRQE9nW.jpg",Mn="data:image/png;base64,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";function On({shapeType:u,center:e,radius:t,active:s,setActive:n,setInward:r,inward:a,setSpeedLimit:l,speedLimit:c,setSpeedValue:o,handleGeofence:h,speedValue:g}){const{selectedVehicle:m,locationData:d,tractorIcon:x}=D(_=>_.liveMap);return i.jsxs(C,{sx:{display:"flex",padding:"15px",flexDirection:"column",gap:"10px",color:we[600]},children:[i.jsx(L,{sx:{fontWeight:"bold",fontSize:"16px"},children:"Geofence Setting"}),i.jsxs(L,{sx:{fontWeight:"400",fontSize:"14px",textTransform:"capitalize"},children:["Type: ",u]}),u==="circular"&&i.jsxs(i.Fragment,{children:[i.jsx(L,{sx:{color:"#686868"},children:"Centered At "}),i.jsxs(L,{sx:{color:"#686868"},children:["Lat: ",e.lat.toFixed(2)]}),i.jsxs(L,{sx:{color:"#686868"},children:["Lng: ",e.lng.toFixed(2)]}),i.jsxs(L,{sx:{color:"#686868",border:"1px solid #686868",borderRadius:"4px",padding:"8px"},children:["Radius ( ",(t/1e3).toFixed(2)," in km)"]})]}),i.jsxs(C,{display:"flex",alignItems:"center",children:[i.jsx(L,{variant:"body1",component:"b",children:s?"Active":"Inactive"}),i.jsx(_e,{defaultChecked:s,onChange:()=>{n(!s)},color:"primary",inputProps:{"aria-label":"toggle active state"}})]}),i.jsxs(C,{display:"flex",alignItems:"center",children:[i.jsx(L,{variant:"body1",component:"b",children:a?"Inward":"Outward"}),i.jsx(_e,{checked:a,onChange:()=>{r(!a)},color:"primary",inputProps:{"aria-label":"toggle direction"}})]}),i.jsxs(C,{display:"flex",alignItems:"center",children:[i.jsx(_e,{checked:c,onChange:()=>{l(!c)},color:"primary",inputProps:{"aria-label":"toggle direction"}}),i.jsx(L,{variant:"body1",component:"b",children:"Speed Limit"})]}),c&&i.jsx(C,{sx:{},children:i.jsx($s,{sx:{width:"100%",color:we[600],border:"none","&:focus":{outline:"none"}},value:g,placeholder:"Enter Speed Limit",type:"number",onChange:_=>{const v=Math.max(0,parseInt(_.target.value));o(v)}})}),i.jsx(Z,{disabled:Object.keys(m).length===0&&!1,variant:"outlined",size:"small",sx:{color:"white",backgroundColor:oe.bgColor,mt:"6px",mx:"5px",border:"1px solid white",height:"40px",width:"100%","&:hover":{color:"black",background:oe.bgShadow,border:"1px solid black"},letterSpacing:"1.5px",fontSize:"16px"},onClick:()=>{if(Object.keys(m).length===0)return ee.error("please select a vehicle.");h()},children:"SUBMIT"})]})}const Tt=0,ue=1,It=[0,0,0,0],ce=[],Me={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Oe extends zt{constructor(e,t,s){super(e),this.features=t,this.mapBrowserEvent=s}}class Ln extends Bt{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:As,this.defaultDeleteCondition_=function(s){return Ts(s)&&Is(s)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Vt,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Rs,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ge({source:new Ne({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:kn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new le(this.source_.getFeatures()),this.source_.addEventListener(vt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(vt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(bt.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(bt.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}const s=this.getMap();s&&s.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,s),e.addEventListener(jt.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new le;const s=this.featuresBeingModified_.getArray();for(let n=0,r=t.length;n<r;++n){const a=t[n];for(let l=0,c=a.length;l<c;++l){const o=a[l].feature;o&&!s.includes(o)&&this.featuresBeingModified_.push(o)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Oe(Me.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(jt.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,s=[];t.forEach(function(n){e===n.feature&&s.push(n)});for(let n=s.length-1;n>=0;--n){const r=s[n];for(let a=this.dragSegments_.length-1;a>=0;--a)this.dragSegments_[a][0]===r&&this.dragSegments_.splice(a,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const s=t.getCoordinates(),n={feature:e,geometry:t,segment:[s,s]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length;n<r;++n){const a=s[n],l={feature:e,geometry:t,depth:[n],index:n,segment:[a,a]};this.rBush_.insert(t.getExtent(),l)}}writeLineStringGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length-1;n<r;++n){const a=s.slice(n,n+2),l={feature:e,geometry:t,index:n,segment:a};this.rBush_.insert(Q(a),l)}}writeMultiLineStringGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length;n<r;++n){const a=s[n];for(let l=0,c=a.length-1;l<c;++l){const o=a.slice(l,l+2),h={feature:e,geometry:t,depth:[n],index:l,segment:o};this.rBush_.insert(Q(o),h)}}}writePolygonGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length;n<r;++n){const a=s[n];for(let l=0,c=a.length-1;l<c;++l){const o=a.slice(l,l+2),h={feature:e,geometry:t,depth:[n],index:l,segment:o};this.rBush_.insert(Q(o),h)}}}writeMultiPolygonGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length;n<r;++n){const a=s[n];for(let l=0,c=a.length;l<c;++l){const o=a[l];for(let h=0,g=o.length-1;h<g;++h){const m=o.slice(h,h+2),d={feature:e,geometry:t,depth:[l,n],index:h,segment:m};this.rBush_.insert(Q(m),d)}}}}writeCircleGeometry_(e,t){const s=t.getCenter(),n={feature:e,geometry:t,index:Tt,segment:[s,s]},r={feature:e,geometry:t,index:ue,segment:[s,s]},a=[n,r];n.featureSegments=a,r.featureSegments=a,this.rBush_.insert(Te(s),n);let l=t;this.rBush_.insert(l.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const s=t.getGeometriesArray();for(let n=0;n<s.length;++n){const r=s[n],a=this.SEGMENT_WRITERS_[r.getType()];a(e,r)}}createOrUpdateVertexFeature_(e,t,s){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(e):(n=new re(new he(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",t),n.set("geometries",s),n}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==me.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=me.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==me.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],s=[],n=[];for(let r=0,a=this.dragSegments_.length;r<a;++r){const l=this.dragSegments_[r],c=l[0],o=c.feature;s.includes(o)||s.push(o);const h=c.geometry;n.includes(h)||n.push(h);const g=c.depth;let m;const d=c.segment,x=l[1];for(;t.length<h.getStride();)t.push(d[x][t.length]);switch(h.getType()){case"Point":m=t,d[0]=t,d[1]=t;break;case"MultiPoint":m=h.getCoordinates(),m[c.index]=t,d[0]=t,d[1]=t;break;case"LineString":m=h.getCoordinates(),m[c.index+x]=t,d[x]=t;break;case"MultiLineString":m=h.getCoordinates(),m[g[0]][c.index+x]=t,d[x]=t;break;case"Polygon":m=h.getCoordinates(),m[g[0]][c.index+x]=t,d[x]=t;break;case"MultiPolygon":m=h.getCoordinates(),m[g[1]][g[0]][c.index+x]=t,d[x]=t;break;case"Circle":if(d[0]=t,d[1]=t,c.index===Tt)this.changingFeature_=!0,h.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let _=Et(q(h.getCenter()),q(t));h.setRadius(_),this.changingFeature_=!1}break}m&&this.setGeometryCoordinates_(h,m)}this.createOrUpdateVertexFeature_(t,s,n)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const s=this.vertexFeature_;if(s){e.map.getView().getProjection();const n=[],r=s.getGeometry().getCoordinates(),a=Q([r]),l=this.rBush_.getInExtent(a),c={};l.sort(Dn);for(let o=0,h=l.length;o<h;++o){const g=l[o],m=g.segment;let d=ne(g.geometry);const x=g.depth;if(x&&(d+="-"+x.join("-")),c[d]||(c[d]=new Array(2)),g.geometry.getType()==="Circle"&&g.index===ue){const _=Mt(t,g);ie(_,r)&&!c[d][0]&&(this.dragSegments_.push([g,0]),c[d][0]=g);continue}if(ie(m[0],r)&&!c[d][0]){this.dragSegments_.push([g,0]),c[d][0]=g;continue}if(ie(m[1],r)&&!c[d][1]){if(c[d][0]&&c[d][0].index===0){let _=g.geometry.getCoordinates();switch(g.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":_=_[x[1]];case"Polygon":if(g.index!==_[x[0]].length-2)continue;break}}this.dragSegments_.push([g,1]),c[d][1]=g;continue}ne(m)in this.vertexSegments_&&!c[d][0]&&!c[d][1]&&this.insertVertexCondition_(e)&&n.push(g)}n.length&&this.willModifyFeatures_(e,[n]);for(let o=n.length-1;o>=0;--o)this.insertVertex_(n[o],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const s=this.dragSegments_[t][0],n=s.geometry;if(n.getType()==="Circle"){const r=n.getCenter(),a=s.featureSegments[0],l=s.featureSegments[1];a.segment[0]=r,a.segment[1]=r,l.segment[0]=r,l.segment[1]=r,this.rBush_.update(Te(r),a);let c=n;this.rBush_.update(c.getExtent(),l)}else this.rBush_.update(Q(s.segment),s)}return this.featuresBeingModified_&&(this.dispatchEvent(new Oe(Me.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,s){const n=s||t.getCoordinateFromPixel(e);t.getView().getProjection();const r=function(c,o){return Rt(n,c)-Rt(n,o)};let a,l;if(this.hitDetection_){const c=typeof this.hitDetection_=="object"?o=>o===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(o,h,g)=>{g&&g.getType()==="Point"&&(g=new he(Be(g.getCoordinates())));const m=g||o.getGeometry();if(o instanceof re&&this.features_.getArray().includes(o)){l=m;const d=o.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:o,geometry:l,segment:[d,d]}]}return!0},{layerFilter:c})}if(!a){const c=Ms(Te(n,It)),o=t.getView().getResolution()*this.pixelTolerance_,h=Os(Ls(c,o,It));a=this.rBush_.getInExtent(h)}if(a&&a.length>0){const c=a.sort(r)[0],o=c.segment;let h=Mt(n,c);const g=t.getPixelFromCoordinate(h);let m=Et(e,g);if(l||m<=this.pixelTolerance_){const d={};if(d[ne(o)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-n[0],this.delta_[1]=h[1]-n[1]),c.geometry.getType()==="Circle"&&c.index===ue)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[c.feature],[c.geometry]);else{const x=t.getPixelFromCoordinate(o[0]),_=t.getPixelFromCoordinate(o[1]),v=Ve(g,x),S=Ve(g,_);m=Math.sqrt(Math.min(v,S)),this.snappedToVertex_=m<=this.pixelTolerance_,this.snappedToVertex_&&(h=v>S?o[1]:o[0]),this.createOrUpdateVertexFeature_(h,[c.feature],[c.geometry]);const O={};O[ne(c.geometry)]=!0;for(let w=1,z=a.length;w<z;++w){const A=a[w].segment;if(ie(o[0],A[0])&&ie(o[1],A[1])||ie(o[0],A[1])&&ie(o[1],A[0])){const b=ne(a[w].geometry);b in O||(O[b]=!0,d[ne(A)]=!0)}else break}}this.vertexSegments_=d;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const s=e.segment,n=e.feature,r=e.geometry,a=e.depth,l=e.index;let c;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":c=r.getCoordinates(),c[a[0]].splice(l+1,0,t);break;case"Polygon":c=r.getCoordinates(),c[a[0]].splice(l+1,0,t);break;case"MultiPolygon":c=r.getCoordinates(),c[a[1]][a[0]].splice(l+1,0,t);break;case"LineString":c=r.getCoordinates(),c.splice(l+1,0,t);break;default:return}this.setGeometryCoordinates_(r,c);const o=this.rBush_;o.remove(e),this.updateSegmentIndices_(r,l,a,1);const h={segment:[s[0],t],feature:n,geometry:r,depth:a,index:l};o.insert(Q(h.segment),h),this.dragSegments_.push([h,1]);const g={segment:[t,s[1]],feature:n,geometry:r,depth:a,index:l+1};o.insert(Q(g.segment),g),this.dragSegments_.push([g,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=me.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Oe(Me.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let s=!1,n,r,a,l,c,o,h,g,m,d,x;for(c=e.length-1;c>=0;--c)a=e[c],d=a[0],x=ne(d.feature),d.depth&&(x+="-"+d.depth.join("-")),x in t||(t[x]={}),a[1]===0?(t[x].right=d,t[x].index=d.index):a[1]==1&&(t[x].left=d,t[x].index=d.index+1);for(x in t){switch(m=t[x].right,h=t[x].left,o=t[x].index,g=o-1,h!==void 0?d=h:d=m,g<0&&(g=0),l=d.geometry,r=l.getCoordinates(),n=r,s=!1,l.getType()){case"MultiLineString":r[d.depth[0]].length>2&&(r[d.depth[0]].splice(o,1),s=!0);break;case"LineString":r.length>2&&(r.splice(o,1),s=!0);break;case"MultiPolygon":n=n[d.depth[1]];case"Polygon":n=n[d.depth[0]],n.length>4&&(o==n.length-1&&(o=0),n.splice(o,1),s=!0,o===0&&(n.pop(),n.push(n[0]),g=n.length-1));break}if(s){this.setGeometryCoordinates_(l,r);const _=[];if(h!==void 0&&(this.rBush_.remove(h),_.push(h.segment[0])),m!==void 0&&(this.rBush_.remove(m),_.push(m.segment[1])),h!==void 0&&m!==void 0){const v={depth:d.depth,feature:d.feature,geometry:d.geometry,index:g,segment:_};this.rBush_.insert(Q(v.segment),v)}this.updateSegmentIndices_(l,o,d.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return s}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,s,n){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(s===void 0||r.depth===void 0||Ds(r.depth,s))&&r.index>t&&(r.index+=n)})}}function Dn(u,e){return u.index-e.index}function Rt(u,e,t){const s=e.geometry;if(s.getType()==="Circle"){let r=s;if(e.index===ue){const a=Ve(r.getCenter(),q(u)),l=Math.sqrt(a)-r.getRadius();return l*l}}const n=q(u);return ce[0]=q(e.segment[0]),ce[1]=q(e.segment[1]),Ns(n,ce)}function Mt(u,e,t){const s=e.geometry;if(s.getType()==="Circle"&&e.index===ue)return Be(s.getClosestPoint(q(u)));const n=q(u);return ce[0]=q(e.segment[0]),ce[1]=q(e.segment[1]),Be(ks(n,ce))}function kn(){const u=Gs();return function(e,t){return u.Point}}const Le=Ln,De={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class ke extends zt{constructor(e,t,s,n,r){super(e),this.features=t,this.coordinate=s,this.startCoordinate=n,this.mapBrowserEvent=r}}class Gn extends Bt{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=e.features!==void 0?e.features:null;let t;if(e.layers&&!this.features_)if(typeof e.layers=="function")t=e.layers;else{const s=e.layers;t=function(n){return s.includes(n)}}else t=Ft;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:Ft,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:Vt,this.lastFeature_=null,this.addChangeListener(Bs.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new le([this.lastFeature_]);return this.dispatchEvent(new ke(De.TRANSLATESTART,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new le([this.lastFeature_]);return this.dispatchEvent(new ke(De.TRANSLATEEND,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate;e.map.getView().getProjection();const s=q(t),n=q(this.lastCoordinate_),r=s[0]-n[0],a=s[1]-n[1],l=this.features_||new le([this.lastFeature_]);l.forEach(function(c){const o=c.getGeometry();o.translate(r,a),c.setGeometry(o)}),this.lastCoordinate_=t,this.dispatchEvent(new ke(De.TRANSLATING,l,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(s,n)=>{if(!(!(s instanceof re)||!this.filter_(s,n))&&!(this.features_&&!this.features_.getArray().includes(s)))return s},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const s=this.getActive();(!t||!s)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}}const Ot=Gn,Nn=({showGfBar:u,showGfAlert:e})=>{const t="http://139.59.37.47:3031",{selectedVehicle:s,locationData:n,tractorIcon:r}=D(y=>y.liveMap),{geofence:a,vehicleSideBar:l}=D(y=>y.geofence);D(y=>y.dashboard);const{collapsed:c}=D(y=>y.auth),[o,h]=f.useState(null),[g,m]=f.useState(1e3),[d,x]=f.useState(!0),[_,v]=f.useState(!1),[S,O]=f.useState(!1),[w,z]=f.useState({lat:18.516726,lng:73.856255}),[A,b]=f.useState([]),[k,B]=f.useState(50),[j,$]=f.useState("circular"),[U,je]=f.useState(null),[G,te]=f.useState(null),[E,Ee]=f.useState(new Ne),[V,Fe]=f.useState(null),[de,P]=f.useState(""),[I,X]=f.useState([{lat:w.lat+.01,lng:w.lng+.01},{lat:w.lat+.01,lng:w.lng-.01},{lat:w.lat-.01,lng:w.lng-.01},{lat:w.lat-.01,lng:w.lng+.01}]),He=f.useRef(),Pe=f.useRef(null);let Xt=ve();f.useEffect(()=>{Ht()},[s]),f.useEffect(()=>{if(n.length>0&&Object.keys(s).length>0){let y=n.filter(T=>{var F;return((F=T.latestDocument)==null?void 0:F.imei)===s.imei});b(y)}},[s]),f.useEffect(()=>{const y=xe([w.lng,w.lat]),T=new ge(y,g),F=new re(T);Fe(F);const R=new re(new he(y));je(R);const M=I.map(Y=>xe([Y.lng,Y.lat])),N=new Vs([M]),K=new re(N);te(K);const W=new Ge({source:E,style:new ye({fill:new Ce({color:"rgba(255, 0, 0, 0.2)"}),stroke:new Ie({color:"#ff0000",width:2}),image:new Re({radius:7,fill:new Ce({color:"#ff0000"})})})}),H=new zs({target:He.current,layers:[new Us({source:new qs}),W],view:new Xs({center:y,zoom:5})}),ae=new Le({source:E,style:new ye({image:new Re({radius:5,fill:new Ce({color:"rgba(0, 0, 255, 0.7)"}),stroke:new Ie({color:"#fff",width:2})})})});H.addInteraction(ae);const J=new Ys({condition:Ws});H.addInteraction(J),J.on("select",Y=>{Y.selected.forEach(pe=>{Y.mapBrowserEvent.originalEvent.shiftKey&&E.removeFeature(pe)})});const se=new Ot({features:J.getFeatures()});return H.addInteraction(se),h(H),()=>H.setTarget(null)},[w,g]);const Wt=y=>y.map(T=>T.map(F=>{const[R,M]=Pt(F);return{lat:M,lng:R}}));f.useEffect(()=>{if(o&&G){const y=new Ot({features:new le([G])});o.addInteraction(y);const T=new Le({source:E,style:new ye({image:new Re({radius:5,fill:new Ce({color:"rgba(0, 0, 255, 0.7)"}),stroke:new Ie({color:"#fff",width:2})})})});o.addInteraction(T),T.on("modifyend",F=>{const R=F.features.item(0);if(R.getGeometry().getType()==="Polygon"){const M=R.getGeometry().getCoordinates();console.log("Updated Polygon vertices:",M)}}),y.on("translateend",()=>{const F=G.getGeometry().getCoordinates();console.log("Updated Polygon vertices after drag:",F);const R=Wt(F);console.log("Updated Polygon vertices:",R[0]),X(R[0])})}if(o&&U&&V){const y=new Le({source:E});o.addInteraction(y),y.on("modifyend",T=>{T.features.getArray().forEach(R=>{const M=R.getGeometry();if(M instanceof ge){const N=M.getRadius();m(N)}else if(M instanceof he){const N=M.getCoordinates();let K=Pt(N),W={lat:K[1],lng:K[0]};z(W),V.getGeometry().setCenter(N)}})})}},[o,G,V,U,E]),f.useEffect(()=>{o&&V&&j==="circular"&&(E.clear(),E.addFeature(V),E.addFeature(U)),o&&G&&j==="polygon"&&(E.clear(),E.addFeature(G))},[o,V,U,G,E]),f.useEffect(()=>{if(o&&j==="circular"&&V){const y=V.getGeometry().getCenter();o.getView().setCenter(y),o.getView().setZoom(15)}else if(o&&j==="polygon"&&G){const y=G.getGeometry();if(y){const T=y.getExtent();T.every(F=>F===1/0||F===-1/0)||o.getView().fit(T,{size:o.getSize(),maxZoom:15})}}},[o,j,V,G]),f.useEffect(()=>{var y,T,F,R;if((A==null?void 0:A.length)>0){const M=(T=(y=A[0])==null?void 0:y.latestDocument)==null?void 0:T.lat,N=(R=(F=A[0])==null?void 0:F.latestDocument)==null?void 0:R.lng;if(M&&N){const K=xe([N,M]),W=new re({geometry:new he(K)}),H=new ye({image:new Hs({anchor:[.5,1],src:"https://openlayers.org/en/latest/examples/data/icon.png"})});W.setStyle(H);const ae=new Ne({features:[W]}),J=new Ge({source:ae});Pe.current&&o.removeLayer(Pe.current),o.addLayer(J),Pe.current=J,o.on("click",se=>{o.forEachFeatureAtPixel(se.pixel,Y=>{Y===W&&se.stopPropagation()})})}}},[A,o]);const Ht=async()=>{var y,T,F,R,M,N,K,W,H,ae,J,se,Y,pe,$e,Ke,Je,Qe,Ze,et,tt,st,nt,it,rt,ot,at,lt,ct,dt,ht,ut,gt,ft,pt;if(Object.keys(s).length>0)try{const p=await Zt.get(`${t}/api/get/geofance/${s==null?void 0:s.imei}`);if(console.log(p.data.geofenceData,"result"),((T=(y=p==null?void 0:p.data)==null?void 0:y.geofenceData)==null?void 0:T.area_type)==="circular")if($("circular"),(R=(F=p==null?void 0:p.data)==null?void 0:F.geofenceData)!=null&&R.lat)z({lat:(N=(M=p==null?void 0:p.data)==null?void 0:M.geofenceData)==null?void 0:N.lat,lng:(W=(K=p==null?void 0:p.data)==null?void 0:K.geofenceData)==null?void 0:W.long}),m((ae=(H=p==null?void 0:p.data)==null?void 0:H.geofenceData)==null?void 0:ae.radius),x((se=(J=p==null?void 0:p.data)==null?void 0:J.geofenceData)==null?void 0:se.isActive_Geofance),v(((pe=(Y=p==null?void 0:p.data)==null?void 0:Y.geofenceData)==null?void 0:pe.type)==="inward"),O((Ke=($e=p==null?void 0:p.data)==null?void 0:$e.geofenceData)==null?void 0:Ke.isActive_Speed),B((Qe=(Je=p==null?void 0:p.data)==null?void 0:Je.geofenceData)==null?void 0:Qe.speed);else return ee.success("No Geofence For Selected Vehicle",{id:"getting geofence"});else((et=(Ze=p==null?void 0:p.data)==null?void 0:Ze.geofenceData)==null?void 0:et.area_type)==="polygon"&&($("polygon"),console.log("get for polygon",(tt=p==null?void 0:p.data)==null?void 0:tt.geofenceData),X((nt=(st=p==null?void 0:p.data)==null?void 0:st.geofenceData)==null?void 0:nt.polygon_points),B((rt=(it=p==null?void 0:p.data)==null?void 0:it.geofenceData)==null?void 0:rt.speed),x((at=(ot=p==null?void 0:p.data)==null?void 0:ot.geofenceData)==null?void 0:at.isActive_Geofance),v(((ct=(lt=p==null?void 0:p.data)==null?void 0:lt.geofenceData)==null?void 0:ct.type)==="inward"),z({lat:(ht=(dt=p==null?void 0:p.data)==null?void 0:dt.geofenceData)==null?void 0:ht.lat,lng:(gt=(ut=p==null?void 0:p.data)==null?void 0:ut.geofenceData)==null?void 0:gt.long}),O((pt=(ft=p==null?void 0:p.data)==null?void 0:ft.geofenceData)==null?void 0:pt.isActive_Speed))}catch(p){console.log(p,"error while getting geofence"),ee.error("Error while getting geofence",{id:"getting geofence"})}},Yt=()=>{if(Object.keys(s).length>0){let y;j==="circular"?y={imei:s.imei,area_type:j,type:_?"inward":"outward",lat:w.lat,long:w.lng,radius:g,isActive_Geofance:d,isActive_Speed:!!S,speed:S?k:5}:j==="polygon"&&(y={imei:s.imei,area_type:j,type:_?"inward":"outward",polygon_points:I,isActive_Geofance:d,isActive_Speed:!!S,speed:S?k:50},console.log("polygon payload",y)),Xt(es({data:y})),ee.success("Successful Saved",{id:"geofence"})}else ee.error("Please Select Vehicle",{id:"geofence"})},Ye=y=>{$(y==="circular"?"circular":"polygon"),E.clear(),y==="circular"&&V&&U?(E.addFeature(V),E.addFeature(U)):y==="Polygon"&&G&&E.addFeature(G)},$t=async y=>{if(y.preventDefault(),de.trim()==="")return;const F=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${de}`)).json();if(F.length>0){const{lon:R,lat:M}=F[0],N=xe([parseFloat(R),parseFloat(M)]);o.getView().animate({center:N,zoom:15})}};return i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{marginTop:"10px"},children:[i.jsx(Z,{onClick:()=>Ye("circular"),style:{background:j==="circular"?oe.bgColor:"transparent",color:j==="circular"?"white":we[400]},children:"Show Circle"}),i.jsx(Z,{onClick:()=>Ye("Polygon"),style:{background:j==="polygon"?oe.bgColor:"transparent",color:j==="polygon"?"white":we[400]},children:"Show Polygon"})]}),i.jsxs(C,{sx:{display:"flex",flexDirection:"row"},children:[i.jsxs(C,{component:"form",onSubmit:$t,border:"1px solid white",backgroundColor:"white",borderRadius:"3px",sx:{my:"6px",ml:"90px",position:"absolute",top:125,left:200,zIndex:1},children:[i.jsx(Ss,{sx:{my:.5,mx:2},placeholder:"Search Locations",value:de,onChange:y=>P(y.target.value)}),i.jsx(Se,{type:"submit",sx:{p:1},children:i.jsx(ws,{})})]}),i.jsx("div",{ref:He,style:{width:"100%",height:"85vh"}}),u&&!e&&!l&&w&&i.jsx(C,{sx:{width:c?"25%":"20%"},children:i.jsx(On,{shapeType:j,center:w,radius:g,active:d,setActive:x,setInward:v,inward:_,setSpeedLimit:O,speedLimit:S,setSpeedValue:B,handleGeofence:Yt,speedValue:k})})]})]})},Bn=({showMap:u,setShowMap:e,showGfBar:t,showGfAlert:s})=>{const{selectedVehicle:n}=D(l=>l.liveMap),{mode:r}=D(l=>l.dashboard),a=be(r);return i.jsx(i.Fragment,{children:u?i.jsx(Nn,{showGfBar:t,showGfAlert:s}):i.jsxs(C,{sx:{display:"flex",justifyContent:"space-between",background:a.grey[200],margin:"10px",padding:"10px",borderRadius:"8px"},children:[i.jsxs(C,{sx:{},children:[i.jsx(L,{sx:{fontWeight:"bold",fontSize:"16px",margin:"4px",color:a.grey[400]},children:"Vehicle Settings"}),i.jsxs(C,{sx:{display:"flex"},children:[i.jsx(C,{children:i.jsx("img",{src:Rn,alt:"tractorIcon",style:{width:"80px",height:"75px",borderRadius:"5px",marginRight:"20px"}})}),i.jsxs(C,{children:[i.jsx(L,{sx:{fontWeight:"bold",color:a.grey[400]},children:Object.keys(n).length>0?n==null?void 0:n.reg_id:"Reg No"}),i.jsx(L,{sx:{marginBottom:"5px",color:a.grey[400]},children:"Chassis No"}),i.jsxs(C,{sx:{width:"200px",display:"flex",gap:"8px"},children:[i.jsx(At,{placeholder:"ONLINE"}),i.jsx(At,{placeholder:"RUNNING"})]}),i.jsx(C,{sx:{marginLeft:"-8px",color:a.grey[400]},children:i.jsxs(L,{children:[i.jsx(_e,{})," ",i.jsx("b",{children:"Switched ON / OFF"})]})})]})]})]}),i.jsxs(C,{onClick:()=>{e(!u)},sx:{cursor:"pointer",marginTop:"50px"},children:[i.jsx("img",{src:Mn,alt:"tractorIcon",style:{width:"80px",height:"75px",borderRadius:"5px",marginRight:"20px"}}),i.jsx(L,{sx:{fontSize:"12px",color:a.grey[400]},children:"Set Geofence"})]})]})})};function ci(){const{w_customer_id:u}=D(S=>S.auth),{vehicleSideBar:e}=D(S=>S.geofence),{collapsed:t}=D(S=>S.auth),{mode:s}=D(S=>S.dashboard),n=be(s),[r,a]=f.useState([]);f.useState([]);const[l,c]=f.useState({user:!0,vehicle:!1}),[o,h]=f.useState(!1),[g,m]=f.useState(!1),[d,x]=f.useState(!1);let _=ve();f.useEffect(()=>{v()},[]);const v=async()=>{try{let S=[],O=[];const w=await _(ts({w_customer_id:u}));if(w.payload&&Array.isArray(w.payload)){w.payload.forEach(b=>{var k,B,j;b.imei&&Array.isArray(b.imei)&&b.imei.length>0&&((k=b.imei[0])!=null&&k.mac_id)?(S.push({id:b.id,label:b.registration_id,value:(B=b.imei[0])==null?void 0:B.mac_id}),O.push((j=b.imei[0])==null?void 0:j.mac_id)):(console.error("IMEI data not found for item:",b),ee.error(`IMEI Number not found for the vehicle: ${b==null?void 0:b.registration_id}`))});const z="one",A=O;O.length>0&&_(ss({type:z,imei:A})),a(S)}else console.error("Unexpected data format or empty payload:",w),ee.error("Unexpected data format:")}catch(S){console.error("Error fetching vehicle data:",S),ee.error(`Error fetching vehicle data: ${S}`)}};return i.jsxs("div",{className:"app",children:[i.jsx(us,{}),i.jsxs("main",{className:"content",style:{width:"100%",background:n.grey[100]},children:[i.jsx(Pn,{title:"Settings",setShowContent:c,showContent:l,showMap:o,setShowMap:h,showGfBar:g,setShowGfBar:m,showGfAlert:d,setShowGfAlert:x}),i.jsxs(C,{style:{display:"flex",width:"100%",height:"95vh"},children:[i.jsx(C,{style:{width:e?"80%":"100%"},children:l.user?i.jsx(In,{}):i.jsx(Bn,{showMap:o,setShowMap:h,showGfBar:g,showGfAlert:d})}),!d&&!g&&e&&i.jsx(C,{style:{width:"20%"},children:i.jsx(ps,{vehicleData:r,title:"Setting"})}),d&&!g&&!e&&i.jsx(C,{sx:{width:t?"25%":"20%"},children:i.jsx(ms,{})})]})]})]})}export{ci as default};
