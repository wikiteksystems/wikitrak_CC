import{J as Me,L as be,M as ve,w as he,r as a,N as Ce,D as ke,j as e,E as Ae,I as Te,a as Y,t as De,T as F,P as q,u as ue,ag as Pe,a5 as Fe,_ as U,ah as pe,ai as Ie,aj as Le,X as de,c as K,W as xe,ak as Ee,al as Ye,$ as fe,a0 as me,l as Re,m as Ne}from"./index-DBWZCl7Q.js";import{L as _e}from"./LightModeOutlined-CB8EUrg1.js";import{L as Oe}from"./LiveMapTopBar-PMHJcyFr.js";import{V as Be}from"./VehicleMenu-CmPeuRmZ.js";import{P as we,a as ge,u as Ve,G as We,b as Ue}from"./esm-CVVy79IH.js";import"./index-fqJ5DMof.js";import{t as He}from"./3W-fvB8OITn.js";import{m as je}from"./ol-Y6Emmta9.js";import{f as ze}from"./preet_tractor-Do6VJBqw.js";import{T as $e}from"./TripGraph-C_fxFoSS.js";import{B as S,C as Se}from"./CircularProgress-DJ2u2Psz.js";import{D as Ge,d as qe,a as Ke}from"./ArrowForwardIos-DYrVPgRo.js";import{t as ye}from"./RegionSelector-BzFE1OYU.js";import{M as Xe}from"./Modal-bYEP_E6M.js";import{C as Je}from"./Card-Dffkj474.js";import{C as Qe}from"./CardContent-BHeNTfY0.js";import"./proj-XQwXs9DQ.js";import"./createSvgIcon-CxYJqkE4.js";import"./IconButton-BKGS5OcY.js";import"./jcb-aCHXMCXy.js";import"./index-DEf4ov0-.js";import"./index-wjMyRLKB.js";import"./OutlinedInput-DowbVwHu.js";import"./Paper-s-nYMkLn.js";function Ze(n){return Me("MuiCardActions",n)}be("MuiCardActions",["root","spacing"]);const et=["disableSpacing","className"],tt=n=>{const{classes:w,disableSpacing:y}=n;return Te({root:["root",!y&&"spacing"]},Ze,w)},st=ve("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(n,w)=>{const{ownerState:y}=n;return[w.root,!y.disableSpacing&&w.spacing]}})(({ownerState:n})=>he({display:"flex",alignItems:"center",padding:8},!n.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),ot=a.forwardRef(function(w,y){const j=Ce({props:w,name:"MuiCardActions"}),{disableSpacing:x=!1,className:v}=j,M=ke(j,et),k=he({},j,{disableSpacing:x}),A=tt(k);return e.jsx(st,he({className:Ae(A.root,v),ownerState:k,ref:y},M))}),nt=ot;function at({trip:n,tripPlay:w,setTripPlay:y,setSpeed:j}){const[x,v]=a.useState([]),[M,k]=a.useState(0),[A,t]=a.useState([]),[P,T]=a.useState([null]),G=a.useRef(null),{selectedVehicle:m}=Y(p=>p.liveMap),{vehicles_details:R}=Y(p=>p.dashboard),[I,d]=a.useState("2W");a.useEffect(()=>{T([null]);const p=[];if(n&&n.length>0&&(n==null||n.forEach(c=>{p.push(c.speed.toFixed(2))}),t(p)),n&&n.length>0){const c=n.map(b=>({lat:parseFloat(b.lat),lng:parseFloat(b.lng)}));v(c),T(c.slice(0))}},[n]),a.useEffect(()=>{if(w){const p=x.length,c=9e3,b=1e4,O=performance.now();let W=0;const B=X=>{const J=X-O,Q=Math.max(0,Math.min(J/c,1)),H=Math.min(Math.floor(Q*p),p-1);H!==G.current&&(k(H),j(A[H]),G.current=H),W<b&&(requestAnimationFrame(B),W++)};return requestAnimationFrame(B),()=>{}}},[w,x,A]);const L=p=>{const c=R&&R.length>0&&R.find(b=>b.value===p&&b.vehilce_type);return c?c.vehilce_type:null};a.useEffect(()=>{if(Object.keys(m).length>0){const p=L(m.imei);d(p)}},[m]);const N=a.useMemo(()=>{var p,c;return{lat:parseFloat((p=x[M])==null?void 0:p.lat),lng:parseFloat((c=x[M])==null?void 0:c.lng)}},[x,M]),_=a.useMemo(()=>({url:(()=>{switch(I){case"2W":return je;case"3W":return He;case"4W":return ze;default:return je}})(),size:new window.google.maps.Size(80,80),scaledSize:new window.google.maps.Size(80,80),fillOpacity:2,strokeWeight:1,scale:2}),[I]);return e.jsxs("div",{children:[P.length>0&&e.jsx(e.Fragment,{children:e.jsx(we,{path:P,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4}})}),w&&e.jsxs(e.Fragment,{children:[e.jsx(we,{path:x.slice(0,M+1),options:{strokeColor:"green",strokeOpacity:1,strokeWeight:4,zIndex:1e3,geodesic:!0}}),e.jsx(ge,{position:N,icon:_},M)]})]})}function rt({tripPlay:n,speed:w,totalDistance:y,Acreage:j,filterCoordinates:x,handleTrip:v,showGraph:M,handleShowGraph:k}){return e.jsxs(S,{sx:{bgcolor:De.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",gap:"5px",paddingLeft:"5px",padding:"10px 10px"},children:[e.jsxs(S,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px",width:"150px",display:"flex",justifyContent:"space-evenly"},children:[e.jsx(F,{children:"Speed"}),e.jsxs(F,{children:[n?w:0," KM/H"]})]}),e.jsxs(F,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px"},children:["Total-Distance ",y," KM"]}),e.jsxs(F,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:[parseFloat(j).toFixed(2)," acre"]}),e.jsxs(q,{sx:{background:"white",border:"1px solid white",borderRadius:"5px",padding:"5px 20px",color:"black"},onClick:()=>{x()},children:[" ","Calculate Acerage"]}),e.jsxs(q,{sx:{background:n?"transparent":"white",border:"1px solid white",borderRadius:"5px",height:"38px",padding:"5px 20px",color:n?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{v()},children:[n?"Pause":"Play","-Trip"]}),e.jsxs(q,{style:{height:"38px",padding:"5px 20px"},sx:{background:M?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:M?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{k()},children:[M?"Hide":"Show","-Graph"]})]})}const it=({selectedTrip:n,center:w,showCard:y})=>{var Z,ee;const j=ue(),{isLoaded:x,loadError:v}=Ve({googleMapsApiKey:"AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA"}),{Acreage:M}=Y(s=>s.tripMonitor);Y(s=>s.liveMap);const{singleTrip_Data:k,tripLoading:A}=Y(s=>s.tripMonitor),{selectedTripData:t,mode:P,styles:T}=Y(s=>s.dashboard),G=a.useRef(null),[m,R]=a.useState(null),[I,d]=a.useState(null),[L,N]=a.useState([]);a.useState([]);const[_,p]=a.useState(!1),[c,b]=a.useState(0),[O,W]=a.useState(!1),[B,X]=a.useState(0),[J,Q]=a.useState([]),[H,re]=a.useState([]);a.useState([]),a.useEffect(()=>{m&&I&&m.fitBounds(I)},[m,I,t]),a.useEffect(()=>{if(console.log("selectedTripData",t),(t==null?void 0:t.length)>0){const s=ie({selectedTripData:t});X(s)}},[t]);const ie=({selectedTripData:s})=>{const h=s.reduce((r,l,i)=>{if(i===0)return r;const f=s[i-1],u=Pe(f.lat,f.lng,l.lat,l.lng);return r+u},0);return h==null?void 0:h.toFixed(2)};a.useEffect(()=>{var s,h,r,l,i;if(t&&(t==null?void 0:t.length)>0){const f=new window.google.maps.LatLngBounds,u=new window.google.maps.LatLng(parseFloat((s=t[0])==null?void 0:s.lat),parseFloat((h=t[0])==null?void 0:h.lng)),C=new window.google.maps.LatLng(parseFloat((r=t[(t==null?void 0:t.length)-1])==null?void 0:r.lat),parseFloat((l=t[(t==null?void 0:t.length)-1])==null?void 0:l.lng));f.extend(u),f.extend(C),b((i=t[0])==null?void 0:i.speed),d(f)}p(!1),te()},[t]);const te=()=>{if(t&&t.length>0){const s=(l,i)=>{const u=new Date(l.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:l.createdAt.substring(0,10),Time:u,value:l[i]}},r=["speed","mainInputVoltage","ignition"].map(l=>({label:l==="speed"?"Speed":l==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:se(),data:t.map(i=>s(i,l))}));N(r)}else N([])},se=()=>"#"+Math.floor(Math.random()*16777215).toString(16),oe=()=>{var s;if((t==null?void 0:t.length)>0)p(!_),b(0);else return((s=Object.keys(t))==null?void 0:s.length)===0?U.error("Please Select Vehicle",{id:"vehicle"}):U.error("Please Select Trip",{id:"trip error"})},ne=()=>{var s;if((t==null?void 0:t.length)>0)W(!O);else return((s=Object.keys(t))==null?void 0:s.length)===0?U.error("Please Select Vehicle",{id:"vehicle"}):U.error("Please Select Trip",{id:"trip error"})};if(v)return"Error loading maps";if(!x)return"Loading maps";const o={width:"100%",height:y?"87vh":"93vh"},g=s=>{if(!window.google||!window.google.maps.geometry){console.log("not loaded");return}const r=window.google.maps.geometry.spherical.computeArea(s.getPath())/4046.86;j(pe(r))},D=()=>{const r=[];t.length>0&&t.map((i,f)=>{let u={latitude:i.lat,longitude:i.lng},C=[];t.map(E=>{const $={latitude:E.lat,longitude:E.lng};if($.latitude!==u.latitude&&$.longitude!==u.longitude){const ce=ae(i.lat,i.lng,E.lat,E.lng);ce<20&&ce>10&&C.push(E)}}),C.length>10&&r.push(i)});const l=r.map(i=>({lat:parseFloat(i.lat),lng:parseFloat(i.lng)}));if(r&&r.length>0){re(r);const i=le(l),f=V(i),u=new window.google.maps.Polygon({paths:f});g(u)}else j(pe(0))},V=s=>{s.sort((l,i)=>l.lng-i.lng||l.lat-i.lat);const h=[],r=[];for(const l of s){for(;h.length>=2&&z(h[h.length-2],h[h.length-1],l)<=0;)h.pop();h.push(l)}for(let l=s.length-1;l>=0;l--){const i=s[l];for(;r.length>=2&&z(r[r.length-2],r[r.length-1],i)<=0;)r.pop();r.push(i)}return[...h.slice(0,-1),...r.slice(0,-1)]},z=(s,h,r)=>(h.lat-s.lat)*(r.lng-s.lng)-(h.lng-s.lng)*(r.lat-s.lat),le=s=>{const h=(u,C,E)=>{const $=(C.lat-u.lat)*(E.lng-C.lng)-(C.lng-u.lng)*(E.lat-C.lat);return $===0?0:$>0?1:2},r=s.reduce((u,C)=>C.lng<u.lng?C:u);let l=[],i=r,f;do{l.push(i),f=s[0]===i?s[1]:s[0];for(let u=0;u<s.length;u++)h(i,f,s[u])===2&&(f=s[u]);i=f}while(i!==r);return l};function ae(s,h,r,l){const f=s*Math.PI/180,u=r*Math.PI/180,C=(r-s)*Math.PI/180,E=(l-h)*Math.PI/180,$=Math.sin(C/2)*Math.sin(C/2)+Math.cos(f)*Math.cos(u)*Math.sin(E/2)*Math.sin(E/2);return 6371e3*(2*Math.atan2(Math.sqrt($),Math.sqrt(1-$)))}return e.jsxs(e.Fragment,{children:[A&&e.jsx(S,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:e.jsx(Se,{})}),y&&e.jsx(rt,{tripPlay:_,speed:c,totalDistance:B,Acreage:M,filterCoordinates:D,handleTrip:oe,showGraph:O,handleShowGraph:ne}),e.jsxs(We,{ref:G,mapContainerStyle:o,zoom:10,center:w,onLoad:s=>R(s),options:{styles:P?T:""},children:[e.jsx(Ue,{paths:J,options:{fillColor:"#00FF00",fillOpacity:.4,strokeColor:"#000",strokeOpacity:1,strokeWeight:2}}),t&&(t==null?void 0:t.length)>0&&(t==null?void 0:t.map((s,h)=>{var r,l,i,f;return e.jsxs(Fe.Fragment,{children:[e.jsx(ge,{position:{lat:parseFloat((r=t[0])==null?void 0:r.lat),lng:parseFloat((l=t[0])==null?void 0:l.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}}),e.jsx(at,{trip:t,tripPlay:_,setTripPlay:p,setSpeed:b}),e.jsx(ge,{position:{lat:parseFloat((i=t[(t==null?void 0:t.length)-1])==null?void 0:i.lat),lng:parseFloat((f=t[(t==null?void 0:t.length)-1])==null?void 0:f.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}})]},h)})),e.jsx("div",{style:{position:"relative",top:320,left:15,color:"green"},children:((ee=(Z=L[0])==null?void 0:Z.data)==null?void 0:ee.length)>0&&O&&e.jsx($e,{item:L})})]})]})},lt=it,ct=()=>{var te,se,oe,ne;const n=ue(),{tripList:w,selectedTripData:y,loading:j,trips:x,activeIndex:v,searchText:M,mode:k,isNavigate:A,allTripList:t,trip_payload:P,page:T}=Y(o=>o.dashboard),{selectedVehicle:G}=Y(o=>o.liveMap),m=ye(k),[R,I]=a.useState(!1),[d,L]=a.useState({}),[N,_]=a.useState(""),[p,c]=a.useState(0);a.useEffect(()=>{console.log("trips",x),(x==null?void 0:x.length)>0&&_(x[0])},[x]),a.useEffect(()=>{console.log("allTripList",t);const o=O(t);n(Ie(o))},[t]),a.useEffect(()=>{!(y.length>0)&&A&&v!==null&&B.length>0&&b(B[v])},[y,A]);const b=async o=>{var V;let g={imei:G.imei,startDate:o.startDate,endDate:o.endDate};const D=await Le(g);((V=D==null?void 0:D.data)==null?void 0:V.documents.length)>0?(n(A(!1)),n(de(D.data.documents[0].data))):(n(A(!1)),n(de([])))},O=o=>{const g=new Set,D=[];return o.forEach(V=>{const z=K(V.startTime).format("YYYY-MM-DD");g.has(z)||(g.add(z),D.push(z))}),D},W=(o,g)=>{n(xe(null)),n(Ee(o)),n(Ye(!1)),_(o),c(g)},B=t.filter(o=>K(o.startTime).format("YYYY-MM-DD")===N),X=async(o,g)=>{n(de(g.data)),n(xe(o)),n(pe(0))},J=o=>{L(o),I(!0)},Q=()=>{I(!1),L({})},H=o=>o?o.split(" ").slice(0,2).join(" "):"",re=async()=>{const o={...P,page:T+1};try{(await n(fe(o))).error?U.error("No Trip! within selected date"):n(me(T+1))}catch{U.error("No Trip! within selected date")}},ie=()=>{if(T<=1)return;const o={...P,page:T-1};n(me(T-1)),n(fe(o))};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsxs(S,{children:[e.jsx(S,{sx:{color:m.grey[400]},children:"Select Date"}),e.jsx(S,{sx:{mt:1},children:e.jsx(Ge,{})})]}),j?e.jsx("div",{style:{width:"100%",margin:"38%"},children:e.jsx(Se,{})}):e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsx(S,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:t&&(t==null?void 0:t.length)>0?e.jsx(e.Fragment,{children:x.map((o,g)=>e.jsx(S,{children:e.jsx(q,{onClick:()=>{W(o,g)},style:{backgroundColor:p===g?m.grey[300]:m.grey[200],color:p===g?"black":m.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:o})},g))}):e.jsx(F,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),e.jsxs(S,{sx:{height:"70vh",width:"100%",overflowY:"auto"},children:[e.jsxs(S,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(q,{disabled:T<=1,onClick:ie,children:e.jsx(qe,{})}),e.jsx(q,{disabled:!(P!=null&&P.imei),onClick:re,children:e.jsx(Ke,{})})]}),B&&B.length>0&&B.map((o,g)=>{var ae,Z,ee,s;const D=(Z=(ae=o==null?void 0:o.startLocation)==null?void 0:ae.address)==null?void 0:Z.address,V=(s=(ee=o==null?void 0:o.endLocation)==null?void 0:ee.address)==null?void 0:s.address,z=D?`${D.town||D.city||""}`:"",le=V?`${V.town||V.city||""}`:"";return e.jsxs(S,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:v===g?"black":m.grey[400],backgroundColor:v===g?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:k?m.grey[300]:m.grey[200]}},onClick:()=>X(g,o),children:[e.jsxs(F,{sx:{cursor:"text"},children:[g+1,". ",H(z)," to"," ",H(le)," "]}),e.jsxs(F,{children:[o!=null&&o.startTime?K(new Date(o.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",o!=null&&o.endTime?K(new Date(o.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",e.jsx("span",{style:{color:k?"orange":"blue",cursor:"pointer"},onClick:h=>{h.stopPropagation(),J(o)},children:"...see more"})]})]},g)})]})]})]}),e.jsx(Xe,{open:R,onClose:Q,children:e.jsxs(Je,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[e.jsxs(Qe,{children:[e.jsx(F,{variant:"h6",component:"div",children:"Trip Details"}),e.jsxs(F,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Location:"})," ",((se=(te=d==null?void 0:d.startLocation)==null?void 0:te.address)==null?void 0:se.display_name)||"N/A"]}),e.jsxs(F,{sx:{mt:2},children:[e.jsx("strong",{children:"End Location:"})," ",((ne=(oe=d==null?void 0:d.endLocation)==null?void 0:oe.address)==null?void 0:ne.display_name)||"N/A"]}),e.jsxs(F,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Time:"})," ",d!=null&&d.startTime?K(new Date(d.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),e.jsxs(F,{sx:{mt:2},children:[e.jsx("strong",{children:"End Time:"})," ",d!=null&&d.endTime?K(new Date(d.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),e.jsx(nt,{children:e.jsx(q,{onClick:Q,children:"Close"})})]})})]})},dt=ct;function Rt(){const{w_customer_id:n}=Y(d=>d.auth),{collapsed:w}=Y(d=>d.auth),{mode:y}=Y(d=>d.dashboard),[j,x]=a.useState(!1),[v,M]=a.useState(!0),[k,A]=a.useState([]),[t,P]=a.useState(!1);a.useState([]);const[T,G]=a.useState({lat:18.516726,lng:73.856255});a.useState([]);const m=ye(y);let R=ue();a.useEffect(()=>{I()},[]);const I=async()=>{try{let d=[],L=[];const N=await R(Re({w_customer_id:n}));if(Array.isArray(N.payload)){N.payload.forEach(c=>{var b,O,W;Array.isArray(c.imei)&&c.imei.length>0&&((b=c.imei[0])!=null&&b.mac_id)?(d.push({id:c.id,label:c.registration_id,value:(O=c.imei[0])==null?void 0:O.mac_id,workShop:c==null?void 0:c.workshop}),L.push((W=c.imei[0])==null?void 0:W.mac_id)):(console.error("IMEI data not found for item:",c),U.error(`IMEI Number not found for the vehicle: ${c==null?void 0:c.registration_id}`))});const _="one",p=L;L.length>0&&R(Ne({type:_,imei:p})),A(d)}else console.error("Unexpected data format:",N),U.error("Unexpected data format:")}catch(d){console.error("Error fetching vehicle data:",d),U.error(`Error fetching vehicle data: ${d}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(_e,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Oe,{title:"Trip Monitor",setShowVehicles:x,showVehicles:j,setShowCard:M,showCard:v,sideBarTrip:t,setSideBarTrip:P}),e.jsxs(S,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(S,{style:{width:j||t?"80%":"100%"},children:e.jsx(lt,{center:T,showCard:v})}),j&&e.jsx(S,{style:{width:"20%",backgroundColor:m.grey[100]},children:e.jsx(Be,{vehicleData:k,title:"Live Monitor"})}),e.jsx(S,{style:{width:w?"22%":"20%",display:t?"block":"none",backgroundColor:m.grey[100]},children:e.jsx(dt,{})})]})]})]})}export{Rt as default};
