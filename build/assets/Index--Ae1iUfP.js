import{r as o,k as x,i as L,$,aW as J,q as I,j as e,B as M,aX as U,aY as X,t as K,I as Q,a9 as Z,aa as ee,P as N,D as te,E as ae,G as re}from"./index-DA-fjRqR.js";import{V as se}from"./VehicleMenu-FpRlI7vB.js";import{b as oe,c as le,w as ie,e as ne,f as ce,L as de,t as he}from"./LeftSideBar2-DaGkUiGB.js";import"./Loader-N8_fzJRU.js";import"./LiveMapServices-bP9c2Qe3.js";import"./Socket-0N_gnJcr.js";import{P as pe}from"./Parameters-BZZGK9eF.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as ue,A as me,D as R,S as xe}from"./ServiceRecordTable-CS3SJNUt.js";import{u as ge}from"./formik.esm-BO8GQ_8_.js";import{c as fe,a as V,f as G,e as ve}from"./index.esm-VPIWckVS.js";import{T as y,M as Y}from"./TextField-zr6ri_E8.js";import{B as n,M as _e}from"./menu2-BDIsDF75.js";import{T as ye}from"./index-maAl6mxt.js";import"./createSvgIcon-BAXyJ0N0.js";import"./useControlled-CzTOGtF5.js";import"./index-CuBNweDq.js";import"./Card-Bf0AsLK2.js";import"./Skeleton-C6MO0gOU.js";import"./CardContent-CUEzpH0r.js";import"./dayjs.min-BcVWuZ_n.js";import"./customParseFormat-15GXy6fI.js";import"./useMediaQuery-DlubLbG1.js";import"./TablePagination-Cpj8ucqS.js";import"./TableCell-BhEqFquR.js";import"./Autocomplete-B9pJrn-T.js";import"./Checkbox-fQEf7pRX.js";import"./SwitchBase-CECDD9xN.js";import"./FormControlLabel-DYbNw3A6.js";const je=({setOpen:i})=>{const[h,j]=o.useState(null),{vehicleList:g}=x(a=>a.liveMap),{vendorList:b,segMentList:D}=x(a=>a.services),T=L(),[q,B]=o.useState([]),[p,f]=o.useState([]),t=ge({initialValues:{vehicle:"",vendor:"",priority_class:"",completion_date:null,next_due_date:null,chassis_no:"",odometer:"",attachment:null,status:"Pending"},validationSchema:fe().shape({vehicle:V().required("Vehicle is required"),vendor:V().required("Vendor is required"),priority_class:V().required("Priority class is required"),completion_date:G().nullable().required("Completion date is required"),next_due_date:G().nullable().required("Next due date is required"),chassis_no:V().required("Chassis number is required"),odometer:V().required("Odometer is required"),attachment:ve().nullable().required("Attachment is required")}),onSubmit:async a=>{const s=new FormData;s.append("vehicle",a.vehicle),s.append("segment",a.vendor),s.append("priority_class",a.priority_class),s.append("completion_date",$(new Date(a.completion_date)).format("YYYY-MM-DD")),s.append("next_due_date",$(new Date(a.next_due_date)).format("YYYY-MM-DD")),s.append("chassis_no",a.chassis_no),s.append("odometer",a.odometer),s.append("attachment",h),s.append("status",a.status),s.append("user",JSON.parse(localStorage.getItem("w_userDetails")).user_id),console.log("form data",a),(await T(J(s))).payload&&(I.success("Service created successfully"),t.resetForm(),j(null),i(!1))}}),d=a=>{const s=a.target.files[0];j(s),t.setFieldValue("attachment",s)},v=["On Time","Over Due","Emergency"];o.useEffect(()=>{let a=g.map(s=>({label:s.registration_id,value:s.id}));B(a)},[g]),o.useEffect(()=>{let a=D.map(s=>({label:s.segment_name,value:s.id}));f(a)},[D]);const S={PaperProps:{style:{maxHeight:300,overflowY:"auto"}}};return e.jsx(ue,{dateAdapter:me,children:e.jsxs("form",{onSubmit:t.handleSubmit,style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx(y,{select:!0,name:"vehicle",label:"Select Vehicle",value:t.values.vehicle,onChange:t.handleChange,error:t.touched.vehicle&&!!t.errors.vehicle,helperText:t.touched.vehicle&&t.errors.vehicle,SelectProps:{MenuProps:S},children:q.map(a=>e.jsx(Y,{value:a.value,children:a.label},a.value))}),e.jsx(y,{select:!0,name:"vendor",label:"Select segment",value:t.values.vendor,onChange:t.handleChange,error:t.touched.vendor&&!!t.errors.vendor,helperText:t.touched.vendor&&t.errors.vendor,children:p&&p.length>0&&p.map(a=>e.jsx(Y,{value:a.value,children:a.label},a.value))}),e.jsx(y,{select:!0,name:"priority_class",label:"Priority Class",value:t.values.priority_class,onChange:t.handleChange,error:t.touched.priority_class&&!!t.errors.priority_class,helperText:t.touched.priority_class&&t.errors.priority_class,children:v.map(a=>e.jsx(Y,{value:a,children:a},a))}),e.jsx(R,{label:"Completion Date",value:t.values.completion_date,onChange:a=>t.setFieldValue("completion_date",a),renderInput:a=>e.jsx(y,{...a,error:t.touched.completion_date&&!!t.errors.completion_date,helperText:t.touched.completion_date&&t.errors.completion_date})}),e.jsx(R,{label:"Next Due Date",value:t.values.next_due_date,onChange:a=>t.setFieldValue("next_due_date",a),renderInput:a=>e.jsx(y,{...a,error:t.touched.next_due_date&&!!t.errors.next_due_date,helperText:t.touched.next_due_date&&t.errors.next_due_date})}),e.jsx(y,{name:"chassis_no",label:"Chassis Number",value:t.values.chassis_no,onChange:t.handleChange,error:t.touched.chassis_no&&!!t.errors.chassis_no,helperText:t.touched.chassis_no&&t.errors.chassis_no}),e.jsx(y,{name:"odometer",label:"Odometer",value:t.values.odometer,onChange:t.handleChange,error:t.touched.odometer&&!!t.errors.odometer,helperText:t.touched.odometer&&t.errors.odometer}),e.jsxs(n,{children:[e.jsx("input",{type:"file",name:"attachment",onChange:d}),t.touched.attachment&&t.errors.attachment&&e.jsx("div",{style:{color:"red"},children:t.errors.attachment})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[e.jsx(M,{type:"submit",variant:"contained",color:"primary",sx:{mr:2},children:"Save"}),e.jsx(M,{variant:"outlined",onClick:()=>i(!1),children:"Cancel"})]})]})})},be={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid black",borderRadius:"5px",boxShadow:24,p:4,height:"600px",overflowY:"auto",scrollbarWidth:"50%"};function Se(){const[i,h]=o.useState(!1);L();const j=()=>h(!0),g=()=>h(!1);return e.jsxs("div",{children:[e.jsx(M,{variant:"outlined",onClick:j,children:"+ Add New Entry"}),e.jsx(_e,{open:i,onClose:g,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",BackdropProps:{onClick:b=>b.stopPropagation()},children:e.jsx(n,{sx:be,children:e.jsx(je,{setOpen:h})})})]})}const we=()=>{const i=L();return o.useEffect(()=>{i(U()),i(X())},[]),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(Se,{})})]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(xe,{})})]})]})},Ce=we;function De({title:i,showVehicles:h,setShowVehicles:j,setShowParameters:g,showParameters:b,setShowCard:D,showCard:T,setSideBarTrip:q,sideBarTrip:B,setShowVehiclesGroup:p,showVehiclesGroup:f}){const t=L(),{collapsed:d}=x(u=>u.auth);x(u=>u.liveMap),JSON.parse(localStorage.getItem("w_userDetails"));const{mode:v,selectedVehicleGroup:S}=x(u=>u.dashboard),a=()=>{t(ee(!d))},s={fontSize:"26px",fontWeight:500,lineHeight:"18.38px",color:"#fff",textAlign:"center",paddingTop:"5px",fontFamily:"ubuntu"};return e.jsxs(n,{style:{display:"flex",justifyContent:"space-between",paddingRight:"20px",backgroundColor:K.bgColor,alignItems:"center",textAlign:"center",height:"60px",color:"white"},children:[e.jsxs(n,{style:{display:"flex",justifyContent:"space-between",gap:"10px",alignItems:"center",width:"50%"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[d?e.jsx(M,{onClick:a,sx:{color:"white"},children:e.jsx(oe,{style:{width:"30px",height:"30px"}})}):e.jsx(M,{onClick:a,sx:{color:"white"},children:e.jsx(le,{style:{width:"30px",height:"30px"}})}),e.jsx("img",{src:ie,alt:"wikitrak logo"})]}),e.jsx(n,{children:e.jsx(ye,{style:s,children:i})})]}),e.jsx(n,{style:{display:"flex",gap:"5px"},children:e.jsx(Q,{onClick:()=>{t(Z(!v))},sx:{color:"white"},children:v?e.jsx(ne,{}):e.jsx(ce,{})})})]})}function rt(){const{locationData:i,selectedVehicle:h,selectedParameterList:j}=x(l=>l.liveMap),{mode:g}=x(l=>l.dashboard),b=he(g),[D,T]=o.useState([]),{w_customer_id:q}=x(l=>l.auth),[B,p]=o.useState(),[f,t]=o.useState(!1),[d,v]=o.useState(!1),[S,a]=o.useState([]),[s,u]=o.useState(!0),[W,E]=o.useState(!1);let P=L();o.useEffect(()=>{z()},[]),o.useEffect(()=>{a([]),P(N([{reg_id:"",imei:"",params:[]}]))},[h]);const z=async()=>{try{E(!0);let l=[],m=[];const w=await P(te({w_customer_id:q}));if(Array.isArray(w.payload)){w.payload.forEach(r=>{var C,_,O,c;Array.isArray(r.imei)&&r.imei.length>0&&((C=r.imei[0])!=null&&C.mac_id)?(l.push({id:r.id,label:r.registration_id,value:(_=r.imei[0])==null?void 0:_.mac_id,vehilce_type:r==null?void 0:r.segment,chassis_no:r==null?void 0:r.chassis_no,engine_no:r==null?void 0:r.engine_no,workShop:r==null?void 0:r.workshop,registration_id:r==null?void 0:r.registration_id,sell_date:r==null?void 0:r.sell_date,customer_name:r==null?void 0:r.customer_name,vehicle_model:(O=r==null?void 0:r.vehicle_model)==null?void 0:O.name}),m.push((c=r.imei[0])==null?void 0:c.mac_id)):(console.error("IMEI data not found for item:",r),I.error(`IMEI Number not found for the vehicle: ${r==null?void 0:r.registration_id}`))});const A="one",F=m;m.length>0&&P(ae({type:A,imei:F})),T(l),P(re(l)),E(!1)}else E(!1),console.error("Unexpected data format:",w),I.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),I.error(`Error fetching vehicle data: ${l}`)}},H=async l=>{const{label:m,imei:w,id:A,reg_id:F,checked:r}=l;p(c=>c.map(k=>k.id===A?{...k,checked:!r}:k));let C=[...S],_=[...S];if(!r)i.forEach(c=>{c.latestDocument.imei===w&&(C.push({label:m,value:c.latestDocument[m==="maininputvoltage"?"mainInputVoltage":m]}),_=C,a(C))});else{let c=S.filter(k=>k.label!==m);_=c,a(c)}console.log("tempParamList",_),P(N([{reg_id:F,imei:w,params:_}]))};return e.jsxs("div",{className:"app",children:[e.jsx(de,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(De,{title:"services",setShowVehicles:t,showVehicles:f,showParameters:d,setShowParameters:v,setShowCard:u,showCard:s}),e.jsxs(n,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(n,{style:{width:f||d?"80%":"100%"},children:e.jsx(Ce,{})}),f&&e.jsx(n,{style:{width:"20%",backgroundColor:b.grey[100]},children:e.jsx(se,{vehicleData:D,title:"Inspections",setParameterData:p,loadingVehicle:W,setShowVehicles:t,showVehicles:f,showParameters:d,setShowParameters:v})}),d&&e.jsx(n,{style:{width:"20%",backgroundColor:b.grey[100]},children:e.jsx(pe,{parametersData:B,setParameterData:p,handleParameterChange:H})})]})]})]})}export{rt as default};
