import{r as n,j as t,u as O,a as P,ae as oe,t as ae,T as B,P as G,a3 as ne,_ as E,X as re,Y as z,Z as _,c as W,$ as q,W as ie,l as le,m as ce}from"./index-DC0H0P0O.js";import{L as de}from"./LightModeOutlined-DKHIFgi4.js";import{L as he}from"./LiveMapTopBar-Bql4WVMd.js";import{V as pe}from"./VehicleMenu-CA6PBj6A.js";import{P as X,u as ge,G as ue,a as $}from"./esm-DGk6jRV0.js";import"./index-CAJkffy8.js";import{T as xe}from"./TripGraph-SJu69Q-h.js";import{B as p,C as K}from"./CircularProgress-DIEDOwos.js";import{D as fe}from"./DateTimePicker-CVM65ulY.js";import{t as H}from"./Search-CpzIG1qB.js";import"./createSvgIcon-B4UiCi_o.js";import"./IconButton-HGSK4y2F.js";import"./jcb-aCHXMCXy.js";import"./index-CN4N_6JM.js";import"./roundedArrow-BvOA1Fdj.js";import"./TextArea-DG-VGqmQ.js";import"./OutlinedInput-j_QbgfSR.js";import"./button-DBvLTIqH.js";function me({trip:r,tripPlay:g,setTripPlay:v,setSpeed:D}){const[f,S]=n.useState([]),[k,e]=n.useState(0),[C,u]=n.useState([]),[M,j]=n.useState([null]),F=n.useRef(null);return n.useEffect(()=>{j([null]);const c=[];if(r&&r.length>0&&(r==null||r.map(x=>{c.push(x.speed).toFixed(2)}),u(c)),r&&(r==null?void 0:r.length)>0){const x=r==null?void 0:r.map(s=>({lat:parseFloat(s.lat),lng:parseFloat(s.lng)}));S(x),j(x.slice(0))}},[r]),n.useEffect(()=>{if(g){const c=f.length,x=9e3,s=1e4,a=performance.now();let o=0;const l=w=>{const d=(w-a)/x,L=Math.min(Math.floor(d*c),c-1);L!==F.current&&(e(L),D(C[L]),F.current=L),o<s&&(requestAnimationFrame(l),o++)};return requestAnimationFrame(l),()=>{}}},[g]),t.jsxs("div",{children:[M.length>0&&t.jsx(t.Fragment,{children:t.jsx(X,{path:M,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4}})}),g&&t.jsx(X,{path:f.slice(0,k+1),options:{strokeColor:"green",strokeOpacity:1,strokeWeight:4,zIndex:1e3,geodesic:!0}})]})}const Se=({selectedTrip:r,center:g,showCard:v})=>{var N,U;O();const{isLoaded:D,loadError:f}=ge({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"});P(i=>i.liveMap);const{singleTrip_Data:S,tripLoading:k}=P(i=>i.tripMonitor),{selectedTripData:e,mode:C,styles:u}=P(i=>i.dashboard),M=n.useRef(null),[j,F]=n.useState(null),[c,x]=n.useState(null),[s,a]=n.useState([]);n.useState([]);const[o,l]=n.useState(!1),[w,I]=n.useState(0),[d,L]=n.useState(!1),[V,R]=n.useState(0);n.useEffect(()=>{j&&c&&j.fitBounds(c)},[j,c,e]),n.useEffect(()=>{if(console.log("selectedTripData",e),(e==null?void 0:e.length)>0){const i=Y({selectedTripData:e});R(i)}},[e]);const Y=({selectedTripData:i})=>{const T=i.reduce((y,h,m)=>{if(m===0)return y;const b=i[m-1],A=oe(b.lat,b.lng,h.lat,h.lng);return y+A},0);return T==null?void 0:T.toFixed(2)};n.useEffect(()=>{var i,T,y,h,m;if(e&&(e==null?void 0:e.length)>0){const b=new window.google.maps.LatLngBounds,A=new window.google.maps.LatLng(parseFloat((i=e[0])==null?void 0:i.lat),parseFloat((T=e[0])==null?void 0:T.lng)),se=new window.google.maps.LatLng(parseFloat((y=e[(e==null?void 0:e.length)-1])==null?void 0:y.lat),parseFloat((h=e[(e==null?void 0:e.length)-1])==null?void 0:h.lng));b.extend(A),b.extend(se),I((m=e[0])==null?void 0:m.speed),x(b)}l(!1),J()},[e]);const J=()=>{if(e&&e.length>0){const i=(h,m)=>{const A=new Date(h.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:h.createdAt.substring(0,10),Time:A,value:h[m]}},y=["speed","mainInputVoltage","ignition"].map(h=>({label:h==="speed"?"Speed":h==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:Q(),data:e.map(m=>i(m,h))}));a(y)}else a([])},Q=()=>"#"+Math.floor(Math.random()*16777215).toString(16),Z=()=>{var i;if((e==null?void 0:e.length)>0)l(!o),I(0);else return((i=Object.keys(e))==null?void 0:i.length)===0?E.error("Please Select Vehicle",{id:"vehicle"}):E.error("Please Select Trip",{id:"trip error"})},ee=()=>{var i;if((e==null?void 0:e.length)>0)L(!d);else return((i=Object.keys(e))==null?void 0:i.length)===0?E.error("Please Select Vehicle",{id:"vehicle"}):E.error("Please Select Trip",{id:"trip error"})};if(f)return"Error loading maps";if(!D)return"Loading maps";const te={width:"100%",height:v?"87vh":"93vh"};return t.jsxs(t.Fragment,{children:[k&&t.jsx(p,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:t.jsx(K,{})}),v&&t.jsxs(p,{sx:{bgcolor:ae.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"left",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",height:"60px",gap:"15px",paddingLeft:"30px"},children:[t.jsxs(B,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:["Speed ",w," KM/H"]}),t.jsxs(B,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:["Total-Distance ",V," KM"]}),t.jsxs(G,{style:{height:"38px",padding:"5px 20px"},sx:{background:o?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:o?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{Z()},children:[o?"Pause":"Play","-Trip"]}),t.jsxs(G,{style:{height:"38px",padding:"5px 20px"},sx:{background:d?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:d?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{ee()},children:[d?"Hide":"Show","-Graph"]})]}),t.jsxs(ue,{ref:M,mapContainerStyle:te,zoom:10,center:g,onLoad:i=>F(i),options:{styles:C?u:""},children:[e&&(e==null?void 0:e.length)>0&&(e==null?void 0:e.map((i,T)=>{var y,h,m,b;return t.jsxs(ne.Fragment,{children:[t.jsx($,{position:{lat:parseFloat((y=e[0])==null?void 0:y.lat),lng:parseFloat((h=e[0])==null?void 0:h.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}}),t.jsx(me,{trip:e,tripPlay:o,setTripPlay:l,setSpeed:I}),t.jsx($,{position:{lat:parseFloat((m=e[(e==null?void 0:e.length)-1])==null?void 0:m.lat),lng:parseFloat((b=e[(e==null?void 0:e.length)-1])==null?void 0:b.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}})]},T)})),t.jsx("div",{style:{position:"relative",top:320,left:15,color:"green"},children:((U=(N=s[0])==null?void 0:N.data)==null?void 0:U.length)>0&&d&&t.jsx(xe,{item:s})})]})]})},je=Se,we=()=>{const r=O(),{tripList:g,selectedTripData:v,loading:D,trips:f,activeIndex:S,searchText:k,mode:e}=P(s=>s.dashboard),{selectedVehicle:C}=P(s=>s.liveMap),u=H(e);n.useEffect(()=>{const s=j(g);r(re(s))},[g]),n.useEffect(()=>{console.log("selectedTripData",v),v.length>0||S!==null&&c.length>0&&(console.log("selected trip",c[S]),M(c[S]))},[v]);const M=async s=>{var l;let a={imei:C.imei,startDate:s.startDate,endDate:s.endDate};const o=await z(a);((l=o==null?void 0:o.data)==null?void 0:l.documents.length)>0?r(_(o.data.documents[0].data)):r(_([]))};n.useState(0);const j=s=>{const a=new Set,o=[];return s.forEach(l=>{a.has(l.formatedDate)||(a.add(l.formatedDate),o.push(l.formatedDate))}),o},F=s=>{r(q(null)),r(ie(s))},c=g&&g.length>0&&g.filter(s=>s.formatedDate.toLowerCase().includes(k.toLowerCase())),x=async(s,a)=>{var l;let o={imei:C.imei,startDate:a.startDate,endDate:a.endDate};if(console.log("payload",o),o&&(o!=null&&o.imei)&&(o!=null&&o.startDate)&&(o!=null&&o.endDate)){const w=await z(o);((l=w==null?void 0:w.data)==null?void 0:l.documents.length)>0?r(_(w.data.documents[0].data)):r(_([])),r(q(s))}else E.error("Something is missing start or end date.",{id:"getTrip"})};return t.jsx(t.Fragment,{children:t.jsxs(p,{children:[t.jsxs(p,{children:[t.jsx(p,{sx:{color:u.grey[400]},children:"Select Date"}),t.jsx(p,{sx:{mt:1},children:t.jsx(fe,{})})]}),D?t.jsx("div",{style:{width:"100%",margin:"38%"},children:t.jsx(K,{})}):t.jsxs(t.Fragment,{children:[t.jsx(p,{children:t.jsx(p,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:f&&(f==null?void 0:f.length)>0?f.map((s,a)=>t.jsx(p,{children:t.jsx(G,{onClick:()=>{F(s)},style:{backgroundColor:k===s?u.grey[300]:u.grey[200],color:k===s?"black":u.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:s})},a)):t.jsx(B,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),t.jsx(p,{children:c&&c.length>0&&c.map((s,a)=>t.jsxs(p,{sx:{m:"5px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:S===a?"black":u.grey[400],backgroundColor:S===a?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:"#e8edea"}},onClick:()=>x(a,s),children:[t.jsxs(B,{children:[a+1,". ",s.startLocation," to ",s.endLocation]}),t.jsxs(B,{children:[s!=null&&s.startDate?W(new Date(s.startDate).toISOString()).format("LT"):""," ","/"," ",s!=null&&s.endDate?W(new Date(s.endDate).toISOString()).format("LT"):"----"]})]}))})]})]})})},ye=we;function Oe(){const{w_customer_id:r}=P(a=>a.auth),{collapsed:g}=P(a=>a.auth),{mode:v}=P(a=>a.dashboard),[D,f]=n.useState(!1),[S,k]=n.useState(!0),[e,C]=n.useState([]),[u,M]=n.useState(!1);n.useState([]);const[j,F]=n.useState({lat:18.516726,lng:73.856255});n.useState([]);const c=H(v);let x=O();n.useEffect(()=>{s()},[]);const s=async()=>{try{let a=[],o=[];const l=await x(le({w_customer_id:r}));if(Array.isArray(l.payload)){l.payload.forEach(d=>{var L,V,R;Array.isArray(d.imei)&&d.imei.length>0&&((L=d.imei[0])!=null&&L.mac_id)?(a.push({id:d.id,label:d.registration_id,value:(V=d.imei[0])==null?void 0:V.mac_id}),o.push((R=d.imei[0])==null?void 0:R.mac_id)):(console.error("IMEI data not found for item:",d),E.error(`IMEI Number not found for the vehicle: ${d==null?void 0:d.registration_id}`))});const w="one",I=o;o.length>0&&x(ce({type:w,imei:I})),C(a)}else console.error("Unexpected data format:",l),E.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),E.error(`Error fetching vehicle data: ${a}`)}};return t.jsxs("div",{className:"app",children:[t.jsx(de,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(he,{title:"Trip Monitor",setShowVehicles:f,showVehicles:D,setShowCard:k,showCard:S,sideBarTrip:u,setSideBarTrip:M}),t.jsxs(p,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(p,{style:{width:D||u?"80%":"100%"},children:t.jsx(je,{center:j,showCard:S})}),D&&t.jsx(p,{style:{width:"20%",backgroundColor:c.grey[100]},children:t.jsx(pe,{vehicleData:e,title:"Live Monitor"})}),t.jsx(p,{style:{width:g?"22%":"20%",display:u?"block":"none",backgroundColor:c.grey[100]},children:t.jsx(ye,{})})]})]})]})}export{Oe as default};
