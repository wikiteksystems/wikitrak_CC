import{r as n,j as t,u as R,a as P,ae as oe,t as ne,T as B,O as A,a3 as ae,_ as E,W as re,X as _,Y as V,b as z,Z as N,V as ie,k as le,l as ce}from"./index-BcBTiKnT.js";import{L as de}from"./LightModeOutlined-B6yYETIB.js";import{L as he}from"./LiveMapTopBar-ChzW0Hoc.js";import{V as pe}from"./VehicleMenu-B5kuHT6o.js";import{P as W,u as ge,G as ue,a as U}from"./esm-CHRWsbox.js";import"./index-DCdKgBld.js";import{T as xe}from"./TripGraph-DjEH0DwQ.js";import{B as h,C as X}from"./CircularProgress--q65xyqu.js";import{D as fe}from"./DateTimePicker-CvTzXQWN.js";import{t as q}from"./theme-CBILhlCc.js";import"./createSvgIcon-DRcA-zqx.js";import"./IconButton-IR8ZPsRb.js";import"./Search-D455eVlK.js";import"./index-B-mvCjm2.js";import"./roundedArrow-qvHxGCr0.js";import"./TextArea-BQ4JdfSp.js";import"./button-BYbIgmdb.js";function me({trip:r,tripPlay:p,setTripPlay:k,setSpeed:D}){const[x,m]=n.useState([]),[L,e]=n.useState(0),[C,g]=n.useState([]),[I,j]=n.useState([null]),M=n.useRef(null);return n.useEffect(()=>{j([null]);const l=[];if(r&&r.length>0&&(r==null||r.map(u=>{l.push(u.speed).toFixed(2)}),g(l)),r&&(r==null?void 0:r.length)>0){const u=r==null?void 0:r.map(s=>({lat:parseFloat(s.lat),lng:parseFloat(s.lng)}));m(u),j(u.slice(0))}},[r]),n.useEffect(()=>{if(p){const l=x.length,u=9e3,s=1e4,a=u/s;let o=0;const c=setInterval(()=>{if(o<s){const w=o/s,S=Math.floor(w*l);S!==M.current&&(e(S),D(C[S]),M.current=S,console.log("speed",C[S])),o++}else clearInterval(c)},a);return()=>clearInterval(c)}},[p]),t.jsxs("div",{children:[I.length>0&&t.jsx(t.Fragment,{children:t.jsx(W,{path:I,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4}})}),p&&t.jsx(W,{path:x.slice(0,L+1),options:{strokeColor:"green",strokeOpacity:1,strokeWeight:4,zIndex:1e3,geodesic:!0}})]})}const Se=({selectedTrip:r,center:p,showCard:k})=>{var G,O;R();const{isLoaded:D,loadError:x}=ge({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"});P(i=>i.liveMap);const{singleTrip_Data:m,tripLoading:L}=P(i=>i.tripMonitor),{selectedTripData:e,mode:C,styles:g}=P(i=>i.dashboard),I=n.useRef(null),[j,M]=n.useState(null),[l,u]=n.useState(null),[s,a]=n.useState([]);n.useState([]);const[o,c]=n.useState(!1),[w,S]=n.useState(0),[y,K]=n.useState(!1),[H,Y]=n.useState(0);n.useEffect(()=>{j&&l&&j.fitBounds(l)},[j,l,e]),n.useEffect(()=>{if(console.log("selectedTripData",e),(e==null?void 0:e.length)>0){const i=$({selectedTripData:e});Y(i)}},[e]);const $=({selectedTripData:i})=>{const T=i.reduce((b,d,f)=>{if(f===0)return b;const v=i[f-1],F=oe(v.lat,v.lng,d.lat,d.lng);return b+F},0);return T==null?void 0:T.toFixed(2)};n.useEffect(()=>{var i,T,b,d,f;if(e&&(e==null?void 0:e.length)>0){const v=new window.google.maps.LatLngBounds,F=new window.google.maps.LatLng(parseFloat((i=e[0])==null?void 0:i.lat),parseFloat((T=e[0])==null?void 0:T.lng)),se=new window.google.maps.LatLng(parseFloat((b=e[(e==null?void 0:e.length)-1])==null?void 0:b.lat),parseFloat((d=e[(e==null?void 0:e.length)-1])==null?void 0:d.lng));v.extend(F),v.extend(se),S((f=e[0])==null?void 0:f.speed),u(v)}c(!1),J()},[e]);const J=()=>{if(e&&e.length>0){const i=(d,f)=>{const F=new Date(d.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:d.createdAt.substring(0,10),Time:F,value:d[f]}},b=["speed","mainInputVoltage","ignition"].map(d=>({label:d==="speed"?"Speed":d==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:Q(),data:e.map(f=>i(f,d))}));a(b)}else a([])},Q=()=>"#"+Math.floor(Math.random()*16777215).toString(16),Z=()=>{var i;if((e==null?void 0:e.length)>0)c(!o),S(0);else return((i=Object.keys(e))==null?void 0:i.length)===0?E.error("Please Select Vehicle",{id:"vehicle"}):E.error("Please Select Trip",{id:"trip error"})},ee=()=>{var i;if((e==null?void 0:e.length)>0)K(!y);else return((i=Object.keys(e))==null?void 0:i.length)===0?E.error("Please Select Vehicle",{id:"vehicle"}):E.error("Please Select Trip",{id:"trip error"})};if(x)return"Error loading maps";if(!D)return"Loading maps";const te={width:"100%",height:k?"87vh":"93vh"};return t.jsxs(t.Fragment,{children:[L&&t.jsx(h,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:t.jsx(X,{})}),k&&t.jsxs(h,{sx:{bgcolor:ne.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"left",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",height:"60px",gap:"15px",paddingLeft:"30px"},children:[t.jsxs(B,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:["Speed ",w," KM/H"]}),t.jsxs(B,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:["Total-Distance ",H," KM"]}),t.jsxs(A,{style:{height:"38px",padding:"5px 20px"},sx:{background:o?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:o?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{Z()},children:[o?"Pause":"Play","-Trip"]}),t.jsxs(A,{style:{height:"38px",padding:"5px 20px"},sx:{background:y?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:y?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{ee()},children:[y?"Hide":"Show","-Graph"]})]}),t.jsxs(ue,{ref:I,mapContainerStyle:te,zoom:10,center:p,onLoad:i=>M(i),options:{styles:C?g:""},children:[e&&(e==null?void 0:e.length)>0&&(e==null?void 0:e.map((i,T)=>{var b,d,f,v;return t.jsxs(ae.Fragment,{children:[t.jsx(U,{position:{lat:parseFloat((b=e[0])==null?void 0:b.lat),lng:parseFloat((d=e[0])==null?void 0:d.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}}),t.jsx(me,{trip:e,tripPlay:o,setTripPlay:c,setSpeed:S}),t.jsx(U,{position:{lat:parseFloat((f=e[(e==null?void 0:e.length)-1])==null?void 0:f.lat),lng:parseFloat((v=e[(e==null?void 0:e.length)-1])==null?void 0:v.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}})]},T)})),t.jsx("div",{style:{position:"relative",top:320,left:15,color:"green"},children:((O=(G=s[0])==null?void 0:G.data)==null?void 0:O.length)>0&&y&&t.jsx(xe,{item:s})})]})]})},je=Se,we=()=>{const r=R(),{tripList:p,selectedTripData:k,loading:D,trips:x,activeIndex:m,searchText:L,mode:e}=P(s=>s.dashboard),{selectedVehicle:C}=P(s=>s.liveMap),g=q(e);n.useEffect(()=>{const s=j(p);r(re(s))},[p]),n.useEffect(()=>{console.log("selectedTripData",k),k.length>0||m!==null&&l.length>0&&(console.log("selected trip",l[m]),I(l[m]))},[k]);const I=async s=>{var c;let a={imei:C.imei,startDate:s.startDate,endDate:s.endDate};const o=await _(a);((c=o==null?void 0:o.data)==null?void 0:c.documents.length)>0?r(V(o.data.documents[0].data)):r(V([]))};n.useState(0);const j=s=>{const a=new Set,o=[];return s.forEach(c=>{a.has(c.formatedDate)||(a.add(c.formatedDate),o.push(c.formatedDate))}),o},M=s=>{r(N(null)),r(ie(s))},l=p&&p.length>0&&p.filter(s=>s.formatedDate.toLowerCase().includes(L.toLowerCase())),u=async(s,a)=>{var c;let o={imei:C.imei,startDate:a.startDate,endDate:a.endDate};if(console.log("payload",o),o&&(o!=null&&o.imei)&&(o!=null&&o.startDate)&&(o!=null&&o.endDate)){const w=await _(o);((c=w==null?void 0:w.data)==null?void 0:c.documents.length)>0?r(V(w.data.documents[0].data)):r(V([])),r(N(s))}else E.error("Something is missing start or end date.",{id:"getTrip"})};return t.jsx(t.Fragment,{children:t.jsxs(h,{children:[t.jsxs(h,{children:[t.jsx(h,{sx:{color:g.grey[400]},children:"Select Date"}),t.jsx(h,{sx:{mt:1},children:t.jsx(fe,{})})]}),D?t.jsx("div",{style:{width:"100%",margin:"38%"},children:t.jsx(X,{})}):t.jsxs(t.Fragment,{children:[t.jsx(h,{children:t.jsx(h,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:x&&(x==null?void 0:x.length)>0?x.map((s,a)=>t.jsx(h,{children:t.jsx(A,{onClick:()=>{M(s)},style:{backgroundColor:L===s?g.grey[300]:g.grey[200],color:L===s?"black":g.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:s})},a)):t.jsx(B,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),t.jsx(h,{children:l&&l.length>0&&l.map((s,a)=>t.jsxs(h,{sx:{m:"5px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:m===a?"black":g.grey[400],backgroundColor:m===a?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:"#e8edea"}},onClick:()=>u(a,s),children:[t.jsxs(B,{children:[a+1,". ",s.startLocation," to ",s.endLocation]}),t.jsxs(B,{children:[s!=null&&s.startDate?z(new Date(s.startDate).toISOString()).format("LT"):""," ","/"," ",s!=null&&s.endDate?z(new Date(s.endDate).toISOString()).format("LT"):"----"]})]}))})]})]})})},ye=we;function Oe(){const{w_customer_id:r}=P(a=>a.auth),{collapsed:p}=P(a=>a.auth),{mode:k}=P(a=>a.dashboard),[D,x]=n.useState(!1),[m,L]=n.useState(!1),[e,C]=n.useState([]),[g,I]=n.useState(!1);n.useState([]);const[j,M]=n.useState({lat:18.516726,lng:73.856255});n.useState([]);const l=q(k);let u=R();n.useEffect(()=>{s()},[]);const s=async()=>{let a=[],o=[];(await u(le({w_customer_id:r}))).payload.map(y=>{a.push({id:y.id,label:y.registration_id,value:y.imei[0].mac_id}),o.push(y.imei[0].mac_id)});const w="one",S=o;o.length>0&&u(ce({type:w,imei:S})),C(a)};return t.jsxs("div",{className:"app",children:[t.jsx(de,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(he,{title:"Trip Monitor",setShowVehicles:x,showVehicles:D,setShowCard:L,showCard:m,sideBarTrip:g,setSideBarTrip:I}),t.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(h,{style:{width:D||g?"80%":"100%"},children:t.jsx(je,{center:j,showCard:m})}),D&&t.jsx(h,{style:{width:"20%",backgroundColor:l.grey[100]},children:t.jsx(pe,{vehicleData:e,title:"Live Monitor"})}),t.jsx(h,{style:{width:p?"22%":"20%",display:g?"block":"none",backgroundColor:l.grey[100]},children:t.jsx(ye,{})})]})]})]})}export{Oe as default};
