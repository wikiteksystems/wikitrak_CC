import{p as Se,q as we,w as T,x as oe,y as U,z as Ce,A as ke,B as De,r as u,C as Pe,D as N,j as e,E as V,F as Ie,H as se,I as q,J as G,K as Te,L as Q,M as $,N as Z,O as pe,T as L,a as F,G as B,c as _,u as z,P as ne,t as Fe,Q as Ae,R as Re,S as ae,i as ue,U as Me,V as K,W as he,X as Le,Y as Ee,Z as _e,_ as M,b as le,l as Ne,m as $e,n as Oe,$ as Ve,o as ze,v as Be}from"./index-B9xO1qn8.js";import{L as qe}from"./LightModeOutlined-DlbOBg-Z.js";import{s as W}from"./Socket-0N_gnJcr.js";import{p as Ge,R as Ye,L as He,X as Ue,Y as We,a as Xe,b as Je,T as Ke}from"./LineChart-017Y8bCX.js";import{t as E,d as Qe}from"./Search-D33qK6BP.js";import{B as v,C as ee}from"./CircularProgress-DwLXI1R3.js";import{P as Ze}from"./Paper-BB2eFWfO.js";import{c as et,S as tt}from"./Switch-CxzWkpfC.js";import{c as rt,I as ot}from"./IconButton-Bvysnsfz.js";import{r as st,m as nt,a as at}from"./Modal-C5S1sYZC.js";import{C as lt}from"./index-Ya1l7C-A.js";import{d as ie}from"./index-CkCekKpO.js";import{u as ge,f as xe,F as fe,I as me,O as it,a as ct}from"./OutlinedInput-a2tWCZdp.js";import{D as dt}from"./DateTimePicker-DXzHIKYx.js";import{r as ye}from"./createSvgIcon-Csl_yybN.js";import{T as pt,a as ut,d as ht,b as gt,c as X}from"./TableRow-C_PEfqhD.js";import{C as xt}from"./Card-DQ6PgQ6H.js";import{S as ft,M as mt}from"./Select-Bms78RsL.js";import{T as yt}from"./TopBar-C7kfaUeB.js";import{G as vt}from"./GeofencAlert-DmckGi35.js";import{V as bt,F as jt,P as St,f as ce,S as wt,I as Ct,M as kt,T as Dt,O as Pt,a as It,b as Tt}from"./Vector-BEQdHjna.js";import{u as Ft}from"./esm-Bd25net4.js";import"./index-C3uJppgg.js";import"./roundedArrow-DDYcBRmk.js";import"./button-DJWrFvBJ.js";import"./NotificationsNone-C1o_wpzu.js";const At=["component","direction","spacing","divider","children","className","useFlexGap"],Rt=Se(),Mt=we("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,r)=>r.root});function Lt(t){return Ie({props:t,name:"MuiStack",defaultTheme:Rt})}function Et(t,r){const a=u.Children.toArray(t).filter(Boolean);return a.reduce((s,h,i)=>(s.push(h),i<a.length-1&&s.push(u.cloneElement(r,{key:`separator-${i}`})),s),[])}const _t=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],Nt=({ownerState:t,theme:r})=>{let a=T({display:"flex",flexDirection:"column"},oe({theme:r},U({values:t.direction,breakpoints:r.breakpoints.values}),s=>({flexDirection:s})));if(t.spacing){const s=Ce(r),h=Object.keys(r.breakpoints.values).reduce((d,p)=>((typeof t.spacing=="object"&&t.spacing[p]!=null||typeof t.direction=="object"&&t.direction[p]!=null)&&(d[p]=!0),d),{}),i=U({values:t.direction,base:h}),j=U({values:t.spacing,base:h});typeof i=="object"&&Object.keys(i).forEach((d,p,S)=>{if(!i[d]){const b=p>0?i[S[p-1]]:"column";i[d]=b}}),a=ke(a,oe({theme:r},j,(d,p)=>t.useFlexGap?{gap:se(s,d)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${_t(p?i[p]:t.direction)}`]:se(s,d)}}))}return a=De(r.breakpoints,a),a};function $t(t={}){const{createStyledComponent:r=Mt,useThemeProps:a=Lt,componentName:s="MuiStack"}=t,h=()=>q({root:["root"]},d=>G(s,d),{}),i=r(Nt);return u.forwardRef(function(d,p){const S=a(d),l=Pe(S),{component:b="div",direction:w="column",spacing:n=0,divider:f,children:c,className:k,useFlexGap:P=!1}=l,x=N(l,At),o={direction:w,spacing:n,useFlexGap:P},m=h();return e.jsx(i,T({as:b,ownerState:o,ref:p,className:V(m.root,k)},x,{children:f?Et(c,f):c}))})}const Ot=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],Vt=["component","slots","slotProps"],zt=["component"];function Bt(t,r){const{className:a,elementType:s,ownerState:h,externalForwardedProps:i,getSlotOwnerState:j,internalForwardedProps:g}=r,d=N(r,Ot),{component:p,slots:S={[t]:void 0},slotProps:l={[t]:void 0}}=i,b=N(i,Vt),w=S[t]||s,n=st(l[t],h),f=nt(T({className:a},d,{externalForwardedProps:t==="root"?b:void 0,externalSlotProps:n})),{props:{component:c},internalRef:k}=f,P=N(f.props,zt),x=Te(k,n==null?void 0:n.ref,r.ref),o=j?j(P):{},m=T({},h,o),y=t==="root"?c||p:c,D=at(w,T({},t==="root"&&!p&&!S[t]&&g,t!=="root"&&!S[t]&&g,P,y&&{as:y},{ref:x}),m);return Object.keys(o).forEach(I=>{delete D[I]}),[w,D]}const qt=rt(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function Gt(t){return G("MuiAvatar",t)}Q("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const Yt=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],Ht=et(),Ut=t=>{const{classes:r,variant:a,colorDefault:s}=t;return q({root:["root",a,s&&"colorDefault"],img:["img"],fallback:["fallback"]},Gt,r)},Wt=$("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:a}=t;return[r.root,r[a.variant],a.colorDefault&&r.colorDefault]}})(({theme:t})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:T({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:T({backgroundColor:t.palette.grey[400]},t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})))}]})),Xt=$("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(t,r)=>r.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),Jt=$(qt,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(t,r)=>r.fallback})({width:"75%",height:"75%"});function Kt({crossOrigin:t,referrerPolicy:r,src:a,srcSet:s}){const[h,i]=u.useState(!1);return u.useEffect(()=>{if(!a&&!s)return;i(!1);let j=!0;const g=new Image;return g.onload=()=>{j&&i("loaded")},g.onerror=()=>{j&&i("error")},g.crossOrigin=t,g.referrerPolicy=r,g.src=a,s&&(g.srcset=s),()=>{j=!1}},[t,r,a,s]),h}const Qt=u.forwardRef(function(r,a){const s=Ht({props:r,name:"MuiAvatar"}),{alt:h,children:i,className:j,component:g="div",slots:d={},slotProps:p={},imgProps:S,sizes:l,src:b,srcSet:w,variant:n="circular"}=s,f=N(s,Yt);let c=null;const k=Kt(T({},S,{src:b,srcSet:w})),P=b||w,x=P&&k!=="error",o=T({},s,{colorDefault:!x,component:g,variant:n}),m=Ut(o),[y,D]=Bt("img",{className:m.img,elementType:Xt,externalForwardedProps:{slots:d,slotProps:{img:T({},S,p.img)}},additionalProps:{alt:h,src:b,srcSet:w,sizes:l},ownerState:o});return x?c=e.jsx(y,T({},D)):i||i===0?c=i:P&&h?c=h[0]:c=e.jsx(Jt,{ownerState:o,className:m.fallback}),e.jsx(Wt,T({as:g,ownerState:o,className:V(m.root,j),ref:a},f,{children:c}))}),Zt=Qt,er=$t({createStyledComponent:$("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,r)=>r.root}),useThemeProps:t=>Z({props:t,name:"MuiStack"})}),tr=er;function rr(t){return G("MuiFormControlLabel",t)}const or=Q("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),O=or,sr=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],nr=t=>{const{classes:r,disabled:a,labelPlacement:s,error:h,required:i}=t,j={root:["root",a&&"disabled",`labelPlacement${pe(s)}`,h&&"error",i&&"required"],label:["label",a&&"disabled"],asterisk:["asterisk",h&&"error"]};return q(j,rr,r)},ar=$("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:a}=t;return[{[`& .${O.label}`]:r.label},r.root,r[`labelPlacement${pe(a.labelPlacement)}`]]}})(({theme:t,ownerState:r})=>T({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${O.disabled}`]:{cursor:"default"}},r.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},r.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},r.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${O.label}`]:{[`&.${O.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})),lr=$("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,r)=>r.asterisk})(({theme:t})=>({[`&.${O.error}`]:{color:(t.vars||t).palette.error.main}})),ir=u.forwardRef(function(r,a){var s,h;const i=Z({props:r,name:"MuiFormControlLabel"}),{className:j,componentsProps:g={},control:d,disabled:p,disableTypography:S,label:l,labelPlacement:b="end",required:w,slotProps:n={}}=i,f=N(i,sr),c=ge(),k=(s=p??d.props.disabled)!=null?s:c==null?void 0:c.disabled,P=w??d.props.required,x={disabled:k,required:P};["checked","name","onChange","value","inputRef"].forEach(R=>{typeof d.props[R]>"u"&&typeof i[R]<"u"&&(x[R]=i[R])});const o=xe({props:i,muiFormControl:c,states:["error"]}),m=T({},i,{disabled:k,labelPlacement:b,required:P,error:o.error}),y=nr(m),D=(h=n.typography)!=null?h:g.typography;let I=l;return I!=null&&I.type!==L&&!S&&(I=e.jsx(L,T({component:"span"},D,{className:V(y.label,D==null?void 0:D.className),children:I}))),e.jsxs(ar,T({className:V(y.root,j),ownerState:m,ref:a},f,{children:[u.cloneElement(d,x),P?e.jsxs(tr,{display:"block",children:[I,e.jsxs(lr,{ownerState:m,"aria-hidden":!0,className:y.asterisk,children:["â€‰","*"]})]}):I]}))}),cr=ir;function dr(t){return G("MuiFormGroup",t)}Q("MuiFormGroup",["root","row","error"]);const pr=["className","row"],ur=t=>{const{classes:r,row:a,error:s}=t;return q({root:["root",a&&"row",s&&"error"]},dr,r)},hr=$("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:a}=t;return[r.root,a.row&&r.row]}})(({ownerState:t})=>T({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),gr=u.forwardRef(function(r,a){const s=Z({props:r,name:"MuiFormGroup"}),{className:h,row:i=!1}=s,j=N(s,pr),g=ge(),d=xe({props:s,muiFormControl:g,states:["error"]}),p=T({},s,{row:i,error:d.error}),S=ur(p);return e.jsx(hr,T({className:V(S.root,h),ownerState:p,ref:a},j))}),xr=gr,fr=({imeiNo:t})=>{const{selectedVehicle:r,parameterData:a,ivnPid:s,locationData:h,vehicleList:i,onlineVehicle:j}=F(y=>y.liveMap),{ivnParameters:g,mode:d}=F(y=>y.dashboard),p=E(d),[S,l]=u.useState(),[b,w]=u.useState(!1),[n,f]=u.useState();u.useState({mainInputVoltage:0,ignition:0,speed:0});const[c,k]=u.useState("Not Available"),[P,x]=u.useState("Offline");u.useEffect(()=>{o()},[r]);const o=()=>{var y,D,I,R;if((h==null?void 0:h.length)>0){console.log("locationData",h);let C=h==null?void 0:h.find(A=>A.latestDocument.imei===r.imei);C?(l((y=C==null?void 0:C.latestDocument)==null?void 0:y.speed),w((D=C==null?void 0:C.latestDocument)==null?void 0:D.ignition),f((I=C==null?void 0:C.latestDocument)==null?void 0:I.mainInputVoltage),k((R=C==null?void 0:C.latestDocument)==null?void 0:R.venderId)):(l(0),w(0),f(0),k("Not Available"))}else l(0),w(0),f(0),k("Not Available")};u.useEffect(()=>{Object.keys(r).length>0&&m()},[r]);const m=()=>{if(Object.keys(r).length>0)if(j&&j.length>0){const y=j.some(D=>parseInt(D)===parseInt(r==null?void 0:r.imei));x(y?"Online":"Offline")}else x("Offline");else x("Offline")};return e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{mx:"10px",pt:"10px",color:p.grey[400]},children:e.jsx("b",{children:r==null?void 0:r.reg_id})}),e.jsx(v,{sx:{backgroundColor:p.grey[200],height:"12vh",borderRadius:"8px",p:"5px"},children:e.jsx(v,{sx:{},children:e.jsx(B,{container:!0,spacing:3,mt:"2.5px",children:e.jsx(B,{item:!0,xs:12,children:e.jsx(B,{container:!0,justifyContent:"space-around",spacing:3,children:[{label:"VenderId",value:c},{label:"Speed",value:S,unit:"km/h"},{label:"Main Input Voltage",value:parseFloat(n).toFixed(2),unit:"voltage"},{label:"Current Status",value:P}].map((y,D)=>e.jsx(B,{item:!0,children:e.jsxs(Ze,{sx:{height:70,width:250,backgroundColor:p.grey[100],color:p.grey[400],display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 10px"},children:[e.jsxs(v,{children:[e.jsx(L,{variant:"h6",sx:{fontSize:"12px"},children:y.label}),e.jsxs(L,{variant:"h6",sx:{fontSize:"18px",fontWeight:"bold"},children:[y.value," ",y==null?void 0:y.unit]})]}),e.jsx(Zt,{src:Ge,sx:{width:20,height:20}})]})},D))})})})})})]})},J=({title:t,selectedTripData:r})=>{const{mode:a,loading:s}=F(p=>p.dashboard),{selectedVehicle:h}=F(p=>p.liveMap),[i,j]=u.useState([]);u.useEffect(()=>{let p=r.map(l=>{let b={...l};return b.ignition=b.ignition?1:0,b});const S=d(p);j(S)},[r]);const g=E(a),d=p=>{let S=null;return p.forEach(l=>{const b=new Date(l.createdAt);S&&S.toDateString()===b.toDateString()?(l.date=_(l.createdAt).format("HH:mm:ss"),l.ignition=l.ignition?1:0):(l.date=_(l.createdAt).format("DD-MM-YYYY"),l.ignition=l.ignition?1:0),S=b}),p};return e.jsx(v,{sx:{ml:"2rem",border:g.grey[300],fontSize:"13px",height:"24vh",color:g.grey[400],backgroundColor:g.grey[100],borderRadius:"5px"},children:i&&i.length>0?e.jsx(Ye,{children:e.jsxs(He,{data:i,margin:{top:15,right:10,left:-25,bottom:0},children:[e.jsx(Ue,{dataKey:"date",stroke:g.grey[400]}),e.jsx(We,{stroke:g.grey[400]}),e.jsx(Xe,{type:"monotone",dataKey:t,dot:!1,stroke:"#EF5B05",strokeWidth:2}),e.jsx(Je,{layout:"horizontal",verticalAlign:"top",align:"center"}),e.jsx(Ke,{})]})}):e.jsx(lt,{style:{background:g.grey[100],width:"400px",height:"100px",margin:"auto",marginTop:"10px"},children:Object.keys(h).length===0?e.jsx(L,{textAlign:"center",align:"center",mt:"20px",color:g.grey[600],children:"Please Select a Vehicle"}):s?e.jsx(ee,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(L,{textAlign:"center",color:g.grey[600],children:"Sorry! No Trips Available"})})})},mr=({vehicleData:t})=>{const r=["Engine RPM","Engine coolant temperature","Battery Potential"],a=z(),{selectedVehicle:s,loading:h}=F(c=>c.liveMap),{startDate:i,endDate:j,mode:g}=F(c=>c.dashboard),[d,p]=u.useState(""),S=E(g),l=u.useRef(null),b=u.useRef(0),w=t.length>0&&t.filter(c=>c.label.toLowerCase().includes(d.toLowerCase())),n=c=>{p(c.target.value)},f=async c=>{var o;l.current&&(b.current=l.current.scrollTop),a(Ae({imei:c.value,reg_id:c.label})),c.value,ie().subtract(5,"day"),ie();let k=c.label;const P=await a(Re({registration_id:k}));let x=[];if(P&&P.payload.length>0&&((o=P.payload)==null||o.map(m=>{m.ivn_parameter.length>0&&x.push(m.ivn_parameter[0])})),x.length>0){let m=x.filter(y=>r.includes(y.pid_description));a(ae(m))}else a(ae([]));setTimeout(()=>{l.current&&(l.current.scrollTop=b.current)},0)};return u.useEffect(()=>{l.current&&(l.current.scrollTop=b.current)},[h,w,s]),e.jsx(e.Fragment,{children:h?e.jsx("div",{children:e.jsx(v,{sx:{display:"flex",justifyContent:"center",height:"88vh",alignItems:"center"},children:e.jsx(ee,{})})}):e.jsxs("div",{ref:l,style:{overflowY:"auto",height:"90vh"},children:[e.jsx(v,{sx:{align:"center",my:"15px",ml:"20px"},children:e.jsxs(fe,{sx:{width:"90%",backgroundColor:"white",borderRadius:"5px"},variant:"outlined",children:[e.jsx(me,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px"},children:"Search"}),e.jsx(it,{onChange:c=>n(c),inputProps:{style:{padding:7}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(ct,{position:"end",children:e.jsx(ot,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(Qe,{})})}),label:"Search"})]})}),e.jsx(v,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsxs(ne,{variant:"outlined",sx:{width:"90%",color:S.grey[400],"&:hover":{color:"#DAE0EE"}},children:["Total Vehicle: ",w.length]})}),w.length>0&&w.map((c,k)=>e.jsx(v,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(ne,{variant:"outlined",onClick:()=>f(c),sx:{width:"90%",bgcolor:c.label===s.reg_id?Fe.bgColor:"undefined",color:c.label===s.reg_id?"#DAE0EE":S.grey[400]},children:c.label})},k))]})})};var te={},yr=ue;Object.defineProperty(te,"__esModule",{value:!0});var ve=te.default=void 0,vr=yr(ye()),de=e;ve=te.default=(0,vr.default)([(0,de.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7M7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9"},"0"),(0,de.jsx)("circle",{cx:"12",cy:"9",r:"2.5"},"1")],"LocationOnOutlined");var re={},br=ue;Object.defineProperty(re,"__esModule",{value:!0});var be=re.default=void 0,jr=br(ye()),Sr=e;be=re.default=(0,jr.default)((0,Sr.jsx)("path",{d:"m22 12-4-4v3H3v2h15v3z"}),"TrendingFlat");function wr(){const{allTripList:t,loading:r,mode:a,activeIndex:s,selectedDate:h,selectedTripData:i}=F(o=>o.dashboard),{selectedVehicle:j}=F(o=>o.liveMap),[g,d]=u.useState([]),[p,S]=u.useState("0"),[l,b]=u.useState(0);let w=z();const n=Me(),f=E(a);u.useEffect(()=>{const o=c(t);d(o),o.length>0&&K(o[0])},[t]);const c=o=>{const m=new Set,y=[];return o.forEach(D=>{const I=_(D.startTime).format("YYYY-MM-DD");m.has(I)||(m.add(I),y.push(I))}),y},k=(o,m)=>{w(he(m)),console.log("item, i",o,m),w(Le(o.data));let y=Ee(o==null?void 0:o.data);b(y);let D=_e(new Date(o==null?void 0:o.startTime).toISOString(),new Date(o==null?void 0:o.endTime).toISOString());S(D)},P=o=>{console.log("activeIndex",s),console.log("i",o),s!==null?o===s?n("/trip-monitor"):M.error("Trip not selected"):M.error("Please select the trip")},x=t.filter(o=>_(o.startTime).format("YYYY-MM-DD")===h);return e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{width:"95%",display:"flex",overflow:"auto",mx:"10px",mt:2},children:x&&x.length>0?e.jsx(pt,{sx:{maxHeight:250,height:250,width:"98%",ml:"10px",mt:"10px",borderRadius:"5px",border:"1px solid #dbdad5"},children:e.jsx(ut,{stickyHeader:!0,"aria-label":"sticky table",children:e.jsx(ht,{children:x.map((o,m)=>{var y,D,I,R;return e.jsxs(gt,{sx:{backgroundColor:s===m?"#DAE0EE":f.grey[100]},children:[e.jsxs(X,{align:"left",style:{fontSize:"12px",padding:10,color:s===m?"black":f.grey[400],cursor:"pointer"},onClick:()=>{k(o,m)},children:[m+1,"."," ",`${(D=(y=o==null?void 0:o.startLocation)==null?void 0:y.address)==null?void 0:D.display_name}`," ",e.jsx(v,{component:"span",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",verticalAlign:"middle"},children:e.jsx(be,{})}),`${(R=(I=o==null?void 0:o.endLocation)==null?void 0:I.address)==null?void 0:R.display_name}`]}),e.jsxs(X,{align:"right",style:{fontSize:"12px",padding:10,color:s===m?"black":f.grey[400]},children:[o!=null&&o.startTime?_(new Date(o.startTime).toISOString()).format("LT"):""," ","to"," ",o!=null&&o.endTime?_(new Date(o.endTime).toISOString()).format("LT"):"----"]}),e.jsx(X,{align:"right",style:{fontSize:"12px",padding:10,color:s===m?"black":f.grey[400]},children:e.jsx("span",{title:"Navigate to map",style:{cursor:"pointer"},onClick:()=>{P(m)},children:e.jsx(ve,{})})})]},m)})})})}):e.jsx(v,{sx:{height:210,display:"flex",justifyContent:"center",alignItems:"center",color:f.grey[400],margin:"auto"},children:e.jsx(xt,{style:{background:f.grey[100],width:"400px",height:"100px"},children:Object.keys(j).length===0?e.jsx(L,{textAlign:"center",align:"center",mt:"20px",color:f.grey[600],children:"Please Select a Vehicle"}):r?e.jsx(ee,{style:{position:"absolute",left:"40%",top:"38%",zIndex:9999}}):e.jsx(L,{textAlign:"center",color:f.grey[600],children:"Sorry! No Trips Available"})})})}),i.length>0&&e.jsx(v,{sx:{my:"0px"},children:e.jsxs(v,{sx:{display:"flex",mx:"5px",mt:"10px"},children:[e.jsxs(v,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Braking"}),e.jsx("div",{children:"0"})]}),e.jsxs(v,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Harsh Acceleration"}),e.jsx("div",{children:"0"})]}),e.jsxs(v,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Running Hrs"}),e.jsx("div",{children:p})]}),e.jsxs(v,{sx:{backgroundColor:"#EF5B05",color:"white",fontSize:"15px",height:"45px",pt:"5px",borderRadius:"5px",textAlign:"center",width:"25%",ml:"5px"},children:[e.jsx("div",{children:"Distance"}),e.jsxs("div",{children:[parseFloat(parseFloat(l).toFixed(2))," km"]})]})]})})]})}function Cr(){const{allTripList:t,activeIndex:r,selectedDate:a,loading:s,mode:h}=F(l=>l.dashboard),[i,j]=u.useState([]);let g=z();const d=E(h);u.useEffect(()=>{const l=p(t);j(l),l.length>0&&g(K(l[0]))},[t]);const p=l=>{const b=new Set,w=[];return l.forEach(n=>{const f=_(n.startTime).format("YYYY-MM-DD");b.has(f)||(b.add(f),w.push(f))}),w},S=l=>{g(K(l.target.value)),g(he(null))};return e.jsx(v,{sx:{width:"50%",mx:"10px"},children:e.jsxs(fe,{fullWidth:!0,sx:{height:"10px","& .MuiInputBase-root":{height:"38px",minHeight:"auto",backgroundColor:d.grey[500],color:d.grey[400]},"& .MuiInputLabel-root":{lineHeight:"15px",color:d.grey[400]}},children:[e.jsx(me,{id:"select-date-label",children:"Trip's Date"}),e.jsx(ft,{labelId:"select-date-label",value:a,label:"Select Date",onChange:S,sx:{height:"40px",fontSize:"14px",padding:"0 12px",backgroundColor:d.grey[500],color:d.grey[400],"& .MuiSelect-icon":{color:d.grey[400]}},children:i.map((l,b)=>e.jsx(mt,{value:l,sx:{backgroundColor:d.grey[500],color:d.grey[400],"&:hover":{backgroundColor:d.grey[600],color:d.grey[300]},"&.Mui-selected":{backgroundColor:d.grey[600],color:d.grey[300],"&:hover":{backgroundColor:d.grey[600]}}},children:l},b))})]})})}const kr=()=>{const{mode:t}=F(a=>a.dashboard),r=E(t);return e.jsxs(v,{children:[e.jsxs(v,{sx:{display:"flex",ml:"5px",justifyContent:"center"},children:[e.jsx(v,{sx:{m:"5px",fontSize:"20px",width:"20%",color:r.grey[400]},children:e.jsx("b",{children:"Trip History"})}),e.jsx(Cr,{}),e.jsx(v,{children:e.jsx(dt,{})})]}),e.jsx(v,{sx:{my:"5px"},children:e.jsx(wr,{})})]})},Dr=()=>{const t=z(),{center:r,selectedParameterList:a,selectedVehicle:s,vehicleList:h,tractorIcon:i,icons:j,locationData:g,ivnPid:d,placesData:p}=F(C=>C.liveMap),{mode:S}=F(C=>C.dashboard),{isLoaded:l,loadError:b}=Ft({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"}),[w,n]=u.useState(null),[f,c]=u.useState(!0),[k,P]=u.useState(5),[x,o]=u.useState(),m=E(S),y=u.useRef(null),D=u.useRef(new bt),I=()=>new kt({target:y.current,layers:[new Dt({source:new Pt,attributions:""}),new It({source:D.current})],view:new Tt({center:ce([78,21]),zoom:k}),controls:[]});u.useEffect(()=>{l&&n(window.google.maps)},[l]),u.useEffect(()=>{if(f)o(g);else{let C=g==null?void 0:g.filter(A=>(A==null?void 0:A._id)===(s==null?void 0:s.imei));o(C)}},[g,s,f]),u.useEffect(()=>{if(y.current&&w){const C=I();return y.current=C,()=>{C&&C.setTarget(null)}}},[w]),u.useEffect(()=>{y.current&&x&&x.length>0&&(D.current.clear(),x.forEach(C=>{const{lat:A,lng:Y}=C.latestDocument,H=new jt({geometry:new St(ce([Y,A]))});H.setStyle(new wt({image:new Ct({src:"http://maps.google.com/mapfiles/ms/icons/red-dot.png",scale:1})})),D.current.addFeature(H)}))},[x]);const R=()=>{if(!f)t(le({lat:21,lng:78})),P(4),c(A=>!A);else{const C=g.find(A=>A.latestDocument.imei===s.imei);if(C){const{lat:A,lng:Y}=C.latestDocument;t(le({lat:A,lng:Y})),P(12),c(je=>!je)}else M.error("Data is not available for selected vehicle")}};return b?"Error loading maps":l?w?e.jsxs("div",{children:[e.jsxs(v,{sx:{ml:"10px",fontSize:"20px",display:"flex",justifyContent:"space-between",color:m.grey[400]},children:[e.jsx("b",{children:"Live Map"}),e.jsx(xr,{sx:{marginLeft:0,paddingTop:0,color:m.grey[400]},children:e.jsx(cr,{control:e.jsx(tt,{checked:f,onChange:R}),label:f?"Group":"Individual"})})]}),e.jsx("div",{ref:y,style:{height:"41.5vh",width:"99%",marginTop:"0px",marginLeft:"10px"}})]}):"No map":"Loading maps"},Zr=()=>{const{w_customer_id:t}=F(n=>n.auth),{mode:r,selectedTripData:a}=F(n=>n.dashboard),[s,h]=u.useState(()=>{const n=sessionStorage.getItem("imeiNo");return n?JSON.parse(n):[]}),i=z(),j=E(r),[g,d]=u.useState([]),[p,S]=u.useState(!1),[l,b]=u.useState(!1);u.useEffect(()=>{w()},[]),u.useEffect(()=>{sessionStorage.setItem("imeiNo",JSON.stringify(s))},[s]),u.useEffect(()=>{W.on("geofenceAlert",n=>{(n==null?void 0:n.imei)!==null&&s.find(k=>parseInt(k)===(n==null?void 0:n.imei))&&(console.log("geofence"),M.error(`Type: ${n==null?void 0:n.type} ${n==null?void 0:n.msg} ${n==null?void 0:n.imei}`,{id:"geofence",autoClose:5e3}))}),W.on("speedAlert",n=>{(n==null?void 0:n.imei)!==null&&s.find(k=>parseInt(k)===(n==null?void 0:n.imei))&&M.error(`${n==null?void 0:n.msg} ${n==null?void 0:n.imei}`,{id:"speed",autoClose:5e3})})},[W]);const w=async()=>{try{let n=[],f=[];const c=await i(Ne({w_customer_id:t}));if(console.log("data",c),Array.isArray(c.payload)){c.payload.forEach(x=>{var o,m;Array.isArray(x.imei)&&x.imei.length>0?(n.push({id:x.id,label:x.registration_id,value:(o=x==null?void 0:x.imei[0])==null?void 0:o.mac_id,vehilce_type:x==null?void 0:x.segment}),f.push((m=x.imei[0])==null?void 0:m.mac_id),x.registration_id):(console.error("IMEI data not found for item:",x),M.error(`IMEI Number not found for the vehicle: ${x==null?void 0:x.registration_id}`))}),h(f);const k="one",P=f;f.length>0&&(i($e({type:k,imei:P})),i(Oe(P))),d(n),i(Ve(n)),i(ze({w_customer_id:t})),i(Be({}))}else console.error("Unexpected data format:",c),M.error("Unexpected data format:")}catch(n){console.error("Error fetching vehicle data:",n),M.error(`Error fetching vehicle data: ${n}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(qe,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(yt,{title:"Dashboard",showVehicles:p,setShowVehicles:S,setShowNotification:b,showNotification:l}),e.jsxs("div",{style:{height:"92vh",backgroundColor:j.grey[100],padding:"10px"},children:[p&&e.jsx(v,{sx:{position:"fixed",width:"250px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:j.grey[100],overflowY:"auto",scrollBehavior:"smooth",scrollbarWidth:"thin"},children:e.jsx(mr,{vehicleData:g})}),l&&e.jsx(v,{sx:{position:"fixed",width:"300px",right:"0px",height:"90vh",zIndex:9999,backgroundColor:j.grey[100]},children:e.jsx(vt,{})}),e.jsx(v,{sx:{height:"21%"},children:e.jsx(fr,{imeiNo:s})}),e.jsxs(v,{sx:{display:"flex",height:"50%"},children:[e.jsx(v,{sx:{width:"50%",border:"1px solid #E8E8E8",padding:"2px",borderRadius:"5px"},children:e.jsx(kr,{})}),e.jsx(v,{sx:{width:"50%"},children:e.jsx(Dr,{})})]}),e.jsxs(v,{sx:{display:"flex",height:"30%",mt:"5px",pt:"10px"},children:[e.jsx(v,{style:{width:"33%"},children:e.jsx(J,{title:"speed",selectedTripData:a})}),e.jsx(v,{style:{width:"33%"},children:e.jsx(J,{title:"mainInputVoltage",selectedTripData:a})}),e.jsx(v,{style:{width:"33%"},children:e.jsx(J,{title:"ignition",selectedTripData:a})})]})]})]})]})};export{Zr as default};
