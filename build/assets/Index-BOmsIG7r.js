import{r as n,j as t,u as A,a as C,t as Z,T as B,N as V,a2 as ee,_ as R,V as te,W as z,X as E,b as N,Y as O,U as se,k as oe,l as ae}from"./index-yugurC9t.js";import{L as ne}from"./Close-DrXt86Pf.js";import{L as re}from"./LiveMapTopBar-UI_EM0qr.js";import{V as le}from"./VehicleMenu-B_E7-Uca.js";import{P as U,u as ie,G as ce,a as W}from"./esm-CMR_PjuD.js";import"./index-DYQOJyvn.js";import{T as de}from"./TripGraph-HTBYsgiE.js";import{B as c,C as pe}from"./CircularProgress-WSXXCLok.js";import{D as he}from"./DateTimePicker-Cd7ijIpQ.js";import{t as X}from"./theme-cmKXW1hM.js";import"./createSvgIcon-DLvEd_Av.js";import"./createSvgIcon-F-AoYie0.js";import"./DarkModeOutlined-CbmsTPc4.js";import"./index-Ccc74T_O.js";import"./roundedArrow-BUXjTHqW.js";import"./TextArea-dODYW5f5.js";import"./IconButton-CU2xPpj8.js";import"./button-Rukvm4cj.js";function ge({trip:a,tripPlay:d,setTripPlay:w,setSpeed:j}){const[y,u]=n.useState([]),[b,e]=n.useState(0),[L,f]=n.useState([]),[k,m]=n.useState([null]);return n.useEffect(()=>{var x;j((x=a==null?void 0:a[2])==null?void 0:x.speed)},[a]),n.useEffect(()=>{m([null]);const x=[];if(a&&a.length>0&&(a==null||a.map(l=>{x.push(l.speed).toFixed(2)}),f(x)),a&&(a==null?void 0:a.length)>0){const l=a==null?void 0:a.map(p=>({lat:parseFloat(p.lat),lng:parseFloat(p.lng)}));u(l),m(l.slice(0))}},[a]),n.useEffect(()=>{if(d){const x=y.length,l=9e3,p=1e4,s=l/p;let o=0;const r=setInterval(()=>{if(o<p){const i=o/p,D=Math.floor(i*x);e(D),j(L[D]),o++}else clearInterval(r)},s);return()=>clearInterval(r)}},[d]),t.jsxs("div",{children:[k.length>0&&t.jsx(t.Fragment,{children:t.jsx(U,{path:k,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4}})}),d&&t.jsx(U,{path:y.slice(0,b+1),options:{strokeColor:"green",strokeOpacity:1,strokeWeight:4,zIndex:1e3,geodesic:!0}})]})}const ue=({selectedTrip:a,center:d,showCard:w})=>{var G,_;A();const{isLoaded:j,loadError:y}=ie({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU"});C(h=>h.liveMap);const{singleTrip_Data:u,tripLoading:b}=C(h=>h.tripMonitor),{selectedTripData:e,mode:L,styles:f}=C(h=>h.dashboard);console.log("selectedTripData",e),console.log("singleTrip_Data",u);const k=n.useRef(null),[m,x]=n.useState(null),[l,p]=n.useState(null),[s,o]=n.useState([]);n.useState([]);const[r,i]=n.useState(!1),[D,M]=n.useState(0),[S,q]=n.useState(!1);n.useEffect(()=>{m&&l&&m.fitBounds(l)},[m,l,e]),n.useEffect(()=>{var h,P,T,g,v;if(e&&(e==null?void 0:e.length)>0){const I=new window.google.maps.LatLngBounds,F=new window.google.maps.LatLng(parseFloat((h=e[0])==null?void 0:h.lat),parseFloat((P=e[0])==null?void 0:P.lng)),Q=new window.google.maps.LatLng(parseFloat((T=e[(e==null?void 0:e.length)-1])==null?void 0:T.lat),parseFloat((g=e[(e==null?void 0:e.length)-1])==null?void 0:g.lng));I.extend(F),I.extend(Q),M((v=e[0])==null?void 0:v.speed),p(I)}i(!1),H()},[e]);const H=()=>{if(e&&e.length>0){const h=(g,v)=>{const F=new Date(g.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:g.createdAt.substring(0,10),Time:F,value:g[v]}},T=["speed","mainInputVoltage","ignition"].map(g=>({label:g==="speed"?"Speed":g==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:K(),data:e.map(v=>h(v,g))}));o(T)}else o([])},K=()=>"#"+Math.floor(Math.random()*16777215).toString(16),Y=()=>{if((e==null?void 0:e.length)>0)i(!r),M(0);else return R.error("Please Select Trip",{id:"trip error"})},$=()=>{if(e)q(!S);else return R.error("Please Select Trip",{id:"trip error"})};if(y)return"Error loading maps";if(!j)return"Loading maps";const J={width:"100%",height:w?"87vh":"93vh"};return t.jsxs(t.Fragment,{children:[b&&t.jsx(c,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:t.jsx(pe,{})}),w&&t.jsxs(c,{sx:{bgcolor:Z.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"left",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",height:"60px",gap:"15px",paddingLeft:"30px"},children:[t.jsxs(B,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px"},children:["Speed ",D," KM/H"]}),t.jsxs(V,{style:{height:"38px",padding:"5px 20px"},sx:{background:r?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:r?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{Y()},children:[r?"Pause":"Play","-Trip"]}),t.jsxs(V,{style:{height:"38px",padding:"5px 20px"},sx:{background:S?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:S?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{$()},children:[S?"Hide":"Show","-Graph"]})]}),t.jsxs(ce,{ref:k,mapContainerStyle:J,zoom:5,onLoad:h=>x(h),options:{mapTypeControl:!1,styles:L?f:""},children:[e&&(e==null?void 0:e.length)>0&&(e==null?void 0:e.map((h,P)=>{var T,g,v,I;return t.jsxs(ee.Fragment,{children:[t.jsx(W,{position:{lat:parseFloat((T=e[0])==null?void 0:T.lat),lng:parseFloat((g=e[0])==null?void 0:g.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}}),t.jsx(ge,{trip:e,tripPlay:r,setTripPlay:i,setSpeed:M}),t.jsx(W,{position:{lat:parseFloat((v=e[(e==null?void 0:e.length)-1])==null?void 0:v.lat),lng:parseFloat((I=e[(e==null?void 0:e.length)-1])==null?void 0:I.lng)},animation:"BOUNCE",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}})]},P)})),t.jsx("div",{style:{position:"relative",top:320,left:15,color:"green"},children:((_=(G=s[0])==null?void 0:G.data)==null?void 0:_.length)>0&&S&&t.jsx(de,{item:s})})]})]})},xe=ue,fe=()=>{const a=A(),{tripList:d,selectedTripData:w,loading:j,trips:y,activeIndex:u,searchText:b,mode:e}=C(s=>s.dashboard),{selectedVehicle:L}=C(s=>s.liveMap),f=X(e);n.useEffect(()=>{const s=m(d);a(te(s))},[d]),n.useEffect(()=>{console.log("selectedTripData",w),w.length>0||u!==null&&l.length>0&&(console.log("selected trip",l[u]),k(l[u]))},[w]);const k=async s=>{var i;let o={imei:L.imei,startDate:s.startDate,endDate:s.endDate};const r=await z(o);((i=r==null?void 0:r.data)==null?void 0:i.documents.length)>0?a(E(r.data.documents[0].data)):a(E([]))};n.useState(0);const m=s=>{const o=new Set,r=[];return s.forEach(i=>{o.has(i.formatedDate)||(o.add(i.formatedDate),r.push(i.formatedDate))}),r},x=s=>{a(O(null)),a(se(s))},l=d&&d.length>0&&d.filter(s=>s.formatedDate.toLowerCase().includes(b.toLowerCase())),p=async(s,o)=>{var D;let r={imei:L.imei,startDate:o.startDate,endDate:o.endDate};const i=await z(r);((D=i==null?void 0:i.data)==null?void 0:D.documents.length)>0?a(E(i.data.documents[0].data)):a(E([])),a(O(s))};return t.jsxs(c,{children:[t.jsxs(c,{children:[t.jsx(c,{sx:{color:f.grey[400]},children:"Select Date"}),t.jsx(c,{sx:{mt:1},children:t.jsx(he,{})})]}),t.jsx(c,{children:t.jsx(c,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:y&&y.map((s,o)=>t.jsx(c,{children:t.jsx(V,{onClick:()=>{x(s)},style:{backgroundColor:b===s?"#264796":"white",color:b===s?"white":"#264796",height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:s})},o))})}),t.jsx(c,{children:l&&l.length>0&&l.map((s,o)=>t.jsxs(c,{sx:{m:"5px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:u===o?"black":f.grey[400],backgroundColor:u===o?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer"},onClick:()=>p(o,s),children:[t.jsxs(B,{children:[o+1,". ",s.startLocation," to ",s.endLocation]}),t.jsxs(B,{children:[s!=null&&s.startDate?N(new Date(s.startDate).toISOString()).format("LT"):""," ","/ "," ",s!=null&&s.endDate?N(new Date(s.endDate).toISOString()).format("LT"):"----"]})]}))})]})},me=fe;function Ae(){const{w_customer_id:a}=C(o=>o.auth),{collapsed:d}=C(o=>o.auth),{mode:w}=C(o=>o.dashboard),[j,y]=n.useState(!1),[u,b]=n.useState(!1),[e,L]=n.useState([]),[f,k]=n.useState(!1);n.useState([]);const[m,x]=n.useState({lat:18.516726,lng:73.856255});n.useState([]);const l=X(w);let p=A();n.useEffect(()=>{s()},[]);const s=async()=>{let o=[],r=[];(await p(oe({w_customer_id:a}))).payload.map(S=>{o.push({id:S.id,label:S.registration_id,value:S.imei[0].mac_id}),r.push(S.imei[0].mac_id)});const D="one",M=r;r.length>0&&p(ae({type:D,imei:M})),L(o)};return t.jsxs("div",{className:"app",children:[t.jsx(ne,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(re,{title:"Trip Monitor",setShowVehicles:y,showVehicles:j,setShowCard:b,showCard:u,sideBarTrip:f,setSideBarTrip:k}),t.jsxs(c,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(c,{style:{width:j||f?"80%":"100%"},children:t.jsx(xe,{center:m,showCard:u})}),j&&t.jsx(c,{style:{width:d?"25%":"20%",backgroundColor:l.grey[100]},children:t.jsx(le,{vehicleData:e,title:"Live Monitor"})}),t.jsx(c,{style:{width:d?"25%":"20%",display:f?"block":"none",backgroundColor:l.grey[100]},children:t.jsx(me,{})})]})]})]})}export{Ae as default};
