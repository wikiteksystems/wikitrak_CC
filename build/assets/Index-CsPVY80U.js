import{i as O,j as e,a as P,u as ce,t as M,T as E,a9 as Ee,aa as Pe,P as le,r as i,v as Oe,ab as ve,l as ze,_ as ne,m as Ve,a1 as He}from"./index-DwHu308G.js";import{L as We}from"./LightModeOutlined-Ck3lP4Di.js";import{L as Ae}from"./LiveMapTopBar-oOsTEx4n.js";import{V as Ne}from"./VehicleMenu-BRFVGeTW.js";import{u as Fe,G as qe,M as fe,I as Be}from"./esm-Bl2QDx92.js";import Ge from"./Loader-Hfbn1kRr.js";import{r as z}from"./createSvgIcon-Bjx8o5hf.js";import{B as g,C as je}from"./CircularProgress-n5HnSe5F.js";import{s as ie}from"./Socket-0N_gnJcr.js";import{m as be,f as Ue}from"./4W-CSnZ3_ps.js";import{T as Je,c as Ke,a as $,b as x}from"./TableRow-8jc0-SnD.js";import{P as Xe}from"./Parameters-DXWVLrX4.js";import{t as Qe}from"./RegionSelector-D6pjBFBy.js";/* empty css           */import"./proj-XQwXs9DQ.js";import"./jcb-aCHXMCXy.js";import"./index-Dhv0-4XX.js";import"./index-Cb2th2CO.js";import"./IconButton-CSyoeEGl.js";import"./OutlinedInput-BBEQN4mV.js";import"./index-CIxqQ6NZ.js";import"./Card-DjpK9zwV.js";import"./Paper-xodoZ36R.js";import"./CardContent-wyacEhlu.js";var he={},Ye=O;Object.defineProperty(he,"__esModule",{value:!0});var _e=he.default=void 0,Ze=Ye(z()),Te=e;_e=he.default=(0,Ze.default)((0,Te.jsx)("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4"}),"Restaurant");var ue={},es=O;Object.defineProperty(ue,"__esModule",{value:!0});var Se=ue.default=void 0,ss=es(z()),os=e;Se=ue.default=(0,ss.default)((0,os.jsx)("path",{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3m12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4"}),"Hotel");var de={},ts=O;Object.defineProperty(de,"__esModule",{value:!0});var me=de.default=void 0,as=ts(z()),rs=e;me=de.default=(0,as.default)((0,rs.jsx)("path",{d:"m19.77 7.23.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77M12 10H6V5h6zm6 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalGasStation");var pe={},ls=O;Object.defineProperty(pe,"__esModule",{value:!0});var we=pe.default=void 0,ns=ls(z()),is=e;we=pe.default=(0,ns.default)((0,is.jsx)("path",{d:"M16.22 12c.68 0 1.22-.54 1.22-1.22 0-.67-.54-1.22-1.22-1.22S15 10.11 15 10.78c0 .68.55 1.22 1.22 1.22m-9.66-1.22c0 .67.54 1.22 1.22 1.22S9 11.46 9 10.78c0-.67-.54-1.22-1.22-1.22s-1.22.55-1.22 1.22M7.61 4 6.28 8h11.43l-1.33-4zm8.67-1s.54.01.92.54c.02.02.03.04.05.07.07.11.14.24.19.4.22.65 1.56 4.68 1.56 4.68v6.5c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81V14H7v1.19c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81v-6.5S6.34 4.67 6.55 4c.05-.16.12-.28.19-.4.03-.02.04-.04.06-.06.38-.53.92-.54.92-.54zM4 17.01h16V19h-7v3h-2v-3H4z"}),"CarRepair");var xe={},cs=O;Object.defineProperty(xe,"__esModule",{value:!0});var ye=xe.default=void 0,hs=cs(z()),us=e;ye=xe.default=(0,hs.default)((0,us.jsx)("path",{d:"M21 5h-2.64l1.14-3.14L17.15 1l-1.46 4H3v2l2 6-2 6v2h18v-2l-2-6 2-6zm-3.9 8.63L18.89 19H5.11l1.79-5.37.21-.63-.21-.63L5.11 7h13.78l-1.79 5.37-.21.63zM13 9h-2v3H8v2h3v3h2v-3h3v-2h-3z"}),"LocalPharmacyOutlined");var ge={},ds=O;Object.defineProperty(ge,"__esModule",{value:!0});var Me=ge.default=void 0,ps=ds(z()),xs=e;Me=ge.default=(0,ps.default)((0,xs.jsx)("path",{d:"M8 9v1.5h2.25V15h1.5v-4.5H14V9zM6 9H3c-.55 0-1 .45-1 1v5h1.5v-1.5h2V15H7v-5c0-.55-.45-1-1-1m-.5 3h-2v-1.5h2zM21 9h-4.5c-.55 0-1 .45-1 1v5H17v-4.5h1V14h1.5v-3.51h1V15H22v-5c0-.55-.45-1-1-1"}),"AtmOutlined");const gs=({setPlace:u,place:t})=>{const{center:R}=P(j=>j.liveMap),f=ce(),n=async j=>{t===j?(f(Ee([])),u("")):(u(j),f(Pe({center:R,clickedPlace:j})))};return e.jsxs(g,{sx:{position:"absolute",top:"1vh",left:"20%",display:"flex",justifyContent:"center"},children:[e.jsx(g,{sx:{bgcolor:t==="restaurants"?M.bgColor:"white",color:t==="restaurants"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("restaurants")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(_e,{style:{height:"17px",position:"relative",top:"1px"}}),"Restaurants"]})}),e.jsx(g,{sx:{bgcolor:t==="hotels"?M.bgColor:"white",color:t==="hotels"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("hotels")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(Se,{style:{height:"17px",position:"relative",top:"1px"}}),"Hotels"]})}),e.jsx(g,{sx:{bgcolor:t==="hospitals"?M.bgColor:"white",color:t==="hospitals"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("hospitals")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(ye,{style:{height:"17px",position:"relative",top:"1px"}}),"Hospitals"]})}),e.jsx(g,{sx:{bgcolor:t==="atm"?M.bgColor:"white",color:t==="atm"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("atm")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(Me,{style:{height:"17px",position:"relative",top:"1px"}}),"ATMs"]})}),e.jsx(g,{sx:{bgcolor:t==="car_repair"?M.bgColor:"white",color:t==="car_repair"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("car_repair")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(we,{style:{height:"17px",position:"relative",top:"1px"}}),"Service center"]})}),e.jsx(g,{sx:{bgcolor:t==="gasstation"?M.bgColor:"white",color:t==="gasstation"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("gasstation")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(me,{style:{height:"17px",position:"relative",top:"1px"}}),"Gas Stations"]})})]})},vs=gs,fs="/assets/3W_liveMap-sJCozxTr.png";function js({activeParams:u}){return e.jsx(g,{sx:{bgcolor:M.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:u&&u[0].params.length>0?e.jsxs(e.Fragment,{children:[u[0].params.length>0&&e.jsxs(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",u[0].reg_id]}),u.length>0&&u[0].params.map((t,R)=>{t.label==="maininputvoltage"&&console.log("item.label",t.label,t);const f=u[0].params.find(V=>V.label==="ignition"),n=f&&(f.value===!0||f.value===1)?t.value:0,j=t.label==="mainInputVoltage"||t.label==="maininputvoltage";return e.jsx(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:t.label==="speed"?`${t.label} : ${n} km/h`:j&&t.value!==void 0?`${t.label} : ${t.value} voltage`:t.label==="ignition"?`${t.label} : ${t.value===!0||(t==null?void 0:t.value)===1?"On":"Off"}`:`${t.label} : ${t.value!==void 0?t.value:""}`},R)})]}):e.jsx(e.Fragment,{children:e.jsx(le,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})})}const bs="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function _s({showCard:u,loadingVehicle:t}){const{center:R,selectedParameterList:f,selectedVehicle:n,vehicleList:j,icons:V,locationData:d,placesData:H,imeiNumbers:G,onlineVehicle:C,loading:se,services_loading:W}=P(s=>s.liveMap),{mode:oe,styles:A,vehicles_details:p}=P(s=>s.dashboard),[U,te]=i.useState(null),[N,F]=i.useState(""),[m,J]=i.useState([]),[ae,c]=i.useState([]),[h,b]=i.useState(),[S,I]=i.useState(),[a,_]=i.useState(null),[w,q]=i.useState(""),[o,y]=i.useState(),Ce=ce(),{isLoaded:re,loadError:De}=Fe({googleMapsApiKey:`${bs}`,loadingElement:e.jsx(Ge,{})});i.useEffect(()=>{re&&te(window.google.maps)},[re]),i.useEffect(()=>{if(console.log("locationData",d),Object.keys(n).length>0){console.log("selectedVehicle",n==null?void 0:n.imei);const s=d==null?void 0:d.filter(l=>{var r;return((r=l==null?void 0:l.latestDocument)==null?void 0:r.imei)==(n==null?void 0:n.imei)});console.log("filteredVehicle",s),b(s)}else b(d)},[d,n]),i.useEffect(()=>{I(f)},[f]),i.useEffect(()=>(ie.on("locationinfo",s=>{if(console.log("locationinfo",s),h==null||h.map(l=>{if(l.latestDocument.imei===s.imei){const r={lat:l.latestDocument.lat,lng:l.latestDocument.lng},v=500,D=60,L=v/(1e3/D),K=(s.lat-r.lat)/L,X=(s.lng-r.lng)/L;let k=0;const Q=setInterval(()=>{const Y=r.lat+K*k,Z=r.lng+X*k,T={...l,latestDocument:{...l.latestDocument,lat:Y,lng:Z}};k++,k>=L&&clearInterval(Q),b(ee=>ee.map(B=>B.latestDocument.imei===s.imei?T:B))},1e3/D)}return l}),String(s==null?void 0:s.imei)===String(S[0].imei)){const l=S[0].params.map(r=>{let v=r.label;return{...r,value:s[v]}});I([{...S[0],params:l}])}}),()=>{ie.off("locationinfo")}),[ie,h,S]),i.useEffect(()=>{Ce(Oe({}))},[n]),i.useEffect(()=>{if((d==null?void 0:d.length)>0&&C.length>0){const s=[],l=[];d==null||d.forEach(r=>{C.some(D=>String(D)===String(r._id))?s.push(r):l.push(r)}),J(s),c(l)}else J([]),c([])},[d,C]),i.useEffect(()=>{console.log("onVehicles",m),console.log("offVehicles",ae)},[m]);const ke=(s,l)=>{l&&q(l.latestDocument.imei),_(a===s?null:s)},$e=s=>{if(console.log("reg id ",s),s){const l=j.filter(r=>{var v;return r.imei&&((v=r.imei[0])==null?void 0:v.mac_id)===s});return l&&l.length>0?l[0].registration_id:"IMEI doesn't exist."}else return"IMEI doesn't exist."},Re=s=>{const l=p&&(p==null?void 0:p.length)>0&&p.find(r=>(r==null?void 0:r.value)===s&&(r==null?void 0:r.vehilce_type));return l?l.vehilce_type:null},Ie=s=>{const l=p&&(p==null?void 0:p.length)>0&&p.find(r=>(r==null?void 0:r.value)===s&&r);y(l||null)};if(De)return"Error loading maps";if(!re)return"Loading maps";if(!U)return null;const Le={height:u?"87vh":"95vh",width:"100%",transition:"transform 0.5s ease-in-out"};return e.jsxs(e.Fragment,{children:[u&&e.jsx(js,{activeParams:S}),e.jsxs(qe,{mapContainerStyle:Le,zoom:Object.keys(n).length>0?15:5.8,center:R,options:{styles:oe?A:""},children:[Object.keys(n).length>0&&e.jsx(vs,{setPlace:F,place:N}),W||t?e.jsx(g,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(je,{})}):H&&H.length>0&&H.map((s,l)=>{var r,v;return e.jsx(fe,{position:{lat:parseFloat((r=s==null?void 0:s.location)==null?void 0:r.lat),lng:parseFloat((v=s==null?void 0:s.location)==null?void 0:v.lng)},animation:window.google.maps.Animation.DROP,icon:{path:V[`${N}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},l)}),se||t?e.jsx(g,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(je,{})}):h&&h.length>0&&h.map((s,l)=>{var v,D,L,K,X,k,Q,Y,Z,T,ee;const r=Re(s.latestDocument.imei);return e.jsx(fe,{position:{lat:s.latestDocument.lat,lng:s.latestDocument.lng},animation:window.google.maps.Animation.DROP,icon:{url:(()=>{switch(r){case"2W":return be;case"3W":return fs;case"4W":return Ue;default:return be}})(),fillColor:Object.keys(n).length>0&&n.imei===s.latestDocument.imei?"green":M.bgColor,fillOpacity:2,strokeWeight:1,scale:2.5,rotation:(v=s==null?void 0:s.latestDocument)==null?void 0:v.heading,size:new window.google.maps.Size(70,70),scaledSize:new window.google.maps.Size(70,70)},onClick:()=>{var B;ke((B=s==null?void 0:s.latestDocument)==null?void 0:B._id,s),Ie(s==null?void 0:s.latestDocument.imei)},children:a===((D=s==null?void 0:s.latestDocument)==null?void 0:D._id)&&e.jsx(Be,{position:{lat:parseFloat((L=s==null?void 0:s.latestDocument)==null?void 0:L.lat),lng:parseFloat((K=s==null?void 0:s.latestDocument)==null?void 0:K.lng)},onCloseClick:()=>_(null),options:{maxWidth:"100%"},visible:a===s.id,children:e.jsx(e.Fragment,{children:e.jsx(Je,{children:e.jsxs(Ke,{children:[e.jsxs($,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Vehicle No:"}),e.jsx(x,{children:$e((X=s==null?void 0:s.latestDocument)==null?void 0:X.imei)})]}),e.jsxs($,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"IMEI No:"}),e.jsx(x,{children:(k=s==null?void 0:s.latestDocument)==null?void 0:k.imei})]}),e.jsxs($,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Chassis No:"}),e.jsx(x,{children:o!=null&&o.chassis_no?o==null?void 0:o.chassis_no:"NA"})]}),e.jsxs($,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Engine No:"}),e.jsx(x,{children:o!=null&&o.engine_no?o==null?void 0:o.engine_no:"NA"})]}),e.jsxs($,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Date of Sell:"}),e.jsx(x,{children:o!=null&&o.sell_date?o==null?void 0:o.sell_date:"NA"})]}),e.jsxs($,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Workshop Name:"}),e.jsx(x,{children:(Y=(Q=o==null?void 0:o.workShop)==null?void 0:Q.city)!=null&&Y.name?`${(Z=o==null?void 0:o.workShop)==null?void 0:Z.name} (City: ${(ee=(T=o==null?void 0:o.workShop)==null?void 0:T.city)==null?void 0:ee.name})`:"NA"})]}),e.jsxs($,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Customer Name:"}),e.jsx(x,{children:o!=null&&o.customer_name?o==null?void 0:o.customer_name:"NA"})]})]})})})},s.id)},l)})]})]})}function Gs(){const{locationData:u,selectedVehicle:t,selectedParameterList:R}=P(c=>c.liveMap),{mode:f}=P(c=>c.dashboard),n=Qe(f),[j,V]=i.useState([]),{w_customer_id:d}=P(c=>c.auth),[H,G]=i.useState(),[C,se]=i.useState(!1),[W,oe]=i.useState(!1),[A,p]=i.useState([]),[U,te]=i.useState(!0),[N,F]=i.useState(!1);let m=ce();i.useEffect(()=>{J()},[]),i.useEffect(()=>{p([]),m(ve([{reg_id:"",imei:"",params:[]}]))},[t]);const J=async()=>{try{F(!0);let c=[],h=[];const b=await m(ze({w_customer_id:d}));if(Array.isArray(b.payload)){b.payload.forEach(a=>{var _,w,q;Array.isArray(a.imei)&&a.imei.length>0&&((_=a.imei[0])!=null&&_.mac_id)?(c.push({id:a.id,label:a.registration_id,value:(w=a.imei[0])==null?void 0:w.mac_id,vehilce_type:a==null?void 0:a.segment,chassis_no:a==null?void 0:a.chassis_no,engine_no:a==null?void 0:a.engine_no,workShop:a==null?void 0:a.workshop,registration_id:a==null?void 0:a.registration_id,sell_date:a==null?void 0:a.sell_date,customer_name:a==null?void 0:a.customer_name}),h.push((q=a.imei[0])==null?void 0:q.mac_id)):(console.error("IMEI data not found for item:",a),ne.error(`IMEI Number not found for the vehicle: ${a==null?void 0:a.registration_id}`))});const S="one",I=h;h.length>0&&m(Ve({type:S,imei:I})),V(c),m(He(c)),F(!1)}else F(!1),console.error("Unexpected data format:",b),ne.error("Unexpected data format:")}catch(c){console.error("Error fetching vehicle data:",c),ne.error(`Error fetching vehicle data: ${c}`)}},ae=async c=>{const{label:h,imei:b,id:S,reg_id:I,checked:a}=c;G(o=>o.map(y=>y.id===S?{...y,checked:!a}:y));let _=[...A],w=[...A];if(!a)u.forEach(o=>{o.latestDocument.imei===b&&(_.push({label:h,value:o.latestDocument[h==="maininputvoltage"?"mainInputVoltage":h]}),w=_,p(_))});else{let o=A.filter(y=>y.label!==h);w=o,p(o)}console.log("tempParamList",w),m(ve([{reg_id:I,imei:b,params:w}]))};return e.jsxs("div",{className:"app",children:[e.jsx(We,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Ae,{title:"Live Map",setShowVehicles:se,showVehicles:C,showParameters:W,setShowParameters:oe,setShowCard:te,showCard:U}),e.jsxs(g,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(g,{style:{width:C||W?"80%":"100%"},children:e.jsx(_s,{showCard:U,loadingVehicle:N})}),C&&e.jsx(g,{style:{width:"20%",backgroundColor:n.grey[100]},children:e.jsx(Ne,{vehicleData:j,title:"Live Map",setParameterData:G,loadingVehicle:N})}),W&&e.jsx(g,{style:{width:"20%",backgroundColor:n.grey[100]},children:e.jsx(Xe,{parametersData:H,setParameterData:G,handleParameterChange:ae})})]})]})]})}export{Gs as default};
