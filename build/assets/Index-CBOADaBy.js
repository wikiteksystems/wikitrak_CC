import{i as L,j as t,a as k,u as ee,t as g,T as m,a8 as Me,a9 as Ve,r as s,v as De,P as Q,aa as ne,l as Ce,_ as Y,m as Pe}from"./index-Dd5O25NJ.js";import{L as $e}from"./LightModeOutlined-DDx2Rx2I.js";import{L as ke}from"./LiveMapTopBar-cMUvo5YN.js";import{V as Le}from"./VehicleMenu-DZ5kL43-.js";import{u as Ie,G as Re,M as ce,I as Ee}from"./esm-6KE22fkC.js";import ze from"./Loader-BOLk6Ff9.js";import{r as I}from"./createSvgIcon-CPJ04Nu6.js";import{B as d,C as pe}from"./CircularProgress-DDtA4O1n.js";import{s as Z}from"./Socket-0N_gnJcr.js";import{P as He}from"./Parameters-CzyoD1qy.js";import{t as Oe}from"./Search-YvtTYn1Q.js";import"./jcb-aCHXMCXy.js";import"./index-DIwncpT-.js";import"./roundedArrow-DJIdObUx.js";import"./TextArea-Cg6PMy_c.js";import"./OutlinedInput-Bl1re5Hz.js";import"./IconButton-CyvlakxD.js";import"./index-Bt5rwmSi.js";import"./Card-EAKuae3F.js";import"./Paper-DDzyGW5p.js";var te={},Ae=L;Object.defineProperty(te,"__esModule",{value:!0});var de=te.default=void 0,Fe=Ae(I()),qe=t;de=te.default=(0,Fe.default)((0,qe.jsx)("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4"}),"Restaurant");var oe={},Ne=L;Object.defineProperty(oe,"__esModule",{value:!0});var he=oe.default=void 0,Ge=Ne(I()),We=t;he=oe.default=(0,Ge.default)((0,We.jsx)("path",{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3m12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4"}),"Hotel");var se={},Be=L;Object.defineProperty(se,"__esModule",{value:!0});var ue=se.default=void 0,Te=Be(I()),Ue=t;ue=se.default=(0,Te.default)((0,Ue.jsx)("path",{d:"m19.77 7.23.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77M12 10H6V5h6zm6 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalGasStation");var ae={},Xe=L;Object.defineProperty(ae,"__esModule",{value:!0});var xe=ae.default=void 0,Je=Xe(I()),Ke=t;xe=ae.default=(0,Je.default)((0,Ke.jsx)("path",{d:"M16.22 12c.68 0 1.22-.54 1.22-1.22 0-.67-.54-1.22-1.22-1.22S15 10.11 15 10.78c0 .68.55 1.22 1.22 1.22m-9.66-1.22c0 .67.54 1.22 1.22 1.22S9 11.46 9 10.78c0-.67-.54-1.22-1.22-1.22s-1.22.55-1.22 1.22M7.61 4 6.28 8h11.43l-1.33-4zm8.67-1s.54.01.92.54c.02.02.03.04.05.07.07.11.14.24.19.4.22.65 1.56 4.68 1.56 4.68v6.5c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81V14H7v1.19c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81v-6.5S6.34 4.67 6.55 4c.05-.16.12-.28.19-.4.03-.02.04-.04.06-.06.38-.53.92-.54.92-.54zM4 17.01h16V19h-7v3h-2v-3H4z"}),"CarRepair");var re={},Qe=L;Object.defineProperty(re,"__esModule",{value:!0});var fe=re.default=void 0,Ye=Qe(I()),Ze=t;fe=re.default=(0,Ye.default)((0,Ze.jsx)("path",{d:"M21 5h-2.64l1.14-3.14L17.15 1l-1.46 4H3v2l2 6-2 6v2h18v-2l-2-6 2-6zm-3.9 8.63L18.89 19H5.11l1.79-5.37.21-.63-.21-.63L5.11 7h13.78l-1.79 5.37-.21.63zM13 9h-2v3H8v2h3v3h2v-3h3v-2h-3z"}),"LocalPharmacyOutlined");var le={},et=L;Object.defineProperty(le,"__esModule",{value:!0});var ve=le.default=void 0,tt=et(I()),ot=t;ve=le.default=(0,tt.default)((0,ot.jsx)("path",{d:"M8 9v1.5h2.25V15h1.5v-4.5H14V9zM6 9H3c-.55 0-1 .45-1 1v5h1.5v-1.5h2V15H7v-5c0-.55-.45-1-1-1m-.5 3h-2v-1.5h2zM21 9h-4.5c-.55 0-1 .45-1 1v5H17v-4.5h1V14h1.5v-3.51h1V15H22v-5c0-.55-.45-1-1-1"}),"AtmOutlined");const st=({setPlace:j,place:i})=>{const{center:A}=k(f=>f.liveMap),b=ee(),a=async f=>{i===f?(b(Me([])),j("")):(j(f),b(Ve({center:A,clickedPlace:f})))};return t.jsxs(d,{sx:{position:"absolute",top:"1vh",left:"20%",display:"flex",justifyContent:"center"},children:[t.jsx(d,{sx:{bgcolor:i==="restaurants"?g.bgColor:"white",color:i==="restaurants"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{a("restaurants")},children:t.jsxs(m,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(de,{style:{height:"17px",position:"relative",top:"1px"}}),"Restaurants"]})}),t.jsx(d,{sx:{bgcolor:i==="hotels"?g.bgColor:"white",color:i==="hotels"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{a("hotels")},children:t.jsxs(m,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(he,{style:{height:"17px",position:"relative",top:"1px"}}),"Hotels"]})}),t.jsx(d,{sx:{bgcolor:i==="hospitals"?g.bgColor:"white",color:i==="hospitals"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{a("hospitals")},children:t.jsxs(m,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(fe,{style:{height:"17px",position:"relative",top:"1px"}}),"Hospitals"]})}),t.jsx(d,{sx:{bgcolor:i==="atm"?g.bgColor:"white",color:i==="atm"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{a("atm")},children:t.jsxs(m,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ve,{style:{height:"17px",position:"relative",top:"1px"}}),"ATMs"]})}),t.jsx(d,{sx:{bgcolor:i==="car_repair"?g.bgColor:"white",color:i==="car_repair"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{a("car_repair")},children:t.jsxs(m,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(xe,{style:{height:"17px",position:"relative",top:"1px"}}),"Service center"]})}),t.jsx(d,{sx:{bgcolor:i==="gasstation"?g.bgColor:"white",color:i==="gasstation"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{a("gasstation")},children:t.jsxs(m,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[t.jsx(ue,{style:{height:"17px",position:"relative",top:"1px"}}),"Gas Stations"]})})]})},at=st,rt="/assets/motorbike-Ve1wpD8A.png";function lt({showCard:j,loadingVehicle:i}){const{center:A,selectedParameterList:b,selectedVehicle:a,vehicleList:f,icons:U,locationData:p,placesData:R,imeiNumbers:F,onlineVehicle:S,loading:X,services_loading:E}=k(e=>e.liveMap),{mode:J,styles:z}=k(e=>e.dashboard),[H,q]=s.useState(null),[N,G]=s.useState(""),[C,y]=s.useState([]),[K,W]=s.useState([]),[l,u]=s.useState(),[c,P]=s.useState(),[_,n]=s.useState(null),[w,v]=s.useState(""),O=ee(),{isLoaded:x,loadError:M}=Ie({googleMapsApiKey:"AIzaSyA_S7GfAh6rJYWQ5X4n4X-3poo3vymuspU",loadingElement:t.jsx(ze,{})});s.useEffect(()=>{x&&q(window.google.maps)},[x]),s.useEffect(()=>{if(console.log("locationData",p),Object.keys(a).length>0){console.log("selectedVehicle",a==null?void 0:a.imei);const e=p==null?void 0:p.filter(o=>{var r;return((r=o==null?void 0:o.latestDocument)==null?void 0:r.imei)==(a==null?void 0:a.imei)});console.log("filteredVehicle",e),u(e)}else u(p)},[p,a]),s.useEffect(()=>{P(b)},[b]),s.useEffect(()=>(Z.on("locationinfo",e=>{if(console.log("locationinfo",e),l==null||l.map(o=>{if(o.latestDocument.imei===e.imei){const r={lat:o.latestDocument.lat,lng:o.latestDocument.lng},h=500,V=60,$=h/(1e3/V),B=(e.lat-r.lat)/$,T=(e.lng-r.lng)/$;let D=0;const be=setInterval(()=>{const Se=r.lat+B*D,ye=r.lng+T*D,_e={...o,latestDocument:{...o.latestDocument,lat:Se,lng:ye}};D++,D>=$&&clearInterval(be),u(we=>we.map(ie=>ie.latestDocument.imei===e.imei?_e:ie))},1e3/V)}return o}),String(e==null?void 0:e.imei)===String(c[0].imei)){const o=c[0].params.map(r=>{let h=r.label;return{...r,value:e[h]}});P([{...c[0],params:o}])}}),()=>{Z.off("locationinfo")}),[Z,l,c]),s.useEffect(()=>{O(De({}))},[a]),s.useEffect(()=>{if((p==null?void 0:p.length)>0&&S.length>0){const e=[],o=[];p==null||p.forEach(r=>{S.some(V=>String(V)===String(r._id))?e.push(r):o.push(r)}),y(e),W(o)}else y([]),W([])},[p,S]),s.useEffect(()=>{console.log("onVehicles",C),console.log("offVehicles",K)},[C]);const ge=(e,o)=>{o&&v(o.latestDocument.imei),n(_===e?null:e)},me=e=>{if(console.log("reg id ",e),e){const o=f.filter(r=>{var h;return r.imei&&((h=r.imei[0])==null?void 0:h.mac_id)===e});return o&&o.length>0?o[0].registration_id:"IMEI doesn't exist."}else return"IMEI doesn't exist."};if(M)return"Error loading maps";if(!x)return"Loading maps";if(!H)return null;const je={height:j?"87vh":"95vh",width:"100%",transition:"transform 0.5s ease-in-out"};return t.jsxs(t.Fragment,{children:[j&&t.jsx(d,{sx:{bgcolor:g.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:c[0].params.length>0?t.jsxs(t.Fragment,{children:[c[0].params.length>0&&t.jsxs(Q,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",c[0].reg_id]}),c.length>0&&c[0].params.map((e,o)=>t.jsx(Q,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:e.label==="speed"?`${e.label} : ${e.value} km/h`:e.label==="mainInputVoltage"?`${e.label} : ${e.value} voltage`:e.label==="ignition"?`${e.label} : ${e.value===!0||(e==null?void 0:e.value)===1?"On":"Off"}`:`${e.label} : ${e.value}`},o))]}):t.jsx(t.Fragment,{children:t.jsx(Q,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})}),t.jsxs(Re,{mapContainerStyle:je,zoom:Object.keys(a).length>0?15:5.8,center:A,options:{styles:J?z:""},children:[Object.keys(a).length>0&&t.jsx(at,{setPlace:G,place:N}),E||i?t.jsx(d,{sx:{position:"absolute",top:"50%",left:"50%"},children:t.jsx(pe,{})}):R&&R.length>0&&R.map((e,o)=>{var r,h;return t.jsx(ce,{position:{lat:parseFloat((r=e==null?void 0:e.location)==null?void 0:r.lat),lng:parseFloat((h=e==null?void 0:e.location)==null?void 0:h.lng)},animation:window.google.maps.Animation.DROP,icon:{path:U[`${N}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},o)}),X||i?t.jsx(d,{sx:{position:"absolute",top:"50%",left:"50%"},children:t.jsx(pe,{})}):l&&l.length>0&&l.map((e,o)=>{var r,h,V,$,B,T;return t.jsx(ce,{position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},animation:window.google.maps.Animation.DROP,icon:{url:rt,fillColor:Object.keys(a).length>0&&a.imei===e.latestDocument.imei?"green":g.bgColor,fillOpacity:2,strokeWeight:1,scale:2,rotation:(r=e==null?void 0:e.latestDocument)==null?void 0:r.heading,size:new window.google.maps.Size(55,55),scaledSize:new window.google.maps.Size(55,55)},onClick:()=>{var D;return ge((D=e==null?void 0:e.latestDocument)==null?void 0:D._id,e)},children:_===((h=e==null?void 0:e.latestDocument)==null?void 0:h._id)&&t.jsx(Ee,{position:{lat:parseFloat((V=e==null?void 0:e.latestDocument)==null?void 0:V.lat),lng:parseFloat(($=e==null?void 0:e.latestDocument)==null?void 0:$.lng)},onCloseClick:()=>n(null),options:{maxWidth:"100%"},visible:_===e.id,children:t.jsxs(t.Fragment,{children:[t.jsxs(m,{children:["Vehicle No:"," ",me((B=e==null?void 0:e.latestDocument)==null?void 0:B.imei)]}),t.jsxs(m,{children:["IMEI No: ",(T=e==null?void 0:e.latestDocument)==null?void 0:T.imei]})]})},e.id)},o)})]})]})}function Dt(){const{locationData:j,selectedVehicle:i,selectedParameterList:A}=k(l=>l.liveMap),{mode:b}=k(l=>l.dashboard),a=Oe(b),[f,U]=s.useState([]),{w_customer_id:p}=k(l=>l.auth),[R,F]=s.useState(),[S,X]=s.useState(!1),[E,J]=s.useState(!1),[z,H]=s.useState([]),[q,N]=s.useState(!1),[G,C]=s.useState(!1);let y=ee();s.useEffect(()=>{K()},[]),s.useEffect(()=>{H([]),y(ne([{reg_id:"",imei:"",params:[]}]))},[i]);const K=async()=>{try{C(!0);let l=[],u=[];const c=await y(Ce({w_customer_id:p}));if(Array.isArray(c.payload)){c.payload.forEach(n=>{var w,v,O;Array.isArray(n.imei)&&n.imei.length>0&&((w=n.imei[0])!=null&&w.mac_id)?(l.push({id:n.id,label:n.registration_id,value:(v=n.imei[0])==null?void 0:v.mac_id}),u.push((O=n.imei[0])==null?void 0:O.mac_id)):(console.error("IMEI data not found for item:",n),Y.error(`IMEI Number not found for the vehicle: ${n==null?void 0:n.registration_id}`))});const P="one",_=u;u.length>0&&y(Pe({type:P,imei:_})),U(l),C(!1)}else C(!1),console.error("Unexpected data format:",c),Y.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),Y.error(`Error fetching vehicle data: ${l}`)}},W=async l=>{const{label:u,imei:c,id:P,reg_id:_,checked:n}=l;F(x=>x.map(M=>M.id===P?{...M,checked:!n}:M));let w=[...z],v=[...z];if(!n)j.forEach(x=>{x.latestDocument.imei===c&&(w.push({label:u,value:x.latestDocument[u]}),v=w,H(w))});else{let x=z.filter(M=>M.label!==u);v=x,H(x)}console.log("tempParamList",v),y(ne([{reg_id:_,imei:c,params:v}]))};return t.jsxs("div",{className:"app",children:[t.jsx($e,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(ke,{title:"Live Map",setShowVehicles:X,showVehicles:S,showParameters:E,setShowParameters:J,setShowCard:N,showCard:q}),t.jsxs(d,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(d,{style:{width:S||E?"80%":"100%"},children:t.jsx(lt,{showCard:q,loadingVehicle:G})}),S&&t.jsx(d,{style:{width:"20%",backgroundColor:a.grey[100]},children:t.jsx(Le,{vehicleData:f,title:"Live Map",setParameterData:F,loadingVehicle:G})}),E&&t.jsx(d,{style:{width:"20%",backgroundColor:a.grey[100]},children:t.jsx(He,{parametersData:R,setParameterData:F,handleParameterChange:W})})]})]})]})}export{Dt as default};
