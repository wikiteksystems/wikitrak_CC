import{i as O,j as e,a as P,u as ce,t as C,T as E,a9 as Ee,aa as Pe,P as le,r as i,v as Oe,ab as ve,l as ze,_ as ne,m as He,a1 as We}from"./index-DBWZCl7Q.js";import{L as Ae}from"./LightModeOutlined-CB8EUrg1.js";import{L as Ve}from"./LiveMapTopBar-PMHJcyFr.js";import{V as Ne}from"./VehicleMenu-CmPeuRmZ.js";import{u as Fe,G as qe,M as fe,I as Be}from"./esm-CVVy79IH.js";import Ge from"./Loader-CY-x6v6M.js";import{r as z}from"./createSvgIcon-CxYJqkE4.js";import{B as g,C as je}from"./CircularProgress-DJ2u2Psz.js";import{s as ie}from"./Socket-0N_gnJcr.js";import{m as be}from"./ol-Y6Emmta9.js";import{f as Ue}from"./preet_tractor-Do6VJBqw.js";import{T as Je,c as Ke,a as y,b as u}from"./TableRow-BLfBtqCt.js";import{P as Xe}from"./Parameters-CX59zDnc.js";import{t as Qe}from"./RegionSelector-BzFE1OYU.js";import"./proj-XQwXs9DQ.js";import"./jcb-aCHXMCXy.js";import"./index-DEf4ov0-.js";import"./index-wjMyRLKB.js";import"./IconButton-BKGS5OcY.js";import"./OutlinedInput-DowbVwHu.js";import"./index-x5BmeDZk.js";import"./Card-Dffkj474.js";import"./Paper-s-nYMkLn.js";import"./CardContent-BHeNTfY0.js";var he={},Ye=O;Object.defineProperty(he,"__esModule",{value:!0});var _e=he.default=void 0,Ze=Ye(z()),Te=e;_e=he.default=(0,Ze.default)((0,Te.jsx)("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4"}),"Restaurant");var ue={},es=O;Object.defineProperty(ue,"__esModule",{value:!0});var Se=ue.default=void 0,ss=es(z()),os=e;Se=ue.default=(0,ss.default)((0,os.jsx)("path",{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3m12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4"}),"Hotel");var de={},ts=O;Object.defineProperty(de,"__esModule",{value:!0});var me=de.default=void 0,rs=ts(z()),as=e;me=de.default=(0,rs.default)((0,as.jsx)("path",{d:"m19.77 7.23.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77M12 10H6V5h6zm6 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalGasStation");var pe={},ls=O;Object.defineProperty(pe,"__esModule",{value:!0});var we=pe.default=void 0,ns=ls(z()),is=e;we=pe.default=(0,ns.default)((0,is.jsx)("path",{d:"M16.22 12c.68 0 1.22-.54 1.22-1.22 0-.67-.54-1.22-1.22-1.22S15 10.11 15 10.78c0 .68.55 1.22 1.22 1.22m-9.66-1.22c0 .67.54 1.22 1.22 1.22S9 11.46 9 10.78c0-.67-.54-1.22-1.22-1.22s-1.22.55-1.22 1.22M7.61 4 6.28 8h11.43l-1.33-4zm8.67-1s.54.01.92.54c.02.02.03.04.05.07.07.11.14.24.19.4.22.65 1.56 4.68 1.56 4.68v6.5c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81V14H7v1.19c0 .45-.35.81-.78.81h-.44c-.43 0-.78-.36-.78-.81v-6.5S6.34 4.67 6.55 4c.05-.16.12-.28.19-.4.03-.02.04-.04.06-.06.38-.53.92-.54.92-.54zM4 17.01h16V19h-7v3h-2v-3H4z"}),"CarRepair");var xe={},cs=O;Object.defineProperty(xe,"__esModule",{value:!0});var Me=xe.default=void 0,hs=cs(z()),us=e;Me=xe.default=(0,hs.default)((0,us.jsx)("path",{d:"M21 5h-2.64l1.14-3.14L17.15 1l-1.46 4H3v2l2 6-2 6v2h18v-2l-2-6 2-6zm-3.9 8.63L18.89 19H5.11l1.79-5.37.21-.63-.21-.63L5.11 7h13.78l-1.79 5.37-.21.63zM13 9h-2v3H8v2h3v3h2v-3h3v-2h-3z"}),"LocalPharmacyOutlined");var ge={},ds=O;Object.defineProperty(ge,"__esModule",{value:!0});var ye=ge.default=void 0,ps=ds(z()),xs=e;ye=ge.default=(0,ps.default)((0,xs.jsx)("path",{d:"M8 9v1.5h2.25V15h1.5v-4.5H14V9zM6 9H3c-.55 0-1 .45-1 1v5h1.5v-1.5h2V15H7v-5c0-.55-.45-1-1-1m-.5 3h-2v-1.5h2zM21 9h-4.5c-.55 0-1 .45-1 1v5H17v-4.5h1V14h1.5v-3.51h1V15H22v-5c0-.55-.45-1-1-1"}),"AtmOutlined");const gs=({setPlace:d,place:r})=>{const{center:R}=P(j=>j.liveMap),f=ce(),n=async j=>{r===j?(f(Ee([])),d("")):(d(j),f(Pe({center:R,clickedPlace:j})))};return e.jsxs(g,{sx:{position:"absolute",top:"1vh",left:"20%",display:"flex",justifyContent:"center"},children:[e.jsx(g,{sx:{bgcolor:r==="restaurants"?C.bgColor:"white",color:r==="restaurants"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("restaurants")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(_e,{style:{height:"17px",position:"relative",top:"1px"}}),"Restaurants"]})}),e.jsx(g,{sx:{bgcolor:r==="hotels"?C.bgColor:"white",color:r==="hotels"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("hotels")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(Se,{style:{height:"17px",position:"relative",top:"1px"}}),"Hotels"]})}),e.jsx(g,{sx:{bgcolor:r==="hospitals"?C.bgColor:"white",color:r==="hospitals"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("hospitals")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(Me,{style:{height:"17px",position:"relative",top:"1px"}}),"Hospitals"]})}),e.jsx(g,{sx:{bgcolor:r==="atm"?C.bgColor:"white",color:r==="atm"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("atm")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(ye,{style:{height:"17px",position:"relative",top:"1px"}}),"ATMs"]})}),e.jsx(g,{sx:{bgcolor:r==="car_repair"?C.bgColor:"white",color:r==="car_repair"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("car_repair")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(we,{style:{height:"17px",position:"relative",top:"1px"}}),"Service center"]})}),e.jsx(g,{sx:{bgcolor:r==="gasstation"?C.bgColor:"white",color:r==="gasstation"?"white":"undefined",borderRadius:"20px",mx:"5px",cursor:"pointer"},onClick:()=>{n("gasstation")},children:e.jsxs(E,{variant:"h6",sx:{fontSize:"14px",py:"10px",px:"12px"},children:[e.jsx(me,{style:{height:"17px",position:"relative",top:"1px"}}),"Gas Stations"]})})]})},vs=gs,fs="/assets/3W_liveMap-sJCozxTr.png";function js({activeParams:d}){return e.jsx(g,{sx:{bgcolor:C.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:d&&d[0].params.length>0?e.jsxs(e.Fragment,{children:[d[0].params.length>0&&e.jsxs(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",d[0].reg_id]}),d.length>0&&d[0].params.map((r,R)=>{r.label==="maininputvoltage"&&console.log("item.label",r.label,r);const f=d[0].params.find(H=>H.label==="ignition"),n=f&&(f.value===!0||f.value===1)?r.value:0,j=r.label==="mainInputVoltage"||r.label==="maininputvoltage";return e.jsx(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:r.label==="speed"?`${r.label} : ${n} km/h`:j&&r.value!==void 0?`${r.label} : ${r.value} voltage`:r.label==="ignition"?`${r.label} : ${r.value===!0||(r==null?void 0:r.value)===1?"On":"Off"}`:`${r.label} : ${r.value!==void 0?r.value:""}`},R)})]}):e.jsx(e.Fragment,{children:e.jsx(le,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})})}const bs="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function _s({showCard:d,loadingVehicle:r}){const{center:R,selectedParameterList:f,selectedVehicle:n,vehicleList:j,icons:H,locationData:p,placesData:W,imeiNumbers:G,onlineVehicle:D,loading:se,services_loading:A}=P(s=>s.liveMap),{mode:oe,styles:V,vehicles_details:x}=P(s=>s.dashboard),[U,te]=i.useState(null),[N,F]=i.useState(""),[m,J]=i.useState([]),[re,c]=i.useState([]),[h,b]=i.useState(),[S,I]=i.useState(),[t,_]=i.useState(null),[w,q]=i.useState(""),[o,M]=i.useState(),Ce=ce(),{isLoaded:ae,loadError:De}=Fe({googleMapsApiKey:`${bs}`,loadingElement:e.jsx(Ge,{})});i.useEffect(()=>{ae&&te(window.google.maps)},[ae]),i.useEffect(()=>{if(console.log("locationData",p),Object.keys(n).length>0){console.log("selectedVehicle",n==null?void 0:n.imei);const s=p==null?void 0:p.filter(l=>{var a;return((a=l==null?void 0:l.latestDocument)==null?void 0:a.imei)==(n==null?void 0:n.imei)});console.log("filteredVehicle",s),b(s)}else b(p)},[p,n]),i.useEffect(()=>{I(f)},[f]),i.useEffect(()=>(ie.on("locationinfo",s=>{if(console.log("locationinfo",s),h==null||h.map(l=>{if(l.latestDocument.imei===s.imei){const a={lat:l.latestDocument.lat,lng:l.latestDocument.lng},v=500,k=60,L=v/(1e3/k),K=(s.lat-a.lat)/L,X=(s.lng-a.lng)/L;let $=0;const Q=setInterval(()=>{const Y=a.lat+K*$,Z=a.lng+X*$,T={...l,latestDocument:{...l.latestDocument,lat:Y,lng:Z}};$++,$>=L&&clearInterval(Q),b(ee=>ee.map(B=>B.latestDocument.imei===s.imei?T:B))},1e3/k)}return l}),String(s==null?void 0:s.imei)===String(S[0].imei)){const l=S[0].params.map(a=>{let v=a.label;return{...a,value:s[v]}});I([{...S[0],params:l}])}}),()=>{ie.off("locationinfo")}),[ie,h,S]),i.useEffect(()=>{Ce(Oe({}))},[n]),i.useEffect(()=>{if((p==null?void 0:p.length)>0&&D.length>0){const s=[],l=[];p==null||p.forEach(a=>{D.some(k=>String(k)===String(a._id))?s.push(a):l.push(a)}),J(s),c(l)}else J([]),c([])},[p,D]),i.useEffect(()=>{console.log("onVehicles",m),console.log("offVehicles",re)},[m]);const ke=(s,l)=>{l&&q(l.latestDocument.imei),_(t===s?null:s)},$e=s=>{if(console.log("reg id ",s),s){const l=j.filter(a=>{var v;return a.imei&&((v=a.imei[0])==null?void 0:v.mac_id)===s});return l&&l.length>0?l[0].registration_id:"IMEI doesn't exist."}else return"IMEI doesn't exist."},Re=s=>{const l=x&&(x==null?void 0:x.length)>0&&x.find(a=>(a==null?void 0:a.value)===s&&(a==null?void 0:a.vehilce_type));return l?l.vehilce_type:null},Ie=s=>{const l=x&&(x==null?void 0:x.length)>0&&x.find(a=>(a==null?void 0:a.value)===s&&a);M(l||null)};if(De)return"Error loading maps";if(!ae)return"Loading maps";if(!U)return null;const Le={height:d?"87vh":"95vh",width:"100%",transition:"transform 0.5s ease-in-out"};return e.jsxs(e.Fragment,{children:[d&&e.jsx(js,{activeParams:S}),e.jsxs(qe,{mapContainerStyle:Le,zoom:Object.keys(n).length>0?15:5.8,center:R,options:{styles:oe?V:""},children:[Object.keys(n).length>0&&e.jsx(vs,{setPlace:F,place:N}),A||r?e.jsx(g,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(je,{})}):W&&W.length>0&&W.map((s,l)=>{var a,v;return e.jsx(fe,{position:{lat:parseFloat((a=s==null?void 0:s.location)==null?void 0:a.lat),lng:parseFloat((v=s==null?void 0:s.location)==null?void 0:v.lng)},animation:window.google.maps.Animation.DROP,icon:{path:H[`${N}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},l)}),se||r?e.jsx(g,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(je,{})}):h&&h.length>0&&h.map((s,l)=>{var v,k,L,K,X,$,Q,Y,Z,T,ee;const a=Re(s.latestDocument.imei);return e.jsx(fe,{position:{lat:s.latestDocument.lat,lng:s.latestDocument.lng},animation:window.google.maps.Animation.DROP,icon:{url:(()=>{switch(a){case"2W":return be;case"3W":return fs;case"4W":return Ue;default:return be}})(),fillColor:Object.keys(n).length>0&&n.imei===s.latestDocument.imei?"green":C.bgColor,fillOpacity:2,strokeWeight:1,scale:2.5,rotation:(v=s==null?void 0:s.latestDocument)==null?void 0:v.heading,size:new window.google.maps.Size(120,120),scaledSize:new window.google.maps.Size(120,120)},onClick:()=>{var B;ke((B=s==null?void 0:s.latestDocument)==null?void 0:B._id,s),Ie(s==null?void 0:s.latestDocument.imei)},children:t===((k=s==null?void 0:s.latestDocument)==null?void 0:k._id)&&e.jsx(Be,{position:{lat:parseFloat((L=s==null?void 0:s.latestDocument)==null?void 0:L.lat),lng:parseFloat((K=s==null?void 0:s.latestDocument)==null?void 0:K.lng)},onCloseClick:()=>_(null),options:{maxWidth:"100%"},visible:t===s.id,children:e.jsx(e.Fragment,{children:e.jsx(Je,{children:e.jsxs(Ke,{children:[e.jsxs(y,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"Vehicle No:"}),e.jsx(u,{children:$e((X=s==null?void 0:s.latestDocument)==null?void 0:X.imei)})]}),e.jsxs(y,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"Vehicle Model:"}),e.jsx(u,{children:o!=null&&o.vehicle_model?o==null?void 0:o.vehicle_model:"NA"})]}),e.jsxs(y,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"IMEI No:"}),e.jsx(u,{children:($=s==null?void 0:s.latestDocument)==null?void 0:$.imei})]}),e.jsxs(y,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"Chassis No:"}),e.jsx(u,{children:o!=null&&o.chassis_no?o==null?void 0:o.chassis_no:"NA"})]}),e.jsxs(y,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"Engine No:"}),e.jsx(u,{children:o!=null&&o.engine_no?o==null?void 0:o.engine_no:"NA"})]}),e.jsxs(y,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"Date of Sell:"}),e.jsx(u,{children:o!=null&&o.sell_date?o==null?void 0:o.sell_date:"NA"})]}),e.jsxs(y,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"Workshop Name:"}),e.jsx(u,{children:(Y=(Q=o==null?void 0:o.workShop)==null?void 0:Q.city)!=null&&Y.name?`${(Z=o==null?void 0:o.workShop)==null?void 0:Z.name} (City: ${(ee=(T=o==null?void 0:o.workShop)==null?void 0:T.city)==null?void 0:ee.name})`:"NA"})]}),e.jsxs(y,{children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"Customer Name:"}),e.jsx(u,{children:o!=null&&o.customer_name?o==null?void 0:o.customer_name:"NA"})]})]})})})},s.id)},l)})]})]})}function Gs(){const{locationData:d,selectedVehicle:r,selectedParameterList:R}=P(c=>c.liveMap),{mode:f}=P(c=>c.dashboard),n=Qe(f),[j,H]=i.useState([]),{w_customer_id:p}=P(c=>c.auth),[W,G]=i.useState(),[D,se]=i.useState(!1),[A,oe]=i.useState(!1),[V,x]=i.useState([]),[U,te]=i.useState(!0),[N,F]=i.useState(!1);let m=ce();i.useEffect(()=>{J()},[]),i.useEffect(()=>{x([]),m(ve([{reg_id:"",imei:"",params:[]}]))},[r]);const J=async()=>{try{F(!0);let c=[],h=[];const b=await m(ze({w_customer_id:p}));if(Array.isArray(b.payload)){b.payload.forEach(t=>{var _,w,q,o;Array.isArray(t.imei)&&t.imei.length>0&&((_=t.imei[0])!=null&&_.mac_id)?(c.push({id:t.id,label:t.registration_id,value:(w=t.imei[0])==null?void 0:w.mac_id,vehilce_type:t==null?void 0:t.segment,chassis_no:t==null?void 0:t.chassis_no,engine_no:t==null?void 0:t.engine_no,workShop:t==null?void 0:t.workshop,registration_id:t==null?void 0:t.registration_id,sell_date:t==null?void 0:t.sell_date,customer_name:t==null?void 0:t.customer_name,vehicle_model:(q=t==null?void 0:t.vehicle_model)==null?void 0:q.name}),h.push((o=t.imei[0])==null?void 0:o.mac_id)):(console.error("IMEI data not found for item:",t),ne.error(`IMEI Number not found for the vehicle: ${t==null?void 0:t.registration_id}`))});const S="one",I=h;h.length>0&&m(He({type:S,imei:I})),H(c),m(We(c)),F(!1)}else F(!1),console.error("Unexpected data format:",b),ne.error("Unexpected data format:")}catch(c){console.error("Error fetching vehicle data:",c),ne.error(`Error fetching vehicle data: ${c}`)}},re=async c=>{const{label:h,imei:b,id:S,reg_id:I,checked:t}=c;G(o=>o.map(M=>M.id===S?{...M,checked:!t}:M));let _=[...V],w=[...V];if(!t)d.forEach(o=>{o.latestDocument.imei===b&&(_.push({label:h,value:o.latestDocument[h==="maininputvoltage"?"mainInputVoltage":h]}),w=_,x(_))});else{let o=V.filter(M=>M.label!==h);w=o,x(o)}console.log("tempParamList",w),m(ve([{reg_id:I,imei:b,params:w}]))};return e.jsxs("div",{className:"app",children:[e.jsx(Ae,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Ve,{title:"Live Map",setShowVehicles:se,showVehicles:D,showParameters:A,setShowParameters:oe,setShowCard:te,showCard:U}),e.jsxs(g,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(g,{style:{width:D||A?"80%":"100%"},children:e.jsx(_s,{showCard:U,loadingVehicle:N})}),D&&e.jsx(g,{style:{width:"20%",backgroundColor:n.grey[100]},children:e.jsx(Ne,{vehicleData:j,title:"Live Map",setParameterData:G,loadingVehicle:N})}),A&&e.jsx(g,{style:{width:"20%",backgroundColor:n.grey[100]},children:e.jsx(Xe,{parametersData:W,setParameterData:G,handleParameterChange:re})})]})]})]})}export{Gs as default};
