import{j as e,t as ae,B as le,m as D,r as c,T as ie,l as be,M as ke,w as ue,S as he,F as ye,G as Ie,J as Ce,K as Ee}from"./index-CzU0MrZ2.js";import{d as Me,L as We}from"./LiveMapTopBar-DPJzOUqv.js";import{V as De}from"./VehicleMenu-BVqzAfkH.js";import{u as Ne,G as Ve,M as pe,I as Ae}from"./esm-CFLtqzI4.js";import{F as Le}from"./Loader--_qDy8Vw.js";import{L as Pe}from"./LiveMapServices-DleJGFOP.js";import{s as ce}from"./Socket-0N_gnJcr.js";import{m as ge}from"./motorbike-Ci4voNFa.js";import{f as Oe}from"./4W-D15HTFB5.js";import{t as $e}from"./preet_tractor-Cgp22Ik3.js";import{B as b,C as xe}from"./menu2-DLPWfC1M.js";import{d as Fe}from"./Info-Clu_OVsP.js";import{T as Ge,a as Re,b as W}from"./TableRow-0VELHQXn.js";import{T as p,P as ze}from"./Parameters-BSCKIU1D.js";import{L as Be,t as Ue}from"./LeftSideBar2-CeQwbDJA.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as Je}from"./VehicleGroups-Br1vGaJt.js";import"./createSvgIcon-Dbtg9utC.js";import"./useControlled-D09_4qfy.js";import"./jcb-aCHXMCXy.js";import"./index-CXhVgXXS.js";import"./index-JUUUT0Oz.js";import"./index-CbAhD8-w.js";import"./Card-Ti56Uznj.js";import"./CardContent-DVkIHY4u.js";const Ke="/assets/3W_liveMap-sJCozxTr.png";function He({activeParams:u}){return e.jsx(b,{sx:{bgcolor:ae.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:u&&u[0].params.length>0?e.jsxs(e.Fragment,{children:[u[0].params.length>0&&e.jsxs(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",u[0].reg_id]}),u.length>0&&u[0].params.map((r,j)=>{r.label==="maininputvoltage"&&console.log("item.label",r.label,r);const h=u[0].params.find(N=>N.label==="ignition"),o=h&&(h.value===!0||h.value===1)?r.value:0,C=r.label==="mainInputVoltage"||r.label==="maininputvoltage";return e.jsx(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:r.label==="speed"?`${r.label} : ${o} km/h`:C&&r.value!==void 0?`${r.label} : ${r.value} voltage`:r.label==="ignition"?`${r.label} : ${r.value===!0||(r==null?void 0:r.value)===1?"On":"Off"}`:`${r.label} : ${r.value!==void 0?r.value:""}`},j)})]}):e.jsx(e.Fragment,{children:e.jsx(le,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})})}const Xe=({label:u,value:r})=>e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[e.jsx(ie,{variant:"body2",color:"textSecondary",children:u}),e.jsx(ie,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:r||"N/A"})]}),qe=(u,r)=>(u==null?void 0:u.find(j=>{var h,o;return((o=(h=j.imei)==null?void 0:h[0])==null?void 0:o.mac_id)===r.imei}))||{},fe=({title:u,details:r})=>e.jsx(b,{sx:{width:"45%"},children:r.map(({label:j,value:h})=>e.jsx(Xe,{label:j,value:h},j))});function Qe({handleVehicleInfo:u}){var k,F,m,y,V;const{collapsed:r}=D(_=>_.auth),{vehicleList:j,selectedVehicle:h}=D(_=>_.liveMap),[o,C]=c.useState({});c.useEffect(()=>{C(qe(j,h))},[j,h]);const N=[{label:"Vehicle No:",value:o==null?void 0:o.registration_id},{label:"Model:",value:(k=o==null?void 0:o.vehicle_model)==null?void 0:k.name},{label:"IMEI No:",value:(m=(F=o==null?void 0:o.imei)==null?void 0:F[0])==null?void 0:m.mac_id},{label:"Chassis No:",value:o==null?void 0:o.chassis_no},{label:"Engine No:",value:o==null?void 0:o.engine_no}],d=[{label:"Customer Name:",value:(y=o==null?void 0:o.user)!=null&&y.us_user?`${o.user.us_user.first_name.charAt(0).toUpperCase()}${o.user.us_user.first_name.slice(1)} ${o.user.us_user.last_name.charAt(0).toUpperCase()}${o.user.us_user.last_name.slice(1)}`:null},{label:"Date of Sell:",value:o==null?void 0:o.sell_date},{label:"Workshop Name:",value:(V=o==null?void 0:o.workshop)==null?void 0:V.name}];return e.jsxs(b,{sx:{position:"absolute",top:"578px",left:r?"280px":"450px",zIndex:1,background:ae.bgShadow,p:2,borderRadius:2,color:"white",width:"60%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(ie,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),e.jsx(Me,{sx:{cursor:"pointer",color:"black"},onClick:u})]}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(fe,{title:"Vehicle Details",details:N}),e.jsx(fe,{title:"Customer Details",details:d})]})]})}const Ye="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function Ze({showCard:u,loadingVehicle:r}){const{center:j,selectedParameterList:h,selectedVehicle:o,vehicleList:C,icons:N,locationData:d,placesData:k,imeiNumbers:F,onlineVehicle:m,loading:y,services_loading:V}=D(s=>s.liveMap),{mode:_,styles:H,vehicles_details:g}=D(s=>s.dashboard),{collapsed:G}=D(s=>s.auth),[X,ne]=c.useState(null),[R,z]=c.useState(""),[B,U]=c.useState([]),[E,q]=c.useState([]),[I,J]=c.useState(),[i,w]=c.useState(),[v,A]=c.useState(null),[Q,l]=c.useState(""),[t,S]=c.useState(),[M,x]=c.useState(!1),L=be(),{isLoaded:re,loadError:je}=Ne({googleMapsApiKey:`${Ye}`,loadingElement:e.jsx(Le,{})});c.useEffect(()=>{re&&ne(window.google.maps)},[re]),c.useEffect(()=>{if(console.log("locationData",d),Object.keys(o).length>0){console.log("selectedVehicle",o==null?void 0:o.imei);const s=d==null?void 0:d.filter(a=>{var n;return((n=a==null?void 0:a.latestDocument)==null?void 0:n.imei)==(o==null?void 0:o.imei)});console.log("filteredVehicle",s),J(s)}else J(d)},[d,o]),c.useEffect(()=>{w(h)},[h]),c.useEffect(()=>(ce.on("locationinfo",s=>{if(console.log("locationinfo",s),I==null||I.map(a=>{if(a.latestDocument.imei===s.imei){const n={lat:a.latestDocument.lat,lng:a.latestDocument.lng},f=500,P=60,$=f/(1e3/P),Y=(s.lat-n.lat)/$,Z=(s.lng-n.lng)/$;let O=0;const T=setInterval(()=>{const ee=n.lat+Y*O,se=n.lng+Z*O,oe={...a,latestDocument:{...a.latestDocument,lat:ee,lng:se}};O++,O>=$&&clearInterval(T),J(te=>te.map(K=>K.latestDocument.imei===s.imei?oe:K))},1e3/P)}return a}),String(s==null?void 0:s.imei)===String(i[0].imei)){const a=i[0].params.map(n=>{let f=n.label;return{...n,value:s[f]}});w([{...i[0],params:a}])}}),()=>{ce.off("locationinfo")}),[ce,I,i]),c.useEffect(()=>{L(ke({})),x(!0)},[o]),c.useEffect(()=>{if((d==null?void 0:d.length)>0&&m.length>0){const s=[],a=[];d==null||d.forEach(n=>{m.some(P=>String(P)===String(n._id))?s.push(n):a.push(n)}),U(s),q(a)}else U([]),q([])},[d,m]),c.useEffect(()=>{console.log("onVehicles",B),console.log("offVehicles",E)},[B]);const we=(s,a)=>{a&&l(a.latestDocument.imei),A(v===s?null:s)},me=s=>{if(console.log("reg id ",s),s){const a=C.filter(n=>{var f;return n.imei&&((f=n.imei[0])==null?void 0:f.mac_id)===s});return a&&a.length>0?a[0].registration_id:"IMEI doesn't exist."}else return"IMEI doesn't exist."},_e=s=>{const a=g&&(g==null?void 0:g.length)>0&&g.find(n=>(n==null?void 0:n.value)===s&&(n==null?void 0:n.vehilce_type));return console.log("vehicle ? vehicle.vehilce_type : null",a?a.vehilce_type:"na"),a?a.vehilce_type:null},ve=s=>{const a=g&&(g==null?void 0:g.length)>0&&g.find(n=>(n==null?void 0:n.value)===s&&n);S(a||null)},de=()=>{Object.keys(o).length>0||M?x(!M):ue.error("Please select any vehicle")};if(je)return"Error loading maps";if(!re)return"Loading maps";if(!X)return null;const Se={height:u?"85vh":"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return e.jsxs(e.Fragment,{children:[u&&e.jsx(He,{activeParams:i}),e.jsx(b,{sx:{position:"absolute",top:"750px",left:G?"74px":"250px",zIndex:1,background:ae.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:e.jsxs(le,{sx:{color:"white"},onClick:de,children:[M?"Hide":"Show"," Vehicle Info",e.jsx(Fe,{})]})}),M===!0&&e.jsx(Qe,{handleVehicleInfo:de}),e.jsxs(Ve,{mapContainerStyle:Se,zoom:Object.keys(o).length>0?15:5.8,center:j,options:{styles:_?H:""},children:[Object.keys(o).length>0&&e.jsx(Pe,{setPlace:z,place:R}),V||r?e.jsx(b,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(xe,{})}):k&&k.length>0&&k.map((s,a)=>{var n,f;return e.jsx(pe,{position:{lat:parseFloat((n=s==null?void 0:s.location)==null?void 0:n.lat),lng:parseFloat((f=s==null?void 0:s.location)==null?void 0:f.lng)},animation:window.google.maps.Animation.DROP,icon:{path:N[`${R}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},a)}),y||r?e.jsx(b,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(xe,{})}):I&&I.length>0&&I.map((s,a)=>{var f,P,$,Y,Z,O,T,ee,se,oe,te;const n=_e(s.latestDocument.imei);return e.jsx(pe,{position:{lat:s.latestDocument.lat,lng:s.latestDocument.lng},animation:window.google.maps.Animation.DROP,icon:{url:(()=>{switch(n){case"2W":return ge;case"3W":return Ke;case"4W":return Oe;case"Tractor":return $e;default:return ge}})(),fillColor:Object.keys(o).length>0&&o.imei===s.latestDocument.imei?"green":ae.bgColor,fillOpacity:2,strokeWeight:1,scale:2.5,rotation:(f=s==null?void 0:s.latestDocument)==null?void 0:f.heading,size:new window.google.maps.Size(70,70),scaledSize:new window.google.maps.Size(70,70)},onClick:()=>{var K;we((K=s==null?void 0:s.latestDocument)==null?void 0:K._id,s),ve(s==null?void 0:s.latestDocument.imei)},children:v===((P=s==null?void 0:s.latestDocument)==null?void 0:P._id)&&e.jsx(Ae,{position:{lat:parseFloat(($=s==null?void 0:s.latestDocument)==null?void 0:$.lat),lng:parseFloat((Y=s==null?void 0:s.latestDocument)==null?void 0:Y.lng)},onCloseClick:()=>A(null),options:{maxWidth:"100%"},visible:v===s.id,children:e.jsx(e.Fragment,{children:e.jsx(Ge,{children:e.jsxs(Re,{children:[e.jsxs(W,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Vehicle No:"}),e.jsx(p,{children:me((Z=s==null?void 0:s.latestDocument)==null?void 0:Z.imei)})]}),e.jsxs(W,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Vehicle Model:"}),e.jsx(p,{children:t!=null&&t.vehicle_model?t==null?void 0:t.vehicle_model:"NA"})]}),e.jsxs(W,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"IMEI No:"}),e.jsx(p,{children:(O=s==null?void 0:s.latestDocument)==null?void 0:O.imei})]}),e.jsxs(W,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Chassis No:"}),e.jsx(p,{children:t!=null&&t.chassis_no?t==null?void 0:t.chassis_no:"NA"})]}),e.jsxs(W,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Engine No:"}),e.jsx(p,{children:t!=null&&t.engine_no?t==null?void 0:t.engine_no:"NA"})]}),e.jsxs(W,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Date of Sell:"}),e.jsx(p,{children:t!=null&&t.sell_date?t==null?void 0:t.sell_date:"NA"})]}),e.jsxs(W,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Workshop Name:"}),e.jsx(p,{children:(ee=(T=t==null?void 0:t.workShop)==null?void 0:T.city)!=null&&ee.name?`${(se=t==null?void 0:t.workShop)==null?void 0:se.name} (City: ${(te=(oe=t==null?void 0:t.workShop)==null?void 0:oe.city)==null?void 0:te.name})`:"NA"})]}),e.jsxs(W,{children:[e.jsx(p,{sx:{fontWeight:"bold"},children:"Customer Name:"}),e.jsx(p,{children:t!=null&&t.customer_name?t==null?void 0:t.customer_name:"NA"})]})]})})})},s.id)},a)})]})]})}function ys(){const{locationData:u,selectedVehicle:r,selectedParameterList:j}=D(i=>i.liveMap),{mode:h,selectedVehicleGroup:o}=D(i=>i.dashboard),C=Ue(h),[N,d]=c.useState([]),{w_customer_id:k}=D(i=>i.auth),[F,m]=c.useState(),[y,V]=c.useState(!1),[_,H]=c.useState(!1),[g,G]=c.useState([]),[X,ne]=c.useState(!0),[R,z]=c.useState(!1),[B,U]=c.useState(!1);let E=be();c.useEffect(()=>{q()},[]),c.useEffect(()=>{G([]),E(he([{reg_id:"",imei:"",params:[]}]))},[r]);const q=async()=>{try{z(!0);let i=[],w=[];const v=await E(ye({w_customer_id:k}));if(Array.isArray(v.payload)){v.payload.forEach(l=>{var t,S,M,x;Array.isArray(l.imei)&&l.imei.length>0&&((t=l.imei[0])!=null&&t.mac_id)?(i.push({id:l.id,label:l.registration_id,value:(S=l.imei[0])==null?void 0:S.mac_id,vehilce_type:l==null?void 0:l.segment,chassis_no:l==null?void 0:l.chassis_no,engine_no:l==null?void 0:l.engine_no,workShop:l==null?void 0:l.workshop,registration_id:l==null?void 0:l.registration_id,sell_date:l==null?void 0:l.sell_date,customer_name:l==null?void 0:l.customer_name,vehicle_model:(M=l==null?void 0:l.vehicle_model)==null?void 0:M.name,vehicle_group:l==null?void 0:l.vehicle_group}),w.push((x=l.imei[0])==null?void 0:x.mac_id)):console.error("IMEI data not found for item:",l)});const A="one",Q=w;w.length>0&&E(Ie({type:A,imei:Q})),d(i),E(Ce(i)),E(Ee({w_customer_id:k})),z(!1)}else z(!1),console.error("Unexpected data format:",v),ue.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),ue.error(`Error fetching vehicle data: ${i}`)}},I=async i=>{const{label:w,imei:v,id:A,reg_id:Q,checked:l}=i;m(x=>x.map(L=>L.id===A?{...L,checked:!l}:L));let t=[...g],S=[...g];if(!l)u.forEach(x=>{x.latestDocument.imei===v&&(t.push({label:w,value:x.latestDocument[w==="maininputvoltage"?"mainInputVoltage":w]}),S=t,G(t))});else{let x=g.filter(L=>L.label!==w);S=x,G(x)}console.log("tempParamList",S),E(he([{reg_id:Q,imei:v,params:S}]))},J=N.filter(i=>Object.keys(o).length===0||i.vehicle_group===o.id);return e.jsxs("div",{className:"app",children:[e.jsx(Be,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(We,{title:"Live Map",setShowVehicles:V,showVehicles:y,showParameters:_,setShowParameters:H,setShowCard:ne,showCard:X,setShowVehiclesGroup:U,showVehiclesGroup:B}),e.jsx(Je,{setShowVehiclesGroup:U,showVehiclesGroup:B,where:"livemap"}),e.jsxs(b,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(b,{style:{width:y||_?"80%":"100%"},children:e.jsx(Ze,{showCard:X,loadingVehicle:R})}),y&&e.jsx(b,{style:{width:"20%",backgroundColor:C.grey[100]},children:e.jsx(De,{vehicleData:J,title:"Live Map",setParameterData:m,loadingVehicle:R,setShowVehicles:V,showVehicles:y,showParameters:_,setShowParameters:H})}),_&&e.jsx(b,{style:{width:"20%",backgroundColor:C.grey[100]},children:e.jsx(ze,{parametersData:F,setParameterData:m,handleParameterChange:I})})]})]})]})}export{ys as default};
