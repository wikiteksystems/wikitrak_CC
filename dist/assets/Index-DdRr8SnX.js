import{a4 as De,j as o,z as te,b as l,D as Oe,T as J,F as ge,R as tt,y as Te,B as je,a0 as ot,a5 as nt,a6 as st,I as rt,C as oe,a7 as at,Q as lt,a8 as Re,V as ct,W as it,Y as ut,Z as dt,a9 as Ne}from"./index-XF1F12r5.js";import{L as ft}from"./LiveMapTopBar-ASSRj22K.js";import{V as ht}from"./VehicleMenu-Bf02HyKC.js";import{t as gt}from"./SearchTab-zqhplYSV.js";import{F as pt}from"./Loader-DMJhLNdt.js";import{L as xt}from"./LiveMapServices-DYkd5q5i.js";import{s as _e}from"./Socket-0N_gnJcr.js";import{P as yt}from"./Parameters-DnOJCt9R.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as bt}from"./LeftSideBar2-DW3ecaUW.js";import{V as vt}from"./VehicleGroups-CVE-f5CH.js";import{u as mt,G as kt,M as wt,m as we}from"./motorbike-PY_By168.js";import{M as jt,r as St,g as _t,y as Dt,b as It,a as Ct,c as Mt,d as Vt,e as Lt,f as Et,h as $t,i as Rt,j as Nt,k as At,l as Ot,m as Tt,n as Bt,o as Ft,p as Wt,q as zt,s as Ht,t as Pt,u as Gt,v as Ut,w as qt}from"./black_bike-DRxQnFzk.js";import{d as Be}from"./Close-DDpg7ePx.js";import{r as Ie}from"./createSvgIcon-PHVT_TUq.js";import"./NewLoader--9HteRdz.js";import{d as Kt}from"./Info-BMo22ooM.js";import{B as w,C as Yt}from"./CircularProgress-deK7ax3h.js";import{D as Zt,a as Jt,b as Qt,c as Xt}from"./DialogTitle-CR-4uJax.js";import{T as eo}from"./TextField-CmRwcNUM.js";import"./jcb-aCHXMCXy.js";import"./menu2-BhY0ndpL.js";import"./useControlled-CsdylFJL.js";import"./Autocomplete-BUCWXTc3.js";import"./index-Lm56A98y.js";import"./Card-kXMHmN6i.js";import"./CardContent-WMyJVaNd.js";var Ce={},to=De;Object.defineProperty(Ce,"__esModule",{value:!0});var Fe=Ce.default=void 0,oo=to(Ie()),no=o;Fe=Ce.default=(0,oo.default)((0,no.jsx)("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"NorthEast");var Me={},so=De;Object.defineProperty(Me,"__esModule",{value:!0});var We=Me.default=void 0,ro=so(Ie()),ao=o;We=Me.default=(0,ro.default)((0,ao.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn");const lo=({label:y,value:x})=>o.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[o.jsx(J,{variant:"body2",color:"textSecondary",children:y}),o.jsx(J,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:x||"N/A"})]}),co=(y,x)=>(y==null?void 0:y.find(D=>{var L,v;return((v=(L=D.imei)==null?void 0:L[0])==null?void 0:v.mac_id)===x}))||{},Ae=({title:y,details:x})=>o.jsx(w,{sx:{width:"45%"},children:x.map(({label:D,value:L})=>o.jsx(lo,{label:D,value:L},D))});function io({handleVehicleInfo:y,udpatedParams:x,handleClickOpen:D}){var se,M,F,q,I,K,X,ee,A,W,le,re;const{collapsed:L}=te(p=>p.auth),{vehicleList:v,selectedVehicle:j,selectedImei:P}=te(p=>p.liveMap),[d,de]=l.useState({});let[r,ne]=l.useState(null);l.useEffect(()=>{let p=x&&(x==null?void 0:x.length)>0&&(x==null?void 0:x.find(b=>{var $;return Number(($=b==null?void 0:b.latestDocument)==null?void 0:$.imei)===Number(P)}));ne(p)},[x,P]),l.useEffect(()=>{de(co(v,P))},[v,P]);const Q=(p,b)=>{const $=`https://www.google.com/maps?q=${p},${b}`;window.open($,"_blank")},G=p=>{var m,O;let b=(m=p==null?void 0:p.latestDocument)==null?void 0:m.ignition,$=(O=p==null?void 0:p.latestDocument)==null?void 0:O.speed;return b===!0||b===1?$:0},U=[{label:"Vehicle No:",value:d==null?void 0:d.registration_id},{label:"Model:",value:(se=d==null?void 0:d.vehicle_model)==null?void 0:se.name},{label:"IMEI No:",value:(F=(M=d==null?void 0:d.imei)==null?void 0:M[0])==null?void 0:F.mac_id},{label:"Chassis No:",value:d==null?void 0:d.chassis_no},{label:"Engine No:",value:d==null?void 0:d.engine_no}],pe=[{label:"Customer Name:",value:(q=d==null?void 0:d.user)!=null&&q.us_user?`${d.user.us_user.first_name.charAt(0).toUpperCase()}${d.user.us_user.first_name.slice(1)} ${d.user.us_user.last_name.charAt(0).toUpperCase()}${d.user.us_user.last_name.slice(1)}`:null},{label:"Mobile: ",value:((I=d==null?void 0:d.user)==null?void 0:I.us_user)&&d.user.us_user.mobile},{label:"Date of Sell:",value:d==null?void 0:d.sell_date},{label:"Workshop Name:",value:(K=d==null?void 0:d.workshop)==null?void 0:K.name}];let E={border:"2px solid black",borderRadius:"5px",padding:"5px",color:"black"};const fe=p=>{let b=v.find(m=>{var O,ae;return((O=m==null?void 0:m.imei)==null?void 0:O.length)>0&&((ae=m.imei[0])==null?void 0:ae.mac_id)==p.imei}),$=parseFloat((b==null?void 0:b.load_capacity)||0)/49*parseFloat((p==null?void 0:p.analogInput1)||0);return`${parseFloat($).toFixed(2)} Kgs`||0};return o.jsxs(w,{sx:{position:"absolute",top:"600px",left:L?"280px":"450px",zIndex:1,background:Oe.bgShadow,p:2,borderRadius:2,color:"white",width:"72%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[o.jsx(J,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),o.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[o.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",width:"100%",marginLeft:"10px"},children:[o.jsx(w,{sx:E,children:o.jsxs(J,{children:["Ignition:"," ",((X=r==null?void 0:r.latestDocument)==null?void 0:X.ignition)===!0||((ee=r==null?void 0:r.latestDocument)==null?void 0:ee.ignition)===1?"On":"Off"]})}),o.jsx(w,{sx:E,children:o.jsxs(J,{children:["Speed: ",G(r)," km/h"]})}),o.jsx(w,{sx:E,children:o.jsxs(J,{children:["Main Voltage:"," ",r?`${(A=r==null?void 0:r.latestDocument)==null?void 0:A.mainInputVoltage} Voltage`:0]})}),o.jsx(w,{sx:E,children:o.jsxs(J,{children:["Heading:"," ",r?`${(W=r==null?void 0:r.latestDocument)==null?void 0:W.heading} deg`:0]})}),r&&((le=r==null?void 0:r.latestDocument)==null?void 0:le.venderId)==="VT200"&&o.jsx(w,{sx:E,children:o.jsxs(J,{children:["Load:"," ",r?fe(r==null?void 0:r.latestDocument):0]})}),r&&((re=r==null?void 0:r.latestDocument)==null?void 0:re.venderId)==="VT200"&&o.jsx(w,{sx:E,children:o.jsxs(J,{children:["Remaining fuel:"," ","0 Ltr"]})}),o.jsxs(ge,{disabled:!r,onClick:()=>{var p,b;Q((p=r==null?void 0:r.latestDocument)==null?void 0:p.lat,(b=r==null?void 0:r.latestDocument)==null?void 0:b.lng)},children:["Navigate to map",o.jsx(Fe,{})]}),o.jsxs(ge,{disabled:!r,onClick:()=>{D()},children:["Share live location",o.jsx(We,{})]})]}),o.jsx(Be,{sx:{cursor:"pointer",color:"black"},onClick:y})]}),o.jsxs(w,{sx:{display:"flex",justifyContent:"space-between"},children:[o.jsx(Ae,{title:"Vehicle Details",details:U}),o.jsx(Ae,{title:"Customer Details",details:pe})]})]})}var Ve={},uo=De;Object.defineProperty(Ve,"__esModule",{value:!0});var ze=Ve.default=void 0,fo=uo(Ie()),ho=o;ze=Ve.default=(0,fo.default)((0,ho.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");const go="http://139.59.37.47:3031",po="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function xo({showCard:y,loadingVehicle:x,vehicleData:D}){const{center:L,selectedParameterList:v,selectedVehicle:j,vehicleList:P,zoom:d,icons:de,locationData:r,placesData:ne,imeiNumbers:Q,selectedImei:G,onlineVehicle:U,loading:pe,services_loading:E}=te(e=>e.liveMap),{mode:fe,styles:se,vehicles_details:M}=te(e=>e.dashboard),F=l.useRef(null),{collapsed:q}=te(e=>e.auth),[I,K]=l.useState(null),[X,ee]=l.useState(""),[A,W]=l.useState([]),[le,re]=l.useState(),[p,b]=l.useState(null);l.useState("");const[$,m]=l.useState(),[O,ae]=l.useState(!1),[T,he]=l.useState(null),[xe,i]=tt.useState(!1),[g,V]=l.useState(""),Y=async()=>{var e;if(console.log("selected vehicel",G),!G)return oe.error("Please select vehicle");try{const t=await at.post(`${go}/api/generate-token`,{vehicleNo:G});if((e=t==null?void 0:t.data)!=null&&e.token){const n=`http://cc.wikitrak.in/live-location/${G}/${t.data.token}`;V(n),i(!0)}}catch(t){oe.error("Error occurred while generating link"),i(!1),V(!1),console.error("Error generating link",t)}},Z=()=>{Y()},a=()=>{i(!1)},S=Te(),R={},B=l.useRef([]),C=l.useRef(null),N=l.useRef({}),{isLoaded:ce,loadError:ye}=mt({googleMapsApiKey:`${po}`,loadingElement:o.jsx(pt,{})});l.useEffect(()=>{ce&&K(window.google.maps)},[ce]),l.useEffect(()=>{},[d]),l.useEffect(()=>{var e,t,n,s;if(Object.keys(j).length>0){const f=((T==null?void 0:T.length)>0?T:r).filter(u=>{var h;return((h=u==null?void 0:u.latestDocument)==null?void 0:h.imei)===(j==null?void 0:j.imei)});if(f.length>0){W(f);const u={lat:(t=(e=f[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(s=(n=f[0])==null?void 0:n.latestDocument)==null?void 0:s.lng};S(je(u))}}},[r,j]),l.useEffect(()=>{if(!(Object.keys(j).length>0)){const e=r.filter(t=>D.some(n=>n.value===t.latestDocument.imei));W(e),he(e)}},[r,j,D]),l.useEffect(()=>{var e,t,n,s;if(Object.keys(j).length>0){const f=((T==null?void 0:T.length)>0?T:r).filter(u=>{var h;return((h=u==null?void 0:u.latestDocument)==null?void 0:h.imei)===(j==null?void 0:j.imei)});if(f.length>0){W(f);const u={lat:(t=(e=f[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(s=(n=f[0])==null?void 0:n.latestDocument)==null?void 0:s.lng};S(je(u))}}else{const c=r.filter(f=>D.some(u=>u.value===f.latestDocument.imei));W(c),he(c)}},[r,j]),l.useEffect(()=>{re(v)},[v]),l.useEffect(()=>{S(ot({})),ae(!0)},[j]),l.useEffect(()=>{if(console.log("before: ",A),!I)return;const e=C.current;let t=null;return(async()=>{console.log("after: ",A);const s=await be(A,e);t&&t.clearMarkers(),t=Ue(s,e),_e.on("locationinfo",c=>{console.log("selected vehicel",G),Ke(c,B),he(f=>{const u=Array.isArray(f)?f:[],h=u.findIndex(k=>Number(k.latestDocument.imei)===Number(c.imei));if(h!==-1){const k=[...u];return k[h]={...k[h],latestDocument:{...k[h].latestDocument,...c}},k}else return[...u,{_id:c.imei,latestDocument:c}]})})})(),()=>{t&&t.clearMarkers(),Object.keys(N.current).forEach(s=>cancelAnimationFrame(N.current[s])),_e.off("locationinfo")}},[I,A,_e,le,B,r]);const be=(e,t)=>e.map(n=>{const s=n.latestDocument.imei,c=B.current[s]||ve(n,t);return B.current[s]&&me(n,c),c}),ve=(e,t)=>{const n=e.latestDocument.imei,s=new I.Marker({position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},map:t,icon:Se(e)});return s.addListener("click",()=>Ge(e,s,t)),B.current[n]=s,s},me=async(e,t)=>{var h;const n=t.getPosition(),s=((h=t.getIcon())==null?void 0:h.rotation)||0,c={lat:e.latestDocument.lat,lng:e.latestDocument.lng},f=e.latestDocument.heading||0;Ee(t,n,c,s,f);const u=await Se(e);t.setIcon(u)},Se=async e=>{var h,k,_,z,H;const t=(h=e==null?void 0:e.latestDocument)==null?void 0:h.imei,n=Ye(t),s=Je(e==null?void 0:e.latestDocument,n),c=((k=e==null?void 0:e.latestDocument)==null?void 0:k.heading)||0;return Le((_=e==null?void 0:e.latestDocument)==null?void 0:_.imei)&&He((z=e==null?void 0:e.latestDocument)==null?void 0:z.imei),{url:await Pe(s,c),fillOpacity:2,strokeWeight:1,scale:12,rotation:(H=e==null?void 0:e.latestDocument)==null?void 0:H.heading,size:new I.Size(30,30),scaledSize:new I.Size(30,30)}},Le=e=>U.includes(Number(e)),He=e=>r==null?void 0:r.some(t=>Number(t.latestDocument.imei)===Number(e)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),Pe=(e,t,n,s=80)=>{const c=`${e}-${t}-${s}-${n}`;if(R[c])return Promise.resolve(R[c]);const f=document.createElement("canvas"),u=f.getContext("2d");f.width=s,f.height=s;const h=new Image;return h.src=e,new Promise(k=>{h.onload=()=>{if(u.clearRect(0,0,f.width,f.height),u.translate(s/2,s/2),u.rotate(t*Math.PI/180),u.translate(-s/2,-s/2),u.drawImage(h,0,0,s,s),n){const H=s-30-5,ie=s-30-5;u.beginPath(),u.arc(H,ie,30/2,0,Math.PI*2),u.fillStyle=n,u.fill()}const _=f.toDataURL("image/png");R[c]=_,k(_)},h.onerror=_=>{console.error("Error loading image for rotation:",_),k(e)}})},Ge=(e,t,n)=>{Qe(e.latestDocument._id,e,t,n),Xe(e.latestDocument.imei)},Ee=(e,t,n,s,c)=>{const u=performance.now(),h=()=>{const k=performance.now()-u,_=Math.min(k/500,1),z=t.lat()+_*(n.lat-t.lat()),H=t.lng()+_*(n.lng-t.lng()),ie=(c-s+360)%360-180,ke=(s+ie*_+360)%360;e.setPosition({lat:z,lng:H});const ue=e.getIcon();ue&&typeof ue=="object"&&e.setIcon({...ue,rotation:ke}),_<1?N.current[e.getPosition()]=requestAnimationFrame(h):(e.setPosition(n),ue&&typeof ue=="object"&&e.setIcon({...ue,rotation:c}),delete N.current[e.getPosition()])};N.current[e.getPosition()]=requestAnimationFrame(h)},Ue=(e,t)=>new jt({map:t,markers:e,renderer:{render:({count:n,position:s})=>qe(n,s)}}),qe=(e,t)=>{const n=40+Math.min(e*2,40),s=30;let c;return e<10?c={start:"#76c7c0",end:"#34a853"}:e<50?c={start:"#fbbc05",end:"#f2994a"}:c={start:"#f45c42",end:"#d32f2f"},new I.Marker({position:t,icon:{url:`data:image/svg+xml,${encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 100 100">
            <defs>
              <radialGradient id="gradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="${c.start}" />
                <stop offset="100%" stop-color="${c.end}" />
              </radialGradient>
              <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0, 0, 0, 0.5)" />
              </filter>
            </defs>
            <!-- Outer Pulsating Ring -->
            <circle cx="50" cy="50" r="48" fill="url(#gradient)" filter="url(#shadow)" stroke="#ffffff" stroke-width="3" />
            <!-- Decorative Inner Ring -->
            <circle cx="50" cy="50" r="38" fill="none" stroke="#ffffff" stroke-width="2" stroke-dasharray="4 2" />
            <!-- Star Decoration -->
            <polygon points="50,15 54,38 70,38 57,50 62,68 50,57 38,68 43,50 30,38 46,38" fill="#ffffff" opacity="0.4" />
            <!-- Count Text -->
            <text x="50" y="55" font-size="${s}" fill="black" text-anchor="middle" font-family="'Courier New', monospace" font-weight="bold">
              ${e}
            </text>
          </svg>
        `)}`,scaledSize:new I.Size(n,n)},label:null})},Ke=async(e,t,n)=>{var f;const s=e.imei,c=t.current[s];if(c){const u=c.getPosition(),h=((f=c.getIcon())==null?void 0:f.rotation)||0,k={lat:e.lat,lng:e.lng},_=e.heading||0;Ee(c,u,k,h,_);const z=await Se({latestDocument:e});c.setIcon(z)}},Ye=e=>{if(!e)return"motorBike";const t=Ze(e);return t||console.error(`No vehicle type found for IMEI: ${e}, defaulting to motorBike`),t||"motorBike"},Ze=e=>{if(!M||M.length===0)return console.error("vehicles_details is not available"),null;const t=M.find(n=>(n==null?void 0:n.value)===e&&(n==null?void 0:n.vehilce_type));return t||console.error(`No vehicle found for IMEI: ${e}`),t?t.vehilce_type:null},Je=(e,t)=>{console.log("packet and type",e,t);let{speed:n,ignition:s,imei:c}=e,f=Le(c);const u={"2W":{red:St,green:_t,yellow:Dt,black:It},"3W":{red:Ct,green:Mt,yellow:Vt,black:Lt},"4W":{red:Et,green:$t,yellow:Rt,black:Nt},Tractor:{red:At,green:Ot,yellow:Tt,black:Bt},Harvestor:{red:Ft,green:Wt,yellow:zt,black:Ht},BUS:{red:Pt,green:Gt,yellow:Ut,black:qt},default:{red:we,green:we,yellow:we,black:we}};let h=u[t]||u.default;if(!f)return h.black;if(f&&!s)return h.red;if(f&&s&&n>0)return h.green;if(f&&s&&n<=0)return h.yellow},Qe=(e,t,n,s)=>{var k,_,z;S(nt(t.latestDocument.imei));const c={lat:(k=t==null?void 0:t.latestDocument)==null?void 0:k.lat,lng:(_=t==null?void 0:t.latestDocument)==null?void 0:_.lng};S(je(c)),S(st(15)),F.current||(F.current=new I.InfoWindow);const f=F.current,h=`
      <div>
        <h3>Registration No: ${((z=P.find(H=>{var ie,ke;return((ie=H==null?void 0:H.imei[0])==null?void 0:ie.mac_id)===((ke=t==null?void 0:t.latestDocument)==null?void 0:ke.imei)}))==null?void 0:z.registration_id)||""}</h3>
      </div>
    `;p===e?(f.close(),b(null)):(f.setContent(h),f.open(s,n),b(e))},Xe=e=>{const t=M&&(M==null?void 0:M.length)>0&&M.find(n=>(n==null?void 0:n.value)===e&&n);m(t||null)},$e=()=>{ae(!O)};if(ye)return"Error loading maps";if(!ce)return"Loading maps";if(!I)return null;const et={height:"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return o.jsxs(o.Fragment,{children:[o.jsx(w,{sx:{position:"absolute",top:"780px",left:q?"74px":"250px",zIndex:1,background:Oe.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:o.jsxs(ge,{sx:{color:"white"},onClick:$e,children:[O?"Hide":"Show"," Vehicle Info",o.jsx(Kt,{})]})}),O===!0&&o.jsx(io,{handleVehicleInfo:$e,udpatedParams:T,handleClickOpen:Z}),o.jsxs(kt,{id:"map",mapContainerStyle:et,zoom:d,center:L,onLoad:e=>{C.current=e},options:{styles:fe?se:""},children:[Object.keys(j).length>0&&o.jsx(xt,{setPlace:ee,place:X}),E||x?o.jsx(w,{sx:{position:"absolute",top:"50%",left:"50%"},children:o.jsx(Yt,{})}):ne&&ne.length>0&&ne.map((e,t)=>{var n,s;return o.jsx(wt,{position:{lat:parseFloat((n=e==null?void 0:e.location)==null?void 0:n.lat),lng:parseFloat((s=e==null?void 0:e.location)==null?void 0:s.lng)},animation:window.google.maps.Animation.DROP,icon:{path:de[`${X}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},t)}),o.jsx(yo,{open:xe,shareLink:g,handleClose:a})]})]})}const yo=({open:y,handleClose:x,shareLink:D})=>{l.useState(""),l.useEffect(()=>{},[]);const L=()=>{if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(D).then(()=>oe.success("Link copied!")).catch(()=>oe.error("Failed to copy!"));else{const v=document.createElement("textarea");v.value=D,document.body.appendChild(v),v.select(),document.execCommand("copy"),document.body.removeChild(v),oe.success("Link copied!")}};return o.jsxs(Zt,{onClose:x,"aria-labelledby":"customized-dialog-title",open:y,fullWidth:!0,maxWidth:"lg",children:[!1,o.jsxs(Jt,{sx:{m:0,p:2},id:"customized-dialog-title",children:["Vehicle live location link",o.jsx(rt,{"aria-label":"close",onClick:x,sx:v=>({position:"absolute",right:8,top:8,color:v.palette.grey[500]}),children:o.jsx(Be,{})})]}),o.jsx(Qt,{dividers:!0,children:o.jsxs(w,{display:"flex",alignItems:"center",gap:2,mt:1,children:[o.jsx(eo,{fullWidth:!0,variant:"outlined",value:D,onChange:v=>{},sx:{flex:9}}),o.jsx(ge,{variant:"outlined",onClick:L,startIcon:o.jsx(ze,{}),sx:{flex:1,minWidth:"auto"},children:"Copy"})]})}),o.jsx(Xt,{children:o.jsx(ge,{onClick:x,children:"Close"})})]})};function Uo(){const{locationData:y,selectedVehicle:x,selectedParameterList:D,onlineVehicle:L}=te(i=>i.liveMap),{mode:v,selectedVehicleGroup:j}=te(i=>i.dashboard),P=gt(v),[d,de]=l.useState([]),[r,ne]=l.useState(""),[Q,G]=l.useState(""),[U,pe]=l.useState(""),[E,fe]=l.useState(""),{w_customer_id:se}=te(i=>i.auth),[M,F]=l.useState(),[q,I]=l.useState(!1),[K,X]=l.useState(!1),[ee,A]=l.useState([]),[W,le]=l.useState(!0),[re,p]=l.useState(!1),[b,$]=l.useState(!1);let m=Te();l.useEffect(()=>{m(lt({}))},[]),l.useEffect(()=>{O()},[]),l.useEffect(()=>{var i;if(Object.keys(x).length>0){const g=(y==null?void 0:y.length)>0&&(y==null?void 0:y.filter(a=>Number(a.latestDocument.imei)===Number(x==null?void 0:x.imei)));if((g==null?void 0:g.length)<=0){oe.error("Data not available for this vehicle",{id:"clipboard"});return}const{lat:V,lng:Y}=((i=g==null?void 0:g[0])==null?void 0:i.latestDocument)??{},Z={lat:V||Ne.lat,lng:Y||Ne.lat};m(je(Z))}},[x,y]),l.useEffect(()=>{A([]),m(Re([{reg_id:"",imei:"",params:[]}]))},[x]);const O=async()=>{try{p(!0);let i=[],g=[];const V=await m(ct({w_customer_id:se}));if(Array.isArray(V.payload)){V.payload.forEach(a=>{var S,R,B,C;Array.isArray(a.imei)&&a.imei.length>0&&((S=a.imei[0])!=null&&S.mac_id)?(i.push({id:a.id,label:a.registration_id,value:(R=a.imei[0])==null?void 0:R.mac_id,vehilce_type:a==null?void 0:a.segment,chassis_no:a==null?void 0:a.chassis_no,engine_no:a==null?void 0:a.engine_no,workShop:a==null?void 0:a.workshop,registration_id:a==null?void 0:a.registration_id,sell_date:a==null?void 0:a.sell_date,customer_name:a==null?void 0:a.customer_name,vehicle_model:(B=a==null?void 0:a.vehicle_model)==null?void 0:B.name,vehicle_group:a==null?void 0:a.vehicle_group}),g.push((C=a.imei[0])==null?void 0:C.mac_id)):console.error("IMEI data not found for item:",a)});const Y="one",Z=g;g.length>0&&m(it({type:Y,imei:Z})),de(i),m(ut(i)),m(dt({w_customer_id:se})),p(!1)}else p(!1),console.error("Unexpected data format:",V),oe.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),oe.error(`Error fetching vehicle data: ${i}`)}},ae=async i=>{const{label:g,imei:V,id:Y,reg_id:Z,checked:a}=i;F(C=>C.map(N=>N.id===Y?{...N,checked:!a}:N));let S=[...ee],R=[...ee];if(!a)y.forEach(C=>{C.latestDocument.imei===V&&(S.push({label:g,value:C.latestDocument[g==="maininputvoltage"?"mainInputVoltage":g]}),R=S,A(S))});else{let C=ee.filter(N=>N.label!==g);R=C,A(C)}m(Re([{reg_id:Z,imei:V,params:R}]))},T=i=>y==null?void 0:y.some(g=>Number(g.latestDocument.imei)===Number(i)&&g.latestDocument.speed>0&&(g.latestDocument.ignition===!0||g.latestDocument.ignition===1)),he=i=>y==null?void 0:y.some(g=>Number(g.latestDocument.imei)===Number(i)&&g.latestDocument.speed<=0&&(g.latestDocument.ignition===!0||g.latestDocument.ignition===1)),xe=d.filter(i=>{var ce,ye,be,ve,me;if(!(Object.keys(j).length===0||i.vehicle_group===j.id))return!1;const V=(ce=i==null?void 0:i.label)==null?void 0:ce.toLowerCase().includes(r.toLowerCase()),Y=E===""||((ye=i==null?void 0:i.workShop)==null?void 0:ye.region)===E,Z=U===""||((ve=(be=i==null?void 0:i.workShop)==null?void 0:be.state)==null?void 0:ve.toLowerCase())===(((me=U==null?void 0:U.toString())==null?void 0:me.toLowerCase())||""),a=Number(i.value),S=L.includes(a),R=!S,B=S&&T(a),C=S&&he(a);return V&&Y&&Z&&(Q==="online"?S:Q==="offline"?R:Q==="running"?B:Q==="idling"?C:!0)}).sort((i,g)=>i.label.localeCompare(g.label));return o.jsxs("div",{className:"app",children:[o.jsx(bt,{}),o.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[o.jsx(ft,{title:"Live Map",setShowVehicles:I,showVehicles:q,showParameters:K,setShowParameters:X,setShowCard:le,showCard:W,setShowVehiclesGroup:$,showVehiclesGroup:b}),o.jsx(vt,{setShowVehiclesGroup:$,showVehiclesGroup:b,where:"livemap"}),o.jsxs(w,{style:{display:"flex",width:"100%",height:"95vh"},children:[o.jsx(w,{style:{width:q||K?"80%":"100%"},children:o.jsx(xo,{showCard:W,loadingVehicle:re,vehicleData:xe})}),q&&o.jsx(w,{style:{width:"20%",backgroundColor:P.grey[100]},children:o.jsx(ht,{vehicleData:xe,title:"Live Map",setParameterData:F,loadingVehicle:re,setShowVehicles:I,showVehicles:q,showParameters:K,setShowParameters:X,setSearchedTerm:ne,setOptions:G,setState:pe,setRegion:fe,searchTerm:r,options:Q,state:U,region:E})}),K&&o.jsx(w,{style:{width:"20%",backgroundColor:P.grey[100]},children:o.jsx(yt,{parametersData:M,setParameterData:F,handleParameterChange:ae})})]})]})]})}export{Uo as default};
