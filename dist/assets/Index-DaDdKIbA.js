import{j as s,G as F,y as z,z as y,b as i,I as W,bd as X,ba as J,aw as K,C as O,a6 as Q,Z,aq as ee,aM as se,a7 as q,U as ae,V as oe,Y as te,X as re,E as ne}from"./index-DJH5ZoJP.js";import{V as le}from"./VehicleMenu-BX7kHV8W.js";import{t as ce}from"./SearchTab-DzsK0hG9.js";import"./Loader-BULSBbxR.js";import"./LiveMapServices-fHJcPoha.js";import"./Socket-CFpJY01f.js";import{P as ie}from"./Parameters-kGhnUQ9R.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as de}from"./LeftSideBar2-CTZdoWrV.js";import{D as ue,a as he,b as pe,c as ge}from"./DialogTitle-BZhsMTu8.js";import{D as fe,E as xe,T as _e}from"./Edit-D8nFVhP7.js";import{B as I}from"./CircularProgress-BpgrT3bl.js";import{D as be}from"./Delete-56q75nLm.js";import{T as ke,a as je,b as De,c as Y,d as k,e as me}from"./TableRow-D9751lRs.js";import{T as we}from"./TablePagination-Bv17AswF.js";import{A as Ce}from"./AddBreakdown-5_jKVuLI.js";import"./index.esm-Cxpfh84f.js";import{V as Se}from"./VehicleGroups-CYCo2eAO.js";import{S as ve}from"./ServicesTopBar-DbQjyE21.js";import"./menu2-B_rcDMKB.js";import"./useControlled-DGR1z4_y.js";import"./TextField-V0V83BM3.js";import"./Autocomplete-C3FCsgl3.js";import"./index-CwpX2h2E.js";import"./createSvgIcon-Dk0nFze3.js";import"./Card-CNuGpb4s.js";import"./CardContent-DmYJZ80V.js";import"./Close-Clpi86TY.js";import"./Add-fFbl1YlP.js";import"./formik.esm-B2wxZcFp.js";import"./SearchInput-D8d1ZCBJ.js";import"./NewLoader-CFQHaXir.js";const ye=({open:_,onClose:g,onConfirm:j})=>s.jsxs(ue,{open:_,onClose:g,children:[s.jsx(he,{children:"Confirm Deletion"}),s.jsx(pe,{children:s.jsxs(fe,{children:["Are you sure you want to delete this vehicle data?"," ",s.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),s.jsxs(ge,{children:[s.jsx(F,{onClick:g,color:"primary",children:"Cancel"}),s.jsx(F,{onClick:j,color:"secondary",children:"Delete"})]})]}),Be="https://cc.wikitrak.in/api-proxy/api/v1",Pe={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Le=({breakdownData:_})=>{const g=z(),{isUpdateBreakdown:j}=y(p=>p.equipment),{w_customer_id:R}=y(p=>p.auth),[D,f]=i.useState(!1),B=()=>{console.log("breakdownData",_),localStorage.getItem("role"),g(X(!j)),g(J(_))},v=()=>{console.log("dlt btn clicked");const p=localStorage.getItem("role");K.includes(p)?f(!0):O.error(`Sorry! Your role is ${p}. You're not allowed to add, edit or delete the vehicle`)},m=async()=>{console.log("breakdownData data deleting");try{await Q.delete(`${Be}/vehicles/breakdown/create/${_.id}/`),O.success("breakdownData data deleted successfully!"),g(Z(R))}catch(p){console.error("Error deleting breakdown data:",p),O.error("Failed to delete breakdown data. Please try again.")}f(!1)},T=()=>{f(!1)},w={color:"#686868"};return s.jsxs(I,{sx:Pe,children:[s.jsx(W,{onClick:B,children:s.jsx(xe,{sx:w})}),s.jsx(W,{onClick:v,children:s.jsx(be,{sx:w})}),s.jsx(ye,{open:D,onClose:T,onConfirm:m})]})},Ve=[{id:"BDID",label:"BDID"},{id:"Vehicle",label:"Vehicle No"},{id:"Topic",label:"Topic"},{id:"User",label:"User"},{id:"SubmissionDate",label:"Submission Date"},{id:"WorkshopGroup",label:"Workshop Group"},{id:"Status",label:"Status"},{id:"Actions",label:"Actions"}],Ae=()=>{const{breakdowns:_}=y(e=>e.breakdown),{searchTerm:g}=y(e=>e.inspection),[j,R]=i.useState("asc"),[D,f]=i.useState("BDID"),[B,v]=i.useState(0),[m,T]=i.useState(5),[w,p]=i.useState({id:"",status:"",workshop:"",user:""}),E=e=>{R(D===e&&j==="asc"?"desc":"asc"),f(e)},P=(e,t)=>{v(t)},M=e=>{T(parseInt(e.target.value,10)),v(0)},G=(e,t,c)=>e.filter(o=>{var V,a,b,x,A,u,S;const r=new Date,n=new Date(o.submission_date);if(r.setHours(0,0,0,0),n.setHours(0,0,0,0),(c==null?void 0:c.toLowerCase())==="overdue"&&n<r&&o.status.toLowerCase()==="open")return!0;const h=c.toLowerCase(),l=(V=o==null?void 0:o.breakdown_id)==null?void 0:V.toLowerCase().includes(h),d=`${(b=(a=o==null?void 0:o.user)==null?void 0:a.us_user)==null?void 0:b.first_name} ${(A=(x=o==null?void 0:o.user)==null?void 0:x.us_user)==null?void 0:A.last_name}`.toLowerCase().includes(h),C=(u=o==null?void 0:o.status)==null?void 0:u.toLowerCase().includes(h),U=(S=o==null?void 0:o.workshop_group)==null?void 0:S.group_name.toLowerCase().includes(h);return!(c&&!(l||d||C||U)||t.id&&!o.breakdown_id.includes(t.id)||t.status&&o.status!==t.status||t.workshop&&o.workshop_group.group_name!==t.workshop||t.user&&!o.user.us_user.first_name.toLowerCase().includes(t.user.toLowerCase())&&!o.user.us_user.last_name.toLowerCase().includes(t.user.toLowerCase()))}),H=(e,t,c,o)=>{if(o==="User"){const r=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),n=`${t.user.us_user.first_name} ${t.user.us_user.last_name}`.toLowerCase();return c==="asc"?r.localeCompare(n):n.localeCompare(r)}if(o==="WorkshopGroup"){const r=e.workshop_group.group_name.toLowerCase(),n=t.workshop_group.group_name.toLowerCase();return c==="asc"?r.localeCompare(n):n.localeCompare(r)}if(o==="BDID"){const r=parseInt(e.breakdown_id.replace("BD-",""),10),n=parseInt(t.breakdown_id.replace("BD-",""),10);return c==="asc"?r-n:n-r}if(o==="SubmissionDate"){const r=new Date(e.submission_date),n=new Date(t.submission_date);return c==="asc"?r-n:n-r}if(o==="Status"){const r={Open:1,Close:2,Rejected:3},n=r[e.status]||0,h=r[t.status]||0;return c==="asc"?n-h:h-n}return 0},L=G(_.slice(),w,g).sort((e,t)=>H(e,t,j,D)),$=L.slice(B*m,B*m+m),N={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};return s.jsx(I,{sx:{m:"10px"},children:s.jsxs(ee,{children:[s.jsx(ke,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(je,{stickyHeader:!0,children:[s.jsx(De,{children:s.jsx(Y,{children:Ve.map(e=>s.jsx(k,{sx:N,children:s.jsx(_e,{active:D===e.id,direction:D===e.id?j:"asc",onClick:()=>E(e.id),children:e.label})},e.id))})}),s.jsx(me,{children:$.map((e,t)=>{var c,o,r,n,h,l,d;return s.jsxs(Y,{children:[s.jsx(k,{children:e==null?void 0:e.breakdown_id}),s.jsx(k,{children:(c=e==null?void 0:e.vehicle)==null?void 0:c.registration_id}),s.jsx(k,{children:(o=e==null?void 0:e.breakdown_topic)==null?void 0:o.topic}),s.jsx(k,{children:`${(n=(r=e==null?void 0:e.user)==null?void 0:r.us_user)==null?void 0:n.first_name} ${(l=(h=e==null?void 0:e.user)==null?void 0:h.us_user)==null?void 0:l.last_name}`}),s.jsx(k,{children:e.submission_date||"N/A"}),s.jsx(k,{children:(d=e==null?void 0:e.workshop_group)==null?void 0:d.group_name}),s.jsx(k,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),s.jsx(k,{children:s.jsx(Le,{breakdownData:e})})]},t)})})]})}),s.jsx(we,{component:"div",count:L.length,page:B,onPageChange:P,rowsPerPage:m,onRowsPerPageChange:M,rowsPerPageOptions:[5,10,15]})]})})},Ie=Ae;function ps(){const{locationData:_,selectedVehicle:g,selectedParameterList:j,onlineVehicle:R}=y(l=>l.liveMap),{mode:D,selectedVehicleGroup:f,vehicleZone:B}=y(l=>l.dashboard),v=ce(D),[m,T]=i.useState([]),{w_customer_id:w}=y(l=>l.auth),[p,E]=i.useState(),[P,M]=i.useState(!1),[G,H]=i.useState(!1),[L,$]=i.useState([]);i.useState(!0);const[N,e]=i.useState(!1),[t,c]=i.useState(!1);let o=z();i.useEffect(()=>{r(),o(se()),o(Z(w))},[]),i.useEffect(()=>{console.log("selectedVehicleGroup",f)},[f]),i.useEffect(()=>{$([]),o(q([{reg_id:"",imei:"",params:[]}]))},[g]);const r=async()=>{try{e(!0);let l=[],d=[];const C=await o(ae({w_customer_id:w}));if(Array.isArray(C.payload)){C.payload.forEach(a=>{var b,x,A,u;Array.isArray(a.imei)&&a.imei.length>0&&((b=a.imei[0])!=null&&b.mac_id)?(l.push({id:a.id,label:a.registration_id,value:(x=a.imei[0])==null?void 0:x.mac_id,vehilce_type:a==null?void 0:a.segment,chassis_no:a==null?void 0:a.chassis_no,engine_no:a==null?void 0:a.engine_no,workShop:a==null?void 0:a.workshop,registration_id:a==null?void 0:a.registration_id,sell_date:a==null?void 0:a.sell_date,customer_name:a==null?void 0:a.customer_name,vehicle_model:(A=a==null?void 0:a.vehicle_model)==null?void 0:A.name,user:a==null?void 0:a.user,vehicle_group:a==null?void 0:a.vehicle_group}),d.push((u=a.imei[0])==null?void 0:u.mac_id)):console.error("IMEI data not found for item:",a)});const U="one",V=d;d.length>0&&o(oe({type:U,imei:V})),T(l),o(te({w_customer_id:w})),o(re(l)),e(!1)}else e(!1),console.error("Unexpected data format:",C),O.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),O.error(`Error fetching vehicle data: ${l}`)}},n=async l=>{const{label:d,imei:C,id:U,reg_id:V,checked:a}=l;E(u=>u.map(S=>S.id===U?{...S,checked:!a}:S));let b=[...L],x=[...L];if(!a)_.forEach(u=>{u.latestDocument.imei===C&&(b.push({label:d,value:u.latestDocument[d==="maininputvoltage"?"mainInputVoltage":d]}),x=b,$(b))});else{let u=L.filter(S=>S.label!==d);x=u,$(u)}console.log("tempParamList",x),o(q([{reg_id:V,imei:C,params:x}]))},h=m.filter(l=>Object.keys(f).length===0||l.vehicle_group===f.id);return s.jsxs("div",{className:"app",children:[s.jsx(de,{}),s.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[s.jsx(ve,{title:"Breakdown",setShowVehicles:M,showVehicles:P,setShowVehiclesGroup:c,showVehiclesGroup:t}),s.jsx(Se,{setShowVehiclesGroup:c,showVehiclesGroup:t}),s.jsxs(I,{style:{display:"flex",width:"100%",height:"95vh"},children:[s.jsxs(I,{style:{width:P||G?"80%":"100%",background:ne.bgShadow},children:[s.jsx(Ce,{where:"Breakdown"}),s.jsx(Ie,{})]}),P&&s.jsx(I,{style:{width:"20%",backgroundColor:v.grey[100]},children:s.jsx(le,{vehicleData:h,title:"Inspections",setParameterData:E,loadingVehicle:N,setShowVehicles:M,showVehicles:P,showParameters:G,setShowParameters:H})}),G&&s.jsx(I,{style:{width:"20%",backgroundColor:v.grey[100]},children:s.jsx(ie,{parametersData:p,setParameterData:E,handleParameterChange:n})})]})]})]})}export{ps as default};
