import{i as Me,o as Oe,r as p,p as Ye,_ as $e,a as je,j as e,eG as Ie,q as Fe,c as Pe,g as Ge,aX as z,T as P,bd as q,b8 as U,b0 as k,a$ as Z,bc as ze,dY as Re,ch as Ve,dZ as Q,d_ as w,d$ as G,e0 as t,e1 as ee,em as be,bm as We,cb as Be,b9 as ve,eH as ae,eI as N,bZ as Le,eJ as Ne,eK as ke,bw as He,b_ as Ke,bn as X,eL as Ue,eM as Se,eN as ye,eO as Ze,eP as me,eQ as Te,eR as _e,eS as Xe,bx as qe,by as Je,bz as Qe,bB as we,bD as ea,br as aa,b4 as la,bs as ta,bt as sa,eT as na}from"./index-B9W9A0YN.js";import{D as Ae}from"./DateTimePicker-BNh5nUvH.js";import"./index.esm-R3Gd3xrx.js";import{u as J,w as ra}from"./xlsx-DrgRuPKf.js";function ca(j){return Me("MuiTableFooter",j)}Oe("MuiTableFooter",["root"]);const ia=["className","component"],oa=j=>{const{classes:S}=j;return Ge({root:["root"]},ca,S)},da=Fe("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(j,S)=>S.root})({display:"table-footer-group"}),ha={variant:"footer"},Ce="tfoot",xa=p.forwardRef(function(S,b){const T=Ye({props:S,name:"MuiTableFooter"}),{className:v,component:g=Ce}=T,n=$e(T,ia),s=je({},T,{component:g}),r=oa(s);return e.jsx(Ie.Provider,{value:ha,children:e.jsx(da,je({as:g,className:Pe(r.root,v),ref:b,role:g===Ce?null:"rowgroup",ownerState:s},n))})});function Ee({handleBack:j,downloadData:S}){p.useEffect(()=>{},[S]);const b=()=>{if(S.length===0){U.error("No data available for download.");return}const T=J.json_to_sheet(S),v=J.book_new();J.book_append_sheet(v,T,"Sheet1"),ra(v,"Report.xlsx"),U.success("Excel file downloaded successfully!")};return e.jsx(z,{sx:{backgroundColor:"white",mb:2,display:"flex",textAlign:"center",justifyContent:"end",alignItems:"center",padding:"10px 20px",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsxs(z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(P,{sx:{fontWeight:"bold",mr:1},children:"Download In:"}),e.jsx(q,{variant:"outlined",onClick:b,sx:{borderColor:"green",color:"green","&:hover":{backgroundColor:"green",color:"white"}},children:"EXCEL"})]})})}function pa({tableData:j}){const{vehicleList:S}=k(n=>n.liveMap),b=Z(),T=ze();console.log("tableData: ",j);let v=n=>S.find(s=>{var r;return((r=s==null?void 0:s.imei[0])==null?void 0:r.mac_id)==n||""});const g=n=>{var s;b(We({imei:n==null?void 0:n.imei,reg_id:(s=v(n.imei))==null?void 0:s.registration_id})),b(Be({startDate:ve(n.date).startOf("day").toISOString(),endDate:ve(n.date).endOf("day").toISOString()})),T("/trip-monitor?source=TripDetail")};return e.jsx(Re,{component:Ve,sx:{maxHeight:"70vh"},children:e.jsxs(Q,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(w,{children:e.jsxs(G,{children:[e.jsx(t,{align:"left",children:"Date"}),e.jsx(t,{align:"left",children:"Vehicle Name"}),e.jsx(t,{align:"left",children:"Start location"}),e.jsx(t,{align:"left",children:"End location"}),e.jsx(t,{align:"left",children:"Segment"}),e.jsx(t,{align:"left",children:"Operator"}),e.jsx(t,{align:"left",children:"Work done (acre)"}),e.jsx(t,{align:"left",children:"Engine hours"}),e.jsx(t,{align:"left",children:"Running Time"}),e.jsx(t,{align:"left",children:"Idle time"}),e.jsx(t,{align:"left",children:"Total Distance (km)"}),e.jsx(t,{align:"left",children:"Average Speed"}),e.jsx(t,{align:"left",children:"View Trips"})]})}),e.jsx(ee,{children:j.map((n,s)=>{var r,l,x,y,u,_,d;return e.jsxs(G,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{align:"left",children:n.date}),e.jsx(t,{align:"left",children:(r=v(n.imei))==null?void 0:r.registration_id}),e.jsx(t,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(be,{title:((l=n==null?void 0:n.startLocationName)==null?void 0:l.display_name)||(n==null?void 0:n.startLocationName)||"",children:e.jsx("span",{children:((x=n==null?void 0:n.startLocationName)==null?void 0:x.display_name)||(n==null?void 0:n.startLocationName)||""})})}),e.jsx(t,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(be,{title:((y=n==null?void 0:n.endLocationName)==null?void 0:y.display_name)||(n==null?void 0:n.endLocationName)||"",children:e.jsx("span",{children:((u=n==null?void 0:n.endLocationName)==null?void 0:u.display_name)||(n==null?void 0:n.endLocationName)||""})})}),e.jsx(t,{align:"left",children:(_=v(n.imei))==null?void 0:_.segment}),e.jsx(t,{align:"left",children:(d=v(n.imei))==null?void 0:d.customer_name}),e.jsx(t,{align:"left",children:n.acreageStr}),e.jsx(t,{align:"left",children:n.engineHours}),e.jsx(t,{align:"left",children:n.runningTime}),e.jsx(t,{align:"left",children:n.idleTime}),e.jsx(t,{align:"left",children:n.totalDistance}),e.jsx(t,{align:"left",children:n.averageSpeed}),e.jsx(t,{align:"left",children:e.jsx(z,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>g(n),children:"View on Map ðŸ”"})})]},s+1)})})]})})}function ga({handleBack:j,setStartDate:S,startDate:b,setEndDate:T,endDate:v}){const g=Z(),{vehicleGroup:n,vehicleList:s}=k(h=>h.liveMap),{vehicleStatesData:r,loading:l,selectedGroup:x,selectedVehicle:y,distributorList:u}=k(h=>h.report),[_,d]=p.useState([]),[C,E]=p.useState([]),[V,A]=p.useState([]);p.useEffect(()=>{},[l]),p.useEffect(()=>{if(n&&n.length>0){let h=n.map(o=>({...o,label:o.group_name,value:o.id}));d(h)}},[n,s,u]),p.useEffect(()=>{},[b,v]);let m=h=>s.find(o=>{var D;return((D=o==null?void 0:o.imei[0])==null?void 0:D.mac_id)==h||""});p.useEffect(()=>{let h=(r==null?void 0:r.data)&&r.data.map(o=>{var F,O;let{customer_name:D,registration_id:H,segment:K}=m(o==null?void 0:o.imei);return{Date:o.date,vehicle:H,"Start Location":(F=o==null?void 0:o.startLocationName)==null?void 0:F.display_name,"End Location":(O=o==null?void 0:o.endLocationName)==null?void 0:O.display_name,operator:D,segment:K,"Work Done":o==null?void 0:o.acreageStr,"Running Time":o.runningTime,"Idle Time":o.idleTime,"Engine hours":o.engineHours,"Total Distance (km)":o.totalDistance,"Average Speed":o.averageSpeed}});A(h)},[r]),p.useEffect(()=>{y||g(ae())},[]);function Y(h){console.log("value changed",h),g(Ne(h))}function M(h){g(ke(h))}const W=async()=>{const h=`${b} 00:00`,o=`${v} 23:59`;if(!B())return;g(He({imei:y,startTime:h,endTime:o}))},B=()=>!b||!v||y==="all"?(U.error("Please select start date, end date, and vehicle."),!1):!0,$=x==="All"?s:s.filter(h=>h.vehicle_group===x);return e.jsxs(z,{sx:{width:"100%",m:"auto"},children:[e.jsx(z,{sx:{ml:"10px"},children:e.jsx(Ee,{handleBack:j,downloadData:V})}),e.jsxs(z,{children:[e.jsxs(N,{size:"large",value:x,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:Y,filterOption:(h,o)=>{var D;return typeof((D=o==null?void 0:o.props)==null?void 0:D.children)=="string"&&o.props.children.toLowerCase().indexOf(h.toLowerCase())>=0},children:[e.jsx(N.Option,{value:"All",children:"All"}),_.map((h,o)=>e.jsx(N.Option,{value:h.value,children:h.label},o))]}),e.jsxs(N,{size:"large",value:y,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:M,filterOption:(h,o)=>{var D;return typeof((D=o==null?void 0:o.props)==null?void 0:D.children)=="string"&&o.props.children.toLowerCase().indexOf(h.toLowerCase())>=0},children:[e.jsx(N.Option,{value:"all",children:"None"},"all"),$&&$.length>0&&$.map((h,o)=>{var D;return e.jsx(N.Option,{value:(D=h.imei[0])==null?void 0:D.mac_id,children:h.registration_id},o)})]}),e.jsx(Ae,{setStartDate:S,setEndDate:T,selectedDate:!1,startDate:b,endDate:v}),e.jsx(q,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:W,disabled:!y,children:"Generate report"})]}),l&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(Le,{})}),(r==null?void 0:r.data)&&(r==null?void 0:r.data.length)>0&&e.jsx(z,{ml:1.5,children:e.jsx(pa,{tableData:(r==null?void 0:r.data)||[]})})]})}const fa=({receiptData:j,open:S,setOpen:b})=>{const T=p.useRef(),v=()=>b(!1),g=r=>r==null?void 0:r.replace(/^0+/,""),n=()=>{const r=T.current.innerHTML,l=window.open("","","width=800,height=600");l.document.write(`
      <html>
        <head>
          <title>Print Receipt</title>
          <style>
            body { font-family: monospace;  padding: 10px; }
            h2, h3 { margin: 4px 0; }
            table { width: 100%; border-collapse: collapse; font-size: 12px; }
            td, th { text-align: left; padding: 2px 4px; }
            .line { border-top: 1px dashed #000; margin: 5px 0; }
          </style>
        </head>
        <body>${r}</body>
      </html>
    `),l.document.close(),l.focus(),l.print()};if(!j)return;let s=j;return e.jsx(e.Fragment,{children:e.jsx(Ke,{open:S,onClose:v,children:e.jsxs(z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"white",p:2,borderRadius:2,boxShadow:24,width:300,maxHeight:"90vh",overflowY:"auto",textAlign:"center"},children:[e.jsxs("div",{ref:T,children:[e.jsx(P,{variant:"h6",children:"******************************"}),e.jsx(P,{variant:"h6",children:s.manufacture_name}),e.jsx(P,{variant:"h6",children:"******************************"}),e.jsx(P,{variant:"subtitle1",sx:{mt:1},children:"DOCKET"}),e.jsxs(P,{sx:{fontSize:"12px",textAlign:"left",mt:1},children:["Batch: ",s.batch_no,e.jsx("br",{}),"Date: ",(s==null?void 0:s.date)&&X(s==null?void 0:s.date,"DDMMYYYY").format("DD-MM-YYYY")||"-",e.jsxs("span",{style:{float:"right"},children:["Start: ",s.start_time]}),e.jsx("br",{}),"Operator: ",s.operator,e.jsx("br",{}),"Dest: ",s.destination,e.jsx("br",{}),"Recipe: ",s.mix_name]}),e.jsx("div",{className:"line",style:{borderTop:"1px dashed #000",margin:"6px 0"}}),e.jsxs(Q,{size:"small",children:[e.jsx(w,{children:e.jsxs(G,{children:[e.jsx(t,{sx:{fontSize:"10px"},children:"No"}),e.jsx(t,{sx:{fontSize:"10px"},children:"Product"}),e.jsx(t,{sx:{fontSize:"10px"},children:"Target"}),e.jsx(t,{sx:{fontSize:"10px"},children:"Weight"})]})}),e.jsx(ee,{children:s.materials.map((r,l)=>e.jsxs(G,{children:[e.jsx(t,{sx:{fontSize:"10px"},children:l+1}),e.jsx(t,{sx:{fontSize:"10px"},children:r.name}),e.jsx(t,{sx:{fontSize:"10px"},children:g((r==null?void 0:r.target)||"")}),e.jsx(t,{sx:{fontSize:"10px"},children:g((r==null?void 0:r.actual)||"")})]},l))})]}),e.jsx("div",{className:"line",style:{borderTop:"1px dashed #000",margin:"6px 0"}}),e.jsxs(P,{sx:{fontSize:"12px",textAlign:"left"},children:["Batch Total(Kg): ",g(s==null?void 0:s.total_target),e.jsx("span",{style:{float:"right"},children:g(s==null?void 0:s.totalAcheived)}),e.jsx("br",{}),"Batch  Total(m3): ",s.target_m3,e.jsx("span",{style:{float:"right"},children:s.total_m3}),e.jsx("br",{}),"End: ",s.end_time,e.jsx("br",{}),e.jsx("div",{className:"line",style:{borderTop:"1px dashed #000",margin:"6px 0"}}),"Machine Id:",g(s==null?void 0:s.device_id)]})]}),e.jsx("div",{className:"line",style:{borderTop:"1px dashed #000",margin:"6px 0"}}),e.jsx(q,{onClick:n,variant:"contained",sx:{mt:2,backgroundColor:"#374151","&:hover":{backgroundColor:"#111827"},fontSize:"12px"},children:"ðŸ–¨ï¸ Print Receipt"})]})})})};function ua({tableData:j}){const{vehicleList:S}=k(l=>l.liveMap);Z(),ze();const[b,T]=p.useState(null),[v,g]=p.useState(!1);let n=l=>S.find(x=>{var y;return((y=x==null?void 0:x.imei[0])==null?void 0:y.mac_id)==l||""});const s=(l,x)=>x.find(u=>{var _;return((_=u==null?void 0:u.name)==null?void 0:_.toLowerCase().trim())===l})||null,r={fontSize:"12px",fontWeight:"bold"};return e.jsxs(e.Fragment,{children:[e.jsx(Re,{component:Ve,sx:{maxHeight:"70vh"},children:e.jsxs(Q,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(w,{children:e.jsxs(G,{children:[e.jsx(t,{align:"left",sx:r,children:"Date"}),e.jsx(t,{align:"left",sx:r,children:"Vehicle Name"}),e.jsx(t,{align:"left",sx:r,children:"Batch No"}),e.jsx(t,{align:"left",sx:r,children:"Start Time"}),e.jsx(t,{align:"left",sx:r,children:"End Time"}),e.jsx(t,{align:"left",sx:r,children:"Total Target Weight"}),e.jsx(t,{align:"left",sx:r,children:"Total Achieved Weight"}),e.jsx(t,{align:"left",sx:r,children:"Recipe 1"}),e.jsx(t,{align:"left",sx:r,children:"Cement"}),e.jsx(t,{align:"left",sx:r,children:"10mm"}),e.jsx(t,{align:"left",sx:r,children:"20mm"}),e.jsx(t,{align:"left",sx:r,children:"Sand"}),e.jsx(t,{align:"left",sx:r,children:"Crush Sand"}),e.jsx(t,{align:"left",sx:r,children:"River Sand"}),e.jsx(t,{align:"left",sx:r,children:"Fly Ash"}),e.jsx(t,{align:"left",sx:r,children:"30mm"}),e.jsx(t,{align:"left",sx:r,children:"Water"}),e.jsx(t,{align:"left",sx:r,children:"Admix"}),e.jsx(t,{align:"left",sx:r,children:"Receipt"})]})}),e.jsx(ee,{children:j.map((l,x)=>{var y,u,_,d,C,E,V,A,m,Y,M,W,B,$,h,o,D,H,K,F,O,i,c,f,a,L,R,I,le,te,se,ne,re,ce,ie,oe,de,he,xe,pe,ge,fe,ue;return e.jsxs(G,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(l==null?void 0:l.date)&&X(l==null?void 0:l.date,"DDMMYYYY").format("DD-MM-YYYY")||"-"}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(y=n(l.imei))==null?void 0:y.registration_id}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l.batch_no}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l.start_time}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.end_time}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(u=l==null?void 0:l.total_target)==null?void 0:u.replace(/^0+/,"")}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(_=l==null?void 0:l.totalAcheived)==null?void 0:_.replace(/^0+/,"")}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.mix_name}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(C=(d=s("cement",l.materials||[]))==null?void 0:d.target)==null?void 0:C.replace(/^0+/,""),":",(V=(E=s("cement",l.materials||[]))==null?void 0:E.actual)==null?void 0:V.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(m=(A=s("10 mm",l.materials||[]))==null?void 0:A.target)==null?void 0:m.replace(/^0+/,""),":",(M=(Y=s("10 mm",l.materials||[]))==null?void 0:Y.actual)==null?void 0:M.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(B=(W=s("20 mm",l.materials||[]))==null?void 0:W.target)==null?void 0:B.replace(/^0+/,""),":",(h=($=s("20 mm",l.materials||[]))==null?void 0:$.actual)==null?void 0:h.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(D=(o=s("sand",l.materials||[]))==null?void 0:o.target)==null?void 0:D.replace(/^0+/,""),":",(K=(H=s("sand",l.materials||[]))==null?void 0:H.actual)==null?void 0:K.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(O=(F=s("crush sand",l.materials||[]))==null?void 0:F.target)==null?void 0:O.replace(/^0+/,""),":",(c=(i=s("crush sand",l.materials||[]))==null?void 0:i.actual)==null?void 0:c.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(a=(f=s("river sand",l.materials||[]))==null?void 0:f.target)==null?void 0:a.replace(/^0+/,""),":",(R=(L=s("river sand",l.materials||[]))==null?void 0:L.actual)==null?void 0:R.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(le=(I=s("fly ash",l.materials||[]))==null?void 0:I.target)==null?void 0:le.replace(/^0+/,""),":",(se=(te=s("fly ash",l.materials||[]))==null?void 0:te.actual)==null?void 0:se.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(re=(ne=s("30 mm",l.materials||[]))==null?void 0:ne.target)==null?void 0:re.replace(/^0+/,""),":",(ie=(ce=s("30 mm",l.materials||[]))==null?void 0:ce.actual)==null?void 0:ie.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(de=(oe=s("water",l.materials||[]))==null?void 0:oe.target)==null?void 0:de.replace(/^0+/,""),":",(xe=(he=s("water",l.materials||[]))==null?void 0:he.actual)==null?void 0:xe.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(ge=(pe=s("admix",l.materials||[]))==null?void 0:pe.target)==null?void 0:ge.replace(/^0+/,""),":",(ue=(fe=s("admix",l.materials||[]))==null?void 0:fe.actual)==null?void 0:ue.replace(/^0+/,"")]}),e.jsx(t,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",l),T(l),g(!0)},children:"View Receipt"})]},x+1)})}),e.jsx(xa,{children:e.jsxs(G,{children:[e.jsx(t,{colSpan:4}),e.jsx(t,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:"Total:"}),e.jsx(t,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:j.reduce((l,x)=>l+(x!=null&&x.total_target&&parseFloat(x.total_target.replace(/^0+/,""))||0),0)}),e.jsx(t,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:j.reduce((l,x)=>l+(x!=null&&x.totalAcheived&&parseFloat(x.totalAcheived.replace(/^0+/,""))||0),0)}),e.jsx(t,{}),["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"].map(l=>{const x=j.reduce((u,_)=>{var C;const d=(C=s(l,_.materials||[]))==null?void 0:C.target;return u+(d&&parseFloat(d.replace(/^0+/,""))||0)},0),y=j.reduce((u,_)=>{var C;const d=(C=s(l,_.materials||[]))==null?void 0:C.actual;return u+(d&&parseFloat(d.replace(/^0+/,""))||0)},0);return e.jsxs(t,{align:"left",sx:{fontSize:"10px",fontWeight:"bold"},children:[x,":",y]},l)}),e.jsx(t,{})]})})]})}),e.jsx(fa,{receiptData:b,open:v,setOpen:g})]})}function ja({handleBack:j,setStartDate:S,startDate:b,setEndDate:T,endDate:v}){const g=Z(),{vehicleGroup:n,vehicleList:s}=k(i=>i.liveMap),{batchReportsData:r,batchReportsData2:l,loading:x,selectedGroup:y,selectedVehicle:u,distributorList:_}=k(i=>i.report),[d,C]=p.useState([]),[E,V]=p.useState([]),[A,m]=p.useState([]),[Y,M]=p.useState([]);let W=i=>s.find(c=>{var f;return((f=c==null?void 0:c.imei[0])==null?void 0:f.mac_id)==i||""});const B=(i,c)=>c.find(a=>{var L;return((L=a==null?void 0:a.name)==null?void 0:L.toLowerCase().trim())===i})||null;p.useEffect(()=>{const i=a=>a&&String(a).replace(/^0+/,"")||"-",c=(a,L=[])=>{const R=B(a,L);return{target:i(R==null?void 0:R.target),actual:i(R==null?void 0:R.actual)}};let f=(r==null?void 0:r.map(a=>{const{customer_name:L="-",registration_id:R="-",segment:I="-"}=W(a==null?void 0:a.imei)||{};return{Date:a!=null&&a.date&&X(a==null?void 0:a.date,"DDMMYYYY").isValid()?X(a==null?void 0:a.date,"DDMMYYYY").format("DD-MM-YYYY"):"-",Vehicle:R||"-","Batch No":(a==null?void 0:a.batch_no)||"-","Start Time":(a==null?void 0:a.start_time)||"-",EndTime:(a==null?void 0:a.end_time)||"-","Total Target Weight":i(a==null?void 0:a.total_target),"Total Achieved Weight":i(a==null?void 0:a.totalAcheived),"Recipe 1":(a==null?void 0:a.mix_name)||"-",Cement:`${c("cement",a==null?void 0:a.materials).target}:${c("cement",a==null?void 0:a.materials).actual}`,"10mm":`${c("10 mm",a==null?void 0:a.materials).target}:${c("10mm",a==null?void 0:a.materials).actual}`,"20mm":`${c("20 mm",a==null?void 0:a.materials).target}:${c("20mm",a==null?void 0:a.materials).actual}`,Sand:`${c("sand",a==null?void 0:a.materials).target}:${c("sand",a==null?void 0:a.materials).actual}`,"Crush Sand":`${c("crush sand",a==null?void 0:a.materials).target}:${c("crush sand",a==null?void 0:a.materials).actual}`,"River Sand":`${c("river sand",a==null?void 0:a.materials).target}:${c("river sand",a==null?void 0:a.materials).actual}`,"Fly Ash":`${c("fly ash",a==null?void 0:a.materials).target}:${c("fly ash",a==null?void 0:a.materials).actual}`,"30mm":`${c("30 mm",a==null?void 0:a.materials).target}:${c("30mm",a==null?void 0:a.materials).actual}`,Water:`${c("water",a==null?void 0:a.materials).target}:${c("water",a==null?void 0:a.materials).actual}`,Admix:`${c("admix",a==null?void 0:a.materials).target}:${c("admix",a==null?void 0:a.materials).actual}`}}))||[];m(f)},[r]);const $=i=>{if(!i&&!i.length>0)return;let c=[];for(let f=0;f<i.length;f++)if(i[f].startsWith("Product:")){const a=i[f],L=i[f+1]||"",R=a.match(/Product:\s*(.*?)\s*Target.*:\s*(\d+)/),I=L.match(/Achieved.*:\s*(\d+)/);R&&c.push({product:R[1],target:Number(R[2]),achieved:I?Number(I[1]):0})}return c},h=["Batch No","Date","Start Time","Operator","Recipe Name","Cubic Meter","Cycle","End Time","Total Target","Total Achieved","Water","Admix"],o=i=>{if(!i&&!i.length>0)return;let c={};return i.forEach(f=>{h.forEach(a=>{var L;if(f.includes(a)){const I=((L=f.split(/[:\-](.+)/)[1])==null?void 0:L.trim())||"";c[a]=I}})}),c};p.useEffect(()=>{if(console.log("bacth reports data11",l),l&&l.length>0){let i=l.map(c=>{let f=$((c==null?void 0:c.parts)||[]),a=o((c==null?void 0:c.parts)||[]);return{productArr:f,generalKeyInfo:a,imei:c==null?void 0:c.deviceId}});i&&i.length>0?M(i):M([]),console.log("formatted arr",i)}},[l]),p.useEffect(()=>{if(n&&n.length>0){let i=n.map(c=>({...c,label:c.group_name,value:c.id}));C(i)}},[n,s,_]),p.useEffect(()=>{u||g(ae())},[]);function D(i){console.log("value changed",i),g(Ne(i))}function H(i){console.log("value",i),g(ke(i))}const K=async()=>{const i=`${b} 00:00`,c=`${v} 23:59`;if(!F())return;g(Ue({imei:u,startDate:i,endDate:c}))},F=()=>!b||!v||u==="all"?(U.error("Please select start date, end date, and vehicle."),!1):!0,O=y==="All"?s:s.filter(i=>i.vehicle_group===y);return e.jsxs(z,{sx:{width:"100%",m:"auto"},children:[e.jsx(z,{sx:{ml:"10px"},children:e.jsx(Ee,{handleBack:j,downloadData:A})}),e.jsxs(z,{children:[e.jsxs(N,{size:"large",value:y,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:D,filterOption:(i,c)=>{var f;return typeof((f=c==null?void 0:c.props)==null?void 0:f.children)=="string"&&c.props.children.toLowerCase().indexOf(i.toLowerCase())>=0},children:[e.jsx(N.Option,{value:"All",children:"All"}),d.map((i,c)=>e.jsx(N.Option,{value:i.value,children:i.label},c))]}),e.jsxs(N,{size:"large",value:u,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:H,filterOption:(i,c)=>{var f;return typeof((f=c==null?void 0:c.props)==null?void 0:f.children)=="string"&&c.props.children.toLowerCase().indexOf(i.toLowerCase())>=0},children:[e.jsx(N.Option,{value:"all",children:"None"},"all"),O&&O.length>0&&O.map((i,c)=>{var f;return e.jsx(N.Option,{value:(f=i.imei[0])==null?void 0:f.mac_id,children:i.registration_id},c)})]}),e.jsx(Ae,{setStartDate:S,setEndDate:T,selectedDate:!1,startDate:b,endDate:v}),e.jsx(q,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:K,disabled:!u,children:"Generate report"})]}),x&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(Le,{})}),r&&r.length>0&&e.jsx(z,{ml:1.5,children:e.jsx(ua,{tableData:r||[]})})]})}function De({children:j,value:S,index:b}){return e.jsx("div",{role:"tabpanel",hidden:S!==b,children:S===b&&e.jsx(z,{p:2,children:j})})}function ba({showCard:j,setReportType:S,reportType:b}){const{mode:T}=k(V=>V.dashboard),{selectedVehicle:v}=k(V=>V.liveMap),{startDate:g,endDate:n,tabValue:s}=k(V=>V.report),[r,l]=p.useState(!0),[x,y]=p.useState({}),[u,_]=p.useState(!1);let d=Z();p.useEffect(()=>{},[n]),p.useEffect(()=>{d(Se()),d(ye())},[]);const C=()=>{d(ae()),d(Se()),d(ye()),d(S(null))},E=(V,A)=>{d(Xe(A))};return e.jsx(e.Fragment,{children:e.jsx(z,{sx:{},children:e.jsxs(z,{children:[e.jsxs(Ze,{value:s,onChange:E,children:[e.jsx(me,{label:"Vehicle Report"}),e.jsx(me,{label:"Batch data report"})]}),e.jsx(De,{value:s,index:0,children:e.jsx(ga,{handleBack:C,selectedDate:r,setEndDate:_e,setStartDate:Te,startDate:g,endDate:n})}),e.jsx(De,{value:s,index:1,children:e.jsx(ja,{handleBack:C,selectedDate:r,setEndDate:_e,setStartDate:Te,startDate:g,endDate:n})})]})})})}function Ta(){const{mode:j,showVehicles:S,selectedVehicleGroup:b}=k(d=>d.dashboard),{w_customer_id:T}=k(d=>d.auth),{reportType:v}=k(d=>d.report),[g,n]=p.useState([]),[s,r]=p.useState(!0),[l,x]=p.useState(!1),y=la(j);let u=Z();p.useEffect(()=>{_()},[]);const _=async()=>{try{let d=[],C=[];const E=await u(qe({w_customer_id:T}));if(Array.isArray(E.payload)){E.payload.forEach(m=>{var Y,M;Array.isArray(m.imei)&&m.imei.length>0?(d.push({id:m.id,label:m.registration_id,value:(Y=m==null?void 0:m.imei[0])==null?void 0:Y.mac_id,workShop:m==null?void 0:m.workshop,vehicle_group:m==null?void 0:m.vehicle_group}),C.push((M=m.imei[0])==null?void 0:M.mac_id)):console.error("IMEI data not found for item:",m)});const V="one",A=C;C.length>0&&(u(Je({type:V,imei:A})),u(Qe(A))),n(d),u(we({w_customer_id:T})),u(ea({}))}else console.error("Unexpected data format:",E),U.error("Unexpected data format:")}catch(d){console.error("Error fetching vehicle data:",d),U.error(`Error fetching vehicle data: ${d}`)}};return g.filter(d=>Object.keys(b).length===0||d.vehicle_group===b.id),e.jsxs("div",{className:"app",children:[e.jsx(aa,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:y.grey[100]},children:[e.jsx(ta,{title:"Report",setShowVehiclesGroup:x,showVehiclesGroup:l,reportType:v}),e.jsx(sa,{setShowVehiclesGroup:x,showVehiclesGroup:l}),e.jsxs(z,{style:{display:"flex",width:"100%",height:"95vh",background:y.grey[200]},children:[e.jsx(z,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(z,{style:{width:"100%"},children:e.jsx(ba,{showCard:s,setReportType:na,reportType:v})})}),!1]})]})]})}export{Ta as default};
