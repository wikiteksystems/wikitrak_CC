import{R as O,r as N,k as je,i as He,j as i,T as Qe,am as le,B as pe,aE as ns,w as ne,aF as Ne,aG as ls,aH as os,aI as qe,aJ as Re,aK as Ie,aL as cs,I as it,ai as us,ak as ds,t as rt,aM as fs,aN as hs,aO as ms,W as bt,K as gs,L as ys,N as xs,O as ps}from"./index-qR5_4q7m.js";import{L as vs}from"./LiveMapTopBar-CLOdih89.js";import{V as bs}from"./VehicleMenu-DbPkbgvd.js";import{g as Xe,a as _t,D as Ze,d as _s,L as js,t as Vs}from"./LeftSideBar2-BwuQdGYp.js";import"./Loader-CbsxlpsZ.js";import"./LiveMapServices-DP22Vekv.js";import"./Socket-0N_gnJcr.js";import{P as Ss}from"./Parameters-94C7-lzQ.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{d as Es}from"./Close-IqMwfY3q.js";import{d as As}from"./Add-COhICNcs.js";import{c as Fs,a as be,d as jt,e as Cs}from"./index.esm-D5_UQ9lD.js";import{B as ae,F as we,a as De,L as ws,O as Ds,I as ks}from"./menu2-o2S8OUTn.js";import{T as Ue,S as ke,M as he,P as qs}from"./TextField-apBnlx-B.js";import{D as Lt,a as Ot,b as Ts,T as Ls}from"./TablePagination-CgUAuh8e.js";import{D as Ut,a as Os,E as Us,T as Se}from"./Edit-FB6vV-GD.js";import{T as Ps,a as Ns,b as Rs,c as Vt,d as Is}from"./TableRow-Chdm8ueZ.js";import{T as Q}from"./TableCell-BfNAXHFX.js";import{V as Bs}from"./VehicleGroups-CuSWY-4O.js";import"./jcb-aCHXMCXy.js";import"./index-Dgq_4SYb.js";import"./createSvgIcon-BNk9rkul.js";import"./useControlled-BhSc7wpy.js";import"./index-D_YKrru_.js";import"./Card-B1Fa2_5f.js";import"./Skeleton-AxbPzYt2.js";import"./CardContent-BP2ejk0V.js";var Oe=e=>e.type==="checkbox",_e=e=>e instanceof Date,X=e=>e==null;const Pt=e=>typeof e=="object";var $=e=>!X(e)&&!Array.isArray(e)&&Pt(e)&&!_e(e),Nt=e=>$(e)&&e.target?Oe(e.target)?e.target.checked:e.target.value:e,Ms=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,Rt=(e,s)=>e.has(Ms(s)),Ws=e=>{const s=e.constructor&&e.constructor.prototype;return $(s)&&s.hasOwnProperty("isPrototypeOf")},nt=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function se(e){let s;const t=Array.isArray(e);if(e instanceof Date)s=new Date(e);else if(e instanceof Set)s=new Set(e);else if(!(nt&&(e instanceof Blob||e instanceof FileList))&&(t||$(e)))if(s=t?[]:{},!t&&!Ws(e))s=e;else for(const a in e)e.hasOwnProperty(a)&&(s[a]=se(e[a]));else return e;return s}var Ge=e=>Array.isArray(e)?e.filter(Boolean):[],M=e=>e===void 0,f=(e,s,t)=>{if(!s||!$(e))return t;const a=Ge(s.split(/[,[\].]+?/)).reduce((o,n)=>X(o)?o:o[n],e);return M(a)||a===e?M(e[s])?t:e[s]:a},oe=e=>typeof e=="boolean",lt=e=>/^\w*$/.test(e),It=e=>Ge(e.replace(/["|']|\]/g,"").split(/\.|\[/)),L=(e,s,t)=>{let a=-1;const o=lt(s)?[s]:It(s),n=o.length,u=n-1;for(;++a<n;){const y=o[a];let V=t;if(a!==u){const m=e[y];V=$(m)||Array.isArray(m)?m:isNaN(+o[a+1])?{}:[]}if(y==="__proto__")return;e[y]=V,e=e[y]}return e};const Be={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},ce={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},fe={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},$s=O.createContext(null),ot=()=>O.useContext($s);var Bt=(e,s,t,a=!0)=>{const o={defaultValues:s._defaultValues};for(const n in e)Object.defineProperty(o,n,{get:()=>{const u=n;return s._proxyFormState[u]!==ce.all&&(s._proxyFormState[u]=!a||ce.all),t&&(t[u]=!0),e[u]}});return o},re=e=>$(e)&&!Object.keys(e).length,Mt=(e,s,t,a)=>{t(e);const{name:o,...n}=e;return re(n)||Object.keys(n).length>=Object.keys(s).length||Object.keys(n).find(u=>s[u]===(!a||ce.all))},Te=e=>Array.isArray(e)?e:[e],Wt=(e,s,t)=>!e||!s||e===s||Te(e).some(a=>a&&(t?a===s:a.startsWith(s)||s.startsWith(a)));function ct(e){const s=O.useRef(e);s.current=e,O.useEffect(()=>{const t=!e.disabled&&s.current.subject&&s.current.subject.subscribe({next:s.current.next});return()=>{t&&t.unsubscribe()}},[e.disabled])}function Hs(e){const s=ot(),{control:t=s.control,disabled:a,name:o,exact:n}=e||{},[u,y]=O.useState(t._formState),V=O.useRef(!0),m=O.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),b=O.useRef(o);return b.current=o,ct({disabled:a,next:g=>V.current&&Wt(b.current,g.name,n)&&Mt(g,m.current,t._updateFormState)&&y({...t._formState,...g}),subject:t._subjects.state}),O.useEffect(()=>(V.current=!0,m.current.isValid&&t._updateValid(!0),()=>{V.current=!1}),[t]),Bt(u,t,m.current,!1)}var de=e=>typeof e=="string",$t=(e,s,t,a,o)=>de(e)?(a&&s.watch.add(e),f(t,e,o)):Array.isArray(e)?e.map(n=>(a&&s.watch.add(n),f(t,n))):(a&&(s.watchAll=!0),t);function Gs(e){const s=ot(),{control:t=s.control,name:a,defaultValue:o,disabled:n,exact:u}=e||{},y=O.useRef(a);y.current=a,ct({disabled:n,subject:t._subjects.values,next:b=>{Wt(y.current,b.name,u)&&m(se($t(y.current,t._names,b.values||t._formValues,!1,o)))}});const[V,m]=O.useState(t._getWatch(a,o));return O.useEffect(()=>t._removeUnmounted()),V}function zs(e){const s=ot(),{name:t,disabled:a,control:o=s.control,shouldUnregister:n}=e,u=Rt(o._names.array,t),y=Gs({control:o,name:t,defaultValue:f(o._formValues,t,f(o._defaultValues,t,e.defaultValue)),exact:!0}),V=Hs({control:o,name:t,exact:!0}),m=O.useRef(o.register(t,{...e.rules,value:y,...oe(e.disabled)?{disabled:e.disabled}:{}}));return O.useEffect(()=>{const b=o._options.shouldUnregister||n,g=(B,W)=>{const D=f(o._fields,B);D&&D._f&&(D._f.mount=W)};if(g(t,!0),b){const B=se(f(o._options.defaultValues,t));L(o._defaultValues,t,B),M(f(o._formValues,t))&&L(o._formValues,t,B)}return()=>{(u?b&&!o._state.action:b)?o.unregister(t):g(t,!1)}},[t,o,u,n]),O.useEffect(()=>{f(o._fields,t)&&o._updateDisabledField({disabled:a,fields:o._fields,name:t,value:f(o._fields,t)._f.value})},[a,t,o]),{field:{name:t,value:y,...oe(a)||V.disabled?{disabled:V.disabled||a}:{},onChange:O.useCallback(b=>m.current.onChange({target:{value:Nt(b),name:t},type:Be.CHANGE}),[t]),onBlur:O.useCallback(()=>m.current.onBlur({target:{value:f(o._formValues,t),name:t},type:Be.BLUR}),[t,o]),ref:O.useCallback(b=>{const g=f(o._fields,t);g&&b&&(g._f.ref={focus:()=>b.focus(),select:()=>b.select(),setCustomValidity:B=>b.setCustomValidity(B),reportValidity:()=>b.reportValidity()})},[o._fields,t])},formState:V,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!f(V.errors,t)},isDirty:{enumerable:!0,get:()=>!!f(V.dirtyFields,t)},isTouched:{enumerable:!0,get:()=>!!f(V.touchedFields,t)},isValidating:{enumerable:!0,get:()=>!!f(V.validatingFields,t)},error:{enumerable:!0,get:()=>f(V.errors,t)}})}}const ue=e=>e.render(zs(e));var Ht=(e,s,t,a,o)=>s?{...t[e],types:{...t[e]&&t[e].types?t[e].types:{},[a]:o||!0}}:{},St=e=>({isOnSubmit:!e||e===ce.onSubmit,isOnBlur:e===ce.onBlur,isOnChange:e===ce.onChange,isOnAll:e===ce.all,isOnTouch:e===ce.onTouched}),Et=(e,s,t)=>!t&&(s.watchAll||s.watch.has(e)||[...s.watch].some(a=>e.startsWith(a)&&/^\.\w+/.test(e.slice(a.length))));const Le=(e,s,t,a)=>{for(const o of t||Object.keys(e)){const n=f(e,o);if(n){const{_f:u,...y}=n;if(u){if(u.refs&&u.refs[0]&&s(u.refs[0],o)&&!a)return!0;if(u.ref&&s(u.ref,u.name)&&!a)return!0;if(Le(y,s))break}else if($(y)&&Le(y,s))break}}};var Ks=(e,s,t)=>{const a=Te(f(e,t));return L(a,"root",s[t]),L(e,t,a),e},ut=e=>e.type==="file",me=e=>typeof e=="function",Me=e=>{if(!nt)return!1;const s=e?e.ownerDocument:0;return e instanceof(s&&s.defaultView?s.defaultView.HTMLElement:HTMLElement)},Pe=e=>de(e),dt=e=>e.type==="radio",We=e=>e instanceof RegExp;const At={value:!1,isValid:!1},Ft={value:!0,isValid:!0};var Gt=e=>{if(Array.isArray(e)){if(e.length>1){const s=e.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:s,isValid:!!s.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!M(e[0].attributes.value)?M(e[0].value)||e[0].value===""?Ft:{value:e[0].value,isValid:!0}:Ft:At}return At};const Ct={isValid:!1,value:null};var zt=e=>Array.isArray(e)?e.reduce((s,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:s,Ct):Ct;function wt(e,s,t="validate"){if(Pe(e)||Array.isArray(e)&&e.every(Pe)||oe(e)&&!e)return{type:t,message:Pe(e)?e:"",ref:s}}var Ee=e=>$(e)&&!We(e)?e:{value:e,message:""},Dt=async(e,s,t,a,o)=>{const{ref:n,refs:u,required:y,maxLength:V,minLength:m,min:b,max:g,pattern:B,validate:W,name:D,valueAsNumber:H,mount:G,disabled:ie}=e._f,C=f(s,D);if(!G||ie)return{};const S=u?u[0]:n,U=F=>{a&&S.reportValidity&&(S.setCustomValidity(oe(F)?"":F||""),S.reportValidity())},A={},T=dt(n),J=Oe(n),Z=T||J,R=(H||ut(n))&&M(n.value)&&M(C)||Me(n)&&n.value===""||C===""||Array.isArray(C)&&!C.length,I=Ht.bind(null,D,t,A),ee=(F,k,_,x=fe.maxLength,v=fe.minLength)=>{const E=F?k:_;A[D]={type:F?x:v,message:E,ref:n,...I(F?x:v,E)}};if(o?!Array.isArray(C)||!C.length:y&&(!Z&&(R||X(C))||oe(C)&&!C||J&&!Gt(u).isValid||T&&!zt(u).isValid)){const{value:F,message:k}=Pe(y)?{value:!!y,message:y}:Ee(y);if(F&&(A[D]={type:fe.required,message:k,ref:S,...I(fe.required,k)},!t))return U(k),A}if(!R&&(!X(b)||!X(g))){let F,k;const _=Ee(g),x=Ee(b);if(!X(C)&&!isNaN(C)){const v=n.valueAsNumber||C&&+C;X(_.value)||(F=v>_.value),X(x.value)||(k=v<x.value)}else{const v=n.valueAsDate||new Date(C),E=te=>new Date(new Date().toDateString()+" "+te),P=n.type=="time",q=n.type=="week";de(_.value)&&C&&(F=P?E(C)>E(_.value):q?C>_.value:v>new Date(_.value)),de(x.value)&&C&&(k=P?E(C)<E(x.value):q?C<x.value:v<new Date(x.value))}if((F||k)&&(ee(!!F,_.message,x.message,fe.max,fe.min),!t))return U(A[D].message),A}if((V||m)&&!R&&(de(C)||o&&Array.isArray(C))){const F=Ee(V),k=Ee(m),_=!X(F.value)&&C.length>+F.value,x=!X(k.value)&&C.length<+k.value;if((_||x)&&(ee(_,F.message,k.message),!t))return U(A[D].message),A}if(B&&!R&&de(C)){const{value:F,message:k}=Ee(B);if(We(F)&&!C.match(F)&&(A[D]={type:fe.pattern,message:k,ref:n,...I(fe.pattern,k)},!t))return U(k),A}if(W){if(me(W)){const F=await W(C,s),k=wt(F,S);if(k&&(A[D]={...k,...I(fe.validate,k.message)},!t))return U(k.message),A}else if($(W)){let F={};for(const k in W){if(!re(F)&&!t)break;const _=wt(await W[k](C,s),S,k);_&&(F={..._,...I(k,_.message)},U(_.message),t&&(A[D]=F))}if(!re(F)&&(A[D]={ref:S,...F},!t))return A}}return U(!0),A};function Ys(e,s){const t=s.slice(0,-1).length;let a=0;for(;a<t;)e=M(e)?a++:e[s[a++]];return e}function Js(e){for(const s in e)if(e.hasOwnProperty(s)&&!M(e[s]))return!1;return!0}function z(e,s){const t=Array.isArray(s)?s:lt(s)?[s]:It(s),a=t.length===1?e:Ys(e,t),o=t.length-1,n=t[o];return a&&delete a[n],o!==0&&($(a)&&re(a)||Array.isArray(a)&&Js(a))&&z(e,t.slice(0,-1)),e}var et=()=>{let e=[];return{get observers(){return e},next:o=>{for(const n of e)n.next&&n.next(o)},subscribe:o=>(e.push(o),{unsubscribe:()=>{e=e.filter(n=>n!==o)}}),unsubscribe:()=>{e=[]}}},at=e=>X(e)||!Pt(e);function xe(e,s){if(at(e)||at(s))return e===s;if(_e(e)&&_e(s))return e.getTime()===s.getTime();const t=Object.keys(e),a=Object.keys(s);if(t.length!==a.length)return!1;for(const o of t){const n=e[o];if(!a.includes(o))return!1;if(o!=="ref"){const u=s[o];if(_e(n)&&_e(u)||$(n)&&$(u)||Array.isArray(n)&&Array.isArray(u)?!xe(n,u):n!==u)return!1}}return!0}var Kt=e=>e.type==="select-multiple",Qs=e=>dt(e)||Oe(e),tt=e=>Me(e)&&e.isConnected,Yt=e=>{for(const s in e)if(me(e[s]))return!0;return!1};function $e(e,s={}){const t=Array.isArray(e);if($(e)||t)for(const a in e)Array.isArray(e[a])||$(e[a])&&!Yt(e[a])?(s[a]=Array.isArray(e[a])?[]:{},$e(e[a],s[a])):X(e[a])||(s[a]=!0);return s}function Jt(e,s,t){const a=Array.isArray(e);if($(e)||a)for(const o in e)Array.isArray(e[o])||$(e[o])&&!Yt(e[o])?M(s)||at(t[o])?t[o]=Array.isArray(e[o])?$e(e[o],[]):{...$e(e[o])}:Jt(e[o],X(s)?{}:s[o],t[o]):t[o]=!xe(e[o],s[o]);return t}var Fe=(e,s)=>Jt(e,s,$e(s)),Qt=(e,{valueAsNumber:s,valueAsDate:t,setValueAs:a})=>M(e)?e:s?e===""?NaN:e&&+e:t&&de(e)?new Date(e):a?a(e):e;function st(e){const s=e.ref;if(!(e.refs?e.refs.every(t=>t.disabled):s.disabled))return ut(s)?s.files:dt(s)?zt(e.refs).value:Kt(s)?[...s.selectedOptions].map(({value:t})=>t):Oe(s)?Gt(e.refs).value:Qt(M(s.value)?e.ref.value:s.value,e)}var Xs=(e,s,t,a)=>{const o={};for(const n of e){const u=f(s,n);u&&L(o,n,u._f)}return{criteriaMode:t,names:[...e],fields:o,shouldUseNativeValidation:a}},Ce=e=>M(e)?e:We(e)?e.source:$(e)?We(e.value)?e.value.source:e.value:e;const kt="AsyncFunction";var Zs=e=>(!e||!e.validate)&&!!(me(e.validate)&&e.validate.constructor.name===kt||$(e.validate)&&Object.values(e.validate).find(s=>s.constructor.name===kt)),er=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function qt(e,s,t){const a=f(e,t);if(a||lt(t))return{error:a,name:t};const o=t.split(".");for(;o.length;){const n=o.join("."),u=f(s,n),y=f(e,n);if(u&&!Array.isArray(u)&&t!==n)return{name:t};if(y&&y.type)return{name:n,error:y};o.pop()}return{name:t}}var tr=(e,s,t,a,o)=>o.isOnAll?!1:!t&&o.isOnTouch?!(s||e):(t?a.isOnBlur:o.isOnBlur)?!e:(t?a.isOnChange:o.isOnChange)?e:!0,sr=(e,s)=>!Ge(f(e,s)).length&&z(e,s);const rr={mode:ce.onSubmit,reValidateMode:ce.onChange,shouldFocusError:!0};function ar(e={}){let s={...rr,...e},t={submitCount:0,isDirty:!1,isLoading:me(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},a={},o=$(s.defaultValues)||$(s.values)?se(s.defaultValues||s.values)||{}:{},n=s.shouldUnregister?{}:se(o),u={action:!1,mount:!1,watch:!1},y={mount:new Set,unMount:new Set,array:new Set,watch:new Set},V,m=0;const b={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},g={values:et(),array:et(),state:et()},B=St(s.mode),W=St(s.reValidateMode),D=s.criteriaMode===ce.all,H=r=>l=>{clearTimeout(m),m=setTimeout(r,l)},G=async r=>{if(!e.disabled&&(b.isValid||r)){const l=s.resolver?re((await Z()).errors):await I(a,!0);l!==t.isValid&&g.state.next({isValid:l})}},ie=(r,l)=>{!e.disabled&&(b.isValidating||b.validatingFields)&&((r||Array.from(y.mount)).forEach(c=>{c&&(l?L(t.validatingFields,c,l):z(t.validatingFields,c))}),g.state.next({validatingFields:t.validatingFields,isValidating:!re(t.validatingFields)}))},C=(r,l=[],c,p,h=!0,d=!0)=>{if(p&&c&&!e.disabled){if(u.action=!0,d&&Array.isArray(f(a,r))){const j=c(f(a,r),p.argA,p.argB);h&&L(a,r,j)}if(d&&Array.isArray(f(t.errors,r))){const j=c(f(t.errors,r),p.argA,p.argB);h&&L(t.errors,r,j),sr(t.errors,r)}if(b.touchedFields&&d&&Array.isArray(f(t.touchedFields,r))){const j=c(f(t.touchedFields,r),p.argA,p.argB);h&&L(t.touchedFields,r,j)}b.dirtyFields&&(t.dirtyFields=Fe(o,n)),g.state.next({name:r,isDirty:F(r,l),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else L(n,r,l)},S=(r,l)=>{L(t.errors,r,l),g.state.next({errors:t.errors})},U=r=>{t.errors=r,g.state.next({errors:t.errors,isValid:!1})},A=(r,l,c,p)=>{const h=f(a,r);if(h){const d=f(n,r,M(c)?f(o,r):c);M(d)||p&&p.defaultChecked||l?L(n,r,l?d:st(h._f)):x(r,d),u.mount&&G()}},T=(r,l,c,p,h)=>{let d=!1,j=!1;const w={name:r};if(!e.disabled){const K=!!(f(a,r)&&f(a,r)._f&&f(a,r)._f.disabled);if(!c||p){b.isDirty&&(j=t.isDirty,t.isDirty=w.isDirty=F(),d=j!==w.isDirty);const Y=K||xe(f(o,r),l);j=!!(!K&&f(t.dirtyFields,r)),Y||K?z(t.dirtyFields,r):L(t.dirtyFields,r,!0),w.dirtyFields=t.dirtyFields,d=d||b.dirtyFields&&j!==!Y}if(c){const Y=f(t.touchedFields,r);Y||(L(t.touchedFields,r,c),w.touchedFields=t.touchedFields,d=d||b.touchedFields&&Y!==c)}d&&h&&g.state.next(w)}return d?w:{}},J=(r,l,c,p)=>{const h=f(t.errors,r),d=b.isValid&&oe(l)&&t.isValid!==l;if(e.delayError&&c?(V=H(()=>S(r,c)),V(e.delayError)):(clearTimeout(m),V=null,c?L(t.errors,r,c):z(t.errors,r)),(c?!xe(h,c):h)||!re(p)||d){const j={...p,...d&&oe(l)?{isValid:l}:{},errors:t.errors,name:r};t={...t,...j},g.state.next(j)}},Z=async r=>{ie(r,!0);const l=await s.resolver(n,s.context,Xs(r||y.mount,a,s.criteriaMode,s.shouldUseNativeValidation));return ie(r),l},R=async r=>{const{errors:l}=await Z(r);if(r)for(const c of r){const p=f(l,c);p?L(t.errors,c,p):z(t.errors,c)}else t.errors=l;return l},I=async(r,l,c={valid:!0})=>{for(const p in r){const h=r[p];if(h){const{_f:d,...j}=h;if(d){const w=y.array.has(d.name),K=h._f&&Zs(h._f);K&&b.validatingFields&&ie([p],!0);const Y=await Dt(h,n,D,s.shouldUseNativeValidation&&!l,w);if(K&&b.validatingFields&&ie([p]),Y[d.name]&&(c.valid=!1,l))break;!l&&(f(Y,d.name)?w?Ks(t.errors,Y,d.name):L(t.errors,d.name,Y[d.name]):z(t.errors,d.name))}!re(j)&&await I(j,l,c)}}return c.valid},ee=()=>{for(const r of y.unMount){const l=f(a,r);l&&(l._f.refs?l._f.refs.every(c=>!tt(c)):!tt(l._f.ref))&&ze(r)}y.unMount=new Set},F=(r,l)=>!e.disabled&&(r&&l&&L(n,r,l),!xe(Ae(),o)),k=(r,l,c)=>$t(r,y,{...u.mount?n:M(l)?o:de(r)?{[r]:l}:l},c,l),_=r=>Ge(f(u.mount?n:o,r,e.shouldUnregister?f(o,r,[]):[])),x=(r,l,c={})=>{const p=f(a,r);let h=l;if(p){const d=p._f;d&&(!d.disabled&&L(n,r,Qt(l,d)),h=Me(d.ref)&&X(l)?"":l,Kt(d.ref)?[...d.ref.options].forEach(j=>j.selected=h.includes(j.value)):d.refs?Oe(d.ref)?d.refs.length>1?d.refs.forEach(j=>(!j.defaultChecked||!j.disabled)&&(j.checked=Array.isArray(h)?!!h.find(w=>w===j.value):h===j.value)):d.refs[0]&&(d.refs[0].checked=!!h):d.refs.forEach(j=>j.checked=j.value===h):ut(d.ref)?d.ref.value="":(d.ref.value=h,d.ref.type||g.values.next({name:r,values:{...n}})))}(c.shouldDirty||c.shouldTouch)&&T(r,h,c.shouldTouch,c.shouldDirty,!0),c.shouldValidate&&te(r)},v=(r,l,c)=>{for(const p in l){const h=l[p],d=`${r}.${p}`,j=f(a,d);(y.array.has(r)||$(h)||j&&!j._f)&&!_e(h)?v(d,h,c):x(d,h,c)}},E=(r,l,c={})=>{const p=f(a,r),h=y.array.has(r),d=se(l);L(n,r,d),h?(g.array.next({name:r,values:{...n}}),(b.isDirty||b.dirtyFields)&&c.shouldDirty&&g.state.next({name:r,dirtyFields:Fe(o,n),isDirty:F(r,d)})):p&&!p._f&&!X(d)?v(r,d,c):x(r,d,c),Et(r,y)&&g.state.next({...t}),g.values.next({name:u.mount?r:void 0,values:{...n}})},P=async r=>{u.mount=!0;const l=r.target;let c=l.name,p=!0;const h=f(a,c),d=()=>l.type?st(h._f):Nt(r),j=w=>{p=Number.isNaN(w)||_e(w)&&isNaN(w.getTime())||xe(w,f(n,c,w))};if(h){let w,K;const Y=d(),ve=r.type===Be.BLUR||r.type===Be.FOCUS_OUT,rs=!er(h._f)&&!s.resolver&&!f(t.errors,c)&&!h._f.deps||tr(ve,f(t.touchedFields,c),t.isSubmitted,W,B),Ye=Et(c,y,ve);L(n,c,Y),ve?(h._f.onBlur&&h._f.onBlur(r),V&&V(0)):h._f.onChange&&h._f.onChange(r);const Je=T(c,Y,ve,!1),as=!re(Je)||Ye;if(!ve&&g.values.next({name:c,type:r.type,values:{...n}}),rs)return b.isValid&&(e.mode==="onBlur"?ve&&G():G()),as&&g.state.next({name:c,...Ye?{}:Je});if(!ve&&Ye&&g.state.next({...t}),s.resolver){const{errors:pt}=await Z([c]);if(j(Y),p){const is=qt(t.errors,a,c),vt=qt(pt,a,is.name||c);w=vt.error,c=vt.name,K=re(pt)}}else ie([c],!0),w=(await Dt(h,n,D,s.shouldUseNativeValidation))[c],ie([c]),j(Y),p&&(w?K=!1:b.isValid&&(K=await I(a,!0)));p&&(h._f.deps&&te(h._f.deps),J(c,K,w,Je))}},q=(r,l)=>{if(f(t.errors,l)&&r.focus)return r.focus(),1},te=async(r,l={})=>{let c,p;const h=Te(r);if(s.resolver){const d=await R(M(r)?r:h);c=re(d),p=r?!h.some(j=>f(d,j)):c}else r?(p=(await Promise.all(h.map(async d=>{const j=f(a,d);return await I(j&&j._f?{[d]:j}:j)}))).every(Boolean),!(!p&&!t.isValid)&&G()):p=c=await I(a);return g.state.next({...!de(r)||b.isValid&&c!==t.isValid?{}:{name:r},...s.resolver||!r?{isValid:c}:{},errors:t.errors}),l.shouldFocus&&!p&&Le(a,q,r?h:y.mount),p},Ae=r=>{const l={...u.mount?n:o};return M(r)?l:de(r)?f(l,r):r.map(c=>f(l,c))},Ve=(r,l)=>({invalid:!!f((l||t).errors,r),isDirty:!!f((l||t).dirtyFields,r),error:f((l||t).errors,r),isValidating:!!f(t.validatingFields,r),isTouched:!!f((l||t).touchedFields,r)}),Zt=r=>{r&&Te(r).forEach(l=>z(t.errors,l)),g.state.next({errors:r?t.errors:{}})},ft=(r,l,c)=>{const p=(f(a,r,{_f:{}})._f||{}).ref,h=f(t.errors,r)||{},{ref:d,message:j,type:w,...K}=h;L(t.errors,r,{...K,...l,ref:p}),g.state.next({name:r,errors:t.errors,isValid:!1}),c&&c.shouldFocus&&p&&p.focus&&p.focus()},es=(r,l)=>me(r)?g.values.subscribe({next:c=>r(k(void 0,l),c)}):k(r,l,!0),ze=(r,l={})=>{for(const c of r?Te(r):y.mount)y.mount.delete(c),y.array.delete(c),l.keepValue||(z(a,c),z(n,c)),!l.keepError&&z(t.errors,c),!l.keepDirty&&z(t.dirtyFields,c),!l.keepTouched&&z(t.touchedFields,c),!l.keepIsValidating&&z(t.validatingFields,c),!s.shouldUnregister&&!l.keepDefaultValue&&z(o,c);g.values.next({values:{...n}}),g.state.next({...t,...l.keepDirty?{isDirty:F()}:{}}),!l.keepIsValid&&G()},ht=({disabled:r,name:l,field:c,fields:p,value:h})=>{if(oe(r)&&u.mount||r){const d=r?void 0:M(h)?st(c?c._f:f(p,l)._f):h;L(n,l,d),T(l,d,!1,!1,!0)}},Ke=(r,l={})=>{let c=f(a,r);const p=oe(l.disabled)||oe(e.disabled);return L(a,r,{...c||{},_f:{...c&&c._f?c._f:{ref:{name:r}},name:r,mount:!0,...l}}),y.mount.add(r),c?ht({field:c,disabled:oe(l.disabled)?l.disabled:e.disabled,name:r,value:l.value}):A(r,!0,l.value),{...p?{disabled:l.disabled||e.disabled}:{},...s.progressive?{required:!!l.required,min:Ce(l.min),max:Ce(l.max),minLength:Ce(l.minLength),maxLength:Ce(l.maxLength),pattern:Ce(l.pattern)}:{},name:r,onChange:P,onBlur:P,ref:h=>{if(h){Ke(r,l),c=f(a,r);const d=M(h.value)&&h.querySelectorAll&&h.querySelectorAll("input,select,textarea")[0]||h,j=Qs(d),w=c._f.refs||[];if(j?w.find(K=>K===d):d===c._f.ref)return;L(a,r,{_f:{...c._f,...j?{refs:[...w.filter(tt),d,...Array.isArray(f(o,r))?[{}]:[]],ref:{type:d.type,name:r}}:{ref:d}}}),A(r,!1,void 0,d)}else c=f(a,r,{}),c._f&&(c._f.mount=!1),(s.shouldUnregister||l.shouldUnregister)&&!(Rt(y.array,r)&&u.action)&&y.unMount.add(r)}}},mt=()=>s.shouldFocusError&&Le(a,q,y.mount),ts=r=>{oe(r)&&(g.state.next({disabled:r}),Le(a,(l,c)=>{const p=f(a,c);p&&(l.disabled=p._f.disabled||r,Array.isArray(p._f.refs)&&p._f.refs.forEach(h=>{h.disabled=p._f.disabled||r}))},0,!1))},gt=(r,l)=>async c=>{let p;c&&(c.preventDefault&&c.preventDefault(),c.persist&&c.persist());let h=se(n);if(g.state.next({isSubmitting:!0}),s.resolver){const{errors:d,values:j}=await Z();t.errors=d,h=j}else await I(a);if(z(t.errors,"root"),re(t.errors)){g.state.next({errors:{}});try{await r(h,c)}catch(d){p=d}}else l&&await l({...t.errors},c),mt(),setTimeout(mt);if(g.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:re(t.errors)&&!p,submitCount:t.submitCount+1,errors:t.errors}),p)throw p},ss=(r,l={})=>{f(a,r)&&(M(l.defaultValue)?E(r,se(f(o,r))):(E(r,l.defaultValue),L(o,r,se(l.defaultValue))),l.keepTouched||z(t.touchedFields,r),l.keepDirty||(z(t.dirtyFields,r),t.isDirty=l.defaultValue?F(r,se(f(o,r))):F()),l.keepError||(z(t.errors,r),b.isValid&&G()),g.state.next({...t}))},yt=(r,l={})=>{const c=r?se(r):o,p=se(c),h=re(r),d=h?o:p;if(l.keepDefaultValues||(o=c),!l.keepValues){if(l.keepDirtyValues){const j=new Set([...y.mount,...Object.keys(Fe(o,n))]);for(const w of Array.from(j))f(t.dirtyFields,w)?L(d,w,f(n,w)):E(w,f(d,w))}else{if(nt&&M(r))for(const j of y.mount){const w=f(a,j);if(w&&w._f){const K=Array.isArray(w._f.refs)?w._f.refs[0]:w._f.ref;if(Me(K)){const Y=K.closest("form");if(Y){Y.reset();break}}}}a={}}n=e.shouldUnregister?l.keepDefaultValues?se(o):{}:se(d),g.array.next({values:{...d}}),g.values.next({values:{...d}})}y={mount:l.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},u.mount=!b.isValid||!!l.keepIsValid||!!l.keepDirtyValues,u.watch=!!e.shouldUnregister,g.state.next({submitCount:l.keepSubmitCount?t.submitCount:0,isDirty:h?!1:l.keepDirty?t.isDirty:!!(l.keepDefaultValues&&!xe(r,o)),isSubmitted:l.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:h?{}:l.keepDirtyValues?l.keepDefaultValues&&n?Fe(o,n):t.dirtyFields:l.keepDefaultValues&&r?Fe(o,r):l.keepDirty?t.dirtyFields:{},touchedFields:l.keepTouched?t.touchedFields:{},errors:l.keepErrors?t.errors:{},isSubmitSuccessful:l.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1})},xt=(r,l)=>yt(me(r)?r(n):r,l);return{control:{register:Ke,unregister:ze,getFieldState:Ve,handleSubmit:gt,setError:ft,_executeSchema:Z,_getWatch:k,_getDirty:F,_updateValid:G,_removeUnmounted:ee,_updateFieldArray:C,_updateDisabledField:ht,_getFieldArray:_,_reset:yt,_resetDefaultValues:()=>me(s.defaultValues)&&s.defaultValues().then(r=>{xt(r,s.resetOptions),g.state.next({isLoading:!1})}),_updateFormState:r=>{t={...t,...r}},_disableForm:ts,_subjects:g,_proxyFormState:b,_setErrors:U,get _fields(){return a},get _formValues(){return n},get _state(){return u},set _state(r){u=r},get _defaultValues(){return o},get _names(){return y},set _names(r){y=r},get _formState(){return t},set _formState(r){t=r},get _options(){return s},set _options(r){s={...s,...r}}},trigger:te,register:Ke,handleSubmit:gt,watch:es,setValue:E,getValues:Ae,reset:xt,resetField:ss,clearErrors:Zt,unregister:ze,setError:ft,setFocus:(r,l={})=>{const c=f(a,r),p=c&&c._f;if(p){const h=p.refs?p.refs[0]:p.ref;h.focus&&(h.focus(),l.shouldSelect&&h.select())}},getFieldState:Ve}}function ir(e={}){const s=O.useRef(),t=O.useRef(),[a,o]=O.useState({isDirty:!1,isValidating:!1,isLoading:me(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:me(e.defaultValues)?void 0:e.defaultValues});s.current||(s.current={...ar(e),formState:a});const n=s.current.control;return n._options=e,ct({subject:n._subjects.state,next:u=>{Mt(u,n._proxyFormState,n._updateFormState,!0)&&o({...n._formState})}}),O.useEffect(()=>n._disableForm(e.disabled),[n,e.disabled]),O.useEffect(()=>{if(n._proxyFormState.isDirty){const u=n._getDirty();u!==a.isDirty&&n._subjects.state.next({isDirty:u})}},[n,a.isDirty]),O.useEffect(()=>{e.values&&!xe(e.values,t.current)?(n._reset(e.values,n._options.resetOptions),t.current=e.values,o(u=>({...u}))):n._resetDefaultValues()},[e.values,n]),O.useEffect(()=>{e.errors&&n._setErrors(e.errors)},[e.errors,n]),O.useEffect(()=>{n._state.mount||(n._updateValid(),n._state.mount=!0),n._state.watch&&(n._state.watch=!1,n._subjects.state.next({...n._formState})),n._removeUnmounted()}),O.useEffect(()=>{e.shouldUnregister&&n._subjects.values.next({values:n._getWatch()})},[e.shouldUnregister,n]),O.useEffect(()=>{s.current&&(s.current.watch=s.current.watch.bind({}))},[a]),s.current.formState=Bt(a,n),s.current}const Tt=(e,s,t)=>{if(e&&"reportValidity"in e){const a=f(t,s);e.setCustomValidity(a&&a.message||""),e.reportValidity()}},Xt=(e,s)=>{for(const t in s.fields){const a=s.fields[t];a&&a.ref&&"reportValidity"in a.ref?Tt(a.ref,t,e):a.refs&&a.refs.forEach(o=>Tt(o,t,e))}},nr=(e,s)=>{s.shouldUseNativeValidation&&Xt(e,s);const t={};for(const a in e){const o=f(s.fields,a),n=Object.assign(e[a]||{},{ref:o&&o.ref});if(lr(s.names||Object.keys(e),a)){const u=Object.assign({},f(t,a));L(u,"root",n),L(t,a,u)}else L(t,a,n)}return t},lr=(e,s)=>e.some(t=>t.startsWith(s+"."));function or(e,s,t){return s===void 0&&(s={}),t===void 0&&(t={}),function(a,o,n){try{return Promise.resolve(function(u,y){try{var V=(s.context,Promise.resolve(e[t.mode==="sync"?"validateSync":"validate"](a,Object.assign({abortEarly:!1},s,{context:o}))).then(function(m){return n.shouldUseNativeValidation&&Xt({},n),{values:t.raw?a:m,errors:{}}}))}catch(m){return y(m)}return V&&V.then?V.then(void 0,y):V}(0,function(u){if(!u.inner)throw u;return{values:{},errors:nr((y=u,V=!n.shouldUseNativeValidation&&n.criteriaMode==="all",(y.inner||[]).reduce(function(m,b){if(m[b.path]||(m[b.path]={message:b.message,type:b.type}),V){var g=m[b.path].types,B=g&&g[b.type];m[b.path]=Ht(b.path,V,m,b.type,B?[].concat(B,b.message):b.message)}return m},{})),n)};var y,V}))}catch(u){return Promise.reject(u)}}}const cr=Fs().shape({name:be().required("Name is required"),vehicle_model:jt().required("Vehicle model is required"),operator:be().required("Operator is required"),equipment_type:be().required("Equipment type is required"),serial_no:be().required("Serial No is required."),chassis_no:be().required("Chassis No is required."),odometer:jt().required("Odometer is required."),status:be().required("Status is required"),oem:be().required("OEM is required"),attachment:Cs().nullable()});function ur(){var _;const{handleSubmit:e,control:s,formState:{errors:t},reset:a}=ir({resolver:or(cr),defaultValues:{name:"",vehicle_model:"",operator:"",equipment_type:"",serial_no:"",chassis_no:"",odometer:"",status:"Assigned",oem:"",attachment:null}}),[o,n]=N.useState([]),{oemList:u,userList:y,equipmentTypes:V,UpdatedEqipmentData:m,isUpdateEqipment:b,isAddEqipment:g}=je(x=>x.equipment),[B,W]=N.useState(null),[D,H]=N.useState(null),[G,ie]=N.useState(""),[C,S]=N.useState(null),[U,A]=N.useState("Upload Attachment"),T=He();N.useEffect(()=>{console.log("equipmentTypes",V)},[V]),N.useEffect(()=>{if(console.log("UpdatedEqipmentData",m),m){a({name:m.name,vehicle_model:m.vehicle_model.id,operator:m.operator.id,equipment_type:m.equipment_type.id,serial_no:m.serial_no,chassis_no:m.chassis_no,odometer:m.odometer,status:m.status,oem:m.vehicle_model.oem,attachment:m.attachment});let x=[];x.push(m.vehicle_model),n(x),H(m.operator.id),S(m.attachment),A("edit")}},[m,a]);const J=async x=>{console.log("form data",x);const v=new FormData;if(Object.keys(x).forEach(E=>v.append(E,x[E])),!m)T(ns(v)).unwrap().then(()=>{ne.success("Equipment added successfully"),a(),T(Ne())}).catch(E=>{var P,q;ne.error("Failed to add equipment"),console.error("Error adding equipment:",E),((P=E==null?void 0:E.attachment)==null?void 0:P.length)>0&&E.attachment.map(te=>ne.error(`Error: ${te}`)),((q=E==null?void 0:E.name)==null?void 0:q.length)>0&&E.name.map(te=>ne.error(`Error: ${te}`))});else{const E=m.id;if(console.log("payload in action",v),typeof x.attachment=="string"){let q=await ls(x.attachment);console.log("file conversion",q),x.attachment=q}let P=new FormData;Object.keys(x).forEach(q=>{q==="attachment"&&x.attachment instanceof Blob?P.append(q,x.attachment,"attachment.jpg"):P.append(q,x[q])});for(let[q,te]of P.entries())console.log(q,te);T(os({formData:P,id:E})).unwrap().then(()=>{ne.success("Equipment updated successfully"),a(),T(Ne()),T(qe(null)),T(Re(!1)),T(Ie(!1))}).catch(q=>{var te,Ae;ne.error("Failed to update equipment"),console.error("Error updating equipment:",q),((te=q==null?void 0:q.attachment)==null?void 0:te.length)>0&&q.attachment.map(Ve=>ne.error(`Error: ${Ve}`)),((Ae=q==null?void 0:q.name)==null?void 0:Ae.length)>0&&q.name.map(Ve=>ne.error(`Error: ${Ve}`))})}},Z=async x=>{try{const v=await T(cs({oem_id:x}));v!=null&&v.payload&&n(v.payload.map(E=>({id:E.id,name:E.name,oem:E.oem})))}catch(v){console.error("Error while getting submodels:",v)}},R=x=>W(x.currentTarget),I=()=>{T(qe(null)),W(null)},ee=y==null?void 0:y.filter(x=>`${x.first_name} ${x.last_name}`.toLowerCase().includes(G.toLowerCase())),F=x=>{H(x),I()},k=()=>{T(Ie(!1)),T(Re(!1)),T(qe(null)),console.log("Form Canceled")};return i.jsxs(ae,{component:"form",onSubmit:e(J),sx:{p:3,backgroundColor:"#fff",borderRadius:2,boxShadow:3},children:[i.jsx(Qe,{variant:"h6",sx:{mb:2},children:"Add New Equipment"}),i.jsxs(le,{container:!0,spacing:2,children:[i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"name",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Name",fullWidth:!0,variant:"outlined",error:!!t.name,helperText:(v=t.name)==null?void 0:v.message})}})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"oem",control:s,render:({field:x})=>i.jsxs(we,{fullWidth:!0,variant:"outlined",error:!!t.oem,children:[i.jsx(De,{children:"OEM"}),i.jsxs(ke,{...x,label:"OEM",onChange:v=>{x.onChange(v.target.value),Z(v.target.value)},children:[i.jsx(he,{value:"",children:"Select OEM"}),u==null?void 0:u.map((v,E)=>i.jsx(he,{value:v.id,children:v.name},E))]})]})})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"vehicle_model",control:s,render:({field:x})=>i.jsxs(we,{fullWidth:!0,variant:"outlined",error:!!t.vehicle_model,children:[i.jsx(De,{children:"Vehicle Model"}),i.jsx(ke,{...x,label:"Vehicle Model",children:o.map(v=>i.jsx(he,{value:v.id,children:v.name},v.id))})]})})}),i.jsxs(le,{item:!0,xs:12,sm:6,children:[i.jsx(ue,{name:"operator",control:s,render:({field:x})=>i.jsxs(i.Fragment,{children:[i.jsx(pe,{fullWidth:!0,onClick:R,sx:{textAlign:"left",border:1,p:1.5},children:D?`${D.first_name} ${D.last_name}`:"Select Operator"}),i.jsx(qs,{open:!!B,anchorEl:B,onClose:I,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{maxHeight:300,overflowY:"auto"}},children:i.jsxs(ws,{children:[i.jsx(Xe,{children:i.jsx(Ds,{autoFocus:!0,placeholder:"Search user",fullWidth:!0,value:G,onChange:v=>ie(v.target.value)})}),ee.length>0?ee.map((v,E)=>i.jsx(Xe,{button:!0,onClick:()=>{F(v),x.onChange(v.id)},children:i.jsx(_t,{primary:`${v.first_name} ${v.last_name}`,secondary:v.email})},E)):i.jsx(Xe,{children:i.jsx(_t,{primary:"No Operator found"})})]})})]})}),i.jsx(Qe,{variant:"caption",color:"error",children:(_=t.operator)==null?void 0:_.message})]}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"equipment_type",control:s,render:({field:x})=>i.jsxs(we,{fullWidth:!0,variant:"outlined",error:!!t.equipment_type,children:[i.jsx(De,{children:"Equipment Types"}),i.jsxs(ke,{...x,label:"Equipment Type",onChange:v=>{x.onChange(v.target.value)},children:[i.jsx(he,{value:"",children:"Select Equipment Type"}),V==null?void 0:V.map((v,E)=>i.jsx(he,{value:v.id,children:v.name},E))]})]})})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"serial_no",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Serial Number",fullWidth:!0,variant:"outlined",error:!!t.serial_no,helperText:(v=t.serial_no)==null?void 0:v.message})}})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"chassis_no",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Chassis Number",fullWidth:!0,variant:"outlined",error:!!t.chassis_no,helperText:(v=t.chassis_no)==null?void 0:v.message})}})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"odometer",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Odometer",fullWidth:!0,type:"number",variant:"outlined",error:!!t.odometer,helperText:(v=t.odometer)==null?void 0:v.message})}})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"status",control:s,render:({field:x})=>i.jsxs(we,{fullWidth:!0,variant:"outlined",error:!!t.status,children:[i.jsx(De,{children:"Status"}),i.jsxs(ke,{...x,label:"Status",children:[i.jsx(he,{value:"Assigned",children:"Assigned"}),i.jsx(he,{value:"Unassigned",children:"Unassigned"})]})]})})}),i.jsxs(le,{item:!0,xs:12,sm:6,children:[i.jsx(ue,{name:"attachment",control:s,render:({field:x})=>i.jsxs(pe,{variant:"outlined",component:"label",fullWidth:!0,children:[U,i.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:v=>{const E=v.target.files[0];if(x.onChange(E),E){const P=URL.createObjectURL(E);S(P),A(E.name)}}})]})}),C&&i.jsxs(ae,{mt:2,textAlign:"center",children:[i.jsx(Qe,{variant:"subtitle1",children:"Uploaded Image:"}),i.jsx("img",{src:C,alt:"Preview",style:{width:"100%",maxHeight:"300px",objectFit:"contain"}})]})]}),i.jsxs(le,{item:!0,xs:12,children:[i.jsx(pe,{color:"primary",sx:{marginRight:"10px",border:"1px solid #f6f6f6"},onClick:k,children:"Cancel"}),i.jsx(pe,{variant:"contained",color:"primary",type:"submit",children:m?"Update":"Submit"})]})]})]})}const dr=({open:e,onClose:s,onConfirm:t})=>i.jsxs(Lt,{open:e,onClose:s,children:[i.jsx(Ut,{children:"Confirm Deletion"}),i.jsx(Ot,{children:i.jsxs(Os,{children:["Are you sure you want to delete this vehicle data?"," ",i.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),i.jsxs(Ts,{children:[i.jsx(pe,{onClick:s,color:"primary",children:"Cancel"}),i.jsx(pe,{onClick:t,color:"secondary",children:"Delete"})]})]}),fr="http://134.209.145.234/api/v1",hr={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},mr=({equipmentData:e})=>{const s=He(),{isUpdateEqipment:t}=je(m=>m.equipment),[a,o]=N.useState(!1),n=()=>{console.log("equipmentData",e);const m=localStorage.getItem("role");us.includes(m)?(s(Ie(!t)),s(qe(e))):ne.error(`Sorry! Your role is ${m}. You're not allowed to add, edit or delete the vehicle`)},u=async()=>{console.log("Vehicle data deleting");try{await ds.delete(`${fr}/vehicles/delete/${vehicleData.id}/`),ne.success("Vehicle data deleted successfully!"),s(Ne())}catch(m){console.error("Error deleting vehicle data:",m),ne.error("Failed to delete vehicle data. Please try again.")}o(!1)},y=()=>{o(!1)},V={color:"#686868"};return i.jsxs(ae,{sx:hr,children:[i.jsx(it,{onClick:n,children:i.jsx(Us,{sx:V})}),i.jsx(dr,{open:a,onClose:y,onConfirm:u})]})},gr=[{id:"all",name:"All"},{id:"assigned",name:"Assigned"},{id:"unassigned",name:"Unassigned"}],yr={assigned:!1,unAssgined:!1,all:!0},xr=()=>{const{isAddEqipment:e,equipmentTypes:s,isUpdateEqipment:t}=je(D=>D.equipment),[a,o]=N.useState(""),[n,u]=N.useState(yr),[y,V]=N.useState("");let m=He();const b=()=>{m(Re(!e))},g=()=>{m(Re(!1)),m(Ie(!1)),m(qe(null))},B=D=>{console.log("equipment type selected",D),o(D.id)},W=D=>{const H={assigned:D.id==="assigned",unassigned:D.id==="unassigned",all:D.id==="all"};u(H)};return i.jsxs(ae,{sx:{bgcolor:"white",height:"89vh",m:"15px",borderRadius:"10px"},children:[i.jsx(pr,{handleAdd:b,handleFilters:W,appliedFilters:n}),i.jsx(Ze,{}),i.jsxs(ae,{sx:{display:"flex",width:"100%",gap:"30px",padding:"10px"},children:[i.jsx(vr,{searchQuery:y,setSearchQuery:V}),i.jsx(br,{equipmentTypes:s,handleOnChange:B,selectedValue:a})]}),i.jsx(Ze,{}),i.jsx(_r,{appliedFilters:n,selectedEquipmentType:a,searchQuery:y}),i.jsx(Ze,{}),i.jsxs(Lt,{open:e||t,onClose:g,maxWidth:"md",fullWidth:!0,children:[i.jsx(Ut,{children:i.jsx(it,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8,color:D=>D.palette.grey[500]},children:i.jsx(Es,{})})}),i.jsx(Ot,{children:i.jsx(ur,{})})]})]})},pr=({handleAdd:e,handleFilters:s,appliedFilters:t})=>i.jsxs(ae,{sx:{display:"flex",justifyContent:"space-between",padding:"10px"},children:[i.jsx(ae,{children:gr.map(a=>i.jsx(pe,{onClick:()=>{s(a)},sx:{background:t[a.id]?"lightblue":"transparent",color:t[a.id]?"white":"black",ml:"3px","&:hover":{background:t[a.id]?rt.bgColor:"lightgrey"}},children:a.name},a.id))}),i.jsxs(pe,{onClick:e,sx:{color:"black",background:rt.bgColor},children:[i.jsx(As,{}),"Equipment"]})]}),vr=({setSearchQuery:e,searchQuery:s})=>i.jsxs(ae,{component:"form",border:"1px solid #000000",backgroundColor:"white",borderRadius:"20px",opacity:"75%",m:"3px",width:300,children:[i.jsx(ks,{sx:{my:.5,mx:2},placeholder:"Search equipments...",value:s,onChange:t=>e(t.target.value)}),i.jsx(it,{type:"submit",sx:{p:1},children:i.jsx(_s,{})})]}),br=({equipmentTypes:e,handleOnChange:s,selectedValue:t})=>i.jsx(ae,{sx:{width:"200px"},children:i.jsxs(we,{fullWidth:!0,children:[i.jsx(De,{id:"equipment-type-label",children:"Equipment Type"}),i.jsxs(ke,{labelId:"equipment-type-label",id:"equipment-type-select",label:"Equipment Type",value:t,onChange:a=>{const o=e.find(n=>n.id===a.target.value);s(o||{id:"",name:"No Equipment"})},children:[i.jsx(he,{value:"",children:"No Equipment"}),e&&e.length>0&&e.map(a=>i.jsx(he,{value:a.id,children:a.name},a.id))]})]})}),ge={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},ye={fontSize:"14px",padding:"10px"},_r=({appliedFilters:e,selectedEquipmentType:s,searchQuery:t})=>{const a=[5,10,25],[o,n]=N.useState(0),[u,y]=N.useState(10),{equipmentList:V}=je(S=>S.equipment),[m,b]=N.useState("asc"),[g,B]=N.useState(""),W=(S,U)=>{n(U)},D=S=>{y(parseInt(S.target.value,10)),n(0)},H=S=>{b(g===S&&m==="asc"?"desc":"asc"),B(S)},G=(S,U)=>U.split(".").reduce((A,T)=>A&&A[T],S),C=(S=>[...S].sort((U,A)=>{const T=G(U,g)||"",J=G(A,g)||"";return T<J?m==="asc"?-1:1:T>J?m==="asc"?1:-1:0}))(V.filter(S=>{var J,Z;const U=e.all||e.assigned&&S.status.toLowerCase()==="assigned"||e.unassigned&&S.status.toLowerCase()==="unassigned"||e.archived&&S.archived===!0,A=!s||S.equipment_type.id===s,T=!t||S.name.toLowerCase().includes(t.toLowerCase())||S.serial_no.toLowerCase().includes(t.toLowerCase())||((J=S==null?void 0:S.operator)==null?void 0:J.email)&&((Z=S==null?void 0:S.operator)==null?void 0:Z.email.toLowerCase().includes(t.toLowerCase()))||S.equipment_type.name.toLowerCase().includes(t.toLowerCase());return U&&A&&T}));return i.jsxs(ae,{children:[i.jsx(Ps,{sx:{height:"66vh",bgcolor:"white",borderRadius:"10px"},children:i.jsxs(Ns,{stickyHeader:!0,children:[i.jsx(Rs,{children:i.jsxs(Vt,{children:[i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:g==="name",direction:g==="name"?m:"asc",onClick:()=>H("name"),children:"Name"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:g==="vehicle_model.name",direction:g==="vehicle_model.name"?m:"asc",onClick:()=>H("vehicle_model.name"),children:"Model"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:g==="serial_no",direction:g==="serial_no"?m:"asc",onClick:()=>H("serial_no"),children:"Serial"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:g==="operator.name",direction:g==="operator.name"?m:"asc",onClick:()=>H("operator.name"),children:"Operator"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:g==="equipment_type.name",direction:g==="equipment_type.name"?m:"asc",onClick:()=>H("equipment_type.name"),children:"Equipment Name"})}),i.jsx(Q,{sx:ge,children:i.jsx(Se,{active:g==="status",direction:g==="status"?m:"asc",onClick:()=>H("status"),children:"Status"})}),i.jsx(Q,{sx:ge,children:"Open Issues"}),i.jsx(Q,{sx:ge,children:"Action"})]})}),i.jsx(Is,{children:C.slice(o*u,o*u+u).map((S,U)=>{var A,T,J;return i.jsxs(Vt,{hover:!0,children:[i.jsx(Q,{sx:ye,children:S.name||"N/A"}),i.jsx(Q,{sx:ye,children:((A=S.vehicle_model)==null?void 0:A.name)||"N/A"}),i.jsx(Q,{sx:ye,children:S.serial_no||"N/A"}),i.jsx(Q,{sx:ye,children:((T=S.operator)==null?void 0:T.name)||"N/A"}),i.jsx(Q,{sx:ye,children:((J=S.equipment_type)==null?void 0:J.name)||"N/A"}),i.jsx(Q,{sx:ye,children:S.status||"N/A"}),i.jsx(Q,{sx:ye,children:U+1}),i.jsx(Q,{sx:ye,children:i.jsx(mr,{equipmentData:S})})]},U)})})]})}),i.jsx(Ls,{component:"div",rowsPerPageOptions:a,count:C.length,rowsPerPage:u,page:o,onPageChange:W,onRowsPerPageChange:D,sx:{bgcolor:"white",borderTop:"1px solid #e0e0e0",boxShadow:"0px -2px 5px rgba(0,0,0,0.1)",mt:1,borderRadius:"0 0 10px 10px"}})]})},jr=xr;function ea(){const{locationData:e,selectedVehicle:s,selectedParameterList:t}=je(R=>R.liveMap),{mode:a,selectedVehicleGroup:o}=je(R=>R.dashboard),n=Vs(a),[u,y]=N.useState([]),{w_customer_id:V}=je(R=>R.auth),[m,b]=N.useState(),[g,B]=N.useState(!1),[W,D]=N.useState(!1),[H,G]=N.useState([]);N.useState(!0);const[ie,C]=N.useState(!1),[S,U]=N.useState(!1);let A=He();N.useEffect(()=>{T(),A(fs()),A(hs()),A(ms()),A(Ne())},[A]),N.useEffect(()=>{G([]),A(bt([{reg_id:"",imei:"",params:[]}]))},[s]);const T=async()=>{try{C(!0);let R=[],I=[];const ee=await A(gs({w_customer_id:V}));if(Array.isArray(ee.payload)){ee.payload.forEach(_=>{var x,v,E,P;Array.isArray(_.imei)&&_.imei.length>0&&((x=_.imei[0])!=null&&x.mac_id)?(R.push({id:_.id,label:_.registration_id,value:(v=_.imei[0])==null?void 0:v.mac_id,vehilce_type:_==null?void 0:_.segment,chassis_no:_==null?void 0:_.chassis_no,engine_no:_==null?void 0:_.engine_no,workShop:_==null?void 0:_.workshop,registration_id:_==null?void 0:_.registration_id,sell_date:_==null?void 0:_.sell_date,customer_name:_==null?void 0:_.customer_name,vehicle_model:(E=_==null?void 0:_.vehicle_model)==null?void 0:E.name,vehicle_group:_==null?void 0:_.vehicle_group}),I.push((P=_.imei[0])==null?void 0:P.mac_id)):console.error("IMEI data not found for item:",_)});const F="one",k=I;I.length>0&&A(ys({type:F,imei:k})),y(R),A(xs(R)),C(!1),A(ps({w_customer_id:V}))}else C(!1),console.error("Unexpected data format:",ee),ne.error("Unexpected data format:")}catch(R){console.error("Error fetching vehicle data:",R),ne.error(`Error fetching vehicle data: ${R}`)}},J=async R=>{const{label:I,imei:ee,id:F,reg_id:k,checked:_}=R;b(P=>P.map(q=>q.id===F?{...q,checked:!_}:q));let x=[...H],v=[...H];if(!_)e.forEach(P=>{P.latestDocument.imei===ee&&(x.push({label:I,value:P.latestDocument[I==="maininputvoltage"?"mainInputVoltage":I]}),v=x,G(x))});else{let P=H.filter(q=>q.label!==I);v=P,G(P)}console.log("tempParamList",v),A(bt([{reg_id:k,imei:ee,params:v}]))},Z=u.filter(R=>Object.keys(o).length===0||R.vehicle_group===o.id);return i.jsxs("div",{className:"app",children:[i.jsx(js,{}),i.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[i.jsx(vs,{title:"Equipments",setShowVehicles:B,showVehicles:g,setShowVehiclesGroup:U,showVehiclesGroup:S}),i.jsx(Bs,{setShowVehiclesGroup:U,showVehiclesGroup:S}),i.jsxs(ae,{style:{display:"flex",width:"100%",height:"95vh"},children:[i.jsx(ae,{style:{width:g||W?"80%":"100%",background:rt.bgShadow},children:i.jsx(jr,{})}),g&&i.jsx(ae,{style:{width:"20%",backgroundColor:n.grey[100]},children:i.jsx(bs,{vehicleData:Z,title:"Live Map",setParameterData:b,loadingVehicle:ie,setShowVehicles:B,showVehicles:g,showParameters:W,setShowParameters:D})}),W&&i.jsx(ae,{style:{width:"20%",backgroundColor:n.grey[100]},children:i.jsx(Ss,{parametersData:m,setParameterData:b,handleParameterChange:J})})]})]})]})}export{ea as default};
