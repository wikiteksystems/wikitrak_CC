import{l as Fe,o as Me,p as Ye,b as v,q as ke,f as We,_ as Ne,j as e,eB as He,g as $e,k as Be,a$ as H,a_ as w,bb as xe,dT as le,cf as se,dU as ne,dV as ie,dW as J,dX as a,dY as re,eh as Le,bm as G,aW as M,bl as Re,ca as Ee,b8 as ae,eC as ge,eD as ue,eE as k,bc as pe,bY as fe,eF as je,eG as me,bv as Pe,b7 as te,eH as Ge,eI as Ke,eJ as Ie,c4 as Ue,eK as Ve,eL as ze,eM as qe,eN as ce,eO as de,eP as he,eQ as Je,bw as Qe,bx as Xe,by as Ze,bA as we,bC as et,bq as tt,br as at,bs as lt,eR as st,b5 as nt}from"./index-BUUipN9e.js";import{D as ve,R as it,a as rt}from"./BatchRecipt2-CRhrBSVX.js";import"./index.esm-BAIY9XZI.js";function ct(C){return Fe("MuiTableFooter",C)}Me("MuiTableFooter",["root"]);const dt=["className","component"],ht=C=>{const{classes:R}=C;return Be({root:["root"]},ct,R)},ot=Ye("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(C,R)=>R.root})({display:"table-footer-group"}),xt={variant:"footer"},Oe="tfoot",gt=v.forwardRef(function(R,S){const E=ke({props:R,name:"MuiTableFooter"}),{className:g,component:T=Oe}=E,A=We(E,dt),t=Ne({},E,{component:T}),i=ht(t);return e.jsx(He.Provider,{value:xt,children:e.jsx(ot,Ne({as:T,className:$e(i.root,g),ref:S,role:T===Oe?null:"rowgroup",ownerState:t},A))})}),ut=gt;function pt({tableData:C}){const{vehicleList:R}=H(t=>t.liveMap),S=w(),E=xe();console.log("tableData: ",C);let g=t=>R.find(i=>{var l;return((l=i==null?void 0:i.imei[0])==null?void 0:l.mac_id)==t||""});const T=t=>{var i;S(Re({imei:t==null?void 0:t.imei,reg_id:(i=g(t.imei))==null?void 0:i.registration_id})),S(Ee({startDate:ae(t.date).startOf("day").toISOString(),endDate:ae(t.date).endOf("day").toISOString()})),E("/trip-monitor?source=TripDetail")},A=t=>{var i;S(Re({imei:t==null?void 0:t.imei,reg_id:(i=g(t.imei))==null?void 0:i.registration_id})),S(Ee({startDate:ae(t.date).startOf("day").toISOString(),endDate:ae(t.date).endOf("day").toISOString()})),E("/trip-report")};return e.jsx(le,{component:se,sx:{maxHeight:"70vh"},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(a,{align:"left",children:"Date"}),e.jsx(a,{align:"left",children:"Vehicle Name"}),e.jsx(a,{align:"left",children:"Start location"}),e.jsx(a,{align:"left",children:"End location"}),e.jsx(a,{align:"left",children:"Segment"}),e.jsx(a,{align:"left",children:"Operator"}),e.jsx(a,{align:"left",children:"Work done (acre)"}),e.jsx(a,{align:"left",children:"Engine hours"}),e.jsx(a,{align:"left",children:"Running Time"}),e.jsx(a,{align:"left",children:"Idle time"}),e.jsx(a,{align:"left",children:"Total Distance (km)"}),e.jsx(a,{align:"left",children:"Average Speed"}),e.jsx(a,{align:"left",children:"Total Engine Hours"}),e.jsx(a,{align:"left",children:"Last Reset Engine Hours"}),e.jsx(a,{align:"left",children:"Last Reset Timestamp"}),e.jsx(a,{align:"left",children:"Duration Since Last Reset"}),e.jsx(a,{align:"left",children:"Reset Perform By"}),e.jsx(a,{align:"left",children:"View Trips"}),e.jsx(a,{align:"left",children:"View Trip Report"})]})}),e.jsx(re,{children:C.map((t,i)=>{var l,r,n,u,y,j,N,V,Y,z,D;return e.jsxs(J,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",children:t.date}),e.jsx(a,{align:"left",children:(l=g(t.imei))==null?void 0:l.registration_id}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Le,{title:((r=t==null?void 0:t.startLocationName)==null?void 0:r.display_name)||(t==null?void 0:t.startLocationName)||"",children:e.jsx("span",{children:((n=t==null?void 0:t.startLocationName)==null?void 0:n.display_name)||(t==null?void 0:t.startLocationName)||""})})}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Le,{title:((u=t==null?void 0:t.endLocationName)==null?void 0:u.display_name)||(t==null?void 0:t.endLocationName)||"",children:e.jsx("span",{children:((y=t==null?void 0:t.endLocationName)==null?void 0:y.display_name)||(t==null?void 0:t.endLocationName)||""})})}),e.jsx(a,{align:"left",children:(j=g(t.imei))==null?void 0:j.segment}),e.jsx(a,{align:"left",children:(N=g(t.imei))==null?void 0:N.customer_name}),e.jsx(a,{align:"left",children:t.acreageStr}),e.jsx(a,{align:"left",children:t.engineHours}),e.jsx(a,{align:"left",children:t.runningTime}),e.jsx(a,{align:"left",children:t.idleTime}),e.jsx(a,{align:"left",children:t.totalDistance}),e.jsx(a,{align:"left",children:t.averageSpeed}),e.jsx(a,{align:"left",children:(V=g(t.imei))==null?void 0:V.total_engine_hours}),e.jsx(a,{align:"left",children:(Y=g(t.imei))==null?void 0:Y.old_total_engine_hours}),e.jsx(a,{align:"left",children:(()=>{const _=g(t.imei);return _!=null&&_.updated_engine_hours_date?G(_.updated_engine_hours_date).format("DD-MM-YYYY"):"--"})()}),e.jsx(a,{align:"left",children:(()=>{const _=g(t.imei),F=_==null?void 0:_.updated_engine_hours_date;if(!F)return"--";const B=G(),m=G(F),x=G.duration(B.diff(m)),I=x.days(),K=x.hours(),P=x.minutes();return`${I}d ${K}h ${P}m`})()}),e.jsx(a,{align:"left",children:((D=(z=g(t.imei))==null?void 0:z.reset_by_user)==null?void 0:D.email)||"--"}),e.jsx(a,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>T(t),children:"View on Map ðŸ”"})}),e.jsx(a,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer"},onClick:()=>A(t),children:"View Trip Report"})})]},i+1)})})]})})}function ft({handleBack:C,setStartDate:R,startDate:S,setEndDate:E,endDate:g}){const T=w(),{vehicleGroup:A,vehicleList:t}=H(m=>m.liveMap),{vehicleStatesData:i,loading:l,selectedGroup:r,selectedVehicle:n,distributorList:u}=H(m=>m.report),[y,j]=v.useState([]);v.useState([]);const[N,V]=v.useState([]);v.useEffect(()=>{},[l]),v.useEffect(()=>{if(A&&A.length>0){let m=A.map(x=>({...x,label:x.group_name,value:x.id}));j(m)}},[A,t,u]),v.useEffect(()=>{},[S,g]);let Y=m=>t.find(x=>{var I;return((I=x==null?void 0:x.imei[0])==null?void 0:I.mac_id)==m||""});v.useEffect(()=>{let m=(i==null?void 0:i.data)&&i.data.map(x=>{var $,c;let{customer_name:I,registration_id:K,segment:P,total_engine_hours:Q,old_total_engine_hours:p,updated_engine_hours_date:d,reset_by_user:b}=Y(x==null?void 0:x.imei);return{Date:x.date,vehicle:K,"Start Location":($=x==null?void 0:x.startLocationName)==null?void 0:$.display_name,"End Location":(c=x==null?void 0:x.endLocationName)==null?void 0:c.display_name,operator:I,segment:P,"Work Done":x==null?void 0:x.acreageStr,"Running Time":x.runningTime,"Idle Time":x.idleTime,"Engine hours":x.engineHours,"Total Distance (km)":x.totalDistance,"Average Speed":x.averageSpeed,"Total Engine Hours":Q,"Last Reset Engine Hours":p,"Last Reset Timestamp":d,"Reset Perform By":(b==null?void 0:b.email)||"--"}});V(m)},[i]),v.useEffect(()=>{n||T(ge())},[]);function z(m){console.log("value changed",m),T(je(m))}function D(m){T(me(m))}const _=async()=>{const m=`${S} 00:00`,x=`${g} 23:59`;if(!F())return;T(Pe({imei:n,startTime:m,endTime:x}))},F=()=>!S||!g||n==="all"?(te.error("Please select start date, end date, and vehicle."),!1):!0,B=r==="All"?t:t.filter(m=>m.vehicle_group===r);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(ue,{handleBack:C,downloadData:N})}),e.jsxs(M,{children:[e.jsxs(k,{size:"large",value:r,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:z,filterOption:(m,x)=>{var I;return typeof((I=x==null?void 0:x.props)==null?void 0:I.children)=="string"&&x.props.children.toLowerCase().indexOf(m.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"All",children:"All"}),y.map((m,x)=>e.jsx(k.Option,{value:m.value,children:m.label},x))]}),e.jsxs(k,{size:"large",value:n,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:D,filterOption:(m,x)=>{var I;return typeof((I=x==null?void 0:x.props)==null?void 0:I.children)=="string"&&x.props.children.toLowerCase().indexOf(m.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"all",children:"None"},"all"),B&&B.length>0&&B.map((m,x)=>{var I;return e.jsx(k.Option,{value:(I=m.imei[0])==null?void 0:I.mac_id,children:m.registration_id},x)})]}),e.jsx(ve,{setStartDate:R,setEndDate:E,selectedDate:!1,startDate:S,endDate:g}),e.jsx(pe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:_,disabled:!n,children:"Generate report"})]}),l&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(fe,{})}),(i==null?void 0:i.data)&&(i==null?void 0:i.data.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(pt,{tableData:(i==null?void 0:i.data)||[]})})]})}function jt({tableData:C}){const{vehicleList:R}=H(l=>l.liveMap);w(),xe();const[S,E]=v.useState(null),[g,T]=v.useState(!1);let A=l=>R.find(r=>{var n;return((n=r==null?void 0:r.imei[0])==null?void 0:n.mac_id)==l||""});const t=(l,r)=>r.find(u=>{var y;return((y=u==null?void 0:u.name)==null?void 0:y.toLowerCase().trim())===l})||null,i={fontSize:"12px",fontWeight:"bold"};return e.jsxs(e.Fragment,{children:[e.jsx(le,{component:se,sx:{maxHeight:"70vh"},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(a,{align:"left",sx:i,children:"Date"}),e.jsx(a,{align:"left",sx:i,children:"Vehicle Name"}),e.jsx(a,{align:"left",sx:i,children:"Batch No"}),e.jsx(a,{align:"left",sx:i,children:"Start Time"}),e.jsx(a,{align:"left",sx:i,children:"End Time"}),e.jsx(a,{align:"left",sx:i,children:"Total Target Weight"}),e.jsx(a,{align:"left",sx:i,children:"Total Achieved Weight"}),e.jsx(a,{align:"left",sx:i,children:"Recipe 1"}),e.jsx(a,{align:"left",sx:i,children:"Cement"}),e.jsx(a,{align:"left",sx:i,children:"10mm"}),e.jsx(a,{align:"left",sx:i,children:"20mm"}),e.jsx(a,{align:"left",sx:i,children:"Sand"}),e.jsx(a,{align:"left",sx:i,children:"Crush Sand"}),e.jsx(a,{align:"left",sx:i,children:"River Sand"}),e.jsx(a,{align:"left",sx:i,children:"Fly Ash"}),e.jsx(a,{align:"left",sx:i,children:"30mm"}),e.jsx(a,{align:"left",sx:i,children:"Water"}),e.jsx(a,{align:"left",sx:i,children:"Admix"}),e.jsx(a,{align:"left",sx:i,children:"Receipt"})]})}),e.jsx(re,{children:C.map((l,r)=>{var n,u,y,j,N,V,Y,z,D,_,F,B,m,x,I,K,P,Q,p,d,b,$,c,h,f,o,W,s,O,L,ee,X,U,q,Z,be,ye,Se,Te,Ae,_e,Ce,De;return e.jsxs(J,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(l==null?void 0:l.date)&&G(l==null?void 0:l.date,"DDMMYYYY").format("DD-MM-YYYY")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(n=A(l.imei))==null?void 0:n.registration_id}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l.batch_no}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l.start_time}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.end_time}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(u=l==null?void 0:l.total_target)==null?void 0:u.replace(/^0+/,"")}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(y=l==null?void 0:l.totalAcheived)==null?void 0:y.replace(/^0+/,"")}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.mix_name}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(N=(j=t("cement",l.materials||[]))==null?void 0:j.target)==null?void 0:N.replace(/^0+/,""),":",(Y=(V=t("cement",l.materials||[]))==null?void 0:V.actual)==null?void 0:Y.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(D=(z=t("10 mm",l.materials||[]))==null?void 0:z.target)==null?void 0:D.replace(/^0+/,""),":",(F=(_=t("10 mm",l.materials||[]))==null?void 0:_.actual)==null?void 0:F.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(m=(B=t("20 mm",l.materials||[]))==null?void 0:B.target)==null?void 0:m.replace(/^0+/,""),":",(I=(x=t("20 mm",l.materials||[]))==null?void 0:x.actual)==null?void 0:I.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(P=(K=t("sand",l.materials||[]))==null?void 0:K.target)==null?void 0:P.replace(/^0+/,""),":",(p=(Q=t("sand",l.materials||[]))==null?void 0:Q.actual)==null?void 0:p.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(b=(d=t("crush sand",l.materials||[]))==null?void 0:d.target)==null?void 0:b.replace(/^0+/,""),":",(c=($=t("crush sand",l.materials||[]))==null?void 0:$.actual)==null?void 0:c.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(f=(h=t("river sand",l.materials||[]))==null?void 0:h.target)==null?void 0:f.replace(/^0+/,""),":",(W=(o=t("river sand",l.materials||[]))==null?void 0:o.actual)==null?void 0:W.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(O=(s=t("fly ash",l.materials||[]))==null?void 0:s.target)==null?void 0:O.replace(/^0+/,""),":",(ee=(L=t("fly ash",l.materials||[]))==null?void 0:L.actual)==null?void 0:ee.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(U=(X=t("30 mm",l.materials||[]))==null?void 0:X.target)==null?void 0:U.replace(/^0+/,""),":",(Z=(q=t("30 mm",l.materials||[]))==null?void 0:q.actual)==null?void 0:Z.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(ye=(be=t("water",l.materials||[]))==null?void 0:be.target)==null?void 0:ye.replace(/^0+/,""),":",(Te=(Se=t("water",l.materials||[]))==null?void 0:Se.actual)==null?void 0:Te.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(_e=(Ae=t("admix",l.materials||[]))==null?void 0:Ae.target)==null?void 0:_e.replace(/^0+/,""),":",(De=(Ce=t("admix",l.materials||[]))==null?void 0:Ce.actual)==null?void 0:De.replace(/^0+/,"")]}),e.jsx(a,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",l),E(l),T(!0)},children:"View Receipt"})]},r+1)})}),e.jsx(ut,{children:e.jsxs(J,{children:[e.jsx(a,{children:e.jsx("b",{children:"Total"})}),e.jsx(a,{colSpan:3}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"}}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:C.reduce((r,n)=>{const u=(n==null?void 0:n.total_target)||"0",y=String(u).replace(/^0+/,""),j=parseFloat(y)||0;return r+j},0).toFixed(2)}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:C.reduce((l,r)=>l+(r!=null&&r.totalAcheived&&parseFloat(r.totalAcheived.replace(/^0+/,""))||0),0)}),e.jsx(a,{}),["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"].map(l=>{const r=C.reduce((u,y)=>{var N;const j=(N=t(l,y.materials||[]))==null?void 0:N.target;return u+(j&&parseFloat(j.replace(/^0+/,""))||0)},0),n=C.reduce((u,y)=>{var N;const j=(N=t(l,y.materials||[]))==null?void 0:N.actual;return u+(j&&parseFloat(j.replace(/^0+/,""))||0)},0);return e.jsxs(a,{align:"left",sx:{fontSize:"10px",fontWeight:"bold"},children:[r,":",n]},l)}),e.jsx(a,{})]})})]})}),e.jsx(it,{receiptData:S,open:g,setOpen:T})]})}function mt({tableData:C}){const{vehicleList:R}=H(n=>n.liveMap);w(),xe();const[S,E]=v.useState(null),[g,T]=v.useState(!1);let A=n=>R.find(u=>{var y;return((y=u==null?void 0:u.imei[0])==null?void 0:y.mac_id)==n})||{};const t=(n,u)=>u.find(y=>{var j;return((j=y==null?void 0:y.product)==null?void 0:j.toLowerCase())===n.toLowerCase()})||{},i={fontSize:"12px",fontWeight:"bold"},l={fontSize:"10px"};let r={totalTarget:0,totalAchieved:0,cement:{target:0,achieved:0},mm10:{target:0,achieved:0},mm20:{target:0,achieved:0},sand:{target:0,achieved:0},water:0,cubic:0,mm30:{target:0,achieved:0},crushSand:{target:0,achieved:0},riverSand:{target:0,achieved:0},flyAsh:{target:0,achieved:0},admix:{target:0,achieved:0}};return C.forEach(n=>{r.totalTarget+=Number((n==null?void 0:n.generalKeyInfo["Total Target"])||0),r.totalAchieved+=Number((n==null?void 0:n.generalKeyInfo["Total Achieved"])||0),r.water+=Number((n==null?void 0:n.generalKeyInfo.Water)||0),r.cubic+=Number((n==null?void 0:n.generalKeyInfo["Cubic Meter"])||0),r.cement.target+=Number(t("cement",n.productArr).target||0),r.cement.achieved+=Number(t("cement",n.productArr).achieved||0),r.mm10.target+=Number(t("10 mm agg",n.productArr).target||0),r.mm10.achieved+=Number(t("10 mm agg",n.productArr).achieved||0),r.mm20.target+=Number(t("20 mm agg",n.productArr).target||0),r.mm20.achieved+=Number(t("20 mm agg",n.productArr).achieved||0),r.sand.target+=Number(t("sand",n.productArr).target||0),r.sand.achieved+=Number(t("sand",n.productArr).achieved||0),r.mm30.target+=Number(t("30mm",n.productArr).target||0),r.mm30.achieved+=Number(t("30mm",n.productArr).achieved||0),r.crushSand.target+=Number(t("crush sand",n.productArr).target||0),r.crushSand.achieved+=Number(t("crush sand",n.productArr).achieved||0),r.riverSand.target+=Number(t("river sand",n.productArr).target||0),r.riverSand.achieved+=Number(t("river sand",n.productArr).achieved||0),r.flyAsh.target+=Number(t("fly ash",n.productArr).target||0),r.flyAsh.achieved+=Number(t("fly ash",n.productArr).achieved||0),r.admix.target+=Number(t("admix",n.productArr).target||0),r.admix.achieved+=Number(t("admix",n.productArr).achieved||0)}),e.jsxs(le,{component:se,sx:{maxHeight:"70vh"},children:[e.jsxs(ne,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(a,{sx:i,children:"Date"}),e.jsx(a,{sx:i,children:"Vehicle Name"}),e.jsx(a,{sx:i,children:"Batch No"}),e.jsx(a,{sx:i,children:"Start Time"}),e.jsx(a,{sx:i,children:"End Time"}),e.jsx(a,{sx:i,children:"Total Target Weight"}),e.jsx(a,{sx:i,children:"Total Achieved Weight"}),e.jsx(a,{sx:i,children:"Recipe 1"}),e.jsx(a,{sx:i,children:"Cycle"}),e.jsx(a,{sx:i,children:"Cement"}),e.jsx(a,{sx:i,children:"10mm"}),e.jsx(a,{sx:i,children:"20mm"}),e.jsx(a,{sx:i,children:"Sand"}),e.jsx(a,{sx:i,children:"Water"}),e.jsx(a,{sx:i,children:"Cubic Meter"}),e.jsx(a,{sx:i,children:"30mm"}),e.jsx(a,{sx:i,children:"Crush Sand"}),e.jsx(a,{sx:i,children:"River Sand"}),e.jsx(a,{sx:i,children:"Fly Ash"}),e.jsx(a,{sx:i,children:"Admix"}),e.jsx(a,{sx:i,children:"Receipt"})]})}),e.jsxs(re,{children:[C.map((n,u)=>{var y;return e.jsxs(J,{children:[e.jsx(a,{sx:l,children:n.generalKeyInfo.Date}),e.jsx(a,{sx:l,children:((y=A(n.imei))==null?void 0:y.registration_id)||"-"}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Batch No"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Start Time"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["End Time"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Total Target"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Total Achieved"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Recipe Name"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo.Cycle}),e.jsxs(a,{sx:l,children:[t("cement",n.productArr).target||0," :",t("cement",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("10 mm agg",n.productArr).target||0," :",t("10 mm agg",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("20 mm agg",n.productArr).target||0," :",t("20 mm agg",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("sand",n.productArr).target||0," :",t("sand",n.productArr).achieved||0]}),e.jsx(a,{sx:l,children:n.generalKeyInfo.Water}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Cubic Meter"]}),e.jsxs(a,{sx:l,children:[t("30mm",n.productArr).target||0," :",t("30mm",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("crush sand",n.productArr).target||0," :",t("crush sand",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("river sand",n.productArr).target||0," :",t("river sand",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("fly ash",n.productArr).target||0," :",t("fly ash",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("admix",n.productArr).target||0," :",t("admix",n.productArr).achieved||0]}),e.jsx(a,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",n),E(n),T(!0)},children:"View Receipt"})]},u)}),e.jsxs(J,{children:[e.jsx(a,{sx:l,children:e.jsx("b",{children:"TOTAL"})}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{sx:l,children:e.jsx("b",{children:r.totalTarget})}),e.jsx(a,{sx:l,children:e.jsx("b",{children:r.totalAchieved})}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.cement.target,":",r.cement.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.mm10.target,":",r.mm10.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[" ",r.mm20.target,":",r.mm20.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.sand.target,":",r.sand.achieved]})}),e.jsx(a,{sx:l,children:e.jsx("b",{children:r.water})}),e.jsx(a,{sx:l,children:e.jsx("b",{children:r.cubic})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.mm30.target,":",r.mm30.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[" ",r.crushSand.target,":",r.crushSand.achieved]})}),e.jsxs(a,{sx:l,children:[r.riverSand.target,":",r.riverSand.achieved]}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.flyAsh.target,":",r.flyAsh.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.admix.target,":",r.admix.achieved]})})]})]})]}),e.jsx(rt,{receiptData:S,open:g,setOpen:T})]})}function vt({handleBack:C,setStartDate:R,startDate:S,setEndDate:E,endDate:g}){var $;const T=w(),{vehicleGroup:A,vehicleList:t}=H(c=>c.liveMap),{batchReportsData:i,batchReportsData2:l,loading:r,selectedGroup:n,selectedVehicle:u,distributorList:y}=H(c=>c.report),[j,N]=v.useState([]);v.useState([]);const[V,Y]=v.useState([]),[z,D]=v.useState([]);let _=c=>(console.log(t.find(h=>{var f;return((f=h==null?void 0:h.imei[0])==null?void 0:f.mac_id)==c||""})),t.find(h=>{var f;return((f=h==null?void 0:h.imei[0])==null?void 0:f.mac_id)==c||""}));const F=(c,h)=>h.find(o=>{var W;return((W=o==null?void 0:o.name)==null?void 0:W.toLowerCase().trim())===c})||null,B=(c,h)=>{if(!c||!c.length>0)return;const f=c.reduce((O,L)=>O+(L!=null&&L.total_target&&parseFloat(L.total_target.replace(/^0+/,""))||0),0),o=c.reduce((O,L)=>O+(L!=null&&L.totalAcheived&&parseFloat(L.totalAcheived.replace(/^0+/,""))||0),0),W=["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"],s={};return W.forEach(O=>{const L=c.reduce((X,U)=>{var Z;const q=(Z=h(O,U.materials||[]))==null?void 0:Z.target;return X+(q&&parseFloat(q.replace(/^0+/,""))||0)},0),ee=c.reduce((X,U)=>{var Z;const q=(Z=h(O,U.materials||[]))==null?void 0:Z.actual;return X+(q&&parseFloat(q.replace(/^0+/,""))||0)},0);s[O]=`${L}:${ee}`}),{"Total Target Weight":f,"Total Achieved Weight":o,...s}};v.useEffect(()=>{const c=s=>s&&String(s).replace(/^0+/,"")||"-",h=(s,O=[])=>{const L=F(s,O);return{target:c(L==null?void 0:L.target),actual:c(L==null?void 0:L.actual)}};let f=(i==null?void 0:i.map(s=>{const{customer_name:O="-",registration_id:L="-",segment:ee="-"}=_(s==null?void 0:s.imei)||{};return{Date:s!=null&&s.date&&G(s==null?void 0:s.date,"DDMMYYYY").isValid()?G(s==null?void 0:s.date,"DDMMYYYY").format("DD-MM-YYYY"):"-",Vehicle:L||"-","Batch No":(s==null?void 0:s.batch_no)||"-","Start Time":(s==null?void 0:s.start_time)||"-",EndTime:(s==null?void 0:s.end_time)||"-","Total Target Weight":c(s==null?void 0:s.total_target),"Total Achieved Weight":c(s==null?void 0:s.totalAcheived),"Recipe 1":(s==null?void 0:s.mix_name)||"-",Cement:`${h("cement",s==null?void 0:s.materials).target}:${h("cement",s==null?void 0:s.materials).actual}`,"10mm":`${h("10 mm",s==null?void 0:s.materials).target}:${h("10mm",s==null?void 0:s.materials).actual}`,"20mm":`${h("20 mm",s==null?void 0:s.materials).target}:${h("20mm",s==null?void 0:s.materials).actual}`,Sand:`${h("sand",s==null?void 0:s.materials).target}:${h("sand",s==null?void 0:s.materials).actual}`,"Crush Sand":`${h("crush sand",s==null?void 0:s.materials).target}:${h("crush sand",s==null?void 0:s.materials).actual}`,"River Sand":`${h("river sand",s==null?void 0:s.materials).target}:${h("river sand",s==null?void 0:s.materials).actual}`,"Fly Ash":`${h("fly ash",s==null?void 0:s.materials).target}:${h("fly ash",s==null?void 0:s.materials).actual}`,"30mm":`${h("30 mm",s==null?void 0:s.materials).target}:${h("30mm",s==null?void 0:s.materials).actual}`,Water:`${h("water",s==null?void 0:s.materials).target}:${h("water",s==null?void 0:s.materials).actual}`,Admix:`${h("admix",s==null?void 0:s.materials).target}:${h("admix",s==null?void 0:s.materials).actual}`}}))||[];const o=B(i,F),W=[...f,{Date:"",Vehicle:"-","Batch No":"-","Start Time":"-",EndTime:"Total","Total Target Weight":(o==null?void 0:o["Total Target Weight"])||0,"Total Achieved Weight":(o==null?void 0:o["Total Achieved Weight"])||0,"Recipe 1":"-",Cement:(o==null?void 0:o.cement)||"-","10mm":(o==null?void 0:o["10 mm"])||"-","20mm":(o==null?void 0:o["20 mm"])||"-",Sand:(o==null?void 0:o.sand)||"-","Crush Sand":(o==null?void 0:o["crush sand"])||"-","River Sand":(o==null?void 0:o["river sand"])||"-","Fly Ash":(o==null?void 0:o["fly ash"])||"-","30mm":(o==null?void 0:o["30 mm"])||"-",Water:(o==null?void 0:o.water)||"-",Admix:(o==null?void 0:o.admix)||"-"}];Y(W)},[i]);const m=c=>{if(!c&&!c.length>0)return;let h=[];for(let f=0;f<c.length;f++)if(c[f].startsWith("Product:")){const o=c[f],W=c[f+1]||"",s=o.match(/Product:\s*(.*?)\s*Target.*:\s*(\d+)/),O=W.match(/Achieved.*:\s*(\d+)/);s&&h.push({product:s[1],target:Number(s[2]),achieved:O?Number(O[1]):0})}return h},x=["Batch No","Date","Start Time","Operator","Recipe Name","Cubic Meter","Cycle","End Time","Total Target","Total Achieved","Water","Admix"],I=c=>{if(!c&&!c.length>0)return;let h={};return c.forEach(f=>{x.forEach(o=>{var W;if(f.includes(o)){const O=((W=f.split(/[:\-](.+)/)[1])==null?void 0:W.trim())||"";h[o]=O}})}),h};v.useEffect(()=>{if(console.log("bacth reports data11",l),l&&l.length>0){let c=l.map(h=>{let f=m((h==null?void 0:h.parts)||[]),o=I((h==null?void 0:h.parts)||[]);return{productArr:f,generalKeyInfo:o,imei:h==null?void 0:h.deviceId}});c&&c.length>0?D(c):D([]),console.log("formatted arr",c)}},[l]),v.useEffect(()=>{if(A&&A.length>0){let c=A.map(h=>({...h,label:h.group_name,value:h.id}));N(c)}},[A,t,y]),v.useEffect(()=>{u||T(ge())},[]);function K(c){console.log("value changed",c),T(je(c))}function P(c){console.log("value",c),T(me(c))}const Q=async()=>{const c=`${S} 00:00`,h=`${g} 23:59`;let f=_(u);if(console.log("vehicle info",f),!p())return;let o={imei:u,startDate:c,endDate:h};f.vehicle_type==="Sprint"&&T(Ge(o)),f.vehicle_type==="Appalto"&&T(Ke(o))},p=()=>!S||!g||u==="all"?(te.error("Please select start date, end date, and vehicle."),!1):!0,d=($=_(u))==null?void 0:$.vehicle_type;console.log("device type",d);const b=n==="All"?t:t.filter(c=>c.vehicle_group===n);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(ue,{handleBack:C,downloadData:V})}),e.jsxs(M,{children:[e.jsxs(k,{size:"large",value:n,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:K,filterOption:(c,h)=>{var f;return typeof((f=h==null?void 0:h.props)==null?void 0:f.children)=="string"&&h.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"All",children:"All"}),j.map((c,h)=>e.jsx(k.Option,{value:c.value,children:c.label},h))]}),e.jsxs(k,{size:"large",value:u,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:P,filterOption:(c,h)=>{var f;return typeof((f=h==null?void 0:h.props)==null?void 0:f.children)=="string"&&h.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"all",children:"None"},"all"),b&&b.length>0&&b.map((c,h)=>{var f;return e.jsx(k.Option,{value:(f=c.imei[0])==null?void 0:f.mac_id,children:c.registration_id},h)})]}),e.jsx(ve,{setStartDate:R,setEndDate:E,selectedDate:!1,startDate:S,endDate:g}),e.jsx(pe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:Q,disabled:!u,children:"Generate report"})]}),r&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(fe,{})}),d==="Sprint"&&(i==null?void 0:i.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(jt,{tableData:i})}),d==="Appalto"&&(z==null?void 0:z.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(mt,{tableData:z})})]})}function bt({tableData:C}){const{vehicleList:R}=H(t=>t.liveMap),{selectedVehicle:S}=H(t=>t.report);let E=t=>R.find(i=>{var l;return((l=i==null?void 0:i.imei[0])==null?void 0:l.mac_id)==t||""});v.useEffect(()=>{},[R]);const g={fontSize:"12px",fontWeight:"bold"};function T(t){return console.log("hex",t),t.match(/../g).reverse().join("")}const A=(t,i)=>{var u,y,j,N;console.log("pid",t);const l=i.find(V=>t===(V==null?void 0:V.pid));if(console.log("matched pid",l),!l)return"NA";const r=((N=(j=(y=(u=E(S))==null?void 0:u.sub_model)==null?void 0:y.model_modelecu)==null?void 0:j[0])==null?void 0:N.pgn)||[];console.log("j1939 parameter",r);const n=r.find(V=>{var Y,z;return(t==null?void 0:t.toLowerCase())===((z=(Y=V==null?void 0:V.spn[0])==null?void 0:Y.spn)==null?void 0:z.toLowerCase())});if(console.log("matchedPidConfig",n),n){const{message_type:V,resolution:Y,offset:z}=n==null?void 0:n.spn[0];console.log("message",V,Y,z);let D=T(l==null?void 0:l.rawHex),_=Ie(V,D,Y,z);if(t==="0060"){let F=E(S),B=_/100*(F==null?void 0:F.tank_capacity)||0;return parseFloat(B.toFixed(2))||0}return _||0}return"NA"};return e.jsx(e.Fragment,{children:e.jsx(le,{component:se,sx:{maxHeight:"70vh"},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(a,{align:"left",sx:g,children:"Entry Date"}),e.jsx(a,{align:"left",sx:g,children:"Device Date"}),e.jsx(a,{align:"left",sx:g,children:"HWID"}),e.jsx(a,{align:"left",sx:g,children:"Latitude"}),e.jsx(a,{align:"left",sx:g,children:"Longitude"}),e.jsx(a,{align:"left",sx:g,children:"Engine Coolant Temperature"}),e.jsx(a,{align:"left",sx:g,children:"DFF Level"}),e.jsx(a,{align:"left",sx:g,children:"Fuel Level"}),e.jsx(a,{align:"left",sx:g,children:"Engine Speed"}),e.jsx(a,{align:"left",sx:g,children:"Real time Fuel Consumtion"}),e.jsx(a,{align:"left",sx:g,children:"Total Engine Hours"}),e.jsx(a,{align:"left",sx:g,children:"Engine Oil Pressure"}),e.jsx(a,{align:"left",sx:g,children:"Equip Status"}),e.jsx(a,{align:"left",sx:g,children:"Battery Voltage"})]})}),e.jsx(re,{children:C&&C.map((t,i)=>{var l,r,n,u;return e.jsxs(J,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(t==null?void 0:t.createdAt)&&G(t==null?void 0:t.createdAt).format("DD-MM-YYYY HH:mm:ss")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:((l=t==null?void 0:t.accOnTime)==null?void 0:l.utc)&&G((r=t==null?void 0:t.accOnTime)==null?void 0:r.utc).format("DD-MM-YYYY HH:mm:ss")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t==null?void 0:t.deviceId}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t!=null&&t.latitude?(n=parseFloat(t==null?void 0:t.latitude))==null?void 0:n.toFixed(2):"NA"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t!=null&&t.longitude?(u=parseFloat(t==null?void 0:t.longitude))==null?void 0:u.toFixed(2):"NA"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:A("006e",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:A("06e1",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:A("0060",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:A("00be",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:A("00b7",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:A("00f7",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:A("0064",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:A("sas",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:A("00a8",t==null?void 0:t.pids)})]},i+1)})})]})})})}const yt="https://cc.wikitrak.in/proxy-3031";function St({handleBack:C,setStartDate:R,startDate:S,setEndDate:E,endDate:g}){var Q;const T=w(),{vehicleGroup:A,vehicleList:t}=H(p=>p.liveMap),{selectedGroup:i,selectedVehicle:l,distributorList:r}=H(p=>p.report),[n,u]=v.useState([]);v.useState([]);const[y,j]=v.useState([]),[N,V]=v.useState([]),[Y,z]=v.useState(!1);function D(p){return p.match(/../g).reverse().join("")}const _=(p,d)=>{var h,f,o,W;console.log("pid",p);const b=d.find(s=>p===(s==null?void 0:s.pid));if(console.log("matched pid",b),!b)return"NA";const $=((W=(o=(f=(h=F(l))==null?void 0:h.sub_model)==null?void 0:f.model_modelecu)==null?void 0:o[0])==null?void 0:W.pgn)||[];console.log("j1939 parameter",$);const c=$.find(s=>{var O,L;return(p==null?void 0:p.toLowerCase())===((L=(O=s==null?void 0:s.spn[0])==null?void 0:O.spn)==null?void 0:L.toLowerCase())});if(console.log("matchedPidConfig",c),c){const{message_type:s,resolution:O,offset:L}=c==null?void 0:c.spn[0];console.log("message",s,O,L);let ee=D(b==null?void 0:b.rawHex),X=Ie(s,ee,O,L);if(p==="0060"){let U=F(l),q=X/100*(U==null?void 0:U.tank_capacity)||0;return parseFloat(q.toFixed(2))||0}return X||0}return"NA"};v.useEffect(()=>{if(N&&N.length>0){let p=N.map(d=>{var b,$;return{"Entry Date":(d==null?void 0:d.createdAt)&&G(d==null?void 0:d.createdAt).format("DD-MM-YYYY HH:mm:ss")||"-","Device Date":((b=d==null?void 0:d.accOnTime)==null?void 0:b.utc)&&G(($=d==null?void 0:d.accOnTime)==null?void 0:$.utc).format("DD-MM-YYYY HH:mm:ss")||"-",HWID:d==null?void 0:d.deviceId,Latitude:d==null?void 0:d.latitude,Longitude:d.longitude,"Engine Coolant Temperature":_("006e",d==null?void 0:d.pids),"DFF Level":_("06e1",d==null?void 0:d.pids),"Fuel Level":_("0060",d==null?void 0:d.pids),"Engine Speed":_("00be",d==null?void 0:d.pids),"Real time Fuel Consumtion":_("00b7",d==null?void 0:d.pids),"Total Engine Hours":_("00f7",d==null?void 0:d.pids),"E,ngine Oil Pressure":_("0064",d==null?void 0:d.pids),"Equip Status":"NA","Battery Voltage":_("00a8",d==null?void 0:d.pids)}});j(p)}},[N]);let F=p=>(console.log(t.find(d=>{var b;return((b=d==null?void 0:d.imei[0])==null?void 0:b.mac_id)==p||""})),t.find(d=>{var b;return((b=d==null?void 0:d.imei[0])==null?void 0:b.mac_id)==p||""}));function B(p){console.log("value changed",p),T(je(p))}function m(p){console.log("value",p),T(me(p))}const x=async()=>{z(!0);const p=`${S}`,d=`${g}`;let b=F(l);if(console.log("vehicle info",b),!I())return;let $={deviceId:l,startDate:p,endDate:d};try{const{data:c}=await Ue.post(`${yt}/api/ivn-pid/by-date`,$);console.log("data",c),c&&Array.isArray(c==null?void 0:c.packets)&&V(c==null?void 0:c.packets),z(!1)}catch(c){z(!1),console.log("error",c)}},I=()=>!S||!g||l==="all"?(te.error("Please select start date, end date, and vehicle."),!1):!0,K=(Q=F(l))==null?void 0:Q.vehicle_type;console.log("device type",K);const P=i==="All"?t:t.filter(p=>p.vehicle_group===i);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(ue,{handleBack:C,downloadData:y})}),e.jsxs(M,{children:[e.jsxs(k,{size:"large",value:i,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:B,filterOption:(p,d)=>{var b;return typeof((b=d==null?void 0:d.props)==null?void 0:b.children)=="string"&&d.props.children.toLowerCase().indexOf(p.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"All",children:"All"}),n.map((p,d)=>e.jsx(k.Option,{value:p.value,children:p.label},d))]}),e.jsxs(k,{size:"large",value:l,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:m,filterOption:(p,d)=>{var b;return typeof((b=d==null?void 0:d.props)==null?void 0:b.children)=="string"&&d.props.children.toLowerCase().indexOf(p.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"all",children:"None"},"all"),P&&P.length>0&&P.map((p,d)=>{var b;return e.jsx(k.Option,{value:(b=p.imei[0])==null?void 0:b.mac_id,children:p.registration_id},d)})]}),e.jsx(ve,{setStartDate:R,setEndDate:E,selectedDate:!1,startDate:S,endDate:g}),e.jsx(pe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:x,disabled:!l,children:"Generate report"})]}),Y&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(fe,{})}),e.jsx(bt,{tableData:N})]})}function oe({children:C,value:R,index:S}){return e.jsx("div",{role:"tabpanel",hidden:R!==S,children:R===S&&e.jsx(M,{p:2,children:C})})}function Tt({showCard:C,setReportType:R,reportType:S}){H(n=>n.dashboard),H(n=>n.liveMap);const{startDate:E,endDate:g,tabValue:T}=H(n=>n.report),[A,t]=v.useState(!0);v.useState({}),v.useState(!1);let i=w();v.useEffect(()=>{},[g]),v.useEffect(()=>{i(Ve()),i(ze())},[]);const l=()=>{i(ge()),i(Ve()),i(ze()),i(R(null))},r=(n,u)=>{i(Je(u))};return e.jsx(e.Fragment,{children:e.jsx(M,{sx:{},children:e.jsxs(M,{children:[e.jsxs(qe,{value:T,onChange:r,children:[e.jsx(ce,{label:"Vehicle Report"}),e.jsx(ce,{label:"Batch data report"}),e.jsx(ce,{label:"PID Report"})]}),e.jsx(oe,{value:T,index:0,children:e.jsx(ft,{handleBack:l,selectedDate:A,setEndDate:de,setStartDate:he,startDate:E,endDate:g})}),e.jsx(oe,{value:T,index:1,children:e.jsx(vt,{handleBack:l,selectedDate:A,setEndDate:de,setStartDate:he,startDate:E,endDate:g})}),e.jsx(oe,{value:T,index:2,children:e.jsx(St,{handleBack:l,selectedDate:A,setEndDate:de,setStartDate:he,startDate:E,endDate:g})})]})})})}function Dt(){const{mode:C,showVehicles:R,selectedVehicleGroup:S}=H(j=>j.dashboard),{w_customer_id:E}=H(j=>j.auth),{reportType:g}=H(j=>j.report),[T,A]=v.useState([]),[t,i]=v.useState(!0),[l,r]=v.useState(!1),n=nt(C);let u=w();v.useEffect(()=>{y()},[]);const y=async()=>{try{let j=[],N=[];const V=await u(Qe({w_customer_id:E}));if(Array.isArray(V.payload)){V.payload.forEach(D=>{var _,F;Array.isArray(D.imei)&&D.imei.length>0?(j.push({id:D.id,label:D.registration_id,value:(_=D==null?void 0:D.imei[0])==null?void 0:_.mac_id,workShop:D==null?void 0:D.workshop,vehicle_group:D==null?void 0:D.vehicle_group}),N.push((F=D.imei[0])==null?void 0:F.mac_id)):console.error("IMEI data not found for item:",D)});const Y="one",z=N;N.length>0&&(u(Xe({type:Y,imei:z})),u(Ze(z))),A(j),u(we({w_customer_id:E})),u(et({}))}else console.error("Unexpected data format:",V),te.error("Unexpected data format:")}catch(j){console.error("Error fetching vehicle data:",j),te.error(`Error fetching vehicle data: ${j}`)}};return T.filter(j=>Object.keys(S).length===0||j.vehicle_group===S.id),e.jsxs("div",{className:"app",children:[e.jsx(tt,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:n.grey[100]},children:[e.jsx(at,{title:"Report",setShowVehiclesGroup:r,showVehiclesGroup:l,reportType:g}),e.jsx(lt,{setShowVehiclesGroup:r,showVehiclesGroup:l}),e.jsxs(M,{style:{display:"flex",width:"100%",height:"95vh",background:n.grey[200]},children:[e.jsx(M,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(M,{style:{width:"100%"},children:e.jsx(Tt,{showCard:t,setReportType:st,reportType:g})})}),!1]})]})]})}export{Dt as default};
