import{b as f,cW as vt,gh as wt,dr as we,cY as tt,cV as Et,_ as At,cj as Be,gi as We,cn as Dt,cv as Tt,cw as Pt,cA as It,cs as st,dn as $t,ci as Lt,cl as Rt,gj as Bt,dx as Ot,gk as Ft,a_ as pe,a$ as N,j as e,aW as a,ba as Te,bc as oe,ea as Nt,eb as Mt,ec as Wt,b9 as Ht,aY as fe,ee as Ut,ef as Yt,T as Gt,b5 as ae,gl as rt,gm as Kt,gn as zt,go as Xt,gp as qt,gq as Jt,gr as Qt,gs as Zt,gt as Vt,gu as es,fn as Se,dL as be,dM as ye,dO as _e,ej as Ce,aZ as je,gv as me,gw as Pe,gx as ts,gy as ss,gz as rs,gA as os,gB as as,gC as ns,gD as He,gE as Ue,gF as le,c4 as ie,b7 as W,gG as se,gH as bt,gI as Ie,gJ as $e,gK as ls,gL as ot,bF as is,b_ as cs,gM as xe,gN as at,gO as nt,gP as Ye,gQ as lt,gR as Fe,bm as ke,gS as it,bS as ds,bT as ps,d4 as us,gT as xs,gU as hs,gV as ct,gW as gs,gX as dt,gY as pt,bw as fs,bz as ms,bq as bs,gZ as ys,g_ as _s,g$ as Cs}from"./index-C0SeML7Y.js";import{C as js,I as yt}from"./index-Bk3fBqCo.js";import{SinoCastalTerminal as Ss,SinoCastalReadDTC as ks,SinoCastalLiveParameter as vs}from"./Index-D7u09Irq.js";import"./index.esm-DvbEsshw.js";var ws={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Es=function(){var s=f.useRef([]),r=f.useRef(null);return f.useEffect(function(){var l=Date.now(),d=!1;s.current.forEach(function(v){if(v){d=!0;var g=v.style;g.transitionDuration=".3s, .3s, .3s, .06s",r.current&&l-r.current<100&&(g.transitionDuration="0s, 0s")}}),d&&(r.current=Date.now())}),s.current},ut=0,As=wt();function Ds(){var t;return As?(t=ut,ut+=1):t="TEST_OR_SSR",t}const Ts=function(t){var s=f.useState(),r=vt(s,2),l=r[0],d=r[1];return f.useEffect(function(){d("rc_progress_".concat(Ds()))},[]),t||l};var xt=function(s){var r=s.bg,l=s.children;return f.createElement("div",{style:{width:"100%",height:"100%",background:r}},l)};function ht(t,s){return Object.keys(t).map(function(r){var l=parseFloat(r),d="".concat(Math.floor(l*s),"%");return"".concat(t[r]," ").concat(d)})}var Ps=f.forwardRef(function(t,s){var r=t.prefixCls,l=t.color,d=t.gradientId,v=t.radius,g=t.style,p=t.ptg,j=t.strokeLinecap,n=t.strokeWidth,I=t.size,F=t.gapDegree,k=l&&we(l)==="object",y=k?"#FFF":void 0,A=I/2,E=f.createElement("circle",{className:"".concat(r,"-circle-path"),r:v,cx:A,cy:A,stroke:y,strokeLinecap:j,strokeWidth:n,opacity:p===0?0:1,style:g,ref:s});if(!k)return E;var C="".concat(d,"-conic"),_=F?"".concat(180+F/2,"deg"):"0deg",B=ht(l,(360-F)/360),$=ht(l,1),T="conic-gradient(from ".concat(_,", ").concat(B.join(", "),")"),h="linear-gradient(to ".concat(F?"bottom":"top",", ").concat($.join(", "),")");return f.createElement(f.Fragment,null,f.createElement("mask",{id:C},E),f.createElement("foreignObject",{x:0,y:0,width:I,height:I,mask:"url(#".concat(C,")")},f.createElement(xt,{bg:h},f.createElement(xt,{bg:T}))))}),Ee=100,Ne=function(s,r,l,d,v,g,p,j,n,I){var F=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,k=l/100*360*((360-g)/360),y=g===0?0:{bottom:0,top:180,left:90,right:-90}[p],A=(100-d)/100*r;n==="round"&&d!==100&&(A+=I/2,A>=r&&(A=r-.01));var E=Ee/2;return{stroke:typeof j=="string"?j:void 0,strokeDasharray:"".concat(r,"px ").concat(s),strokeDashoffset:A+F,transform:"rotate(".concat(v+k+y,"deg)"),transformOrigin:"".concat(E,"px ").concat(E,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Is=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function gt(t){var s=t??[];return Array.isArray(s)?s:[s]}var $s=function(s){var r=tt(tt({},ws),s),l=r.id,d=r.prefixCls,v=r.steps,g=r.strokeWidth,p=r.trailWidth,j=r.gapDegree,n=j===void 0?0:j,I=r.gapPosition,F=r.trailColor,k=r.strokeLinecap,y=r.style,A=r.className,E=r.strokeColor,C=r.percent,_=Et(r,Is),B=Ee/2,$=Ts(l),T="".concat($,"-gradient"),h=B-g/2,D=Math.PI*2*h,b=n>0?90+n/2:-90,P=D*((360-n)/360),c=we(v)==="object"?v:{count:v,space:2},L=c.count,o=c.space,S=gt(C),R=gt(E),u=R.find(function(Y){return Y&&we(Y)==="object"}),x=u&&we(u)==="object",m=x?"butt":k,w=Ne(D,P,0,100,b,n,I,F,m,g),O=Es(),z=function(){var M=0;return S.map(function(H,G){var K=R[G]||R[R.length-1],q=Ne(D,P,M,H,b,n,I,K,m,g);return M+=H,f.createElement(Ps,{key:G,color:K,ptg:H,radius:h,prefixCls:d,gradientId:T,style:q,strokeLinecap:m,strokeWidth:g,gapDegree:n,ref:function(ce){O[G]=ce},size:Ee})}).reverse()},i=function(){var M=Math.round(L*(S[0]/100)),H=100/L,G=0;return new Array(L).fill(null).map(function(K,q){var re=q<=M-1?R[0]:F,ce=re&&we(re)==="object"?"url(#".concat(T,")"):void 0,U=Ne(D,P,G,H,b,n,I,re,"butt",g,o);return G+=(P-U.strokeDashoffset+o)*100/P,f.createElement("circle",{key:q,className:"".concat(d,"-circle-path"),r:h,cx:B,cy:B,stroke:ce,strokeWidth:g,opacity:1,style:U,ref:function(Z){O[q]=Z}})})};return f.createElement("svg",At({className:Be("".concat(d,"-circle"),A),viewBox:"0 0 ".concat(Ee," ").concat(Ee),style:y,id:l,role:"presentation"},_),!L&&f.createElement("circle",{className:"".concat(d,"-circle-trail"),r:h,cx:B,cy:B,stroke:F,strokeLinecap:m,strokeWidth:p||g,style:w}),L?i():z())};function ge(t){return!t||t<0?0:t>100?100:t}function Le(t){let{success:s,successPercent:r}=t,l=r;return s&&"progress"in s&&(l=s.progress),s&&"percent"in s&&(l=s.percent),l}const Ls=t=>{let{percent:s,success:r,successPercent:l}=t;const d=ge(Le({success:r,successPercent:l}));return[d,ge(ge(s)-d)]},Rs=t=>{let{success:s={},strokeColor:r}=t;const{strokeColor:l}=s;return[l||We.green,r||null]},Oe=(t,s,r)=>{var l,d,v,g;let p=-1,j=-1;if(s==="step"){const n=r.steps,I=r.strokeWidth;typeof t=="string"||typeof t>"u"?(p=t==="small"?2:14,j=I??8):typeof t=="number"?[p,j]=[t,t]:[p=14,j=8]=t,p*=n}else if(s==="line"){const n=r==null?void 0:r.strokeWidth;typeof t=="string"||typeof t>"u"?j=n||(t==="small"?6:8):typeof t=="number"?[p,j]=[t,t]:[p=-1,j=8]=t}else(s==="circle"||s==="dashboard")&&(typeof t=="string"||typeof t>"u"?[p,j]=t==="small"?[60,60]:[120,120]:typeof t=="number"?[p,j]=[t,t]:(p=(d=(l=t[0])!==null&&l!==void 0?l:t[1])!==null&&d!==void 0?d:120,j=(g=(v=t[0])!==null&&v!==void 0?v:t[1])!==null&&g!==void 0?g:120));return[p,j]},Bs=3,Os=t=>Bs/t*100,Fs=t=>{const{prefixCls:s,trailColor:r=null,strokeLinecap:l="round",gapPosition:d,gapDegree:v,width:g=120,type:p,children:j,success:n,size:I=g}=t,[F,k]=Oe(I,"circle");let{strokeWidth:y}=t;y===void 0&&(y=Math.max(Os(F),6));const A={width:F,height:k,fontSize:F*.15+6},E=f.useMemo(()=>{if(v||v===0)return v;if(p==="dashboard")return 75},[v,p]),C=d||p==="dashboard"&&"bottom"||void 0,_=Object.prototype.toString.call(t.strokeColor)==="[object Object]",B=Rs({success:n,strokeColor:t.strokeColor}),$=Be(`${s}-inner`,{[`${s}-circle-gradient`]:_}),T=f.createElement($s,{percent:Ls(t),strokeWidth:y,trailWidth:y,strokeColor:B,strokeLinecap:l,trailColor:r,prefixCls:s,gapDegree:E,gapPosition:C});return f.createElement("div",{className:$,style:A},F<=20?f.createElement(Dt,{title:j},f.createElement("span",null,T)):f.createElement(f.Fragment,null,T,j))},Ns=Fs,Re="--progress-line-stroke-color",_t="--progress-percent",ft=t=>{const s=t?"100%":"-100%";return new $t(`antProgress${t?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${s}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${s}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},Ms=t=>{const{componentCls:s,iconCls:r}=t;return{[s]:Object.assign(Object.assign({},It(t)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:t.fontSize},[`${s}-outer`]:{display:"inline-block",width:"100%"},[`&${s}-show-info`]:{[`${s}-outer`]:{marginInlineEnd:`calc(-2em - ${st(t.marginXS)})`,paddingInlineEnd:`calc(2em + ${st(t.paddingXS)})`}},[`${s}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:t.remainingColor,borderRadius:t.lineBorderRadius},[`${s}-inner:not(${s}-circle-gradient)`]:{[`${s}-circle-path`]:{stroke:t.defaultColor}},[`${s}-success-bg, ${s}-bg`]:{position:"relative",background:t.defaultColor,borderRadius:t.lineBorderRadius,transition:`all ${t.motionDurationSlow} ${t.motionEaseInOutCirc}`},[`${s}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Re})`]},height:"100%",width:`calc(1 / var(${_t}) * 100%)`,display:"block"}},[`${s}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:t.colorSuccess},[`${s}-text`]:{display:"inline-block",width:"2em",marginInlineStart:t.marginXS,color:t.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[r]:{fontSize:t.fontSize}},[`&${s}-status-active`]:{[`${s}-bg::before`]:{position:"absolute",inset:0,backgroundColor:t.colorBgContainer,borderRadius:t.lineBorderRadius,opacity:0,animationName:ft(),animationDuration:t.progressActiveMotionDuration,animationTimingFunction:t.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${s}-rtl${s}-status-active`]:{[`${s}-bg::before`]:{animationName:ft(!0)}},[`&${s}-status-exception`]:{[`${s}-bg`]:{backgroundColor:t.colorError},[`${s}-text`]:{color:t.colorError}},[`&${s}-status-exception ${s}-inner:not(${s}-circle-gradient)`]:{[`${s}-circle-path`]:{stroke:t.colorError}},[`&${s}-status-success`]:{[`${s}-bg`]:{backgroundColor:t.colorSuccess},[`${s}-text`]:{color:t.colorSuccess}},[`&${s}-status-success ${s}-inner:not(${s}-circle-gradient)`]:{[`${s}-circle-path`]:{stroke:t.colorSuccess}}})}},Ws=t=>{const{componentCls:s,iconCls:r}=t;return{[s]:{[`${s}-circle-trail`]:{stroke:t.remainingColor},[`&${s}-circle ${s}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${s}-circle ${s}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:t.circleTextColor,fontSize:t.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[r]:{fontSize:t.circleIconFontSize}},[`${s}-circle&-status-exception`]:{[`${s}-text`]:{color:t.colorError}},[`${s}-circle&-status-success`]:{[`${s}-text`]:{color:t.colorSuccess}}},[`${s}-inline-circle`]:{lineHeight:1,[`${s}-inner`]:{verticalAlign:"bottom"}}}},Hs=t=>{const{componentCls:s}=t;return{[s]:{[`${s}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:t.progressStepMinWidth,marginInlineEnd:t.progressStepMarginInlineEnd,backgroundColor:t.remainingColor,transition:`all ${t.motionDurationSlow}`,"&-active":{backgroundColor:t.defaultColor}}}}}},Us=t=>{const{componentCls:s,iconCls:r}=t;return{[s]:{[`${s}-small&-line, ${s}-small&-line ${s}-text ${r}`]:{fontSize:t.fontSizeSM}}}},Ys=t=>({circleTextColor:t.colorText,defaultColor:t.colorInfo,remainingColor:t.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${t.fontSize/t.fontSizeSM}em`}),Gs=Tt("Progress",t=>{const s=t.calc(t.marginXXS).div(2).equal(),r=Pt(t,{progressStepMarginInlineEnd:s,progressStepMinWidth:s,progressActiveMotionDuration:"2.4s"});return[Ms(r),Ws(r),Hs(r),Us(r)]},Ys);var Ks=function(t,s){var r={};for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&s.indexOf(l)<0&&(r[l]=t[l]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,l=Object.getOwnPropertySymbols(t);d<l.length;d++)s.indexOf(l[d])<0&&Object.prototype.propertyIsEnumerable.call(t,l[d])&&(r[l[d]]=t[l[d]]);return r};const zs=t=>{let s=[];return Object.keys(t).forEach(r=>{const l=parseFloat(r.replace(/%/g,""));isNaN(l)||s.push({key:l,value:t[r]})}),s=s.sort((r,l)=>r.key-l.key),s.map(r=>{let{key:l,value:d}=r;return`${d} ${l}%`}).join(", ")},Xs=(t,s)=>{const{from:r=We.blue,to:l=We.blue,direction:d=s==="rtl"?"to left":"to right"}=t,v=Ks(t,["from","to","direction"]);if(Object.keys(v).length!==0){const p=zs(v),j=`linear-gradient(${d}, ${p})`;return{background:j,[Re]:j}}const g=`linear-gradient(${d}, ${r}, ${l})`;return{background:g,[Re]:g}},qs=t=>{const{prefixCls:s,direction:r,percent:l,size:d,strokeWidth:v,strokeColor:g,strokeLinecap:p="round",children:j,trailColor:n=null,success:I}=t,F=g&&typeof g!="string"?Xs(g,r):{[Re]:g,background:g},k=p==="square"||p==="butt"?0:void 0,y=d??[-1,v||(d==="small"?6:8)],[A,E]=Oe(y,"line",{strokeWidth:v}),C={backgroundColor:n||void 0,borderRadius:k},_=Object.assign(Object.assign({width:`${ge(l)}%`,height:E,borderRadius:k},F),{[_t]:ge(l)/100}),B=Le(t),$={width:`${ge(B)}%`,height:E,borderRadius:k,backgroundColor:I==null?void 0:I.strokeColor},T={width:A<0?"100%":A,height:E};return f.createElement(f.Fragment,null,f.createElement("div",{className:`${s}-outer`,style:T},f.createElement("div",{className:`${s}-inner`,style:C},f.createElement("div",{className:`${s}-bg`,style:_}),B!==void 0?f.createElement("div",{className:`${s}-success-bg`,style:$}):null)),j)},Js=qs,Qs=t=>{const{size:s,steps:r,percent:l=0,strokeWidth:d=8,strokeColor:v,trailColor:g=null,prefixCls:p,children:j}=t,n=Math.round(r*(l/100)),F=s??[s==="small"?2:14,d],[k,y]=Oe(F,"step",{steps:r,strokeWidth:d}),A=k/r,E=new Array(r);for(let C=0;C<r;C++){const _=Array.isArray(v)?v[C]:v;E[C]=f.createElement("div",{key:C,className:Be(`${p}-steps-item`,{[`${p}-steps-item-active`]:C<=n-1}),style:{backgroundColor:C<=n-1?_:g,width:A,height:y}})}return f.createElement("div",{className:`${p}-steps-outer`},E,j)},Zs=Qs;var Vs=function(t,s){var r={};for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&s.indexOf(l)<0&&(r[l]=t[l]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,l=Object.getOwnPropertySymbols(t);d<l.length;d++)s.indexOf(l[d])<0&&Object.prototype.propertyIsEnumerable.call(t,l[d])&&(r[l[d]]=t[l[d]]);return r};const er=["normal","exception","active","success"],tr=f.forwardRef((t,s)=>{const{prefixCls:r,className:l,rootClassName:d,steps:v,strokeColor:g,percent:p=0,size:j="default",showInfo:n=!0,type:I="line",status:F,format:k,style:y}=t,A=Vs(t,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),E=f.useMemo(()=>{var R,u;const x=Le(t);return parseInt(x!==void 0?(R=x??0)===null||R===void 0?void 0:R.toString():(u=p??0)===null||u===void 0?void 0:u.toString(),10)},[p,t.success,t.successPercent]),C=f.useMemo(()=>!er.includes(F)&&E>=100?"success":F||"normal",[F,E]),{getPrefixCls:_,direction:B,progress:$}=f.useContext(Lt),T=_("progress",r),[h,D,b]=Gs(T),P=f.useMemo(()=>{if(!n)return null;const R=Le(t);let u;const x=k||(w=>`${w}%`),m=I==="line";return k||C!=="exception"&&C!=="success"?u=x(ge(p),ge(R)):C==="exception"?u=m?f.createElement(Bt,null):f.createElement(Ot,null):C==="success"&&(u=m?f.createElement(js,null):f.createElement(Ft,null)),f.createElement("span",{className:`${T}-text`,title:typeof u=="string"?u:void 0},u)},[n,p,E,C,I,T,k]),c=Array.isArray(g)?g[0]:g,L=typeof g=="string"||Array.isArray(g)?g:void 0;let o;I==="line"?o=v?f.createElement(Zs,Object.assign({},t,{strokeColor:L,prefixCls:T,steps:v}),P):f.createElement(Js,Object.assign({},t,{strokeColor:c,prefixCls:T,direction:B}),P):(I==="circle"||I==="dashboard")&&(o=f.createElement(Ns,Object.assign({},t,{strokeColor:c,prefixCls:T,progressStatus:C}),P));const S=Be(T,`${T}-status-${C}`,`${T}-${I==="dashboard"&&"circle"||v&&"steps"||I}`,{[`${T}-inline-circle`]:I==="circle"&&Oe(j,"circle")[0]<=20,[`${T}-show-info`]:n,[`${T}-${j}`]:typeof j=="string",[`${T}-rtl`]:B==="rtl"},$==null?void 0:$.className,l,d,D,b);return h(f.createElement("div",Object.assign({ref:s,style:Object.assign(Object.assign({},$==null?void 0:$.style),y),className:S,role:"progressbar","aria-valuenow":E},Rt(A,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),o))}),mt=tr;function sr({title:t,setShowVehicles:s,showVehicles:r,showParams:l,setShowParams:d}){const v=pe(),{collapsed:g}=N($=>$.auth),{isLiveParameter:p,isWriteParameter:j,isActuator:n,isRoutineTest:I,isFlashing:F,isJ1939:k,selectedVehicle:y}=N($=>$.diagnostics),{tractorIcon:A}=N($=>$.liveMap);JSON.parse(localStorage.getItem("w_userDetails"));const{mode:E,selectedVehicleGroup:C}=N($=>$.dashboard),_=()=>{v(Yt(!g))},B={fontSize:"26px",fontWeight:500,lineHeight:"18.38px",color:"#fff",textAlign:"center",paddingTop:"5px",fontFamily:"ubuntu"};return e.jsxs(a,{style:{display:"flex",justifyContent:"space-between",paddingRight:"20px",backgroundColor:Te.bgColor,alignItems:"center",textAlign:"center",height:"60px",color:"white"},children:[e.jsxs(a,{style:{display:"flex",justifyContent:"space-between",gap:"10px",alignItems:"center",width:"50%"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center"},children:[g?e.jsx(oe,{onClick:_,sx:{color:"white"},children:e.jsx(Nt,{style:{width:"30px",height:"30px"}})}):e.jsx(oe,{onClick:_,sx:{color:"white"},children:e.jsx(Mt,{style:{width:"30px",height:"30px"}})}),e.jsx("img",{src:Wt,alt:"wikitrak logo"})]}),e.jsx(a,{children:e.jsx(Ht,{style:B,children:t})})]}),e.jsxs(a,{style:{display:"flex",gap:"5px"},children:[e.jsxs(oe,{variant:"outlined",size:"small",sx:{color:r?"white":"black",backgroundColor:r?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:()=>{s(!r),d(!1)},children:[e.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",style:{marginRight:"5px"},children:e.jsx("path",{d:A.path1})}),Object.keys(y).length>0?y.reg_id:"Vehicles"]}),(p||j||n||I||F||k)&&e.jsxs(oe,{variant:"outlined",size:"small",sx:{color:l?"blue":"white",backgroundColor:l?"white":"undefined",mt:"6px",mx:"5px",border:"1px solid white",height:"40px"},onClick:()=>{s(!1),d(!l)},children:[p&&"Live Parameter",j&&"Write Parameter",n&&"Actuator Test",I&&"Routine Test",F&&"Flashing",k&&"J1939 Parameter"]}),e.jsx(fe,{onClick:()=>{v(Ut(!E))},sx:{color:"white"}})]})]})}const rr=({vehicleData:t,handleChange:s})=>{const{selectedVehicle:r}=N(j=>j.diagnostics),[l,d]=f.useState(""),{mode:v}=N(j=>j.dashboard),g=ae(v),p=t&&t.length>0&&t.filter(j=>j.label.toLowerCase().includes(l));return e.jsxs(e.Fragment,{children:[e.jsx(yt,{style:{width:"85%",margin:"8px 20px",padding:"10px"},placeholder:"Search vehicle",onChange:j=>d(j.target.value)}),p.length>0?p.map((j,n)=>e.jsx(a,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(oe,{variant:"outlined",onClick:()=>{s(j)},sx:{width:"90%",bgcolor:j.label===(r==null?void 0:r.reg_id)?Te.bgColor:"undefined",color:j.label===(r==null?void 0:r.reg_id)?"white":g.grey[400],border:`1px solid ${Te.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:Te.bgShadow}},children:j.label})},n)):e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh"},children:e.jsx(Gt,{sx:{textAlign:"center",color:g.grey[400]},children:"Sorry! No vehicles"})})]})},or=({options:t})=>{const{selectedMenu:s,selectedVehicle:r}=N(p=>p.diagnostics),l=pe(),{mode:d}=N(p=>p.dashboard),v=ae(d),g=p=>{switch(rt(p),l(rt(p)),p){case"Terminal Application":l(es());break;case"Write Parameters":l(Vt());break;case"Read DTC":l(Zt());break;case"Live Parameters":l(Qt());break;case"Actuator Test":l(Jt());break;case"Routine Test":l(qt());break;case"ECU Information":l(Xt());break;case"Flashing":l(zt());break;case"J1939 Parameters":l(Kt());break}};return e.jsx(e.Fragment,{children:e.jsx("div",{children:t.length>0&&t.map((p,j)=>e.jsx(a,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsxs(a,{sx:{border:s!==p.label?"1px solid #E8E8E8":"",p:"8px",borderRadius:"5px",m:"10px",display:"flex",cursor:"pointer",color:s===p.label?"white":v.grey[400],backgroundColor:s===p.label?"#8DA6C6":void 0},onClick:()=>{g(p.label)},children:[e.jsx(a,{sx:{mx:"5px"},children:p.icon}),e.jsx(a,{sx:{mx:"5px",fontSize:"16px"},children:e.jsx("span",{children:p.label})})]})},j))})})},Ct="https://cc.wikitrak.in/proxy-3031",ar=({deviceType:t})=>{var D,b,P;const s=pe(),{liveParameters:r,isLiveParameter:l,isWriteParameter:d,isActuator:v,isRoutineTest:g,isFlashing:p,loading:j,isDtcLoader:n,isJ1939:I,j1939Parameters:F}=N(c=>c.diagnostics),{vehicleList:k,selectedVehicle:y}=N(c=>c.liveMap);N(c=>c.dashboard);let E=(P=(b=(D=((k||[]).find(c=>{var L;return((L=c==null?void 0:c.imei[0])==null?void 0:L.mac_id)===(y==null?void 0:y.imei)})||{}).sub_model)==null?void 0:D.ecus[0])==null?void 0:b.ecu[0])==null?void 0:P.file;E=(E==null?void 0:E.map(c=>({...c,label:c.sw_part_no})))||[];const C=(c,L)=>{let o=r.map((S,R)=>(S.label,{...S,checked:S.label===L?c.target.checked:S.checked}));s(me(o))},_=(c,L)=>{let o=F.map((S,R)=>(S.label,{...S,checked:S.label===L?c.target.checked:S.checked}));s(Pe(o))},B=c=>{s(ts(c.label)),s(ss(c))},$=c=>{s(rs(c.label)),s(os(c))},T=c=>{s(as(c.label)),s(ns(c))},h=c=>{s(He(c.label)),s(Ue(c))};return e.jsxs("div",{children:[n&&e.jsx(Se,{}),l&&e.jsx(nr,{handleLiveParameter:C,deviceType:t}),d&&e.jsx(lr,{handleWriteParameter:B}),v&&e.jsx(ir,{handleActuatorTest:$}),g&&e.jsx(cr,{handleRoutineTest:T}),p&&e.jsx(dr,{handleFlashing:h}),I&&e.jsx(pr,{handleJ1939Parameter:_})]})},nr=({handleLiveParameter:t,deviceType:s})=>{const r=pe(),{liveParameters:l,liveParameterGroupList:d,selectedVehicle:v}=N(b=>b.diagnostics),{mode:g}=N(b=>b.dashboard),p=ae(g);N(b=>b.liveMap);const[j,n]=f.useState(""),[I,F]=f.useState(""),[k,y]=f.useState(!1);f.useState(!1);const A=l.length>0&&l.filter(b=>b.label.toLowerCase().includes(j.toLowerCase())),E=d.length>0&&d.filter(b=>b.label.toLowerCase().includes(I.toLowerCase())),C=(b,P)=>{P==="group"&&F(b.target.value),P==="one"&&n(b.target.value)};function _(b){return b.match(/../g).reverse().join("")}function B(b,P){const{pidArray:c,frames:L}=b,o=L[L.length-1];let S=0;for(const R of c){const x=R.toLowerCase().padStart(4,"0").match(/../g).reverse().join(""),m=l.find(Y=>Y.code===x);if(!m||!Array.isArray(m.pi_code_variable)||m.pi_code_variable.length===0){console.warn(`Invalid or missing pi_code_variable for PID: ${x}`);continue}const w=m.pi_code_variable[0];if(console.log("byteInfo",w),!w||typeof w.length!="number"||!w.message_type||w.length<=0){console.warn(`Invalid byte definition for PID: ${x}`,w);continue}const O=w.length,z=O*2,i=o.slice(S*2,S*2+z);if(R===P){const{resolution:Y=1,offset:M=0,message_type:H}=w,G=_(i);let K=null;switch(H){case"CONTINUOUS":K=$e(G)*Y+M;break;case"ASCII":K=Ie(G);break;case"eNUM":case"bcd-hex":K=G;break;case"FLOAT":K=ls(G);break;default:return{pid:P,error:`Unknown message_type: ${H}`}}return{pidCheck:x,valueHex:i,valueHexLE:G,decimalValue:K}}S+=O}return{pid:P,error:"PID not found or byte definition missing"}}const $=async()=>{var P;const b=l.filter(c=>c.checked);if(s==="Sinocastel"){r(le(!0));try{const L=b.map(u=>u.code).map(u=>u.toLowerCase().padStart(4,"0").match(/../g).reverse().join("")),{data:o}=await ie.post(`${Ct}/api/packet/latest`,{imei:v.imei,pid:L}),S=(P=o==null?void 0:o.results)!=null&&P.length?o.results.filter(u=>u==null?void 0:u.packet).map(u=>B(u.packet,u.pid)):[],R=l.map(u=>{const x=S.find(m=>m.pidCheck===u.code);return console.log("match",x,x==null?void 0:x.decimalValue),{...u,dataByte:x?x.decimalValue:""}});r(me(R)),r(le(!1))}catch(c){r(le(!1)),console.error("Error in Sinocastel flow:",c),W.error("Failed to read parameter data")}}else try{r(le(!0));const c=b.map(u=>({command:se("4",u.code,"00"),id:u.id})),L=c.map(u=>u.command),o=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:v.imei,commands:`{${L}}`}),S=o==null?void 0:o.data;if(!(S!=null&&S.success)||!Array.isArray(S.commands))throw new Error("Invalid API response");let R=[...l];S.commands.forEach((u,x)=>{var m;try{const w=bt(u),{id:O}=c[x]||{};if(!O)return;const z=R.find(H=>H.id===O),i=(m=z==null?void 0:z.pi_code_variable)==null?void 0:m[0];if(!i||!w.startsWith("62")){i!=null&&i.short_name&&W.error(`Negative response from ECU for ${i.short_name}`);return}let Y=w.toLowerCase().replace(z.code.toLowerCase().slice(2),"").slice(2),M;switch(i.message_type){case"CONTINUOUS":M=$e(Y)*i.resolution+i.offset;break;case"ASCII":M=Ie(Y);break;case"eNUM":case"bcd-hex":M=Y;break;default:return}R=R.map(H=>H.id===O?{...H,dataByte:M}:H)}catch(w){console.error("Error decoding command:",w)}}),r(me(R))}catch(c){console.error("Error in handleSubmit:",c),W.error("Response timeout")}finally{r(le(!1))}},T=()=>{y(!k)},h=(b,P)=>{const c=b.target.checked;console.log("ischeckd",c);const L=d.find(S=>S.id===P);if(!L)return;const o=l.map(S=>{var u,x,m;const R=(m=(x=(u=S.pi_code_variable)==null?void 0:u[0])==null?void 0:x.group)==null?void 0:m.some(w=>w.id===L.id);return console.log("belongsToGroup",R),R?{...S,checked:c}:S});r(me(o))},D=b=>{if(b.target.checked){let P=l.map(c=>({...c,checked:!0}));r(me(P))}else{let P=l.map(c=>({...c,checked:!1}));r(me(P))}};return e.jsxs(e.Fragment,{children:[e.jsxs(a,{children:[!k&&e.jsxs(e.Fragment,{children:[e.jsxs(be,{sx:{width:"75%",mt:"15px",mx:"15px",backgroundColor:p.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:p.grey[400]},children:"Search"}),e.jsx(_e,{onChange:b=>{C(b,"one")},inputProps:{style:{padding:7,color:p.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(Ce,{position:"end",children:e.jsx(fe,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(je,{})})}),label:"Search"})]}),e.jsx("input",{type:"checkbox",style:{marginTop:"25px"},onChange:D})]}),k&&e.jsx(e.Fragment,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:p.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:p.grey[400]},children:"Search"}),e.jsx(_e,{onChange:b=>{C(b,"group")},inputProps:{style:{padding:7,color:p.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(Ce,{position:"end",children:e.jsx(fe,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(je,{})})}),label:"Search"})]})})]}),!k&&e.jsxs("div",{style:{height:"67vh",overflow:"auto"},children:[A.length>0&&A.map((b,P)=>e.jsx(a,{sx:{align:"center",my:"8px",color:"grey"},title:b.label,children:e.jsxs(a,{sx:{border:"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:p.grey[400]},children:[e.jsx(a,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:b.label.length<=25?b.label:`${b.label.substring(0,25)}...`})}),e.jsx(a,{sx:{fontSize:"16px",position:"relative",right:"2px"},children:e.jsx("input",{type:"checkbox",onChange:c=>{t(c,b.label)},checked:b.checked,style:{width:"20px",padding:0}})})]})},P)),!(A.length>0)&&e.jsx("h3",{children:"No Data"})]}),k&&e.jsx("div",{style:{height:"67vh",overflow:"auto"},children:E.length>0&&E.map((b,P)=>e.jsx(a,{sx:{align:"center",my:"8px",color:"grey"},title:b.label,children:e.jsxs(a,{sx:{border:"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:p.grey[400]},children:[e.jsx(a,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:b.label.length<=25?b.label:`${b.label.substring(0,20)}...`})}),e.jsx(a,{sx:{fontSize:"16px",position:"relative",right:"2px"},children:e.jsx("input",{type:"checkbox",onChange:c=>{h(c,b.id)},checked:b.checked,style:{width:"20px",padding:0}})})]})},P))}),e.jsx(a,{sx:{mt:"25px"},children:e.jsx(oe,{variant:"contained",sx:{width:"90%",mx:"10px",backgroundColor:"#8DA6C6"},onClick:$,children:"Submit"})}),e.jsx(a,{sx:{mt:"10px"},children:e.jsx(oe,{variant:"contained",sx:{width:"90%",mx:"10px",backgroundColor:"white",color:"black"},onClick:T,children:k?"Select Parameter":"Select Group"})})]})},lr=({handleWriteParameter:t})=>{const{writeParameter:s,activeWriteParameter:r}=N(n=>n.diagnostics),{mode:l}=N(n=>n.dashboard),d=ae(l),[v,g]=f.useState(""),p=s.length>0&&s.filter(n=>n.label.toLowerCase().includes(v.toLowerCase())),j=n=>{g(n.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(a,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:d.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:d.grey[400]},children:"Search"}),e.jsx(_e,{onChange:j,inputProps:{style:{padding:7,color:d.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(Ce,{position:"end",children:e.jsx(fe,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(je,{})})}),label:"Search"})]})}),p.length>0&&p.map((n,I)=>e.jsx(a,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(a,{sx:{p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",border:r===n.label?"1px solid #8DA6C6":"1px solid #E8E8E8",color:r===n.label?"white":d.grey[400],backgroundColor:r===n.label?"#8DA6C6":void 0},onClick:()=>{t(n)},children:e.jsx(a,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:n.label.length<=25?n.label:`${n.label.substring(0,25)}...`})})})},I))]})},ir=({handleActuatorTest:t})=>{const{liveParameters:s,writeParameter:r,actuatorTestList:l,routineTestList:d,isLiveParameter:v,isWriteParameter:g,isActuator:p,activeWriteParameter:j,activeActuatorTest:n,activeRoutineTest:I,activeFlashingFile:F,isRoutineTest:k,isFlashing:y}=N(T=>T.diagnostics),{mode:A}=N(T=>T.dashboard),E=ae(A),[C,_]=f.useState(""),B=l.length>0&&l.filter(T=>T.label.toLowerCase().includes(C.toLowerCase())),$=T=>{_(T.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(a,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:E.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:E.grey[400]},children:"Search"}),e.jsx(_e,{onChange:$,inputProps:{style:{padding:7,color:E.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(Ce,{position:"end",children:e.jsx(fe,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(je,{})})}),label:"Search"})]})}),B.length>0&&B.map((T,h)=>e.jsx(a,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(a,{sx:{border:n===T.label?"1px solid #8DA6C6":"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:n===T.label?"white":E.grey[400],backgroundColor:n===T.label?"#8DA6C6":void 0},onClick:()=>{t(T)},children:e.jsx(a,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:T.label.length<=25?T.label:`${T.label.substring(0,25)}...`})})})},h))]})},cr=({handleRoutineTest:t})=>{const{routineTestList:s,activeRoutineTest:r}=N(n=>n.diagnostics),{mode:l}=N(n=>n.dashboard),d=ae(l),[v,g]=f.useState(""),p=s.length>0&&s.filter(n=>n.label.toLowerCase().includes(v.toLowerCase())),j=n=>{g(n.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(a,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:d.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:d.grey[400]},children:"Search"}),e.jsx(_e,{onChange:j,inputProps:{style:{padding:7,color:d.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(Ce,{position:"end",children:e.jsx(fe,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(je,{})})}),label:"Search"})]})}),p.length>0&&p.map((n,I)=>e.jsx(a,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(a,{sx:{border:r===n.label?"1px solid #8DA6C6":"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:r===n.label?"white":d.grey[400],backgroundColor:r===n.label?"#8DA6C6":void 0},onClick:()=>{t(n)},children:e.jsx(a,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:n.label.length<=25?n.label:`${n.label.substring(0,25)}...`})})})},I)),!s.length>0&&e.jsx("div",{style:{marginTop:"40%",textAlign:"center",color:d.grey[400]},children:e.jsx("h3",{children:"Routine test not available"})})]})},dr=({handleFlashing:t})=>{const{activeFlashingFile:s,fotaFiles:r}=N(n=>n.diagnostics),{mode:l}=N(n=>n.dashboard),d=ae(l),[v,g]=f.useState(""),p=r.length>0&&r.filter(n=>n.label.toLowerCase().includes(v.toLowerCase())),j=n=>{g(n.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(a,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:d.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:d.grey[400]},children:"Search"}),e.jsx(_e,{onChange:j,inputProps:{style:{padding:7,color:d.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(Ce,{position:"end",children:e.jsx(fe,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(je,{})})}),label:"Search"})]})}),e.jsx("div",{style:{height:"90vh",overflow:"auto"},children:p.length>0&&p.map((n,I)=>e.jsx(a,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(a,{sx:{border:s===n.label?"1px solid #8DA6C6":"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:s===n.label?"white":d.grey[400],backgroundColor:s===n.label?"#8DA6C6":d.grey[100]},onClick:()=>{t(n)},children:e.jsx(a,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:n.label.length<=25?n.label:`${n.label.substring(0,25)}...`})})})},I))})]})},pr=({handleJ1939Parameter:t})=>{const s=pe(),{j1939Parameters:r,selectedVehicle:l}=N(C=>C.diagnostics),{mode:d}=N(C=>C.dashboard),v=ae(d);N(C=>C.liveMap);const[g,p]=f.useState(""),[j,n]=f.useState(!1);f.useState(!1);const I=r.length>0&&r.filter(C=>C.label.toLowerCase().includes(g.toLowerCase())),F=(C,_)=>{_==="group"&&setSearchText2(C.target.value),_==="one"&&p(C.target.value)};function k(C){return C.match(/../g).reverse().join("")}function y(C,_){const{pidArray:B,frames:$}=C;$[$.length-1];for(const T of B){T.toLowerCase().padStart(4,"0");const h=T,D=r.find(c=>{var L;return((L=c==null?void 0:c.pgn)==null?void 0:L.toLowerCase())===(h==null?void 0:h.toLowerCase())});if(!D||!Array.isArray(D.spn)||D.spn.length===0){console.warn(`Invalid or missing pi_code_variable for PID: ${h}`);continue}const b=D.spn[0];if(!b||typeof b.no_of_bytes!="number"||!b.message_type||b.no_of_bytes<=0){console.warn(`Invalid byte definition for PID: ${h}`,b);continue}b.no_of_bytes;const P=$[B.indexOf(T)];if(T===_){const{resolution:c=1,offset:L=0,message_type:o,start_byte:S,start_bit:R,no_of_bit:u,endian:x,bitcoded:m,no_of_bytes:w}=b,O=(S-1)*2,z=O+w*2;let i=P.slice(O,z),Y;m?Y=parseInt(i,16).toString(2).padStart(w*8,"0").slice(R-1,R-1+u):Y=i;let M;x.toLowerCase()==="big"?M=Y:M=k(Y);let H=null;switch(o){case"CONTINUOUS":H=$e(M)*c+L;break;case"ASCII":H=Ie(M);break;case"eNUM":case"bcd-hex":H=M;break;default:return{pid:_,error:`Unknown message_type: ${o}`}}return{pidCheck:h,valueHex:P,decimalValue:H}}}return{pid:_,error:"PID not found or byte definition missing"}}const A=async()=>{var C;s(le(!0));try{const B=r.filter(D=>D.checked).map(D=>D.pgn),{data:$}=await ie.post(`${Ct}/api/packet/latest`,{imei:l.imei,pid:B}),T=(C=$==null?void 0:$.results)!=null&&C.length?$.results.filter(D=>D==null?void 0:D.packet).map(D=>y(D.packet,D.pid)):[];console.log("pidArray",T);const h=r.map(D=>{const b=T.find(P=>P.pidCheck===D.pgn);return console.log("match",b,b==null?void 0:b.decimalValue),{...D,dataByte:b?b.decimalValue:""}});s(Pe(h)),s(le(!1))}catch(_){s(le(!1)),console.error("Error in Sinocastel flow:",_),W.error("Failed to read parameter data")}},E=C=>{if(C.target.checked){let _=r.map(B=>({...B,checked:!0}));s(Pe(_))}else{let _=r.map(B=>({...B,checked:!1}));s(Pe(_))}};return e.jsxs(e.Fragment,{children:[e.jsx(a,{children:!j&&e.jsxs(e.Fragment,{children:[e.jsxs(be,{sx:{width:"75%",mt:"15px",mx:"15px",backgroundColor:v.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:v.grey[400]},children:"Search"}),e.jsx(_e,{onChange:C=>{F(C,"one")},inputProps:{style:{padding:7,color:v.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(Ce,{position:"end",children:e.jsx(fe,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(je,{})})}),label:"Search"})]}),e.jsx("input",{type:"checkbox",style:{marginTop:"25px"},onChange:E})]})}),!j&&e.jsxs("div",{style:{height:"67vh",overflow:"auto"},children:[I.length>0&&I.map((C,_)=>e.jsx(a,{sx:{align:"center",my:"8px",color:"grey"},title:C.label,children:e.jsxs(a,{sx:{border:"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:v.grey[400]},children:[e.jsx(a,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:C.label.length<=25?C.label:`${C.label.substring(0,25)}...`})}),e.jsx(a,{sx:{fontSize:"16px",position:"relative",right:"2px"},children:e.jsx("input",{type:"checkbox",onChange:B=>{t(B,C.label)},checked:C.checked,style:{width:"20px",padding:0}})})]})},_)),!(I.length>0)&&e.jsx("h3",{children:"No Data"})]}),e.jsx(a,{sx:{mt:"25px"},children:e.jsx(oe,{variant:"contained",sx:{width:"90%",mx:"10px",backgroundColor:"#8DA6C6"},onClick:A,children:"Submit"})})]})},ur=()=>{var b,P,c,L,o,S,R;const t=pe(),{vehicleList:s}=N(u=>u.liveMap),{terminalAppLogs:r,dtcDataset:l,loading:d,isDtcLoader:v,selectedVehicle:g}=N(u=>u.diagnostics),{mode:p}=N(u=>u.dashboard),j=ae(p),[n,I]=f.useState(0),[F,k]=f.useState(""),[y,A]=f.useState([]),[E,C]=f.useState(!1),_=(s||[]).find(u=>{var x;return((x=u==null?void 0:u.imei[0])==null?void 0:x.mac_id)===(g==null?void 0:g.imei)})||{};console.log("active vehilce ",_,g),console.log("vehicle list",s),f.useEffect(()=>{var u,x,m,w,O,z,i;if(((u=Object.keys(_))==null?void 0:u.length)>0&&((m=(x=_==null?void 0:_.sub_model)==null?void 0:x.model_modelecu)==null?void 0:m.length)>0){let Y=(i=(z=(O=(w=_==null?void 0:_.sub_model)==null?void 0:w.model_modelecu[0])==null?void 0:O.ecu)==null?void 0:z.datasets[0])==null?void 0:i.id;t(ot({id:Y}))}},[]);const B=(u,x)=>{var H,G;I(x);let m=(G=(H=_==null?void 0:_.sub_model)==null?void 0:H.model_modelecu[x].ecu.datasets[0])==null?void 0:G.id;t(ot({id:m})),console.log("ecu",u);const{tx_header:w,rx_header:O,protocol:z}=u,i=`02${z.autopeepal},04${w},06${O}`;let M=_.sub_model.model_modelecu[x].ecu.read_dtc_fn_index.value.split("_")[0];switch(console.log("type",M),M){case"GENERICOBD":{const K=se("4","03","00"),q=se("4","07","00");W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:K})),W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:q}));let re={imei:g.imei,commands:`{${K}, ${q}}`,tranCmd:`{${K}, ${q}}`};t(xe(re));break}case"UDS":{i||W.error("Please click again");let K,q=i.split(","),re=q==null?void 0:q.map(ce=>{if((q==null?void 0:q.length)%2===0){W.error("The Tx Frame format is not right. Must be odd length.");return}return K=se("2",ce,"00"),K});if(re){W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:re}));let ce={imei:g.imei,commands:`{${re}}`,tranCmd:re};t(xe(ce))}break}case"KWP":{const K=se("4","1800AF","00");W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:K}));let q={imei:g.imei,commands:`{${K}}`,tranCmd:`{${K}}`};t(xe(q));break}default:{C(!1);break}}},$=async(u,x,m)=>{var w,O;if(C(!0),m==="clear")try{k("");let z;z=se(4,x,"00");const i=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:g.imei,commands:`{${z}}`});if(i!=null&&i.data&&C(!1),!((w=i==null?void 0:i.data)!=null&&w.success)){C(!1),k("Time Response is out");return}if(((O=i==null?void 0:i.data)==null?void 0:O.commands.filter(M=>M.toLowerCase()==="400000ffff")).length>0){k("No response from ECU");return}k("Ecu is clear dtc Success");return}catch{k("Time Response is out")}else if(m==="read"){k("");try{k("");let z;z=se(4,x,"00");const i=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:g.imei,commands:`{${z}}`});return i!=null&&i.data&&C(!1),i==null?void 0:i.data}catch{return{success:!1}}}},T=async()=>{if(C(!0),n===null)return W.error("Please select the tab");const u=_.sub_model.model_modelecu[n].ecu.read_dtc_fn_index.value;if(u==="KWP_2BYTE_DTC"||u==="UDS_2BYTE12_DTC"||u==="UDS_2BYTE_DTC"||u==="UDS_2BYTE13_DTC"||u==="UDS_3BYTE_DTC"){let x=null,m=!1;if(u==="KWP_2BYTE_DTC"){let O=null;O=await $(4,"1800FFFF","read"),O.success?(x=O.commands[0],m=!0):m=!1}else{let O=null;O=await $(3,"1902FF","read"),O.success?(console.log("responseBytes",O),x=O.commands[0],console.log("cmdVal1",x),m=!0):m=!1}m&&x==="400000ffff"?k("No response from ECU"):m||k("Time Response Out");let w=[];if(u!=="KWP_2BYTE_DTC"){console.log("cmdVal2",x),x=x==null?void 0:x.slice(6),x=x==null?void 0:x.slice(6),x=x==null?void 0:x.slice(0,-4),console.log(x,"cmdVal");const O=[];for(let i=0;i<(x==null?void 0:x.length);i+=8)O.push(x==null?void 0:x.slice(i,i+8));const z=(i,Y)=>((i&Y)>>6).toString(16).padStart(2,"0");w=O.map(i=>{let Y=0,M="",H="",G=i.slice(0,2),K=z(G,192);if(K==="00"?M="P":K==="01"?M="C":K==="02"?M="B":K==="03"&&(M="U"),u!=="KWP_2BYTE_DTC"){G=i.slice(0,-2);let q=z(G,129);switch(q){case"00":Y="Inactive:LampOff";break;case"01":Y="Active:LampOff";break;case"80":Y="Inactive:LampOn";break;case"81":Y="Active:LampOn";break}switch(u){case"UDS_3BYTE_DTC":G=i.slice(0,2),q=z(G,63),H=`${M}${q}${i.slice(2,4)}-${i.slice(4,6)}`;break}}return{type:H,value:Y}}),console.log("arrOfBytes: ",w),A(w)}}C(!1)},h=async()=>{if(n===null)return W.error("Please select the tab");const u=_.sub_model.model_modelecu[n].ecu.clear_dtc_fn_index.value;if(u==="GENERICOBD"){const x=se("4","04","00");W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:x})),t(xe(g.imei,`{${x}}`))}else{let x=u,m=null,w=0;return x==="UDS_4BYTES"?(w=4,m=$(w,"14FFFFFF","clear")):x==="UDS_3BYTES"?(w=3,m=$(w,"14FFFF","clear")):x==="GENERIC_OBD"?(w=1,m=$(w,"04","clear")):x==="KWP_PRIMITIVE"&&(w=1,m=$(w,"14","clear")),m}},D=u=>{var m;let x=[];return x=l.filter(w=>(w==null?void 0:w.code)===u),(x==null?void 0:x.length)>0?(m=x[0])==null?void 0:m.description:"Description is Not found"};return e.jsxs(a,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[(d||v||E)&&e.jsx(Se,{}),e.jsx(a,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((b=Object.keys(_))==null?void 0:b.length)>0&&((P=_==null?void 0:_.sub_model)==null?void 0:P.model_modelecu.length)>0&&((c=_==null?void 0:_.sub_model)==null?void 0:c.model_modelecu.map((u,x)=>e.jsx(a,{children:e.jsx(a,{variant:"contained",sx:{color:n===x?"#333333":j.grey[400],mt:"20px",backgroundColor:n===x?"#D5E1FE":j.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{B(u.ecu,x)},children:e.jsx("b",{children:u.ecu.name})})})))}),e.jsx(a,{children:y&&y.length>0?e.jsx(a,{sx:{height:"65vh",overflow:"auto"},children:y&&y.length>0&&y.map((u,x)=>e.jsx(is,{sx:{minWidth:275,mx:4,my:2,display:"flex",backgroundColor:j.grey[100],color:j.grey[400]},children:e.jsxs(cs,{sx:{display:"flex"},children:[e.jsxs(a,{sx:{width:"35vw"},children:[e.jsx(a,{sx:{fontSize:"15px"},children:u==null?void 0:u.type}),e.jsx(a,{sx:{fontSize:"15px"},children:D(u==null?void 0:u.type)})]}),e.jsx(a,{children:e.jsx(oe,{variant:"contained",sx:{color:"white",height:"25px",mt:"20px",ml:"50px",fontSize:"13px",backgroundColor:"#8DA6C6"},children:"Troubleshoot"})}),e.jsxs(a,{sx:{ml:"20px"},children:[e.jsx(a,{sx:{textAlign:"center"},children:"Status"}),e.jsxs(a,{children:[" ",e.jsx(oe,{variant:"contained",sx:{color:"white",height:"25px",width:"150px",fontSize:"13px",backgroundColor:"#8DA6C6"},children:u==null?void 0:u.value})]})]})]})},x))}):e.jsx(a,{children:F.length>0?e.jsx(a,{sx:{textAlign:"center",marginTop:"20%"},children:F}):e.jsx(a,{sx:{textAlign:"center",marginTop:"20%",color:j.grey[400]},children:"Wait!, Your request is in progress..."})})}),r&&r.length>0&&r[r.length-1].color==="green"&&r.length>0&&((L=r[r.length-1].log)==null?void 0:L.length)>0&&((o=r[r.length-1].log[0])==null?void 0:o.toLowerCase())==="20010000e1f0"&&((S=r[r.length-1].log[1])==null?void 0:S.toLowerCase())==="20010000e1f0"&&((R=r[r.length-1].log[2])==null?void 0:R.toLowerCase())==="20010000e1f0"&&e.jsxs(a,{sx:{display:"flex",position:"fixed",top:"85%",left:"38%"},children:[e.jsx(a,{sx:{mx:"20px"},children:e.jsx(oe,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:T,children:"Read Dtc"})}),e.jsx(a,{children:e.jsx(oe,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:()=>{h()},children:"Clear Dtc"})})]})]})},xr=()=>{var C,_,B,$,T;const t=pe(),{vehicleList:s}=N(h=>h.liveMap),{selectedVehicle:r}=N(h=>h.diagnostics),{liveParameters:l,loading:d,isDtcLoader:v}=N(h=>h.diagnostics),{mode:g}=N(h=>h.dashboard),p=ae(g),[j,n]=f.useState(0),[I,F]=f.useState(!1),k=(s||[]).find(h=>{var D;return((D=h==null?void 0:h.imei[0])==null?void 0:D.mac_id)===(r==null?void 0:r.imei)})||{};f.useEffect(()=>{var h,D,b,P,c,L;if(((h=Object.keys(k))==null?void 0:h.length)>0&&((b=(D=k==null?void 0:k.sub_model)==null?void 0:D.model_modelecu)==null?void 0:b.length)>0){let o=(L=(c=(P=k==null?void 0:k.sub_model)==null?void 0:P.model_modelecu[j])==null?void 0:c.ecu.pid_datasets[0])==null?void 0:L.id;t(at({pid:o})),t(nt({pid:o}))}},[]);const y=(h,D)=>{var u,x;n(D);let b=(x=(u=k==null?void 0:k.sub_model)==null?void 0:u.model_modelecu[D].ecu.pid_datasets[0])==null?void 0:x.id;t(at({pid:b})),t(nt({pid:b}));const{tx_header:P,rx_header:c,protocol:L}=h,o=`02${L.autopeepal},04${P},06${c}`;switch(k.sub_model.model_modelecu[D].ecu.read_dtc_fn_index.value.split("_")[0]){case"GENERICOBD":{const m=se("4","03","00"),w=se("4","07","00");W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:m})),W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:w}));let O={imei:r.imei,commands:`{${m}, ${w}}`,tranCmd:`{${m}, ${w}}`};t(xe(O));break}case"UDS":{o||W.error("Please click again");let m,w=o.split(","),O=w==null?void 0:w.map(z=>{if((w==null?void 0:w.length)%2===0){W.error("The Tx Frame format is not right. Must be odd length.");return}return m=se("2",z,"00"),m});if(O){W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:O}));let z={imei:r.imei,commands:`{${O}}`,tranCmd:O};t(xe(z))}break}case"KWP":{const m=se("4","1800AF","00");W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:m}));let w={imei:r.imei,commands:`{${m}}`,tranCmd:`{${m}}`};t(xe(w));break}}};function A(h){return parseInt(h,16)}const E=async()=>{var c,L;let h=[],D=[];l.filter(o=>o.checked).forEach(o=>{const S=se("4",o.code,"00");h.push(S),D.push({command:S,id:o==null?void 0:o.id})}),W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:h.join(",")}));const b=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:r.imei,commands:`{${h}}`});let P;if((c=b==null?void 0:b.data)!=null&&c.success){let o=l;(L=b==null?void 0:b.data)==null||L.commands.forEach((S,R)=>{var i,Y;P="62100d02520970",P.slice(0,2)!=="62"&&W.error("Error From Device"),P=P==null?void 0:P.slice(6),P=P==null?void 0:P.slice(0,-4);let x=(i=D[R])==null?void 0:i.id,m=(Y=l.filter(M=>M.id===x)[0])==null?void 0:Y.pi_code_variable[0],w=(m==null?void 0:m.byte_position)-1,O=(m==null?void 0:m.length)*2,z=P.slice(w,O);if((m==null?void 0:m.message_type)==="CONTINUOUS"){let M=A(z),H=m==null?void 0:m.resolution,G=m==null?void 0:m.offset,K=M*H+G;o=o.map(q=>x===q.id?{...q,dataByt:K}:{...q})}else if((m==null?void 0:m.message_type)==="ASCII"){let M=hexToAscii(z);o=o.map(H=>x===H.id?{...H,dataByt:M}:{...H})}else(m==null?void 0:m.message_type)==="eNUM"?o=o.map(M=>x===M.id?{...M,dataByt:z}:{...M}):(m==null?void 0:m.message_type)==="bcd-hex"&&(o=o.map(M=>x===M.id?{...M,dataByt:z}:{...M}));t(me(o))})}};return console.log("ecus",k),e.jsxs(a,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[(d||v||I)&&e.jsx(Se,{}),e.jsx(a,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((C=Object.keys(k))==null?void 0:C.length)>0&&((_=k==null?void 0:k.sub_model)==null?void 0:_.model_modelecu.length)>0&&((B=k==null?void 0:k.sub_model)==null?void 0:B.model_modelecu.map((h,D)=>e.jsx(a,{children:e.jsx(a,{variant:"contained",sx:{color:j===D?"#333333":p.grey[400],mt:"20px",backgroundColor:j===D?"#D5E1FE":p.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{y(h.ecu,D)},children:e.jsx("b",{children:h.ecu.name})})})))}),e.jsxs(a,{children:[e.jsx(a,{sx:{ml:"30px",mt:"20px",color:p.grey[400]},children:e.jsx("span",{children:e.jsx("b",{children:j!==null&&((T=($=k==null?void 0:k.sub_model)==null?void 0:$.model_modelecu[j])==null?void 0:T.ecu.name)})})}),e.jsx("div",{style:{height:"60vh",overflow:"auto"},children:e.jsx(a,{sx:{mt:"20px"},children:l.filter(h=>h.checked).map((h,D)=>e.jsxs(a,{sx:{border:"1px solid grey",display:"flex",mx:"30px",mb:"10px",borderRadius:"5px",padding:"15px",color:p.grey[400]},children:[e.jsx(a,{sx:{width:"95%"},children:h.label}),e.jsxs(a,{children:[" ",h&&(h==null?void 0:h.dataByte)&&h.dataByte,h.pi_code_variable[0].unit]})]}))})}),e.jsx(a,{children:e.jsx(a,{sx:{display:"flex",mt:"20px",mx:"20px"},children:e.jsx(a,{children:e.jsx(oe,{variant:"contained",sx:{background:"#8DA6C6"},onClick:E,children:"Refresh"})})})})]})]})},hr=()=>{var K,q,re,ce;const t=pe(),{vehicleList:s}=N(U=>U.liveMap),{selectedVehicle:r}=N(U=>U.diagnostics);let l=JSON.parse(localStorage.getItem("w_userDetails"));const d={headers:{"Content-Type":"application/json",Authorization:`JWT ${(K=l==null?void 0:l.token)==null?void 0:K.access}`}},{mode:v}=N(U=>U.dashboard),g=ae(v),{selectedFlashingFile:p,ecuFotaId:j,fotaFiles:n}=N(U=>U.diagnostics),[I,F]=f.useState(0),[k,y]=f.useState(0),[A,E]=f.useState(0),[C,_]=f.useState(""),[B,$]=f.useState(""),[T,h]=f.useState(!1),[D,b]=f.useState(!1),[P,c]=f.useState(!1),[L,o]=f.useState(!1),[S,R]=f.useState(),[u,x]=f.useState(),[m,w]=f.useState({created_at:"",updated_at:""}),[O,z]=f.useState({created_at:"",updated_at:""}),i=(s||[]).find(U=>{var ee;return((ee=U==null?void 0:U.imei[0])==null?void 0:ee.mac_id)===(r==null?void 0:r.imei)})||{};f.useEffect(()=>{var U,ee,Z,J,Q,X,V,te,ne,de;if(((U=Object.keys(i))==null?void 0:U.length)>0&&((Z=(ee=i==null?void 0:i.sub_model)==null?void 0:ee.model_modelecu)==null?void 0:Z.length)>0){let he=(V=(X=(Q=(J=i==null?void 0:i.sub_model)==null?void 0:J.model_modelecu[I])==null?void 0:Q.ecu)==null?void 0:X.pid_datasets[0])==null?void 0:V.id;t(Ye({pid:he}));let ue=(de=(ne=(te=i==null?void 0:i.sub_model)==null?void 0:te.model_modelecu[I])==null?void 0:ne.flash)==null?void 0:de.file;ue=(ue==null?void 0:ue.map(ve=>({...ve,label:ve.sw_part_no})))||[],t(lt(ue))}},[i]),f.useEffect(()=>{var U,ee,Z,J,Q;if(r&&(r!=null&&r.imei)&&((U=i==null?void 0:i.sub_model)!=null&&U.model_modelecu)&&((ee=i==null?void 0:i.sub_model)==null?void 0:ee.model_modelecu.length)>0){let X=(Q=(J=(Z=i==null?void 0:i.sub_model)==null?void 0:Z.model_modelecu[I])==null?void 0:J.ecu)==null?void 0:Q.id;Y(X)}},[r]),f.useEffect(()=>{},[p]);const Y=U=>{if(r&&(r!=null&&r.imei)){let ee={created_by:JSON.parse(localStorage.getItem("w_userDetails")).user_id,imei:r.imei,ecu:U};ie.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/latest/ecu-fota/",ee).then(J=>{var te,ne,de,he,ue,ve,Ke,ze,Xe,qe,Je,Qe,Ze,Ve;let Q=(te=J==null?void 0:J.data)==null?void 0:te.flashing_attempts,X=(ne=J==null?void 0:J.data)==null?void 0:ne.download_attempts;t(Fe((de=J==null?void 0:J.data)==null?void 0:de.id)),t(He((he=J==null?void 0:J.data)==null?void 0:he.server_sw));let V=(Ke=(ve=(ue=i.sub_model)==null?void 0:ue.model_modelecu[I])==null?void 0:ve.flash)==null?void 0:Ke.file;if(V&&V.length>0){let St=V.find(kt=>{var et;return kt.sw_part_no===((et=J==null?void 0:J.data)==null?void 0:et.server_sw)});t(Ue(St))}X&&(X==null?void 0:X.length)>0&&(R(X[0].id),y(X[0].latest_percentage),_(X[0].status),w({created_at:ke(new Date((ze=X[0])==null?void 0:ze.created)).format("DD-MM-YYYY HH:mm:ss"),updated_at:ke(new Date((Xe=X[0])==null?void 0:Xe.modified)).format("DD-MM-YYYY HH:mm:ss")}),X[0].latest_percentage<100&&X[0].status!=="Completed"&&X[0].status!=="Aborted"&&(c(!0),b(!0),o(!1),h(!1))),Q&&(Q==null?void 0:Q.length)>0&&(E((qe=Q[0])==null?void 0:qe.latest_percentage),x((Je=Q[0])==null?void 0:Je.id),$((Qe=Q[0])==null?void 0:Qe.status),z({created_at:ke(new Date((Ze=Q[0])==null?void 0:Ze.created)).format("DD-MM-YYYY HH:mm:ss"),updated_at:ke(new Date((Ve=Q[0])==null?void 0:Ve.modified)).format("DD-MM-YYYY HH:mm:ss")}),Q[0].latest_percentage<100&&Q[0].status!=="Completed"&&Q[0].status!=="Aborted"&&(c(!1),b(!1),o(!0),h(!0)))}).catch(J=>{R(),x(),t(Fe("")),y(0),E(0),t(He("")),t(Ue({})),c(!1),b(!1),o(!1),h(!1)})}};f.useEffect(()=>{const U=setInterval(()=>{P&&D&&ie.get("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/ecufota/downloadattempt/list/?id="+S,d).then(Z=>{var Q,X,V,te,ne;const J=parseInt(Z.data.results[0].latest_percentage);y(J),_(Z.data.results[0].status),w({created_at:ke(new Date((Q=Z.data.results[0])==null?void 0:Q.created)).format("DD-MM-YYYY HH:mm:ss"),updated_at:ke(new Date((X=Z.data.results[0])==null?void 0:X.modified)).format("DD-MM-YYYY HH:mm:ss")}),(J=="100"||Z.data.results[0].status==="Completed"||Z.data.results[0].status==="Aborted")&&(clearInterval(U),b(!1),c(!1),Y((ne=(te=(V=i==null?void 0:i.sub_model)==null?void 0:V.model_modelecu[I])==null?void 0:te.ecu)==null?void 0:ne.id))}),L&&T&&ie.get("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/ecufota/flashingattempt/list/?id="+u,d).then(Z=>{var Q,X,V;const J=parseInt(Z.data.results[0].latest_percentage);E(J),$(Z.data.results[0].status),(J=="100"||Z.data.results[0].status==="Completed"||Z.data.results[0].status==="Aborted")&&(clearInterval(U),h(!1),Y((V=(X=(Q=i==null?void 0:i.sub_model)==null?void 0:Q.model_modelecu[I])==null?void 0:X.ecu)==null?void 0:V.id))})},1e3);return()=>{clearInterval(U)}},[T,P,L,D,u,S]);const M=(U,ee)=>{var Q,X,V,te,ne,de;F(ee);let Z=(V=(X=(Q=i==null?void 0:i.sub_model)==null?void 0:Q.model_modelecu[ee])==null?void 0:X.ecu)==null?void 0:V.id,J=(de=(ne=(te=i.sub_model)==null?void 0:te.model_modelecu[ee])==null?void 0:ne.flash)==null?void 0:de.file;J=(J==null?void 0:J.map(he=>({...he,label:he.sw_part_no})))||[],t(lt(J)),Y(Z)},H=()=>{var ee,Z,J,Q;if(p&&!Object.keys(p).length>0)return W.error("Please select the flashing file");b(!D),_(""),c(!1),y(0),h(!1),console.log("selected file",p);let U={};if(U.current_ws="null",U.server_sw=p==null?void 0:p.sw_part_no,U.status="OPEN",U.ecu=(J=(Z=(ee=i==null?void 0:i.sub_model)==null?void 0:ee.model_modelecu[I])==null?void 0:Z.ecu)==null?void 0:J.id,U.imei=r.imei,U.created_by=JSON.parse(localStorage.getItem("w_userDetails")).user_id,!D)try{ie.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/create_ecufota/",U,d).then(V=>{let te={};te.ecu_fota=V.data.id,t(Fe(V.data.id)),te.latest_percentage="0",te.created_by=U.created_by,te.status="New",ie.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/create/ecufota/downloadattempt/",te,d).then(de=>{c(!0),o(!1),R(de.data.id)})}).catch(V=>{var te;if(b(!1),c(!1),((te=V==null?void 0:V.response)==null?void 0:te.status)===401)return console.log("Session expired, dispatching logout"),t(it()),W.error("Session Expired",{id:"clipboard"});V.message?W.error("Error occurred while downloading"):W.error("Internal server error")})}catch(X){if(b(!1),c(!1),((Q=X==null?void 0:X.response)==null?void 0:Q.status)===401)return console.log("Session expired, dispatching logout"),t(it()),W.error("Session Expired",{id:"clipboard"});X.message?W.error("Error occurred while downloading"):W.error("Internal server error")}},G=()=>{if(p&&!Object.keys(p).length>0)return W.error("Please select the flashing file");if(!j)return W.error("Fota id missing. Please download the file first");if(k!="100"&&C!=="Aborted")return W.error("Start the download operation before proceeding");b(!1),h(!T),o(!1),E(0);let U={};if(U.ecu_fota=j,U.latest_percentage="0",U.created_by=p.created_by,U.status="New",U.latest_response="OK",!T)try{ie.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/create/ecufota/flashingattempt/",U,d).then(Z=>{c(!1),o(!0),x(Z.data.id)}).catch(Z=>{h(!1),o(!1),h(!T),Z.message?W.error("error occurred while flashing"):W.error("Internal server error")})}catch{h(!1),o(!1),h(!T)}};return e.jsxs(a,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[e.jsx(a,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((q=Object.keys(i))==null?void 0:q.length)>0&&((re=i==null?void 0:i.sub_model)==null?void 0:re.model_modelecu.length)>0&&((ce=i==null?void 0:i.sub_model)==null?void 0:ce.model_modelecu.map((U,ee)=>e.jsx(a,{children:e.jsx(a,{variant:"contained",sx:{color:I===ee?"#333333":g.grey[400],mt:"20px",backgroundColor:I===ee?"#D5E1FE":g.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{M(U.ecu,ee)},children:e.jsx("b",{children:U.ecu.name})})})))}),e.jsx(a,{children:e.jsxs(a,{children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-evenly",mt:"15px"},children:[e.jsxs("div",{children:["ECU Fota id :",j," "]}),e.jsxs("div",{children:["Download Status:",C," "]}),e.jsxs("div",{children:["Flashing Status :",B," "]})]}),e.jsx(a,{sx:{mt:"50px",color:g.grey[400]},children:e.jsx("h2",{style:{textAlign:"center"},children:(D||"flashinBtn")&&"Start : Downloading"})}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-around"},children:[e.jsxs(a,{children:[e.jsx(a,{sx:{my:"50px",color:"white",textAlign:"center"},children:e.jsx(mt,{type:"circle",percent:k,size:180,strokeColor:"#8DA6C6",trailColor:"#d1d1d1",format:()=>e.jsxs("div",{style:{color:g.grey[400]},children:[k,"%"]})})}),e.jsx(a,{sx:{textAlign:"center"},children:e.jsx(oe,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:H,children:D?"Stop Downloading":"Start Downloading"})}),e.jsxs(a,{sx:{textAlign:"left"},children:[e.jsxs("p",{children:["Start Time: ",m.created_at]}),e.jsxs("p",{children:["Last Updated Time: ",m.updated_at]})]})]}),e.jsxs(a,{children:[e.jsx(a,{sx:{my:"50px",textAlign:"center"},children:e.jsx(mt,{type:"circle",percent:A,size:180,trailColor:"#d1d1d1",strokeColor:"#8DA6C6",format:()=>e.jsxs("div",{style:{color:g.grey[400]},children:[A,"%"]})})}),e.jsx(a,{sx:{textAlign:"center"},children:e.jsxs(oe,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:G,disabled:P,children:[" ",T?"Stop Flashing...":"Start Flashing"]})}),e.jsxs(a,{sx:{textAlign:"left"},children:[e.jsxs("p",{children:["Start Time: ",O.created_at]}),e.jsxs("p",{children:["Last Updated Time: ",O.updated_at]})]})]})]})]})})]})},gr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALySURBVHgB7Zi/bxJhGMefOw6O6a4LnUpjUjrVoa1TnWwX6yKd7CIYE3VRE1EX/gIGNTFRFzVpog6CS3GxLoILdKk6wGSHJjDBAkxQNPh+X3sEz+NAkub10veTXODe97n3eb7Pj2uDQoxUKnVK8/u3iJRFdjtF/zk96m3/7HYTyWTyQPkdfOAreSBwG40f3cMl1acFHpP3ggdTml/fUhWFouRZeosqeZsprwsgKUA0UoBopADRSAGikQJEIwWI5uQK0HX9WO3HZSIBpxcW6Patm2QYxlj29+/dpTPLy3QcaKMMkLn5SIR/bzabVKlW+3vToRCZTESz1aIWuyKROQrqQWp32lSr1fmaBcSGZ2ao0+lQrV7nz7bZd8sGe1jHvpvPfxYQj12mYDDIA9L1AL16/aa/t7a2yj9zuTx3fGF9nTlskWka1G63uS3Wwfx8hGZnw+ycGm1n39PGRpRKpTIVikWehM3NS5ROZ3iwgz7xG0Q6824yATjYNE36sPORyuXyX/tvmcPBLD95+ox/Tk+HWBAxmg2H6fv+Pl/b2/vCgx1FCFVlPrNMpPWsG64C0BqVSpVl9jwr6RwVCkVeZifQIuhzZBplB4EJBrd11I7R6MV+hQaTZGfkEKczGV5ywzApHo/xXnXi7MoKD/4Ta6dCcfePPauN7Di9mWD7/MVL2mFVR8tdYT7d3mAjBSDgSqVCuXye36M3m9bghWd45nHBCR9Q1uO47EHBFoOLC2BWrDWDtcygKPgssZZF6+LeesaJkTOA4bJAO9XqNe4cQWJoAYa4uFukjWiUbly/1rc/PMo8+n919RyvINoBGc7lc9wea5ZIYDj4dHsLKQ8ePuqRC8iAVUJ7L1p/B+yvSydb65xxznDzaWfkaxSZGdbDTocPczjsHCd7N5925D9zopECRCMFiEYKEI0UIBopQDRSgGggoEEehglQvpFH6fUoq2o+5Sp5sAqKojT8mnpHTSQSB5pPXYIa8gAInMX62acqS4j9F+WkUOZ/3jqMAAAAAElFTkSuQmCC";var Ge={},fr=ps;Object.defineProperty(Ge,"__esModule",{value:!0});var jt=Ge.default=void 0,mr=fr(ds()),br=e;jt=Ge.default=(0,mr.default)((0,br.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");const yr=()=>{N(y=>y.liveMap);const{terminalAppLogs:t,loading:s,selectedVehicle:r}=N(y=>y.diagnostics),{mode:l}=N(y=>y.dashboard),d=ae(!l),v=[5,2,4],g=pe(),[p,j]=f.useState(5),[n,I]=f.useState();f.useEffect(()=>{Object.keys(r).length>0&&g(xe({imei:`${r==null?void 0:r.imei}`,commands:"{500a0047568afe56214e238000ffc3}",tranCmd:"500a0047568afe56214e238000ffc3"}))},[r]);const F=()=>{if(!n)return W.error("Please enter value");let y=n.split(","),A,E=!1;if(y=y.map(C=>{if((C==null?void 0:C.length)%2!==0){E=!0,W.error("The Tx Frame format is not right. Must be even length.");return}return A=se(p,C,"00"),A}),!E)if(Object.keys(r).length>0){let C={imei:r.imei,commands:`{${y}}`,tranCmd:y};g(xe(C))}else W.error("Please Select Vehicle",{id:"clipBoard"})},k=()=>{W.success("Copied to clipboard!");let y=[];y=t.map(E=>E.timestamp+" "+E.log);const A=document.createElement("textarea");A.value=y.length===0?" ":y.join(`
`),document.body.appendChild(A),A.select(),document.execCommand("copy"),document.body.removeChild(A)};return e.jsxs(a,{children:[s&&e.jsx(Se,{}),e.jsxs(a,{children:[e.jsxs(a,{children:[e.jsx(a,{sx:{display:"flex",justifyContent:"space-around"},children:v.map((y,A)=>e.jsxs("button",{style:{textAlign:"center",padding:"10px 20px",borderRadius:"5px",cursor:"pointer",width:"165px",margin:"20px",border:"1px solid #8DA6C6",backgroundColor:y===p?"#8DA6C6":"white",color:y===p?"white":"#8DA6C6"},onClick:E=>{j(y)},children:[y,"0"]}))}),e.jsxs(a,{sx:{display:"flex"},children:[e.jsx(yt,{name:"txFrame",type:"text",value:n,style:{width:"75%",height:"45px",border:"1px solid #8DA6C6",borderRadius:5,background:"#8DA6C6",color:"white",marginLeft:"9%"},pattern:"[A-Fa-f0-9,]+",onChange:y=>I(y.target.value),placeholder:"ENTER VALUE",className:"white-placeholder"}),e.jsx(us,{onClick:F,style:{margin:"5px"},children:"Send"}),e.jsx("img",{src:gr,style:{height:"44px",marginLeft:"15px",cursor:"pointer"}})]})]}),e.jsxs(a,{style:{background:d.grey[100],width:"90%",minHeight:"68vh",borderRadius:"2px",display:"flex",justifyContent:"space-between",flexDirection:"row",margin:"30px 60px",overflowY:"auto",color:d.grey[400]},children:[t&&e.jsx("div",{style:{textTransform:"uppercase",fontSize:"12px",padding:"20px"},children:t.map(y=>e.jsxs("p",{style:{display:"flex"},children:[e.jsx("span",{style:{marginLeft:"5px"},children:y.timestamp}),e.jsx("span",{style:{height:"15px",width:"15px",backgroundColor:y.color,borderRadius:"50%",marginLeft:"5px"}}),e.jsx("span",{style:{marginLeft:"5px"},children:y.log})]}))}),e.jsxs(a,{style:{display:"flex",justifyContent:"flex-end",padding:"20px",gap:"10px"},children:[e.jsx(jt,{style:{cursor:"pointer"},onClick:()=>g(xs())}),e.jsx(hs,{style:{cursor:"pointer"},onClick:()=>k()})]})]})]})]})};let Ae={Sanitas_BOSCH_BS6_PROD:"01",Sanitas_ADVANTEK_BS6_PROD:"02",Sanitas_ADVANTEK_BS4_PROD:"03",KOEL_BOSCH_BS4:"04",FLASH_KOEL_BOSCH_F6_CPCB4:"05",GREAVES_BOSCH_BS6_PROD:"02",ATUL_ADVANTEK_BS6_A46:"04",TVS_ADVANTEK_BS6_A46:"05",GREAVES_SEDEMAC_BL_BS6:"07",GREAVES_SEDEMAC_APP_BS6:"08",SEEDKEYALGO_VECV_BOSCH_BS6_01:"11",KOEL_AUTO_BS4:"12",KOEL_CPCB4_LOW_HP_ECU:"03",KOEL_CPCB4_HIGH_HP_ECU:"14",KOEL_CPCB4_MID_HP_ECU:"04",TATA_DNOX:"31"},De=t=>{let s="";return t==="SML_BOSCH_BS6_PROD"||t==="KOEL_BOSCH_BS4"?s="08":t==="SEEDKEYALGO_VECV_DELPHI_BS6"||t==="SEEDKEYALGO_VECV_AMT_BS6"?s="04":t==="SEEDKEYALGO_VECV_DELPHI_TCIC"?s="02":t==="GREAVES_BOSCH_BS6_PROD"||t==="GREAVES_BOSCH_BS6_DEV"?s="04":t==="Sanitas_BOSCH_BS6_PROD"||t==="KOEL_BOSCH_BS4"?s="08":t==="SEEDKEYALGO_VECV_DELPHI_BS6"||t==="SEEDKEYALGO_VECV_AMT_BS6"?s="04":t==="SEEDKEYALGO_VECV_DELPHI_TCIC"||t==="SEEDKEYALGO_VECV_DELPHI_TCIC"?s="02":t==="GREAVES_BOSCH_BS6_PROD"||t==="GREAVES_BOSCH_BS6_DEV"?s="04":s="08",s};const _r=()=>{var P,c,L;const t=pe(),{vehicleList:s}=N(o=>o.liveMap),{selectedVehicle:r}=N(o=>o.diagnostics),{mode:l}=N(o=>o.dashboard),d=ae(l),{activeWriteParameter:v,selectedWriteParam:g,loading:p,isDtcLoader:j}=N(o=>o.diagnostics),[n,I]=f.useState(0),[F,k]=f.useState(null),[y,A]=f.useState(null),[E,C]=f.useState(""),_=(s||[]).find(o=>{var S;return((S=o==null?void 0:o.imei[0])==null?void 0:S.mac_id)===(r==null?void 0:r.imei)})||{};f.useEffect(()=>{var o,S,R,u,x,m;if(((o=Object.keys(_))==null?void 0:o.length)>0&&((R=(S=_==null?void 0:_.sub_model)==null?void 0:S.model_modelecu)==null?void 0:R.length)>0){let w=(m=(x=(u=_==null?void 0:_.sub_model)==null?void 0:u.model_modelecu[n])==null?void 0:x.ecu.pid_datasets[0])==null?void 0:m.id;t(ct({pid:w}))}},[]);const B={padding:"10px 10px",width:"28.5vw",borderRadius:"5px",border:"1px solid grey",backgroundColor:"white",color:"black"},$=(o,S)=>{var i,Y,M;I(S);let R=(M=(Y=(i=_==null?void 0:_.sub_model)==null?void 0:i.model_modelecu[S])==null?void 0:Y.ecu.pid_datasets[0])==null?void 0:M.id;t(ct({pid:R}));const{tx_header:u,rx_header:x,protocol:m}=o,w=`02${m.autopeepal},04${u},06${x}`;switch(_.sub_model.model_modelecu[S].ecu.read_dtc_fn_index.value.split("_")[0]){case"GENERICOBD":{const H=se("4","03","00"),G=se("4","07","00");W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:H})),W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:G}));let K={imei:r.imei,commands:`{${H}, ${G}}`,tranCmd:`{${H}, ${G}}`};t(xe(K));break}case"UDS":{w||W.error("Please click again");let H,G=w.split(","),K=G==null?void 0:G.map(q=>{if((G==null?void 0:G.length)%2===0){W.error("The Tx Frame format is not right. Must be odd length.");return}return H=se("2",q,"00"),H});if(K){W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:K}));let q={imei:r.imei,commands:`{${K}}`,tranCmd:K};t(xe(q))}break}case"KWP":{const H=se("4","1800AF","00");W.success(e.jsx("span",{style:{wordBreak:"break-all"},children:H}));let G={imei:r.imei,commands:`{${H}}`,tranCmd:`{${H}}`};t(xe(G));break}}};function T(o,S){if(o.length>=S)return o;{const R=S-o.length;return"0".repeat(R)+o}}function h(o,S,R){return R<0?S+o:R>=o.length?o+S:(o.slice(R,R+S.length),o.slice(0,R)+S+o.slice(R+S.length))}const D=async()=>{var M,H,G,K,q,re,ce,U,ee,Z,J,Q;if(Object.keys(g).length===0)return W.error("Please select a write parameter");if(!F)return W.error("Please enter a write value");t(le(!0));let o="",S,R;const u=g==null?void 0:g.pi_code_variable[0];console.log("element",u.message_type);let x;isNaN(F)?x=[...F].map(X=>X.charCodeAt(0).toString(16).padStart(2,"0")).join(""):x=gs(parseInt(F));let m=T(x,(u==null?void 0:u.length)*2),w=u!=null&&u.byte_position?(u.byte_position-1)*2:0,O=h(o,m,w);O=`2E${g==null?void 0:g.write_pid}${O}`,O=se(4,O,"00");const i=_.sub_model.ecus[n],Y=(M=i==null?void 0:i.write_data_fn_index)==null?void 0:M.value;R=se(4,"1003","00"),Y==="UDS_DS1003_SK090A"?S=`35${Ae[(H=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:H.value]}${De((G=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:G.value)}02270902270A`:Y==="UDS_DS1003_SK0102"?S=`35${Ae[(K=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:K.value]}${De((q=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:q.value)}022701022702`:Y==="UDS_DS1003_SK0B0C"?S=`35${Ae[(re=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:re.value]}${De((ce=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:ce.value)}02270B02270C`:(Y==="UDS_DS1003_SK0304"||Y==="UDS_DS1003_SK0506")&&(S=`35${Ae[(U=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:U.value]}${De((ee=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:ee.value)}022703022704`),S=se(2,S,"00");try{const X=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:r.imei,commands:`{${R},${S},${O}}`});if((Z=X==null?void 0:X.data)!=null&&Z.success){t(le(!1));let V="",te="";(Q=(J=X==null?void 0:X.data)==null?void 0:J.commands)==null||Q.forEach(ne=>{const de=ne.slice(0,2),he=ne.slice(6),ue=he.slice(0,2);de==="40"&&(ue==="7f"?(te=dt(he.slice(4,6)),V="Negative Response"):ue==="ff"&&(V="No response from ecu")),de==="20"&&ue==="01"&&(te=dt(he.slice(4,6)),V="Negative Response")}),V?(A(`${V} ${te}`),W.error(V)):(A("Positive response from ecu"),W.success("Positive response from ecu"))}}catch{t(le(!1)),W.error("Failed to send command")}},b=async()=>{var R,u,x;t(le(!0));let o=se(4,g.code,"00"),S="";try{const m=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:r.imei,commands:`{${o}}`});if((R=m==null?void 0:m.data)!=null&&R.success){t(le(!1)),S=(u=m==null?void 0:m.data)==null?void 0:u.commands[0];const w=bt(S);if(console.log("cmd val",w),!w.startsWith("62")){W.error(`Negative response from ecu for ${O==null?void 0:O.short_name}`);return}let O=g==null?void 0:g.pi_code_variable[0],z=g;const{byte_position:i,length:Y,resolution:M,offset:H,message_type:G}=O;let K=w==null?void 0:w.toLowerCase().replace((x=g==null?void 0:g.code)==null?void 0:x.toLowerCase().slice(2),"").slice(2);console.log("Decoded Data:",K);let q;switch(G){case"CONTINUOUS":q=$e(K)*M+H;break;case"ASCII":q=Ie(K);break;case"eNUM":case"bcd-hex":q=K;break;default:return}C(q)}}catch{t(le(!1))}};return e.jsxs(a,{sx:{border:"1px solid #dee0e3",height:"80vh",borderRadius:"5px",margin:"10px 20px"},children:[(p||j)&&e.jsx(Se,{}),e.jsx(a,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((P=Object.keys(_))==null?void 0:P.length)>0&&((c=_==null?void 0:_.sub_model)==null?void 0:c.model_modelecu.length)>0&&((L=_==null?void 0:_.sub_model)==null?void 0:L.model_modelecu.map((o,S)=>e.jsx(a,{children:e.jsx(a,{variant:"contained",sx:{color:n===S?"#333333":d.grey[400],mt:"20px",backgroundColor:n===S?"#D5E1FE":d.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{$(o.ecu,S)},children:e.jsx("b",{children:o==null?void 0:o.ecu.name})})})))}),e.jsxs(a,{children:[e.jsx(a,{sx:{ml:"30px",my:"65px",color:d.grey[400],textAlign:"center",fontSize:"25px"},children:e.jsx("span",{children:e.jsx("b",{children:v||"Please select the parameter"})})}),e.jsx(a,{sx:{ml:"30px",color:v?"red":"green",textAlign:"center",fontSize:"15px"},children:e.jsx("span",{children:y})}),e.jsxs(a,{sx:{display:"flex",m:"20px",color:d.grey[400]},children:[e.jsxs(a,{children:[e.jsx("div",{style:{marginBottom:"5px"},children:e.jsx("b",{children:"Current value"})}),e.jsx("input",{style:B,value:E,disabled:!0}),e.jsx(a,{children:e.jsx(oe,{variant:"contained",sx:{m:"10px",backgroundColor:"#8DA6C6"},onClick:b,children:"Read Here"})})]}),e.jsx(a,{sx:{m:"20px",color:d.grey[400]},children:e.jsx("div",{style:{marginTop:"5px"},children:e.jsx("b",{children:"UNIT"})})}),e.jsxs(a,{children:[e.jsx("div",{style:{marginBottom:"5px"},children:e.jsx("b",{children:"Write value"})}),e.jsx("input",{style:B,placeholder:"Enter here",value:F,onChange:o=>k(o.target.value)})]})]}),e.jsx(a,{children:e.jsx(a,{sx:{display:"flex",justifyContent:"center",mt:"30px"},children:e.jsx(a,{children:e.jsx(oe,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:D,children:"Submit"})})})})]})]})},Me=()=>{var F,k,y;const{mode:t}=N(A=>A.dashboard),s=ae(t),r=pe(),{vehicleList:l}=N(A=>A.liveMap),{selectedVehicle:d}=N(A=>A.diagnostics),{ecuInfo:v,loading:g}=N(A=>A.diagnostics),[p,j]=f.useState(0),n=(l||[]).find(A=>{var E;return((E=A==null?void 0:A.imei[0])==null?void 0:E.mac_id)===(d==null?void 0:d.imei)})||{};f.useEffect(()=>{var A,E,C,_,B,$;if(((A=Object.keys(n))==null?void 0:A.length)>0&&((C=(E=n==null?void 0:n.sub_model)==null?void 0:E.ecus)==null?void 0:C.length)>0){let T=($=(B=(_=n==null?void 0:n.sub_model)==null?void 0:_.ecus[0])==null?void 0:B.pid_datasets[0])==null?void 0:$.id;r(Ye({pid:T}))}},[]);const I=(A,E)=>{var _,B;j(E);let C=(B=(_=n==null?void 0:n.sub_model)==null?void 0:_.ecus[E].pid_datasets[0])==null?void 0:B.id;r(Ye({pid:C}))};return e.jsxs(a,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[g&&e.jsx(Se,{}),e.jsx(a,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((F=Object.keys(n))==null?void 0:F.length)>0&&((k=n==null?void 0:n.sub_model)==null?void 0:k.ecus.length)>0&&((y=n==null?void 0:n.sub_model)==null?void 0:y.ecus.map((A,E)=>e.jsx(a,{children:e.jsx(a,{variant:"contained",sx:{color:p===E?"#333333":s.grey[400],mt:"20px",backgroundColor:p===E?"#D5E1FE":s.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{I(A,E)},children:e.jsx("b",{children:A.name})})})))}),e.jsx(a,{sx:{color:s.grey[400]},children:v&&(v==null?void 0:v.length)>0&&v.map((A,E)=>e.jsxs(a,{sx:{border:"1px solid grey",display:"flex",m:"30px",borderRadius:"5px",padding:"15px"},children:[e.jsx(a,{sx:{width:"95%"},children:A.label}),e.jsx(a,{children:A.pi_code_variable[0].unit})]}))})]})},Cr=()=>{var E,C,_,B,$,T;const t=pe(),{vehicleList:s}=N(h=>h.liveMap),{selectedVehicle:r}=N(h=>h.diagnostics),{j1939Parameters:l,liveParameters:d,loading:v,isDtcLoader:g}=N(h=>h.diagnostics);console.log("j1939Parameters",l);const{mode:p}=N(h=>h.dashboard),j=ae(p),[n,I]=f.useState(0),[F,k]=f.useState(!1),y=(s||[]).find(h=>{var D;return((D=h==null?void 0:h.imei[0])==null?void 0:D.mac_id)===(r==null?void 0:r.imei)})||{};f.useEffect(()=>{var h,D,b,P,c,L;if(((h=Object.keys(y))==null?void 0:h.length)>0&&((b=(D=y==null?void 0:y.sub_model)==null?void 0:D.model_modelecu)==null?void 0:b.length)>0){let o=(L=(c=(P=y==null?void 0:y.sub_model)==null?void 0:P.model_modelecu[n])==null?void 0:c.ecu.j1939_datasets[0])==null?void 0:L.id;t(pt({pid:o}))}},[]);const A=(h,D)=>{var P,c,L;I(D);let b=(L=(c=(P=y==null?void 0:y.sub_model)==null?void 0:P.model_modelecu[D])==null?void 0:c.ecu.j1939_datasets[0])==null?void 0:L.id;t(pt({pid:b}))};return console.log("ecus",y),e.jsxs(a,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[(v||g||F)&&e.jsx(Se,{}),e.jsx(a,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((E=Object.keys(y))==null?void 0:E.length)>0&&((C=y==null?void 0:y.sub_model)==null?void 0:C.model_modelecu.length)>0&&((_=y==null?void 0:y.sub_model)==null?void 0:_.model_modelecu.map((h,D)=>e.jsx(a,{children:e.jsx(a,{variant:"contained",sx:{color:n===D?"#333333":j.grey[400],mt:"20px",backgroundColor:n===D?"#D5E1FE":j.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{A(h.ecu,D)},children:e.jsx("b",{children:h.ecu.name})},h.ecu.id)})))}),e.jsxs(a,{children:[e.jsx(a,{sx:{ml:"30px",mt:"20px",color:j.grey[400]},children:e.jsx("span",{children:e.jsx("b",{children:n!==null&&((T=($=(B=y==null?void 0:y.sub_model)==null?void 0:B.model_modelecu[n])==null?void 0:$.ecu)==null?void 0:T.name)})})}),e.jsx("div",{style:{height:"60vh",overflow:"auto"},children:e.jsx(a,{sx:{mt:"20px"},children:l.filter(h=>h.checked).map((h,D)=>e.jsxs(a,{sx:{border:"1px solid grey",display:"flex",mx:"30px",mb:"10px",borderRadius:"5px",padding:"15px",color:j.grey[400]},children:[e.jsx(a,{sx:{width:"95%"},children:h.label}),e.jsxs(a,{children:[" ",h&&(h==null?void 0:h.dataByte)&&h.dataByte,h.spn[0].unit]})]}))})}),e.jsx(a,{children:e.jsx(a,{sx:{display:"flex",mt:"20px",mx:"20px"}})})]})]})};let jr=["RetroFotax","Sinocastel"];const Er=()=>{const t=pe(),{isTerminal:s,isReadDtc:r,isLiveParameter:l,isWriteParameter:d,isActuator:v,isRoutineTest:g,isEcuInfo:p,isFlashing:j,selectedVehicle:n,isJ1939:I}=N(c=>c.diagnostics),{w_customer_id:F}=N(c=>c.auth),{mode:k}=N(c=>c.dashboard),[y,A]=f.useState(!1);f.useState(!0);const[E,C]=f.useState(!1),[_,B]=f.useState([]),[$,T]=f.useState(null),h=ae(k);f.useEffect(()=>{D()},[]);const D=async()=>{try{const c=await t(fs({w_customer_id:F}));if(!Array.isArray(c.payload)){W.error("Unexpected data format");return}const L=c.payload.filter(o=>{var S;return Array.isArray(o.imei)&&((S=o.imei[0])==null?void 0:S.mac_id)}).map(o=>{var S,R;return{...o,id:o.id,label:o.registration_id,value:(S=o.imei[0])==null?void 0:S.mac_id,vehilce_type:o==null?void 0:o.segment,chassis_no:o==null?void 0:o.chassis_no,engine_no:o==null?void 0:o.engine_no,workShop:o==null?void 0:o.workshop,registration_id:o==null?void 0:o.registration_id,sell_date:o==null?void 0:o.sell_date,customer_name:o==null?void 0:o.customer_name,vehicle_model:(R=o==null?void 0:o.vehicle_model)==null?void 0:R.name,user:o==null?void 0:o.user,vehicle_group:o==null?void 0:o.vehicle_group}});B(L),t(ms(L))}catch(c){console.error("Error fetching vehicle data:",c),W.error("Error fetching vehicle data")}},b=c=>{var o,S;const L=(S=(o=c==null?void 0:c.imei)==null?void 0:o[0])==null?void 0:S.device_typ;T(L),t(_s({imei:c.value,reg_id:c.label})),t(Cs(c)),A(!1),C(!1)},P=()=>$==="RetroFotax"?e.jsxs(e.Fragment,{children:[v&&e.jsx(Me,{}),p&&e.jsx(Me,{}),s&&e.jsx(yr,{}),r&&e.jsx(ur,{}),d&&e.jsx(_r,{}),l&&e.jsx(xr,{}),g&&e.jsx(Me,{}),j&&e.jsx(hr,{}),I&&e.jsx(Cr,{})]}):$==="Sinocastel"?e.jsxs(e.Fragment,{children:[s&&e.jsx(Ss,{}),r&&e.jsx(ks,{}),l&&e.jsx(vs,{})]}):e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",color:"grey",height:"90%"},children:e.jsx("h1",{children:!Object.keys(n).length>0?"Please select a vehicle.":"Diagnostic not available for this device"})});return e.jsxs("div",{className:"app",children:[e.jsx(bs,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(sr,{title:"Diagnostics",setShowVehicles:A,showParams:E,setShowParams:C,showVehicles:y}),e.jsxs(a,{sx:{display:"flex",background:"#F5F5F5"},children:[e.jsx(a,{sx:{width:"80%",background:h.grey[100]},children:P()}),e.jsxs(a,{sx:{width:"20%",backgroundColor:h.grey[100],height:"90vh"},children:[y&&e.jsx(rr,{vehicleData:_.filter(c=>{var L;return jr.includes((L=c==null?void 0:c.imei[0])==null?void 0:L.device_typ)}),handleChange:b}),!y&&!E&&e.jsx(or,{options:ys.filter(c=>c.allowedDevice.includes($)),handleChange:()=>{},dota:!0,trip:!0}),E&&e.jsx(ar,{deviceType:$})]})]})]})]})};export{Er as default};
