import{j as e,t as ne,B as le,k as D,r as c,T as ue,i as je,Q as Ie,w as ae,v as ye,W as he,K as Ce,L as Ee,N as Me,O as Ne,X as pe}from"./index-B3alm5GP.js";import{L as We}from"./LiveMapTopBar-4b-uxov0.js";import{V as Ae}from"./VehicleMenu-CFmYKPq-.js";import{u as De,G as Le,M as ge,m as xe,f as Ve,I as Oe}from"./motorbike-CTNfRL_z.js";import Pe from"./Loader-CN88HWLg.js";import{L as $e}from"./LiveMapServices-BwfT2lDF.js";import{s as ie}from"./Socket-0N_gnJcr.js";import{t as Fe}from"./preet_tractor-Cgp22Ik3.js";import{B as j,C as fe}from"./menu2-IAYz1CFa.js";import{d as Re}from"./Info-B3-GPVdb.js";import{d as ze}from"./Close-lUnS0cEM.js";import{T as Ge,a as Be,b as A}from"./TableRow-B1l2tWxA.js";import{T as g}from"./TableCell-DohhKR1L.js";import{P as Ue}from"./Parameters-h6rLO58p.js";import{L as Je,t as Ke}from"./LeftSideBar2-rzVuKZ7-.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as Xe}from"./VehicleGroups-CdAMyjE-.js";import"./jcb-aCHXMCXy.js";import"./index-rT5ZlMsh.js";import"./index-wkKsYFRL.js";import"./createSvgIcon-B5_DZRSO.js";import"./useControlled-7QPAGrRz.js";import"./Card-D5Fo1W2h.js";import"./Skeleton-ChJqT2HQ.js";import"./CardContent-CkCpDCBK.js";const He="/assets/3W_liveMap-sJCozxTr.png";function Qe({activeParams:i}){return e.jsx(j,{sx:{bgcolor:ne.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",justifyContent:"space-around",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white"},children:i&&i[0].params.length>0?e.jsxs(e.Fragment,{children:[i[0].params.length>0&&e.jsxs(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:["Registration Id : ",i[0].reg_id]}),i.length>0&&i[0].params.map((a,m)=>{a.label==="maininputvoltage"&&console.log("item.label",a.label,a);const p=i[0].params.find(L=>L.label==="ignition"),o=p&&(p.value===!0||p.value===1)?a.value:0,M=a.label==="mainInputVoltage"||a.label==="maininputvoltage";return e.jsx(le,{variant:"outlined",sx:{color:"black",border:"1px solid white",mx:"5px",my:"15px",fontSize:"12px",background:"white","&:hover":{border:"1px solid white",background:"transparent",color:"white"}},children:a.label==="speed"?`${a.label} : ${o} km/h`:M&&a.value!==void 0?`${a.label} : ${a.value} voltage`:a.label==="ignition"?`${a.label} : ${a.value===!0||(a==null?void 0:a.value)===1?"On":"Off"}`:`${a.label} : ${a.value!==void 0?a.value:""}`},m)})]}):e.jsx(e.Fragment,{children:e.jsx(le,{variant:"outlined",sx:{color:"white",border:"1px solid white",mx:"5px",my:"15px"},children:"No Parameters Selected"})})})}const qe=({label:i,value:a})=>e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[e.jsx(ue,{variant:"body2",color:"textSecondary",children:i}),e.jsx(ue,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:a||"N/A"})]}),Ye=(i,a)=>(i==null?void 0:i.find(m=>{var p,o;return((o=(p=m.imei)==null?void 0:p[0])==null?void 0:o.mac_id)===a.imei}))||{},be=({title:i,details:a})=>e.jsx(j,{sx:{width:"45%"},children:a.map(({label:m,value:p})=>e.jsx(qe,{label:m,value:p},m))});function Ze({handleVehicleInfo:i}){var S,z,_,k,V,I;const{collapsed:a}=D(N=>N.auth),{vehicleList:m,selectedVehicle:p}=D(N=>N.liveMap),[o,M]=c.useState({});c.useEffect(()=>{M(Ye(m,p))},[m,p]);const L=[{label:"Vehicle No:",value:o==null?void 0:o.registration_id},{label:"Model:",value:(S=o==null?void 0:o.vehicle_model)==null?void 0:S.name},{label:"IMEI No:",value:(_=(z=o==null?void 0:o.imei)==null?void 0:z[0])==null?void 0:_.mac_id},{label:"Chassis No:",value:o==null?void 0:o.chassis_no},{label:"Engine No:",value:o==null?void 0:o.engine_no}],h=[{label:"Customer Name:",value:(k=o==null?void 0:o.user)!=null&&k.us_user?`${o.user.us_user.first_name.charAt(0).toUpperCase()}${o.user.us_user.first_name.slice(1)} ${o.user.us_user.last_name.charAt(0).toUpperCase()}${o.user.us_user.last_name.slice(1)}`:null},{label:"Mobile: ",value:((V=o==null?void 0:o.user)==null?void 0:V.us_user)&&o.user.us_user.mobile},{label:"Date of Sell:",value:o==null?void 0:o.sell_date},{label:"Workshop Name:",value:(I=o==null?void 0:o.workshop)==null?void 0:I.name}];return e.jsxs(j,{sx:{position:"absolute",top:"600px",left:a?"280px":"450px",zIndex:1,background:ne.bgShadow,p:2,borderRadius:2,color:"white",width:"60%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(ue,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),e.jsx(ze,{sx:{cursor:"pointer",color:"black"},onClick:i})]}),e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(be,{title:"Vehicle Details",details:L}),e.jsx(be,{title:"Customer Details",details:h})]})]})}const Te="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function es({showCard:i,loadingVehicle:a}){const{center:m,selectedParameterList:p,selectedVehicle:o,vehicleList:M,icons:L,locationData:h,placesData:S,imeiNumbers:z,onlineVehicle:_,loading:k,services_loading:V}=D(s=>s.liveMap),{mode:I,styles:N,vehicles_details:x}=D(s=>s.dashboard),{collapsed:G}=D(s=>s.auth),[Q,re]=c.useState(null),[B,U]=c.useState(""),[J,K]=c.useState([]),[y,q]=c.useState([]),[C,X]=c.useState(),[u,d]=c.useState(),[w,E]=c.useState(null),[F,l]=c.useState(""),[t,v]=c.useState(),[W,f]=c.useState(!1),O=je(),{isLoaded:ce,loadError:me}=De({googleMapsApiKey:`${Te}`,loadingElement:e.jsx(Pe,{})});c.useEffect(()=>{ce&&re(window.google.maps)},[ce]),c.useEffect(()=>{if(console.log("locationData",h),Object.keys(o).length>0){console.log("selectedVehicle",o==null?void 0:o.imei);const s=h==null?void 0:h.filter(r=>{var n;return((n=r==null?void 0:r.latestDocument)==null?void 0:n.imei)==(o==null?void 0:o.imei)});console.log("filteredVehicle",s),X(s)}else X(h)},[h,o]),c.useEffect(()=>{d(p)},[p]),c.useEffect(()=>(ie.on("locationinfo",s=>{if(console.log("locationinfo",s),C==null||C.map(r=>{if(r.latestDocument.imei===s.imei){const n={lat:r.latestDocument.lat,lng:r.latestDocument.lng},b=500,P=60,R=b/(1e3/P),Y=(s.lat-n.lat)/R,Z=(s.lng-n.lng)/R;let $=0;const T=setInterval(()=>{const ee=n.lat+Y*$,se=n.lng+Z*$,oe={...r,latestDocument:{...r.latestDocument,lat:ee,lng:se}};$++,$>=R&&clearInterval(T),X(te=>te.map(H=>H.latestDocument.imei===s.imei?oe:H))},1e3/P)}return r}),String(s==null?void 0:s.imei)===String(u[0].imei)){const r=u[0].params.map(n=>{let b=n.label;return{...n,value:s[b]}});d([{...u[0],params:r}])}}),()=>{ie.off("locationinfo")}),[ie,C,u]),c.useEffect(()=>{O(Ie({})),f(!0)},[o]),c.useEffect(()=>{if((h==null?void 0:h.length)>0&&_.length>0){const s=[],r=[];h==null||h.forEach(n=>{_.some(P=>String(P)===String(n._id))?s.push(n):r.push(n)}),K(s),q(r)}else K([]),q([])},[h,_]),c.useEffect(()=>{console.log("onVehicles",J),console.log("offVehicles",y)},[J]);const we=(s,r)=>{r&&l(r.latestDocument.imei),E(w===s?null:s)},_e=s=>{if(console.log("reg id ",s),s){const r=M.filter(n=>{var b;return n.imei&&((b=n.imei[0])==null?void 0:b.mac_id)===s});return r&&r.length>0?r[0].registration_id:"IMEI doesn't exist."}else return"IMEI doesn't exist."},ve=s=>{const r=x&&(x==null?void 0:x.length)>0&&x.find(n=>(n==null?void 0:n.value)===s&&(n==null?void 0:n.vehilce_type));return r?r.vehilce_type:null},Se=s=>{const r=x&&(x==null?void 0:x.length)>0&&x.find(n=>(n==null?void 0:n.value)===s&&n);v(r||null)},de=()=>{Object.keys(o).length>0||W?f(!W):ae.error("Please select any vehicle")};if(me)return"Error loading maps";if(!ce)return"Loading maps";if(!Q)return null;const ke={height:i?"85vh":"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return e.jsxs(e.Fragment,{children:[i&&e.jsx(Qe,{activeParams:u}),e.jsx(j,{sx:{position:"absolute",top:"780px",left:G?"74px":"250px",zIndex:1,background:ne.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:e.jsxs(le,{sx:{color:"white"},onClick:de,children:[W?"Hide":"Show"," Vehicle Info",e.jsx(Re,{})]})}),W===!0&&e.jsx(Ze,{handleVehicleInfo:de}),e.jsxs(Le,{mapContainerStyle:ke,zoom:Object.keys(o).length>0?15:5.8,center:m,options:{styles:I?N:""},children:[Object.keys(o).length>0&&e.jsx($e,{setPlace:U,place:B}),V||a?e.jsx(j,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(fe,{})}):S&&S.length>0&&S.map((s,r)=>{var n,b;return e.jsx(ge,{position:{lat:parseFloat((n=s==null?void 0:s.location)==null?void 0:n.lat),lng:parseFloat((b=s==null?void 0:s.location)==null?void 0:b.lng)},animation:window.google.maps.Animation.DROP,icon:{path:L[`${B}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},r)}),k||a?e.jsx(j,{sx:{position:"absolute",top:"50%",left:"50%"},children:e.jsx(fe,{})}):C&&C.length>0&&C.map((s,r)=>{var b,P,R,Y,Z,$,T,ee,se,oe,te;const n=ve(s.latestDocument.imei);return e.jsx(ge,{position:{lat:s.latestDocument.lat,lng:s.latestDocument.lng},animation:window.google.maps.Animation.DROP,icon:{url:(()=>{switch(n){case"2W":return xe;case"3W":return He;case"4W":return Ve;case"Tractor":return Fe;default:return xe}})(),fillColor:Object.keys(o).length>0&&o.imei===s.latestDocument.imei?"green":ne.bgColor,fillOpacity:2,strokeWeight:1,scale:2.5,rotation:(b=s==null?void 0:s.latestDocument)==null?void 0:b.heading,size:new window.google.maps.Size(70,70),scaledSize:new window.google.maps.Size(70,70)},onClick:()=>{var H;we((H=s==null?void 0:s.latestDocument)==null?void 0:H._id,s),Se(s==null?void 0:s.latestDocument.imei)},children:w===((P=s==null?void 0:s.latestDocument)==null?void 0:P._id)&&e.jsx(Oe,{position:{lat:parseFloat((R=s==null?void 0:s.latestDocument)==null?void 0:R.lat),lng:parseFloat((Y=s==null?void 0:s.latestDocument)==null?void 0:Y.lng)},onCloseClick:()=>E(null),options:{maxWidth:"100%"},visible:w===s.id,children:e.jsx(e.Fragment,{children:e.jsx(Ge,{children:e.jsxs(Be,{children:[e.jsxs(A,{children:[e.jsx(g,{sx:{fontWeight:"bold"},children:"Vehicle No:"}),e.jsx(g,{children:_e((Z=s==null?void 0:s.latestDocument)==null?void 0:Z.imei)})]}),e.jsxs(A,{children:[e.jsx(g,{sx:{fontWeight:"bold"},children:"Vehicle Model:"}),e.jsx(g,{children:t!=null&&t.vehicle_model?t==null?void 0:t.vehicle_model:"NA"})]}),e.jsxs(A,{children:[e.jsx(g,{sx:{fontWeight:"bold"},children:"IMEI No:"}),e.jsx(g,{children:($=s==null?void 0:s.latestDocument)==null?void 0:$.imei})]}),e.jsxs(A,{children:[e.jsx(g,{sx:{fontWeight:"bold"},children:"Chassis No:"}),e.jsx(g,{children:t!=null&&t.chassis_no?t==null?void 0:t.chassis_no:"NA"})]}),e.jsxs(A,{children:[e.jsx(g,{sx:{fontWeight:"bold"},children:"Engine No:"}),e.jsx(g,{children:t!=null&&t.engine_no?t==null?void 0:t.engine_no:"NA"})]}),e.jsxs(A,{children:[e.jsx(g,{sx:{fontWeight:"bold"},children:"Date of Sell:"}),e.jsx(g,{children:t!=null&&t.sell_date?t==null?void 0:t.sell_date:"NA"})]}),e.jsxs(A,{children:[e.jsx(g,{sx:{fontWeight:"bold"},children:"Workshop Name:"}),e.jsx(g,{children:(ee=(T=t==null?void 0:t.workShop)==null?void 0:T.city)!=null&&ee.name?`${(se=t==null?void 0:t.workShop)==null?void 0:se.name} (City: ${(te=(oe=t==null?void 0:t.workShop)==null?void 0:oe.city)==null?void 0:te.name})`:"NA"})]}),e.jsxs(A,{children:[e.jsx(g,{sx:{fontWeight:"bold"},children:"Customer Name:"}),e.jsx(g,{children:t!=null&&t.customer_name?t==null?void 0:t.customer_name:"NA"})]})]})})})},s.id)},r)})]})]})}function Cs(){const{locationData:i,selectedVehicle:a,selectedParameterList:m}=D(u=>u.liveMap),{mode:p,selectedVehicleGroup:o}=D(u=>u.dashboard),M=Ke(p),[L,h]=c.useState([]),{w_customer_id:S}=D(u=>u.auth),[z,_]=c.useState(),[k,V]=c.useState(!1),[I,N]=c.useState(!1),[x,G]=c.useState([]),[Q,re]=c.useState(!0),[B,U]=c.useState(!1),[J,K]=c.useState(!1);let y=je();c.useEffect(()=>{q()},[]),c.useEffect(()=>{var u;if(Object.keys(a).length>0){const d=(i==null?void 0:i.length)>0&&(i==null?void 0:i.filter(l=>Number(l.latestDocument.imei)===Number(a==null?void 0:a.imei)));if((d==null?void 0:d.length)<=0)return ae.error("Data not available for this vehicle",{id:"clipboard"});const{lat:w,lng:E}=((u=d==null?void 0:d[0])==null?void 0:u.latestDocument)??{},F={lat:w||pe.lat,lng:E||pe.lat};y(ye(F))}},[a,i]),c.useEffect(()=>{G([]),y(he([{reg_id:"",imei:"",params:[]}]))},[a]);const q=async()=>{try{U(!0);let u=[],d=[];const w=await y(Ce({w_customer_id:S}));if(Array.isArray(w.payload)){w.payload.forEach(l=>{var t,v,W,f;Array.isArray(l.imei)&&l.imei.length>0&&((t=l.imei[0])!=null&&t.mac_id)?(u.push({id:l.id,label:l.registration_id,value:(v=l.imei[0])==null?void 0:v.mac_id,vehilce_type:l==null?void 0:l.segment,chassis_no:l==null?void 0:l.chassis_no,engine_no:l==null?void 0:l.engine_no,workShop:l==null?void 0:l.workshop,registration_id:l==null?void 0:l.registration_id,sell_date:l==null?void 0:l.sell_date,customer_name:l==null?void 0:l.customer_name,vehicle_model:(W=l==null?void 0:l.vehicle_model)==null?void 0:W.name,vehicle_group:l==null?void 0:l.vehicle_group}),d.push((f=l.imei[0])==null?void 0:f.mac_id)):console.error("IMEI data not found for item:",l)});const E="one",F=d;d.length>0&&y(Ee({type:E,imei:F})),h(u),y(Me(u)),y(Ne({w_customer_id:S})),U(!1)}else U(!1),console.error("Unexpected data format:",w),ae.error("Unexpected data format:")}catch(u){console.error("Error fetching vehicle data:",u),ae.error(`Error fetching vehicle data: ${u}`)}},C=async u=>{const{label:d,imei:w,id:E,reg_id:F,checked:l}=u;_(f=>f.map(O=>O.id===E?{...O,checked:!l}:O));let t=[...x],v=[...x];if(!l)i.forEach(f=>{f.latestDocument.imei===w&&(t.push({label:d,value:f.latestDocument[d==="maininputvoltage"?"mainInputVoltage":d]}),v=t,G(t))});else{let f=x.filter(O=>O.label!==d);v=f,G(f)}console.log("tempParamList",v),y(he([{reg_id:F,imei:w,params:v}]))},X=L.filter(u=>Object.keys(o).length===0||u.vehicle_group===o.id);return e.jsxs("div",{className:"app",children:[e.jsx(Je,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(We,{title:"Live Map",setShowVehicles:V,showVehicles:k,showParameters:I,setShowParameters:N,setShowCard:re,showCard:Q,setShowVehiclesGroup:K,showVehiclesGroup:J}),e.jsx(Xe,{setShowVehiclesGroup:K,showVehiclesGroup:J,where:"livemap"}),e.jsxs(j,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(j,{style:{width:k||I?"80%":"100%"},children:e.jsx(es,{showCard:Q,loadingVehicle:B})}),k&&e.jsx(j,{style:{width:"20%",backgroundColor:M.grey[100]},children:e.jsx(Ae,{vehicleData:X,title:"Live Map",setParameterData:_,loadingVehicle:B,setShowVehicles:V,showVehicles:k,showParameters:I,setShowParameters:N})}),I&&e.jsx(j,{style:{width:"20%",backgroundColor:M.grey[100]},children:e.jsx(Ue,{parametersData:z,setParameterData:_,handleParameterChange:C})})]})]})]})}export{Cs as default};
