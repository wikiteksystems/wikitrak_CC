import{l as Se,o as De,p as ve,_ as ne,b as o,q as we,f as be,j as t,g as Ce,k as Me,y as ie,z as k,a8 as ee,a9 as he,a2 as xe,aa as Te,ab as ke,ac as Z,ad as E,T as v,F as $,ae as oe,af as Ae,ag as _e,ah as ge,C as te,ai as fe,P as Ye,S as Ie,U as Ne,X as Le}from"./index-Cm3TetZZ.js";import{L as Oe}from"./LeftSideBar2-_NcKMwCh.js";import{L as Ee}from"./LiveMapTopBar-DF19Fobo.js";import{V as Re}from"./VehicleMenu-Cmq3yyTu.js";import{T as Pe}from"./TripMap-GXeOyyL_.js";import{d as T}from"./dayjs.min-BGoLabUx.js";import{t as ce}from"./SearchTab-B6jigRdK.js";import{S as Ve,D as Be}from"./index-BZBh4L8k.js";import{r as me}from"./createSvgIcon-DdjE7s24.js";import{B as h,C as Fe}from"./CircularProgress-CX5t5bs6.js";import{M as $e}from"./menu2-BA1CnYPQ.js";import{C as qe}from"./Card-BDTG27Y0.js";import{C as Ue}from"./CardContent-zpnSx9JD.js";import"./TripGraph-DMokBRPd.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as Ge}from"./VehicleGroups-DCBGwUMv.js";import"./useControlled-CcfdhTro.js";import"./Close-BiPtvRKn.js";import"./jcb-aCHXMCXy.js";import"./TextField-C9hlb02R.js";import"./Autocomplete-DosKDSgA.js";import"./esm-DkzzYfhg.js";import"./redTractor-NXgVJyvR.js";import"./Info-Cd0Mmvk0.js";function ze(a){return Se("MuiCardActions",a)}De("MuiCardActions",["root","spacing"]);const He=["disableSpacing","className"],We=a=>{const{classes:c,disableSpacing:y}=a;return Me({root:["root",!y&&"spacing"]},ze,c)},Xe=ve("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(a,c)=>{const{ownerState:y}=a;return[c.root,!y.disableSpacing&&c.spacing]}})(({ownerState:a})=>ne({display:"flex",alignItems:"center",padding:8},!a.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Je=o.forwardRef(function(c,y){const S=we({props:c,name:"MuiCardActions"}),{disableSpacing:f=!1,className:m}=S,_=be(S,He),p=ne({},S,{disableSpacing:f}),x=We(p);return t.jsx(Xe,ne({className:Ce(x.root,m),ownerState:p,ref:y},_))}),Ke=Je,{RangePicker:Qe}=Be,Ze=()=>{const a=ie(),{selectedVehicle:c}=k(g=>g.liveMap),{selectedTripData:y,mode:S}=k(g=>g.dashboard),[f,m]=o.useState(),[_,p]=o.useState(),x=ce(S);o.useEffect(()=>{const g=T().subtract(5,"day");if(m(g),p(T()),c!=null&&c.imei){let l={imei:c==null?void 0:c.imei,startDate:T().subtract(5,"day").startOf("day").toISOString(),endDate:T().endOf("day").toISOString(),page:1,limit:20};a(ee(l)),a(he(l))}},[c]);const i=(g,l)=>{if(g){const Y=T(l[0]).startOf("day"),R=T(l[1]).endOf("day");let M={imei:c==null?void 0:c.imei,startDate:Y.format(),endDate:R.format(),page:1,limit:20};m(T(l[0])),p(T(l[1])),a(ee(M)),a(he(M))}else console.log("Clear date")};return t.jsx(Ve,{direction:"vertical",size:12,children:t.jsx(Qe,{value:[f,_],onChange:(g,l)=>{i(g,l)},style:{backgroundColor:x.grey[500],color:x.grey[400]}})})};var le={},et=xe;Object.defineProperty(le,"__esModule",{value:!0});var je=le.default=void 0,tt=et(me()),st=t;je=le.default=(0,tt.default)((0,st.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var de={},at=xe;Object.defineProperty(de,"__esModule",{value:!0});var ye=de.default=void 0,rt=at(me()),ot=t;ye=de.default=(0,rt.default)((0,ot.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const nt=()=>{var n,D,L,O;const a=ie(),{tripList:c,selectedTripData:y,loading:S,trips:f,activeIndex:m,searchText:_,mode:p,isNavigate:x,allTripList:i,trip_payload:g,page:l,total_page:Y,total_trips:R}=k(e=>e.dashboard),{selectedVehicle:M}=k(e=>e.liveMap),b=ce(p),[q,U]=o.useState(!1),[d,G]=o.useState({}),[C,z]=o.useState(""),[I,H]=o.useState(null);o.useEffect(()=>{(f==null?void 0:f.length)>0},[f]),o.useEffect(()=>{const e=pe(i);a(Te(e))},[i]),o.useEffect(()=>{!(y.length>0)&&x&&m!==null&&w.length>0&&se(w[m])},[y,x]);const se=async e=>{var j;let r={imei:M.imei,startDate:e.startDate,endDate:e.endDate};const u=await ke(r);((j=u==null?void 0:u.data)==null?void 0:j.documents.length)>0?(a(x(!1)),a(Z(u.data.documents[0].data))):(a(x(!1)),a(Z([])))},pe=e=>{const r=new Set,u=[];return e.forEach(j=>{const A=E(j.startTime).format("YYYY-MM-DD");r.has(A)||(r.add(A),u.push(A))}),u},W=(e,r)=>{a(oe(null)),a(Ae(e)),a(_e(!1)),C===e?(z(""),H(null)):(z(e),H(r))},w=C===""?i:i.filter(e=>E(e.startTime).format("YYYY-MM-DD")===C),X=async(e,r)=>{a(Z(r.data)),a(oe(e)),a(ge(0))},N=e=>{G(e),U(!0)},J=()=>{U(!1),G({})},K=e=>e?e.split(" ").slice(0,2).join(" "):"",ae=async()=>{const e={...g,page:l+1,limit:20};try{(await a(ee(e))).error?te.error("No Trip! within selected date"):a(fe(l+1))}catch{te.error("No Trip! within selected date")}},re=()=>{if(l<=1)return;const e={...g,page:l-1,limit:20};a(fe(l-1)),a(ee(e))},s=e=>{a(Z([])),a(oe("all")),a(ge(0))};return t.jsxs(t.Fragment,{children:[t.jsxs(h,{children:[t.jsxs(h,{sx:{m:"10px"},children:[t.jsx(h,{sx:{color:b.grey[400]},children:"Select Date"}),t.jsx(h,{sx:{mt:1},children:t.jsx(Ze,{})})]}),S?t.jsx("div",{style:{width:"100%",margin:"38%"},children:t.jsx(Fe,{})}):t.jsxs(t.Fragment,{children:[t.jsx(h,{children:t.jsx(h,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:i&&(i==null?void 0:i.length)>0?t.jsx(t.Fragment,{}):t.jsx(v,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),i&&(i==null?void 0:i.length)>0&&t.jsxs(h,{ml:2,display:"flex",gap:1,children:[t.jsxs(v,{children:["Total trips:",R]})," |",t.jsxs(v,{children:["Current page:",l]})," |",t.jsxs(v,{children:["Total page:",Y]}),"|"]}),i&&(i==null?void 0:i.length)>0&&t.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:"5px"},children:[t.jsx($,{disabled:l<=1,onClick:re,children:t.jsx(je,{})}),t.jsx($,{disabled:Y===l,onClick:ae,children:t.jsx(ye,{})})]}),t.jsxs(h,{sx:{height:"75vh",width:"100%",overflowY:"auto"},children:[t.jsx(h,{display:"flex",gap:1,marginLeft:2,children:f.map((e,r)=>t.jsx(h,{children:t.jsx($,{onClick:()=>{W(e,r)},style:{backgroundColor:I===r?b.grey[300]:b.grey[200],color:I===r?"black":b.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:e})},r))}),w&&w.length>0&&t.jsx($,{variant:m==="all"?"contained":"outlined",sx:{width:"90%",mx:"20px",mt:"10px"},onClick:()=>{s()},children:"Select All trips"}),"              ",w&&w.length>0&&w.map((e,r)=>{var P,V,B,F;const u=(V=(P=e==null?void 0:e.startLocation)==null?void 0:P.address)==null?void 0:V.address,j=(F=(B=e==null?void 0:e.endLocation)==null?void 0:B.address)==null?void 0:F.address,A=u?`${u.town||u.city||""}`:"",ue=j?`${j.town||j.city||""}`:"";return t.jsxs(h,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:m===r?"black":b.grey[400],backgroundColor:m===r?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:p?b.grey[300]:b.grey[200]}},onClick:()=>X(r,e),children:[t.jsxs(v,{sx:{cursor:"text"},children:[r+1,". ",K(A)," to"," ",K(ue)," "]}),t.jsxs(v,{children:[e!=null&&e.startTime?E(new Date(e.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",e!=null&&e.endTime?E(new Date(e.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",t.jsx("span",{style:{color:p?"orange":"blue",cursor:"pointer"},onClick:Q=>{Q.stopPropagation(),N(e)},children:"...see more"})]})]},r)})]})]})]}),t.jsx($e,{open:q,onClose:J,children:t.jsxs(qe,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[t.jsxs(Ue,{children:[t.jsx(v,{variant:"h6",component:"div",children:"Trip Details"}),t.jsxs(v,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Location:"})," ",((D=(n=d==null?void 0:d.startLocation)==null?void 0:n.address)==null?void 0:D.display_name)||"N/A"]}),t.jsxs(v,{sx:{mt:2},children:[t.jsx("strong",{children:"End Location:"})," ",((O=(L=d==null?void 0:d.endLocation)==null?void 0:L.address)==null?void 0:O.display_name)||"N/A"]}),t.jsxs(v,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Time:"})," ",d!=null&&d.startTime?E(new Date(d.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),t.jsxs(v,{sx:{mt:2},children:[t.jsx("strong",{children:"End Time:"})," ",d!=null&&d.endTime?E(new Date(d.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),t.jsx(Ke,{children:t.jsx($,{onClick:J,children:"Close"})})]})})]})},it=nt;function Nt(){const{w_customer_id:a}=k(s=>s.auth),{collapsed:c}=k(s=>s.auth),{mode:y,selectedVehicleGroup:S}=k(s=>s.dashboard),{vehicleList:f,selectedVehicle:m,onlineVehicle:_,locationData:p}=k(s=>s.liveMap),[x,i]=o.useState(!1),[g,l]=o.useState(!0),[Y,R]=o.useState([]),[M,b]=o.useState(!1),[q,U]=o.useState(""),[d,G]=o.useState(""),[C,z]=o.useState(""),[I,H]=o.useState("");o.useState([]);const[se,pe]=o.useState({lat:18.516726,lng:73.856255});o.useState([]);const[W,w]=o.useState(!1),X=ce(y);let N=ie();o.useEffect(()=>{J()},[]),o.useEffect(()=>{var s,n,D;Object.keys(m).length===0&&f.length>0&&N(Ye({imei:(n=(s=f[0])==null?void 0:s.imei[0])==null?void 0:n.mac_id,reg_id:(D=f[0])==null?void 0:D.registration_id}))},[m,f]);const J=async()=>{try{let s=[],n=[];const D=await N(Ie({w_customer_id:a}));if(Array.isArray(D.payload)){D.payload.forEach(e=>{var r,u,j;Array.isArray(e.imei)&&e.imei.length>0&&((r=e.imei[0])!=null&&r.mac_id)?(s.push({id:e.id,label:e.registration_id,value:(u=e.imei[0])==null?void 0:u.mac_id,workShop:e==null?void 0:e.workshop,vehicle_group:e==null?void 0:e.vehicle_group}),n.push((j=e.imei[0])==null?void 0:j.mac_id)):console.error("IMEI data not found for item:",e)});const L="one",O=n;n.length>0&&N(Ne({type:L,imei:O})),N(Le({w_customer_id:a})),R(s)}else console.error("Unexpected data format:",D),te.error("Unexpected data format:")}catch(s){console.error("Error fetching vehicle data:",s),te.error(`Error fetching vehicle data: ${s}`)}},K=s=>p==null?void 0:p.some(n=>Number(n.latestDocument.imei)===Number(s)&&n.latestDocument.speed>0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),ae=s=>p==null?void 0:p.some(n=>Number(n.latestDocument.imei)===Number(s)&&n.latestDocument.speed<=0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),re=Y.filter(s=>{var P,V,B,F,Q;if(!(Object.keys(S).length===0||s.vehicle_group===S.id))return!1;const D=(P=s==null?void 0:s.label)==null?void 0:P.toLowerCase().includes(q.toLowerCase()),L=I===""||((V=s==null?void 0:s.workShop)==null?void 0:V.region)===I,O=C===""||((F=(B=s==null?void 0:s.workShop)==null?void 0:B.state)==null?void 0:F.toLowerCase())===(((Q=C==null?void 0:C.toString())==null?void 0:Q.toLowerCase())||""),e=Number(s.value),r=_.includes(e),u=!r,j=r&&K(e),A=r&&ae(e);return D&&L&&O&&(d==="online"?r:d==="offline"?u:d==="running"?j:d==="idling"?A:!0)}).sort((s,n)=>s.label.localeCompare(n.label));return t.jsxs("div",{className:"app",children:[t.jsx(Oe,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(Ee,{title:"Trip Monitor",setShowVehicles:i,showVehicles:x,setShowCard:l,showCard:g,sideBarTrip:M,setSideBarTrip:b,setShowVehiclesGroup:w,showVehiclesGroup:W}),t.jsx(Ge,{setShowVehiclesGroup:w,showVehiclesGroup:W,where:"tripmonitor"}),t.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(h,{style:{width:x||M?"80%":"100%"},children:t.jsx(Pe,{center:se,showCard:g})}),x&&t.jsx(h,{style:{width:"20%",backgroundColor:X.grey[100]},children:t.jsx(Re,{vehicleData:re,setShowVehicles:i,showVehicles:x,title:"Live Monitor",setSearchedTerm:U,setOptions:G,setState:z,setRegion:H,searchTerm:q,options:d,state:C,region:I})}),t.jsx(h,{style:{width:c?"22%":"20%",display:M?"block":"none",backgroundColor:X.grey[100]},children:t.jsx(it,{})})]})]})]})}export{Nt as default};
