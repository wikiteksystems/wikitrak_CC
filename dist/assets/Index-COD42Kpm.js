import{l as ye,o as Se,p as De,_ as re,b as n,q as ve,f as we,j as e,g as be,k as Ce,x as oe,y as T,ab as X,ac as ue,a6 as fe,ad as Me,ae as Te,af as ae,ag as N,B as W,T as C,ah as he,ai as ke,aj as Ae,ak as _e,J,al as ge,C as Ye,X as Le,Y as Ie,a0 as Ne}from"./index-Bck7KLgI.js";import{L as Ee}from"./LeftSideBar2-D-Hyb8kx.js";import{L as Oe}from"./LiveMapTopBar-13HYmBTH.js";import{V as Re}from"./VehicleMenu-BBs8xABB.js";import{T as Pe}from"./TripMap-B1RorJ72.js";import{d as M}from"./dayjs.min-teYIrQML.js";import{t as ne}from"./SearchTab-BW_NrN2P.js";import{S as Be,D as Ve}from"./index-B7YbinbB.js";import{r as xe}from"./createSvgIcon-tZVvrbBK.js";import{B as x,C as $e,M as qe}from"./menu2-CvOBfRqv.js";import{C as Fe}from"./Card-B9Nyn6rq.js";import{C as Ge}from"./CardContent-BuUj102_.js";import"./TripVehicleInfo-DDZXwLvD.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as Ue}from"./VehicleGroups-CbbUNAxU.js";import"./useControlled-BpYd-qH_.js";import"./Close-DfZLPeh2.js";import"./jcb-aCHXMCXy.js";import"./index-D1lApqp7.js";import"./TextField-CbEgZzn0.js";import"./Autocomplete-Bcai9UYY.js";import"./esm-C4M5L3kh.js";import"./preet_tractor-CDwt_mVh.js";import"./Info-DqqAM-ZD.js";function ze(a){return ye("MuiCardActions",a)}Se("MuiCardActions",["root","spacing"]);const He=["disableSpacing","className"],We=a=>{const{classes:c,disableSpacing:S}=a;return Ce({root:["root",!S&&"spacing"]},ze,c)},Xe=De("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(a,c)=>{const{ownerState:S}=a;return[c.root,!S.disableSpacing&&c.spacing]}})(({ownerState:a})=>re({display:"flex",alignItems:"center",padding:8},!a.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Je=n.forwardRef(function(c,S){const D=ve({props:c,name:"MuiCardActions"}),{disableSpacing:u=!1,className:y}=D,Y=we(D,He),h=re({},D,{disableSpacing:u}),f=We(h);return e.jsx(Xe,re({className:be(f.root,y),ownerState:h,ref:S},Y))}),Ke=Je,{RangePicker:Qe}=Ve,Ze=()=>{const a=oe(),{selectedVehicle:c}=T(l=>l.liveMap),{selectedTripData:S,mode:D}=T(l=>l.dashboard),[u,y]=n.useState(),[Y,h]=n.useState(),f=ne(D);n.useEffect(()=>{const l=M().subtract(5,"day");if(y(l),h(M()),c!=null&&c.imei){let d={imei:c==null?void 0:c.imei,startDate:M().subtract(5,"day").startOf("day"),endDate:M().endOf("day"),page:1};a(X(d)),a(ue(d))}},[c]);const m=(l,d)=>{if(l){const E=M(d[0]).startOf("day"),v=M(d[1]).endOf("day");let w={imei:c==null?void 0:c.imei,startDate:E.format(),endDate:v.format(),page:1};y(M(d[0])),h(M(d[1])),a(X(w)),a(ue(w))}else console.log("Clear date")};return e.jsx(Be,{direction:"vertical",size:12,children:e.jsx(Qe,{value:[u,Y],onChange:(l,d)=>{m(l,d)},style:{backgroundColor:f.grey[500],color:f.grey[400]}})})};var ie={},et=fe;Object.defineProperty(ie,"__esModule",{value:!0});var me=ie.default=void 0,tt=et(xe()),st=e;me=ie.default=(0,tt.default)((0,st.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var ce={},at=fe;Object.defineProperty(ce,"__esModule",{value:!0});var je=ce.default=void 0,rt=at(xe()),ot=e;je=ce.default=(0,rt.default)((0,ot.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const nt=()=>{var G,U,s,i;const a=oe(),{tripList:c,selectedTripData:S,loading:D,trips:u,activeIndex:y,searchText:Y,mode:h,isNavigate:f,allTripList:m,trip_payload:l,page:d}=T(t=>t.dashboard),{selectedVehicle:E}=T(t=>t.liveMap),v=ne(h),[w,B]=n.useState(!1),[p,V]=n.useState({}),[k,$]=n.useState(""),[b,K]=n.useState(0);n.useEffect(()=>{console.log("trips",u),(u==null?void 0:u.length)>0&&$(u[0])},[u]),n.useEffect(()=>{console.log("allTripList",m);const t=Q(m);a(Me(t))},[m]),n.useEffect(()=>{!(S.length>0)&&f&&y!==null&&L.length>0&&O(L[y])},[S,f]);const O=async t=>{var r;let o={imei:E.imei,startDate:t.startDate,endDate:t.endDate};const g=await Te(o);((r=g==null?void 0:g.data)==null?void 0:r.documents.length)>0?(a(f(!1)),a(ae(g.data.documents[0].data))):(a(f(!1)),a(ae([])))},Q=t=>{const o=new Set,g=[];return t.forEach(r=>{const j=N(r.startTime).format("YYYY-MM-DD");o.has(j)||(o.add(j),g.push(j))}),g},Z=(t,o)=>{a(he(null)),a(ke(t)),a(Ae(!1)),$(t),K(o)},L=m.filter(t=>N(t.startTime).format("YYYY-MM-DD")===k),q=async(t,o)=>{a(ae(o.data)),a(he(t)),a(_e(0))},F=t=>{V(t),B(!0)},R=()=>{B(!1),V({})},A=t=>t?t.split(" ").slice(0,2).join(" "):"",ee=async()=>{const t={...l,page:d+1};try{(await a(X(t))).error?J.error("No Trip! within selected date"):a(ge(d+1))}catch{J.error("No Trip! within selected date")}},te=()=>{if(d<=1)return;const t={...l,page:d-1};a(ge(d-1)),a(X(t))};return e.jsxs(e.Fragment,{children:[e.jsxs(x,{children:[e.jsxs(x,{children:[e.jsx(x,{sx:{color:v.grey[400]},children:"Select Date"}),e.jsx(x,{sx:{mt:1},children:e.jsx(Ze,{})})]}),D?e.jsx("div",{style:{width:"100%",margin:"38%"},children:e.jsx($e,{})}):e.jsxs(e.Fragment,{children:[e.jsx(x,{children:e.jsx(x,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:m&&(m==null?void 0:m.length)>0?e.jsx(e.Fragment,{children:u.map((t,o)=>e.jsx(x,{children:e.jsx(W,{onClick:()=>{Z(t,o)},style:{backgroundColor:b===o?v.grey[300]:v.grey[200],color:b===o?"black":v.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:t})},o))}):e.jsx(C,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),e.jsxs(x,{sx:{height:"70vh",width:"100%",overflowY:"auto"},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(W,{disabled:d<=1,onClick:te,children:e.jsx(me,{})}),e.jsx(W,{disabled:!(l!=null&&l.imei),onClick:ee,children:e.jsx(je,{})})]}),L&&L.length>0&&L.map((t,o)=>{var _,z,se,P;const g=(z=(_=t==null?void 0:t.startLocation)==null?void 0:_.address)==null?void 0:z.address,r=(P=(se=t==null?void 0:t.endLocation)==null?void 0:se.address)==null?void 0:P.address,j=g?`${g.town||g.city||""}`:"",I=r?`${r.town||r.city||""}`:"";return e.jsxs(x,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:y===o?"black":v.grey[400],backgroundColor:y===o?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:h?v.grey[300]:v.grey[200]}},onClick:()=>q(o,t),children:[e.jsxs(C,{sx:{cursor:"text"},children:[o+1,". ",A(j)," to"," ",A(I)," "]}),e.jsxs(C,{children:[t!=null&&t.startTime?N(new Date(t.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",t!=null&&t.endTime?N(new Date(t.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",e.jsx("span",{style:{color:h?"orange":"blue",cursor:"pointer"},onClick:H=>{H.stopPropagation(),F(t)},children:"...see more"})]})]},o)})]})]})]}),e.jsx(qe,{open:w,onClose:R,children:e.jsxs(Fe,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[e.jsxs(Ge,{children:[e.jsx(C,{variant:"h6",component:"div",children:"Trip Details"}),e.jsxs(C,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Location:"})," ",((U=(G=p==null?void 0:p.startLocation)==null?void 0:G.address)==null?void 0:U.display_name)||"N/A"]}),e.jsxs(C,{sx:{mt:2},children:[e.jsx("strong",{children:"End Location:"})," ",((i=(s=p==null?void 0:p.endLocation)==null?void 0:s.address)==null?void 0:i.display_name)||"N/A"]}),e.jsxs(C,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Time:"})," ",p!=null&&p.startTime?N(new Date(p.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),e.jsxs(C,{sx:{mt:2},children:[e.jsx("strong",{children:"End Time:"})," ",p!=null&&p.endTime?N(new Date(p.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),e.jsx(Ke,{children:e.jsx(W,{onClick:R,children:"Close"})})]})})]})},it=nt;function It(){const{w_customer_id:a}=T(s=>s.auth),{collapsed:c}=T(s=>s.auth),{mode:S,selectedVehicleGroup:D}=T(s=>s.dashboard),{vehicleList:u,selectedVehicle:y,onlineVehicle:Y,locationData:h}=T(s=>s.liveMap),[f,m]=n.useState(!1),[l,d]=n.useState(!0),[E,v]=n.useState([]),[w,B]=n.useState(!1),[p,V]=n.useState(""),[k,$]=n.useState(""),[b,K]=n.useState(""),[O,Q]=n.useState("");n.useState([]);const[Z,L]=n.useState({lat:18.516726,lng:73.856255});n.useState([]);const[q,F]=n.useState(!1),R=ne(S);let A=oe();n.useEffect(()=>{ee()},[]),n.useEffect(()=>{var s,i,t;Object.keys(y).length===0&&u.length>0&&A(Ye({imei:(i=(s=u[0])==null?void 0:s.imei[0])==null?void 0:i.mac_id,reg_id:(t=u[0])==null?void 0:t.registration_id}))},[y,u]);const ee=async()=>{try{let s=[],i=[];const t=await A(Le({w_customer_id:a}));if(Array.isArray(t.payload)){t.payload.forEach(r=>{var j,I,_;Array.isArray(r.imei)&&r.imei.length>0&&((j=r.imei[0])!=null&&j.mac_id)?(s.push({id:r.id,label:r.registration_id,value:(I=r.imei[0])==null?void 0:I.mac_id,workShop:r==null?void 0:r.workshop,vehicle_group:r==null?void 0:r.vehicle_group}),i.push((_=r.imei[0])==null?void 0:_.mac_id)):console.error("IMEI data not found for item:",r)});const o="one",g=i;i.length>0&&A(Ie({type:o,imei:g})),A(Ne({w_customer_id:a})),v(s)}else console.error("Unexpected data format:",t),J.error("Unexpected data format:")}catch(s){console.error("Error fetching vehicle data:",s),J.error(`Error fetching vehicle data: ${s}`)}},te=s=>h==null?void 0:h.some(i=>Number(i.latestDocument.imei)===Number(s)&&i.latestDocument.speed>0&&(i.latestDocument.ignition===!0||i.latestDocument.ignition===1)),G=s=>h==null?void 0:h.some(i=>Number(i.latestDocument.imei)===Number(s)&&i.latestDocument.speed<=0&&(i.latestDocument.ignition===!0||i.latestDocument.ignition===1)),U=E.filter(s=>{var P,H,le,de,pe;if(!(Object.keys(D).length===0||s.vehicle_group===D.id))return!1;const t=(P=s==null?void 0:s.label)==null?void 0:P.toLowerCase().includes(p.toLowerCase()),o=O===""||((H=s==null?void 0:s.workShop)==null?void 0:H.region)===O,g=b===""||((de=(le=s==null?void 0:s.workShop)==null?void 0:le.state)==null?void 0:de.toLowerCase())===(((pe=b==null?void 0:b.toString())==null?void 0:pe.toLowerCase())||""),r=Number(s.value),j=Y.includes(r),I=!j,_=j&&te(r),z=j&&G(r);return t&&o&&g&&(k==="online"?j:k==="offline"?I:k==="running"?_:k==="idling"?z:!0)}).sort((s,i)=>s.label.localeCompare(i.label));return e.jsxs("div",{className:"app",children:[e.jsx(Ee,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Oe,{title:"Trip Monitor",setShowVehicles:m,showVehicles:f,setShowCard:d,showCard:l,sideBarTrip:w,setSideBarTrip:B,setShowVehiclesGroup:F,showVehiclesGroup:q}),e.jsx(Ue,{setShowVehiclesGroup:F,showVehiclesGroup:q,where:"tripmonitor"}),e.jsxs(x,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(x,{style:{width:f||w?"80%":"100%"},children:e.jsx(Pe,{center:Z,showCard:l})}),f&&e.jsx(x,{style:{width:"20%",backgroundColor:R.grey[100]},children:e.jsx(Re,{vehicleData:U,setShowVehicles:m,showVehicles:f,title:"Live Monitor",setSearchedTerm:V,setOptions:$,setState:K,setRegion:Q,searchTerm:p,options:k,state:b,region:O})}),e.jsx(x,{style:{width:c?"22%":"20%",display:w?"block":"none",backgroundColor:R.grey[100]},children:e.jsx(it,{})})]})]})]})}export{It as default};
