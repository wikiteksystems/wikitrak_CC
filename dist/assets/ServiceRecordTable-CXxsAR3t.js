import{a2 as ne,j as t,z as q,b as r,y as ie,O as G,I as W,an as ce,C as re}from"./index-D6gCoQny.js";import{r as oe}from"./createSvgIcon-BiVLJY2h.js";import{U as he,D as ue,m as H}from"./DateTimePicker-LKS8FU8s.js";import{D as xe,a as ge,b as pe}from"./DialogTitle-3zsGP3rR.js";import{d as N}from"./dayjs.min-O-B1-oBJ.js";import"./NewLoader-CNsXCyoV.js";import{B as D}from"./index-B6kpyBCP.js";import{B as ve}from"./CircularProgress-CnjjfMkT.js";import{T as _e,a as fe,b as je,c as $,d as a,e as be}from"./TableRow-Bl6oBJ_j.js";import{T as me}from"./TablePagination-DAN2vrLm.js";var R={},Ce=ne;Object.defineProperty(R,"__esModule",{value:!0});var E=R.default=void 0,De=Ce(oe()),Se=t;E=R.default=(0,De.default)((0,Se.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");function ye({open:x,setOpen:j,data:b,isInspection:g}){const T=()=>j(!1);return t.jsxs(xe,{open:x,onClose:T,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[t.jsx(ge,{children:"Update Information"}),t.jsx(pe,{dividers:!0,children:t.jsx(he,{setOpen:j,data:b,isInspection:g})})]})}const o={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};function Ue({where:x,isInspection:j}){const{collapsed:b}=q(e=>e.auth),{servicesData:g,loading:T,selectedService:S,statusBasedRecord:y}=q(e=>e.services),[A,M]=r.useState(!1),[J,K]=r.useState(null),[p,m]=r.useState(null),[u,B]=r.useState(""),[v,I]=r.useState(""),[P,Q]=r.useState(),[C,Y]=r.useState(0),[_,X]=r.useState(8),[U,Z]=r.useState(),[V,w]=r.useState(),F=ie();r.useEffect(()=>{F(G())},[]),r.useEffect(()=>{let e=g.map(l=>{var s,n,i,d,c;return{...l,vehicle_id:l.vehicle.id,vehicle:l.vehicle.registration_id,vehicle_group:((s=l==null?void 0:l.vehicle)==null?void 0:s.vehicle_group)||"N/A",sub_model:(i=(n=l==null?void 0:l.vehicle)==null?void 0:n.sub_model)==null?void 0:i.name,model:(c=(d=l==null?void 0:l.vehicle)==null?void 0:d.vehicle_model)==null?void 0:c.name}});m(e)},[g]),r.useEffect(()=>{var e,l;if(S&&y.length>0){const n={Overdue:2,"Due soon":1,Serviced:0}[S],i=n!==void 0&&((l=(e=y[n])==null?void 0:e.data)==null?void 0:l.map(d=>{var c,h,O;return{...d,vehicle_id:((c=d.vehicle)==null?void 0:c.id)||"N/A",vehicle:((h=d.vehicle)==null?void 0:h.registration_id)||"N/A",vehicle_group:((O=d.vehicle)==null?void 0:O.vehicle_group)||"N/A"}}))||[];console.log("Filtered Data:",i),Q(i)}},[S,y]),r.useEffect(()=>{console.log("tableData: ",p),P&&m(P)},[P]),r.useEffect(()=>{console.log("tableData: ",p)},[p]);const L=e=>{console.log("handleEditClick",e);let l={id:e.id,vehicle:e.vehicle_id,user:e.user.id,priority_class:e.priority_class,completion_date:N(e.completion_date),next_due_date:N(e.next_due_date),segment:e.segment.id,chassis_no:e.chassis_no,odometer:e.odometer,attachment:e.attachment,status:e.status,entry_date:N(e.created)};console.log("objecct",l),M(!A),K(l)};let f=b?150:140,ee=b?220:210;const[Pe,te]=r.useState([{field:"vehicle",headerName:"Vehicle",width:f},{field:"vehicle_group",headerName:"Vehicle group",width:f,valueGetter:e=>(e==null?void 0:e.group_name)||"N/A"},{field:"priority_class",headerName:"Priority Class",width:f},{field:"completion_date",headerName:"Completion Date",width:f},{field:"next_due_date",headerName:"Next Due Date",width:f},{field:"segment",headerName:"Segment",width:100,valueGetter:e=>(e==null?void 0:e.segment_name)||""},{field:"user",headerName:"User",width:ee,valueGetter:e=>(e==null?void 0:e.email)||""},{field:"status",headerName:"Status",width:130}]);r.useEffect(()=>{x!=="service report"&&te(e=>[...e,{field:"edit",headerName:"Edit",width:100,renderCell:l=>t.jsx(W,{onClick:()=>L(l.row),color:"primary","aria-label":"edit record",children:t.jsx(E,{})})}])},[x]);const se=e=>{let l=e.target.value;B(l)},z=p&&p.length>0?p.filter(e=>{var n,i,d,c,h;const l=(n=e.vehicle)==null?void 0:n.toLowerCase().includes(u==null?void 0:u.toLowerCase()),s=`${((d=(i=e==null?void 0:e.user)==null?void 0:i.us_user)==null?void 0:d.first_name)||""}${((h=(c=e==null?void 0:e.user)==null?void 0:c.us_user)==null?void 0:h.last_name)||""}`.toLowerCase().includes(u==null?void 0:u.toLowerCase());return l||s}):[],le=()=>{if(U&&V){I("");let e={startDate:H(new Date(U)).format("YYYY-MM-DD"),endDate:H(new Date(V)).format("YYYY-MM-DD")};F(G(e))}else re.error("Please select start date and end date")},k=e=>{if(B(""),I(e),e){let l=g.filter(s=>s.status===e).map(s=>{var n,i,d,c;return{...s,vehicle_id:s.vehicle.id,vehicle:s.vehicle.registration_id,vehicle_group:((n=s==null?void 0:s.vehicle)==null?void 0:n.vehicle_group)||"N/A",sub_model:(d=(i=s==null?void 0:s.vehicle)==null?void 0:i.sub_model)==null?void 0:d.name,model:(c=s==null?void 0:s.vehicle_model)==null?void 0:c.name}});m(l)}else{let l=g.map(s=>{var n,i,d,c;return{...s,vehicle_id:s.vehicle.id,vehicle:s.vehicle.registration_id,vehicle_group:((n=s==null?void 0:s.vehicle)==null?void 0:n.vehicle_group)||"N/A",sub_model:(d=(i=s==null?void 0:s.vehicle)==null?void 0:i.sub_model)==null?void 0:d.name,model:(c=s==null?void 0:s.vehicle_model)==null?void 0:c.name}});m(l)}},ae=(e,l)=>{Y(l)},de=e=>{X(parseInt(e.target.value,10)),Y(0)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("input",{placeholder:"Search by vehicle and user ",value:u,type:"text",style:{padding:"10px",border:"1px solid grey",borderRadius:"5px",width:"250px",margin:"10px"},onChange:se}),t.jsx(D,{style:{margin:"10px",backgroundColor:v===""?"rgb(141, 166, 198)":void 0,color:v===""?"white":void 0},onClick:()=>k(""),children:"All"}),t.jsx(D,{style:{margin:"10px",backgroundColor:v==="Completed"?"rgb(141, 166, 198)":void 0,color:v==="Completed"?"white":void 0},onClick:()=>k("Completed"),children:"Completed"}),t.jsx(D,{style:{margin:"10px",backgroundColor:v==="Pending"?"rgb(141, 166, 198)":void 0,color:v==="Pending"?"white":void 0},onClick:()=>k("Pending"),children:"Pending"}),t.jsx(ue,{setStartDate:Z,setEndDate:w,selectedDate:!1}),t.jsx(D,{style:{margin:"10px",background:"rgb(141, 166, 198)",color:"white"},onClick:()=>le(),children:"Apply"})]}),t.jsxs(ve,{sx:{overflow:"auto",margin:"10px",borderRadius:"5px",background:"white"},children:[t.jsxs(_e,{component:ce,children:[t.jsxs(fe,{children:[t.jsx(je,{children:t.jsxs($,{children:[t.jsx(a,{sx:o,children:"Sr no"}),t.jsx(a,{sx:o,children:"Vehicle"}),t.jsx(a,{sx:o,children:"Vehicle group"}),t.jsx(a,{sx:o,children:"Vehicle model"}),t.jsx(a,{sx:o,children:"Vehicle submodel"}),t.jsx(a,{sx:o,children:"Priority class"}),t.jsx(a,{sx:o,children:"Completion date"}),t.jsx(a,{sx:o,children:"Next due date"}),t.jsx(a,{sx:o,children:"Segment"}),t.jsx(a,{sx:o,children:"User"}),t.jsx(a,{sx:o,children:"Status"}),x!=="service report"&&t.jsx(a,{sx:o,children:"Action"}),"          "]})}),t.jsx(be,{children:z.slice(C*_,C*_+_).map((e,l)=>{var s,n,i,d,c,h;return t.jsxs($,{children:[t.jsx(a,{children:C*_+l+1}),t.jsx(a,{children:e==null?void 0:e.vehicle}),t.jsx(a,{children:(s=e==null?void 0:e.vehicle_group)==null?void 0:s.group_name}),t.jsx(a,{children:e==null?void 0:e.model}),t.jsx(a,{children:e==null?void 0:e.sub_model}),t.jsx(a,{children:e==null?void 0:e.priority_class}),t.jsx(a,{children:e==null?void 0:e.completion_date}),t.jsx(a,{children:e==null?void 0:e.next_due_date}),t.jsx(a,{children:(n=e==null?void 0:e.segment)==null?void 0:n.segment_name}),t.jsx(a,{children:((d=(i=e==null?void 0:e.user)==null?void 0:i.us_user)==null?void 0:d.first_name)+" "+((h=(c=e==null?void 0:e.user)==null?void 0:c.us_user)==null?void 0:h.last_name)}),t.jsx(a,{children:e==null?void 0:e.status}),x!=="service report"&&t.jsx(a,{children:t.jsx(W,{onClick:()=>L(e),color:"primary","aria-label":"edit record",children:t.jsx(E,{})})})]},e==null?void 0:e.id)})})]}),t.jsx(me,{rowsPerPageOptions:[12],component:"div",count:z.length,rowsPerPage:_,page:C,onPageChange:ae,onRowsPerPageChange:de})]}),t.jsx(ye,{open:A,setOpen:M,data:J,isInspection:j})]})]})}export{Ue as S};
