import{j as a,f3 as de,f4 as ue,f5 as he,f6 as pe,bd as se,a$ as X,b0 as E,r as n,aX as k,aZ as ae,ff as be,fg as _e,c8 as xe,b8 as W,bC as ie,fh as fe,bn as O,fi as ne,bg as ge,da as te,ch as je,dY as ke,dZ as Ce,d_ as De,d$ as ce,e0 as o,e1 as Se,f7 as ye,dg as ve,eO as Be,eP as le,fe as Pe,fj as Te,bJ as oe,bx as Ae,by as Ve,bB as me,bA as $e,br as Ee,bt as Ie,b4 as Le}from"./index-B9W9A0YN.js";import{V as Ye}from"./VehicleMenu-CCajfBdm.js";import{P as Re}from"./Parameters-B4utlfqr.js";/* empty css           */import"./index.esm-R3Gd3xrx.js";import{A as Ne}from"./AddBreakdown-Q9h_J_O3.js";import{S as Oe}from"./ServicesTopBar-BAE5mNsR.js";import{D as Me}from"./DialogContentText-CiyoTiUH.js";import{E as Ge,T as He}from"./Edit-jq5htzrK.js";import{D as Ue}from"./Remove-CXcyEgiF.js";import{a as Je,B as Fe}from"./BreakDownJobCardTable-BpuPZF35.js";import{T as qe,d as We}from"./excelUtils-CKXoEBjl.js";import"./Autocomplete-XJJmeDcA.js";import"./Add-tKe-T8er.js";import"./formik.esm-D-reUPUz.js";import"./useMediaQuery-BlPD5u51.js";import"./xlsx-DrgRuPKf.js";const Ze=({open:d,onClose:l,onConfirm:u})=>a.jsxs(de,{open:d,onClose:l,children:[a.jsx(ue,{children:"Confirm Deletion"}),a.jsx(he,{children:a.jsxs(Me,{children:["Are you sure you want to delete this vehicle data?"," ",a.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),a.jsxs(pe,{children:[a.jsx(se,{onClick:l,color:"primary",children:"Cancel"}),a.jsx(se,{onClick:u,color:"secondary",children:"Delete"})]})]}),ze="https://cc.wikitrak.in/api-proxy/api/v1",Qe={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Xe=({breakdownData:d,status:l})=>{const u=X(),{isUpdateBreakdown:D}=E(_=>_.equipment),{w_customer_id:m}=E(_=>_.auth),[j,S]=n.useState(!1),y=()=>{console.log("breakdownData",d),localStorage.getItem("role"),u(be(!D)),u(_e(d))},I=()=>{console.log("dlt btn clicked"),localStorage.getItem("role"),S(!0)},v=async()=>{console.log("breakdownData data deleting");try{await xe.delete(`${ze}/vehicles/new/breakdown/create/${d.id}/`),W.success("breakdownData data deleted successfully!"),u(ie(m))}catch(_){console.error("Error deleting breakdown data:",_),W.error("Failed to delete breakdown data. Please try again.")}S(!1)},$=()=>{S(!1)},M={color:"#686868"};return a.jsxs(k,{sx:Qe,children:[a.jsx(ae,{onClick:y,color:"primary",disabled:(l==null?void 0:l.toLowerCase())==="rejected"||(l==null?void 0:l.toLowerCase())==="close",children:a.jsx(Ge,{})}),a.jsx(ae,{onClick:I,children:a.jsx(Ue,{sx:M})}),a.jsx(Ze,{open:j,onClose:$,onConfirm:v})]})},re=[{id:"breakdown_id",label:"BDID"},{id:"registration_id",label:"Vehicle No"},{id:"breakdown_topic",label:"Topic"},{id:"breakdown_sub_topic",label:"Sub Topic"},{id:"user",label:"Created"},{id:"technician",label:"Technician"},{id:"contact_person",label:"Contact person"},{id:"mob_no",label:"Contact person mobile"},{id:"description",label:"Cust. complaint"},{id:"submission_date",label:"Submission Date"},{id:"submission_time",label:"Submission Time"},{id:"status",label:"Status"}],Ke=()=>{const{breakdowns:d}=E(e=>e.breakdown),{searchTerm:l}=E(e=>e.inspection),u=X(),[D,m]=n.useState("asc"),[j,S]=n.useState("BDID"),[y,I]=n.useState(0),[v,$]=n.useState(8),[M,_]=n.useState(!1),[L,U]=n.useState(null),[Y,Z]=n.useState("breakdown_id"),[J,F]=n.useState({id:"",status:"",workshop:"",user:""});n.useEffect(()=>{u(fe({}))},[]);const K=e=>{m(j===e&&D==="asc"?"desc":"asc"),S(e)},w=(e,p)=>{I(p)},z=e=>{$(parseInt(e.target.value,10)),I(0)},B=((e,p,f)=>!p||!f?e:e.filter(s=>(()=>{var r,g,c,i,P,T,A,V,H,C;switch(p){case"breakdown_id":return((s==null?void 0:s.breakdown_id)||"").toString();case"registration_id":return((r=s==null?void 0:s.vehicle)==null?void 0:r.registration_id)||"";case"breakdown_topic":return((g=s==null?void 0:s.breakdown_topic)==null?void 0:g.topic)||"";case"user_name":return`${((i=(c=s==null?void 0:s.user)==null?void 0:c.us_user)==null?void 0:i.first_name)||""} ${((T=(P=s==null?void 0:s.user)==null?void 0:P.us_user)==null?void 0:T.last_name)||""}`;case"technician_name":return`${((V=(A=s==null?void 0:s.technician)==null?void 0:A.us_user)==null?void 0:V.first_name)||""} ${((C=(H=s==null?void 0:s.technician)==null?void 0:H.us_user)==null?void 0:C.last_name)||""}`;case"contact_person":return(s==null?void 0:s.contact_person)||"";case"mob_no":return(s==null?void 0:s.mob_no)||"";case"submission_date":return s!=null&&s.submission_date?O(s.submission_date).format("YYYY-MM-DD"):"";case"start_time":return s!=null&&s.submission_date?O(s.submission_date).format("HH:mm A"):"";case"status":return(s==null?void 0:s.status)||"";default:return""}})().toLowerCase().includes(f.toLowerCase())))((d==null?void 0:d.slice())||[],Y,l),G=B.slice(y*v,y*v+v);console.log(G,B,"paginatedData");const h={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},Q=B&&B.map(e=>{var f,s,b,r,g,c,i,P,T,A,V,H;const p=e!=null&&e.breakdown_parts&&(e==null?void 0:e.breakdown_parts.length)>0?e==null?void 0:e.breakdown_parts.map((C,es)=>{var ee;return`${(ee=C==null?void 0:C.spare_parts)==null?void 0:ee.description}: Qty ${C==null?void 0:C.quantity}`}).join(";"):"N/A";return{BDID:(e==null?void 0:e.breakdown_id)||"","Registration ID":((f=e==null?void 0:e.vehicle)==null?void 0:f.registration_id)||"","Breakdown Topic":((s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic)||"","Breakdown Sub Topic":((r=(b=e.breakdown_topic)==null?void 0:b.breakdown_sub_topic)==null?void 0:r.name)||"","Customer Complaint":(e==null?void 0:e.description)||"","Created By":`${((c=(g=e==null?void 0:e.user)==null?void 0:g.us_user)==null?void 0:c.first_name)||""} ${((P=(i=e==null?void 0:e.user)==null?void 0:i.us_user)==null?void 0:P.last_name)||""}`,"Technician Name":`${((A=(T=e==null?void 0:e.technician)==null?void 0:T.us_user)==null?void 0:A.first_name)||""} ${((H=(V=e==null?void 0:e.technician)==null?void 0:V.us_user)==null?void 0:H.last_name)||""}`,"Contact Person":(e==null?void 0:e.contact_person)||"","Mobile No":(e==null?void 0:e.mob_no)||"","Submission Date":e!=null&&e.submission_date?O(e.submission_date).format("YYYY-MM-DD"):"","Submission Time":e!=null&&e.submission_date?O(e.submission_date).format("HH:mm A"):"",Status:(e==null?void 0:e.status)||"","Spare parts":p}});let R=ne("Breakdown"),N=ne("Job Card");const t=(N==null?void 0:N.includes("Create"))||N==="Read-Write-Only",x=(R==null?void 0:R.includes("Update"))||R==="Read-Write-Only";return a.jsxs(k,{sx:{m:"10px"},children:[a.jsxs(k,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsx(qe,{columns:re,selectedColumn:Y,onColumnChange:Z,searchTerm:l,onSearchChange:e=>u(ge(e))}),a.jsx(te,{variant:"contained",color:"success",onClick:()=>We(Q,"breakdown-tickets.xlsx"),children:"Download Excel"})]}),a.jsxs(je,{children:[a.jsx(ke,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:a.jsxs(Ce,{stickyHeader:!0,children:[a.jsx(De,{children:a.jsxs(ce,{children:[re.map(e=>a.jsx(o,{sx:h,children:a.jsx(He,{active:j===e.id,direction:j===e.id?D:"asc",onClick:()=>K(e.id),children:e.label})},e.id)),x&&a.jsx(o,{sx:h,children:"Action"}),t&&a.jsx(o,{sx:h,children:"Job card"})]})}),a.jsx(Se,{children:G.map((e,p)=>{var f,s,b,r,g,c,i,P,T,A,V;return a.jsxs(ce,{children:[a.jsx(o,{children:e==null?void 0:e.breakdown_id}),a.jsx(o,{children:(f=e==null?void 0:e.vehicle)==null?void 0:f.registration_id}),a.jsx(o,{children:(s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic}),a.jsx(o,{children:(b=e==null?void 0:e.breakdown_sub_topic)==null?void 0:b.name}),a.jsx(o,{children:`${(g=(r=e==null?void 0:e.user)==null?void 0:r.us_user)==null?void 0:g.first_name} ${(i=(c=e==null?void 0:e.user)==null?void 0:c.us_user)==null?void 0:i.last_name}`}),a.jsx(o,{children:`${((T=(P=e==null?void 0:e.technician)==null?void 0:P.us_user)==null?void 0:T.first_name)||"N/A"} ${((V=(A=e==null?void 0:e.technician)==null?void 0:A.us_user)==null?void 0:V.last_name)||""}`}),a.jsx(o,{children:e==null?void 0:e.contact_person}),a.jsx(o,{children:e==null?void 0:e.mob_no}),a.jsx(o,{children:e==null?void 0:e.description}),a.jsx(o,{children:(e==null?void 0:e.submission_date)&&O(e.submission_date).format("YYYY-MM-DD")||"N/A"}),a.jsx(o,{children:(e==null?void 0:e.submission_date)&&O(e.submission_date).format("HH:mm A")||"N/A"}),a.jsx(o,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),x&&a.jsx(o,{children:a.jsx(Xe,{breakdownData:e,status:e.status})}),t&&a.jsx(o,{children:a.jsx(te,{variant:"outlined",onClick:()=>{_(!0),U(e)},disabled:e.jobcard,children:"Create job card"})})]},p)})})]})}),a.jsx(ye,{component:"div",count:B.length,page:y,onPageChange:w,rowsPerPage:v,onRowsPerPageChange:z,rowsPerPageOptions:[5,10,15]}),a.jsx(Je,{rowData:L,open:M,handleClose:()=>_(!1),isTechnician:!0})]})]})};function we(){const[d]=ve(),l=d.get("tab"),[u,D]=n.useState(0),m=(j,S)=>{D(S)};return n.useEffect(()=>{l&&D(Number(l))},[]),a.jsxs(k,{sx:{width:"100%"},children:[a.jsx(k,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsxs(Be,{value:u,onChange:m,"aria-label":"Breakdown Tabs",children:[a.jsx(le,{label:"Breakdown Tickets"}),a.jsx(le,{label:"Breakdown Job Cards"})]})}),a.jsxs(k,{sx:{mt:2},children:[u===0&&a.jsx(Ke,{}),u===1&&a.jsx(Fe,{})]})]})}function gs(){const{locationData:d,selectedVehicle:l,selectedParameterList:u,onlineVehicle:D}=E(t=>t.liveMap),{mode:m,selectedVehicleGroup:j,vehicleZone:S}=E(t=>t.dashboard),y=Le(m),[I,v]=n.useState([]),{w_customer_id:$}=E(t=>t.auth),[M,_]=n.useState(),[L,U]=n.useState(!1),[Y,Z]=n.useState(!1),[J,F]=n.useState([]),[K,w]=n.useState(!0),[z,q]=n.useState(!1),[B,G]=n.useState(!1);let h=X();n.useEffect(()=>{Q(),h(Pe()),h(ie($)),h(Te())},[]),n.useEffect(()=>{console.log("selectedVehicleGroup",j)},[j]),n.useEffect(()=>{F([]),h(oe([{reg_id:"",imei:"",params:[]}]))},[l]);const Q=async()=>{try{q(!0);let t=[],x=[];const e=await h(Ae({w_customer_id:$}));if(Array.isArray(e.payload)){e.payload.forEach(s=>{var b,r,g,c;Array.isArray(s.imei)&&s.imei.length>0&&((b=s.imei[0])!=null&&b.mac_id)?(t.push({id:s.id,label:s.registration_id,value:(r=s.imei[0])==null?void 0:r.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(g=s==null?void 0:s.vehicle_model)==null?void 0:g.name,user:s==null?void 0:s.user,vehicle_group:s==null?void 0:s.vehicle_group}),x.push((c=s.imei[0])==null?void 0:c.mac_id)):console.error("IMEI data not found for item:",s)});const p="one",f=x;x.length>0&&h(Ve({type:p,imei:f})),v(t),h(me({w_customer_id:$})),h($e(t)),q(!1)}else q(!1),console.error("Unexpected data format:",e),W.error("Unexpected data format:")}catch(t){console.error("Error fetching vehicle data:",t),W.error(`Error fetching vehicle data: ${t}`)}},R=async t=>{const{label:x,imei:e,id:p,reg_id:f,checked:s}=t;_(c=>c.map(i=>i.id===p?{...i,checked:!s}:i));let b=[...J],r=[...J];if(!s)d.forEach(c=>{c.latestDocument.imei===e&&(b.push({label:x,value:c.latestDocument[x==="maininputvoltage"?"mainInputVoltage":x]}),r=b,F(b))});else{let c=J.filter(i=>i.label!==x);r=c,F(c)}console.log("tempParamList",r),h(oe([{reg_id:f,imei:e,params:r}]))},N=I.filter(t=>Object.keys(j).length===0||t.vehicle_group===j.id);return a.jsxs("div",{className:"app",children:[a.jsx(Ee,{}),a.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[a.jsx(Oe,{title:"Breakdown",setShowVehicles:U,showVehicles:L,setShowVehiclesGroup:G,showVehiclesGroup:B}),a.jsx(Ie,{setShowVehiclesGroup:G,showVehiclesGroup:B}),a.jsxs(k,{style:{display:"flex",width:"100%",height:"95vh"},children:[a.jsxs(k,{style:{width:L||Y?"80%":"100%"},children:[a.jsx(Ne,{where:"Breakdown"}),a.jsx(we,{})]}),L&&a.jsx(k,{style:{width:"20%",backgroundColor:y.grey[100]},children:a.jsx(Ye,{vehicleData:N,title:"Inspections",setParameterData:_,loadingVehicle:z,setShowVehicles:U,showVehicles:L,showParameters:Y,setShowParameters:Z})}),Y&&a.jsx(k,{style:{width:"20%",backgroundColor:y.grey[100]},children:a.jsx(Re,{parametersData:M,setParameterData:_,handleParameterChange:R})})]})]})]})}export{gs as default};
