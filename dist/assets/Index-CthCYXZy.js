import{l as De,o as ve,p as we,_ as ne,b as n,q as be,f as Ce,j as t,g as Me,k as Te,y as ie,a9 as ke,z as A,D as R,aa as ee,ab as ue,ac as fe,a3 as xe,ad as Ae,ae as _e,af as Z,ag as E,T as w,G as F,ah as oe,ai as Ie,aj as Oe,ak as he,C as te,al as ge,Q as Ye,U as Le,V as Ne,Y as Ee}from"./index-BSVJbJcX.js";import{L as Re}from"./LeftSideBar2-Dyc48EnJ.js";import{L as Pe}from"./LiveMapTopBar-CXUxXgFe.js";import{V as Ve}from"./VehicleMenu-DMacWX_p.js";import{T as Be}from"./TripMap-Dpo65G13.js";import{S as $e,D as qe}from"./index-D5Udz4Rc.js";import{r as me}from"./createSvgIcon-C-6S6yhG.js";import{t as Se}from"./SearchTab-BUQ4Nfh0.js";import{B as h,C as Fe}from"./CircularProgress-CBepFzIK.js";import{M as Ge}from"./menu2-AUWZ4d2C.js";import{C as Ue}from"./Card-DE6wJlCM.js";import{C as ze}from"./CardContent-DQRNIihk.js";import"./TripGraph-Df6cuUS2.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as He}from"./VehicleGroups-BAK4dZqs.js";import"./useControlled-Bukol7d3.js";import"./Close-zfq6D2km.js";import"./jcb-aCHXMCXy.js";import"./TextField-CM3Qc-pp.js";import"./Autocomplete-B6Uv6ksI.js";import"./esm-BAi1VYPD.js";import"./redTractor-NXgVJyvR.js";import"./Info-B8v3Oh8M.js";function We(s){return De("MuiCardActions",s)}ve("MuiCardActions",["root","spacing"]);const Qe=["disableSpacing","className"],Xe=s=>{const{classes:D,disableSpacing:x}=s;return Te({root:["root",!x&&"spacing"]},We,D)},Je=we("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,D)=>{const{ownerState:x}=s;return[D.root,!x.disableSpacing&&D.spacing]}})(({ownerState:s})=>ne({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Ke=n.forwardRef(function(D,x){const i=be({props:D,name:"MuiCardActions"}),{disableSpacing:p=!1,className:m}=i,P=Ce(i,Qe),d=ne({},i,{disableSpacing:p}),S=Xe(d);return t.jsx(Je,ne({className:Me(S.root,m),ownerState:d,ref:x},P))}),Ze=Ke,{RangePicker:et}=qe,tt=()=>{const s=ie(),[D]=ke(),x=D.get("source"),{selectedVehicle:i}=A(g=>g.liveMap),{startDate:p,endDate:m,mode:P}=A(g=>g.dashboard),[d,S]=n.useState(p?R(p):null),[o,_]=n.useState(m?R(m):null);n.useEffect(()=>{if(console.log("hello",i==null?void 0:i.imei,d,o,p),i!=null&&i.imei&&d&&o){const g={imei:i.imei,startDate:d.startOf("day").toISOString(),endDate:o.endOf("day").toISOString(),page:1};console.log("fromcomponent",x),x!=="TripDetail"&&(g.limit=20),s(ee(g)),s(ue(g))}},[i,d,o]);const y=(g,L)=>{if(g){const C=R(L[0]).startOf("day"),f=R(L[1]).endOf("day");S(C),_(f),s(fe({startDate:C.toISOString(),endDate:f.toISOString()}));const I={imei:i==null?void 0:i.imei,startDate:C.toISOString(),endDate:f.toISOString(),page:1,limit:20};s(ee(I)),s(ue(I))}};return t.jsx($e,{direction:"vertical",size:12,children:t.jsx(et,{value:[d,o],onChange:y,style:{backgroundColor:"#f0f0f0",color:"#333"}})})};var ce={},st=xe;Object.defineProperty(ce,"__esModule",{value:!0});var je=ce.default=void 0,at=st(me()),rt=t;je=ce.default=(0,at.default)((0,rt.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var le={},ot=xe;Object.defineProperty(le,"__esModule",{value:!0});var ye=le.default=void 0,nt=ot(me()),it=t;ye=le.default=(0,nt.default)((0,it.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const ct=()=>{var c,v,T,k;const s=ie(),{tripList:D,selectedTripData:x,loading:i,trips:p,activeIndex:m,searchText:P,mode:d,isNavigate:S,allTripList:o,trip_payload:_,page:y,total_page:g,total_trips:L}=A(e=>e.dashboard),{selectedVehicle:C}=A(e=>e.liveMap),f=Se(d),[I,G]=n.useState(!1),[l,U]=n.useState({}),[M,z]=n.useState(""),[N,H]=n.useState(null);n.useEffect(()=>{(p==null?void 0:p.length)>0},[p]),n.useEffect(()=>{const e=de(o);s(Ae(e))},[o]),n.useEffect(()=>{!(x.length>0)&&S&&m!==null&&b.length>0&&se(b[m])},[x,S]);const se=async e=>{var j;let r={imei:C.imei,startDate:e.startDate,endDate:e.endDate};const u=await _e(r);((j=u==null?void 0:u.data)==null?void 0:j.documents.length)>0?(s(S(!1)),s(Z(u.data.documents[0].data))):(s(S(!1)),s(Z([])))},de=e=>{const r=new Set,u=[];return e.forEach(j=>{const Y=E(j.startTime).format("YYYY-MM-DD");r.has(Y)||(r.add(Y),u.push(Y))}),u},W=(e,r)=>{s(oe(null)),s(Ie(e)),s(Oe(!1)),M===e?(z(""),H(null)):(z(e),H(r))},b=M===""?o:o.filter(e=>E(e.startTime).format("YYYY-MM-DD")===M),Q=async(e,r)=>{s(Z(r.data)),s(oe(e)),s(he(0))},O=e=>{U(e),G(!0)},X=()=>{G(!1),U({})},J=e=>e?e.split(" ").slice(0,2).join(" "):"",ae=async()=>{const e={..._,page:y+1,limit:20};try{(await s(ee(e))).error?te.error("No Trip! within selected date"):s(ge(y+1))}catch{te.error("No Trip! within selected date")}},re=()=>{if(y<=1)return;const e={..._,page:y-1,limit:20};s(ge(y-1)),s(ee(e))},a=e=>{s(Z([])),s(oe("all")),s(he(0))};return t.jsxs(t.Fragment,{children:[t.jsxs(h,{children:[t.jsxs(h,{sx:{m:"10px"},children:[t.jsx(h,{sx:{color:f.grey[400]},children:"Select Date"}),t.jsx(h,{sx:{mt:1},children:t.jsx(tt,{})})]}),i?t.jsx("div",{style:{width:"100%",margin:"38%"},children:t.jsx(Fe,{})}):t.jsxs(t.Fragment,{children:[t.jsx(h,{children:t.jsx(h,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:o&&(o==null?void 0:o.length)>0?t.jsx(t.Fragment,{}):t.jsx(w,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),o&&(o==null?void 0:o.length)>0&&t.jsxs(h,{ml:2,display:"flex",gap:1,children:[t.jsxs(w,{children:["Total trips:",L]})," |",t.jsxs(w,{children:["Current page:",y]})," |",t.jsxs(w,{children:["Total page:",g]}),"|"]}),o&&(o==null?void 0:o.length)>0&&t.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:"5px"},children:[t.jsx(F,{disabled:y<=1,onClick:re,children:t.jsx(je,{})}),t.jsx(F,{disabled:g===y||g===0,onClick:ae,children:t.jsx(ye,{})})]}),t.jsxs(h,{sx:{height:"75vh",width:"100%",overflowY:"auto"},children:[t.jsx(h,{display:"flex",gap:1,marginLeft:2,children:p.map((e,r)=>t.jsx(h,{children:t.jsx(F,{onClick:()=>{W(e,r)},style:{backgroundColor:N===r?f.grey[300]:f.grey[200],color:N===r?"black":f.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:e})},r))}),b&&b.length>0&&t.jsx(F,{variant:m==="all"?"contained":"outlined",sx:{width:"90%",mx:"20px",mt:"10px"},onClick:()=>{a()},children:"Select All trips"}),"              ",b&&b.length>0&&b.map((e,r)=>{var V,B,$,q;const u=(B=(V=e==null?void 0:e.startLocation)==null?void 0:V.address)==null?void 0:B.address,j=(q=($=e==null?void 0:e.endLocation)==null?void 0:$.address)==null?void 0:q.address,Y=u?`${u.town||u.city||""}`:"",pe=j?`${j.town||j.city||""}`:"";return t.jsxs(h,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:m===r?"black":f.grey[400],backgroundColor:m===r?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:d?f.grey[300]:f.grey[200]}},onClick:()=>Q(r,e),children:[t.jsxs(w,{sx:{cursor:"text"},children:[r+1,". ",J(Y)," to"," ",J(pe)," "]}),t.jsxs(w,{children:[e!=null&&e.startTime?E(new Date(e.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",e!=null&&e.endTime?E(new Date(e.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",t.jsx("span",{style:{color:d?"orange":"blue",cursor:"pointer"},onClick:K=>{K.stopPropagation(),O(e)},children:"...see more"})]})]},r)})]})]})]}),t.jsx(Ge,{open:I,onClose:X,children:t.jsxs(Ue,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[t.jsxs(ze,{children:[t.jsx(w,{variant:"h6",component:"div",children:"Trip Details"}),t.jsxs(w,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Location:"})," ",((v=(c=l==null?void 0:l.startLocation)==null?void 0:c.address)==null?void 0:v.display_name)||"N/A"]}),t.jsxs(w,{sx:{mt:2},children:[t.jsx("strong",{children:"End Location:"})," ",((k=(T=l==null?void 0:l.endLocation)==null?void 0:T.address)==null?void 0:k.display_name)||"N/A"]}),t.jsxs(w,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Time:"})," ",l!=null&&l.startTime?E(new Date(l.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),t.jsxs(w,{sx:{mt:2},children:[t.jsx("strong",{children:"End Time:"})," ",l!=null&&l.endTime?E(new Date(l.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),t.jsx(Ze,{children:t.jsx(F,{onClick:X,children:"Close"})})]})})]})},lt=ct;function Lt(){const{w_customer_id:s}=A(a=>a.auth),{collapsed:D}=A(a=>a.auth),{mode:x,selectedVehicleGroup:i}=A(a=>a.dashboard),{vehicleList:p,selectedVehicle:m,onlineVehicle:P,locationData:d}=A(a=>a.liveMap),[S,o]=n.useState(!1),[_,y]=n.useState(!0),[g,L]=n.useState([]),[C,f]=n.useState(!0),[I,G]=n.useState(""),[l,U]=n.useState(""),[M,z]=n.useState(""),[N,H]=n.useState("");n.useState([]);const[se,de]=n.useState({lat:18.516726,lng:73.856255});n.useState([]);const[W,b]=n.useState(!1),Q=Se(x);let O=ie();n.useEffect(()=>{X()},[]),n.useEffect(()=>{var v,T,k;const a=R().subtract(5,"day").startOf("day").toISOString(),c=R().endOf("day").toISOString();O(fe({startDate:a,endDate:c})),Object.keys(m).length===0&&p.length>0&&O(Ye({imei:(T=(v=p[0])==null?void 0:v.imei[0])==null?void 0:T.mac_id,reg_id:(k=p[0])==null?void 0:k.registration_id}))},[m,p]);const X=async()=>{try{let a=[],c=[];const v=await O(Le({w_customer_id:s}));if(Array.isArray(v.payload)){v.payload.forEach(e=>{var r,u,j;Array.isArray(e.imei)&&e.imei.length>0&&((r=e.imei[0])!=null&&r.mac_id)?(a.push({id:e.id,label:e.registration_id,value:(u=e.imei[0])==null?void 0:u.mac_id,workShop:e==null?void 0:e.workshop,vehicle_group:e==null?void 0:e.vehicle_group}),c.push((j=e.imei[0])==null?void 0:j.mac_id)):console.error("IMEI data not found for item:",e)});const T="one",k=c;c.length>0&&O(Ne({type:T,imei:k})),O(Ee({w_customer_id:s})),L(a)}else console.error("Unexpected data format:",v),te.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),te.error(`Error fetching vehicle data: ${a}`)}},J=a=>d==null?void 0:d.some(c=>Number(c.latestDocument.imei)===Number(a)&&c.latestDocument.speed>0&&(c.latestDocument.ignition===!0||c.latestDocument.ignition===1)),ae=a=>d==null?void 0:d.some(c=>Number(c.latestDocument.imei)===Number(a)&&c.latestDocument.speed<=0&&(c.latestDocument.ignition===!0||c.latestDocument.ignition===1)),re=g.filter(a=>{var V,B,$,q,K;if(!(Object.keys(i).length===0||a.vehicle_group===i.id))return!1;const v=(V=a==null?void 0:a.label)==null?void 0:V.toLowerCase().includes(I.toLowerCase()),T=N===""||((B=a==null?void 0:a.workShop)==null?void 0:B.region)===N,k=M===""||((q=($=a==null?void 0:a.workShop)==null?void 0:$.state)==null?void 0:q.toLowerCase())===(((K=M==null?void 0:M.toString())==null?void 0:K.toLowerCase())||""),e=Number(a.value),r=P.includes(e),u=!r,j=r&&J(e),Y=r&&ae(e);return v&&T&&k&&(l==="online"?r:l==="offline"?u:l==="running"?j:l==="idling"?Y:!0)}).sort((a,c)=>a.label.localeCompare(c.label));return t.jsxs("div",{className:"app",children:[t.jsx(Re,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(Pe,{title:"Trip Monitor",setShowVehicles:o,showVehicles:S,setShowCard:y,showCard:_,sideBarTrip:C,setSideBarTrip:f,setShowVehiclesGroup:b,showVehiclesGroup:W}),t.jsx(He,{setShowVehiclesGroup:b,showVehiclesGroup:W,where:"tripmonitor"}),t.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(h,{style:{width:S||C?"80%":"100%"},children:t.jsx(Be,{center:se,showCard:_})}),S&&t.jsx(h,{style:{width:"20%",backgroundColor:Q.grey[100]},children:t.jsx(Ve,{vehicleData:re,setShowVehicles:o,showVehicles:S,title:"Live Monitor",setSearchedTerm:G,setOptions:U,setState:z,setRegion:H,searchTerm:I,options:l,state:M,region:N,setSideBarTrip:f})}),t.jsx(h,{style:{width:D?"22%":"20%",display:C?"block":"none",backgroundColor:Q.grey[100]},children:t.jsx(lt,{})})]})]})]})}export{Lt as default};
