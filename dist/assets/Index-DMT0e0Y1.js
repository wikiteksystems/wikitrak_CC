import{l as xe,o as me,p as je,_ as H,b as r,q as ye,f as De,j as e,g as Se,k as ve,x as W,y as T,ab as $,ac as ne,a6 as le,ad as we,ae as be,af as z,ag as I,B as V,T as C,ah as ie,ai as Ce,aj as Me,ak as Te,J as q,al as ce,C as Ae,X as ke,Y as _e,a0 as Ye}from"./index-CLXmKO9l.js";import{L as Ie}from"./LeftSideBar2-fsH77pSX.js";import{L as Le}from"./LiveMapTopBar-kv-tt6T3.js";import{V as Ee}from"./VehicleMenu-BTTj2D9f.js";import{T as Ne}from"./TripMap-BeEo_foA.js";import{d as M}from"./dayjs.min-KJH-_OFv.js";import{t as X}from"./SearchTab-BBmlRp8R.js";import{S as Oe,D as Re}from"./index-BGnOIBlJ.js";import{r as de}from"./createSvgIcon-nbF4Nr6P.js";import{B as h,C as Be,M as Pe}from"./menu2-DKh_djjf.js";import{C as Ve}from"./Card--6AJ0W0e.js";import{C as $e}from"./CardContent-BcixHAbL.js";import"./TripVehicleInfo-Bg8IilP_.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as qe}from"./VehicleGroups-BqAWZOti.js";import"./useControlled-DolBPKsO.js";import"./Close-CcuUiN8A.js";import"./jcb-aCHXMCXy.js";import"./index-BXtxbbnI.js";import"./TextField-Dx1xnSeb.js";import"./Autocomplete-CiC-MuyU.js";import"./esm-jeQ1w6Zh.js";import"./preet_tractor-CDwt_mVh.js";import"./Info-BUDVnPlz.js";import"./customParseFormat-ocC5Vqbi.js";function Fe(s){return xe("MuiCardActions",s)}me("MuiCardActions",["root","spacing"]);const Ge=["disableSpacing","className"],Ue=s=>{const{classes:o,disableSpacing:m}=s;return ve({root:["root",!m&&"spacing"]},Fe,o)},ze=je("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:m}=s;return[o.root,!m.disableSpacing&&o.spacing]}})(({ownerState:s})=>H({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),He=r.forwardRef(function(o,m){const j=ye({props:o,name:"MuiCardActions"}),{disableSpacing:d=!1,className:u}=j,S=De(j,Ge),f=H({},j,{disableSpacing:d}),g=Ue(f);return e.jsx(ze,H({className:Se(g.root,u),ownerState:f,ref:m},S))}),We=He,{RangePicker:Xe}=Re,Je=()=>{const s=W(),{selectedVehicle:o}=T(c=>c.liveMap),{selectedTripData:m,mode:j}=T(c=>c.dashboard),[d,u]=r.useState(),[S,f]=r.useState(),g=X(j);r.useEffect(()=>{const c=M().subtract(5,"day");if(u(c),f(M()),o!=null&&o.imei){let i={imei:o==null?void 0:o.imei,startDate:M().subtract(5,"day").startOf("day"),endDate:M().endOf("day"),page:1};s($(i)),s(ne(i))}},[o]);const x=(c,i)=>{if(c){const A=M(i[0]).startOf("day"),y=M(i[1]).endOf("day");let Y={imei:o==null?void 0:o.imei,startDate:A.format(),endDate:y.format(),page:1};u(M(i[0])),f(M(i[1])),s($(Y)),s(ne(Y))}else console.log("Clear date")};return e.jsx(Oe,{direction:"vertical",size:12,children:e.jsx(Xe,{value:[d,S],onChange:(c,i)=>{x(c,i)},style:{backgroundColor:g.grey[500],color:g.grey[400]}})})};var J={},Ke=le;Object.defineProperty(J,"__esModule",{value:!0});var pe=J.default=void 0,Qe=Ke(de()),Ze=e;pe=J.default=(0,Qe.default)((0,Ze.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var K={},et=le;Object.defineProperty(K,"__esModule",{value:!0});var he=K.default=void 0,tt=et(de()),st=e;he=K.default=(0,tt.default)((0,st.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const at=()=>{var Q,Z,ee,te;const s=W(),{tripList:o,selectedTripData:m,loading:j,trips:d,activeIndex:u,searchText:S,mode:f,isNavigate:g,allTripList:x,trip_payload:c,page:i}=T(t=>t.dashboard),{selectedVehicle:A}=T(t=>t.liveMap),y=X(f),[Y,F]=r.useState(!1),[l,L]=r.useState({}),[R,k]=r.useState(""),[B,G]=r.useState(0);r.useEffect(()=>{console.log("trips",d),(d==null?void 0:d.length)>0&&k(d[0])},[d]),r.useEffect(()=>{console.log("allTripList",x);const t=v(x);s(we(t))},[x]),r.useEffect(()=>{!(m.length>0)&&g&&u!==null&&_.length>0&&n(_[u])},[m,g]);const n=async t=>{var b;let a={imei:A.imei,startDate:t.startDate,endDate:t.endDate};const D=await be(a);((b=D==null?void 0:D.data)==null?void 0:b.documents.length)>0?(s(g(!1)),s(z(D.data.documents[0].data))):(s(g(!1)),s(z([])))},v=t=>{const a=new Set,D=[];return t.forEach(b=>{const O=I(b.startTime).format("YYYY-MM-DD");a.has(O)||(a.add(O),D.push(O))}),D},w=(t,a)=>{s(ie(null)),s(Ce(t)),s(Me(!1)),k(t),G(a)},_=x.filter(t=>I(t.startTime).format("YYYY-MM-DD")===R),U=async(t,a)=>{s(z(a.data)),s(ie(t)),s(Te(0))},p=t=>{L(t),F(!0)},E=()=>{F(!1),L({})},N=t=>t?t.split(" ").slice(0,2).join(" "):"",P=async()=>{const t={...c,page:i+1};try{(await s($(t))).error?q.error("No Trip! within selected date"):s(ce(i+1))}catch{q.error("No Trip! within selected date")}},ue=()=>{if(i<=1)return;const t={...c,page:i-1};s(ce(i-1)),s($(t))};return e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsxs(h,{children:[e.jsx(h,{sx:{color:y.grey[400]},children:"Select Date"}),e.jsx(h,{sx:{mt:1},children:e.jsx(Je,{})})]}),j?e.jsx("div",{style:{width:"100%",margin:"38%"},children:e.jsx(Be,{})}):e.jsxs(e.Fragment,{children:[e.jsx(h,{children:e.jsx(h,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:x&&(x==null?void 0:x.length)>0?e.jsx(e.Fragment,{children:d.map((t,a)=>e.jsx(h,{children:e.jsx(V,{onClick:()=>{w(t,a)},style:{backgroundColor:B===a?y.grey[300]:y.grey[200],color:B===a?"black":y.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:t})},a))}):e.jsx(C,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),e.jsxs(h,{sx:{height:"70vh",width:"100%",overflowY:"auto"},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(V,{disabled:i<=1,onClick:ue,children:e.jsx(pe,{})}),e.jsx(V,{disabled:!(c!=null&&c.imei),onClick:P,children:e.jsx(he,{})})]}),_&&_.length>0&&_.map((t,a)=>{var se,ae,re,oe;const D=(ae=(se=t==null?void 0:t.startLocation)==null?void 0:se.address)==null?void 0:ae.address,b=(oe=(re=t==null?void 0:t.endLocation)==null?void 0:re.address)==null?void 0:oe.address,O=D?`${D.town||D.city||""}`:"",fe=b?`${b.town||b.city||""}`:"";return e.jsxs(h,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:u===a?"black":y.grey[400],backgroundColor:u===a?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:f?y.grey[300]:y.grey[200]}},onClick:()=>U(a,t),children:[e.jsxs(C,{sx:{cursor:"text"},children:[a+1,". ",N(O)," to"," ",N(fe)," "]}),e.jsxs(C,{children:[t!=null&&t.startTime?I(new Date(t.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",t!=null&&t.endTime?I(new Date(t.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",e.jsx("span",{style:{color:f?"orange":"blue",cursor:"pointer"},onClick:ge=>{ge.stopPropagation(),p(t)},children:"...see more"})]})]},a)})]})]})]}),e.jsx(Pe,{open:Y,onClose:E,children:e.jsxs(Ve,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[e.jsxs($e,{children:[e.jsx(C,{variant:"h6",component:"div",children:"Trip Details"}),e.jsxs(C,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Location:"})," ",((Z=(Q=l==null?void 0:l.startLocation)==null?void 0:Q.address)==null?void 0:Z.display_name)||"N/A"]}),e.jsxs(C,{sx:{mt:2},children:[e.jsx("strong",{children:"End Location:"})," ",((te=(ee=l==null?void 0:l.endLocation)==null?void 0:ee.address)==null?void 0:te.display_name)||"N/A"]}),e.jsxs(C,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Time:"})," ",l!=null&&l.startTime?I(new Date(l.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),e.jsxs(C,{sx:{mt:2},children:[e.jsx("strong",{children:"End Time:"})," ",l!=null&&l.endTime?I(new Date(l.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),e.jsx(We,{children:e.jsx(V,{onClick:E,children:"Close"})})]})})]})},rt=at;function Yt(){const{w_customer_id:s}=T(n=>n.auth),{collapsed:o}=T(n=>n.auth),{mode:m,selectedVehicleGroup:j}=T(n=>n.dashboard),{vehicleList:d,selectedVehicle:u}=T(n=>n.liveMap),[S,f]=r.useState(!1),[g,x]=r.useState(!0),[c,i]=r.useState([]),[A,y]=r.useState(!1);r.useState([]);const[Y,F]=r.useState({lat:18.516726,lng:73.856255});r.useState([]);const[l,L]=r.useState(!1),R=X(m);let k=W();r.useEffect(()=>{B()},[]),r.useEffect(()=>{var n,v,w;Object.keys(u).length===0&&d.length>0&&k(Ae({imei:(v=(n=d[0])==null?void 0:n.imei[0])==null?void 0:v.mac_id,reg_id:(w=d[0])==null?void 0:w.registration_id}))},[u,d]);const B=async()=>{try{let n=[],v=[];const w=await k(ke({w_customer_id:s}));if(Array.isArray(w.payload)){w.payload.forEach(p=>{var E,N,P;Array.isArray(p.imei)&&p.imei.length>0&&((E=p.imei[0])!=null&&E.mac_id)?(n.push({id:p.id,label:p.registration_id,value:(N=p.imei[0])==null?void 0:N.mac_id,workShop:p==null?void 0:p.workshop,vehicle_group:p==null?void 0:p.vehicle_group}),v.push((P=p.imei[0])==null?void 0:P.mac_id)):console.error("IMEI data not found for item:",p)});const _="one",U=v;v.length>0&&k(_e({type:_,imei:U})),k(Ye({w_customer_id:s})),i(n)}else console.error("Unexpected data format:",w),q.error("Unexpected data format:")}catch(n){console.error("Error fetching vehicle data:",n),q.error(`Error fetching vehicle data: ${n}`)}},G=c.filter(n=>Object.keys(j).length===0||n.vehicle_group===j.id);return e.jsxs("div",{className:"app",children:[e.jsx(Ie,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Le,{title:"Trip Monitor",setShowVehicles:f,showVehicles:S,setShowCard:x,showCard:g,sideBarTrip:A,setSideBarTrip:y,setShowVehiclesGroup:L,showVehiclesGroup:l}),e.jsx(qe,{setShowVehiclesGroup:L,showVehiclesGroup:l,where:"tripmonitor"}),e.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(h,{style:{width:S||A?"80%":"100%"},children:e.jsx(Ne,{center:Y,showCard:g})}),S&&e.jsx(h,{style:{width:"20%",backgroundColor:R.grey[100]},children:e.jsx(Ee,{vehicleData:G,setShowVehicles:f,showVehicles:S,title:"Live Monitor"})}),e.jsx(h,{style:{width:o?"22%":"20%",display:A?"block":"none",backgroundColor:R.grey[100]},children:e.jsx(rt,{})})]})]})]})}export{Yt as default};
