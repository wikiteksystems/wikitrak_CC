import{R as K,o as V,j as e,E as U,dy as $,dz as z,m as F,cM as G,dA as H,bK as Q,r,B as h,dG as Y,dH as A,dK as q,dL as X,dQ as Z,dP as ee,p as L,ae as T,a3 as se,a4 as ae,a6 as te,y as B,Y as re,w as oe}from"./index-DEjL_ux7.js";import{V as ne}from"./VehicleMenu-DW08gx83.js";import{P as ie}from"./Parameters-BAmCkyx7.js";/* empty css           */import{C as ce,S as le}from"./ServiceRecordTable-C2fEltAT.js";import{S as de}from"./ServiceJobCardTable-V9NW2O15.js";import{S as he}from"./ServicesTopBar-Cjy0iPaL.js";import"./Autocomplete-Dixf9GFs.js";import"./index.esm-CVnqYht4.js";import"./formik.esm-DM9rwmRT.js";import"./excelUtils-CWirCKt9.js";import"./Edit-2cfH9LPZ.js";function pe(){const[n,t]=K.useState(!1);V();const i=()=>t(!0),l=()=>t(!1);return e.jsxs("div",{children:[e.jsx(U,{variant:"outlined",onClick:i,children:"+ Add New Entry"}),e.jsxs($,{open:n,onClose:l,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[e.jsxs(z,{children:["+ Add new service entry",e.jsx(F,{"aria-label":"close",onClick:l,sx:{position:"absolute",right:8,top:8},children:e.jsx(G,{})})]}),e.jsx(H,{dividers:!0,children:e.jsx(ce,{setOpen:t})})]})]})}function ue(){const[n]=Q(),t=n.get("tab"),[i,l]=r.useState(0);r.useEffect(()=>{t&&l(Number(t))},[]);const g=(D,m)=>{l(m)};return e.jsxs(h,{sx:{width:"100%"},children:[e.jsx(h,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Y,{value:i,onChange:g,"aria-label":"Breakdown Tabs",children:[e.jsx(A,{label:"Service Tickets"}),e.jsx(A,{label:"Service Job Cards"})]})}),e.jsxs(h,{sx:{mt:2},children:[i===0&&e.jsx(le,{isInspection:!1}),i===1&&e.jsx(de,{isInspection:!1})]})]})}const xe=()=>{const n=V();r.useEffect(()=>{n(q()),n(X()),n(Z())},[]);let t=ee("Service");const i=(t==null?void 0:t.includes("Create"))||t==="Read-Write-Only";return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),i&&e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(pe,{})}),"      "]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(ue,{})})]})]})},fe=xe;function Ve(){const{locationData:n,selectedVehicle:t,selectedParameterList:i}=L(a=>a.liveMap),{mode:l}=L(a=>a.dashboard),g=oe(l),[D,m]=r.useState([]),{w_customer_id:I}=L(a=>a.auth),[M,y]=r.useState(),[j,E]=r.useState(!1),[v,k]=r.useState(!1),[S,b]=r.useState([]),[R,N]=r.useState(!0),[O,_]=r.useState(!1);let x=V();r.useEffect(()=>{W()},[]),r.useEffect(()=>{b([]),x(T([{reg_id:"",imei:"",params:[]}]))},[t]);const W=async()=>{try{_(!0);let a=[],c=[];const p=await x(se({w_customer_id:I}));if(Array.isArray(p.payload)){p.payload.forEach(s=>{var u,d,P,o;Array.isArray(s.imei)&&s.imei.length>0&&((u=s.imei[0])!=null&&u.mac_id)?(a.push({id:s.id,label:s.registration_id,value:(d=s.imei[0])==null?void 0:d.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(P=s==null?void 0:s.vehicle_model)==null?void 0:P.name}),c.push((o=s.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",s)});const C="one",w=c;c.length>0&&x(ae({type:C,imei:w})),m(a),x(te(a)),_(!1)}else _(!1),console.error("Unexpected data format:",p),B.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),B.error(`Error fetching vehicle data: ${a}`)}},J=async a=>{const{label:c,imei:p,id:C,reg_id:w,checked:s}=a;y(o=>o.map(f=>f.id===C?{...f,checked:!s}:f));let u=[...S],d=[...S];if(!s)n.forEach(o=>{o.latestDocument.imei===p&&(u.push({label:c,value:o.latestDocument[c==="maininputvoltage"?"mainInputVoltage":c]}),d=u,b(u))});else{let o=S.filter(f=>f.label!==c);d=o,b(o)}console.log("tempParamList",d),x(T([{reg_id:w,imei:p,params:d}]))};return e.jsxs("div",{className:"app",children:[e.jsx(re,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(he,{title:"services",setShowVehicles:E,showVehicles:j,showParameters:v,setShowParameters:k,setShowCard:N,showCard:R}),e.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(h,{style:{width:j||v?"80%":"100%"},children:e.jsx(fe,{})}),j&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ne,{vehicleData:D,title:"Inspections",setParameterData:y,loadingVehicle:O,setShowVehicles:E,showVehicles:j,showParameters:v,setShowParameters:k})}),v&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ie,{parametersData:M,setParameterData:y,handleParameterChange:J})})]})]})]})}export{Ve as default};
