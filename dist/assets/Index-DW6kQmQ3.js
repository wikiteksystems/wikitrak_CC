import{R as U,o as D,j as e,D as $,ag as F,ah as q,m as z,ac as G,ai as H,bI as K,r,B as h,ds as Q,dt as T,dw as X,dx as Y,dC as Z,dB as ee,p as V,al as A,a0 as se,a1 as ae,a3 as te,x as B,V as re,v as oe}from"./index-Cp4QFi0W.js";import{V as ie}from"./VehicleMenu-Cl7KVXk5.js";import"./Loader-Du2YI5Q4.js";import"./LiveMapServices-BxiCdl_C.js";import{P as ne}from"./Parameters-CI0qdzwc.js";/* empty css           */import{C as ce,S as le}from"./ServiceRecordTable-BJa7wQCj.js";import{S as de}from"./ServiceJobCardTable-BemKYRWT.js";import{S as he}from"./ServicesTopBar-BEgtO04z.js";import"./Autocomplete-sE5ONsgP.js";import"./TextField-DDxAz2Ki.js";import"./Card-Boprh9Dj.js";import"./CardContent-VKOGL9Uv.js";import"./index.esm-CnKBoDe4.js";import"./formik.esm-Bm3T1UYG.js";import"./excelUtils-B6Yt8QvY.js";import"./Edit-OuhzljC0.js";function pe(){const[i,t]=U.useState(!1);D();const n=()=>t(!0),l=()=>t(!1);return e.jsxs("div",{children:[e.jsx($,{variant:"outlined",onClick:n,children:"+ Add New Entry"}),e.jsxs(F,{open:i,onClose:l,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[e.jsxs(q,{children:["+ Add new service entry",e.jsx(z,{"aria-label":"close",onClick:l,sx:{position:"absolute",right:8,top:8},children:e.jsx(G,{})})]}),e.jsx(H,{dividers:!0,children:e.jsx(ce,{setOpen:t})})]})]})}function ue(){const[i]=K(),t=i.get("tab"),[n,l]=r.useState(0);r.useEffect(()=>{t&&l(Number(t))},[]);const g=(L,m)=>{l(m)};return e.jsxs(h,{sx:{width:"100%"},children:[e.jsx(h,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Q,{value:n,onChange:g,"aria-label":"Breakdown Tabs",children:[e.jsx(T,{label:"Service Tickets"}),e.jsx(T,{label:"Service Job Cards"})]})}),e.jsxs(h,{sx:{mt:2},children:[n===0&&e.jsx(le,{isInspection:!1}),n===1&&e.jsx(de,{isInspection:!1})]})]})}const xe=()=>{const i=D();r.useEffect(()=>{i(X()),i(Y()),i(Z())},[]);let t=ee("Service");const n=(t==null?void 0:t.includes("Create"))||t==="Read-Write-Only";return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),n&&e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(pe,{})}),"      "]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(ue,{})})]})]})},fe=xe;function Ae(){const{locationData:i,selectedVehicle:t,selectedParameterList:n}=V(a=>a.liveMap),{mode:l}=V(a=>a.dashboard),g=oe(l),[L,m]=r.useState([]),{w_customer_id:I}=V(a=>a.auth),[M,S]=r.useState(),[v,k]=r.useState(!1),[j,E]=r.useState(!1),[y,b]=r.useState([]),[R,N]=r.useState(!0),[O,_]=r.useState(!1);let x=D();r.useEffect(()=>{W()},[]),r.useEffect(()=>{b([]),x(A([{reg_id:"",imei:"",params:[]}]))},[t]);const W=async()=>{try{_(!0);let a=[],c=[];const p=await x(se({w_customer_id:I}));if(Array.isArray(p.payload)){p.payload.forEach(s=>{var u,d,P,o;Array.isArray(s.imei)&&s.imei.length>0&&((u=s.imei[0])!=null&&u.mac_id)?(a.push({id:s.id,label:s.registration_id,value:(d=s.imei[0])==null?void 0:d.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(P=s==null?void 0:s.vehicle_model)==null?void 0:P.name}),c.push((o=s.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",s)});const C="one",w=c;c.length>0&&x(ae({type:C,imei:w})),m(a),x(te(a)),_(!1)}else _(!1),console.error("Unexpected data format:",p),B.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),B.error(`Error fetching vehicle data: ${a}`)}},J=async a=>{const{label:c,imei:p,id:C,reg_id:w,checked:s}=a;S(o=>o.map(f=>f.id===C?{...f,checked:!s}:f));let u=[...y],d=[...y];if(!s)i.forEach(o=>{o.latestDocument.imei===p&&(u.push({label:c,value:o.latestDocument[c==="maininputvoltage"?"mainInputVoltage":c]}),d=u,b(u))});else{let o=y.filter(f=>f.label!==c);d=o,b(o)}console.log("tempParamList",d),x(A([{reg_id:w,imei:p,params:d}]))};return e.jsxs("div",{className:"app",children:[e.jsx(re,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(he,{title:"services",setShowVehicles:k,showVehicles:v,showParameters:j,setShowParameters:E,setShowCard:N,showCard:R}),e.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(h,{style:{width:v||j?"80%":"100%"},children:e.jsx(fe,{})}),v&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ie,{vehicleData:L,title:"Inspections",setParameterData:S,loadingVehicle:O,setShowVehicles:k,showVehicles:v,showParameters:j,setShowParameters:E})}),j&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ne,{parametersData:M,setParameterData:S,handleParameterChange:J})})]})]})]})}export{Ae as default};
