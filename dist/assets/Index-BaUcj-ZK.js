import{y as T,b as o,j as e,T as pe,F as K,B as W,x as B,aO as te,aP as Se,aQ as De,R as ae,U as Z,a4 as be,aR as _e,L as H,X as we,E as Ae,Y as Ce,an as Te,C as re,aS as he,aT as ke,aU as Ee,Z as Ie,aV as se,aW as ie,aX as oe,aY as le,aZ as Le,$ as Ne,a0 as Oe,a1 as Re,a3 as Ve,a5 as Me,a_ as $e}from"./index-2qwa_C6N.js";import{L as Pe}from"./LeftSideBar2-CcehIvzl.js";import{t as Fe}from"./Search-BeE3YBk3.js";import{D as ue,P as J,V as Ge,a as Be}from"./DateTimePicker-C_GxU6D7.js";import{F as Ye}from"./TopBar-CBZ0_tsD.js";import{V as He}from"./VehicleGroups-CdvA7MDc.js";import{T as ge,a as xe,b as fe,c as X,d,e as je}from"./TableRow-DcANcIqE.js";import{P as ve}from"./Paper-DHFVui5V.js";import{u as q,w as We}from"./excelUtils-D1Z0-2BH.js";import{B as b,C as ze}from"./CircularProgress-DKpyBPD3.js";import{N as Ue}from"./NewLoader-D_WWT4JL.js";import{S as V}from"./index-DWhyyRq5.js";import{I as Xe}from"./InspectionsTable-BPb6ojnA.js";import{S as Ke}from"./ServiceRecordTable-uHNRQg_w.js";import"./TripMap-CTsBWHZZ.js";import"./Loader-B_VA9rsF.js";import{T as ne}from"./Tooltip-yABlZkr0.js";import"./createSvgIcon-C3cRd_x5.js";import"./IconButton-BrND1_vM.js";import"./menu2-BCzTtSy4.js";import"./OutlinedInput-WgdAgE-B.js";import"./TripGraph-BZWqF1Ew.js";import"./useIcons-BetiYopp.js";import"./SearchOutlined-sYlKIti5.js";import"./button-krZ3nafF.js";import"./roundedArrow-DLNFiPpz.js";import"./index-s8UfsHCF.js";import"./NotificationsNone-BgtBB6QB.js";import"./Close-8WyII2w5.js";import"./usePreviousProps-CbL4Ol_d.js";import"./SearchTab-BZIU0kR2.js";import"./InputAdornment-CDJjHh2C.js";import"./TextField-G9G52kuZ.js";import"./Select-DwI_hWbf.js";import"./MenuItem-C6xxLimY.js";import"./DialogTitle-B7EjHANB.js";import"./DialogContentText-BpgzPLn0.js";import"./Edit-DZtmMN0h.js";import"./TablePagination-B09PX6_g.js";import"./index.esm-CXt6SHhk.js";import"./formik.esm-DINzsNk9.js";import"./Autocomplete-B7g0Ltei.js";import"./esm-BFt7xoYk.js";import"./redTractor-NXgVJyvR.js";import"./Info-C3TNZKjZ.js";import"./Card-nMod1s4S.js";import"./CardContent-DFTI0K6D.js";function Qe({countAlerts:w}){T(t=>t.dashboard),T(t=>t.report);const{driver_behavior_data:p,multipleVehicleReportsData:l}=T(t=>t.dashboard);T(t=>t.liveMap),o.useEffect(()=>{},[l,p]);let k=l.reduce((t,n)=>{var v;return t+=parseFloat((v=n==null?void 0:n.data)==null?void 0:v.totalDistance_)||0},0),u=l.reduce((t,n)=>{var v;return t+=parseFloat((v=n==null?void 0:n.data)==null?void 0:v.runningTime_)||0},0),I=l.reduce((t,n)=>{var v;return t+=parseFloat((v=n==null?void 0:n.data)==null?void 0:v.averageSpeed_)||0},0),a=p.reduce((t,n)=>t+=parseFloat(n.steadyTime),0),g=p.reduce((t,n)=>t+=parseFloat(n.overSpeedTime),0);const i=t=>{const n=Math.floor(t/3600),v=Math.floor(t%3600/60);return(t%60).toFixed(0),`${n}.${v}`},_=[{category:"Driving Metrics",metric:"Km Driven",value:(l==null?void 0:l.length)>0?`${parseFloat(k).toFixed(2)} km`:"0 km"},{category:"Driving Metrics",metric:"Hrs Driven",value:`${parseFloat(i(u)).toFixed(2)} hrs`},{category:"Driving Metrics",metric:"Idle Time",value:p&&a&&!isNaN(a)?`${i(a)} hrs`:"0 hrs"},{category:"Driving Metrics",metric:"Overspeed Time",value:p&&g&&!isNaN(g)?i(g):"0 hrs  "},{category:"Driving Metrics",metric:"Avg. Speed",value:(l==null?void 0:l.length)>0?`${(I/l.length).toFixed(2)} km/h`:"0 km/h"},{category:"Alerts",metric:"Outward Alerts",value:w.outward},{category:"Alerts",metric:"Inward Alerts",value:w.inward},{category:"Alerts",metric:"Speed Alerts",value:w.speed}],j=_.filter(t=>t.category==="Driving Metrics"),y=_.filter(t=>t.category==="Alerts");return e.jsx(ge,{component:ve,sx:{maxWidth:800,margin:"auto",mt:"20px"},children:e.jsxs(xe,{children:[e.jsx(fe,{children:e.jsxs(X,{children:[e.jsx(d,{sx:{fontWeight:"bold",textAlign:"center",backgroundColor:"primary.light",color:"white"},colSpan:2,children:"Driving Metrics"}),e.jsx(d,{sx:{fontWeight:"bold",textAlign:"center",backgroundColor:"primary.light",color:"white"},colSpan:2,children:"Alerts"})]})}),e.jsx(je,{children:j.map((t,n)=>e.jsxs(X,{children:[e.jsx(d,{children:t.metric}),e.jsx(d,{sx:{textAlign:"right"},children:t.value}),y[n]?e.jsxs(e.Fragment,{children:[e.jsx(d,{children:y[n].metric}),e.jsx(d,{sx:{textAlign:"right"},children:y[n].value})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{}),e.jsx(d,{})]})]},n))})]})})}function Q({handleBack:w,downloadData:p}){o.useEffect(()=>{},[p]);const l=()=>{if(p.length===0){W.error("No data available for download.");return}const k=q.json_to_sheet(p),u=q.book_new();q.book_append_sheet(u,k,"Sheet1"),We(u,"Report.xlsx"),W.success("Excel file downloaded successfully!")};return e.jsx(b,{sx:{backgroundColor:"white",mb:2,display:"flex",textAlign:"center",justifyContent:"end",alignItems:"center",padding:"10px 20px",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(pe,{sx:{fontWeight:"bold",mr:1},children:"Download In:"}),e.jsx(K,{variant:"outlined",onClick:l,sx:{borderColor:"green",color:"green","&:hover":{backgroundColor:"green",color:"white"}},children:"EXCEL"})]})})}const Ze=w=>{const p=Math.floor(w/3600),l=Math.floor(w%3600/60);return(w%60).toFixed(0),`${p}.${l}`},ce={outward:0,inward:0,speed:0};function qe({handleBack:w,setStartDate:p,startDate:l,setEndDate:k,endDate:u}){const{alerts:I,allAlerts:a}=T(s=>s.report),{driver_behavior:g,driver_behavior_data:i,multipleVehicleReportsData:_}=T(s=>s.dashboard);T(s=>s.report);const{vehicleGroup:j,vehicleList:y}=T(s=>s.liveMap),[t,n]=o.useState(ce),[v,A]=o.useState([]),[x,f]=o.useState([]),[m,O]=o.useState([]),[S,N]=o.useState("All"),[L,c]=o.useState(null),[r,E]=o.useState(!1),$=B();o.useEffect(()=>{const s={...ce};a.forEach(D=>{D.type==="Geofence Alert"?D.geofance_type==="inward"?s.inward+=1:D.geofance_type==="outward"&&(s.outward+=1):D.type==="Speed Alert"&&(s.speed+=1)}),n(s);const h=[{name:"Outward Alerts",value:s.outward},{name:"Inward Alerts",value:s.inward},{name:"Speed Alerts",value:s.speed}];f(h)},[a]),o.useEffect(()=>{if(j&&j.length>0){let s=j.map(h=>({...h,label:h.group_name,value:h.id}));O(s)}},[j,y]);const Y=s=>{let h=y.find(D=>{var M;return((M=D==null?void 0:D.imei[0])==null?void 0:M.mac_id)==s});return(h==null?void 0:h.registration_id)||s},P=(s,h,D)=>{console.log("data1",s),console.log("data2",h),console.log("data3",D);let M=s.map(C=>{var ee;let ye=(ee=h.find(G=>G.imei===C.imei))==null?void 0:ee.data;const U={outward:0,inward:0,speed:0};return D.forEach(G=>{G.imei===C.imei&&(G.type==="Geofence Alert"?G.geofance_type==="inward"?U.inward+=1:G.geofance_type==="outward"&&(U.outward+=1):G.type==="Speed Alert"&&(U.speed+=1))}),{...C,...ye,...U}});console.log("vehicle report data",M);let me=M.map(C=>({"Vehicle Name":Y(C.imei),"IMEI NO":C.imei,"KM Driven":C.totalDistance,"Hrs Driven":C.runningTime,"Idel Time":C!=null&&C.steadyTime&&!isNaN(C==null?void 0:C.steadyTime)?`${Ze(C==null?void 0:C.steadyTime)} hrs`:"0 hrs","Over speed time":C.overSpeedTime,"Avg speed":C.averageSpeed,"Outward alert":C.outward,"Inward alert":C.inward,"Speed alert":C.speed}));A(me)};o.useEffect(()=>{i.length>0&&te.length>0&&P(i,_,a)},[i,_,a]);function F(s){console.log("value changed",s),N(s)}const z=async()=>{E(!0);try{const s=$(te({imei:L,startDate:l,endDate:u})),h=$(Se({imei:L,startDate:l,endDate:u})),D=$(De({imeiList:L,startDate:l,endDate:u}));await Promise.all([s,h,D]),E(!1),console.log("Report fetched successfully.")}catch(s){E(!1),console.error("Error fetching report:",s),W.error("An error occurred while fetching the report.")}},R=S==="All"?y:y.filter(s=>s.vehicle_group===S);return e.jsxs(b,{sx:{width:"100%",padding:"10px"},children:[r&&e.jsx(Ue,{}),e.jsx(Q,{handleBack:w,downloadData:v}),e.jsxs(b,{children:[e.jsxs(V,{size:"large",value:S,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:F,filterOption:(s,h)=>{var D;return typeof((D=h==null?void 0:h.props)==null?void 0:D.children)=="string"&&h.props.children.toLowerCase().indexOf(s.toLowerCase())>=0},children:[e.jsx(V.Option,{value:"All",children:"All"}),m.map((s,h)=>e.jsx(V.Option,{value:s.value,children:s.label},h))]}),e.jsxs(V,{size:"large",mode:"multiple",showSearch:!0,value:L||[],style:{width:300,margin:"10px"},placeholder:"Select vehicles",maxTagCount:1,maxTagPlaceholder:s=>`+${s.length} more`,optionFilterProp:"children",onChange:s=>{s.includes("all")?(L==null?void 0:L.length)===R.length?c([]):c(R.map(h=>{var D;return(D=h.imei[0])==null?void 0:D.mac_id})):c(s)},filterOption:(s,h)=>{var D,M;return(M=(D=h==null?void 0:h.children)==null?void 0:D.toLowerCase())==null?void 0:M.includes(s.toLowerCase())},children:[e.jsx(V.Option,{value:"all",children:"Select All Vehicles"},"all"),R&&R.length>0&&R.map((s,h)=>{var D;return e.jsx(V.Option,{value:(D=s.imei[0])==null?void 0:D.mac_id,children:s.registration_id},h)})]}),e.jsx(ue,{setStartDate:p,setEndDate:k,selectedDate:!1}),e.jsx(K,{variant:"contained",style:{width:200,marginLeft:"10px"},onClick:z,disabled:!L,children:"Generate report"})]}),e.jsxs(b,{sx:{display:"flex",gap:"10px"},children:[e.jsx(b,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(J,{chartData:x,title:"Alerts Distribution"})}),e.jsxs(b,{sx:{width:"60%",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(pe,{variant:"h6",sx:{fontWeight:600,textAlign:"center",m:"0 30px"}}),e.jsx(Ge,{})]})]}),e.jsx(Qe,{countAlerts:t})]})}const de={vehicleNo:"B35965",type:"Sprayer",operator:"Arjun",inspectionDate:"15/09/24",status:"Open",partsFailure:"Oil Pump, Filter",submittedBy:"Yograj"};function Je({handleBack:w}){const{inspectionHistory:p}=T(x=>x.inspection),{breakdowns:l}=T(x=>x.breakdown),{w_customer_id:k}=T(x=>x.auth),[u,I]=o.useState([]),[a,g]=o.useState([]),[i,_]=o.useState({});o.useState(de);const[j,y]=ae.useState(),[t,n]=ae.useState();let v=B();o.useEffect(()=>{v(Z()),v(be(k)),v(_e())},[]),o.useEffect(()=>{if(p.length>0){let x={open:0,rejected:0,close:0};({...de},p.map(f=>{f.status==="Open"&&(f!=null&&f.breakdown)&&x.open++,f.status==="Close"&&(f!=null&&f.breakdown)&&x.close++,f.status==="Rejected"&&(f!=null&&f.breakdown)&&x.rejected++})),_(x)}},[p]),o.useEffect(()=>{const x=[{name:"Rejected",value:i.rejected},{name:"Pending",value:i.open},{name:"Approved",value:i.close}];g(x)},[i]),o.useEffect(()=>{let x=[];if(console.log("inspection history",p),p.forEach(f=>{var Y,P,F,z;const{breakdown:m,inspection_parts_inspection:O,status:S,submitted_by:N,resolved_issue:L,pending_issue:c,vehicle:r}=f;console.log("breakdown",m);const E=O&&O.length>0?O.map((R,s)=>{var h;return`${(h=R==null?void 0:R.spare_parts)==null?void 0:h.description}: Qty ${R==null?void 0:R.quantity}`}).join("; "):"N/A";let $={Vehicle:r==null?void 0:r.registration_id,BDID:(m==null?void 0:m.breakdown_id)||"","Breakdown Topic":(Y=m==null?void 0:m.breakdown_topic)==null?void 0:Y.topic,"Resolved issue":L,"Pending issue":c,"Spare Parts":E,user:`${((P=N==null?void 0:N.us_user)==null?void 0:P.first_name)||""} ${((F=N==null?void 0:N.us_user)==null?void 0:F.last_name)||""}`,"Submission Date":(m==null?void 0:m.submission_date)&&H.utc(m==null?void 0:m.submission_date).local().format("YYYY-MM-DD")||"N/A","Submission Time":(m==null?void 0:m.submission_date)&&H.utc(m==null?void 0:m.submission_date).local().format("HH:mm A")||"N/A",workshop:((z=f==null?void 0:f.workshop_group)==null?void 0:z.group_name)||"",status:S};x.push($)}),Object.keys(i).length>0){let f={BDID:"Inspection Status",user:"","Submission Date":"",workshop:`Rejected: ${i.rejected||0}, Pending: ${i.open||0}, Approved: ${i.close||0}`};x.push(f)}I(x)},[l,i]);const A=()=>{if(j&&t){let x={startDate:H(new Date(j)).format("YYYY-MM-DD"),endDate:H(new Date(t)).format("YYYY-MM-DD")};v(Z(x))}else v(Z())};return e.jsxs(b,{sx:{width:"100%",m:"auto"},children:[e.jsx(Q,{handleBack:w,downloadData:u}),e.jsxs(b,{sx:{display:"flex",m:"10px"},children:[e.jsx(Be,{setStartDate:y,setEndDate:n,selectedDate:!1}),e.jsx(K,{sx:{ml:"20px",background:"rgb(141, 166, 198)",color:"white"},onClick:()=>A(),children:"Apply"})]}),e.jsxs(b,{sx:{display:"flex",gap:"40px"},children:[e.jsx(Xe,{where:"inspection report"}),e.jsx(b,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(J,{chartData:a,title:"Inspection Status"})})]})]})}function et({handleBack:w}){const{overdueCount:p,completedCount:l,serviceSoonCount:k}=T(j=>j.dashboard),{servicesData:u}=T(j=>j.services),[I,a]=o.useState([]),[g,i]=o.useState([]);let _=B();return o.useEffect(()=>{_(we())},[]),o.useEffect(()=>{i([{name:"Over Due",value:p},{name:"Due Soon",value:k},{name:"Serviced",value:l}])},[p,k,l]),o.useEffect(()=>{console.log("servicesData",u);let j=[];u.forEach(t=>{var v,A,x,f,m,O,S,N;let n={SRID:t==null?void 0:t.service_record_id,Vehicle:((v=t==null?void 0:t.vehicle)==null?void 0:v.registration_id)||"",user:`${((x=(A=t==null?void 0:t.user)==null?void 0:A.us_user)==null?void 0:x.first_name)||""} ${((m=(f=t==null?void 0:t.user)==null?void 0:f.us_user)==null?void 0:m.last_name)||""}`,Vehicle_group:((S=(O=t==null?void 0:t.vehicle)==null?void 0:O.vehicle_group)==null?void 0:S.group_name)||"",Priority_Class:(t==null?void 0:t.priority_class)||"","Entry Date":H(new Date(t==null?void 0:t.created)).format("DD-MM-YYYY"),"Entry Time":H(new Date(t==null?void 0:t.created)).format("HH:mm A"),Completion_Date:(t==null?void 0:t.completion_date)||"",Next_Due_Date:(t==null?void 0:t.next_due_date)||"",Segment:((N=t==null?void 0:t.segment)==null?void 0:N.segment_name)||"",status:t==null?void 0:t.status};j.push(n)});let y={Vehicle:"Service Status",user:"",Priority_Class:"",Completion_Date:`Over Due: ${p||0}, Due Soon: ${k||0}, Serviced: ${l||0}`};j.push(y),a(j)},[u,l]),e.jsxs(b,{sx:{width:"100%",m:"auto"},children:[e.jsx(b,{sx:{ml:"10px"},children:e.jsx(Q,{handleBack:w,downloadData:I})}),e.jsx(Ke,{where:"service report"}),e.jsx(b,{sx:{display:"flex",gap:"40px",justifyContent:"center",paddingBottom:"50px"},children:e.jsx(b,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(J,{chartData:g,title:"Service Status"})})})]})}function tt({tableData:w}){const{vehicleList:p}=T(a=>a.liveMap),l=B(),k=Ae();console.log("tableData: ",w);let u=a=>p.find(g=>{var i;return((i=g==null?void 0:g.imei[0])==null?void 0:i.mac_id)==a||""});const I=a=>{var g;l(Ce({imei:a==null?void 0:a.imei,reg_id:(g=u(a.imei))==null?void 0:g.registration_id})),l(Te({startDate:re(a.date).startOf("day").toISOString(),endDate:re(a.date).endOf("day").toISOString()})),k("/trip-monitor?source=TripDetail")};return e.jsx(ge,{component:ve,sx:{maxHeight:"70vh"},children:e.jsxs(xe,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(fe,{children:e.jsxs(X,{children:[e.jsx(d,{align:"left",children:"Date"}),e.jsx(d,{align:"left",children:"Vehicle Name"}),e.jsx(d,{align:"left",children:"Start location"}),e.jsx(d,{align:"left",children:"End location"}),e.jsx(d,{align:"left",children:"Segment"}),e.jsx(d,{align:"left",children:"Operator"}),e.jsx(d,{align:"left",children:"Work done (acre)"}),e.jsx(d,{align:"left",children:"Engine hours"}),e.jsx(d,{align:"left",children:"Running Time"}),e.jsx(d,{align:"left",children:"Idle time"}),e.jsx(d,{align:"left",children:"Total Distance (km)"}),e.jsx(d,{align:"left",children:"Average Speed"}),e.jsx(d,{align:"left",children:"View Trips"})]})}),e.jsx(je,{children:w.map((a,g)=>{var i,_,j,y,t,n,v;return e.jsxs(X,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(d,{align:"left",children:a.date}),e.jsx(d,{align:"left",children:(i=u(a.imei))==null?void 0:i.registration_id}),e.jsx(d,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ne,{title:((_=a==null?void 0:a.startLocationName)==null?void 0:_.display_name)||(a==null?void 0:a.startLocationName)||"",children:e.jsx("span",{children:((j=a==null?void 0:a.startLocationName)==null?void 0:j.display_name)||(a==null?void 0:a.startLocationName)||""})})}),e.jsx(d,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ne,{title:((y=a==null?void 0:a.endLocationName)==null?void 0:y.display_name)||(a==null?void 0:a.endLocationName)||"",children:e.jsx("span",{children:((t=a==null?void 0:a.endLocationName)==null?void 0:t.display_name)||(a==null?void 0:a.endLocationName)||""})})}),e.jsx(d,{align:"left",children:(n=u(a.imei))==null?void 0:n.segment}),e.jsx(d,{align:"left",children:(v=u(a.imei))==null?void 0:v.customer_name}),e.jsx(d,{align:"left",children:a.acreageStr}),e.jsx(d,{align:"left",children:a.engineHours}),e.jsx(d,{align:"left",children:a.runningTime}),e.jsx(d,{align:"left",children:a.idleTime}),e.jsx(d,{align:"left",children:a.totalDistance}),e.jsx(d,{align:"left",children:a.averageSpeed}),e.jsx(d,{align:"left",children:e.jsx(b,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>I(a),children:"View on Map ðŸ”"})})]},g+1)})})]})})}function at({handleBack:w,setStartDate:p,startDate:l,setEndDate:k,endDate:u}){const I=B(),{vehicleGroup:a,vehicleList:g}=T(c=>c.liveMap),{vehicleStatesData:i,loading:_,selectedGroup:j,selectedVehicle:y,distributorList:t}=T(c=>c.report),[n,v]=o.useState([]);o.useState([]);const[A,x]=o.useState([]);o.useEffect(()=>{},[_]),o.useEffect(()=>{if(a&&a.length>0){let c=a.map(r=>({...r,label:r.group_name,value:r.id}));v(c)}},[a,g,t]),o.useEffect(()=>{},[l,u]);let f=c=>g.find(r=>{var E;return((E=r==null?void 0:r.imei[0])==null?void 0:E.mac_id)==c||""});o.useEffect(()=>{let c=(i==null?void 0:i.data)&&i.data.map(r=>{var P,F;let{customer_name:E,registration_id:$,segment:Y}=f(r==null?void 0:r.imei);return{Date:r.date,vehicle:$,"Start Location":(P=r==null?void 0:r.startLocationName)==null?void 0:P.display_name,"End Location":(F=r==null?void 0:r.endLocationName)==null?void 0:F.display_name,operator:E,segment:Y,"Work Done":r==null?void 0:r.acreageStr,"Running Time":r.runningTime,"Idle Time":r.idleTime,"Engine hours":r.engineHours,"Total Distance (km)":r.totalDistance,"Average Speed":r.averageSpeed}});x(c)},[i]),o.useEffect(()=>{y||I(he())},[]);function m(c){console.log("value changed",c),I(ke(c))}function O(c){I(Ee(c))}const S=async()=>{const c=`${l} 00:00`,r=`${u} 23:59`;if(!N())return;I(Ie({imei:y,startTime:c,endTime:r}))},N=()=>!l||!u||y==="all"?(W.error("Please select start date, end date, and vehicle."),!1):!0,L=j==="All"?g:g.filter(c=>c.vehicle_group===j);return e.jsxs(b,{sx:{width:"100%",m:"auto"},children:[e.jsx(b,{sx:{ml:"10px"},children:e.jsx(Q,{handleBack:w,downloadData:A})}),e.jsxs(b,{children:[e.jsxs(V,{size:"large",value:j,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:m,filterOption:(c,r)=>{var E;return typeof((E=r==null?void 0:r.props)==null?void 0:E.children)=="string"&&r.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(V.Option,{value:"All",children:"All"}),n.map((c,r)=>e.jsx(V.Option,{value:c.value,children:c.label},r))]}),e.jsxs(V,{size:"large",value:y,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:O,filterOption:(c,r)=>{var E;return typeof((E=r==null?void 0:r.props)==null?void 0:E.children)=="string"&&r.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(V.Option,{value:"all",children:"None"},"all"),L&&L.length>0&&L.map((c,r)=>{var E;return e.jsx(V.Option,{value:(E=c.imei[0])==null?void 0:E.mac_id,children:c.registration_id},r)})]}),e.jsx(ue,{setStartDate:p,setEndDate:k,selectedDate:!1,startDate:l,endDate:u}),e.jsx(K,{variant:"contained",style:{width:200,marginLeft:"10px"},onClick:S,disabled:!y,children:"Generate report"})]}),_&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(ze,{})}),(i==null?void 0:i.data)&&(i==null?void 0:i.data.length)>0&&e.jsx(b,{ml:1.5,children:e.jsx(tt,{tableData:(i==null?void 0:i.data)||[]})})]})}function rt({showCard:w,setReportType:p,reportType:l}){T(_=>_.dashboard),T(_=>_.liveMap);const{startDate:k,endDate:u}=T(_=>_.report),[I,a]=o.useState(!0);o.useState({}),o.useState(!1);let g=B();o.useEffect(()=>{},[u]),o.useEffect(()=>{g(se()),g(ie())},[]);const i=()=>{g(he()),g(se()),g(ie()),g(p(null))};return e.jsx(e.Fragment,{children:e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignItems:"center",gap:2,padding:2},children:l==="Vehicle"?e.jsx(qe,{handleBack:i,selectedDate:I,setEndDate:oe,setStartDate:le,startDate:k,endDate:u}):l==="Service"?e.jsx(et,{handleBack:i}):l==="Inspection"?e.jsx(Je,{handleBack:i}):e.jsx(at,{handleBack:i,selectedDate:I,setEndDate:oe,setStartDate:le,startDate:k,endDate:u})})})}function Zt(){const{mode:w,showVehicles:p,selectedVehicleGroup:l}=T(A=>A.dashboard),{w_customer_id:k}=T(A=>A.auth),{reportType:u}=T(A=>A.report),[I,a]=o.useState([]),[g,i]=o.useState(!0),[_,j]=o.useState(!1),y=Fe(w);let t=B();o.useEffect(()=>{v(),n()},[]);const n=()=>{t(Le())},v=async()=>{try{let A=[],x=[];const f=await t(Ne({w_customer_id:k}));if(Array.isArray(f.payload)){f.payload.forEach(S=>{var N,L;Array.isArray(S.imei)&&S.imei.length>0?(A.push({id:S.id,label:S.registration_id,value:(N=S==null?void 0:S.imei[0])==null?void 0:N.mac_id,workShop:S==null?void 0:S.workshop,vehicle_group:S==null?void 0:S.vehicle_group}),x.push((L=S.imei[0])==null?void 0:L.mac_id)):console.error("IMEI data not found for item:",S)});const m="one",O=x;x.length>0&&(t(Oe({type:m,imei:O})),t(Re(O))),a(A),t(Ve({w_customer_id:k})),t(Me({}))}else console.error("Unexpected data format:",f),W.error("Unexpected data format:")}catch(A){console.error("Error fetching vehicle data:",A),W.error(`Error fetching vehicle data: ${A}`)}};return I.filter(A=>Object.keys(l).length===0||A.vehicle_group===l.id),e.jsxs("div",{className:"app",children:[e.jsx(Pe,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:y.grey[100]},children:[e.jsx(Ye,{title:"Report",setShowVehiclesGroup:j,showVehiclesGroup:_,reportType:u}),e.jsx(He,{setShowVehiclesGroup:j,showVehiclesGroup:_}),e.jsxs(b,{style:{display:"flex",width:"100%",height:"95vh",background:y.grey[200]},children:[e.jsx(b,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(b,{style:{width:p?"85%":"100%"},children:e.jsx(rt,{showCard:g,setReportType:$e,reportType:u})})}),p&&e.jsx(b,{sx:{position:"fixed",width:"18%",right:"0px",height:"90vh",zIndex:9999,backgroundColor:y.grey[100],borderLeft:`1px solid ${y.grey[300]}`,borderRadius:"2px"}})]})]})]})}export{Zt as default};
