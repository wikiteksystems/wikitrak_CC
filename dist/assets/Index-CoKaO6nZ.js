import{$ as Ve,j as e,k as b,r as l,i as Y,t as F,B as P,T as R,ac as xe,I as pe,ad as ct,ae as dt,af as xt,ag as gt,ah as ee,w as _,ai as pt,aj as ht,ak as Be,Q as ut,K as ft,L as mt,N as wt}from"./index-C7djJrok.js";import{b as jt,c as bt,w as yt,e as St,f as vt,t as Q,L as Ct}from"./LeftSideBar2-BizutsZJ.js";import{r as Ye}from"./createSvgIcon-BUtz0YNc.js";import{d as At}from"./NotificationsNone-B6yP2KWd.js";import{d as ze}from"./Close-BU9iePlT.js";import{j as kt}from"./jcb-aCHXMCXy.js";import{B as a,b as Xe}from"./menu2-CgqAzvxA.js";import{V as Rt}from"./VehicleMenu-B9eo7SHW.js";import{G as Dt}from"./GeofencAlert-DsSV_YFJ.js";import{V as Ue,a as Je}from"./Form-BIByHzep.js";import{F as Ot}from"./formik.esm-C_VKf48u.js";import{c as It,a as Ke,b as Et}from"./index.esm-CUwzG0B3.js";import{u as Pt}from"./useMediaQuery-C-L_N_MI.js";import{T as He,I as Lt}from"./TextField-CWcA0cag.js";import{m as te,t as Nt,f as Qe,a as _t}from"./preet_tractor-CDwt_mVh.js";import{u as Ft,G as Gt,C as Wt,P as Mt,M as Bt}from"./esm-2IQ6u7-L.js";import{S as ge}from"./Switch-CUsBL7V2.js";/* empty css           */import"./proj-XQwXs9DQ.js";import"./useControlled-DnC386BS.js";import"./SwitchBase-m5UYsB-w.js";var he={},zt=Ve;Object.defineProperty(he,"__esModule",{value:!0});var Te=he.default=void 0,Xt=zt(Ye()),Ut=e;Te=he.default=(0,Xt.default)((0,Ut.jsx)("path",{d:"M12 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c2.7 0 5.8 1.29 6 2H6c.23-.72 3.31-2 6-2m0-12C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 10c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonOutlined");var ue={},Jt=Ve;Object.defineProperty(ue,"__esModule",{value:!0});var qe=ue.default=void 0,Kt=Jt(Ye()),Ht=e;qe=ue.default=(0,Kt.default)((0,Ht.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"Place");const Vt=({title:s,setShowContent:p,showContent:n,showMap:h,setShowMap:o,setShowGfBar:j,showGfBar:y,setShowGfAlert:d,showGfAlert:f})=>{const{collapsed:m}=b(k=>k.auth),{selectedVehicle:w}=b(k=>k.liveMap),{vehicleSideBar:x}=b(k=>k.geofence);l.useState(!1);const{mode:S}=b(k=>k.dashboard);JSON.parse(localStorage.getItem("w_userDetails"));const g=Y(),I=()=>{g(dt(!m))},v=()=>{p({...n,vehicle:!n.vehicle}),j(!1),d(!1),g(xe({data:!x}))};return e.jsxs(a,{display:"flex",justifyContent:"space-between",p:1,sx:{bgcolor:F.bgColor,border:"1px solid white",borderRadius:"4px",height:"55px"},children:[e.jsxs(a,{style:{display:"flex",justifyContent:"space-between",gap:"10px",alignItems:"center"},children:[m?e.jsx(P,{onClick:I,sx:{color:"white"},children:e.jsx(jt,{style:{width:"30px",height:"30px"}})}):e.jsx(P,{onClick:I,sx:{color:"white"},children:e.jsx(bt,{style:{width:"30px",height:"30px"}})}),e.jsx("img",{src:yt,alt:"wikitrak logo"})]}),e.jsx(a,{children:e.jsx(R,{variant:"h6",color:"white",fontWeight:"bold",sx:{ml:"15px",mt:"15px"},children:Object.keys(w).length>0&&h?`${s} - Geofence (${w.reg_id})`:e.jsxs(e.Fragment,{children:[s," ",Object.keys(w).length>0&&w.reg_id]})})}),e.jsxs(a,{sx:{display:"flex"},children:[e.jsxs(P,{variant:"outlined",size:"small",sx:{color:n.vehicle?"white":"black",backgroundColor:n.vehicle?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:v,children:[n.vehicle&&e.jsx(ze,{style:{marginRight:"5px",fontWeight:"bold"}}),e.jsx("img",{src:kt,style:{marginRight:"5px"}}),Object.keys(w).length>0?w.reg_id:"Vehicles"]}),h&&e.jsx(a,{children:e.jsxs(P,{variant:"outlined",size:"small",sx:{color:y?"white":"black",backgroundColor:y?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:()=>{d(!1),j(!y),g(xe({data:!1}))},children:[y&&e.jsx(ze,{style:{marginRight:"5px",fontWeight:"bold"}}),"Geofence"]})}),e.jsx(a,{sx:{color:"white",mr:"10px"},children:e.jsxs(a,{sx:{display:"flex",marginTop:"14px",gap:"10px"},children:[e.jsx(a,{onClick:()=>{j(!1),d(!f),g(xe({data:!1}))},children:e.jsx(At,{sx:{cursor:"pointer",width:"30px",height:"30px"}})}),e.jsx(a,{onClick:()=>{p({...n,user:!n.user}),o(!1)},children:n.user?e.jsx(qe,{sx:{mr:"2px",cursor:"pointer",width:"30px",height:"30px"}}):e.jsx(Te,{sx:{mr:"2px",cursor:"pointer",width:"30px",height:"30px"}})})]})}),e.jsx(pe,{onClick:()=>{g(ct(!S))},sx:{color:"white"},children:S?e.jsx(St,{}):e.jsx(vt,{})})]})]})},Yt=Vt,Qt=()=>{const s=Y(),p=Pt("(min-width:600px)"),[n,h]=l.useState(!1),[o,j]=l.useState(!1),{mode:y}=b(x=>x.dashboard),d=Q(y),f={new_password:"",confirmPassword:""},m=It().shape({new_password:Ke().required("Password is required").min(8,"Password must be at least 8 characters"),confirmPassword:Ke().oneOf([Et("new_password"),null],"Passwords must match").required("Confirm password is required")}),w=x=>{console.log("values",x);let S=x.confirmPassword;s(xt({new_password:S}))};return e.jsx(a,{sx:{display:"flex",justifyContent:"center"},children:e.jsxs(a,{sx:{width:"30%"},children:[e.jsx(a,{sx:{align:"center"},children:e.jsx(R,{variant:"h5",sx:{mt:"25px",my:"",fontWeight:"bold",align:"center",color:d.grey[400]},children:"Change Password"})}),e.jsx(Ot,{onSubmit:w,initialValues:f,validationSchema:m,children:({values:x,errors:S,touched:g,handleBlur:I,handleChange:v,handleSubmit:k})=>e.jsxs("form",{onSubmit:k,children:[e.jsxs(a,{display:"grid",gap:"15px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:p?void 0:"span 4"}},marginTop:"20px",children:[e.jsx(He,{fullWidth:!0,variant:"outlined",type:n?"text":"password",label:"New Password",onBlur:I,onChange:v,value:x.new_password,name:"new_password",error:!!g.new_password&&!!S.new_password,helperText:g.new_password&&S.new_password,sx:{gridColumn:"span 4",backgroundColor:"white",borderRadius:"5px"},InputProps:{endAdornment:e.jsx(Xe,{position:"end",children:e.jsx(pe,{"aria-label":"toggle password visibility",onClick:()=>h(!n),edge:"end",children:n?e.jsx(Ue,{}):e.jsx(Je,{})})})}}),e.jsx(He,{fullWidth:!0,variant:"outlined",type:o?"text":"password",label:"Confirm Password",onBlur:I,onChange:v,value:x.confirmPassword,name:"confirmPassword",error:!!g.confirmPassword&&!!S.confirmPassword,helperText:g.confirmPassword&&S.confirmPassword,sx:{gridColumn:"span 4",backgroundColor:"white",borderRadius:"5px"},InputProps:{endAdornment:e.jsx(Xe,{position:"end",children:e.jsx(pe,{"aria-label":"toggle password visibility",onClick:()=>j(!o),edge:"end",children:o?e.jsx(Ue,{}):e.jsx(Je,{})})})}})]}),e.jsx(a,{sx:{my:"29px"},children:e.jsx(P,{type:"submit",sx:{background:F.bgColor,width:"100%",p:"10px","&:hover":{background:F.bgShadow,color:d.grey[100]}},variant:"contained",children:"submit"})})]})})]})})};let Tt="http://cc.wikitrak.in:3001/";const qt=()=>{const s=JSON.parse(localStorage.getItem("w_userDetails")),{mode:p}=b(o=>o.dashboard),n=Q(p),h=()=>{window.open(Tt,"_blank")};return e.jsxs(a,{children:[e.jsxs(a,{sx:{backgroundColor:n.grey[200],m:"10px",borderRadius:"5px",height:"150px"},children:[e.jsx(a,{sx:{pl:"20px",pt:"10px",mb:"10px",color:`${n.grey[400]}`},children:e.jsx("b",{children:"User Settings"})}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderRadius:"8px",boxShadow:"0px 4px 10px rgba(0, 0, 0, 0.1)"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(a,{sx:{ml:"23px",mt:"11px",height:"70px",width:"70px",backgroundColor:"white",borderRadius:"50%",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"}}),e.jsxs(a,{sx:{height:"80px",width:"200px",display:"flex",justifyContent:"center",flexDirection:"column",ml:3,color:n.grey[400]},children:[e.jsx(a,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:s&&e.jsxs(e.Fragment,{children:[s.first_name.charAt(0).toUpperCase()+s.first_name.slice(1).toLowerCase()," ",s.last_name.charAt(0).toUpperCase()+s.last_name.slice(1).toLowerCase()]})}),e.jsx(a,{children:s&&s.role})]})]}),(s==null?void 0:s.role)&&gt.includes(s.role)&&e.jsx(a,{children:e.jsx(P,{variant:"contained",sx:{backgroundColor:"white",color:n.grey[300],textTransform:"none",fontWeight:"bold","&:hover":{backgroundColor:"black",color:"white"}},onClick:h,children:"Go to admin page"})})]})]}),e.jsx(a,{sx:{marginTop:"9%",alignContent:"center",textAlign:"center"},children:e.jsx(Qt,{})})]})},Zt=qt,$t="/assets/3W-KvFQeYgh.jpeg",es="data:image/png;base64,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";function ts({shapeType:s,setShapeType:p}){const n=h=>{console.log("selectedType",h),p(h)};return e.jsxs(a,{children:[e.jsx(P,{onClick:()=>{n("circular")},style:{background:s==="circular"?F.bgColor:"transparent",color:s==="circular"?"white":ee[400],margin:"0 5px"},children:"Circle"}),e.jsx(P,{onClick:()=>{n("polygon")},style:{background:s==="polygon"?F.bgColor:"transparent",color:s==="polygon"?"white":ee[400],margin:"0 5px"},children:"Polygon"})]})}function ss({shapeType:s,center:p,radius:n,active:h,setActive:o,setInward:j,inward:y,setSpeedLimit:d,speedLimit:f,setSpeedValue:m,handleGeofence:w,speedValue:x}){const{selectedVehicle:S,locationData:g,tractorIcon:I}=b(v=>v.liveMap);return e.jsxs(a,{sx:{display:"flex",padding:"15px",flexDirection:"column",gap:"10px",color:ee[600]},children:[e.jsx(R,{sx:{fontWeight:"bold",fontSize:"16px"},children:"Geofence Setting"}),e.jsxs(R,{sx:{fontWeight:"400",fontSize:"14px",textTransform:"capitalize"},children:["Type: ",s]}),s==="circular"&&e.jsxs(e.Fragment,{children:[e.jsx(R,{sx:{color:"#686868"},children:"Centered At "}),e.jsxs(R,{sx:{color:"#686868"},children:["Lat: ",p.lat.toFixed(2)]}),e.jsxs(R,{sx:{color:"#686868"},children:["Lng: ",p.lng.toFixed(2)]}),e.jsxs(R,{sx:{color:"#686868",border:"1px solid #686868",borderRadius:"4px",padding:"8px"},children:["Radius ( ",(n/1e3).toFixed(2)," in km)"]})]}),e.jsxs(a,{display:"flex",alignItems:"center",children:[e.jsx(R,{variant:"body1",component:"b",children:h?"Active":"Inactive"}),e.jsx(ge,{defaultChecked:h,onChange:()=>{o(!h)},color:"primary",inputProps:{"aria-label":"toggle active state"}})]}),e.jsxs(a,{display:"flex",alignItems:"center",children:[e.jsx(R,{variant:"body1",component:"b",children:y?"Inward":"Outward"}),e.jsx(ge,{checked:y,onChange:()=>{j(!y)},color:"primary",inputProps:{"aria-label":"toggle direction"}})]}),e.jsxs(a,{display:"flex",alignItems:"center",children:[e.jsx(ge,{checked:f,onChange:()=>{d(!f)},color:"primary",inputProps:{"aria-label":"toggle direction"}}),e.jsx(R,{variant:"body1",component:"b",children:"Speed Limit"})]}),f&&e.jsx(a,{sx:{},children:e.jsx(Lt,{sx:{width:"100%",color:ee[600],border:"none","&:focus":{outline:"none"}},value:x,placeholder:"Enter Speed Limit",type:"number",onChange:v=>{const k=Math.max(0,parseInt(v.target.value));m(k)}})}),e.jsx(P,{disabled:Object.keys(S).length===0&&!1,variant:"outlined",size:"small",sx:{color:"white",backgroundColor:F.bgColor,mt:"6px",mx:"5px",border:"1px solid white",height:"40px",width:"100%","&:hover":{color:"black",background:F.bgShadow,border:"1px solid black"},letterSpacing:"1.5px",fontSize:"16px"},onClick:()=>{if(Object.keys(S).length===0)return _.error("please select a vehicle.");w()},children:"SUBMIT"})]})}const as="http://139.59.37.47:3031",os="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA",rs=({showGfBar:s,showGfAlert:p})=>{const{isLoaded:n,loadError:h}=Ft({googleMapsApiKey:`${os}`}),{selectedVehicle:o,locationData:j,tractorIcon:y}=b(r=>r.liveMap),{geofence:d,vehicleSideBar:f}=b(r=>r.geofence),{mode:m,styles:w,vehicles_details:x}=b(r=>r.dashboard),{collapsed:S}=b(r=>r.auth),[g,I]=l.useState(null),[v,k]=l.useState(null),[i,D]=l.useState(1e3),[u,se]=l.useState([]),[z,c]=l.useState(!0),[G,W]=l.useState(!1),[L,ae]=l.useState(!1),[C,T]=l.useState({lat:18.516726,lng:73.856255}),[oe,re]=l.useState(50),[E,ne]=l.useState("circular"),[fe,q]=l.useState([{lat:C.lat+.01,lng:C.lng},{lat:C.lat-.01,lng:C.lng-.01},{lat:C.lat-.01,lng:C.lng+.01}]),[le,ie]=l.useState(!1),Ze=l.useRef(null),ce=l.useRef(!1),Z=l.useRef(null);let $e=Y();l.useEffect(()=>{et()},[o]),l.useEffect(()=>{le&&q([{lat:C.lat+.01,lng:C.lng},{lat:C.lat-.01,lng:C.lng-.01},{lat:C.lat-.01,lng:C.lng+.01}])},[le]),l.useEffect(()=>{var r,O,A,X,U,J,K,H;if(j.length>0&&Object.keys(o).length>0){let N=j.filter($=>{var V;return((V=$.latestDocument)==null?void 0:V.imei)===o.imei});se(N),T({lat:(O=(r=N[0])==null?void 0:r.latestDocument)==null?void 0:O.lat,lng:(X=(A=N[0])==null?void 0:A.latestDocument)==null?void 0:X.lng});let M=(J=(U=N[0])==null?void 0:U.latestDocument)==null?void 0:J.lat,B=(H=(K=N[0])==null?void 0:K.latestDocument)==null?void 0:H.lng;le&&q([{lat:M+.01,lng:B},{lat:M-.01,lng:B-.01},{lat:M-.01,lng:B+.01}])}},[o,j,E]),l.useEffect(()=>{g&&v&&g.fitBounds(v)},[g,v]);const et=async()=>{var r,O,A,X,U,J,K,H,N,M,B,$,V,we,je,be,ye,Se,ve,Ce,Ae,ke,Re,De,Oe,Ie,Ee,Pe,Le,Ne,_e,Fe,Ge,We,Me;if(Object.keys(o).length>0)try{const t=await pt.get(`${as}/api/get/geofance/${o==null?void 0:o.imei}`);if(console.log(t.data.geofenceData,"result"),((O=(r=t==null?void 0:t.data)==null?void 0:r.geofenceData)==null?void 0:O.area_type)==="circular")if(ne("circular"),ie(!0),(X=(A=t==null?void 0:t.data)==null?void 0:A.geofenceData)!=null&&X.lat)T({lat:(J=(U=t==null?void 0:t.data)==null?void 0:U.geofenceData)==null?void 0:J.lat,lng:(H=(K=t==null?void 0:t.data)==null?void 0:K.geofenceData)==null?void 0:H.long}),D((M=(N=t==null?void 0:t.data)==null?void 0:N.geofenceData)==null?void 0:M.radius),c(($=(B=t==null?void 0:t.data)==null?void 0:B.geofenceData)==null?void 0:$.isActive_Geofance),W(((we=(V=t==null?void 0:t.data)==null?void 0:V.geofenceData)==null?void 0:we.type)==="inward"),ae((be=(je=t==null?void 0:t.data)==null?void 0:je.geofenceData)==null?void 0:be.isActive_Speed),re((Se=(ye=t==null?void 0:t.data)==null?void 0:ye.geofenceData)==null?void 0:Se.speed);else return _.success("No Geofence For Selected Vehicle",{id:"getting geofence"});else((Ce=(ve=t==null?void 0:t.data)==null?void 0:ve.geofenceData)==null?void 0:Ce.area_type)==="polygon"&&(ie(!1),ne("polygon"),console.log("get for polygon",(Ae=t==null?void 0:t.data)==null?void 0:Ae.geofenceData),q((Re=(ke=t==null?void 0:t.data)==null?void 0:ke.geofenceData)==null?void 0:Re.polygon_points),re((Oe=(De=t==null?void 0:t.data)==null?void 0:De.geofenceData)==null?void 0:Oe.speed),c((Ee=(Ie=t==null?void 0:t.data)==null?void 0:Ie.geofenceData)==null?void 0:Ee.isActive_Geofance),W(((Le=(Pe=t==null?void 0:t.data)==null?void 0:Pe.geofenceData)==null?void 0:Le.type)==="inward"),T({lat:(_e=(Ne=t==null?void 0:t.data)==null?void 0:Ne.geofenceData)==null?void 0:_e.lat,lng:(Ge=(Fe=t==null?void 0:t.data)==null?void 0:Fe.geofenceData)==null?void 0:Ge.long}),ae((Me=(We=t==null?void 0:t.data)==null?void 0:We.geofenceData)==null?void 0:Me.isActive_Speed))}catch(t){ie(!0),console.log("vehicleDetail",u),console.log(t,"error while getting geofence"),_.error("No geofence has been set for this vehicle.",{id:"getting geofence"})}},tt=r=>{I(r)},st=()=>{if(Object.keys(o).length>0){let r;E==="circular"?r={imei:o.imei,area_type:E,type:G?"inward":"outward",lat:C.lat,long:C.lng,radius:i,isActive_Geofance:z,isActive_Speed:!!L,speed:L?oe:5}:E==="polygon"&&(r={imei:o.imei,area_type:E,type:G?"inward":"outward",polygon_points:fe,isActive_Geofance:z,isActive_Speed:!!L,speed:L?oe:50}),$e(ht({data:r})),_.success("Successful Saved",{id:"geofence"})}else _.error("Please Select Vehicle",{id:"geofence"})},at=()=>{if(!ce.current){ce.current=!0;const r=de.getRadius();console.log("newRadius",r),D(r),ce.current=!1}},ot=r=>{console.log("New Center:",r.toJSON()),T(r.toJSON())},rt=()=>{if(Z.current&&Z.current.getPath){const O=Z.current.getPath().getArray().map(A=>({lat:A.lat(),lng:A.lng()}));q(O),console.log("newVertices",O)}},nt=r=>{Z.current=r},lt=r=>{const O=x&&(x==null?void 0:x.length)>0&&x.find(A=>Number(A==null?void 0:A.value)===Number(r)&&(A==null?void 0:A.vehilce_type));return console.log("vehicle: ",O),O?O.vehilce_type:null},me={paths:fe,options:{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,editable:!0}};if(h)return"Error loading maps";if(!n)return"Loading maps";const it={width:"100%",height:"86.8vh"};let de;return e.jsxs(e.Fragment,{children:[e.jsx(ts,{setShapeType:ne,shapeType:E}),e.jsxs(a,{sx:{display:"flex",flexDirection:"row"},children:[e.jsxs(Gt,{ref:Ze,mapContainerStyle:it,zoom:15,center:C,onLoad:tt,options:{mapTypeControl:!1,styles:m?w:""},children:[E==="circular"&&e.jsx(Wt,{center:C,radius:i,options:{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,editable:!0},onLoad:r=>{de=r,de.addListener("radius_changed",at)},onDragEnd:r=>ot(r.latLng)}),E==="polygon"&&e.jsx(Mt,{paths:me.paths,options:me.options,draggable:!0,editable:!0,onDragEnd:rt,onLoad:nt}),u&&u.length>0&&u.map((r,O)=>{const A=lt(r.latestDocument.imei);return e.jsx(Bt,{position:{lat:r.latestDocument.lat,lng:r.latestDocument.lng},icon:{url:(()=>{switch(A){case"2W":return te;case"3W":return _t;case"4W":return Qe;case"Tractor":return Nt;default:return te}})(),fillColor:"red",fillOpacity:2,strokeWeight:1,size:new window.google.maps.Size(55,55),scaledSize:new window.google.maps.Size(55,55),scale:2}},O)})]}),s&&!p&&!f&&C&&e.jsx(a,{sx:{width:S?"25%":"20%"},children:e.jsx(ss,{shapeType:E,center:C,radius:i,active:z,setActive:c,setInward:W,inward:G,setSpeedLimit:ae,speedLimit:L,setSpeedValue:re,handleGeofence:st,speedValue:oe})})]})]})},ns=({findTypeVehicle:s,statusVehicle:p})=>{var y,d,f;const{selectedVehicle:n}=b(m=>m.liveMap),{mode:h}=b(m=>m.dashboard),o=Q(h),j=[{label:"Reg Number",value:(n==null?void 0:n.reg_id)||"NA"},{label:"IMEI Number",value:(n==null?void 0:n.imei)||"NA"},{label:"Chassis Number",value:(s==null?void 0:s.chassis_no)||"NA"},{label:"Engine Number",value:(s==null?void 0:s.engine_no)||"NA"},{label:"Date of Sell",value:(s==null?void 0:s.sell_date)||"NA"},{label:"Workshop Name",value:((y=s==null?void 0:s.workShop)==null?void 0:y.name)+`(City:${(f=(d=s==null?void 0:s.workShop)==null?void 0:d.city)==null?void 0:f.name})`||"NA"},{label:"Customer Name",value:(s==null?void 0:s.customer_name)||"NA"},{label:"Status",value:p?"On":"Off"}];return e.jsx(a,{sx:{padding:"20px"},children:e.jsx(Be,{container:!0,spacing:2,children:j.map((m,w)=>e.jsx(Be,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(a,{sx:{padding:"20px",borderRadius:"8px",boxShadow:"rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px",textAlign:"center"},children:[e.jsx(R,{sx:{fontWeight:"bold",color:o.grey[600]},children:m.label}),e.jsx(R,{sx:{color:o.grey[300]},children:Object.keys(n).length>0?m.value:"Please select vehicle"})]})},w))})})},ls=({showMap:s,setShowMap:p,showGfBar:n,showGfAlert:h})=>{const{selectedVehicle:o,onlineVehicle:j}=b(i=>i.liveMap),{mode:y,vehicles_details:d}=b(i=>i.dashboard),f=Q(y),[m,w]=l.useState(!1),[x,S]=l.useState();let g=Y();l.useEffect(()=>{console.log("onlineVehicle",j),console.log("selectedVehicle",o);let i=j.find(D=>D==o.imei);console.log("isActive",i),i?w(!0):(w(!1),console.log("Vehicle is not active"))},[j,o]),l.useEffect(()=>{if(g(ut({})),Object.keys(o).length>0){let i=v(o==null?void 0:o.imei);console.log("result",i),S(i)}},[o]);const I=i=>{const D=d&&(d==null?void 0:d.length)>0&&d.find(u=>(u==null?void 0:u.value)===i&&(u==null?void 0:u.vehilce_type));return D?D.vehilce_type:null},v=i=>{const D=d&&(d==null?void 0:d.length)>0&&d.find(u=>(u==null?void 0:u.value)===i&&u);return D||null},k=Object.keys(o).length>0?I(o.imei):null;return`${f.grey[300]}`,f.grey[300],e.jsx(e.Fragment,{children:s?e.jsx(rs,{showGfBar:n,showGfAlert:h}):e.jsxs(e.Fragment,{children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",background:f.grey[200],margin:"10px",padding:"10px",borderRadius:"8px"},children:[e.jsxs(a,{sx:{},children:[e.jsx(R,{sx:{fontWeight:"bold",fontSize:"16px",margin:"4px",color:f.grey[400]},children:"Vehicle Settings"}),e.jsx(a,{sx:{display:"flex"},children:e.jsx(a,{sx:{border:"2px solid white",padding:"10px",borderRadius:"5px",background:"white",marginRight:"5px"},children:e.jsx("img",{src:(()=>{switch(k){case"2W":return te;case"3W":return $t;case"4W":return Qe;default:return te}})(),alt:"vehicleIcon",style:{width:"80px",height:"75px",borderRadius:"5px",marginRight:"20px"}})})})]}),e.jsxs(a,{onClick:()=>{p(!s)},sx:{cursor:"pointer",marginTop:"50px"},children:[e.jsx("img",{src:es,alt:"tractorIcon",style:{width:"80px",height:"75px",borderRadius:"5px",marginRight:"20px"}}),e.jsx(R,{sx:{fontSize:"12px",color:f.grey[400]},children:"Set Geofence"})]})]}),e.jsx(ns,{findTypeVehicle:x,statusVehicle:m})]})})};function Os(){const{w_customer_id:s}=b(i=>i.auth),{vehicleSideBar:p}=b(i=>i.geofence),{collapsed:n}=b(i=>i.auth),{mode:h}=b(i=>i.dashboard),o=Q(h),[j,y]=l.useState([]);l.useState([]);const[d,f]=l.useState({user:!0,vehicle:!1}),[m,w]=l.useState(!1),[x,S]=l.useState(!1),[g,I]=l.useState(!1);let v=Y();l.useEffect(()=>{k()},[]);const k=async()=>{try{let i=[],D=[];const u=await v(ft({w_customer_id:s}));if(u.payload&&Array.isArray(u.payload)){u.payload.forEach(c=>{var G,W,L;c.imei&&Array.isArray(c.imei)&&c.imei.length>0&&((G=c.imei[0])!=null&&G.mac_id)?(i.push({id:c.id,label:c.registration_id,value:(W=c.imei[0])==null?void 0:W.mac_id,vehilce_type:c==null?void 0:c.segment,chassis_no:c==null?void 0:c.chassis_no,engine_no:c==null?void 0:c.engine_no,workShop:c==null?void 0:c.workshop,registration_id:c==null?void 0:c.registration_id,sell_date:c==null?void 0:c.sell_date}),D.push((L=c.imei[0])==null?void 0:L.mac_id)):console.error("IMEI data not found for item:",c)});const se="one",z=D;D.length>0&&v(mt({type:se,imei:z})),y(i),v(wt(i))}else console.error("Unexpected data format or empty payload:",u),_.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),_.error(`Error fetching vehicle data: ${i}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(Ct,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:o.grey[100]},children:[e.jsx(Yt,{title:"Settings",setShowContent:f,showContent:d,showMap:m,setShowMap:w,showGfBar:x,setShowGfBar:S,showGfAlert:g,setShowGfAlert:I}),e.jsxs(a,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(a,{style:{width:p?"80%":"100%",border:`1px solid ${o.grey[800]}`,borderRadius:"2px"},children:d.user?e.jsx(Zt,{}):e.jsx(ls,{showMap:m,setShowMap:w,showGfBar:x,showGfAlert:g})}),!g&&!x&&p&&e.jsx(a,{style:{width:"20%"},children:e.jsx(Rt,{vehicleData:j,title:"Setting"})}),g&&!x&&!p&&e.jsx(a,{sx:{width:n?"25%":"20%"},children:e.jsx(Dt,{})})]})]})]})}export{Os as default};
