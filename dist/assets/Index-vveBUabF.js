import{j as a,e_ as re,e$ as de,f0 as ie,f1 as ue,bd as w,a$ as K,b0 as E,b as n,aX as k,aZ as ee,fa as he,fb as be,c5 as pe,b8 as q,bC as oe,fc as _e,bn as M,fd as se,bg as xe,d5 as ae,cg as ge,dU as fe,dV as je,dW as ke,dX as ne,dY as o,dZ as Ce,f2 as De,db as Se,eJ as ye,eK as te,f9 as ve,fe as Be,bI as ce,bx as Te,by as Pe,bB as Ae,bA as Ve,br as $e,bt as me,b6 as Ee}from"./index-DwbBqXE5.js";import{V as Ie}from"./VehicleMenu-BwH_TI_r.js";import{P as Le}from"./Parameters-DhRBWvl-.js";/* empty css           */import{D as Ye}from"./DialogContentText-DxvnZ5Gn.js";import{E as Re,T as Ne}from"./Edit-KnTOupFy.js";import{D as Me}from"./Remove-3GSjWnyX.js";import{a as Oe,B as Ue}from"./BreakDownJobCardTable-BdRQ2dFg.js";import{T as Ge,d as He}from"./excelUtils-DCK5fDHH.js";import{A as Je}from"./AddBreakdown-DnInRYgj.js";import"./index.esm-C6Iki90P.js";import{S as Fe}from"./ServicesTopBar-CNrtR-0-.js";import"./Autocomplete-DMTv9H2f.js";import"./formik.esm-CdBT1z3t.js";import"./xlsx-D5JNrnKm.js";import"./Add-CdajacT5.js";import"./useMediaQuery-tN2-hn-z.js";const We=({open:i,onClose:l,onConfirm:u})=>a.jsxs(re,{open:i,onClose:l,children:[a.jsx(de,{children:"Confirm Deletion"}),a.jsx(ie,{children:a.jsxs(Ye,{children:["Are you sure you want to delete this vehicle data?"," ",a.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),a.jsxs(ue,{children:[a.jsx(w,{onClick:l,color:"primary",children:"Cancel"}),a.jsx(w,{onClick:u,color:"secondary",children:"Delete"})]})]}),qe="http://143.244.141.193:8080/api/v1",Ze={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Xe=({breakdownData:i,status:l})=>{const u=K(),{isUpdateBreakdown:D}=E(_=>_.equipment),{w_customer_id:$}=E(_=>_.auth),[j,S]=n.useState(!1),y=()=>{console.log("breakdownData",i),localStorage.getItem("role"),u(he(!D)),u(be(i))},I=()=>{console.log("dlt btn clicked"),localStorage.getItem("role"),S(!0)},v=async()=>{console.log("breakdownData data deleting");try{await pe.delete(`${qe}/vehicles/new/breakdown/create/${i.id}/`),q.success("breakdownData data deleted successfully!"),u(oe($))}catch(_){console.error("Error deleting breakdown data:",_),q.error("Failed to delete breakdown data. Please try again.")}S(!1)},m=()=>{S(!1)},O={color:"#686868"};return a.jsxs(k,{sx:Ze,children:[a.jsx(ee,{onClick:y,color:"primary",disabled:(l==null?void 0:l.toLowerCase())==="rejected"||(l==null?void 0:l.toLowerCase())==="close",children:a.jsx(Re,{})}),a.jsx(ee,{onClick:I,children:a.jsx(Me,{sx:O})}),a.jsx(We,{open:j,onClose:m,onConfirm:v})]})},le=[{id:"breakdown_id",label:"BDID"},{id:"registration_id",label:"Vehicle No"},{id:"breakdown_topic",label:"Topic"},{id:"breakdown_sub_topic",label:"Sub Topic"},{id:"user",label:"Created"},{id:"technician",label:"Technician"},{id:"contact_person",label:"Contact person"},{id:"mob_no",label:"Contact person mobile"},{id:"description",label:"Cust. complaint"},{id:"submission_date",label:"Submission Date"},{id:"submission_time",label:"Submission Time"},{id:"status",label:"Status"}],ze=()=>{const{breakdowns:i}=E(e=>e.breakdown),{searchTerm:l}=E(e=>e.inspection),u=K(),[D,$]=n.useState("asc"),[j,S]=n.useState("BDID"),[y,I]=n.useState(0),[v,m]=n.useState(8),[O,_]=n.useState(!1),[L,F]=n.useState(null),[Y,Z]=n.useState("breakdown_id");n.useState({id:"",status:"",workshop:"",user:""}),n.useEffect(()=>{u(_e({}))},[]);const U=e=>{$(j===e&&D==="asc"?"desc":"asc"),S(e)},G=(e,b)=>{I(b)},X=e=>{m(parseInt(e.target.value,10)),I(0)},B=((e,b,g)=>!b||!g?e:e.filter(s=>(()=>{var r,f,c,d,T,P,A,V,J,C;switch(b){case"breakdown_id":return((s==null?void 0:s.breakdown_id)||"").toString();case"registration_id":return((r=s==null?void 0:s.vehicle)==null?void 0:r.registration_id)||"";case"breakdown_topic":return((f=s==null?void 0:s.breakdown_topic)==null?void 0:f.topic)||"";case"user_name":return`${((d=(c=s==null?void 0:s.user)==null?void 0:c.us_user)==null?void 0:d.first_name)||""} ${((P=(T=s==null?void 0:s.user)==null?void 0:T.us_user)==null?void 0:P.last_name)||""}`;case"technician_name":return`${((V=(A=s==null?void 0:s.technician)==null?void 0:A.us_user)==null?void 0:V.first_name)||""} ${((C=(J=s==null?void 0:s.technician)==null?void 0:J.us_user)==null?void 0:C.last_name)||""}`;case"contact_person":return(s==null?void 0:s.contact_person)||"";case"mob_no":return(s==null?void 0:s.mob_no)||"";case"submission_date":return s!=null&&s.submission_date?M(s.submission_date).format("YYYY-MM-DD"):"";case"start_time":return s!=null&&s.submission_date?M(s.submission_date).format("HH:mm A"):"";case"status":return(s==null?void 0:s.status)||"";default:return""}})().toLowerCase().includes(g.toLowerCase())))((i==null?void 0:i.slice())||[],Y,l),H=B.slice(y*v,y*v+v);console.log(H,B,"paginatedData");const h={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},z=B&&B.map(e=>{var g,s,p,r,f,c,d,T,P,A,V,J;const b=e!=null&&e.breakdown_parts&&(e==null?void 0:e.breakdown_parts.length)>0?e==null?void 0:e.breakdown_parts.map((C,we)=>{var Q;return`${(Q=C==null?void 0:C.spare_parts)==null?void 0:Q.description}: Qty ${C==null?void 0:C.quantity}`}).join(";"):"N/A";return{BDID:(e==null?void 0:e.breakdown_id)||"","Registration ID":((g=e==null?void 0:e.vehicle)==null?void 0:g.registration_id)||"","Breakdown Topic":((s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic)||"","Breakdown Sub Topic":((r=(p=e.breakdown_topic)==null?void 0:p.breakdown_sub_topic)==null?void 0:r.name)||"","Customer Complaint":(e==null?void 0:e.description)||"","Created By":`${((c=(f=e==null?void 0:e.user)==null?void 0:f.us_user)==null?void 0:c.first_name)||""} ${((T=(d=e==null?void 0:e.user)==null?void 0:d.us_user)==null?void 0:T.last_name)||""}`,"Technician Name":`${((A=(P=e==null?void 0:e.technician)==null?void 0:P.us_user)==null?void 0:A.first_name)||""} ${((J=(V=e==null?void 0:e.technician)==null?void 0:V.us_user)==null?void 0:J.last_name)||""}`,"Contact Person":(e==null?void 0:e.contact_person)||"","Mobile No":(e==null?void 0:e.mob_no)||"","Submission Date":e!=null&&e.submission_date?M(e.submission_date).format("YYYY-MM-DD"):"","Submission Time":e!=null&&e.submission_date?M(e.submission_date).format("HH:mm A"):"",Status:(e==null?void 0:e.status)||"","Spare parts":b}});let R=se("Breakdown"),N=se("Job Card");const t=(N==null?void 0:N.includes("Create"))||N==="Read-Write-Only",x=(R==null?void 0:R.includes("Update"))||R==="Read-Write-Only";return a.jsxs(k,{sx:{m:"10px"},children:[a.jsxs(k,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsx(Ge,{columns:le,selectedColumn:Y,onColumnChange:Z,searchTerm:l,onSearchChange:e=>u(xe(e))}),a.jsx(ae,{variant:"contained",color:"success",onClick:()=>He(z,"breakdown-tickets.xlsx"),children:"Download Excel"})]}),a.jsxs(ge,{children:[a.jsx(fe,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:a.jsxs(je,{stickyHeader:!0,children:[a.jsx(ke,{children:a.jsxs(ne,{children:[le.map(e=>a.jsx(o,{sx:h,children:a.jsx(Ne,{active:j===e.id,direction:j===e.id?D:"asc",onClick:()=>U(e.id),children:e.label})},e.id)),x&&a.jsx(o,{sx:h,children:"Action"}),t&&a.jsx(o,{sx:h,children:"Job card"})]})}),a.jsx(Ce,{children:H.map((e,b)=>{var g,s,p,r,f,c,d,T,P,A,V;return a.jsxs(ne,{children:[a.jsx(o,{children:e==null?void 0:e.breakdown_id}),a.jsx(o,{children:(g=e==null?void 0:e.vehicle)==null?void 0:g.registration_id}),a.jsx(o,{children:(s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic}),a.jsx(o,{children:(p=e==null?void 0:e.breakdown_sub_topic)==null?void 0:p.name}),a.jsx(o,{children:`${(f=(r=e==null?void 0:e.user)==null?void 0:r.us_user)==null?void 0:f.first_name} ${(d=(c=e==null?void 0:e.user)==null?void 0:c.us_user)==null?void 0:d.last_name}`}),a.jsx(o,{children:`${((P=(T=e==null?void 0:e.technician)==null?void 0:T.us_user)==null?void 0:P.first_name)||"N/A"} ${((V=(A=e==null?void 0:e.technician)==null?void 0:A.us_user)==null?void 0:V.last_name)||""}`}),a.jsx(o,{children:e==null?void 0:e.contact_person}),a.jsx(o,{children:e==null?void 0:e.mob_no}),a.jsx(o,{children:e==null?void 0:e.description}),a.jsx(o,{children:(e==null?void 0:e.submission_date)&&M(e.submission_date).format("YYYY-MM-DD")||"N/A"}),a.jsx(o,{children:(e==null?void 0:e.submission_date)&&M(e.submission_date).format("HH:mm A")||"N/A"}),a.jsx(o,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),x&&a.jsx(o,{children:a.jsx(Xe,{breakdownData:e,status:e.status})}),t&&a.jsx(o,{children:a.jsx(ae,{variant:"outlined",onClick:()=>{_(!0),F(e)},disabled:e.jobcard,children:"Create job card"})})]},b)})})]})}),a.jsx(De,{component:"div",count:B.length,page:y,onPageChange:G,rowsPerPage:v,onRowsPerPageChange:X,rowsPerPageOptions:[5,10,15]}),a.jsx(Oe,{rowData:L,open:O,handleClose:()=>_(!1),isTechnician:!0})]})]})},Ke=ze;function Qe(){const[i]=Se(),l=i.get("tab"),[u,D]=n.useState(0),$=(j,S)=>{D(S)};return n.useEffect(()=>{l&&D(Number(l))},[]),a.jsxs(k,{sx:{width:"100%"},children:[a.jsx(k,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsxs(ye,{value:u,onChange:$,"aria-label":"Breakdown Tabs",children:[a.jsx(te,{label:"Breakdown Tickets"}),a.jsx(te,{label:"Breakdown Job Cards"})]})}),a.jsxs(k,{sx:{mt:2},children:[u===0&&a.jsx(Ke,{}),u===1&&a.jsx(Ue,{})]})]})}function gs(){const{locationData:i,selectedVehicle:l,selectedParameterList:u,onlineVehicle:D}=E(t=>t.liveMap),{mode:$,selectedVehicleGroup:j,vehicleZone:S}=E(t=>t.dashboard),y=Ee($),[I,v]=n.useState([]),{w_customer_id:m}=E(t=>t.auth),[O,_]=n.useState(),[L,F]=n.useState(!1),[Y,Z]=n.useState(!1),[U,G]=n.useState([]);n.useState(!0);const[X,W]=n.useState(!1),[B,H]=n.useState(!1);let h=K();n.useEffect(()=>{z(),h(ve()),h(oe(m)),h(Be())},[]),n.useEffect(()=>{console.log("selectedVehicleGroup",j)},[j]),n.useEffect(()=>{G([]),h(ce([{reg_id:"",imei:"",params:[]}]))},[l]);const z=async()=>{try{W(!0);let t=[],x=[];const e=await h(Te({w_customer_id:m}));if(Array.isArray(e.payload)){e.payload.forEach(s=>{var p,r,f,c;Array.isArray(s.imei)&&s.imei.length>0&&((p=s.imei[0])!=null&&p.mac_id)?(t.push({id:s.id,label:s.registration_id,value:(r=s.imei[0])==null?void 0:r.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(f=s==null?void 0:s.vehicle_model)==null?void 0:f.name,user:s==null?void 0:s.user,vehicle_group:s==null?void 0:s.vehicle_group}),x.push((c=s.imei[0])==null?void 0:c.mac_id)):console.error("IMEI data not found for item:",s)});const b="one",g=x;x.length>0&&h(Pe({type:b,imei:g})),v(t),h(Ae({w_customer_id:m})),h(Ve(t)),W(!1)}else W(!1),console.error("Unexpected data format:",e),q.error("Unexpected data format:")}catch(t){console.error("Error fetching vehicle data:",t),q.error(`Error fetching vehicle data: ${t}`)}},R=async t=>{const{label:x,imei:e,id:b,reg_id:g,checked:s}=t;_(c=>c.map(d=>d.id===b?{...d,checked:!s}:d));let p=[...U],r=[...U];if(!s)i.forEach(c=>{c.latestDocument.imei===e&&(p.push({label:x,value:c.latestDocument[x==="maininputvoltage"?"mainInputVoltage":x]}),r=p,G(p))});else{let c=U.filter(d=>d.label!==x);r=c,G(c)}console.log("tempParamList",r),h(ce([{reg_id:g,imei:e,params:r}]))},N=I.filter(t=>Object.keys(j).length===0||t.vehicle_group===j.id);return a.jsxs("div",{className:"app",children:[a.jsx($e,{}),a.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[a.jsx(Fe,{title:"Breakdown",setShowVehicles:F,showVehicles:L,setShowVehiclesGroup:H,showVehiclesGroup:B}),a.jsx(me,{setShowVehiclesGroup:H,showVehiclesGroup:B}),a.jsxs(k,{style:{display:"flex",width:"100%",height:"95vh"},children:[a.jsxs(k,{style:{width:L||Y?"80%":"100%"},children:[a.jsx(Je,{where:"Breakdown"}),a.jsx(Qe,{})]}),L&&a.jsx(k,{style:{width:"20%",backgroundColor:y.grey[100]},children:a.jsx(Ie,{vehicleData:N,title:"Inspections",setParameterData:_,loadingVehicle:X,setShowVehicles:F,showVehicles:L,showParameters:Y,setShowParameters:Z})}),Y&&a.jsx(k,{style:{width:"20%",backgroundColor:y.grey[100]},children:a.jsx(Le,{parametersData:O,setParameterData:_,handleParameterChange:R})})]})]})]})}export{gs as default};
