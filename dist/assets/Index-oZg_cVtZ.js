import{a$ as k,b as a,a_ as ce,bl as le,b6 as ie,bH as H,bw as he,bx as ue,bz as de,bA as pe,b7 as J,j as r,bq as ge,bs as fe,aW as _,bI as Se,b5 as ve,bJ as W}from"./index-Hdh_iyJ6.js";import{L as be}from"./LiveMapTopBar-DAEWIftz.js";import{V as we}from"./VehicleMenu-BbAB6wKN.js";import{P as _e}from"./Parameters-BNa7qKOW.js";/* empty css           */import"./Autocomplete-DfEdErXj.js";function Pe(){const{locationData:n,selectedVehicle:g,selectedParameterList:Le,onlineVehicle:C}=k(s=>s.liveMap),{mode:F,selectedVehicleGroup:P}=k(s=>s.dashboard),M=ve(F),[K,Q]=a.useState([]),[E,X]=a.useState(""),[f,Y]=a.useState(""),[S,Z]=a.useState(""),[L,ee]=a.useState(""),{w_customer_id:m}=k(s=>s.auth),[se,x]=a.useState(),[b,I]=a.useState(!1),[w,A]=a.useState(!1),[y,j]=a.useState([]),[G,te]=a.useState(!0),[O,D]=a.useState(!1),[R,N]=a.useState(!1);let h=ce();a.useEffect(()=>()=>{h(le({}))},[]),a.useEffect(()=>{ae()},[]),a.useEffect(()=>{var s;if(Object.keys(g).length>0){const t=n==null?void 0:n.filter(e=>e.latestDocument.imei==(g==null?void 0:g.imei)),{lat:c,lng:u}=((s=t==null?void 0:t[0])==null?void 0:s.latestDocument)??{},d={lat:c||W.lat,lng:u||W.lat};h(ie(d))}},[g,n]),a.useEffect(()=>{j([]),h(H([{reg_id:"",imei:"",params:[]}]))},[g]);const ae=async()=>{try{D(!0);let s=[],t=[];const c=await h(he({w_customer_id:m}));if(Array.isArray(c.payload)){c.payload.forEach(e=>{var i,l,v,o;Array.isArray(e.imei)&&e.imei.length>0&&((i=e.imei[0])!=null&&i.mac_id)?(s.push({id:e.id,label:e.registration_id,value:(l=e.imei[0])==null?void 0:l.mac_id,vehilce_type:e==null?void 0:e.segment,chassis_no:e==null?void 0:e.chassis_no,engine_no:e==null?void 0:e.engine_no,workShop:e==null?void 0:e.workshop,registration_id:e==null?void 0:e.registration_id,sell_date:e==null?void 0:e.sell_date,customer_name:e==null?void 0:e.customer_name,vehicle_model:(v=e==null?void 0:e.vehicle_model)==null?void 0:v.name,vehicle_group:e==null?void 0:e.vehicle_group}),t.push((o=e.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",e)});const u="one",d=t;t.length>0&&h(ue({type:u,imei:d})),Q(s),h(de(s)),h(pe({w_customer_id:m})),D(!1)}else D(!1),console.error("Unexpected data format:",c),J.error("Unexpected data format:")}catch(s){console.error("Error fetching vehicle data:",s),J.error(`Error fetching vehicle data: ${s}`)}},oe=async s=>{const{label:t,imei:c,id:u,reg_id:d,checked:e}=s;x(o=>o.map(p=>p.id===u?{...p,checked:!e}:p));let i=[...y],l=[...y];if(!e)n.forEach(o=>{o.latestDocument.imei===c&&(i.push({label:t,value:o.latestDocument[t==="maininputvoltage"?"mainInputVoltage":t]}),l=i,j(i))});else{let o=y.filter(p=>p.label!==t);l=o,j(o)}h(H([{reg_id:d,imei:c,params:l}]))},re=s=>n==null?void 0:n.some(t=>String(t.latestDocument.imei)===String(s)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),ne=s=>n==null?void 0:n.some(t=>String(t.latestDocument.imei)===String(s)&&t.latestDocument.speed<=0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),B=K.filter(s=>{var T,z,U,$,q;if(!(Object.keys(P).length===0||s.vehicle_group===P.id))return!1;const c=(T=s==null?void 0:s.label)==null?void 0:T.toLowerCase().includes(E.toLowerCase()),u=L===""||((z=s==null?void 0:s.workShop)==null?void 0:z.region)===L,d=S===""||(($=(U=s==null?void 0:s.workShop)==null?void 0:U.state)==null?void 0:$.toLowerCase())===(((q=S==null?void 0:S.toString())==null?void 0:q.toLowerCase())||""),e=s.value,i=String(s.value).toLowerCase(),l=C.some(V=>String(V).toLowerCase()===i),v=!C.some(V=>String(V).toLowerCase()===i),o=l&&re(e),p=l&&ne(e);return c&&u&&d&&(f==="online"?l:f==="offline"?v:f==="running"?o:f==="idling"?p:!0)}).sort((s,t)=>s.label.localeCompare(t.label));return r.jsxs("div",{className:"app",children:[r.jsx(ge,{}),r.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[r.jsx(be,{title:"Live Map",setShowVehicles:I,showVehicles:b,showParameters:w,setShowParameters:A,setShowCard:te,showCard:G,setShowVehiclesGroup:N,showVehiclesGroup:R}),r.jsx(fe,{setShowVehiclesGroup:N,showVehiclesGroup:R,where:"livemap"}),r.jsxs(_,{style:{display:"flex",width:"100%",height:"95vh"},children:[r.jsx(_,{style:{width:b||w?"80%":"100%"},children:r.jsx(Se,{showCard:G,loadingVehicle:O,vehicleData:B})}),b&&r.jsx(_,{style:{width:"20%",backgroundColor:M.grey[100]},children:r.jsx(we,{vehicleData:B,title:"Live Map",setParameterData:x,loadingVehicle:O,setShowVehicles:I,showVehicles:b,showParameters:w,setShowParameters:A,setSearchedTerm:X,setOptions:Y,setState:Z,setRegion:ee,searchTerm:E,options:f,state:S,region:L})}),w&&r.jsx(_,{style:{width:"20%",backgroundColor:M.grey[100]},children:r.jsx(_e,{parametersData:se,setParameterData:x,handleParameterChange:oe})})]})]})]})}export{Pe as default};
