import{R as U,v as V,j as e,J as $,ak as q,al as z,q as F,ag as X,am as Y,aD as Z,e as r,B as h,cO as G,cP as T,cS as H,cT as K,cY as Q,cX as ee,w as D,ap as A,a4 as se,a5 as ae,a7 as te,C as B,Z as re,z as oe}from"./index-B2ZlNlRE.js";import{V as ne}from"./VehicleMenu-8stJX0qy.js";import"./Loader-BIvjZLK7.js";import"./LiveMapServices-B4mCCwzS.js";import{P as ie}from"./Parameters-B-Bb244u.js";/* empty css           */import{C as ce,S as le}from"./ServiceRecordTable-DnYLPLqL.js";import{S as de}from"./ServiceJobCardTable-Bf9jG4So.js";import{S as he}from"./ServicesTopBar-Do_ZudnO.js";import"./Autocomplete-C9-NI_FV.js";import"./TextField-DVigl5yY.js";import"./Card-DNIDBit1.js";import"./CardContent-DAmmmgkF.js";import"./index.esm-enTKG49W.js";import"./formik.esm-CEJL6TCQ.js";import"./excelUtils-ydDYs-q0.js";import"./Edit-CiGnqifa.js";function pe(){const[n,t]=U.useState(!1);V();const i=()=>t(!0),l=()=>t(!1);return e.jsxs("div",{children:[e.jsx($,{variant:"outlined",onClick:i,children:"+ Add New Entry"}),e.jsxs(q,{open:n,onClose:l,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[e.jsxs(z,{children:["+ Add new service entry",e.jsx(F,{"aria-label":"close",onClick:l,sx:{position:"absolute",right:8,top:8},children:e.jsx(X,{})})]}),e.jsx(Y,{dividers:!0,children:e.jsx(ce,{setOpen:t})})]})]})}function ue(){const[n]=Z(),t=n.get("tab"),[i,l]=r.useState(0);r.useEffect(()=>{t&&l(Number(t))},[]);const g=(k,m)=>{l(m)};return e.jsxs(h,{sx:{width:"100%"},children:[e.jsx(h,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(G,{value:i,onChange:g,"aria-label":"Breakdown Tabs",children:[e.jsx(T,{label:"Service Tickets"}),e.jsx(T,{label:"Service Job Cards"})]})}),e.jsxs(h,{sx:{mt:2},children:[i===0&&e.jsx(le,{isInspection:!1}),i===1&&e.jsx(de,{isInspection:!1})]})]})}const xe=()=>{const n=V();r.useEffect(()=>{n(H()),n(K()),n(Q())},[]);let t=ee("Service");const i=(t==null?void 0:t.includes("Create"))||t==="Read-Write-Only";return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),i&&e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(pe,{})}),"      "]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(ue,{})})]})]})},fe=xe;function Ae(){const{locationData:n,selectedVehicle:t,selectedParameterList:i}=D(a=>a.liveMap),{mode:l}=D(a=>a.dashboard),g=oe(l),[k,m]=r.useState([]),{w_customer_id:I}=D(a=>a.auth),[M,S]=r.useState(),[v,L]=r.useState(!1),[j,E]=r.useState(!1),[y,b]=r.useState([]),[R,N]=r.useState(!0),[O,_]=r.useState(!1);let x=V();r.useEffect(()=>{J()},[]),r.useEffect(()=>{b([]),x(A([{reg_id:"",imei:"",params:[]}]))},[t]);const J=async()=>{try{_(!0);let a=[],c=[];const p=await x(se({w_customer_id:I}));if(Array.isArray(p.payload)){p.payload.forEach(s=>{var u,d,P,o;Array.isArray(s.imei)&&s.imei.length>0&&((u=s.imei[0])!=null&&u.mac_id)?(a.push({id:s.id,label:s.registration_id,value:(d=s.imei[0])==null?void 0:d.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(P=s==null?void 0:s.vehicle_model)==null?void 0:P.name}),c.push((o=s.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",s)});const C="one",w=c;c.length>0&&x(ae({type:C,imei:w})),m(a),x(te(a)),_(!1)}else _(!1),console.error("Unexpected data format:",p),B.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),B.error(`Error fetching vehicle data: ${a}`)}},W=async a=>{const{label:c,imei:p,id:C,reg_id:w,checked:s}=a;S(o=>o.map(f=>f.id===C?{...f,checked:!s}:f));let u=[...y],d=[...y];if(!s)n.forEach(o=>{o.latestDocument.imei===p&&(u.push({label:c,value:o.latestDocument[c==="maininputvoltage"?"mainInputVoltage":c]}),d=u,b(u))});else{let o=y.filter(f=>f.label!==c);d=o,b(o)}console.log("tempParamList",d),x(A([{reg_id:w,imei:p,params:d}]))};return e.jsxs("div",{className:"app",children:[e.jsx(re,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(he,{title:"services",setShowVehicles:L,showVehicles:v,showParameters:j,setShowParameters:E,setShowCard:N,showCard:R}),e.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(h,{style:{width:v||j?"80%":"100%"},children:e.jsx(fe,{})}),v&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ne,{vehicleData:k,title:"Inspections",setParameterData:S,loadingVehicle:O,setShowVehicles:L,showVehicles:v,showParameters:j,setShowParameters:E})}),j&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ie,{parametersData:M,setParameterData:S,handleParameterChange:W})})]})]})]})}export{Ae as default};
