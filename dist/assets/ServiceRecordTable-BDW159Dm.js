import{a6 as w,j as t,y as V,b as s,x as ee,U as te,I as q,aq as le}from"./index-CLXmKO9l.js";import{r as ie}from"./createSvgIcon-nbF4Nr6P.js";import"./index.esm-DfMsjMuD.js";import{U as ae}from"./moment-B1gXbMh0.js";import{M as se,B as L,C as de}from"./menu2-DKh_djjf.js";import{d as F}from"./dayjs.min-KJH-_OFv.js";import{B as y}from"./customParseFormat-ocC5Vqbi.js";import{T as ce,a as ne,b as re,c as G,d as a,e as oe}from"./TableRow-BoXu6B2E.js";import{T as he}from"./TablePagination-CX7cA0ms.js";var N={},ue=w;Object.defineProperty(N,"__esModule",{value:!0});var D=N.default=void 0,pe=ue(ie()),xe=t;D=N.default=(0,pe.default)((0,xe.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");const ge={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid black",borderRadius:"5px",boxShadow:24,p:4,height:"600px",overflowY:"auto",scrollbarWidth:"50%"};function ve({open:c,setOpen:g,data:v,isInspection:n}){const m=()=>g(!1);return t.jsx("div",{children:t.jsx(se,{open:c,onClose:m,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",BackdropProps:{onClick:h=>h.stopPropagation()},children:t.jsx(L,{sx:ge,children:t.jsx(ae,{setOpen:g,data:v,isInspection:n})})})})}function Ne({where:c,isInspection:g}){const{collapsed:v}=V(e=>e.auth),{servicesData:n,loading:m,selectedService:h,statusBasedRecord:C}=V(e=>e.services),[k,R]=s.useState(!1),[O,z]=s.useState(null),[r,f]=s.useState(null),[j,E]=s.useState(null),[o,H]=s.useState(""),[S,W]=s.useState(),[_,T]=s.useState(0),[u,Y]=s.useState(12),J=ee();s.useEffect(()=>{J(te())},[]),s.useEffect(()=>{let e=n.map(l=>{var i;return{...l,vehicle_id:l.vehicle.id,vehicle:l.vehicle.registration_id,vehicle_group:((i=l==null?void 0:l.vehicle)==null?void 0:i.vehicle_group)||"N/A"}});f(e)},[n]),s.useEffect(()=>{var e,l;if(h&&C.length>0){const d={Overdue:2,"Due soon":1,Serviced:0}[h],x=d!==void 0&&((l=(e=C[d])==null?void 0:e.data)==null?void 0:l.map(b=>{var I,M,U;return{...b,vehicle_id:((I=b.vehicle)==null?void 0:I.id)||"N/A",vehicle:((M=b.vehicle)==null?void 0:M.registration_id)||"N/A",vehicle_group:((U=b.vehicle)==null?void 0:U.vehicle_group)||"N/A"}}))||[];console.log("Filtered Data:",x),W(x)}},[h,C]),s.useEffect(()=>{console.log("tableData: ",r),S&&f(S)},[S]),s.useEffect(()=>{console.log("tableData: ",r)},[r]);const B=e=>{console.log("handleEditClick",e);let l={id:e.id,vehicle:e.vehicle_id,user:e.user.id,priority_class:e.priority_class,completion_date:F(e.completion_date),next_due_date:F(e.next_due_date),segment:e.segment.id,chassis_no:e.chassis_no,odometer:e.odometer,attachment:e.attachment,status:e.status};console.log("objecct",l),R(!k),z(l)};let p=v?150:140,K=v?220:210;const[fe,Q]=s.useState([{field:"vehicle",headerName:"Vehicle",width:p},{field:"vehicle_group",headerName:"Vehicle group",width:p,valueGetter:e=>(e==null?void 0:e.group_name)||"N/A"},{field:"priority_class",headerName:"Priority Class",width:p},{field:"completion_date",headerName:"Completion Date",width:p},{field:"next_due_date",headerName:"Next Due Date",width:p},{field:"segment",headerName:"Segment",width:100,valueGetter:e=>(e==null?void 0:e.segment_name)||""},{field:"user",headerName:"User",width:K,valueGetter:e=>(e==null?void 0:e.email)||""},{field:"status",headerName:"Status",width:130}]);s.useEffect(()=>{c!=="service report"&&Q(e=>[...e,{field:"edit",headerName:"Edit",width:100,renderCell:l=>t.jsx(q,{onClick:()=>B(l.row),color:"primary","aria-label":"edit record",children:t.jsx(D,{})})}])},[c]);const X=e=>{let l=e.target.value;E(l)},A=r&&r.length>0?r.filter(e=>{var l;return(l=e.vehicle)==null?void 0:l.toLowerCase().includes((j==null?void 0:j.toLowerCase())||"")}):[],P=e=>{if(E(""),H(e),e){let l=n.filter(i=>i.status===e).map(i=>{var d;return{...i,vehicle_id:i.vehicle.id,vehicle:i.vehicle.registration_id,vehicle_group:((d=i==null?void 0:i.vehicle)==null?void 0:d.vehicle_group)||"N/A"}});f(l)}else{let l=n.map(i=>{var d;return{...i,vehicle_id:i.vehicle.id,vehicle:i.vehicle.registration_id,vehicle_group:((d=i==null?void 0:i.vehicle)==null?void 0:d.vehicle_group)||"N/A"}});f(l)}},Z=(e,l)=>{T(l)},$=e=>{Y(parseInt(e.target.value,10)),T(0)};return t.jsxs(t.Fragment,{children:[m&&t.jsx(de,{style:{position:"absolute",top:"50%",left:"50%"}}),c!=="service report"&&t.jsxs("div",{children:[t.jsx("input",{placeholder:"Search by vehicle ",value:j,type:"text",style:{padding:"8px",border:"1px solid grey",borderRadius:"10px",width:"250px",margin:"10px"},onChange:X}),t.jsx(y,{style:{margin:"10px",backgroundColor:o===""?"rgb(141, 166, 198)":void 0,color:o===""?"white":void 0},onClick:()=>P(""),children:"All"}),t.jsx(y,{style:{margin:"10px",backgroundColor:o==="Completed"?"rgb(141, 166, 198)":void 0,color:o==="Completed"?"white":void 0},onClick:()=>P("Completed"),children:"Completed"}),t.jsx(y,{style:{margin:"10px",backgroundColor:o==="Pending"?"rgb(141, 166, 198)":void 0,color:o==="Pending"?"white":void 0},onClick:()=>P("Pending"),children:"Pending"})]}),t.jsxs(L,{sx:{overflow:"auto",margin:"10px",border:"1px solid grey",borderRadius:"5px",background:"white"},children:[t.jsxs(ce,{component:le,children:[t.jsxs(ne,{children:[t.jsx(re,{children:t.jsxs(G,{children:[t.jsx(a,{children:"Sr no"}),t.jsx(a,{children:"Vehicle"}),t.jsx(a,{children:"Vehicle group"}),t.jsx(a,{children:"Priority class"}),t.jsx(a,{children:"Completion date"}),t.jsx(a,{children:"Next due date"}),t.jsx(a,{children:"Segment"}),t.jsx(a,{children:"User"}),t.jsx(a,{children:"Status"}),c!=="service report"&&t.jsx(a,{children:"Action"}),"          "]})}),t.jsx(oe,{children:A.slice(_*u,_*u+u).map((e,l)=>{var i,d,x;return t.jsxs(G,{children:[t.jsx(a,{children:_*u+l+1}),t.jsx(a,{children:e==null?void 0:e.vehicle}),t.jsx(a,{children:(i=e==null?void 0:e.vehicle_group)==null?void 0:i.group_name}),t.jsx(a,{children:e==null?void 0:e.priority_class}),t.jsx(a,{children:e==null?void 0:e.completion_date}),t.jsx(a,{children:e==null?void 0:e.next_due_date}),t.jsx(a,{children:(d=e==null?void 0:e.segment)==null?void 0:d.segment_name}),t.jsx(a,{children:(x=e==null?void 0:e.user)==null?void 0:x.email}),t.jsx(a,{children:e==null?void 0:e.status}),c!=="service report"&&t.jsx(a,{children:t.jsx(q,{onClick:()=>B(e),color:"primary","aria-label":"edit record",children:t.jsx(D,{})})})]},e==null?void 0:e.id)})})]}),t.jsx(he,{rowsPerPageOptions:[12],component:"div",count:A.length,rowsPerPage:u,page:_,onPageChange:Z,onRowsPerPageChange:$})]}),t.jsx(ve,{open:k,setOpen:R,data:O,isInspection:g})]})]})}export{Ne as S};
