import{a_ as X,a$ as $,b as t,j as s,aW as k,aY as w,fd as oe,fe as re,c4 as de,b7 as z,bB as le,ff as ie,bm as N,fg as ee,bf as ue,d4 as se,cf as he,dT as pe,dU as be,dV as _e,dW as ae,dX as o,dY as fe,f5 as ge,da as xe,eM as je,eN as ne,fc as ke,fh as Se,bH as te,bw as Ce,bx as De,bA as ye,bz as ve,bq as Be,bs as Pe,b5 as Te}from"./index-afFpPkEM.js";import{V as Ve}from"./VehicleMenu-j_6E9Qk-.js";import{P as Ae}from"./Parameters-DAc7c8om.js";/* empty css           */import{C as Ie,T as $e,d as Ee}from"./excelUtils-Qts1dbM1.js";import{E as me,T as Le}from"./Edit-CgHUQ9R2.js";import{D as Ye}from"./Remove-DIqqzEg8.js";import{a as Ne,B as Re}from"./BreakDownJobCardTable-ChAHX9Og.js";import{A as Me}from"./AddBreakdown-DyAN6vvd.js";import"./index.esm-74hSZoqK.js";import{S as Oe}from"./ServicesTopBar-D1ro-dkJ.js";import"./Autocomplete-DY00IQNq.js";import"./formik.esm-De7vemlD.js";import"./Add-CehcMxqq.js";import"./useMediaQuery-8A5gZ-2X.js";const He="https://cc.wikitrak.in/api-proxy/api/v1",Ge={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Ue=({breakdownData:b,status:u})=>{const _=X(),{isUpdateBreakdown:y}=$(x=>x.equipment),{w_customer_id:A}=$(x=>x.auth),[f,v]=t.useState(!1),B=()=>{console.log("breakdownData",b),localStorage.getItem("role"),_(oe(!y)),_(re(b))},E=()=>{console.log("dlt btn clicked"),localStorage.getItem("role"),v(!0)},P=async()=>{console.log("breakdownData data deleting");try{await de.delete(`${He}/vehicles/new/breakdown/create/${b.id}/`),z.success("breakdownData data deleted successfully!"),_(le(A))}catch(x){console.error("Error deleting breakdown data:",x),z.error("Failed to delete breakdown data. Please try again.")}v(!1)},I=()=>{v(!1)},W={color:"#686868"};return s.jsxs(k,{sx:Ge,children:[s.jsx(w,{onClick:B,color:"primary",disabled:(u==null?void 0:u.toLowerCase())==="rejected"||(u==null?void 0:u.toLowerCase())==="close",children:s.jsx(me,{})}),s.jsx(w,{onClick:E,children:s.jsx(Ye,{sx:W})}),s.jsx(Ie,{open:f,onClose:I,onConfirm:P})]})},ce=[{id:"breakdown_id",label:"BDID"},{id:"registration_id",label:"Vehicle No"},{id:"breakdown_topic",label:"Topic"},{id:"breakdown_sub_topic",label:"Sub Topic"},{id:"user",label:"Created"},{id:"technician",label:"Technician"},{id:"contact_person",label:"Contact person"},{id:"mob_no",label:"Contact person mobile"},{id:"description",label:"Cust. complaint"},{id:"submission_date",label:"Submission Date"},{id:"submission_time",label:"Submission Time"},{id:"status",label:"Status"}],Je=()=>{const{breakdowns:b}=$(e=>e.breakdown),{searchTerm:u}=$(e=>e.inspection),_=X(),[y,A]=t.useState("asc"),[f,v]=t.useState("BDID"),[B,E]=t.useState(0),[P,I]=t.useState(8),[W,x]=t.useState(!1),[R,m]=t.useState(null),[M,O]=t.useState("breakdown_id");t.useState({id:"",status:"",workshop:"",user:""}),t.useEffect(()=>{_(ie({}))},[]);const Q=e=>{A(f===e&&y==="asc"?"desc":"asc"),v(e)},H=(e,c)=>{E(c)},G=e=>{I(parseInt(e.target.value,10)),E(0)},S=((e,c,d)=>!c||!d?e:e.filter(n=>(()=>{var a,i,r,p,l,h,T,V,J,D;switch(c){case"breakdown_id":return((n==null?void 0:n.breakdown_id)||"").toString();case"registration_id":return((a=n==null?void 0:n.vehicle)==null?void 0:a.registration_id)||"";case"breakdown_topic":return((i=n==null?void 0:n.breakdown_topic)==null?void 0:i.topic)||"";case"user_name":return`${((p=(r=n==null?void 0:n.user)==null?void 0:r.us_user)==null?void 0:p.first_name)||""} ${((h=(l=n==null?void 0:n.user)==null?void 0:l.us_user)==null?void 0:h.last_name)||""}`;case"technician_name":return`${((V=(T=n==null?void 0:n.technician)==null?void 0:T.us_user)==null?void 0:V.first_name)||""} ${((D=(J=n==null?void 0:n.technician)==null?void 0:J.us_user)==null?void 0:D.last_name)||""}`;case"contact_person":return(n==null?void 0:n.contact_person)||"";case"mob_no":return(n==null?void 0:n.mob_no)||"";case"submission_date":return n!=null&&n.submission_date?N(n.submission_date).format("YYYY-MM-DD"):"";case"start_time":return n!=null&&n.submission_date?N(n.submission_date).format("HH:mm A"):"";case"status":return(n==null?void 0:n.status)||"";default:return""}})().toLowerCase().includes(d.toLowerCase())))((b==null?void 0:b.slice())||[],M,u),U=S.slice(B*P,B*P+P);console.log(U,S,"paginatedData");const L={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},g=S&&S.map(e=>{var d,n,j,a,i,r,p,l,h,T,V,J;const c=e!=null&&e.breakdown_parts&&(e==null?void 0:e.breakdown_parts.length)>0?e==null?void 0:e.breakdown_parts.map((D,Fe)=>{var K;return`${(K=D==null?void 0:D.spare_parts)==null?void 0:K.description}: Qty ${D==null?void 0:D.quantity}`}).join(";"):"N/A";return{BDID:(e==null?void 0:e.breakdown_id)||"","Registration ID":((d=e==null?void 0:e.vehicle)==null?void 0:d.registration_id)||"","Breakdown Topic":((n=e==null?void 0:e.breakdown_topic)==null?void 0:n.topic)||"","Breakdown Sub Topic":((a=(j=e.breakdown_topic)==null?void 0:j.breakdown_sub_topic)==null?void 0:a.name)||"","Customer Complaint":(e==null?void 0:e.description)||"","Created By":`${((r=(i=e==null?void 0:e.user)==null?void 0:i.us_user)==null?void 0:r.first_name)||""} ${((l=(p=e==null?void 0:e.user)==null?void 0:p.us_user)==null?void 0:l.last_name)||""}`,"Technician Name":`${((T=(h=e==null?void 0:e.technician)==null?void 0:h.us_user)==null?void 0:T.first_name)||""} ${((J=(V=e==null?void 0:e.technician)==null?void 0:V.us_user)==null?void 0:J.last_name)||""}`,"Contact Person":(e==null?void 0:e.contact_person)||"","Mobile No":(e==null?void 0:e.mob_no)||"","Submission Date":e!=null&&e.submission_date?N(e.submission_date).format("YYYY-MM-DD"):"","Submission Time":e!=null&&e.submission_date?N(e.submission_date).format("HH:mm A"):"",Status:(e==null?void 0:e.status)||"","Spare parts":c}});let C=ee("Breakdown"),Y=ee("Job Card");const q=(Y==null?void 0:Y.includes("Create"))||Y==="Read-Write-Only",F=(C==null?void 0:C.includes("Update"))||C==="Read-Write-Only";return s.jsxs(k,{sx:{m:"10px"},children:[s.jsxs(k,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[s.jsx($e,{columns:ce,selectedColumn:M,onColumnChange:O,searchTerm:u,onSearchChange:e=>_(ue(e))}),s.jsx(se,{variant:"contained",color:"success",onClick:()=>Ee(g,"breakdown-tickets.xlsx"),children:"Download Excel"})]}),s.jsxs(he,{children:[s.jsx(pe,{sx:{height:"55vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(be,{stickyHeader:!0,children:[s.jsx(_e,{children:s.jsxs(ae,{children:[ce.map(e=>s.jsx(o,{sx:L,children:s.jsx(Le,{active:f===e.id,direction:f===e.id?y:"asc",onClick:()=>Q(e.id),children:e.label})},e.id)),F&&s.jsx(o,{sx:L,children:"Action"}),q&&s.jsx(o,{sx:L,children:"Job card"})]})}),s.jsx(fe,{children:U.map((e,c)=>{var d,n,j,a,i,r,p,l,h,T,V;return s.jsxs(ae,{children:[s.jsx(o,{children:e==null?void 0:e.breakdown_id}),s.jsx(o,{children:(d=e==null?void 0:e.vehicle)==null?void 0:d.registration_id}),s.jsx(o,{children:(n=e==null?void 0:e.breakdown_topic)==null?void 0:n.topic}),s.jsx(o,{children:(j=e==null?void 0:e.breakdown_sub_topic)==null?void 0:j.name}),s.jsx(o,{children:`${(i=(a=e==null?void 0:e.user)==null?void 0:a.us_user)==null?void 0:i.first_name} ${(p=(r=e==null?void 0:e.user)==null?void 0:r.us_user)==null?void 0:p.last_name}`}),s.jsx(o,{children:`${((h=(l=e==null?void 0:e.technician)==null?void 0:l.us_user)==null?void 0:h.first_name)||"N/A"} ${((V=(T=e==null?void 0:e.technician)==null?void 0:T.us_user)==null?void 0:V.last_name)||""}`}),s.jsx(o,{children:e==null?void 0:e.contact_person}),s.jsx(o,{children:e==null?void 0:e.mob_no}),s.jsx(o,{children:e==null?void 0:e.description}),s.jsx(o,{children:(e==null?void 0:e.submission_date)&&N(e.submission_date).format("YYYY-MM-DD")||"N/A"}),s.jsx(o,{children:(e==null?void 0:e.submission_date)&&N(e.submission_date).format("HH:mm A")||"N/A"}),s.jsx(o,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),F&&s.jsx(o,{children:s.jsx(Ue,{breakdownData:e,status:e.status})}),q&&s.jsx(o,{children:s.jsx(se,{variant:"outlined",onClick:()=>{x(!0),m(e)},disabled:e.jobcard,children:"Create job card"})})]},c)})})]})}),s.jsx(ge,{component:"div",count:S.length,page:B,onPageChange:H,rowsPerPage:P,onRowsPerPageChange:G,rowsPerPageOptions:[5,10,15]}),s.jsx(Ne,{rowData:R,open:W,handleClose:()=>x(!1),isTechnician:!0})]})]})},We=Je;function qe(){const[b]=xe(),u=b.get("tab"),[_,y]=t.useState(0),A=(f,v)=>{y(v)};return t.useEffect(()=>{u&&y(Number(u))},[]),s.jsxs(k,{sx:{width:"100%"},children:[s.jsx(k,{sx:{borderBottom:1,borderColor:"divider"},children:s.jsxs(je,{value:_,onChange:A,"aria-label":"Breakdown Tabs",children:[s.jsx(ne,{label:"Breakdown Tickets"}),s.jsx(ne,{label:"Breakdown Job Cards"})]})}),s.jsxs(k,{sx:{mt:2},children:[_===0&&s.jsx(We,{}),_===1&&s.jsx(Re,{})]})]})}function ds(){const{locationData:b,selectedVehicle:u,selectedParameterList:_,onlineVehicle:y}=$(e=>e.liveMap),{mode:A,selectedVehicleGroup:f,vehicleZone:v}=$(e=>e.dashboard),B=Te(A),[E,P]=t.useState([]),{w_customer_id:I,userInfo:W}=$(e=>e.auth),[x,R]=t.useState(),[m,M]=t.useState(!1),[O,Q]=t.useState(!1),[H,G]=t.useState([]);t.useState(!0);const[Z,S]=t.useState(!1),[U,L]=t.useState(!1);let g=X();const C=JSON.parse(localStorage.getItem("w_userDetails"));console.log("userInfo",C),t.useEffect(()=>{var e;Y(),g(ke()),g(le(I)),g(Se({oem:(e=C==null?void 0:C.oem)==null?void 0:e.name}))},[]),t.useEffect(()=>{console.log("selectedVehicleGroup",f)},[f]),t.useEffect(()=>{G([]),g(te([{reg_id:"",imei:"",params:[]}]))},[u]);const Y=async()=>{try{S(!0);let e=[],c=[];const d=await g(Ce({w_customer_id:I}));if(Array.isArray(d.payload)){d.payload.forEach(a=>{var i,r,p,l;Array.isArray(a.imei)&&a.imei.length>0&&((i=a.imei[0])!=null&&i.mac_id)?(e.push({id:a.id,label:a.registration_id,value:(r=a.imei[0])==null?void 0:r.mac_id,vehilce_type:a==null?void 0:a.segment,chassis_no:a==null?void 0:a.chassis_no,engine_no:a==null?void 0:a.engine_no,workShop:a==null?void 0:a.workshop,registration_id:a==null?void 0:a.registration_id,sell_date:a==null?void 0:a.sell_date,customer_name:a==null?void 0:a.customer_name,vehicle_model:(p=a==null?void 0:a.vehicle_model)==null?void 0:p.name,user:a==null?void 0:a.user,vehicle_group:a==null?void 0:a.vehicle_group,segment:a==null?void 0:a.segment}),c.push((l=a.imei[0])==null?void 0:l.mac_id)):console.error("IMEI data not found for item:",a)});const n="one",j=c;c.length>0&&g(De({type:n,imei:j})),P(e),g(ye({w_customer_id:I})),g(ve(e)),S(!1)}else S(!1),console.error("Unexpected data format:",d),z.error("Unexpected data format:")}catch(e){console.error("Error fetching vehicle data:",e),z.error(`Error fetching vehicle data: ${e}`)}},q=async e=>{const{label:c,imei:d,id:n,reg_id:j,checked:a}=e;R(l=>l.map(h=>h.id===n?{...h,checked:!a}:h));let i=[...H],r=[...H];if(!a)b.forEach(l=>{l.latestDocument.imei===d&&(i.push({label:c,value:l.latestDocument[c==="maininputvoltage"?"mainInputVoltage":c]}),r=i,G(i))});else{let l=H.filter(h=>h.label!==c);r=l,G(l)}console.log("tempParamList",r),g(te([{reg_id:j,imei:d,params:r}]))},F=E.filter(e=>Object.keys(f).length===0||e.vehicle_group===f.id);return s.jsxs("div",{className:"app",children:[s.jsx(Be,{}),s.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[s.jsx(Oe,{title:"Breakdown",setShowVehicles:M,showVehicles:m,setShowVehiclesGroup:L,showVehiclesGroup:U}),s.jsx(Pe,{setShowVehiclesGroup:L,showVehiclesGroup:U}),s.jsxs(k,{style:{display:"flex",width:"100%",height:"95vh"},children:[s.jsxs(k,{style:{width:m||O?"80%":"100%"},children:[s.jsx(Me,{where:"Breakdown"}),s.jsx(qe,{})]}),m&&s.jsx(k,{style:{width:"20%",backgroundColor:B.grey[100]},children:s.jsx(Ve,{vehicleData:F,title:"Inspections",setParameterData:R,loadingVehicle:Z,setShowVehicles:M,showVehicles:m,showParameters:O,setShowParameters:Q})}),O&&s.jsx(k,{style:{width:"20%",backgroundColor:B.grey[100]},children:s.jsx(Ae,{parametersData:x,setParameterData:R,handleParameterChange:q})})]})]})]})}export{ds as default};
