import{b as o,z as w,y as L,br as W,C as N,j as e,G as I,R as G,bj as H,bk as J,af as $,a1 as Y,a2 as K,a4 as Q}from"./index-CkVXv9ba.js";import{V as X}from"./VehicleMenu-BMHzUesm.js";import{t as Z}from"./SearchTab-C-4HC9hN.js";import"./Loader-Dd5DES-9.js";import"./LiveMapServices-Bn2VoQkL.js";import"./Socket-DLjvxrzW.js";import{P as ee}from"./Parameters-DxS22gQJ.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as re}from"./LeftSideBar2-DFaE75pF.js";import{S as se}from"./ServiceRecordTable-CECoRuae.js";import{a as ae}from"./formik.esm-DD-cgF7_.js";import{c as te,a as S}from"./index.esm-DPJL7EAD.js";import{N as oe}from"./NewLoader-_sRgAODE.js";import{L as ie,A as le}from"./moment-DDUn8_Ez.js";import{T as b}from"./TextField-BjXx7y32.js";import{M as F}from"./menu2-DYWuZo2I.js";import{B as C}from"./CircularProgress-DDaf_W8R.js";import{D as ne,a as ce,b as de}from"./DialogTitle-DEIakIKz.js";import{S as he}from"./ServicesTopBar-DWeS--K7.js";import"./Autocomplete-D25IVYCE.js";import"./useControlled-DkJKKhqe.js";import"./usePreviousProps-Qwsarr8y.js";import"./index-DSiY7ezQ.js";import"./createSvgIcon-jWlltDFa.js";import"./Card--tRU4De9.js";import"./CardContent-B-xbxThi.js";import"./SearchInput-Z_ShuIvX.js";import"./index-CooEpPvZ.js";import"./TableRow-CFK2ZdGf.js";import"./TablePagination-sEywi6b-.js";import"./isBetween-jnBCJbfH.js";const pe=({setOpen:n})=>{const[c,f]=o.useState(null),{vehicleList:u}=w(a=>a.liveMap),{vendorList:E,segMentList:P,loading:k}=w(a=>a.services),A=L(),[M,x]=o.useState([]),[d,D]=o.useState([]),r=ae({initialValues:{vehicle:"",vendor:"",priority_class:"",chassis_no:"",odometer:"",attachment:null,status:"Pending"},validationSchema:te().shape({vehicle:S().required("Vehicle is required"),vendor:S().required("Vendor is required"),priority_class:S().required("Priority class is required"),chassis_no:S().required("Chassis number is required"),odometer:S().required("Odometer is required")}),onSubmit:async a=>{const t=new FormData;t.append("vehicle",a.vehicle),t.append("segment",a.vendor),t.append("priority_class",a.priority_class),t.append("chassis_no",a.chassis_no),t.append("odometer",a.odometer),c&&t.append("attachment",c),t.append("status",a.status),t.append("user",JSON.parse(localStorage.getItem("w_userDetails")).user_id),console.log("form data",a),(await A(W(t))).payload&&(N.success("Service created successfully"),r.resetForm(),f(null),n(!1))}}),V=a=>{const t=a.target.files[0];f(t),r.setFieldValue("attachment",t)},g=["On Time","Over Due","Emergency"];o.useEffect(()=>{let a=u.map(t=>({label:t.registration_id,value:t.id}));x(a)},[u]),o.useEffect(()=>{let a=P.map(t=>({label:t.segment_name,value:t.id}));D(a)},[P]);const y={PaperProps:{style:{maxHeight:300,overflowY:"auto"}}};return e.jsxs(ie,{dateAdapter:le,children:[k&&e.jsx(oe,{}),e.jsxs("form",{onSubmit:r.handleSubmit,style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx(b,{select:!0,name:"vehicle",label:"Select Vehicle",value:r.values.vehicle,onChange:r.handleChange,error:r.touched.vehicle&&!!r.errors.vehicle,helperText:r.touched.vehicle&&r.errors.vehicle,SelectProps:{MenuProps:y},children:M.map(a=>e.jsx(F,{value:a.value,children:a.label},a.value))}),e.jsx(b,{select:!0,name:"vendor",label:"Select segment",value:r.values.vendor,onChange:r.handleChange,error:r.touched.vendor&&!!r.errors.vendor,helperText:r.touched.vendor&&r.errors.vendor,children:d&&d.length>0&&d.map(a=>e.jsx(F,{value:a.value,children:a.label},a.value))}),e.jsx(b,{select:!0,name:"priority_class",label:"Priority Class",value:r.values.priority_class,onChange:r.handleChange,error:r.touched.priority_class&&!!r.errors.priority_class,helperText:r.touched.priority_class&&r.errors.priority_class,children:g.map(a=>e.jsx(F,{value:a,children:a},a))}),e.jsx(b,{name:"chassis_no",label:"Chassis Number",value:r.values.chassis_no,onChange:r.handleChange,error:r.touched.chassis_no&&!!r.errors.chassis_no,helperText:r.touched.chassis_no&&r.errors.chassis_no}),e.jsx(b,{name:"odometer",label:"Odometer",value:r.values.odometer,onChange:r.handleChange,error:r.touched.odometer&&!!r.errors.odometer,helperText:r.touched.odometer&&r.errors.odometer}),e.jsxs(C,{children:[e.jsx("input",{type:"file",name:"attachment",onChange:V}),r.touched.attachment&&r.errors.attachment&&e.jsx("div",{style:{color:"red"},children:r.errors.attachment})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[e.jsx(I,{type:"submit",variant:"contained",color:"primary",sx:{mr:2},children:"Save"}),e.jsx(I,{variant:"outlined",onClick:()=>n(!1),children:"Cancel"})]})]})]})};function ue(){const[n,c]=G.useState(!1);L();const f=()=>c(!0),u=()=>c(!1);return e.jsxs("div",{children:[e.jsx(I,{variant:"outlined",onClick:f,children:"+ Add New Entry"}),e.jsxs(ne,{open:n,onClose:u,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[e.jsx(ce,{children:"Add New Entry"}),e.jsx(de,{dividers:!0,children:e.jsx(pe,{setOpen:c})})]})]})}const me=()=>{const n=L();return o.useEffect(()=>{n(H()),n(J())},[]),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(ue,{})})]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(se,{isInspection:!1})})]})]})},ve=me;function Je(){const{locationData:n,selectedVehicle:c,selectedParameterList:f}=w(i=>i.liveMap),{mode:u}=w(i=>i.dashboard),E=Z(u),[P,k]=o.useState([]),{w_customer_id:A}=w(i=>i.auth),[M,x]=o.useState(),[d,D]=o.useState(!1),[r,V]=o.useState(!1),[g,y]=o.useState([]),[a,t]=o.useState(!0),[R,T]=o.useState(!1);let j=L();o.useEffect(()=>{z()},[]),o.useEffect(()=>{y([]),j($([{reg_id:"",imei:"",params:[]}]))},[c]);const z=async()=>{try{T(!0);let i=[],h=[];const m=await j(Y({w_customer_id:A}));if(Array.isArray(m.payload)){m.payload.forEach(s=>{var v,p,B,l;Array.isArray(s.imei)&&s.imei.length>0&&((v=s.imei[0])!=null&&v.mac_id)?(i.push({id:s.id,label:s.registration_id,value:(p=s.imei[0])==null?void 0:p.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(B=s==null?void 0:s.vehicle_model)==null?void 0:B.name}),h.push((l=s.imei[0])==null?void 0:l.mac_id)):console.error("IMEI data not found for item:",s)});const O="one",q=h;h.length>0&&j(K({type:O,imei:q})),k(i),j(Q(i)),T(!1)}else T(!1),console.error("Unexpected data format:",m),N.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),N.error(`Error fetching vehicle data: ${i}`)}},U=async i=>{const{label:h,imei:m,id:O,reg_id:q,checked:s}=i;x(l=>l.map(_=>_.id===O?{..._,checked:!s}:_));let v=[...g],p=[...g];if(!s)n.forEach(l=>{l.latestDocument.imei===m&&(v.push({label:h,value:l.latestDocument[h==="maininputvoltage"?"mainInputVoltage":h]}),p=v,y(v))});else{let l=g.filter(_=>_.label!==h);p=l,y(l)}console.log("tempParamList",p),j($([{reg_id:q,imei:m,params:p}]))};return e.jsxs("div",{className:"app",children:[e.jsx(re,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(he,{title:"services",setShowVehicles:D,showVehicles:d,showParameters:r,setShowParameters:V,setShowCard:t,showCard:a}),e.jsxs(C,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(C,{style:{width:d||r?"80%":"100%"},children:e.jsx(ve,{})}),d&&e.jsx(C,{style:{width:"20%",backgroundColor:E.grey[100]},children:e.jsx(X,{vehicleData:P,title:"Inspections",setParameterData:x,loadingVehicle:R,setShowVehicles:D,showVehicles:d,showParameters:r,setShowParameters:V})}),r&&e.jsx(C,{style:{width:"20%",backgroundColor:E.grey[100]},children:e.jsx(ee,{parametersData:M,setParameterData:x,handleParameterChange:U})})]})]})]})}export{Je as default};
