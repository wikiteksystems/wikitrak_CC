import{g as xe,a as me,s as je,_ as H,r,u as ye,b as De,j as e,e as Se,f as ve,i as W,k as C,a0 as $,a1 as ne,W as le,a2 as we,a3 as be,a4 as z,a5 as I,B as V,T as M,a6 as ie,a7 as Me,a8 as Te,a9 as Ce,w as F,aa as ce,m as Ae,K as ke,L as _e,O as Ye}from"./index-8Y8teEuv.js";import{t as K,L as Ie}from"./LeftSideBar2-DydqA_nL.js";import{L as Le}from"./LiveMapTopBar-CIhBDoHe.js";import{V as Ee}from"./VehicleMenu-J_7HAcbF.js";import{T as Ne}from"./TripMap-B8MQ-mK5.js";import{d as T}from"./dayjs.min-BFRTsoaf.js";import{S as Oe,D as Re}from"./index-GSd37eOC.js";import{r as de}from"./createSvgIcon-ZavEQmFS.js";import{B as h,C as Be,M as Pe}from"./menu2-BzT-vqbm.js";import{C as Ve}from"./Card-DwG5ATbK.js";import{C as $e}from"./CardContent-DGL0raHI.js";import"./TripVehicleInfo-Bm1BBFL7.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as Fe}from"./VehicleGroups-DGKAXHP5.js";import"./useControlled-CSTvTuKQ.js";import"./Close-yc408kYL.js";import"./jcb-aCHXMCXy.js";import"./index-CuiQMBhl.js";import"./TextField-D61hmCNj.js";import"./esm-BmjadpKX.js";import"./preet_tractor-CDwt_mVh.js";import"./Info-BySOAkbS.js";import"./customParseFormat-CpU1u10Z.js";function qe(s){return xe("MuiCardActions",s)}me("MuiCardActions",["root","spacing"]);const Ge=["disableSpacing","className"],Ue=s=>{const{classes:o,disableSpacing:m}=s;return ve({root:["root",!m&&"spacing"]},qe,o)},ze=je("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:m}=s;return[o.root,!m.disableSpacing&&o.spacing]}})(({ownerState:s})=>H({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),He=r.forwardRef(function(o,m){const j=ye({props:o,name:"MuiCardActions"}),{disableSpacing:d=!1,className:u}=j,S=De(j,Ge),g=H({},j,{disableSpacing:d}),f=Ue(g);return e.jsx(ze,H({className:Se(f.root,u),ownerState:g,ref:m},S))}),We=He,{RangePicker:Ke}=Re,Xe=()=>{const s=W(),{selectedVehicle:o}=C(c=>c.liveMap),{selectedTripData:m,mode:j}=C(c=>c.dashboard),[d,u]=r.useState(),[S,g]=r.useState(),f=K(j);r.useEffect(()=>{const c=T().subtract(5,"day");if(u(c),g(T()),o!=null&&o.imei){let i={imei:o==null?void 0:o.imei,startDate:T().subtract(5,"day").startOf("day"),endDate:T().endOf("day"),page:1};s($(i)),s(ne(i))}},[o]);const x=(c,i)=>{if(c){const A=T(i[0]).startOf("day"),y=T(i[1]).endOf("day");let Y={imei:o==null?void 0:o.imei,startDate:A.format(),endDate:y.format(),page:1};u(T(i[0])),g(T(i[1])),s($(Y)),s(ne(Y))}else console.log("Clear date")};return e.jsx(Oe,{direction:"vertical",size:12,children:e.jsx(Ke,{value:[d,S],onChange:(c,i)=>{x(c,i)},style:{backgroundColor:f.grey[500],color:f.grey[400]}})})};var X={},Je=le;Object.defineProperty(X,"__esModule",{value:!0});var pe=X.default=void 0,Qe=Je(de()),Ze=e;pe=X.default=(0,Qe.default)((0,Ze.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var J={},et=le;Object.defineProperty(J,"__esModule",{value:!0});var he=J.default=void 0,tt=et(de()),st=e;he=J.default=(0,tt.default)((0,st.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const at=()=>{var Q,Z,ee,te;const s=W(),{tripList:o,selectedTripData:m,loading:j,trips:d,activeIndex:u,searchText:S,mode:g,isNavigate:f,allTripList:x,trip_payload:c,page:i}=C(t=>t.dashboard),{selectedVehicle:A}=C(t=>t.liveMap),y=K(g),[Y,q]=r.useState(!1),[l,L]=r.useState({}),[R,k]=r.useState(""),[B,G]=r.useState(0);r.useEffect(()=>{console.log("trips",d),(d==null?void 0:d.length)>0&&k(d[0])},[d]),r.useEffect(()=>{console.log("allTripList",x);const t=v(x);s(we(t))},[x]),r.useEffect(()=>{!(m.length>0)&&f&&u!==null&&_.length>0&&n(_[u])},[m,f]);const n=async t=>{var b;let a={imei:A.imei,startDate:t.startDate,endDate:t.endDate};const D=await be(a);((b=D==null?void 0:D.data)==null?void 0:b.documents.length)>0?(s(f(!1)),s(z(D.data.documents[0].data))):(s(f(!1)),s(z([])))},v=t=>{const a=new Set,D=[];return t.forEach(b=>{const O=I(b.startTime).format("YYYY-MM-DD");a.has(O)||(a.add(O),D.push(O))}),D},w=(t,a)=>{s(ie(null)),s(Me(t)),s(Te(!1)),k(t),G(a)},_=x.filter(t=>I(t.startTime).format("YYYY-MM-DD")===R),U=async(t,a)=>{s(z(a.data)),s(ie(t)),s(Ce(0))},p=t=>{L(t),q(!0)},E=()=>{q(!1),L({})},N=t=>t?t.split(" ").slice(0,2).join(" "):"",P=async()=>{const t={...c,page:i+1};try{(await s($(t))).error?F.error("No Trip! within selected date"):s(ce(i+1))}catch{F.error("No Trip! within selected date")}},ue=()=>{if(i<=1)return;const t={...c,page:i-1};s(ce(i-1)),s($(t))};return e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsxs(h,{children:[e.jsx(h,{sx:{color:y.grey[400]},children:"Select Date"}),e.jsx(h,{sx:{mt:1},children:e.jsx(Xe,{})})]}),j?e.jsx("div",{style:{width:"100%",margin:"38%"},children:e.jsx(Be,{})}):e.jsxs(e.Fragment,{children:[e.jsx(h,{children:e.jsx(h,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:x&&(x==null?void 0:x.length)>0?e.jsx(e.Fragment,{children:d.map((t,a)=>e.jsx(h,{children:e.jsx(V,{onClick:()=>{w(t,a)},style:{backgroundColor:B===a?y.grey[300]:y.grey[200],color:B===a?"black":y.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:t})},a))}):e.jsx(M,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),e.jsxs(h,{sx:{height:"70vh",width:"100%",overflowY:"auto"},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(V,{disabled:i<=1,onClick:ue,children:e.jsx(pe,{})}),e.jsx(V,{disabled:!(c!=null&&c.imei),onClick:P,children:e.jsx(he,{})})]}),_&&_.length>0&&_.map((t,a)=>{var se,ae,re,oe;const D=(ae=(se=t==null?void 0:t.startLocation)==null?void 0:se.address)==null?void 0:ae.address,b=(oe=(re=t==null?void 0:t.endLocation)==null?void 0:re.address)==null?void 0:oe.address,O=D?`${D.town||D.city||""}`:"",ge=b?`${b.town||b.city||""}`:"";return e.jsxs(h,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:u===a?"black":y.grey[400],backgroundColor:u===a?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:g?y.grey[300]:y.grey[200]}},onClick:()=>U(a,t),children:[e.jsxs(M,{sx:{cursor:"text"},children:[a+1,". ",N(O)," to"," ",N(ge)," "]}),e.jsxs(M,{children:[t!=null&&t.startTime?I(new Date(t.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",t!=null&&t.endTime?I(new Date(t.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",e.jsx("span",{style:{color:g?"orange":"blue",cursor:"pointer"},onClick:fe=>{fe.stopPropagation(),p(t)},children:"...see more"})]})]},a)})]})]})]}),e.jsx(Pe,{open:Y,onClose:E,children:e.jsxs(Ve,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[e.jsxs($e,{children:[e.jsx(M,{variant:"h6",component:"div",children:"Trip Details"}),e.jsxs(M,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Location:"})," ",((Z=(Q=l==null?void 0:l.startLocation)==null?void 0:Q.address)==null?void 0:Z.display_name)||"N/A"]}),e.jsxs(M,{sx:{mt:2},children:[e.jsx("strong",{children:"End Location:"})," ",((te=(ee=l==null?void 0:l.endLocation)==null?void 0:ee.address)==null?void 0:te.display_name)||"N/A"]}),e.jsxs(M,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Time:"})," ",l!=null&&l.startTime?I(new Date(l.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),e.jsxs(M,{sx:{mt:2},children:[e.jsx("strong",{children:"End Time:"})," ",l!=null&&l.endTime?I(new Date(l.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),e.jsx(We,{children:e.jsx(V,{onClick:E,children:"Close"})})]})})]})},rt=at;function kt(){const{w_customer_id:s}=C(n=>n.auth),{collapsed:o}=C(n=>n.auth),{mode:m,selectedVehicleGroup:j}=C(n=>n.dashboard),{vehicleList:d,selectedVehicle:u}=C(n=>n.liveMap),[S,g]=r.useState(!1),[f,x]=r.useState(!0),[c,i]=r.useState([]),[A,y]=r.useState(!1);r.useState([]);const[Y,q]=r.useState({lat:18.516726,lng:73.856255});r.useState([]);const[l,L]=r.useState(!1),R=K(m);let k=W();r.useEffect(()=>{B()},[]),r.useEffect(()=>{var n,v,w;Object.keys(u).length===0&&d.length>0&&k(Ae({imei:(v=(n=d[0])==null?void 0:n.imei[0])==null?void 0:v.mac_id,reg_id:(w=d[0])==null?void 0:w.registration_id}))},[u,d]);const B=async()=>{try{let n=[],v=[];const w=await k(ke({w_customer_id:s}));if(Array.isArray(w.payload)){w.payload.forEach(p=>{var E,N,P;Array.isArray(p.imei)&&p.imei.length>0&&((E=p.imei[0])!=null&&E.mac_id)?(n.push({id:p.id,label:p.registration_id,value:(N=p.imei[0])==null?void 0:N.mac_id,workShop:p==null?void 0:p.workshop,vehicle_group:p==null?void 0:p.vehicle_group}),v.push((P=p.imei[0])==null?void 0:P.mac_id)):console.error("IMEI data not found for item:",p)});const _="one",U=v;v.length>0&&k(_e({type:_,imei:U})),k(Ye({w_customer_id:s})),i(n)}else console.error("Unexpected data format:",w),F.error("Unexpected data format:")}catch(n){console.error("Error fetching vehicle data:",n),F.error(`Error fetching vehicle data: ${n}`)}},G=c.filter(n=>Object.keys(j).length===0||n.vehicle_group===j.id);return e.jsxs("div",{className:"app",children:[e.jsx(Ie,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Le,{title:"Trip Monitor",setShowVehicles:g,showVehicles:S,setShowCard:x,showCard:f,sideBarTrip:A,setSideBarTrip:y,setShowVehiclesGroup:L,showVehiclesGroup:l}),e.jsx(Fe,{setShowVehiclesGroup:L,showVehiclesGroup:l,where:"tripmonitor"}),e.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(h,{style:{width:S||A?"80%":"100%"},children:e.jsx(Ne,{center:Y,showCard:f})}),S&&e.jsx(h,{style:{width:"20%",backgroundColor:R.grey[100]},children:e.jsx(Ee,{vehicleData:G,setShowVehicles:g,showVehicles:S,title:"Live Monitor"})}),e.jsx(h,{style:{width:o?"22%":"20%",display:A?"block":"none",backgroundColor:R.grey[100]},children:e.jsx(rt,{})})]})]})]})}export{kt as default};
