import{ab as ce,j as t,z as M,b as n,y as oe,Z as $,I as Z,P as re,D as E,C as he}from"./index-BZWPmy-k.js";import{r as ue}from"./createSvgIcon-DR_TaOiT.js";import{U as xe,D as ve,m as _}from"./moment-962aWhg3.js";import{D as ge,a as pe,b as _e}from"./DialogTitle-DX4O2Sc1.js";import"./NewLoader-DYbgopkz.js";import{S as fe}from"./SearchInput-DK9j013D.js";import{B as S}from"./index-ChsK6rNN.js";import{B as je}from"./CircularProgress-Bq22WH7M.js";import{T as De,a as me,b as be,c as J,d as a,e as Ce}from"./TableRow-BzY2mQeS.js";import{T as Se}from"./TablePagination-CDf2jKWs.js";var R={},Pe=ce;Object.defineProperty(R,"__esModule",{value:!0});var A=R.default=void 0,ye=Pe(ue()),Ne=t;A=R.default=(0,ye.default)((0,Ne.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");function Ye({open:x,setOpen:D,data:m,isInspection:v}){const I=()=>D(!1);return t.jsxs(ge,{open:x,onClose:I,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[t.jsx(pe,{children:"Update Information"}),t.jsx(_e,{dividers:!0,children:t.jsx(xe,{setOpen:D,data:m,isInspection:v})})]})}const r={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};function ze({where:x,isInspection:D}){const{collapsed:m}=M(e=>e.auth),{servicesData:v,loading:I,selectedService:P,statusBasedRecord:y}=M(e=>e.services),{searchTerm:h}=M(e=>e.inspection),[B,L]=n.useState(!1),[K,Q]=n.useState(null),[g,b]=n.useState(null),[ke,X]=n.useState(""),[p,T]=n.useState(""),[N,w]=n.useState(),[Y,U]=n.useState(0),[C,ee]=n.useState(7),[V,te]=n.useState(),[F,se]=n.useState(),z=oe();n.useEffect(()=>{z($())},[]),n.useEffect(()=>{let e=v.map(l=>{var s,c,o,d,i;return{...l,vehicle_id:l.vehicle.id,vehicle:l.vehicle.registration_id,vehicle_group:((s=l==null?void 0:l.vehicle)==null?void 0:s.vehicle_group)||"N/A",sub_model:(o=(c=l==null?void 0:l.vehicle)==null?void 0:c.sub_model)==null?void 0:o.name,model:(i=(d=l==null?void 0:l.vehicle)==null?void 0:d.vehicle_model)==null?void 0:i.name}});b(e)},[v]),n.useEffect(()=>{var e,l;if(P&&y.length>0){const c={Overdue:2,"Due soon":1,Serviced:0}[P],o=c!==void 0&&((l=(e=y[c])==null?void 0:e.data)==null?void 0:l.map(d=>{var i,u,j;return{...d,vehicle_id:((i=d.vehicle)==null?void 0:i.id)||"N/A",vehicle:((u=d.vehicle)==null?void 0:u.registration_id)||"N/A",vehicle_group:((j=d.vehicle)==null?void 0:j.vehicle_group)||"N/A"}}))||[];console.log("Filtered Data:",o),w(o)}},[P,y]),n.useEffect(()=>{console.log("tableData: ",g),N&&b(N)},[N]),n.useEffect(()=>{console.log("tableData: ",g)},[g]);const H=e=>{console.log("handleEditClick",e);let l={id:e.id,vehicle:e.vehicle_id,user:e.user.id,priority_class:e.priority_class,completion_date:E(e.completion_date),next_due_date:E(e.next_due_date),segment:e.segment.id,chassis_no:e.chassis_no,odometer:e.odometer,attachment:e.attachment,status:e.status,entry_date:E(e.created)};console.log("objecct",l),L(!B),Q(l)};let f=m?150:140,le=m?220:210;const[Me,ae]=n.useState([{field:"vehicle",headerName:"Vehicle",width:f},{field:"vehicle_group",headerName:"Vehicle group",width:f,valueGetter:e=>(e==null?void 0:e.group_name)||"N/A"},{field:"priority_class",headerName:"Priority Class",width:f},{field:"completion_date",headerName:"Completion Date",width:f},{field:"next_due_date",headerName:"Next Due Date",width:f},{field:"segment",headerName:"Segment",width:100,valueGetter:e=>(e==null?void 0:e.segment_name)||""},{field:"user",headerName:"User",width:le,valueGetter:e=>(e==null?void 0:e.email)||""},{field:"status",headerName:"Status",width:130}]);n.useEffect(()=>{x!=="service report"&&ae(e=>[...e,{field:"edit",headerName:"Edit",width:100,renderCell:l=>t.jsx(Z,{onClick:()=>H(l.row),color:"primary","aria-label":"edit record",children:t.jsx(A,{})})}])},[x]);const q=g&&g.length>0?g.filter(e=>{var d,i,u,j,G,O,W;const l=(d=e==null?void 0:e.vehicle)==null?void 0:d.toLowerCase().includes(h==null?void 0:h.toLowerCase()),s=`${((u=(i=e==null?void 0:e.user)==null?void 0:i.us_user)==null?void 0:u.first_name)||""}${((G=(j=e==null?void 0:e.user)==null?void 0:j.us_user)==null?void 0:G.last_name)||""}`.toLowerCase().includes(h==null?void 0:h.toLowerCase()),c=(O=e==null?void 0:e.service_record_id)==null?void 0:O.toLowerCase().includes(h==null?void 0:h.toLowerCase()),o=(W=e==null?void 0:e.status)==null?void 0:W.toLowerCase().includes(h==null?void 0:h.toLowerCase());return l||s||c||o}):[],de=()=>{if(V&&F){T("");let e={startDate:_(new Date(V)).format("YYYY-MM-DD"),endDate:_(new Date(F)).format("YYYY-MM-DD")};z($(e))}else he.error("Please select start date and end date")},k=e=>{if(X(""),T(e),e){let l=v.filter(s=>s.status===e).map(s=>{var c,o,d,i;return{...s,vehicle_id:s.vehicle.id,vehicle:s.vehicle.registration_id,vehicle_group:((c=s==null?void 0:s.vehicle)==null?void 0:c.vehicle_group)||"N/A",sub_model:(d=(o=s==null?void 0:s.vehicle)==null?void 0:o.sub_model)==null?void 0:d.name,model:(i=s==null?void 0:s.vehicle_model)==null?void 0:i.name}});b(l)}else{let l=v.map(s=>{var c,o,d,i;return{...s,vehicle_id:s.vehicle.id,vehicle:s.vehicle.registration_id,vehicle_group:((c=s==null?void 0:s.vehicle)==null?void 0:c.vehicle_group)||"N/A",sub_model:(d=(o=s==null?void 0:s.vehicle)==null?void 0:o.sub_model)==null?void 0:d.name,model:(i=s==null?void 0:s.vehicle_model)==null?void 0:i.name}});b(l)}},ie=(e,l)=>{U(l)},ne=e=>{ee(parseInt(e.target.value,10)),U(0)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx(fe,{}),t.jsx(S,{style:{margin:"10px",backgroundColor:p===""?"rgb(141, 166, 198)":void 0,color:p===""?"white":void 0},onClick:()=>k(""),children:"All"}),t.jsx(S,{style:{margin:"10px",backgroundColor:p==="Completed"?"rgb(141, 166, 198)":void 0,color:p==="Completed"?"white":void 0},onClick:()=>k("Completed"),children:"Completed"}),t.jsx(S,{style:{margin:"10px",backgroundColor:p==="Pending"?"rgb(141, 166, 198)":void 0,color:p==="Pending"?"white":void 0},onClick:()=>k("Pending"),children:"Pending"}),t.jsx(ve,{setStartDate:te,setEndDate:se,selectedDate:!1}),t.jsx(S,{style:{margin:"10px",background:"rgb(141, 166, 198)",color:"white"},onClick:()=>de(),children:"Apply"})]}),t.jsxs(je,{sx:{overflow:"auto",margin:"10px",borderRadius:"5px",background:"white"},children:[t.jsxs(De,{component:re,children:[t.jsxs(me,{children:[t.jsx(be,{children:t.jsxs(J,{children:[t.jsx(a,{sx:r,children:"SRID"}),t.jsx(a,{sx:r,children:"Vehicle"}),t.jsx(a,{sx:r,children:"Vehicle group"}),t.jsx(a,{sx:r,children:"Vehicle model"}),t.jsx(a,{sx:r,children:"Vehicle submodel"}),t.jsx(a,{sx:r,children:"Priority class"}),t.jsx(a,{sx:r,children:"Entry date"}),t.jsx(a,{sx:r,children:"Entry time"}),t.jsx(a,{sx:r,children:"Completion date"}),t.jsx(a,{sx:r,children:"Next due date"}),t.jsx(a,{sx:r,children:"Segment"}),t.jsx(a,{sx:r,children:"User"}),t.jsx(a,{sx:r,children:"Status"}),x!=="service report"&&t.jsx(a,{sx:r,children:"Action"}),"          "]})}),t.jsx(Ce,{children:q.slice(Y*C,Y*C+C).map((e,l)=>{var s,c,o,d,i,u;return t.jsxs(J,{children:[t.jsx(a,{children:e==null?void 0:e.service_record_id}),t.jsx(a,{children:e==null?void 0:e.vehicle}),t.jsx(a,{children:(s=e==null?void 0:e.vehicle_group)==null?void 0:s.group_name}),t.jsx(a,{children:e==null?void 0:e.model}),t.jsx(a,{children:e==null?void 0:e.sub_model}),t.jsx(a,{children:e==null?void 0:e.priority_class}),t.jsx(a,{children:_(new Date(e==null?void 0:e.created)).format("DD-MM-YYYY")}),t.jsx(a,{children:_(new Date(e==null?void 0:e.created)).format("HH:mm A")}),t.jsx(a,{children:e!=null&&e.completion_date?_.utc(e==null?void 0:e.completion_date).local().format("YYYY-MM-DD"):"N/A"}),t.jsx(a,{children:e!=null&&e.next_due_date?_.utc(e==null?void 0:e.next_due_date).local().format("YYYY-MM-DD"):"N/A"}),t.jsx(a,{children:(c=e==null?void 0:e.segment)==null?void 0:c.segment_name}),t.jsx(a,{children:((d=(o=e==null?void 0:e.user)==null?void 0:o.us_user)==null?void 0:d.first_name)+" "+((u=(i=e==null?void 0:e.user)==null?void 0:i.us_user)==null?void 0:u.last_name)}),t.jsx(a,{children:e==null?void 0:e.status}),x!=="service report"&&t.jsx(a,{children:t.jsx(Z,{onClick:()=>H(e),color:"primary",disabled:(e==null?void 0:e.status.toLowerCase())==="completed","aria-label":"edit record",children:t.jsx(A,{})})})]},e==null?void 0:e.id)})})]}),t.jsx(Se,{rowsPerPageOptions:[12],component:"div",count:q.length,rowsPerPage:C,page:Y,onPageChange:ie,onRowsPerPageChange:ne})]}),t.jsx(Ye,{open:B,setOpen:L,data:K,isInspection:D})]})]})}export{ze as S};
