import{j as s,G as O,y as H,z as S,b as d,I as Z,aC as J,ba as K,bb as Q,b9 as X,C as P,ae as w,aZ as ee,bv as se,P as ae}from"./index-D4-FuxL_.js";import{D as te,a as ne,b as oe,c as re}from"./DialogTitle-DW9912Qa.js";import{D as le,E as ie,T as M}from"./Edit-zQELKB12.js";import{B as V}from"./CircularProgress-bD_8UAdi.js";import{T as ce,a as de,b as ue,c as F,d as l,e as he}from"./TableRow-Dm9G-T2W.js";import{T as pe}from"./TablePagination-D1WiZ89g.js";const be=({open:o,onClose:n,onConfirm:i})=>s.jsxs(te,{open:o,onClose:n,children:[s.jsx(ne,{children:"Confirm Deletion"}),s.jsx(oe,{children:s.jsxs(le,{children:["Are you sure you want to delete this vehicle data?"," ",s.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),s.jsxs(re,{children:[s.jsx(O,{onClick:n,color:"primary",children:"Cancel"}),s.jsx(O,{onClick:i,color:"secondary",children:"Delete"})]})]}),xe="https://cc.wikitrak.in/api-proxy/api/v1",ge={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},fe=({inspectionData:o,status:n})=>{const i=H(),{isUpdateInspection:k}=S(r=>r.inspection),[b,x]=d.useState(!1),u=()=>{const r=localStorage.getItem("role");J.includes(r)?(i(K(!k)),i(Q(o)),i(X(o))):P.error(`Sorry! Your role is ${r}. You're not allowed to add, edit or delete the vehicle`)},y=async()=>{console.log("Vehicle data deleting");try{await w.delete(`${xe}/vehicles/delete/${vehicleData.id}/`),P.success("Vehicle data deleted successfully!"),i(ee())}catch(r){console.error("Error deleting vehicle data:",r),P.error("Failed to delete vehicle data. Please try again.")}x(!1)},h=()=>{x(!1)};return s.jsxs(V,{sx:ge,children:[s.jsx(Z,{onClick:u,color:"primary","aria-label":"edit record",disabled:(n==null?void 0:n.toLowerCase())==="rejected"||(n==null?void 0:n.toLowerCase())==="close",children:s.jsx(ie,{})}),s.jsx(be,{open:b,onClose:h,onConfirm:y})]})},je=[{id:"BDID",label:"BDID"},{id:"Vehicle",label:"Vehicle"},{id:"User",label:"User"},{id:"SubmissionDate",label:"Submission Date"},{id:"WorkshopGroup",label:"Workshop Group"},{id:"Status",label:"Status"}],Ce=({where:o})=>{S(e=>e.breakdown);const n=H(),{searchTerm:i,inspectionHistory:k}=S(e=>e.inspection),[b,x]=d.useState("asc"),[u,y]=d.useState("BDID"),[h,r]=d.useState(0),[g,G]=d.useState(7),[W,De]=d.useState({id:"",status:"",workshop:"",user:""});d.useEffect(()=>{n(se({}))},[]);const q=e=>{x(u===e&&b==="asc"?"desc":"asc"),y(e)},z=(e,t)=>{r(t)},N=e=>{G(parseInt(e.target.value,10)),r(0)},v=((e,t,p)=>e.filter(a=>{var L,I,B,A,E,R,U,$,m;const c=p.toLowerCase(),f=(I=(L=a==null?void 0:a.breakdown)==null?void 0:L.breakdown_id)==null?void 0:I.toLowerCase().includes(c),j=`${(A=(B=a==null?void 0:a.submitted_by)==null?void 0:B.us_user)==null?void 0:A.first_name} ${(R=(E=a==null?void 0:a.submitted_by)==null?void 0:E.us_user)==null?void 0:R.last_name}`.toLowerCase().includes(c),C=(U=a==null?void 0:a.status)==null?void 0:U.toLowerCase().includes(c),D=($=a==null?void 0:a.workshop_group)==null?void 0:$.group_name.toLowerCase().includes(c),_=(m=a==null?void 0:a.vehicle.registration_id)==null?void 0:m.toLowerCase().includes(c);return!(p&&!(f||j||C||D||_)||t.id&&!a.breakdown_id.includes(t.id)||t.status&&a.status!==t.status||t.workshop&&a.workshop_group.group_name!==t.workshop||t.user&&!a.user.us_user.first_name.toLowerCase().includes(t.user.toLowerCase())&&!a.user.us_user.last_name.toLowerCase().includes(t.user.toLowerCase()))}))(k.slice(),W,i),Y=v.slice(h*g,h*g+g),T={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};return s.jsx(V,{sx:{m:o!=="inspection report"&&"10px",width:o==="inspection report"?"60%":"99%"},children:s.jsxs(ae,{children:[s.jsx(ce,{sx:{height:o==="inspection report"?"50vh":"65vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(de,{stickyHeader:!0,children:[s.jsx(ue,{children:s.jsxs(F,{children:[je.map(e=>s.jsx(l,{sx:T,children:s.jsx(M,{active:u===e.id,direction:u===e.id?b:"asc",onClick:()=>q(e.id),children:e.label})},e.id)),o!=="inspection report"&&s.jsx(l,{sx:T,children:s.jsx(M,{children:"Actions"})})]})}),s.jsx(he,{children:Y.map((e,t)=>{var p,a,c,f,j,C,D,_;return s.jsxs(F,{children:[s.jsx(l,{children:((p=e==null?void 0:e.breakdown)==null?void 0:p.breakdown_id)||"N/A"}),s.jsx(l,{children:(a=e==null?void 0:e.vehicle)==null?void 0:a.registration_id}),s.jsx(l,{children:`${(f=(c=e==null?void 0:e.submitted_by)==null?void 0:c.us_user)==null?void 0:f.first_name} ${(C=(j=e==null?void 0:e.submitted_by)==null?void 0:j.us_user)==null?void 0:C.last_name}`}),s.jsx(l,{children:((D=e==null?void 0:e.breakdown)==null?void 0:D.submission_date)||"N/A"}),s.jsx(l,{children:(_=e==null?void 0:e.workshop_group)==null?void 0:_.group_name}),s.jsx(l,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),o!=="inspection report"&&s.jsx(l,{children:s.jsx(fe,{inspectionData:e,status:e==null?void 0:e.status})})]},t)})})]})}),s.jsx(pe,{component:"div",count:v.length,page:h,onPageChange:z,rowsPerPage:g,onRowsPerPageChange:N,rowsPerPageOptions:[5,10,15]})]})})},Le=Ce;export{Le as I};
