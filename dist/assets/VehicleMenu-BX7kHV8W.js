import{y as A,j as e,a5 as y,Q as S,b,a6 as H,z as L,G as O,C as v,E as g,T as K,J as X,B as ee,a4 as te,aA as le,a8 as R}from"./index-DJH5ZoJP.js";import{S as se,R as re,t as ae}from"./SearchTab-DzsK0hG9.js";import{F as E,a as ne}from"./menu2-B_rcDMKB.js";import{S as oe,M as p,T as ie}from"./TextField-V0V83BM3.js";import{A as ce}from"./Autocomplete-C3FCsgl3.js";import{B as j,C as de}from"./CircularProgress-BpgrT3bl.js";function he({options:r,setOptions:o}){const i=A(),x=u=>{i(y(5.8)),i(S({})),o(u.target.value)};return e.jsx("div",{children:e.jsxs(E,{variant:"standard",sx:{m:0,minWidth:240,ml:2.85,mb:1},children:[e.jsx(ne,{id:"demo-simple-select-standard-label",children:"Vehicle State Options"}),e.jsxs(oe,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",value:r,onChange:x,label:"state-options",children:[e.jsx(p,{value:"",children:e.jsx("em",{children:"None"})}),e.jsx(p,{value:"offline",children:"Offline Vehicles"}),e.jsx(p,{value:"online",children:"Online Vehicles"}),e.jsx(p,{value:"running",children:"Running Vehicles"}),e.jsx(p,{value:"idling",children:"Idling Vehicles"})]})]})})}let ge="https://cc.wikitrak.in/api-proxy/api/v1";function xe({state:r,setState:o}){const[i,x]=b.useState([]);b.useEffect(()=>{(async()=>{try{let{data:s}=await H.get(`${ge}/workshop/state/?country=1`);x((s==null?void 0:s.results)||[])}catch(s){console.error("Error while getting state data:",s)}})()},[]);const u=(l,s)=>{o((s==null?void 0:s.name)||""),console.log("Selected option:",s)};return e.jsx("div",{children:e.jsx(E,{variant:"standard",sx:{m:0,minWidth:240,ml:2.85,mb:1},children:e.jsx(ce,{options:i,getOptionLabel:l=>(l==null?void 0:l.name)||"",value:i.find(l=>(l==null?void 0:l.name)===r)||null,onChange:u,isOptionEqualToValue:(l,s)=>(l==null?void 0:l.name)===(s==null?void 0:s.name),renderInput:l=>e.jsx(ie,{...l,label:"State filter options",variant:"standard"})})})})}const ve=({vehicleData:r,title:o,setParameterData:i,loadingVehicle:x,setSearchedTerm:u,setOptions:l,setState:s,setRegion:I,searchTerm:M,region:C,state:B,options:F})=>{const{selectedVehicle:c,locationData:d,loading:W,onlineVehicle:ue}=L(t=>t.liveMap),{mode:N,showVehicles:P}=L(t=>t.dashboard),f=ae(N),m=b.useRef(null),_=b.useRef(0);let n=A();b.useEffect(()=>{m.current&&setTimeout(()=>{m.current.scrollTop=_.current},0)});const $=async t=>{var w,V;if(m.current&&(_.current=m.current.scrollTop),X(!P),(d==null?void 0:d.length)<=0)return v.error("Data not available for this vehicle",{id:"clipboard"});const a=d==null?void 0:d.filter(h=>h.latestDocument.imei===t.value);if(console.log("selected vehicle",a),(a==null?void 0:a.length)<=0)return v.error("Data not available for this vehicle",{id:"clipboard"});const{lat:J,lng:Q}=((w=a==null?void 0:a[0])==null?void 0:w.latestDocument)??{},U={lat:J||R.lat,lng:Q||R.lat};n(ee(U)),n(y(15)),n(S({imei:t.value,reg_id:t.label})),n(te(t.value));const Y=t.label,Z=await n(le({w_registration_id:Y})),k=[];let D=0;(V=Z.payload)==null||V.map(h=>{h[h.parameter_type.toLowerCase()+"_parameter"].forEach(T=>{k.push({reg_id:t.label,imei:t.value,id:T.id,_id:h.id,key:D++,label:h.parameter_type==="Telematic"&&T.short_name})})}),o==="Live Map"&&i(k)},q=()=>{n(y(5.8)),n(S({}))},z=t=>{I(t)},G={backgroundColor:f.grey[100],position:"relative",width:"100%",float:"right",height:"90vh",overflowY:"auto",scrollBehavior:"smooth",scrollbarWidth:"thin"};return e.jsx(e.Fragment,{children:e.jsx("div",{ref:m,style:G,children:W||x?e.jsx(j,{sx:{display:"flex",justifyContent:"center",height:"88vh",alignItems:"center"},children:e.jsx(de,{})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{searchTerm:M,setSearchedTerm:u}),e.jsx(re,{region:C,handleRegion:z}),e.jsx(he,{options:F,setOptions:l}),e.jsx(xe,{state:B,setState:s}),(o==="Live Map"||o==="Live Monitor")&&e.jsx(j,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsxs(O,{variant:"outlined",onClick:()=>{if(Object.keys(c).length>0)q();else return n(y(5.8)),v.success("Already Selected To View All Vehicle Location.",{id:"already selected"})},sx:{width:"90%",bgcolor:Object.keys(c).length===0?g.bgColor:"undefined",color:Object.keys(c).length===0?"white":f.grey[400],border:`1px solid ${g.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:g.bgShadow}},children:["All Vehicles: ",r==null?void 0:r.length]})}),r.length>0?r.map((t,a)=>e.jsx(j,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(O,{disabled:t.label===c.reg_id,variant:"outlined",onClick:()=>{$(t)},sx:{width:"90%",bgcolor:t.label===c.reg_id?g.bgColor:"undefined",color:t.label===c.reg_id?"white":f.grey[400],border:`1px solid ${g.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:g.bgShadow}},children:t.label})},a)):e.jsx(j,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh"},children:e.jsxs(K,{sx:{textAlign:"center",color:f.grey[400]},children:["Sorry! No vehicles in"," ",e.jsx("span",{style:{fontWeight:"bold"},children:C})," region"]})})]})})})};export{ve as V};
