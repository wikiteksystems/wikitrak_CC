import{k,r as t,i as Y,j as r,B as _,w as b,t as a,T as q,l as z,v as G,m as T,n as H,X as V}from"./index-qR5_4q7m.js";import{S as J,R as K,t as Q}from"./LeftSideBar2-BwuQdGYp.js";import{B as u,C as U}from"./menu2-o2S8OUTn.js";const oe=({vehicleData:x,title:f,setParameterData:R,loadingVehicle:L})=>{const{selectedVehicle:n,locationData:l,loading:p}=k(e=>e.liveMap),{mode:A,showVehicles:B}=k(e=>e.dashboard),c=Q(A),[y,E]=t.useState(""),[d,M]=t.useState(""),i=t.useRef(null),j=t.useRef(0);let h=Y();t.useEffect(()=>{console.log("loading",p)},[p]),t.useEffect(()=>{i.current&&setTimeout(()=>{i.current.scrollTop=j.current},0)});const m=x.length>0&&x.filter(e=>{var o,g;return((o=e==null?void 0:e.label)==null?void 0:o.toLowerCase().includes(y.toLowerCase()))&&(d===""||((g=e==null?void 0:e.workShop)==null?void 0:g.region)===d)}),D=async e=>{var w,C;if(i.current&&(j.current=i.current.scrollTop),z(!B),(l==null?void 0:l.length)<=0)return b.error("Data not available for this vehicle",{id:"clipboard"});const o=l==null?void 0:l.filter(s=>s.latestDocument.imei===e.value);if((o==null?void 0:o.length)<=0)return b.error("Data not available for this vehicle",{id:"clipboard"});const{lat:g,lng:I}=((w=o==null?void 0:o[0])==null?void 0:w.latestDocument)??{},N={lat:g||V.lat,lng:I||V.lat};h(G(N)),h(T({imei:e.value,reg_id:e.label}));const W=e.label,$=await h(H({w_registration_id:W})),v=[];let X=0;(C=$.payload)==null||C.map(s=>{s[s.parameter_type.toLowerCase()+"_parameter"].forEach(S=>{v.push({reg_id:e.label,imei:e.value,id:S.id,_id:s.id,key:X++,label:s.parameter_type==="Telematic"&&S.short_name})})}),f==="Live Map"&&R(v)},O=()=>{h(T({}))},P=e=>{M(e)},F={backgroundColor:c.grey[100],position:"relative",width:"100%",float:"right",height:"90vh",overflowY:"auto",scrollBehavior:"smooth",scrollbarWidth:"thin"};return r.jsx(r.Fragment,{children:r.jsx("div",{ref:i,style:F,children:p||L?r.jsx(u,{sx:{display:"flex",justifyContent:"center",height:"88vh",alignItems:"center"},children:r.jsx(U,{})}):r.jsxs(r.Fragment,{children:[r.jsx(J,{searchTerm:y,setSearchedTerm:E}),r.jsx(K,{region:d,handleRegion:P}),f==="Live Map"&&r.jsx(u,{sx:{align:"center",my:"8px",ml:"20px"},children:r.jsx(_,{variant:"outlined",onClick:()=>{if(Object.keys(n).length>0)O();else return b.success("Already Selected To View All Vehicle Location.",{id:"already selected"})},sx:{width:"90%",bgcolor:Object.keys(n).length===0?a.bgColor:"undefined",color:Object.keys(n).length===0?"white":c.grey[400],border:`1px solid ${a.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:a.bgShadow}},children:"All Vehicles"})}),m.length>0?m.map((e,o)=>r.jsx(u,{sx:{align:"center",my:"8px",ml:"20px"},children:r.jsx(_,{variant:"outlined",onClick:()=>{D(e)},sx:{width:"90%",bgcolor:e.label===n.reg_id?a.bgColor:"undefined",color:e.label===n.reg_id?"white":c.grey[400],border:`1px solid ${a.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:a.bgShadow}},children:e.label})},o)):r.jsx(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh"},children:r.jsxs(q,{sx:{textAlign:"center",color:c.grey[400]},children:["Sorry! No vehicles in"," ",r.jsx("span",{style:{fontWeight:"bold"},children:d})," region"]})})]})})})};export{oe as V};
