import{l as Ie,o as Me,p as Ye,b as v,q as ke,f as He,_ as Ne,j as e,eB as We,g as $e,k as Be,a$ as W,a_ as w,bb as xe,dT as le,cf as se,dU as ne,dV as ie,dW as J,dX as a,dY as re,eh as Le,bm as P,aW as M,bl as Re,ca as Ee,b8 as ae,eC as ge,eD as ue,eE as k,bc as pe,bY as fe,eF as je,eG as me,bv as Pe,b7 as te,eH as Ge,eI as Ke,eJ as Fe,c4 as Ue,eK as Ve,eL as ze,eM as qe,eN as ce,eO as de,eP as he,eQ as Je,bw as Qe,bx as Xe,by as Ze,bA as we,bC as et,bq as tt,br as at,bs as lt,eR as st,b5 as nt}from"./index-CF1xTaPb.js";import{D as ve,R as it,a as rt}from"./BatchRecipt2-BxjaceqU.js";import"./index.esm-Ck-brZWO.js";function ct(C){return Ie("MuiTableFooter",C)}Me("MuiTableFooter",["root"]);const dt=["className","component"],ht=C=>{const{classes:L}=C;return Be({root:["root"]},ct,L)},ot=Ye("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(C,L)=>L.root})({display:"table-footer-group"}),xt={variant:"footer"},Oe="tfoot",gt=v.forwardRef(function(L,T){const R=ke({props:L,name:"MuiTableFooter"}),{className:x,component:A=Oe}=R,_=He(R,dt),t=Ne({},R,{component:A}),i=ht(t);return e.jsx(We.Provider,{value:xt,children:e.jsx(ot,Ne({as:A,className:$e(i.root,x),ref:T,role:A===Oe?null:"rowgroup",ownerState:t},_))})}),ut=gt;function pt({tableData:C}){const{vehicleList:L}=W(t=>t.liveMap),T=w(),R=xe();console.log("tableData: ",C);let x=t=>L.find(i=>{var l;return((l=i==null?void 0:i.imei[0])==null?void 0:l.mac_id)==t||""});const A=t=>{var i;T(Re({imei:t==null?void 0:t.imei,reg_id:(i=x(t.imei))==null?void 0:i.registration_id})),T(Ee({startDate:ae(t.date).startOf("day").toISOString(),endDate:ae(t.date).endOf("day").toISOString()})),R("/trip-monitor?source=TripDetail")},_=t=>{var i;T(Re({imei:t==null?void 0:t.imei,reg_id:(i=x(t.imei))==null?void 0:i.registration_id})),T(Ee({startDate:ae(t.date).startOf("day").toISOString(),endDate:ae(t.date).endOf("day").toISOString()})),R("/trip-report")};return e.jsx(le,{component:se,sx:{maxHeight:"70vh"},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(a,{align:"left",children:"Date"}),e.jsx(a,{align:"left",children:"Vehicle Name"}),e.jsx(a,{align:"left",children:"Start location"}),e.jsx(a,{align:"left",children:"End location"}),e.jsx(a,{align:"left",children:"Segment"}),e.jsx(a,{align:"left",children:"Operator"}),e.jsx(a,{align:"left",children:"Work done (acre)"}),e.jsx(a,{align:"left",children:"Total Trips Hours"}),e.jsx(a,{align:"left",children:"Running Time"}),e.jsx(a,{align:"left",children:"Idle time"}),e.jsx(a,{align:"left",children:"Total Distance (km)"}),e.jsx(a,{align:"left",children:"Average Speed"}),e.jsx(a,{align:"left",children:"Total Engine Hours"}),e.jsx(a,{align:"left",children:"Last Reset Engine Hours"}),e.jsx(a,{align:"left",children:"Last Reset Timestamp"}),e.jsx(a,{align:"left",children:"Duration Since Last Reset"}),e.jsx(a,{align:"left",children:"Reset Perform By"}),e.jsx(a,{align:"left",children:"View Trips"}),e.jsx(a,{align:"left",children:"View Trip Report"})]})}),e.jsx(re,{children:C.map((t,i)=>{var l,r,n,u,S,j,D,E,Y,z;return e.jsxs(J,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",children:t.date}),e.jsx(a,{align:"left",children:(l=x(t.imei))==null?void 0:l.registration_id}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Le,{title:((r=t==null?void 0:t.startLocationName)==null?void 0:r.display_name)||(t==null?void 0:t.startLocationName)||"",children:e.jsx("span",{children:((n=t==null?void 0:t.startLocationName)==null?void 0:n.display_name)||(t==null?void 0:t.startLocationName)||""})})}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Le,{title:((u=t==null?void 0:t.endLocationName)==null?void 0:u.display_name)||(t==null?void 0:t.endLocationName)||"",children:e.jsx("span",{children:((S=t==null?void 0:t.endLocationName)==null?void 0:S.display_name)||(t==null?void 0:t.endLocationName)||""})})}),e.jsx(a,{align:"left",children:(j=x(t.imei))==null?void 0:j.segment}),e.jsx(a,{align:"left",children:(D=x(t.imei))==null?void 0:D.customer_name}),e.jsx(a,{align:"left",children:t.acreageStr}),e.jsx(a,{align:"left",children:(t==null?void 0:t.tripHours)||"--"}),e.jsx(a,{align:"left",children:t.runningTime}),e.jsx(a,{align:"left",children:t.idleTime}),e.jsx(a,{align:"left",children:t.totalDistance}),e.jsx(a,{align:"left",children:t.averageSpeed}),e.jsx(a,{align:"left",children:t==null?void 0:t.cumulativeEngineHoursReadable}),e.jsx(a,{align:"left",children:Number(((E=x(t.imei))==null?void 0:E.old_total_engine_hours)??0).toFixed(2)}),e.jsx(a,{align:"left",children:(()=>{const b=x(t.imei);return b!=null&&b.updated_engine_hours_date?P(b.updated_engine_hours_date).format("DD-MM-YYYY"):"--"})()}),e.jsx(a,{align:"left",children:(()=>{const b=x(t.imei),V=b==null?void 0:b.updated_engine_hours_date;if(!V)return"--";const I=P(),B=P.utc(V).local(),m=P.duration(I.diff(B)),g=Math.floor(m.asDays()),F=m.hours(),G=m.minutes();return`${g}d ${F}h ${G}m`})()}),e.jsx(a,{align:"left",children:((z=(Y=x(t.imei))==null?void 0:Y.reset_by_user)==null?void 0:z.email)||"--"}),e.jsx(a,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>A(t),children:"View on Map ðŸ”"})}),e.jsx(a,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer"},onClick:()=>_(t),children:"View Trip Report"})})]},i+1)})})]})})}function ft({handleBack:C,setStartDate:L,startDate:T,setEndDate:R,endDate:x}){const A=w(),{vehicleGroup:_,vehicleList:t}=W(m=>m.liveMap),{vehicleStatesData:i,loading:l,selectedGroup:r,selectedVehicle:n,distributorList:u}=W(m=>m.report),[S,j]=v.useState([]);v.useState([]);const[D,E]=v.useState([]);v.useEffect(()=>{},[l]),v.useEffect(()=>{if(_&&_.length>0){let m=_.map(g=>({...g,label:g.group_name,value:g.id}));j(m)}},[_,t,u]),v.useEffect(()=>{},[T,x]);let Y=m=>t.find(g=>{var F;return((F=g==null?void 0:g.imei[0])==null?void 0:F.mac_id)==m||""});v.useEffect(()=>{let m=(i==null?void 0:i.data)&&i.data.map(g=>{var $,c;let{customer_name:F,registration_id:G,segment:K,total_engine_hours:Q,old_total_engine_hours:p,updated_engine_hours_date:d,reset_by_user:y}=Y(g==null?void 0:g.imei);return{Date:g.date,vehicle:G,"Start Location":($=g==null?void 0:g.startLocationName)==null?void 0:$.display_name,"End Location":(c=g==null?void 0:g.endLocationName)==null?void 0:c.display_name,operator:F,segment:K,"Work Done":g==null?void 0:g.acreageStr,"Running Time":g.runningTime,"Idle Time":g.idleTime,"Engine hours":g.engineHours,"Total Distance (km)":g.totalDistance,"Average Speed":g.averageSpeed,"Total Engine Hours":Q,"Last Reset Engine Hours":p,"Last Reset Timestamp":d,"Reset Perform By":(y==null?void 0:y.email)||"--"}});E(m)},[i]),v.useEffect(()=>{n||A(ge())},[]);function z(m){console.log("value changed",m),A(je(m))}function b(m){A(me(m))}const V=async()=>{const m=`${T} 00:00`,g=`${x} 23:59`;if(!I())return;A(Pe({imei:n,startTime:m,endTime:g}))},I=()=>!T||!x||n==="all"?(te.error("Please select start date, end date, and vehicle."),!1):!0,B=r==="All"?t:t.filter(m=>m.vehicle_group===r);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(ue,{handleBack:C,downloadData:D})}),e.jsxs(M,{children:[e.jsxs(k,{size:"large",value:r,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:z,filterOption:(m,g)=>{var F;return typeof((F=g==null?void 0:g.props)==null?void 0:F.children)=="string"&&g.props.children.toLowerCase().indexOf(m.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"All",children:"All"}),S.map((m,g)=>e.jsx(k.Option,{value:m.value,children:m.label},g))]}),e.jsxs(k,{size:"large",value:n,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:b,filterOption:(m,g)=>{var F;return typeof((F=g==null?void 0:g.props)==null?void 0:F.children)=="string"&&g.props.children.toLowerCase().indexOf(m.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"all",children:"None"},"all"),B&&B.length>0&&B.map((m,g)=>{var F;return e.jsx(k.Option,{value:(F=m.imei[0])==null?void 0:F.mac_id,children:m.registration_id},g)})]}),e.jsx(ve,{setStartDate:L,setEndDate:R,selectedDate:!1,startDate:T,endDate:x}),e.jsx(pe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:V,disabled:!n,children:"Generate report"})]}),l&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(fe,{})}),(i==null?void 0:i.data)&&(i==null?void 0:i.data.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(pt,{tableData:(i==null?void 0:i.data)||[]})})]})}function jt({tableData:C}){const{vehicleList:L}=W(l=>l.liveMap);w(),xe();const[T,R]=v.useState(null),[x,A]=v.useState(!1);let _=l=>L.find(r=>{var n;return((n=r==null?void 0:r.imei[0])==null?void 0:n.mac_id)==l||""});const t=(l,r)=>r.find(u=>{var S;return((S=u==null?void 0:u.name)==null?void 0:S.toLowerCase().trim())===l})||null,i={fontSize:"12px",fontWeight:"bold"};return e.jsxs(e.Fragment,{children:[e.jsx(le,{component:se,sx:{maxHeight:"70vh"},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(a,{align:"left",sx:i,children:"Date"}),e.jsx(a,{align:"left",sx:i,children:"Vehicle Name"}),e.jsx(a,{align:"left",sx:i,children:"Batch No"}),e.jsx(a,{align:"left",sx:i,children:"Start Time"}),e.jsx(a,{align:"left",sx:i,children:"End Time"}),e.jsx(a,{align:"left",sx:i,children:"Total Target Weight"}),e.jsx(a,{align:"left",sx:i,children:"Total Achieved Weight"}),e.jsx(a,{align:"left",sx:i,children:"Recipe 1"}),e.jsx(a,{align:"left",sx:i,children:"Cement"}),e.jsx(a,{align:"left",sx:i,children:"10mm"}),e.jsx(a,{align:"left",sx:i,children:"20mm"}),e.jsx(a,{align:"left",sx:i,children:"Sand"}),e.jsx(a,{align:"left",sx:i,children:"Crush Sand"}),e.jsx(a,{align:"left",sx:i,children:"River Sand"}),e.jsx(a,{align:"left",sx:i,children:"Fly Ash"}),e.jsx(a,{align:"left",sx:i,children:"30mm"}),e.jsx(a,{align:"left",sx:i,children:"Water"}),e.jsx(a,{align:"left",sx:i,children:"Admix"}),e.jsx(a,{align:"left",sx:i,children:"Receipt"})]})}),e.jsx(re,{children:C.map((l,r)=>{var n,u,S,j,D,E,Y,z,b,V,I,B,m,g,F,G,K,Q,p,d,y,$,c,h,f,o,H,s,O,N,ee,X,U,q,Z,be,ye,Se,Te,Ae,_e,Ce,De;return e.jsxs(J,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(l==null?void 0:l.date)&&P(l==null?void 0:l.date,"DDMMYYYY").format("DD-MM-YYYY")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(n=_(l.imei))==null?void 0:n.registration_id}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l.batch_no}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l.start_time}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.end_time}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(u=l==null?void 0:l.total_target)==null?void 0:u.replace(/^0+/,"")}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(S=l==null?void 0:l.totalAcheived)==null?void 0:S.replace(/^0+/,"")}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.mix_name}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(D=(j=t("cement",l.materials||[]))==null?void 0:j.target)==null?void 0:D.replace(/^0+/,""),":",(Y=(E=t("cement",l.materials||[]))==null?void 0:E.actual)==null?void 0:Y.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(b=(z=t("10 mm",l.materials||[]))==null?void 0:z.target)==null?void 0:b.replace(/^0+/,""),":",(I=(V=t("10 mm",l.materials||[]))==null?void 0:V.actual)==null?void 0:I.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(m=(B=t("20 mm",l.materials||[]))==null?void 0:B.target)==null?void 0:m.replace(/^0+/,""),":",(F=(g=t("20 mm",l.materials||[]))==null?void 0:g.actual)==null?void 0:F.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(K=(G=t("sand",l.materials||[]))==null?void 0:G.target)==null?void 0:K.replace(/^0+/,""),":",(p=(Q=t("sand",l.materials||[]))==null?void 0:Q.actual)==null?void 0:p.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(y=(d=t("crush sand",l.materials||[]))==null?void 0:d.target)==null?void 0:y.replace(/^0+/,""),":",(c=($=t("crush sand",l.materials||[]))==null?void 0:$.actual)==null?void 0:c.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(f=(h=t("river sand",l.materials||[]))==null?void 0:h.target)==null?void 0:f.replace(/^0+/,""),":",(H=(o=t("river sand",l.materials||[]))==null?void 0:o.actual)==null?void 0:H.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(O=(s=t("fly ash",l.materials||[]))==null?void 0:s.target)==null?void 0:O.replace(/^0+/,""),":",(ee=(N=t("fly ash",l.materials||[]))==null?void 0:N.actual)==null?void 0:ee.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(U=(X=t("30 mm",l.materials||[]))==null?void 0:X.target)==null?void 0:U.replace(/^0+/,""),":",(Z=(q=t("30 mm",l.materials||[]))==null?void 0:q.actual)==null?void 0:Z.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(ye=(be=t("water",l.materials||[]))==null?void 0:be.target)==null?void 0:ye.replace(/^0+/,""),":",(Te=(Se=t("water",l.materials||[]))==null?void 0:Se.actual)==null?void 0:Te.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(_e=(Ae=t("admix",l.materials||[]))==null?void 0:Ae.target)==null?void 0:_e.replace(/^0+/,""),":",(De=(Ce=t("admix",l.materials||[]))==null?void 0:Ce.actual)==null?void 0:De.replace(/^0+/,"")]}),e.jsx(a,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",l),R(l),A(!0)},children:"View Receipt"})]},r+1)})}),e.jsx(ut,{children:e.jsxs(J,{children:[e.jsx(a,{children:e.jsx("b",{children:"Total"})}),e.jsx(a,{colSpan:3}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"}}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:C.reduce((r,n)=>{const u=(n==null?void 0:n.total_target)||"0",S=String(u).replace(/^0+/,""),j=parseFloat(S)||0;return r+j},0).toFixed(2)}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:C.reduce((l,r)=>l+(r!=null&&r.totalAcheived&&parseFloat(r.totalAcheived.replace(/^0+/,""))||0),0)}),e.jsx(a,{}),["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"].map(l=>{const r=C.reduce((u,S)=>{var D;const j=(D=t(l,S.materials||[]))==null?void 0:D.target;return u+(j&&parseFloat(j.replace(/^0+/,""))||0)},0),n=C.reduce((u,S)=>{var D;const j=(D=t(l,S.materials||[]))==null?void 0:D.actual;return u+(j&&parseFloat(j.replace(/^0+/,""))||0)},0);return e.jsxs(a,{align:"left",sx:{fontSize:"10px",fontWeight:"bold"},children:[r,":",n]},l)}),e.jsx(a,{})]})})]})}),e.jsx(it,{receiptData:T,open:x,setOpen:A})]})}function mt({tableData:C}){const{vehicleList:L}=W(n=>n.liveMap);w(),xe();const[T,R]=v.useState(null),[x,A]=v.useState(!1);let _=n=>L.find(u=>{var S;return((S=u==null?void 0:u.imei[0])==null?void 0:S.mac_id)==n})||{};const t=(n,u)=>u.find(S=>{var j;return((j=S==null?void 0:S.product)==null?void 0:j.toLowerCase())===n.toLowerCase()})||{},i={fontSize:"12px",fontWeight:"bold"},l={fontSize:"10px"};let r={totalTarget:0,totalAchieved:0,cement:{target:0,achieved:0},mm10:{target:0,achieved:0},mm20:{target:0,achieved:0},sand:{target:0,achieved:0},water:0,cubic:0,mm30:{target:0,achieved:0},crushSand:{target:0,achieved:0},riverSand:{target:0,achieved:0},flyAsh:{target:0,achieved:0},admix:{target:0,achieved:0}};return C.forEach(n=>{r.totalTarget+=Number((n==null?void 0:n.generalKeyInfo["Total Target"])||0),r.totalAchieved+=Number((n==null?void 0:n.generalKeyInfo["Total Achieved"])||0),r.water+=Number((n==null?void 0:n.generalKeyInfo.Water)||0),r.cubic+=Number((n==null?void 0:n.generalKeyInfo["Cubic Meter"])||0),r.cement.target+=Number(t("cement",n.productArr).target||0),r.cement.achieved+=Number(t("cement",n.productArr).achieved||0),r.mm10.target+=Number(t("10 mm agg",n.productArr).target||0),r.mm10.achieved+=Number(t("10 mm agg",n.productArr).achieved||0),r.mm20.target+=Number(t("20 mm agg",n.productArr).target||0),r.mm20.achieved+=Number(t("20 mm agg",n.productArr).achieved||0),r.sand.target+=Number(t("sand",n.productArr).target||0),r.sand.achieved+=Number(t("sand",n.productArr).achieved||0),r.mm30.target+=Number(t("30mm",n.productArr).target||0),r.mm30.achieved+=Number(t("30mm",n.productArr).achieved||0),r.crushSand.target+=Number(t("crush sand",n.productArr).target||0),r.crushSand.achieved+=Number(t("crush sand",n.productArr).achieved||0),r.riverSand.target+=Number(t("river sand",n.productArr).target||0),r.riverSand.achieved+=Number(t("river sand",n.productArr).achieved||0),r.flyAsh.target+=Number(t("fly ash",n.productArr).target||0),r.flyAsh.achieved+=Number(t("fly ash",n.productArr).achieved||0),r.admix.target+=Number(t("admix",n.productArr).target||0),r.admix.achieved+=Number(t("admix",n.productArr).achieved||0)}),e.jsxs(le,{component:se,sx:{maxHeight:"70vh"},children:[e.jsxs(ne,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(a,{sx:i,children:"Date"}),e.jsx(a,{sx:i,children:"Vehicle Name"}),e.jsx(a,{sx:i,children:"Batch No"}),e.jsx(a,{sx:i,children:"Start Time"}),e.jsx(a,{sx:i,children:"End Time"}),e.jsx(a,{sx:i,children:"Total Target Weight"}),e.jsx(a,{sx:i,children:"Total Achieved Weight"}),e.jsx(a,{sx:i,children:"Recipe 1"}),e.jsx(a,{sx:i,children:"Cycle"}),e.jsx(a,{sx:i,children:"Cement"}),e.jsx(a,{sx:i,children:"10mm"}),e.jsx(a,{sx:i,children:"20mm"}),e.jsx(a,{sx:i,children:"Sand"}),e.jsx(a,{sx:i,children:"Water"}),e.jsx(a,{sx:i,children:"Cubic Meter"}),e.jsx(a,{sx:i,children:"30mm"}),e.jsx(a,{sx:i,children:"Crush Sand"}),e.jsx(a,{sx:i,children:"River Sand"}),e.jsx(a,{sx:i,children:"Fly Ash"}),e.jsx(a,{sx:i,children:"Admix"}),e.jsx(a,{sx:i,children:"Receipt"})]})}),e.jsxs(re,{children:[C.map((n,u)=>{var S;return e.jsxs(J,{children:[e.jsx(a,{sx:l,children:n.generalKeyInfo.Date}),e.jsx(a,{sx:l,children:((S=_(n.imei))==null?void 0:S.registration_id)||"-"}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Batch No"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Start Time"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["End Time"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Total Target"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Total Achieved"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Recipe Name"]}),e.jsx(a,{sx:l,children:n.generalKeyInfo.Cycle}),e.jsxs(a,{sx:l,children:[t("cement",n.productArr).target||0," :",t("cement",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("10 mm agg",n.productArr).target||0," :",t("10 mm agg",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("20 mm agg",n.productArr).target||0," :",t("20 mm agg",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("sand",n.productArr).target||0," :",t("sand",n.productArr).achieved||0]}),e.jsx(a,{sx:l,children:n.generalKeyInfo.Water}),e.jsx(a,{sx:l,children:n.generalKeyInfo["Cubic Meter"]}),e.jsxs(a,{sx:l,children:[t("30mm",n.productArr).target||0," :",t("30mm",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("crush sand",n.productArr).target||0," :",t("crush sand",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("river sand",n.productArr).target||0," :",t("river sand",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("fly ash",n.productArr).target||0," :",t("fly ash",n.productArr).achieved||0]}),e.jsxs(a,{sx:l,children:[t("admix",n.productArr).target||0," :",t("admix",n.productArr).achieved||0]}),e.jsx(a,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",n),R(n),A(!0)},children:"View Receipt"})]},u)}),e.jsxs(J,{children:[e.jsx(a,{sx:l,children:e.jsx("b",{children:"TOTAL"})}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{sx:l,children:e.jsx("b",{children:r.totalTarget})}),e.jsx(a,{sx:l,children:e.jsx("b",{children:r.totalAchieved})}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.cement.target,":",r.cement.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.mm10.target,":",r.mm10.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[" ",r.mm20.target,":",r.mm20.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.sand.target,":",r.sand.achieved]})}),e.jsx(a,{sx:l,children:e.jsx("b",{children:r.water})}),e.jsx(a,{sx:l,children:e.jsx("b",{children:r.cubic})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.mm30.target,":",r.mm30.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[" ",r.crushSand.target,":",r.crushSand.achieved]})}),e.jsxs(a,{sx:l,children:[r.riverSand.target,":",r.riverSand.achieved]}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.flyAsh.target,":",r.flyAsh.achieved]})}),e.jsx(a,{sx:l,children:e.jsxs("b",{children:[r.admix.target,":",r.admix.achieved]})})]})]})]}),e.jsx(rt,{receiptData:T,open:x,setOpen:A})]})}function vt({handleBack:C,setStartDate:L,startDate:T,setEndDate:R,endDate:x}){var $;const A=w(),{vehicleGroup:_,vehicleList:t}=W(c=>c.liveMap),{batchReportsData:i,batchReportsData2:l,loading:r,selectedGroup:n,selectedVehicle:u,distributorList:S}=W(c=>c.report),[j,D]=v.useState([]);v.useState([]);const[E,Y]=v.useState([]),[z,b]=v.useState([]);let V=c=>(console.log(t.find(h=>{var f;return((f=h==null?void 0:h.imei[0])==null?void 0:f.mac_id)==c||""})),t.find(h=>{var f;return((f=h==null?void 0:h.imei[0])==null?void 0:f.mac_id)==c||""}));const I=(c,h)=>h.find(o=>{var H;return((H=o==null?void 0:o.name)==null?void 0:H.toLowerCase().trim())===c})||null,B=(c,h)=>{if(!c||!c.length>0)return;const f=c.reduce((O,N)=>O+(N!=null&&N.total_target&&parseFloat(N.total_target.replace(/^0+/,""))||0),0),o=c.reduce((O,N)=>O+(N!=null&&N.totalAcheived&&parseFloat(N.totalAcheived.replace(/^0+/,""))||0),0),H=["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"],s={};return H.forEach(O=>{const N=c.reduce((X,U)=>{var Z;const q=(Z=h(O,U.materials||[]))==null?void 0:Z.target;return X+(q&&parseFloat(q.replace(/^0+/,""))||0)},0),ee=c.reduce((X,U)=>{var Z;const q=(Z=h(O,U.materials||[]))==null?void 0:Z.actual;return X+(q&&parseFloat(q.replace(/^0+/,""))||0)},0);s[O]=`${N}:${ee}`}),{"Total Target Weight":f,"Total Achieved Weight":o,...s}};v.useEffect(()=>{const c=s=>s&&String(s).replace(/^0+/,"")||"-",h=(s,O=[])=>{const N=I(s,O);return{target:c(N==null?void 0:N.target),actual:c(N==null?void 0:N.actual)}};let f=(i==null?void 0:i.map(s=>{const{customer_name:O="-",registration_id:N="-",segment:ee="-"}=V(s==null?void 0:s.imei)||{};return{Date:s!=null&&s.date&&P(s==null?void 0:s.date,"DDMMYYYY").isValid()?P(s==null?void 0:s.date,"DDMMYYYY").format("DD-MM-YYYY"):"-",Vehicle:N||"-","Batch No":(s==null?void 0:s.batch_no)||"-","Start Time":(s==null?void 0:s.start_time)||"-",EndTime:(s==null?void 0:s.end_time)||"-","Total Target Weight":c(s==null?void 0:s.total_target),"Total Achieved Weight":c(s==null?void 0:s.totalAcheived),"Recipe 1":(s==null?void 0:s.mix_name)||"-",Cement:`${h("cement",s==null?void 0:s.materials).target}:${h("cement",s==null?void 0:s.materials).actual}`,"10mm":`${h("10 mm",s==null?void 0:s.materials).target}:${h("10mm",s==null?void 0:s.materials).actual}`,"20mm":`${h("20 mm",s==null?void 0:s.materials).target}:${h("20mm",s==null?void 0:s.materials).actual}`,Sand:`${h("sand",s==null?void 0:s.materials).target}:${h("sand",s==null?void 0:s.materials).actual}`,"Crush Sand":`${h("crush sand",s==null?void 0:s.materials).target}:${h("crush sand",s==null?void 0:s.materials).actual}`,"River Sand":`${h("river sand",s==null?void 0:s.materials).target}:${h("river sand",s==null?void 0:s.materials).actual}`,"Fly Ash":`${h("fly ash",s==null?void 0:s.materials).target}:${h("fly ash",s==null?void 0:s.materials).actual}`,"30mm":`${h("30 mm",s==null?void 0:s.materials).target}:${h("30mm",s==null?void 0:s.materials).actual}`,Water:`${h("water",s==null?void 0:s.materials).target}:${h("water",s==null?void 0:s.materials).actual}`,Admix:`${h("admix",s==null?void 0:s.materials).target}:${h("admix",s==null?void 0:s.materials).actual}`}}))||[];const o=B(i,I),H=[...f,{Date:"",Vehicle:"-","Batch No":"-","Start Time":"-",EndTime:"Total","Total Target Weight":(o==null?void 0:o["Total Target Weight"])||0,"Total Achieved Weight":(o==null?void 0:o["Total Achieved Weight"])||0,"Recipe 1":"-",Cement:(o==null?void 0:o.cement)||"-","10mm":(o==null?void 0:o["10 mm"])||"-","20mm":(o==null?void 0:o["20 mm"])||"-",Sand:(o==null?void 0:o.sand)||"-","Crush Sand":(o==null?void 0:o["crush sand"])||"-","River Sand":(o==null?void 0:o["river sand"])||"-","Fly Ash":(o==null?void 0:o["fly ash"])||"-","30mm":(o==null?void 0:o["30 mm"])||"-",Water:(o==null?void 0:o.water)||"-",Admix:(o==null?void 0:o.admix)||"-"}];Y(H)},[i]);const m=c=>{if(!c&&!c.length>0)return;let h=[];for(let f=0;f<c.length;f++)if(c[f].startsWith("Product:")){const o=c[f],H=c[f+1]||"",s=o.match(/Product:\s*(.*?)\s*Target.*:\s*(\d+)/),O=H.match(/Achieved.*:\s*(\d+)/);s&&h.push({product:s[1],target:Number(s[2]),achieved:O?Number(O[1]):0})}return h},g=["Batch No","Date","Start Time","Operator","Recipe Name","Cubic Meter","Cycle","End Time","Total Target","Total Achieved","Water","Admix"],F=c=>{if(!c&&!c.length>0)return;let h={};return c.forEach(f=>{g.forEach(o=>{var H;if(f.includes(o)){const O=((H=f.split(/[:\-](.+)/)[1])==null?void 0:H.trim())||"";h[o]=O}})}),h};v.useEffect(()=>{if(console.log("bacth reports data11",l),l&&l.length>0){let c=l.map(h=>{let f=m((h==null?void 0:h.parts)||[]),o=F((h==null?void 0:h.parts)||[]);return{productArr:f,generalKeyInfo:o,imei:h==null?void 0:h.deviceId}});c&&c.length>0?b(c):b([]),console.log("formatted arr",c)}},[l]),v.useEffect(()=>{if(_&&_.length>0){let c=_.map(h=>({...h,label:h.group_name,value:h.id}));D(c)}},[_,t,S]),v.useEffect(()=>{u||A(ge())},[]);function G(c){console.log("value changed",c),A(je(c))}function K(c){console.log("value",c),A(me(c))}const Q=async()=>{const c=`${T} 00:00`,h=`${x} 23:59`;let f=V(u);if(console.log("vehicle info",f),!p())return;let o={imei:u,startDate:c,endDate:h};f.vehicle_type==="Sprint"&&A(Ge(o)),f.vehicle_type==="Appalto"&&A(Ke(o))},p=()=>!T||!x||u==="all"?(te.error("Please select start date, end date, and vehicle."),!1):!0,d=($=V(u))==null?void 0:$.vehicle_type;console.log("device type",d);const y=n==="All"?t:t.filter(c=>c.vehicle_group===n);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(ue,{handleBack:C,downloadData:E})}),e.jsxs(M,{children:[e.jsxs(k,{size:"large",value:n,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:G,filterOption:(c,h)=>{var f;return typeof((f=h==null?void 0:h.props)==null?void 0:f.children)=="string"&&h.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"All",children:"All"}),j.map((c,h)=>e.jsx(k.Option,{value:c.value,children:c.label},h))]}),e.jsxs(k,{size:"large",value:u,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:K,filterOption:(c,h)=>{var f;return typeof((f=h==null?void 0:h.props)==null?void 0:f.children)=="string"&&h.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"all",children:"None"},"all"),y&&y.length>0&&y.map((c,h)=>{var f;return e.jsx(k.Option,{value:(f=c.imei[0])==null?void 0:f.mac_id,children:c.registration_id},h)})]}),e.jsx(ve,{setStartDate:L,setEndDate:R,selectedDate:!1,startDate:T,endDate:x}),e.jsx(pe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:Q,disabled:!u,children:"Generate report"})]}),r&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(fe,{})}),d==="Sprint"&&(i==null?void 0:i.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(jt,{tableData:i})}),d==="Appalto"&&(z==null?void 0:z.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(mt,{tableData:z})})]})}function bt({tableData:C}){const{vehicleList:L}=W(t=>t.liveMap),{selectedVehicle:T}=W(t=>t.report);let R=t=>L.find(i=>{var l;return((l=i==null?void 0:i.imei[0])==null?void 0:l.mac_id)==t||""});v.useEffect(()=>{},[L]);const x={fontSize:"12px",fontWeight:"bold"};function A(t){return console.log("hex",t),t.match(/../g).reverse().join("")}const _=(t,i)=>{var u,S,j,D;console.log("pid",t);const l=i.find(E=>t===(E==null?void 0:E.pid));if(console.log("matched pid",l),!l)return"NA";const r=((D=(j=(S=(u=R(T))==null?void 0:u.sub_model)==null?void 0:S.model_modelecu)==null?void 0:j[0])==null?void 0:D.pgn)||[];console.log("j1939 parameter",r);const n=r.find(E=>{var Y,z;return(t==null?void 0:t.toLowerCase())===((z=(Y=E==null?void 0:E.spn[0])==null?void 0:Y.spn)==null?void 0:z.toLowerCase())});if(console.log("matchedPidConfig",n),n){const{message_type:E,resolution:Y,offset:z}=n==null?void 0:n.spn[0];console.log("message",E,Y,z);let b=A(l==null?void 0:l.rawHex),V=Fe(E,b,Y,z);if(t==="0060"){let I=R(T),B=V/100*(I==null?void 0:I.tank_capacity)||0;return parseFloat(B.toFixed(2))||0}return V||0}return"NA"};return e.jsx(e.Fragment,{children:e.jsx(le,{component:se,sx:{maxHeight:"70vh"},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(a,{align:"left",sx:x,children:"Entry Date"}),e.jsx(a,{align:"left",sx:x,children:"Device Date"}),e.jsx(a,{align:"left",sx:x,children:"HWID"}),e.jsx(a,{align:"left",sx:x,children:"Latitude"}),e.jsx(a,{align:"left",sx:x,children:"Longitude"}),e.jsx(a,{align:"left",sx:x,children:"Engine Coolant Temperature"}),e.jsx(a,{align:"left",sx:x,children:"DFF Level"}),e.jsx(a,{align:"left",sx:x,children:"Fuel Level"}),e.jsx(a,{align:"left",sx:x,children:"Engine Speed"}),e.jsx(a,{align:"left",sx:x,children:"Real time Fuel Consumtion"}),e.jsx(a,{align:"left",sx:x,children:"Total Engine Hours"}),e.jsx(a,{align:"left",sx:x,children:"Engine Oil Pressure"}),e.jsx(a,{align:"left",sx:x,children:"Equip Status"}),e.jsx(a,{align:"left",sx:x,children:"Battery Voltage"})]})}),e.jsx(re,{children:C&&C.map((t,i)=>{var l,r,n,u;return e.jsxs(J,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(t==null?void 0:t.createdAt)&&P(t==null?void 0:t.createdAt).format("DD-MM-YYYY HH:mm:ss")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:((l=t==null?void 0:t.accOnTime)==null?void 0:l.utc)&&P((r=t==null?void 0:t.accOnTime)==null?void 0:r.utc).format("DD-MM-YYYY HH:mm:ss")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t==null?void 0:t.deviceId}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t!=null&&t.latitude?(n=parseFloat(t==null?void 0:t.latitude))==null?void 0:n.toFixed(2):"NA"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t!=null&&t.longitude?(u=parseFloat(t==null?void 0:t.longitude))==null?void 0:u.toFixed(2):"NA"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("006e",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("06e1",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("0060",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("00be",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("00b7",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("00f7",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("0064",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("sas",t==null?void 0:t.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("00a8",t==null?void 0:t.pids)})]},i+1)})})]})})})}const yt="https://cc.wikitrak.in/proxy-3031";function St({handleBack:C,setStartDate:L,startDate:T,setEndDate:R,endDate:x}){var Q;const A=w(),{vehicleGroup:_,vehicleList:t}=W(p=>p.liveMap),{selectedGroup:i,selectedVehicle:l,distributorList:r}=W(p=>p.report),[n,u]=v.useState([]);v.useState([]);const[S,j]=v.useState([]),[D,E]=v.useState([]),[Y,z]=v.useState(!1);function b(p){return p.match(/../g).reverse().join("")}const V=(p,d)=>{var h,f,o,H;console.log("pid",p);const y=d.find(s=>p===(s==null?void 0:s.pid));if(console.log("matched pid",y),!y)return"NA";const $=((H=(o=(f=(h=I(l))==null?void 0:h.sub_model)==null?void 0:f.model_modelecu)==null?void 0:o[0])==null?void 0:H.pgn)||[];console.log("j1939 parameter",$);const c=$.find(s=>{var O,N;return(p==null?void 0:p.toLowerCase())===((N=(O=s==null?void 0:s.spn[0])==null?void 0:O.spn)==null?void 0:N.toLowerCase())});if(console.log("matchedPidConfig",c),c){const{message_type:s,resolution:O,offset:N}=c==null?void 0:c.spn[0];console.log("message",s,O,N);let ee=b(y==null?void 0:y.rawHex),X=Fe(s,ee,O,N);if(p==="0060"){let U=I(l),q=X/100*(U==null?void 0:U.tank_capacity)||0;return parseFloat(q.toFixed(2))||0}return X||0}return"NA"};v.useEffect(()=>{if(D&&D.length>0){let p=D.map(d=>{var y,$;return{"Entry Date":(d==null?void 0:d.createdAt)&&P(d==null?void 0:d.createdAt).format("DD-MM-YYYY HH:mm:ss")||"-","Device Date":((y=d==null?void 0:d.accOnTime)==null?void 0:y.utc)&&P(($=d==null?void 0:d.accOnTime)==null?void 0:$.utc).format("DD-MM-YYYY HH:mm:ss")||"-",HWID:d==null?void 0:d.deviceId,Latitude:d==null?void 0:d.latitude,Longitude:d.longitude,"Engine Coolant Temperature":V("006e",d==null?void 0:d.pids),"DFF Level":V("06e1",d==null?void 0:d.pids),"Fuel Level":V("0060",d==null?void 0:d.pids),"Engine Speed":V("00be",d==null?void 0:d.pids),"Real time Fuel Consumtion":V("00b7",d==null?void 0:d.pids),"Total Engine Hours":V("00f7",d==null?void 0:d.pids),"E,ngine Oil Pressure":V("0064",d==null?void 0:d.pids),"Equip Status":"NA","Battery Voltage":V("00a8",d==null?void 0:d.pids)}});j(p)}},[D]);let I=p=>(console.log(t.find(d=>{var y;return((y=d==null?void 0:d.imei[0])==null?void 0:y.mac_id)==p||""})),t.find(d=>{var y;return((y=d==null?void 0:d.imei[0])==null?void 0:y.mac_id)==p||""}));function B(p){console.log("value changed",p),A(je(p))}function m(p){console.log("value",p),A(me(p))}const g=async()=>{z(!0);const p=`${T}`,d=`${x}`;let y=I(l);if(console.log("vehicle info",y),!F())return;let $={deviceId:l,startDate:p,endDate:d};try{const{data:c}=await Ue.post(`${yt}/api/ivn-pid/by-date`,$);console.log("data",c),c&&Array.isArray(c==null?void 0:c.packets)&&E(c==null?void 0:c.packets),z(!1)}catch(c){z(!1),console.log("error",c)}},F=()=>!T||!x||l==="all"?(te.error("Please select start date, end date, and vehicle."),!1):!0,G=(Q=I(l))==null?void 0:Q.vehicle_type;console.log("device type",G);const K=i==="All"?t:t.filter(p=>p.vehicle_group===i);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(ue,{handleBack:C,downloadData:S})}),e.jsxs(M,{children:[e.jsxs(k,{size:"large",value:i,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:B,filterOption:(p,d)=>{var y;return typeof((y=d==null?void 0:d.props)==null?void 0:y.children)=="string"&&d.props.children.toLowerCase().indexOf(p.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"All",children:"All"}),n.map((p,d)=>e.jsx(k.Option,{value:p.value,children:p.label},d))]}),e.jsxs(k,{size:"large",value:l,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:m,filterOption:(p,d)=>{var y;return typeof((y=d==null?void 0:d.props)==null?void 0:y.children)=="string"&&d.props.children.toLowerCase().indexOf(p.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"all",children:"None"},"all"),K&&K.length>0&&K.map((p,d)=>{var y;return e.jsx(k.Option,{value:(y=p.imei[0])==null?void 0:y.mac_id,children:p.registration_id},d)})]}),e.jsx(ve,{setStartDate:L,setEndDate:R,selectedDate:!1,startDate:T,endDate:x}),e.jsx(pe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:g,disabled:!l,children:"Generate report"})]}),Y&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(fe,{})}),e.jsx(bt,{tableData:D})]})}function oe({children:C,value:L,index:T}){return e.jsx("div",{role:"tabpanel",hidden:L!==T,children:L===T&&e.jsx(M,{p:2,children:C})})}function Tt({showCard:C,setReportType:L,reportType:T}){W(n=>n.dashboard),W(n=>n.liveMap);const{startDate:R,endDate:x,tabValue:A}=W(n=>n.report),[_,t]=v.useState(!0);v.useState({}),v.useState(!1);let i=w();v.useEffect(()=>{},[x]),v.useEffect(()=>{i(Ve()),i(ze())},[]);const l=()=>{i(ge()),i(Ve()),i(ze()),i(L(null))},r=(n,u)=>{i(Je(u))};return e.jsx(e.Fragment,{children:e.jsx(M,{sx:{},children:e.jsxs(M,{children:[e.jsxs(qe,{value:A,onChange:r,children:[e.jsx(ce,{label:"Vehicle Report"}),e.jsx(ce,{label:"Batch data report"}),e.jsx(ce,{label:"PID Report"})]}),e.jsx(oe,{value:A,index:0,children:e.jsx(ft,{handleBack:l,selectedDate:_,setEndDate:de,setStartDate:he,startDate:R,endDate:x})}),e.jsx(oe,{value:A,index:1,children:e.jsx(vt,{handleBack:l,selectedDate:_,setEndDate:de,setStartDate:he,startDate:R,endDate:x})}),e.jsx(oe,{value:A,index:2,children:e.jsx(St,{handleBack:l,selectedDate:_,setEndDate:de,setStartDate:he,startDate:R,endDate:x})})]})})})}function Dt(){const{mode:C,showVehicles:L,selectedVehicleGroup:T}=W(j=>j.dashboard),{w_customer_id:R}=W(j=>j.auth),{reportType:x}=W(j=>j.report),[A,_]=v.useState([]),[t,i]=v.useState(!0),[l,r]=v.useState(!1),n=nt(C);let u=w();v.useEffect(()=>{S()},[]);const S=async()=>{try{let j=[],D=[];const E=await u(Qe({w_customer_id:R}));if(Array.isArray(E.payload)){E.payload.forEach(b=>{var V,I;Array.isArray(b.imei)&&b.imei.length>0?(j.push({id:b.id,label:b.registration_id,value:(V=b==null?void 0:b.imei[0])==null?void 0:V.mac_id,workShop:b==null?void 0:b.workshop,vehicle_group:b==null?void 0:b.vehicle_group}),D.push((I=b.imei[0])==null?void 0:I.mac_id)):console.error("IMEI data not found for item:",b)});const Y="one",z=D;D.length>0&&(u(Xe({type:Y,imei:z})),u(Ze(z))),_(j),u(we({w_customer_id:R})),u(et({}))}else console.error("Unexpected data format:",E),te.error("Unexpected data format:")}catch(j){console.error("Error fetching vehicle data:",j),te.error(`Error fetching vehicle data: ${j}`)}};return A.filter(j=>Object.keys(T).length===0||j.vehicle_group===T.id),e.jsxs("div",{className:"app",children:[e.jsx(tt,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:n.grey[100]},children:[e.jsx(at,{title:"Report",setShowVehiclesGroup:r,showVehiclesGroup:l,reportType:x}),e.jsx(lt,{setShowVehiclesGroup:r,showVehiclesGroup:l}),e.jsxs(M,{style:{display:"flex",width:"100%",height:"95vh",background:n.grey[200]},children:[e.jsx(M,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(M,{style:{width:"100%"},children:e.jsx(Tt,{showCard:t,setReportType:st,reportType:x})})}),!1]})]})]})}export{Dt as default};
