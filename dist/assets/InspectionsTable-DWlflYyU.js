import{j as s,G as M,y as F,z as v,b as d,I as K,aC as Q,bf as X,bg as Z,be as w,C as P,ae as ee,b2 as se,bB as ae,P as te,N as H}from"./index-CkVXv9ba.js";import{D as ne,a as oe,b as ie,c as le}from"./DialogTitle-DEIakIKz.js";import{D as re,E as ce,T as O}from"./Edit-bcZWYiXS.js";import{B as N}from"./CircularProgress-DDaf_W8R.js";import{T as de,a as ue,b as he,c as Y,d as i,e as pe}from"./TableRow-CFK2ZdGf.js";import{T as be}from"./TablePagination-sEywi6b-.js";const xe=({open:o,onClose:n,onConfirm:r})=>s.jsxs(ne,{open:o,onClose:n,children:[s.jsx(oe,{children:"Confirm Deletion"}),s.jsx(ie,{children:s.jsxs(re,{children:["Are you sure you want to delete this vehicle data?"," ",s.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),s.jsxs(le,{children:[s.jsx(M,{onClick:n,color:"primary",children:"Cancel"}),s.jsx(M,{onClick:r,color:"secondary",children:"Delete"})]})]}),ge="https://cc.wikitrak.in/api-proxy/api/v1",fe={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},je=({inspectionData:o,status:n})=>{const r=F(),{isUpdateInspection:T}=v(l=>l.inspection),[f,j]=d.useState(!1),u=()=>{const l=localStorage.getItem("role");Q.includes(l)?(r(X(!T)),r(Z(o)),r(w(o))):P.error(`Sorry! Your role is ${l}. You're not allowed to add, edit or delete the vehicle`)},m=async()=>{console.log("Vehicle data deleting");try{await ee.delete(`${ge}/vehicles/delete/${vehicleData.id}/`),P.success("Vehicle data deleted successfully!"),r(se())}catch(l){console.error("Error deleting vehicle data:",l),P.error("Failed to delete vehicle data. Please try again.")}j(!1)},h=()=>{j(!1)};return s.jsxs(N,{sx:fe,children:[s.jsx(K,{onClick:u,color:"primary","aria-label":"edit record",disabled:(n==null?void 0:n.toLowerCase())==="rejected"||(n==null?void 0:n.toLowerCase())==="close",children:s.jsx(ce,{})}),s.jsx(xe,{open:f,onClose:h,onConfirm:m})]})},Ce=[{id:"BDID",label:"BDID"},{id:"Vehicle",label:"Vehicle"},{id:"User",label:"User"},{id:"SubmissionDate",label:"Submission Date"},{id:"SubmissionTime",label:"Submission Time"},{id:"WorkshopGroup",label:"Workshop Group"},{id:"Status",label:"Status"}],_e=({where:o})=>{v(e=>e.breakdown);const n=F(),{searchTerm:r,inspectionHistory:T}=v(e=>e.inspection),[f,j]=d.useState("asc"),[u,m]=d.useState("BDID"),[h,l]=d.useState(0),[C,V]=d.useState(7),[G,De]=d.useState({id:"",status:"",workshop:"",user:""});d.useEffect(()=>{n(ae({}))},[]);const W=e=>{j(u===e&&f==="asc"?"desc":"asc"),m(e)},q=(e,t)=>{l(t)},z=e=>{V(parseInt(e.target.value,10)),l(0)},L=((e,t,p)=>e.filter(a=>{var b,x,g,I,A,E,R,U,$;const c=p.toLowerCase(),_=(x=(b=a==null?void 0:a.breakdown)==null?void 0:b.breakdown_id)==null?void 0:x.toLowerCase().includes(c),D=`${(I=(g=a==null?void 0:a.submitted_by)==null?void 0:g.us_user)==null?void 0:I.first_name} ${(E=(A=a==null?void 0:a.submitted_by)==null?void 0:A.us_user)==null?void 0:E.last_name}`.toLowerCase().includes(c),k=(R=a==null?void 0:a.status)==null?void 0:R.toLowerCase().includes(c),y=(U=a==null?void 0:a.workshop_group)==null?void 0:U.group_name.toLowerCase().includes(c),S=($=a==null?void 0:a.vehicle.registration_id)==null?void 0:$.toLowerCase().includes(c);return!(p&&!(_||D||k||y||S)||t.id&&!a.breakdown_id.includes(t.id)||t.status&&a.status!==t.status||t.workshop&&a.workshop_group.group_name!==t.workshop||t.user&&!a.user.us_user.first_name.toLowerCase().includes(t.user.toLowerCase())&&!a.user.us_user.last_name.toLowerCase().includes(t.user.toLowerCase()))}))(T.slice(),G,r),J=L.slice(h*C,h*C+C),B={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};return s.jsx(N,{sx:{m:o!=="inspection report"&&"10px",width:o==="inspection report"?"60%":"99%"},children:s.jsxs(te,{children:[s.jsx(de,{sx:{height:o==="inspection report"?"50vh":"65vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(ue,{stickyHeader:!0,children:[s.jsx(he,{children:s.jsxs(Y,{children:[Ce.map(e=>s.jsx(i,{sx:B,children:s.jsx(O,{active:u===e.id,direction:u===e.id?f:"asc",onClick:()=>W(e.id),children:e.label})},e.id)),o!=="inspection report"&&s.jsx(i,{sx:B,children:s.jsx(O,{children:"Actions"})})]})}),s.jsx(pe,{children:J.map((e,t)=>{var p,a,c,_,D,k,y,S,b,x,g;return s.jsxs(Y,{children:[s.jsx(i,{children:((p=e==null?void 0:e.breakdown)==null?void 0:p.breakdown_id)||"N/A"}),s.jsx(i,{children:(a=e==null?void 0:e.vehicle)==null?void 0:a.registration_id}),s.jsx(i,{children:`${(_=(c=e==null?void 0:e.submitted_by)==null?void 0:c.us_user)==null?void 0:_.first_name} ${(k=(D=e==null?void 0:e.submitted_by)==null?void 0:D.us_user)==null?void 0:k.last_name}`}),s.jsx(i,{children:((y=e==null?void 0:e.breakdown)==null?void 0:y.submission_date)&&H.utc((S=e==null?void 0:e.breakdown)==null?void 0:S.submission_date).local().format("YYYY-MM-DD")||"N/A"}),s.jsx(i,{children:((b=e==null?void 0:e.breakdown)==null?void 0:b.submission_date)&&H.utc((x=e==null?void 0:e.breakdown)==null?void 0:x.submission_date).local().format("HH:mm A")||"N/A"}),s.jsx(i,{children:(g=e==null?void 0:e.workshop_group)==null?void 0:g.group_name}),s.jsx(i,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),o!=="inspection report"&&s.jsx(i,{children:s.jsx(je,{inspectionData:e,status:e==null?void 0:e.status})})]},t)})})]})}),s.jsx(be,{component:"div",count:L.length,page:h,onPageChange:q,rowsPerPage:C,onRowsPerPageChange:z,rowsPerPageOptions:[5,10,15]})]})})},Le=_e;export{Le as I};
