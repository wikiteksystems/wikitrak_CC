import{b as l,z as k,j as t,y as ge,D as T,F as U,aO as Te,aj as K,C as z,T as I,bp as Oe,af as Ve,bq as _e,U as ze,aN as Re}from"./index-Bg8c8tQ0.js";import{a as ce,b as q,u as Le,G as Ne,D as He,I as Be}from"./esm-C-6oiDA_.js";import{d as We}from"./dayjs.min-CHIjUa13.js";import{r as Ye}from"./redTractor-NXgVJyvR.js";import{T as De}from"./TripGraph-BFwkJZJ5.js";import{B as P,C as Ge}from"./CircularProgress-DapZTiTs.js";import{d as Ue}from"./Info-CIIAYeSo.js";import{d as qe}from"./Close-CdLeMt6A.js";function Ke({trip:n,tripPlay:s,setTripPlay:i,setSpeed:p}){const[r,x]=l.useState([]),[a,c]=l.useState(0),[b,h]=l.useState([]),[g,e]=l.useState([null]),C=l.useRef(null),{selectedVehicle:v}=k(f=>f.liveMap),{vehicles_details:M}=k(f=>f.dashboard),[u,E]=l.useState("2W");l.useEffect(()=>{e([null]);const f=[];if(n&&n.length>0&&(n==null||n.forEach(S=>{f.push(S.speed.toFixed(2))}),h(f)),n&&n.length>0){const S=n.map(F=>({lat:parseFloat(F.lat),lng:parseFloat(F.lng)}));x(S),e(S.slice(0))}},[n]),l.useEffect(()=>{if(s){const f=r.length,S=29e3,F=1e4,W=performance.now();let O=0;const V=Y=>{const L=Y-W,N=Math.max(0,Math.min(L/S,1)),_=Math.min(Math.floor(N*f),f-1);_!==C.current&&(c(_),p(b[_]),C.current=_),O<F&&(requestAnimationFrame(V),O++)};return requestAnimationFrame(V),()=>{}}},[s,r,b]);const A=f=>{const S=M&&M.length>0&&M.find(F=>F.value===f&&F.vehilce_type);return S?S.vehilce_type:null};l.useEffect(()=>{if(Object.keys(v).length>0){const f=A(v.imei);E(f)}},[v]);const R=l.useMemo(()=>{var f,S;return{lat:parseFloat((f=r[a])==null?void 0:f.lat),lng:parseFloat((S=r[a])==null?void 0:S.lng)}},[r,a]),J=l.useMemo(()=>({url:Ye,size:new window.google.maps.Size(30,30),scaledSize:new window.google.maps.Size(30,30),fillOpacity:2,strokeWeight:1,scale:2}),[u]);return t.jsxs("div",{children:[g.length>0&&t.jsx(t.Fragment,{children:t.jsx(ce,{path:g,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4}})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(ce,{path:r.slice(0,a+1),options:{strokeColor:"green",strokeOpacity:1,strokeWeight:4,zIndex:1e3,geodesic:!0}}),t.jsx(q,{position:R,icon:J},a)]})]})}function Je({tripPlay:n,speed:s,totalDistance:i,Acreage:p,filterCoordinates:r,acreageTrips:x,handleTrip:a,showGraph:c,handleShowGraph:b}){const{selectedTripData:h}=k(C=>C.dashboard);let g=ge();const e=()=>{var C,v,M;if(console.log("selected trip data",(C=h[0])==null?void 0:C.venderId,x),h.length>0)if(((v=h[0])==null?void 0:v.venderId)==="VT200"||((M=h[0])==null?void 0:M.venderId)==="wtkpltf001")if(Object.keys(x).length>0){let u=0;Object.keys(x).map(E=>{let A=Te(x[E]);u+=A}),console.log("final acerage",u),g(K(u))}else z.error("No acreage trip found");else r(h,g)};return t.jsxs(P,{sx:{bgcolor:T.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",gap:"5px",paddingLeft:"5px",padding:"10px 10px"},children:[t.jsxs(U,{sx:{background:"white",border:"1px solid white",borderRadius:"5px",padding:"5px 20px",color:"black"},onClick:e,children:[" ","Calculate Acerage"]}),t.jsxs(U,{sx:{background:n?"transparent":"white",border:"1px solid white",borderRadius:"5px",height:"38px",padding:"5px 20px",color:n?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{a()},children:[n?"Pause":"Play","-Trip"]}),t.jsxs(U,{style:{height:"38px",padding:"5px 20px"},sx:{background:c?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:c?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{b()},children:[c?"Hide":"Show","-Graph"]})]})}const $e=({label:n,value:s})=>t.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[t.jsx(I,{variant:"body2",color:"textSecondary",children:n}),t.jsx(I,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:s||"N/A"})]}),Xe=(n,s)=>(n==null?void 0:n.find(i=>{var p,r;return((r=(p=i.imei)==null?void 0:p[0])==null?void 0:r.mac_id)===s.imei}))||{},de=({title:n,details:s})=>t.jsx(P,{sx:{width:"45%"},children:s.map(({label:i,value:p})=>t.jsx($e,{label:i,value:p},i))});function Qe({handleVehicleInfo:n,vehicleReport:s,speed:i,totalDistance:p,Acreage:r,tripPlay:x,whereToUse:a}){var M,u,E;const{collapsed:c}=k(A=>A.auth),{vehicleList:b,selectedVehicle:h}=k(A=>A.liveMap),[g,e]=l.useState({});l.useEffect(()=>{e(Xe(b,h))},[b,h]),l.useEffect(()=>{},[s]);const C=[{label:"Vehicle No:",value:g==null?void 0:g.registration_id},{label:"Model:",value:(M=g==null?void 0:g.vehicle_model)==null?void 0:M.name},{label:"IMEI No:",value:(E=(u=g==null?void 0:g.imei)==null?void 0:u[0])==null?void 0:E.mac_id},{label:"Chassis No:",value:g==null?void 0:g.chassis_no},{label:"Engine No:",value:g==null?void 0:g.engine_no}],v=[{label:"Equipment:",value:"N/A"},{label:"Avg Speed:",value:(s==null?void 0:s.averageSpeed)||"N/A"},{label:"Total Distance:",value:(s==null?void 0:s.totalDistance)||"N/A"},{label:"Avg trips/day:",value:(s==null?void 0:s.avgTrip)||"N/A"}];return t.jsxs(P,{sx:{position:"absolute",top:"570px",left:c?"280px":"450px",zIndex:1,background:T.bgShadow,p:2,borderRadius:2,color:"white",width:"58%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[t.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[t.jsx(I,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),t.jsx(qe,{sx:{cursor:"pointer",color:"black"},onClick:n})]}),a==="TripMonitor"&&t.jsxs(P,{sx:{display:"flex",justifyContent:"flex-start",gap:"10px",paddingBottom:"20px"},children:[t.jsxs(P,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px",width:"150px",display:"flex",justifyContent:"space-evenly",background:T.bgColor},children:[t.jsx(I,{children:"Speed"}),t.jsxs(I,{children:[x?i:0," KM/H"]})]}),t.jsxs(I,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px",background:T.bgColor},children:["Total-Distance ",p," KM"]}),t.jsxs(I,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:T.bgColor},children:[parseFloat(parseFloat(r).toFixed(2)*43560).toFixed()," Sqft"]}),t.jsxs(I,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:T.bgColor},children:[parseFloat(r).toFixed(2)*8," Kanal"]}),t.jsxs(I,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:T.bgColor},children:[parseFloat(parseFloat(r).toFixed(2)*8/5).toFixed(2)," Bigha"]}),t.jsxs(I,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:T.bgColor},children:[parseFloat(r).toFixed(2)," acre"]})]}),t.jsxs(P,{sx:{display:"flex",justifyContent:"space-between"},children:[t.jsx(de,{title:"Vehicle Details",details:C}),t.jsx(de,{title:"Trip Details",details:v})]})]})}const Ze="/assets/endTrip-CEqIwvWS.png",et="/assets/endTrip_-BsrUUtoJ.png",tt="/assets/startTrip-CGKteKGr.png",ot=(n,s)=>{const r=[];n.length>0&&n.forEach(a=>{let c={latitude:a.lat,longitude:a.lng},b=[];n.forEach(h=>{const g={latitude:h.lat,longitude:h.lng};if(g.latitude&&g.longitude&&g.latitude!==c.latitude&&g.longitude!==c.longitude){const e=st(a.lat,a.lng,h.lat,h.lng);e<20&&e>10&&b.push(h)}}),b.length>10&&r.push(a)});const x=n.filter(a=>a.lat!==void 0&&a.lng!==void 0).map(a=>({lat:parseFloat(a.lat),lng:parseFloat(a.lng)}));if(x.length>0){s(_e(r));try{const a=nt(x),c=at(a),b=new window.google.maps.Polygon({paths:c});return lt(b,s)}catch(a){return console.error("Error calculating convex hull or area:",a),s(K(0)),0}}else return s(K(0)),0},nt=n=>{const s=(a,c,b)=>{const h=(c.lat-a.lat)*(b.lng-c.lng)-(c.lng-a.lng)*(b.lat-c.lat);return h===0?0:h>0?1:2},i=n.reduce((a,c)=>c.lng<a.lng?c:a);let p=[],r=i,x;do{p.push(r),x=n[0]===r?n[1]:n[0];for(let a=0;a<n.length;a++)s(r,x,n[a])===2&&(x=n[a]);r=x}while(r!==i);return p};function st(n,s,i,p){const x=n*Math.PI/180,a=i*Math.PI/180,c=(i-n)*Math.PI/180,b=(p-s)*Math.PI/180,h=Math.sin(c/2)*Math.sin(c/2)+Math.cos(x)*Math.cos(a)*Math.sin(b/2)*Math.sin(b/2);return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}const at=n=>{n.sort((p,r)=>p.lng-r.lng||p.lat-r.lat);const s=[],i=[];for(const p of n){for(;s.length>=2&&pe(s[s.length-2],s[s.length-1],p)<=0;)s.pop();s.push(p)}for(let p=n.length-1;p>=0;p--){const r=n[p];for(;i.length>=2&&pe(i[i.length-2],i[i.length-1],r)<=0;)i.pop();i.push(r)}return[...s.slice(0,-1),...i.slice(0,-1)]},lt=(n,s)=>{if(!window.google||!window.google.maps.geometry){console.log("not loaded");return}const p=window.google.maps.geometry.spherical.computeArea(n.getPath())/4046.86;return s(K(p)),p},pe=(n,s,i)=>(s.lat-n.lat)*(i.lng-n.lng)-(s.lng-n.lng)*(i.lat-n.lat),rt=({selectedTrip:n,center:s,showCard:i})=>{var ne,se,ae,le,re,ie;const p=ge(),{isLoaded:r,loadError:x}=Le({googleMapsApiKey:"AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA",libraries:["drawing","geometry"]}),{Acreage:a}=k(o=>o.tripMonitor),{selectedVehicle:c}=k(o=>o.liveMap),{singleTrip_Data:b,tripLoading:h,cords:g}=k(o=>o.tripMonitor),{selectedTripData:e,mode:C,styles:v}=k(o=>o.dashboard),{collapsed:M}=k(o=>o.auth),[u,E]=l.useState(null),A=l.useRef(null),[R,J]=l.useState(null),[f,S]=l.useState(null),[F,W]=l.useState([]);l.useState([]);const[O,V]=l.useState(!1),[Y,L]=l.useState(0),[N,_]=l.useState(!1),[$,he]=l.useState(0);l.useState([]),l.useState([]);const[D,X]=l.useState(!1),[ue,xe]=l.useState({}),[G,Q]=l.useState([]),[Z,H]=l.useState(null),[fe,ee]=l.useState(null),[me,be]=l.useState({});l.useEffect(()=>{X(!0)},[c]),l.useEffect(()=>{(async()=>{if(c!=null&&c.imei){const d=We(),w=d.startOf("day").format("MM/DD/YYYY HH:mm:ss"),m=d.endOf("day").format("MM/DD/YYYY HH:mm:ss"),j={imei:[c.imei],startDate:w,endDate:m};try{const y=await ze(j);xe(y.data[0].data)}catch(y){console.error("Error fetching report:",y)}}})()},[c,p]),l.useEffect(()=>{R&&f&&R.fitBounds(f)},[R,f,e]);let we=o=>{let d=Re(o),w={};d.map((m,j)=>{let y=o.slice(m.start,m.end+1);w[j]=y}),be(w)};l.useEffect(()=>{if(console.log("selectedTripData",e),(e==null?void 0:e.length)>0){let o=e.map(w=>({lat:w.lat,lng:w.lng}));console.log("selected trip coordinate ",o);const d=Se({selectedTripData:e});he(d),we(e)}},[e]);const Se=({selectedTripData:o})=>{const d=o.reduce((w,m,j)=>{if(j===0)return w;const y=o[j-1],B=Oe(y.lat,y.lng,m.lat,m.lng);return w+B},0);return d==null?void 0:d.toFixed(2)};l.useEffect(()=>{var o,d,w,m,j;if(e&&(e==null?void 0:e.length)>0){const y=new window.google.maps.LatLngBounds,B=new window.google.maps.LatLng(parseFloat((o=e[0])==null?void 0:o.lat),parseFloat((d=e[0])==null?void 0:d.lng)),Ae=new window.google.maps.LatLng(parseFloat((w=e[(e==null?void 0:e.length)-1])==null?void 0:w.lat),parseFloat((m=e[(e==null?void 0:e.length)-1])==null?void 0:m.lng));y.extend(B),y.extend(Ae),L((j=e[0])==null?void 0:j.speed),S(y)}V(!1),je()},[e]);const je=()=>{if(e&&e.length>0){const o=(m,j)=>{const B=new Date(m.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:m.createdAt.substring(0,10),Time:B,value:m[j]}},w=["speed","mainInputVoltage","ignition"].map(m=>({label:m==="speed"?"Speed":m==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:ye(),data:e.map(j=>o(j,m))}));W(w)}else W([])},ye=()=>"#"+Math.floor(Math.random()*16777215).toString(16),Ce=()=>{var o;if((e==null?void 0:e.length)>0)V(!O),L(0);else return((o=Object.keys(e))==null?void 0:o.length)===0?z.error("Please Select Vehicle",{id:"vehicle"}):z.error("Please Select Trip",{id:"trip error"})},Me=()=>{var o;if((e==null?void 0:e.length)>0)_(!N);else return((o=Object.keys(e))==null?void 0:o.length)===0?z.error("Please Select Vehicle",{id:"vehicle"}):z.error("Please Select Trip",{id:"trip error"})},te=()=>{Object.keys(c).length>0||D?X(!D):z.error("Please select any vehicle")};if(x)return"Error loading maps";if(!r)return"Loading maps";const Ee={width:"100%",height:i?"87vh":"93vh"},ve=o=>{if(o.type==="polygon"){const d=o.overlay;d.setEditable(!0),Q(w=>[...w,d]),H(d),google.maps.event.addListener(d.getPath(),"set_at",()=>H(d)),google.maps.event.addListener(d.getPath(),"insert_at",()=>H(d)),google.maps.event.addListener(d.getPath(),"remove_at",()=>H(d)),oe(d)}},oe=o=>{if(!o)return;const d=o.getPath().getArray(),m=(google.maps.geometry.spherical.computeArea(d)/4046.86).toFixed(2);ee(m)},Fe=()=>{G.forEach(o=>o.setMap(null)),Q([]),ee(null),H(null)},Ie=()=>{G.forEach(o=>o.setEditable(!0))},ke=()=>{G.forEach(o=>o.setEditable(!1))},Pe=()=>{Z?oe(Z):alert("No shape is selected. Please draw or select a shape.")};return t.jsxs(t.Fragment,{children:[h&&t.jsx(P,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:t.jsx(Ge,{})}),i&&t.jsx(Je,{tripPlay:O,speed:Y,totalDistance:$,Acreage:a,filterCoordinates:ot,acreageTrips:me,handleTrip:Ce,showGraph:N,handleShowGraph:Me}),t.jsx(P,{sx:{position:"absolute",top:"795px",left:M?"74px":"250px",zIndex:1,background:T.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:t.jsxs(U,{sx:{color:"white"},onClick:te,children:[D?"Hide":"Show"," Vehicle Info",t.jsx(Ue,{})]})}),D===!0&&t.jsx(Qe,{handleVehicleInfo:te,vehicleReport:ue,tripPlay:O,speed:Y,totalDistance:$,Acreage:a,whereToUse:"TripMonitor"}),t.jsxs(Ne,{ref:A,mapContainerStyle:Ee,zoom:10,center:s,onLoad:o=>J(o),options:{styles:C?v:""},children:[t.jsx(He,{onOverlayComplete:ve,options:{drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:["polygon"]}}}),t.jsxs("div",{style:{position:"absolute",bottom:80,left:20,background:"white",padding:"10px",borderRadius:"8px",boxShadow:"0 0 6px rgba(0,0,0,0.2)",zIndex:100,width:"auto"},children:[t.jsxs("p",{children:["Area: ",fe||0," acres"]}),G.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Ie,style:{marginTop:"10px",marginRight:"10px"},children:"Enable Editing"}),t.jsx("button",{onClick:ke,style:{marginTop:"10px",marginRight:"10px"},children:"Disable Editing"}),t.jsx("button",{onClick:Pe,style:{marginTop:"10px",marginRight:"10px"},children:"Calculate Area"}),t.jsx("button",{onClick:Fe,style:{marginTop:"10px"},children:"Clear All Shapes"})]})]}),e&&(e==null?void 0:e.length)>0&&t.jsx(q,{onClick:()=>E(e[0]),position:{lat:parseFloat((ne=e[0])==null?void 0:ne.lat)+1e-6,lng:parseFloat((se=e[0])==null?void 0:se.lng)+1e-6},animation:"BOUNCE",icon:{url:tt,scaledSize:new google.maps.Size(60,60)}}),e&&(e==null?void 0:e.length)>0&&t.jsx(q,{onClick:()=>E(e[(e==null?void 0:e.length)-1]),position:{lat:parseFloat(((ae=e[(e==null?void 0:e.length)-1])==null?void 0:ae.lat)+1e-5),lng:parseFloat(((le=e[(e==null?void 0:e.length)-1])==null?void 0:le.lng)+1e-6)},animation:"BOUNCE",icon:{url:et,scaledSize:new google.maps.Size(60,60)}}),e&&e.length>0&&e.filter(o=>!o.ignition).map((o,d)=>(console.log("index",d),t.jsx(q,{position:{lat:parseFloat(o==null?void 0:o.lat),lng:parseFloat(o==null?void 0:o.lng)},onClick:()=>E(o),label:{text:(d+1).toString(),color:"white",fontWeight:"bold",fontSize:"14px"},animation:"BOUNCE",icon:{url:Ze,scaledSize:new google.maps.Size(40,40)}},d))),u&&t.jsx(Be,{position:{lat:parseFloat(u==null?void 0:u.lat),lng:parseFloat(u==null?void 0:u.lng)},onCloseClick:()=>E(null),children:t.jsxs("div",{children:["Date-time:",u!=null&&u.Date?Ve(new Date(u==null?void 0:u.Date)).format("DD-MM-YYYY HH:mm"):""]})}),e&&(e==null?void 0:e.length)>0&&t.jsx(Ke,{trip:e,tripPlay:O,setTripPlay:V,setSpeed:L}),t.jsx("div",{style:{position:"relative",top:200,left:12,color:"green"},children:((ie=(re=F[0])==null?void 0:re.data)==null?void 0:ie.length)>0&&N&&t.jsx(De,{item:F})})]})]})},ft=rt;export{ft as T,ot as f};
