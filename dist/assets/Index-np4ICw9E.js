import{c as K,j as s,B as F,i as Y,k as y,r as i,I as W,aT as Q,aQ as J,ai as X,w as O,ak as ee,P as Z,ad as se,av as ae,Z as z,K as oe,L as te,O as re,N as ne,t as le}from"./index-LVpq-JUD.js";import{L as ce}from"./LiveMapTopBar-9NNAm1BB.js";import{V as ie}from"./VehicleMenu-VSnE3q92.js";import{t as de}from"./SearchTab-lfh1rf5v.js";import"./Loader-dBXuRoSC.js";import"./LiveMapServices-7PZXZy1Z.js";import"./Socket-0N_gnJcr.js";import{P as ue}from"./Parameters-Bwyf2PV9.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as he}from"./LeftSideBar2-SdH1WO28.js";import{D as pe,a as ge,b as fe,T as xe}from"./TablePagination-DkgCDaX8.js";import{D as _e,a as be,E as we,T as ke}from"./Edit-B_liLkTS.js";import{B as V}from"./menu2-DFxe3FzO.js";import{T as je,a as De,b as me,c as q,d as Ce}from"./TableRow-Bidq9zoa.js";import{T as S}from"./TableCell-Bi_v1tAm.js";import{A as ve}from"./AddBreakdown-CA6rPNdK.js";import"./index.esm-DH1TTYC-.js";import{V as Se}from"./VehicleGroups-CmR4pEsZ.js";import"./Close-DdDboBFE.js";import"./createSvgIcon-Co8kjKNG.js";import"./useControlled-D3R5AkZi.js";import"./jcb-aCHXMCXy.js";import"./index-BaspJOhR.js";import"./TextField-F3KWkeiF.js";import"./Autocomplete-C0D0qjeR.js";import"./index-DQ1iWchk.js";import"./Card-lm_l-bvN.js";import"./CardContent-DJqG9tz1.js";import"./Add-B-nOl889.js";import"./formik.esm-CuUSKd2Q.js";import"./SearchInput-Br1BxDRQ.js";import"./useMediaQuery-BjZvOF1w.js";const ye=K(s.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Be=({open:_,onClose:g,onConfirm:w})=>s.jsxs(pe,{open:_,onClose:g,children:[s.jsx(_e,{children:"Confirm Deletion"}),s.jsx(ge,{children:s.jsxs(be,{children:["Are you sure you want to delete this vehicle data?"," ",s.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),s.jsxs(fe,{children:[s.jsx(F,{onClick:g,color:"primary",children:"Cancel"}),s.jsx(F,{onClick:w,color:"secondary",children:"Delete"})]})]}),Le="http://134.209.145.234/api/v1",Pe={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Ae=({breakdownData:_})=>{const g=Y(),{isUpdateBreakdown:w}=y(h=>h.equipment),{w_customer_id:U}=y(h=>h.auth),[k,f]=i.useState(!1),B=()=>{console.log("breakdownData",_),localStorage.getItem("role"),g(Q(!w)),g(J(_))},v=()=>{console.log("dlt btn clicked");const h=localStorage.getItem("role");X.includes(h)?f(!0):O.error(`Sorry! Your role is ${h}. You're not allowed to add, edit or delete the vehicle`)},j=async()=>{console.log("breakdownData data deleting");try{await ee.delete(`${Le}/vehicles/breakdown/create/${_.id}/`),O.success("breakdownData data deleted successfully!"),g(Z(U))}catch(h){console.error("Error deleting breakdown data:",h),O.error("Failed to delete breakdown data. Please try again.")}f(!1)},T=()=>{f(!1)},D={color:"#686868"};return s.jsxs(V,{sx:Pe,children:[s.jsx(W,{onClick:B,children:s.jsx(we,{sx:D})}),s.jsx(W,{onClick:v,children:s.jsx(ye,{sx:D})}),s.jsx(Be,{open:k,onClose:T,onConfirm:j})]})},Ie=[{id:"BDID",label:"BDID"},{id:"User",label:"User"},{id:"SubmissionDate",label:"Submission Date"},{id:"WorkshopGroup",label:"Workshop Group"},{id:"Status",label:"Status"},{id:"Actions",label:"Actions"}],Ve=()=>{const{breakdowns:_}=y(e=>e.breakdown),{searchTerm:g}=y(e=>e.inspection),[w,U]=i.useState("asc"),[k,f]=i.useState("BDID"),[B,v]=i.useState(0),[j,T]=i.useState(5),[D,h]=i.useState({id:"",status:"",workshop:"",user:""}),E=e=>{U(k===e&&w==="asc"?"desc":"asc"),f(e)},L=(e,t)=>{v(t)},R=e=>{T(parseInt(e.target.value,10)),v(0)},G=(e,t,c)=>e.filter(o=>{var A,a,b,x,I,d,C;const r=new Date,n=new Date(o.submission_date);if(r.setHours(0,0,0,0),n.setHours(0,0,0,0),(c==null?void 0:c.toLowerCase())==="overdue"&&n<r&&o.status.toLowerCase()==="open")return!0;const u=c.toLowerCase(),l=(A=o==null?void 0:o.breakdown_id)==null?void 0:A.toLowerCase().includes(u),p=`${(b=(a=o==null?void 0:o.user)==null?void 0:a.us_user)==null?void 0:b.first_name} ${(I=(x=o==null?void 0:o.user)==null?void 0:x.us_user)==null?void 0:I.last_name}`.toLowerCase().includes(u),m=(d=o==null?void 0:o.status)==null?void 0:d.toLowerCase().includes(u),M=(C=o==null?void 0:o.workshop_group)==null?void 0:C.group_name.toLowerCase().includes(u);return!(c&&!(l||p||m||M)||t.id&&!o.breakdown_id.includes(t.id)||t.status&&o.status!==t.status||t.workshop&&o.workshop_group.group_name!==t.workshop||t.user&&!o.user.us_user.first_name.toLowerCase().includes(t.user.toLowerCase())&&!o.user.us_user.last_name.toLowerCase().includes(t.user.toLowerCase()))}),H=(e,t,c,o)=>{if(o==="User"){const r=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),n=`${t.user.us_user.first_name} ${t.user.us_user.last_name}`.toLowerCase();return c==="asc"?r.localeCompare(n):n.localeCompare(r)}if(o==="WorkshopGroup"){const r=e.workshop_group.group_name.toLowerCase(),n=t.workshop_group.group_name.toLowerCase();return c==="asc"?r.localeCompare(n):n.localeCompare(r)}if(o==="BDID"){const r=parseInt(e.breakdown_id.replace("BD-",""),10),n=parseInt(t.breakdown_id.replace("BD-",""),10);return c==="asc"?r-n:n-r}if(o==="SubmissionDate"){const r=new Date(e.submission_date),n=new Date(t.submission_date);return c==="asc"?r-n:n-r}if(o==="Status"){const r={Open:1,Close:2,Rejected:3},n=r[e.status]||0,u=r[t.status]||0;return c==="asc"?n-u:u-n}return 0},P=G(_.slice(),D,g).sort((e,t)=>H(e,t,w,k)),$=P.slice(B*j,B*j+j),N={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};return s.jsx(V,{sx:{m:"10px"},children:s.jsxs(se,{children:[s.jsx(je,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(De,{stickyHeader:!0,children:[s.jsx(me,{children:s.jsx(q,{children:Ie.map(e=>s.jsx(S,{sx:N,children:s.jsx(ke,{active:k===e.id,direction:k===e.id?w:"asc",onClick:()=>E(e.id),children:e.label})},e.id))})}),s.jsx(Ce,{children:$.map((e,t)=>{var c,o,r,n,u;return s.jsxs(q,{children:[s.jsx(S,{children:e==null?void 0:e.breakdown_id}),s.jsx(S,{children:`${(o=(c=e==null?void 0:e.user)==null?void 0:c.us_user)==null?void 0:o.first_name} ${(n=(r=e==null?void 0:e.user)==null?void 0:r.us_user)==null?void 0:n.last_name}`}),s.jsx(S,{children:e.submission_date||"N/A"}),s.jsx(S,{children:(u=e==null?void 0:e.workshop_group)==null?void 0:u.group_name}),s.jsx(S,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),s.jsx(S,{children:s.jsx(Ae,{breakdownData:e})})]},t)})})]})}),s.jsx(xe,{component:"div",count:P.length,page:B,onPageChange:L,rowsPerPage:j,onRowsPerPageChange:R,rowsPerPageOptions:[5,10,15]})]})})},Te=Ve;function gs(){const{locationData:_,selectedVehicle:g,selectedParameterList:w,onlineVehicle:U}=y(l=>l.liveMap),{mode:k,selectedVehicleGroup:f,vehicleZone:B}=y(l=>l.dashboard),v=de(k),[j,T]=i.useState([]),{w_customer_id:D}=y(l=>l.auth),[h,E]=i.useState(),[L,R]=i.useState(!1),[G,H]=i.useState(!1),[P,$]=i.useState([]);i.useState(!0);const[N,e]=i.useState(!1),[t,c]=i.useState(!1);let o=Y();i.useEffect(()=>{r(),o(ae()),o(Z(D))},[]),i.useEffect(()=>{console.log("selectedVehicleGroup",f)},[f]),i.useEffect(()=>{$([]),o(z([{reg_id:"",imei:"",params:[]}]))},[g]);const r=async()=>{try{e(!0);let l=[],p=[];const m=await o(oe({w_customer_id:D}));if(Array.isArray(m.payload)){m.payload.forEach(a=>{var b,x,I,d;Array.isArray(a.imei)&&a.imei.length>0&&((b=a.imei[0])!=null&&b.mac_id)?(l.push({id:a.id,label:a.registration_id,value:(x=a.imei[0])==null?void 0:x.mac_id,vehilce_type:a==null?void 0:a.segment,chassis_no:a==null?void 0:a.chassis_no,engine_no:a==null?void 0:a.engine_no,workShop:a==null?void 0:a.workshop,registration_id:a==null?void 0:a.registration_id,sell_date:a==null?void 0:a.sell_date,customer_name:a==null?void 0:a.customer_name,vehicle_model:(I=a==null?void 0:a.vehicle_model)==null?void 0:I.name,user:a==null?void 0:a.user,vehicle_group:a==null?void 0:a.vehicle_group}),p.push((d=a.imei[0])==null?void 0:d.mac_id)):console.error("IMEI data not found for item:",a)});const M="one",A=p;p.length>0&&o(te({type:M,imei:A})),T(l),o(re({w_customer_id:D})),o(ne(l)),e(!1)}else e(!1),console.error("Unexpected data format:",m),O.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),O.error(`Error fetching vehicle data: ${l}`)}},n=async l=>{const{label:p,imei:m,id:M,reg_id:A,checked:a}=l;E(d=>d.map(C=>C.id===M?{...C,checked:!a}:C));let b=[...P],x=[...P];if(!a)_.forEach(d=>{d.latestDocument.imei===m&&(b.push({label:p,value:d.latestDocument[p==="maininputvoltage"?"mainInputVoltage":p]}),x=b,$(b))});else{let d=P.filter(C=>C.label!==p);x=d,$(d)}console.log("tempParamList",x),o(z([{reg_id:A,imei:m,params:x}]))},u=j.filter(l=>Object.keys(f).length===0||l.vehicle_group===f.id);return s.jsxs("div",{className:"app",children:[s.jsx(he,{}),s.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[s.jsx(ce,{title:"Breakdown",setShowVehicles:R,showVehicles:L,setShowVehiclesGroup:c,showVehiclesGroup:t}),s.jsx(Se,{setShowVehiclesGroup:c,showVehiclesGroup:t}),s.jsxs(V,{style:{display:"flex",width:"100%",height:"95vh"},children:[s.jsxs(V,{style:{width:L||G?"80%":"100%",background:le.bgShadow},children:[s.jsx(ve,{where:"Breakdown"}),s.jsx(Te,{})]}),L&&s.jsx(V,{style:{width:"20%",backgroundColor:v.grey[100]},children:s.jsx(ie,{vehicleData:u,title:"Inspections",setParameterData:E,loadingVehicle:N,setShowVehicles:R,showVehicles:L,showParameters:G,setShowParameters:H})}),G&&s.jsx(V,{style:{width:"20%",backgroundColor:v.grey[100]},children:s.jsx(ue,{parametersData:h,setParameterData:E,handleParameterChange:n})})]})]})]})}export{gs as default};
