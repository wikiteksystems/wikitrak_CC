import{a_ as Z,a$ as I,b as n,j as a,aW as k,aY as w,fd as oe,fe as re,c4 as de,b7 as F,bB as le,ff as ie,bm as M,fg as ee,bf as ue,d4 as se,cf as he,dT as pe,dU as be,dV as _e,dW as ae,dX as l,dY as fe,f5 as ge,da as xe,eM as je,eN as ne,fc as ke,fh as Se,bH as te,bw as Ce,bx as De,bA as ye,bz as ve,bq as Be,bs as Pe,b5 as Te}from"./index-ock7dTJT.js";import{V as Ve}from"./VehicleMenu-F1D1FdiL.js";import{P as Ae}from"./Parameters-DQ0h7EQy.js";/* empty css           */import{C as $e,T as Ee,d as Ie}from"./excelUtils-4lVmt_iL.js";import{E as Le,T as Ye}from"./Edit-L8QSs8Kv.js";import{D as me}from"./Remove-3T_uviBq.js";import{a as Ne,B as Re}from"./BreakDownJobCardTable-DbUYvbaW.js";import{A as Me}from"./AddBreakdown-DUz1kcQ6.js";import"./index.esm-BPUoX0OR.js";import{S as He}from"./ServicesTopBar-HnrNEAu5.js";import"./Autocomplete-DZUjB-ll.js";import"./formik.esm-CpWnnq3r.js";import"./Add-DjWf5UUa.js";import"./useMediaQuery-BEn-3rwV.js";const Oe="https://cc.wikitrak.in/api-proxy/api/v1",Ue={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Ge=({breakdownData:g,status:r})=>{const x=Z(),{isUpdateBreakdown:C}=I(p=>p.equipment),{w_customer_id:$}=I(p=>p.auth),[j,D]=n.useState(!1),y=()=>{console.log("breakdownData",g),localStorage.getItem("role"),x(oe(!C)),x(re(g))},L=()=>{console.log("dlt btn clicked"),localStorage.getItem("role"),D(!0)},v=async()=>{console.log("breakdownData data deleting");try{await de.delete(`${Oe}/vehicles/new/breakdown/create/${g.id}/`),F.success("breakdownData data deleted successfully!"),x(le($))}catch(p){console.error("Error deleting breakdown data:",p),F.error("Failed to delete breakdown data. Please try again.")}D(!1)},E=()=>{D(!1)},H={color:"#686868"};return a.jsxs(k,{sx:Ue,children:[a.jsx(w,{onClick:y,color:"primary",disabled:(r==null?void 0:r.toLowerCase())==="rejected"||(r==null?void 0:r.toLowerCase())==="close",children:a.jsx(Le,{})}),a.jsx(w,{onClick:L,children:a.jsx(me,{sx:H})}),a.jsx($e,{open:j,onClose:E,onConfirm:v})]})},ce=[{id:"breakdown_id",label:"BDID"},{id:"registration_id",label:"Vehicle No"},{id:"breakdown_topic",label:"Topic"},{id:"breakdown_sub_topic",label:"Sub Topic"},{id:"user",label:"Created"},{id:"technician",label:"Technician"},{id:"contact_person",label:"Contact person"},{id:"mob_no",label:"Contact person mobile"},{id:"description",label:"Cust. complaint"},{id:"submission_date",label:"Submission Date"},{id:"submission_time",label:"Submission Time"},{id:"status",label:"Status"}],Je=()=>{const{breakdowns:g}=I(e=>e.breakdown),{searchTerm:r}=I(e=>e.inspection),x=Z(),[C,$]=n.useState("asc"),[j,D]=n.useState("BDID"),[y,L]=n.useState(0),[v,E]=n.useState(8),[H,p]=n.useState(!1),[Y,W]=n.useState(null),[m,z]=n.useState("breakdown_id");n.useState({id:"",status:"",workshop:"",user:""}),n.useEffect(()=>{x(ie({}))},[]);const O=e=>{$(j===e&&C==="asc"?"desc":"asc"),D(e)},U=(e,u)=>{L(u)},Q=e=>{E(parseInt(e.target.value,10)),L(0)},B=((e,u,_)=>!u||!_?e:e.filter(s=>(()=>{var o,f,c,d,P,T,V,A,J,S;switch(u){case"breakdown_id":return((s==null?void 0:s.breakdown_id)||"").toString();case"registration_id":return((o=s==null?void 0:s.vehicle)==null?void 0:o.registration_id)||"";case"breakdown_topic":return((f=s==null?void 0:s.breakdown_topic)==null?void 0:f.topic)||"";case"user_name":return`${((d=(c=s==null?void 0:s.user)==null?void 0:c.us_user)==null?void 0:d.first_name)||""} ${((T=(P=s==null?void 0:s.user)==null?void 0:P.us_user)==null?void 0:T.last_name)||""}`;case"technician_name":return`${((A=(V=s==null?void 0:s.technician)==null?void 0:V.us_user)==null?void 0:A.first_name)||""} ${((S=(J=s==null?void 0:s.technician)==null?void 0:J.us_user)==null?void 0:S.last_name)||""}`;case"contact_person":return(s==null?void 0:s.contact_person)||"";case"mob_no":return(s==null?void 0:s.mob_no)||"";case"submission_date":return s!=null&&s.submission_date?M(s.submission_date).format("YYYY-MM-DD"):"";case"start_time":return s!=null&&s.submission_date?M(s.submission_date).format("HH:mm A"):"";case"status":return(s==null?void 0:s.status)||"";default:return""}})().toLowerCase().includes(_.toLowerCase())))((g==null?void 0:g.slice())||[],m,r),G=B.slice(y*v,y*v+v);console.log(G,B,"paginatedData");const i={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},X=B&&B.map(e=>{var _,s,h,o,f,c,d,P,T,V,A,J;const u=e!=null&&e.breakdown_parts&&(e==null?void 0:e.breakdown_parts.length)>0?e==null?void 0:e.breakdown_parts.map((S,Fe)=>{var K;return`${(K=S==null?void 0:S.spare_parts)==null?void 0:K.description}: Qty ${S==null?void 0:S.quantity}`}).join(";"):"N/A";return{BDID:(e==null?void 0:e.breakdown_id)||"","Registration ID":((_=e==null?void 0:e.vehicle)==null?void 0:_.registration_id)||"","Breakdown Topic":((s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic)||"","Breakdown Sub Topic":((o=(h=e.breakdown_topic)==null?void 0:h.breakdown_sub_topic)==null?void 0:o.name)||"","Customer Complaint":(e==null?void 0:e.description)||"","Created By":`${((c=(f=e==null?void 0:e.user)==null?void 0:f.us_user)==null?void 0:c.first_name)||""} ${((P=(d=e==null?void 0:e.user)==null?void 0:d.us_user)==null?void 0:P.last_name)||""}`,"Technician Name":`${((V=(T=e==null?void 0:e.technician)==null?void 0:T.us_user)==null?void 0:V.first_name)||""} ${((J=(A=e==null?void 0:e.technician)==null?void 0:A.us_user)==null?void 0:J.last_name)||""}`,"Contact Person":(e==null?void 0:e.contact_person)||"","Mobile No":(e==null?void 0:e.mob_no)||"","Submission Date":e!=null&&e.submission_date?M(e.submission_date).format("YYYY-MM-DD"):"","Submission Time":e!=null&&e.submission_date?M(e.submission_date).format("HH:mm A"):"",Status:(e==null?void 0:e.status)||"","Spare parts":u}});let N=ee("Breakdown"),R=ee("Job Card");const t=(R==null?void 0:R.includes("Create"))||R==="Read-Write-Only",b=(N==null?void 0:N.includes("Update"))||N==="Read-Write-Only";return a.jsxs(k,{sx:{m:"10px"},children:[a.jsxs(k,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsx(Ee,{columns:ce,selectedColumn:m,onColumnChange:z,searchTerm:r,onSearchChange:e=>x(ue(e))}),a.jsx(se,{variant:"contained",color:"success",onClick:()=>Ie(X,"breakdown-tickets.xlsx"),children:"Download Excel"})]}),a.jsxs(he,{children:[a.jsx(pe,{sx:{height:"55vh",bgcolor:"white",borderRadius:"10px"},children:a.jsxs(be,{stickyHeader:!0,children:[a.jsx(_e,{children:a.jsxs(ae,{children:[ce.map(e=>a.jsx(l,{sx:i,children:a.jsx(Ye,{active:j===e.id,direction:j===e.id?C:"asc",onClick:()=>O(e.id),children:e.label})},e.id)),b&&a.jsx(l,{sx:i,children:"Action"}),t&&a.jsx(l,{sx:i,children:"Job card"})]})}),a.jsx(fe,{children:G.map((e,u)=>{var _,s,h,o,f,c,d,P,T,V,A;return a.jsxs(ae,{children:[a.jsx(l,{children:e==null?void 0:e.breakdown_id}),a.jsx(l,{children:(_=e==null?void 0:e.vehicle)==null?void 0:_.registration_id}),a.jsx(l,{children:(s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic}),a.jsx(l,{children:(h=e==null?void 0:e.breakdown_sub_topic)==null?void 0:h.name}),a.jsx(l,{children:`${(f=(o=e==null?void 0:e.user)==null?void 0:o.us_user)==null?void 0:f.first_name} ${(d=(c=e==null?void 0:e.user)==null?void 0:c.us_user)==null?void 0:d.last_name}`}),a.jsx(l,{children:`${((T=(P=e==null?void 0:e.technician)==null?void 0:P.us_user)==null?void 0:T.first_name)||"N/A"} ${((A=(V=e==null?void 0:e.technician)==null?void 0:V.us_user)==null?void 0:A.last_name)||""}`}),a.jsx(l,{children:e==null?void 0:e.contact_person}),a.jsx(l,{children:e==null?void 0:e.mob_no}),a.jsx(l,{children:e==null?void 0:e.description}),a.jsx(l,{children:(e==null?void 0:e.submission_date)&&M(e.submission_date).format("YYYY-MM-DD")||"N/A"}),a.jsx(l,{children:(e==null?void 0:e.submission_date)&&M(e.submission_date).format("HH:mm A")||"N/A"}),a.jsx(l,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),b&&a.jsx(l,{children:a.jsx(Ge,{breakdownData:e,status:e.status})}),t&&a.jsx(l,{children:a.jsx(se,{variant:"outlined",onClick:()=>{p(!0),W(e)},disabled:e.jobcard,children:"Create job card"})})]},u)})})]})}),a.jsx(ge,{component:"div",count:B.length,page:y,onPageChange:U,rowsPerPage:v,onRowsPerPageChange:Q,rowsPerPageOptions:[5,10,15]}),a.jsx(Ne,{rowData:Y,open:H,handleClose:()=>p(!1),isTechnician:!0})]})]})},We=Je;function qe(){const[g]=xe(),r=g.get("tab"),[x,C]=n.useState(0),$=(j,D)=>{C(D)};return n.useEffect(()=>{r&&C(Number(r))},[]),a.jsxs(k,{sx:{width:"100%"},children:[a.jsx(k,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsxs(je,{value:x,onChange:$,"aria-label":"Breakdown Tabs",children:[a.jsx(ne,{label:"Breakdown Tickets"}),a.jsx(ne,{label:"Breakdown Job Cards"})]})}),a.jsxs(k,{sx:{mt:2},children:[x===0&&a.jsx(We,{}),x===1&&a.jsx(Re,{})]})]})}function ds(){const{locationData:g,selectedVehicle:r,selectedParameterList:x,onlineVehicle:C}=I(t=>t.liveMap),{mode:$,selectedVehicleGroup:j,vehicleZone:D}=I(t=>t.dashboard),y=Te($),[L,v]=n.useState([]),{w_customer_id:E}=I(t=>t.auth),[H,p]=n.useState(),[Y,W]=n.useState(!1),[m,z]=n.useState(!1),[O,U]=n.useState([]);n.useState(!0);const[Q,q]=n.useState(!1),[B,G]=n.useState(!1);let i=Z();n.useEffect(()=>{X(),i(ke()),i(le(E)),i(Se())},[]),n.useEffect(()=>{console.log("selectedVehicleGroup",j)},[j]),n.useEffect(()=>{U([]),i(te([{reg_id:"",imei:"",params:[]}]))},[r]);const X=async()=>{try{q(!0);let t=[],b=[];const e=await i(Ce({w_customer_id:E}));if(Array.isArray(e.payload)){e.payload.forEach(s=>{var h,o,f,c;Array.isArray(s.imei)&&s.imei.length>0&&((h=s.imei[0])!=null&&h.mac_id)?(t.push({id:s.id,label:s.registration_id,value:(o=s.imei[0])==null?void 0:o.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(f=s==null?void 0:s.vehicle_model)==null?void 0:f.name,user:s==null?void 0:s.user,vehicle_group:s==null?void 0:s.vehicle_group,segment:s==null?void 0:s.segment}),b.push((c=s.imei[0])==null?void 0:c.mac_id)):console.error("IMEI data not found for item:",s)});const u="one",_=b;b.length>0&&i(De({type:u,imei:_})),v(t),i(ye({w_customer_id:E})),i(ve(t)),q(!1)}else q(!1),console.error("Unexpected data format:",e),F.error("Unexpected data format:")}catch(t){console.error("Error fetching vehicle data:",t),F.error(`Error fetching vehicle data: ${t}`)}},N=async t=>{const{label:b,imei:e,id:u,reg_id:_,checked:s}=t;p(c=>c.map(d=>d.id===u?{...d,checked:!s}:d));let h=[...O],o=[...O];if(!s)g.forEach(c=>{c.latestDocument.imei===e&&(h.push({label:b,value:c.latestDocument[b==="maininputvoltage"?"mainInputVoltage":b]}),o=h,U(h))});else{let c=O.filter(d=>d.label!==b);o=c,U(c)}console.log("tempParamList",o),i(te([{reg_id:_,imei:e,params:o}]))},R=L.filter(t=>Object.keys(j).length===0||t.vehicle_group===j.id);return a.jsxs("div",{className:"app",children:[a.jsx(Be,{}),a.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[a.jsx(He,{title:"Breakdown",setShowVehicles:W,showVehicles:Y,setShowVehiclesGroup:G,showVehiclesGroup:B}),a.jsx(Pe,{setShowVehiclesGroup:G,showVehiclesGroup:B}),a.jsxs(k,{style:{display:"flex",width:"100%",height:"95vh"},children:[a.jsxs(k,{style:{width:Y||m?"80%":"100%"},children:[a.jsx(Me,{where:"Breakdown"}),a.jsx(qe,{})]}),Y&&a.jsx(k,{style:{width:"20%",backgroundColor:y.grey[100]},children:a.jsx(Ve,{vehicleData:R,title:"Inspections",setParameterData:p,loadingVehicle:Q,setShowVehicles:W,showVehicles:Y,showParameters:m,setShowParameters:z})}),m&&a.jsx(k,{style:{width:"20%",backgroundColor:y.grey[100]},children:a.jsx(Ae,{parametersData:H,setParameterData:p,handleParameterChange:N})})]})]})]})}export{ds as default};
