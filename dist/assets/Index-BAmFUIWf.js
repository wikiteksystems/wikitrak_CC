import{ab as Ce,j as o,z as ne,b as c,E as Te,T as Z,G as pe,R as st,y as Be,B as Se,a7 as rt,N as at,ac as lt,ad as ct,I as it,C as se,ae as ut,$ as dt,af as Ne,a1 as ft,a2 as gt,a4 as pt,a5 as ht,ag as Ae}from"./index-q3CdUvS5.js";import{L as xt}from"./LiveMapTopBar-fJgORnYh.js";import{V as yt}from"./VehicleMenu-Pt2rumPi.js";import{t as bt}from"./SearchTab-CZ_4r6ax.js";import{F as mt}from"./Loader-DXjD4ODP.js";import{L as kt}from"./LiveMapServices-CYDvJkqj.js";import{s as Ie}from"./Socket-DLjvxrzW.js";import{P as vt}from"./Parameters-Bz79BpP1.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as wt}from"./LeftSideBar2-Dljw0sNo.js";import{V as jt}from"./VehicleGroups-CgKK4Oea.js";import{u as St,G as _t,M as Dt}from"./esm-C1grbJLI.js";import{M as It,r as Ct,g as Mt,y as Lt,b as $t,a as Rt,c as Vt,d as Et,e as Nt,f as At,h as Ot,i as Tt,j as Bt,k as Ft,l as Wt,m as Gt,n as Ht,o as Pt,p as Ut,q as zt,s as qt,t as Yt,u as Kt,v as Xt}from"./black_bike-C39CV0z6.js";import{d as Fe}from"./Close-DV_ADvSv.js";import{r as Me}from"./createSvgIcon-C0oNKqIG.js";import"./NewLoader-HUZwr_n0.js";import{m as je}from"./motorbike-Ci4voNFa.js";import{d as Jt}from"./Info-DSMy2umO.js";import{B as w,C as Zt}from"./CircularProgress-BgU7FTvL.js";import{r as Qt}from"./redTractor-NXgVJyvR.js";import{D as eo,a as to,b as oo,c as no}from"./DialogTitle-DCLhIEqB.js";import{T as so}from"./TextField-BjBUzuNJ.js";import"./jcb-aCHXMCXy.js";import"./menu2-CfDOHXj2.js";import"./useControlled-BKax8GG5.js";import"./Autocomplete-BUI0rKni.js";import"./usePreviousProps-D3GOYhmt.js";import"./index-BVIB9nuc.js";import"./Card-B369nXtR.js";import"./CardContent-CZ6mRaGC.js";var Le={},ro=Ce;Object.defineProperty(Le,"__esModule",{value:!0});var We=Le.default=void 0,ao=ro(Me()),lo=o;We=Le.default=(0,ao.default)((0,lo.jsx)("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"NorthEast");var $e={},co=Ce;Object.defineProperty($e,"__esModule",{value:!0});var Ge=$e.default=void 0,io=co(Me()),uo=o;Ge=$e.default=(0,io.default)((0,uo.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn");const fo=({label:b,value:x})=>o.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[o.jsx(Z,{variant:"body2",color:"textSecondary",children:b}),o.jsx(Z,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:x||"N/A"})]}),go=(b,x)=>(b==null?void 0:b.find(O=>{var I,C;return((C=(I=O.imei)==null?void 0:I[0])==null?void 0:C.mac_id)===x}))||{},Oe=({title:b,details:x})=>o.jsx(w,{sx:{width:"45%"},children:x.map(({label:O,value:I})=>o.jsx(fo,{label:O,value:I},O))});function po({handleVehicleInfo:b,udpatedParams:x,handleClickOpen:O}){var ae,M,H,q,L,Y,ee,te,T,K,ce,le;const{collapsed:I}=ne(h=>h.auth),{vehicleList:C,selectedVehicle:m,selectedImei:G}=ne(h=>h.liveMap),[u,fe]=c.useState({});let[a,re]=c.useState(null);c.useEffect(()=>{let h=x&&(x==null?void 0:x.length)>0&&(x==null?void 0:x.find(k=>{var V;return Number((V=k==null?void 0:k.latestDocument)==null?void 0:V.imei)===Number(G)}));re(h)},[x,G]),c.useEffect(()=>{fe(go(C,G))},[C,G]);const Q=(h,k)=>{const V=`https://www.google.com/maps?q=${h},${k}`;window.open(V,"_blank")},U=h=>{var v,B;let k=(v=h==null?void 0:h.latestDocument)==null?void 0:v.ignition,V=(B=h==null?void 0:h.latestDocument)==null?void 0:B.speed;return k===!0||k===1?V:0},z=[{label:"Vehicle No:",value:u==null?void 0:u.registration_id},{label:"Model:",value:(ae=u==null?void 0:u.vehicle_model)==null?void 0:ae.name},{label:"IMEI No:",value:(H=(M=u==null?void 0:u.imei)==null?void 0:M[0])==null?void 0:H.mac_id},{label:"Chassis No:",value:u==null?void 0:u.chassis_no},{label:"Engine No:",value:u==null?void 0:u.engine_no}],he=[{label:"Customer Name:",value:(q=u==null?void 0:u.user)!=null&&q.us_user?`${u.user.us_user.first_name.charAt(0).toUpperCase()}${u.user.us_user.first_name.slice(1)} ${u.user.us_user.last_name.charAt(0).toUpperCase()}${u.user.us_user.last_name.slice(1)}`:null},{label:"Mobile: ",value:((L=u==null?void 0:u.user)==null?void 0:L.us_user)&&u.user.us_user.mobile},{label:"Date of Sell:",value:u==null?void 0:u.sell_date},{label:"Workshop Name:",value:(Y=u==null?void 0:u.workshop)==null?void 0:Y.name}];let R={border:"2px solid black",borderRadius:"5px",padding:"5px",color:"black"};const ge=h=>{let k=C.find(v=>{var B,ie;return((B=v==null?void 0:v.imei)==null?void 0:B.length)>0&&((ie=v.imei[0])==null?void 0:ie.mac_id)==h.imei}),V=parseFloat((k==null?void 0:k.load_capacity)||0)/49*parseFloat((h==null?void 0:h.analogInput1)||0);return`${parseFloat(V).toFixed(2)} Kgs`||0};return o.jsxs(w,{sx:{position:"absolute",top:"600px",left:I?"280px":"450px",zIndex:1,background:Te.bgShadow,p:2,borderRadius:2,color:"white",width:"72%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[o.jsx(Z,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),o.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[o.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",width:"100%",marginLeft:"10px"},children:[o.jsx(w,{sx:R,children:o.jsxs(Z,{children:["Ignition:"," ",((ee=a==null?void 0:a.latestDocument)==null?void 0:ee.ignition)===!0||((te=a==null?void 0:a.latestDocument)==null?void 0:te.ignition)===1?"On":"Off"]})}),o.jsx(w,{sx:R,children:o.jsxs(Z,{children:["Speed: ",U(a)," km/h"]})}),o.jsx(w,{sx:R,children:o.jsxs(Z,{children:["Main Voltage:"," ",a?`${(T=a==null?void 0:a.latestDocument)==null?void 0:T.mainInputVoltage} Voltage`:0]})}),o.jsx(w,{sx:R,children:o.jsxs(Z,{children:["Heading:"," ",a?`${(K=a==null?void 0:a.latestDocument)==null?void 0:K.heading} deg`:0]})}),a&&((ce=a==null?void 0:a.latestDocument)==null?void 0:ce.venderId)==="VT200"&&o.jsx(w,{sx:R,children:o.jsxs(Z,{children:["Load:"," ",a?ge(a==null?void 0:a.latestDocument):0]})}),a&&((le=a==null?void 0:a.latestDocument)==null?void 0:le.venderId)==="VT200"&&o.jsx(w,{sx:R,children:o.jsxs(Z,{children:["Remaining fuel:"," ","0 Ltr"]})}),o.jsxs(pe,{disabled:!a,onClick:()=>{var h,k;Q((h=a==null?void 0:a.latestDocument)==null?void 0:h.lat,(k=a==null?void 0:a.latestDocument)==null?void 0:k.lng)},children:["Navigate to map",o.jsx(We,{})]}),o.jsxs(pe,{disabled:!a,onClick:()=>{O()},children:["Share live location",o.jsx(Ge,{})]})]}),o.jsx(Fe,{sx:{cursor:"pointer",color:"black"},onClick:b})]}),o.jsxs(w,{sx:{display:"flex",justifyContent:"space-between"},children:[o.jsx(Oe,{title:"Vehicle Details",details:z}),o.jsx(Oe,{title:"Customer Details",details:he})]})]})}var Re={},ho=Ce;Object.defineProperty(Re,"__esModule",{value:!0});var He=Re.default=void 0,xo=ho(Me()),yo=o;He=Re.default=(0,xo.default)((0,yo.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");const bo="https://cc.wikitrak.in/proxy-3031",mo="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function ko({showCard:b,loadingVehicle:x,vehicleData:O}){const{center:I,selectedParameterList:C,selectedVehicle:m,vehicleList:G,zoom:u,icons:fe,locationData:a,placesData:re,imeiNumbers:Q,selectedImei:U,onlineVehicle:z,loading:he,services_loading:R}=ne(e=>e.liveMap),{mode:ge,styles:ae,vehicles_details:M}=ne(e=>e.dashboard),H=c.useRef(null),{collapsed:q}=ne(e=>e.auth),[L,Y]=c.useState(null),[ee,te]=c.useState(""),[T,K]=c.useState([]),[ce,le]=c.useState(),[h,k]=c.useState(null);c.useState("");const[V,v]=c.useState(),[B,ie]=c.useState(!1),[F,xe]=c.useState(null),[ye,i]=st.useState(!1),[p,$]=c.useState(""),X=async()=>{var e;if(!U)return se.error("Please select vehicle");try{const t=await ut.post(`${bo}/api/generate-token`,{vehicleNo:U});if((e=t==null?void 0:t.data)!=null&&e.token){const n=`http://cc.wikitrak.in/live-location/${U}/${t.data.token}`;$(n),i(!0)}}catch(t){se.error("Error occurred while generating link"),i(!1),$(!1),console.error("Error generating link",t)}},J=()=>{X()},l=()=>{i(!1)},j=Be(),E={},W=c.useRef([]),S=c.useRef(null),N=c.useRef({}),{isLoaded:ue,loadError:be}=St({googleMapsApiKey:`${mo}`,loadingElement:o.jsx(mt,{})});c.useEffect(()=>{ue&&Y(window.google.maps)},[ue]),c.useEffect(()=>{},[u]),c.useEffect(()=>{var e,t,n,s;if(Object.keys(m).length>0){const r=(F==null?void 0:F.length)>0?F:a,d=r==null?void 0:r.filter(f=>{var g;return((g=f==null?void 0:f.latestDocument)==null?void 0:g.imei)===(m==null?void 0:m.imei)});if((d==null?void 0:d.length)>0){K(d);const f={lat:(t=(e=d[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(s=(n=d[0])==null?void 0:n.latestDocument)==null?void 0:s.lng};j(Se(f))}}},[a,m]),c.useEffect(()=>{var e,t,n,s;if(Object.keys(m).length>0){const r=(F==null?void 0:F.length)>0?F:a,d=r==null?void 0:r.filter(f=>{var g;return((g=f==null?void 0:f.latestDocument)==null?void 0:g.imei)===(m==null?void 0:m.imei)});if((d==null?void 0:d.length)>0){K(d);const f={lat:(t=(e=d[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(s=(n=d[0])==null?void 0:n.latestDocument)==null?void 0:s.lng};j(Se(f))}}else{const r=a==null?void 0:a.filter(d=>O.some(f=>f.value===d.latestDocument.imei));K(r),xe(r)}},[a,m]),c.useEffect(()=>{le(C)},[C]),c.useEffect(()=>{j(rt({}))},[m]),c.useEffect(()=>{if(console.log("before: ",T),!L)return;const e=S.current;let t=null;return(async()=>{console.log("after: ",T);const s=await me(T,e);t&&t.clearMarkers(),t=qe(s,e),Ie.on("locationinfo",r=>{Ke(r,W),xe(d=>{const f=Array.isArray(d)?d:[],g=f.findIndex(y=>Number(y.latestDocument.imei)===Number(r.imei));if(g!==-1){const y=[...f];return y[g]={...y[g],latestDocument:{...y[g].latestDocument,...r}},y}else return[...f,{_id:r.imei,latestDocument:r}]})})})(),()=>{t&&t.clearMarkers(),Object.keys(N.current).forEach(s=>cancelAnimationFrame(N.current[s])),Ie.off("locationinfo")}},[L,T,Ie,ce,W,a]);const me=(e,t)=>e.map(n=>{const s=n.latestDocument.imei,r=W.current[s]||ke(n,t);return W.current[s]&&ve(n,r),r}),ke=(e,t)=>{const n=e.latestDocument.imei,s=new L.Marker({position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},map:t,icon:_e(e)});return s.addListener("click",()=>ze(e,s,t)),W.current[n]=s,s},ve=async(e,t)=>{var g;const n=t.getPosition(),s=((g=t.getIcon())==null?void 0:g.rotation)||0,r={lat:e.latestDocument.lat,lng:e.latestDocument.lng},d=e.latestDocument.heading||0;Ve(t,n,r,s,d);const f=await _e(e);t.setIcon(f)},_e=async e=>{var g,y,_,A,D;const t=(g=e==null?void 0:e.latestDocument)==null?void 0:g.imei,n=Xe(t),s=Ze(e==null?void 0:e.latestDocument,n),r=((y=e==null?void 0:e.latestDocument)==null?void 0:y.heading)||0;return De((_=e==null?void 0:e.latestDocument)==null?void 0:_.imei)&&Pe((A=e==null?void 0:e.latestDocument)==null?void 0:A.imei),{url:await Ue(s,r),fillOpacity:2,strokeWeight:1,scale:12,rotation:(D=e==null?void 0:e.latestDocument)==null?void 0:D.heading}},De=e=>z.includes(Number(e)),Pe=e=>a==null?void 0:a.some(t=>Number(t.latestDocument.imei)===Number(e)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),Ue=(e,t,n,s=50,r=40,d=45)=>{const f=`${e}-${t}-${s}-${n}-${r}-${d}`;if(E[f])return Promise.resolve(E[f]);const g=document.createElement("canvas"),y=g.getContext("2d");g.width=s,g.height=s;const _=new Image;return _.src=e,new Promise(A=>{_.onload=()=>{y.clearRect(0,0,g.width,g.height),y.translate(s/2,s/2),y.rotate(t*Math.PI/180),y.translate(-s/2,-s/2);const D=(s-r)/2,de=(s-d)/2;if(y.drawImage(_,D,de,r,d),n){const we=s-10-5,nt=s-10-5;y.beginPath(),y.arc(we,nt,10/2,0,Math.PI*2),y.fillStyle=n,y.fill()}const oe=g.toDataURL("image/png");E[f]=oe,A(oe)},_.onerror=D=>{console.error("Error loading image for rotation:",D),A(e)}})},ze=(e,t,n)=>{et(e.latestDocument._id,e,t,n),tt(e.latestDocument.imei)},Ve=(e,t,n,s,r)=>{const f=performance.now(),g=()=>{const y=performance.now()-f,_=Math.min(y/500,1),A=t.lat()+_*(n.lat-t.lat()),D=t.lng()+_*(n.lng-t.lng()),de=(r-s+360)%360-180,oe=(s+de*_+360)%360;e.setPosition({lat:A,lng:D});const P=e.getIcon();P&&typeof P=="object"&&e.setIcon({...P,rotation:oe}),_<1?N.current[e.getPosition()]=requestAnimationFrame(g):(e.setPosition(n),P&&typeof P=="object"&&e.setIcon({...P,rotation:r}),delete N.current[e.getPosition()])};N.current[e.getPosition()]=requestAnimationFrame(g)},qe=(e,t)=>new It({map:t,markers:e,renderer:{render:({count:n,position:s})=>Ye(n,s)}}),Ye=(e,t)=>{const n=40+Math.min(e*2,40),s=30;let r;return e<10?r={start:"#76c7c0",end:"#34a853"}:e<50?r={start:"#fbbc05",end:"#f2994a"}:r={start:"#f45c42",end:"#d32f2f"},new L.Marker({position:t,icon:{url:`data:image/svg+xml,${encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 100 100">
            <defs>
              <radialGradient id="gradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="${r.start}" />
                <stop offset="100%" stop-color="${r.end}" />
              </radialGradient>
              <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0, 0, 0, 0.5)" />
              </filter>
            </defs>
            <!-- Outer Pulsating Ring -->
            <circle cx="50" cy="50" r="48" fill="url(#gradient)" filter="url(#shadow)" stroke="#ffffff" stroke-width="3" />
            <!-- Decorative Inner Ring -->
            <circle cx="50" cy="50" r="38" fill="none" stroke="#ffffff" stroke-width="2" stroke-dasharray="4 2" />
            <!-- Star Decoration -->
            <polygon points="50,15 54,38 70,38 57,50 62,68 50,57 38,68 43,50 30,38 46,38" fill="#ffffff" opacity="0.4" />
            <!-- Count Text -->
            <text x="50" y="55" font-size="${s}" fill="black" text-anchor="middle" font-family="'Courier New', monospace" font-weight="bold">
              ${e}
            </text>
          </svg>
        `)}`,scaledSize:new L.Size(n,n)},label:null})},Ke=async(e,t,n)=>{var d;const s=e.imei,r=t.current[s];if(r){const f=r.getPosition(),g=((d=r.getIcon())==null?void 0:d.rotation)||0,y={lat:e.lat,lng:e.lng},_=e.heading||0;Ve(r,f,y,g,_);const A=await _e({latestDocument:e});if(r.setIcon(A),U==(e==null?void 0:e.imei)){console.log("selected imei",U,e.imei);const D=S.current.getBounds();D&&!D.contains(y)&&S.current.panTo(y)}}},Xe=e=>{if(!e)return"motorBike";const t=Je(e);return t||console.error(`No vehicle type found for IMEI: ${e}, defaulting to motorBike`),t||"motorBike"},Je=e=>{if(!M||M.length===0)return console.error("vehicles_details is not available"),null;const t=M.find(n=>(n==null?void 0:n.value)===e&&(n==null?void 0:n.vehilce_type));return t||console.error(`No vehicle found for IMEI: ${e}`),t?t.vehilce_type:null},Ze=(e,t)=>{let{speed:n,ignition:s,imei:r}=e,d=De(r);const f={"2W":{red:Ct,green:Mt,yellow:Lt,black:$t},"3W":{red:Rt,green:Vt,yellow:Et,black:Nt},"4W":{red:At,green:Ot,yellow:Tt,black:Bt},Tractor:{red:Qt,green:Ft,yellow:Wt,black:Gt},Harvestor:{red:Ht,green:Pt,yellow:Ut,black:zt},BUS:{red:qt,green:Yt,yellow:Kt,black:Xt},default:{red:je,green:je,yellow:je,black:je}};let g=f[t]||f.default;if(!d)return g.black;if(d&&!s)return g.red;if(d&&s&&n>0)return g.green;if(d&&s&&n<=0)return g.yellow},Qe=e=>{console.log("packet and type",e);let{speed:t,ignition:n,imei:s}=e;console.log("speed",t,n,s);let r=De(s);if(console.log("isONline",r),!r)return"Offline";if(r&&!n)return"Online";if(r&&n&&t>0)return"Running";if(r&&n&&t<=0)return"Idle"},et=(e,t,n,s)=>{var _,A,D,de;let r=at(new Date((_=t==null?void 0:t.latestDocument)==null?void 0:_.Date)).format("DD-MM-YYYY HH:mm");j(lt(t.latestDocument.imei));const d={lat:(A=t==null?void 0:t.latestDocument)==null?void 0:A.lat,lng:(D=t==null?void 0:t.latestDocument)==null?void 0:D.lng};j(Se(d)),j(ct(15)),H.current||(H.current=new L.InfoWindow);const f=H.current,y=`
      <div>
        <h3>Registration No: ${((de=G.find(oe=>{var P,we;return((P=oe==null?void 0:oe.imei[0])==null?void 0:P.mac_id)===((we=t==null?void 0:t.latestDocument)==null?void 0:we.imei)}))==null?void 0:de.registration_id)||""}</h3>
        <h3>Status:${Qe(t==null?void 0:t.latestDocument)}</h3>
        <h3>Last updated time:${r}</h3>
      </div>
    `;h===e?(f.close(),k(null)):(f.setContent(y),f.open(s,n),k(e))},tt=e=>{const t=M&&(M==null?void 0:M.length)>0&&M.find(n=>(n==null?void 0:n.value)===e&&n);v(t||null)},Ee=()=>{ie(!B)};if(be)return"Error loading maps";if(!ue)return"Loading maps";if(!L)return null;const ot={height:"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return o.jsxs(o.Fragment,{children:[o.jsx(w,{sx:{position:"absolute",top:"780px",left:q?"74px":"250px",zIndex:1,background:Te.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:o.jsxs(pe,{sx:{color:"white"},onClick:Ee,children:[B?"Hide":"Show"," Vehicle Info",o.jsx(Jt,{})]})}),B===!0&&o.jsx(po,{handleVehicleInfo:Ee,udpatedParams:F,handleClickOpen:J}),o.jsxs(_t,{id:"map",mapContainerStyle:ot,zoom:u,center:I,onLoad:e=>{S.current=e},options:{styles:ge?ae:""},children:[Object.keys(m).length>0&&o.jsx(kt,{setPlace:te,place:ee}),R||x?o.jsx(w,{sx:{position:"absolute",top:"50%",left:"50%"},children:o.jsx(Zt,{})}):re&&re.length>0&&re.map((e,t)=>{var n,s;return o.jsx(Dt,{position:{lat:parseFloat((n=e==null?void 0:e.location)==null?void 0:n.lat),lng:parseFloat((s=e==null?void 0:e.location)==null?void 0:s.lng)},animation:window.google.maps.Animation.DROP,icon:{path:fe[`${ee}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},t)}),o.jsx(vo,{open:ye,shareLink:p,handleClose:l})]})]})}const vo=({open:b,handleClose:x,shareLink:O})=>{c.useState("");const I=c.useRef(null);c.useEffect(()=>{},[]);const C=()=>{const m=I.current;m?(m.select(),m.setSelectionRange(0,99999),document.execCommand("copy")?se.success("Text copied!"):se.error("Failed to copy!"),window.getSelection().removeAllRanges()):se.error("Failed to copy! No input found.")};return o.jsxs(eo,{onClose:x,"aria-labelledby":"customized-dialog-title",open:b,fullWidth:!0,maxWidth:"lg",children:[!1,o.jsxs(to,{sx:{m:0,p:2},id:"customized-dialog-title",children:["Vehicle live location link",o.jsx(it,{"aria-label":"close",onClick:x,sx:m=>({position:"absolute",right:8,top:8,color:m.palette.grey[500]}),children:o.jsx(Fe,{})})]}),o.jsx(oo,{dividers:!0,children:o.jsxs(w,{display:"flex",alignItems:"center",gap:2,mt:1,children:[o.jsx(so,{fullWidth:!0,variant:"outlined",inputRef:I,value:O,onChange:m=>{},sx:{flex:9}}),o.jsx(pe,{variant:"outlined",onClick:C,startIcon:o.jsx(He,{}),sx:{flex:1,minWidth:"auto"},children:"Copy"})]})}),o.jsx(no,{children:o.jsx(pe,{onClick:x,children:"Close"})})]})};function Qo(){const{locationData:b,selectedVehicle:x,selectedParameterList:O,onlineVehicle:I}=ne(i=>i.liveMap),{mode:C,selectedVehicleGroup:m}=ne(i=>i.dashboard),G=bt(C),[u,fe]=c.useState([]),[a,re]=c.useState(""),[Q,U]=c.useState(""),[z,he]=c.useState(""),[R,ge]=c.useState(""),{w_customer_id:ae}=ne(i=>i.auth),[M,H]=c.useState(),[q,L]=c.useState(!1),[Y,ee]=c.useState(!1),[te,T]=c.useState([]),[K,ce]=c.useState(!0),[le,h]=c.useState(!1),[k,V]=c.useState(!1);let v=Be();c.useEffect(()=>{v(dt({}))},[]),c.useEffect(()=>{B()},[]),c.useEffect(()=>{var i;if(Object.keys(x).length>0){const p=(b==null?void 0:b.length)>0&&(b==null?void 0:b.filter(l=>Number(l.latestDocument.imei)===Number(x==null?void 0:x.imei)));if((p==null?void 0:p.length)<=0){se.error("Data not available for this vehicle",{id:"clipboard"});return}const{lat:$,lng:X}=((i=p==null?void 0:p[0])==null?void 0:i.latestDocument)??{},J={lat:$||Ae.lat,lng:X||Ae.lat};v(Se(J))}},[x,b]),c.useEffect(()=>{T([]),v(Ne([{reg_id:"",imei:"",params:[]}]))},[x]);const B=async()=>{try{h(!0);let i=[],p=[];const $=await v(ft({w_customer_id:ae}));if(Array.isArray($.payload)){$.payload.forEach(l=>{var j,E,W,S;Array.isArray(l.imei)&&l.imei.length>0&&((j=l.imei[0])!=null&&j.mac_id)?(i.push({id:l.id,label:l.registration_id,value:(E=l.imei[0])==null?void 0:E.mac_id,vehilce_type:l==null?void 0:l.segment,chassis_no:l==null?void 0:l.chassis_no,engine_no:l==null?void 0:l.engine_no,workShop:l==null?void 0:l.workshop,registration_id:l==null?void 0:l.registration_id,sell_date:l==null?void 0:l.sell_date,customer_name:l==null?void 0:l.customer_name,vehicle_model:(W=l==null?void 0:l.vehicle_model)==null?void 0:W.name,vehicle_group:l==null?void 0:l.vehicle_group}),p.push((S=l.imei[0])==null?void 0:S.mac_id)):console.error("IMEI data not found for item:",l)});const X="one",J=p;p.length>0&&v(gt({type:X,imei:J})),fe(i),v(pt(i)),v(ht({w_customer_id:ae})),h(!1)}else h(!1),console.error("Unexpected data format:",$),se.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),se.error(`Error fetching vehicle data: ${i}`)}},ie=async i=>{const{label:p,imei:$,id:X,reg_id:J,checked:l}=i;H(S=>S.map(N=>N.id===X?{...N,checked:!l}:N));let j=[...te],E=[...te];if(!l)b.forEach(S=>{S.latestDocument.imei===$&&(j.push({label:p,value:S.latestDocument[p==="maininputvoltage"?"mainInputVoltage":p]}),E=j,T(j))});else{let S=te.filter(N=>N.label!==p);E=S,T(S)}v(Ne([{reg_id:J,imei:$,params:E}]))},F=i=>b==null?void 0:b.some(p=>Number(p.latestDocument.imei)===Number(i)&&p.latestDocument.speed>0&&(p.latestDocument.ignition===!0||p.latestDocument.ignition===1)),xe=i=>b==null?void 0:b.some(p=>Number(p.latestDocument.imei)===Number(i)&&p.latestDocument.speed<=0&&(p.latestDocument.ignition===!0||p.latestDocument.ignition===1)),ye=u.filter(i=>{var ue,be,me,ke,ve;if(!(Object.keys(m).length===0||i.vehicle_group===m.id))return!1;const $=(ue=i==null?void 0:i.label)==null?void 0:ue.toLowerCase().includes(a.toLowerCase()),X=R===""||((be=i==null?void 0:i.workShop)==null?void 0:be.region)===R,J=z===""||((ke=(me=i==null?void 0:i.workShop)==null?void 0:me.state)==null?void 0:ke.toLowerCase())===(((ve=z==null?void 0:z.toString())==null?void 0:ve.toLowerCase())||""),l=Number(i.value),j=I.includes(l),E=!j,W=j&&F(l),S=j&&xe(l);return $&&X&&J&&(Q==="online"?j:Q==="offline"?E:Q==="running"?W:Q==="idling"?S:!0)}).sort((i,p)=>i.label.localeCompare(p.label));return o.jsxs("div",{className:"app",children:[o.jsx(wt,{}),o.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[o.jsx(xt,{title:"Live Map",setShowVehicles:L,showVehicles:q,showParameters:Y,setShowParameters:ee,setShowCard:ce,showCard:K,setShowVehiclesGroup:V,showVehiclesGroup:k}),o.jsx(jt,{setShowVehiclesGroup:V,showVehiclesGroup:k,where:"livemap"}),o.jsxs(w,{style:{display:"flex",width:"100%",height:"95vh"},children:[o.jsx(w,{style:{width:q||Y?"80%":"100%"},children:o.jsx(ko,{showCard:K,loadingVehicle:le,vehicleData:ye})}),q&&o.jsx(w,{style:{width:"20%",backgroundColor:G.grey[100]},children:o.jsx(yt,{vehicleData:ye,title:"Live Map",setParameterData:H,loadingVehicle:le,setShowVehicles:L,showVehicles:q,showParameters:Y,setShowParameters:ee,setSearchedTerm:re,setOptions:U,setState:he,setRegion:ge,searchTerm:a,options:Q,state:z,region:R})}),Y&&o.jsx(w,{style:{width:"20%",backgroundColor:G.grey[100]},children:o.jsx(vt,{parametersData:M,setParameterData:H,handleParameterChange:ie})})]})]})]})}export{Qo as default};
