import{j as s,F as y,y as z,z as D,b as h,I as V,au as Y,bd as N,be as X,bc as J,C as j,a7 as K,aX as Q,ap as Z}from"./index-BCNNrgRv.js";import{D as ee,a as se,b as ae,c as te}from"./DialogTitle-B0P_gQhv.js";import{D as oe,E as ne,T as L}from"./Edit-CmAUlqxV.js";import{B as $}from"./CircularProgress-DrkFh5Zn.js";import{T as re,a as ce,b as le,c as A,d as u,e as ie}from"./TableRow-CsUfKaNK.js";import{T as ue}from"./TablePagination-Da7zdAs1.js";const de=({open:r,onClose:i,onConfirm:x})=>s.jsxs(ee,{open:r,onClose:i,children:[s.jsx(se,{children:"Confirm Deletion"}),s.jsx(ae,{children:s.jsxs(oe,{children:["Are you sure you want to delete this vehicle data?"," ",s.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),s.jsxs(te,{children:[s.jsx(y,{onClick:i,color:"primary",children:"Cancel"}),s.jsx(y,{onClick:x,color:"secondary",children:"Delete"})]})]}),pe="http://134.209.145.234/api/v1",he={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},xe=({inspectionData:r})=>{const i=z(),{isUpdateInspection:x}=D(c=>c.inspection),[g,f]=h.useState(!1),p=()=>{console.log("inspectionData",r);const c=localStorage.getItem("role");Y.includes(c)?(i(N(!x)),i(X(r)),i(J(r))):j.error(`Sorry! Your role is ${c}. You're not allowed to add, edit or delete the vehicle`)},_=async()=>{console.log("Vehicle data deleting");try{await K.delete(`${pe}/vehicles/delete/${vehicleData.id}/`),j.success("Vehicle data deleted successfully!"),i(Q())}catch(c){console.error("Error deleting vehicle data:",c),j.error("Failed to delete vehicle data. Please try again.")}f(!1)},b=()=>{f(!1)},C={color:"#686868"};return s.jsxs($,{sx:he,children:[s.jsx(V,{onClick:p,children:s.jsx(ne,{sx:C})}),s.jsx(de,{open:g,onClose:b,onConfirm:_})]})},ge=[{id:"BDID",label:"BDID"},{id:"User",label:"User"},{id:"SubmissionDate",label:"Submission Date"},{id:"WorkshopGroup",label:"Workshop Group"},{id:"Status",label:"Status"}],be=({where:r})=>{const{breakdowns:i}=D(e=>e.breakdown),{searchTerm:x}=D(e=>e.inspection),[g,f]=h.useState("asc"),[p,_]=h.useState("BDID"),[b,C]=h.useState(0),[c,R]=h.useState(5),[U,fe]=h.useState({id:"",status:"",workshop:"",user:""}),O=e=>{f(p===e&&g==="asc"?"desc":"asc"),_(e)},E=(e,t)=>{C(t)},F=e=>{R(parseInt(e.target.value,10)),C(0)},M=(e,t,l)=>e.filter(a=>{var B,S,I,T,w,P,v;const o=l.toLowerCase(),n=(B=a==null?void 0:a.breakdown_id)==null?void 0:B.toLowerCase().includes(o),d=`${(I=(S=a==null?void 0:a.user)==null?void 0:S.us_user)==null?void 0:I.first_name} ${(w=(T=a==null?void 0:a.user)==null?void 0:T.us_user)==null?void 0:w.last_name}`.toLowerCase().includes(o),H=(P=a==null?void 0:a.status)==null?void 0:P.toLowerCase().includes(o),q=(v=a==null?void 0:a.workshop_group)==null?void 0:v.group_name.toLowerCase().includes(o);return!(l&&!(n||d||H||q)||t.id&&!a.breakdown_id.includes(t.id)||t.status&&a.status!==t.status||t.workshop&&a.workshop_group.group_name!==t.workshop||t.user&&!a.user.us_user.first_name.toLowerCase().includes(t.user.toLowerCase())&&!a.user.us_user.last_name.toLowerCase().includes(t.user.toLowerCase()))}),W=(e,t,l,a)=>{if(a==="User"){const o=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),n=`${t.user.us_user.first_name} ${t.user.us_user.last_name}`.toLowerCase();return l==="asc"?o.localeCompare(n):n.localeCompare(o)}if(a==="WorkshopGroup"){const o=e.workshop_group.group_name.toLowerCase(),n=t.workshop_group.group_name.toLowerCase();return l==="asc"?o.localeCompare(n):n.localeCompare(o)}if(a==="BDID"){const o=parseInt(e.breakdown_id.replace("BD-",""),10),n=parseInt(t.breakdown_id.replace("BD-",""),10);return l==="asc"?o-n:n-o}if(a==="SubmissionDate"){const o=new Date(e.submission_date),n=new Date(t.submission_date);return l==="asc"?o-n:n-o}if(a==="Status"){const o={Open:1,Close:2,Rejected:3},n=o[e.status]||0,d=o[t.status]||0;return l==="asc"?n-d:d-n}return 0},k=M(i.slice(),U,x).sort((e,t)=>W(e,t,g,p)),G=k.slice(b*c,b*c+c),m={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};return s.jsx($,{sx:{m:r!=="inspection report"&&"10px",width:r==="inspection report"?"60%":"99%"},children:s.jsxs(Z,{children:[s.jsx(re,{sx:{height:r==="inspection report"?"50vh":"60vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(ce,{stickyHeader:!0,children:[s.jsx(le,{children:s.jsxs(A,{children:[ge.map(e=>s.jsx(u,{sx:m,children:s.jsx(L,{active:p===e.id,direction:p===e.id?g:"asc",onClick:()=>O(e.id),children:e.label})},e.id)),r!=="inspection report"&&s.jsx(u,{sx:m,children:s.jsx(L,{children:"Actions"})})]})}),s.jsx(ie,{children:G.map((e,t)=>{var l,a,o,n,d;return s.jsxs(A,{children:[s.jsx(u,{children:e==null?void 0:e.breakdown_id}),s.jsx(u,{children:`${(a=(l=e==null?void 0:e.user)==null?void 0:l.us_user)==null?void 0:a.first_name} ${(n=(o=e==null?void 0:e.user)==null?void 0:o.us_user)==null?void 0:n.last_name}`}),s.jsx(u,{children:e.submission_date||"N/A"}),s.jsx(u,{children:(d=e==null?void 0:e.workshop_group)==null?void 0:d.group_name}),s.jsx(u,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),r!=="inspection report"&&s.jsx(u,{children:s.jsx(xe,{inspectionData:e})})]},t)})})]})}),s.jsx(ue,{component:"div",count:k.length,page:b,onPageChange:E,rowsPerPage:c,onRowsPerPageChange:F,rowsPerPageOptions:[5,10,15]})]})})},Be=be;export{Be as I};
