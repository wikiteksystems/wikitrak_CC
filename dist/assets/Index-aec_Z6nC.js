import{l as we,o as De,p as ve,_ as ne,b as o,q as Ce,f as Me,j as t,g as Ae,k as be,a8 as xe,x as fe,y as Y,ae as Te,af as ke,ag as P,L as _,T as m,F as B,ah as oe,ai as _e,aj as Ye,ak as pe,al as he,B as K,am as ue,C as ge,an as Ie,Y as Le,$ as Ne,a0 as Oe,a3 as Ve}from"./index-B5aO5-3M.js";import{L as Ee}from"./LeftSideBar2-BCsHrNIj.js";import{L as Re}from"./LiveMapTopBar-7eY7d6ch.js";import{V as Be}from"./VehicleMenu-BjJRc2UX.js";import{T as Pe}from"./TripMap-BE9zlfuQ.js";import{D as $e}from"./DateTimePicker-B3YzG-8u.js";import{r as me}from"./createSvgIcon-DsBawmhq.js";import{t as Se}from"./Search-CSqd9aEB.js";import{B as d,C as Fe}from"./CircularProgress-CjHKMZJO.js";import{M as qe}from"./OutlinedInput-Pp-d-9jE.js";import{C as Ge}from"./Card-C2IirYtS.js";import{C as Ue}from"./CardContent-cYF5dkK-.js";import"./TripGraph-Y7p-jBq6.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as ze}from"./VehicleGroups-CMv38Bn6.js";import"./menu2-gypHyKoT.js";import"./Paper-DoBoVvcV.js";import"./IconButton-D-UN0Mj3.js";import"./Tooltip-Bl0hPFn3.js";import"./Close-C5HYBR3U.js";import"./index-C-Qr_kcW.js";import"./roundedArrow-DAhbUsjQ.js";import"./TextArea-CPSt_V00.js";import"./RegionSelector-CaPsGXws.js";import"./SearchTab-DJMEwZfw.js";import"./InputAdornment-UiuQ1oI1.js";import"./Select-B3xCQ8c6.js";import"./MenuItem-CzdKe1ex.js";import"./Autocomplete-CIeaT7yK.js";import"./usePreviousProps-C7EYvWVQ.js";import"./TextField-CZWDmGXe.js";import"./esm-LGdvgvu2.js";import"./redTractor-NXgVJyvR.js";import"./Info-vf-ms0X_.js";import"./button-h-4JHXPz.js";import"./useIcons-D6XAWE7P.js";import"./SearchOutlined-Box3-iLp.js";function He(a){return we("MuiCardActions",a)}De("MuiCardActions",["root","spacing"]);const We=["disableSpacing","className"],Xe=a=>{const{classes:D,disableSpacing:S}=a;return be({root:["root",!S&&"spacing"]},He,D)},Je=ve("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(a,D)=>{const{ownerState:S}=a;return[D.root,!S.disableSpacing&&D.spacing]}})(({ownerState:a})=>ne({display:"flex",alignItems:"center",padding:8},!a.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Ke=o.forwardRef(function(D,S){const v=Ce({props:D,name:"MuiCardActions"}),{disableSpacing:u=!1,className:j}=v,I=Me(v,We),h=ne({},v,{disableSpacing:u}),g=Xe(h);return t.jsx(Je,ne({className:Ae(g.root,j),ownerState:h,ref:S},I))}),Qe=Ke;var ie={},Ze=xe;Object.defineProperty(ie,"__esModule",{value:!0});var je=ie.default=void 0,et=Ze(me()),tt=t;je=ie.default=(0,et.default)((0,tt.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var ce={},st=xe;Object.defineProperty(ce,"__esModule",{value:!0});var ye=ce.default=void 0,rt=st(me()),at=t;ye=ce.default=(0,rt.default)((0,at.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const ot=()=>{var n,f,M,A;const a=fe(),{tripList:D,selectedTripData:S,loading:v,trips:u,activeIndex:j,searchText:I,mode:h,isNavigate:g,allTripList:l,trip_payload:L,page:y,total_page:N,total_trips:Q}=Y(e=>e.dashboard),{selectedVehicle:O}=Y(e=>e.liveMap),w=Se(h),[$,F]=o.useState(!1),[i,q]=o.useState({}),[C,G]=o.useState(""),[k,U]=o.useState(null);o.useEffect(()=>{(u==null?void 0:u.length)>0},[u]),o.useEffect(()=>{const e=le(l);a(Te(e))},[l]),o.useEffect(()=>{!(S.length>0)&&g&&j!==null&&x.length>0&&Z(x[j])},[S,g]);const Z=async e=>{var p;let r={imei:O.imei,startDate:e.startDate,endDate:e.endDate};const c=await ke(r);((p=c==null?void 0:c.data)==null?void 0:p.documents.length)>0?(a(g(!1)),a(P(c.data.documents[0].data))):(a(g(!1)),a(P([])))},le=e=>{const r=new Set,c=[];return e.forEach(p=>{const T=_(p.startTime).format("YYYY-MM-DD");r.has(T)||(r.add(T),c.push(T))}),c},z=(e,r)=>{a(oe(null)),a(_e(e)),a(Ye(!1)),C===e?(G(""),U(null)):(G(e),U(r))},x=C===""?l:l.filter(e=>_(e.startTime).format("YYYY-MM-DD")===C),H=async(e,r)=>{a(P(r.data)),a(oe(e)),a(pe(r.tripAcreage))},b=e=>{q(e),F(!0)},W=()=>{F(!1),q({})},X=e=>e?e.split(" ").slice(0,2).join(" "):"",ee=async()=>{const e={...L,page:y+1,limit:20};try{(await a(he(e))).error?K.error("No Trip! within selected date"):a(ue(y+1))}catch{K.error("No Trip! within selected date")}},te=()=>{if(y<=1)return;const e={...L,page:y-1,limit:20};a(ue(y-1)),a(he(e))},s=e=>{let r=e==null?void 0:e.reduce((c,p)=>c+p.tripAcreage,0);console.log("merged array",r),a(P([])),a(oe("all")),a(pe(r))};return t.jsxs(t.Fragment,{children:[t.jsxs(d,{children:[t.jsxs(d,{sx:{m:"10px"},children:[t.jsx(d,{sx:{color:w.grey[400]},children:"Select Date"}),t.jsx(d,{sx:{mt:1},children:t.jsx($e,{})})]}),v?t.jsx("div",{style:{width:"100%",margin:"38%"},children:t.jsx(Fe,{})}):t.jsxs(t.Fragment,{children:[t.jsx(d,{children:t.jsx(d,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:l&&(l==null?void 0:l.length)>0?t.jsx(t.Fragment,{}):t.jsx(m,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),l&&(l==null?void 0:l.length)>0&&t.jsxs(d,{ml:2,display:"flex",gap:1,children:[t.jsxs(m,{children:["Total trips:",Q]})," |",t.jsxs(m,{children:["Current page:",y]})," |",t.jsxs(m,{children:["Total page:",N]}),"|"]}),l&&(l==null?void 0:l.length)>0&&t.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",mt:"5px"},children:[t.jsx(B,{disabled:y<=1,onClick:te,children:t.jsx(je,{})}),t.jsx(B,{disabled:N===y||N===0,onClick:ee,children:t.jsx(ye,{})})]}),t.jsxs(d,{sx:{height:"75vh",width:"100%",overflowY:"auto"},children:[t.jsx(d,{display:"flex",gap:1,marginLeft:2,children:u.map((e,r)=>t.jsx(d,{children:t.jsx(B,{onClick:()=>{z(e,r)},style:{backgroundColor:k===r?w.grey[300]:w.grey[200],color:k===r?"black":w.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:e})},r))}),x&&x.length>0&&t.jsx(B,{variant:j==="all"?"contained":"outlined",sx:{width:"90%",mx:"20px",mt:"10px"},onClick:()=>{s(x)},children:"Select All trips"}),"              ",x&&x.length>0&&x.map((e,r)=>{var re,V,E,R;const c=(V=(re=e==null?void 0:e.startLocation)==null?void 0:re.address)==null?void 0:V.address,p=(R=(E=e==null?void 0:e.endLocation)==null?void 0:E.address)==null?void 0:R.address,T=c?`${c.town||c.city||""}`:"",se=p?`${p.town||p.city||""}`:"";return t.jsxs(d,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:j===r?"black":w.grey[400],backgroundColor:j===r?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:h?w.grey[300]:w.grey[200]}},onClick:()=>H(r,e),children:[t.jsxs(m,{sx:{cursor:"text"},children:[r+1,". ",X(T)," to"," ",X(se)," "]}),t.jsxs(m,{children:[e!=null&&e.startTime?_(new Date(e.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",e!=null&&e.endTime?_(new Date(e.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",t.jsx("span",{style:{color:h?"orange":"blue",cursor:"pointer"},onClick:J=>{J.stopPropagation(),b(e)},children:"...see more"})]})]},r)})]})]})]}),t.jsx(qe,{open:$,onClose:W,children:t.jsxs(Ge,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[t.jsxs(Ue,{children:[t.jsx(m,{variant:"h6",component:"div",children:"Trip Details"}),t.jsxs(m,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Location:"})," ",((f=(n=i==null?void 0:i.startLocation)==null?void 0:n.address)==null?void 0:f.display_name)||"N/A"]}),t.jsxs(m,{sx:{mt:2},children:[t.jsx("strong",{children:"End Location:"})," ",((A=(M=i==null?void 0:i.endLocation)==null?void 0:M.address)==null?void 0:A.display_name)||"N/A"]}),t.jsxs(m,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Time:"})," ",i!=null&&i.startTime?_(new Date(i.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),t.jsxs(m,{sx:{mt:2},children:[t.jsx("strong",{children:"End Time:"})," ",i!=null&&i.endTime?_(new Date(i.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),t.jsx(Qe,{children:t.jsx(B,{onClick:W,children:"Close"})})]})})]})},nt=ot;function Ut(){const{w_customer_id:a}=Y(s=>s.auth),{collapsed:D}=Y(s=>s.auth),{mode:S,selectedVehicleGroup:v}=Y(s=>s.dashboard),{vehicleList:u,selectedVehicle:j,onlineVehicle:I,locationData:h}=Y(s=>s.liveMap),[g,l]=o.useState(!1),[L,y]=o.useState(!0),[N,Q]=o.useState([]),[O,w]=o.useState(!0),[$,F]=o.useState(""),[i,q]=o.useState(""),[C,G]=o.useState(""),[k,U]=o.useState("");o.useState([]);const[Z,le]=o.useState({lat:18.516726,lng:73.856255});o.useState([]);const[z,x]=o.useState(!1),H=Se(S);let b=fe();o.useEffect(()=>{b(P([])),W()},[]),o.useEffect(()=>{var f,M,A;const s=ge().subtract(5,"day").startOf("day").toISOString(),n=ge().endOf("day").toISOString();b(Ie({startDate:s,endDate:n})),Object.keys(j).length===0&&u.length>0&&b(Le({imei:(M=(f=u[0])==null?void 0:f.imei[0])==null?void 0:M.mac_id,reg_id:(A=u[0])==null?void 0:A.registration_id}))},[j,u]);const W=async()=>{try{let s=[],n=[];const f=await b(Ne({w_customer_id:a}));if(Array.isArray(f.payload)){f.payload.forEach(e=>{var r,c,p;Array.isArray(e.imei)&&e.imei.length>0&&((r=e.imei[0])!=null&&r.mac_id)?(s.push({id:e.id,label:e.registration_id,value:(c=e.imei[0])==null?void 0:c.mac_id,workShop:e==null?void 0:e.workshop,vehicle_group:e==null?void 0:e.vehicle_group}),n.push((p=e.imei[0])==null?void 0:p.mac_id)):console.error("IMEI data not found for item:",e)});const M="one",A=n;n.length>0&&b(Oe({type:M,imei:A})),b(Ve({w_customer_id:a})),Q(s)}else console.error("Unexpected data format:",f),K.error("Unexpected data format:")}catch(s){console.error("Error fetching vehicle data:",s),K.error(`Error fetching vehicle data: ${s}`)}},X=s=>h==null?void 0:h.some(n=>String(n.latestDocument.imei)===String(s)&&n.latestDocument.speed>0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),ee=s=>h==null?void 0:h.some(n=>String(n.latestDocument.imei)===String(s)&&n.latestDocument.speed<=0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),te=N.filter(s=>{var V,E,R,J,de;if(!(Object.keys(v).length===0||s.vehicle_group===v.id))return!1;const f=(V=s==null?void 0:s.label)==null?void 0:V.toLowerCase().includes($.toLowerCase()),M=k===""||((E=s==null?void 0:s.workShop)==null?void 0:E.region)===k,A=C===""||((J=(R=s==null?void 0:s.workShop)==null?void 0:R.state)==null?void 0:J.toLowerCase())===(((de=C==null?void 0:C.toString())==null?void 0:de.toLowerCase())||""),e=s.value,r=String(s.value).toLowerCase(),c=I.some(ae=>String(ae).toLowerCase()===r),p=!I.some(ae=>String(ae).toLowerCase()===r),T=c&&X(e),se=c&&ee(e);return f&&M&&A&&(i==="online"?c:i==="offline"?p:i==="running"?T:i==="idling"?se:!0)}).sort((s,n)=>s.label.localeCompare(n.label));return t.jsxs("div",{className:"app",children:[t.jsx(Ee,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(Re,{title:"Trip Monitor",setShowVehicles:l,showVehicles:g,setShowCard:y,showCard:L,sideBarTrip:O,setSideBarTrip:w,setShowVehiclesGroup:x,showVehiclesGroup:z}),t.jsx(ze,{setShowVehiclesGroup:x,showVehiclesGroup:z,where:"tripmonitor"}),t.jsxs(d,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(d,{style:{width:g||O?"80%":"100%"},children:t.jsx(Pe,{center:Z,showCard:L})}),g&&t.jsx(d,{style:{width:"20%",backgroundColor:H.grey[100]},children:t.jsx(Be,{vehicleData:te,setShowVehicles:l,showVehicles:g,title:"Live Monitor",setSearchedTerm:F,setOptions:q,setState:G,setRegion:U,searchTerm:$,options:i,state:C,region:k,setSideBarTrip:w})}),t.jsx(d,{style:{width:D?"22%":"20%",display:O?"block":"none",backgroundColor:H.grey[100]},children:t.jsx(nt,{})})]})]})]})}export{Ut as default};
