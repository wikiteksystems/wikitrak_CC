import{a6 as He,j as e,y as v,b as i,x as Q,z as M,B as E,T as O,ar as ge,I as pe,as as gt,at as xt,au as pt,av as ht,aw as ee,J as G,ax as ut,ay as ft,az as ze,a2 as mt,X as wt,Y as jt,$ as bt}from"./index-Bck7KLgI.js";import{b as yt,c as St,w as vt,e as Ct,f as At,L as kt}from"./LeftSideBar2-D-Hyb8kx.js";import{r as Ve}from"./createSvgIcon-tZVvrbBK.js";import{d as Rt}from"./NotificationsNone-CLxM4YAZ.js";import{d as Be}from"./Close-DfZLPeh2.js";import{j as Dt}from"./jcb-aCHXMCXy.js";import{B as o,b as Xe}from"./menu2-CvOBfRqv.js";import{V as Ot}from"./VehicleMenu-BBs8xABB.js";import{G as It}from"./GeofencAlert-B4v5pfw4.js";import{V as Ue,a as Je}from"./Form-BpgdLA6D.js";import{t as Z}from"./SearchTab-BW_NrN2P.js";import{u as Pt,F as Et}from"./formik.esm-B_vpWnfY.js";import{c as Lt,a as Ke,b as Nt}from"./index.esm-Th3qzY-2.js";import{T as Ye,I as _t}from"./TextField-CbEgZzn0.js";import{m as te,t as Ft,f as Te,a as Gt}from"./preet_tractor-CDwt_mVh.js";import{u as Mt,G as Wt,C as zt,P as Bt,M as Xt}from"./esm-C4M5L3kh.js";import{S as xe}from"./Switch-6nujOIRH.js";/* empty css           */import"./proj-XQwXs9DQ.js";import"./useControlled-BpYd-qH_.js";import"./Autocomplete-Bcai9UYY.js";var he={},Ut=He;Object.defineProperty(he,"__esModule",{value:!0});var qe=he.default=void 0,Jt=Ut(Ve()),Kt=e;qe=he.default=(0,Jt.default)((0,Kt.jsx)("path",{d:"M12 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c2.7 0 5.8 1.29 6 2H6c.23-.72 3.31-2 6-2m0-12C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 10c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonOutlined");var ue={},Yt=He;Object.defineProperty(ue,"__esModule",{value:!0});var Qe=ue.default=void 0,Ht=Yt(Ve()),Vt=e;Qe=ue.default=(0,Ht.default)((0,Vt.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"Place");const Tt=({title:s,setShowContent:x,showContent:n,showMap:m,setShowMap:r,setShowGfBar:S,showGfBar:C,setShowGfAlert:d,showGfAlert:j})=>{const{collapsed:b}=v(R=>R.auth),{selectedVehicle:y}=v(R=>R.liveMap),{vehicleSideBar:p}=v(R=>R.geofence);i.useState(!1);const{mode:k}=v(R=>R.dashboard);JSON.parse(localStorage.getItem("w_userDetails"));const h=Q(),I=()=>{h(xt(!b))},D=()=>{x({...n,vehicle:!n.vehicle}),S(!1),d(!1),h(ge({data:!p}))};return e.jsxs(o,{display:"flex",justifyContent:"space-between",p:1,sx:{bgcolor:M.bgColor,border:"1px solid white",borderRadius:"4px",height:"55px"},children:[e.jsxs(o,{style:{display:"flex",justifyContent:"space-between",gap:"10px",alignItems:"center"},children:[b?e.jsx(E,{onClick:I,sx:{color:"white"},children:e.jsx(yt,{style:{width:"30px",height:"30px"}})}):e.jsx(E,{onClick:I,sx:{color:"white"},children:e.jsx(St,{style:{width:"30px",height:"30px"}})}),e.jsx("img",{src:vt,alt:"wikitrak logo"})]}),e.jsx(o,{children:e.jsx(O,{variant:"h6",color:"white",fontWeight:"bold",sx:{ml:"15px",mt:"15px"},children:Object.keys(y).length>0&&m?`${s} - Geofence (${y.reg_id})`:e.jsxs(e.Fragment,{children:[s," ",Object.keys(y).length>0&&y.reg_id]})})}),e.jsxs(o,{sx:{display:"flex"},children:[e.jsxs(E,{variant:"outlined",size:"small",sx:{color:n.vehicle?"white":"black",backgroundColor:n.vehicle?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:D,children:[n.vehicle&&e.jsx(Be,{style:{marginRight:"5px",fontWeight:"bold"}}),e.jsx("img",{src:Dt,style:{marginRight:"5px"}}),Object.keys(y).length>0?y.reg_id:"Vehicles"]}),m&&e.jsx(o,{children:e.jsxs(E,{variant:"outlined",size:"small",sx:{color:C?"white":"black",backgroundColor:C?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:()=>{d(!1),S(!C),h(ge({data:!1}))},children:[C&&e.jsx(Be,{style:{marginRight:"5px",fontWeight:"bold"}}),"Geofence"]})}),e.jsx(o,{sx:{color:"white",mr:"10px"},children:e.jsxs(o,{sx:{display:"flex",marginTop:"14px",gap:"10px"},children:[e.jsx(o,{onClick:()=>{S(!1),d(!j),h(ge({data:!1}))},children:e.jsx(Rt,{sx:{cursor:"pointer",width:"30px",height:"30px"}})}),e.jsx(o,{onClick:()=>{x({...n,user:!n.user}),r(!1)},children:n.user?e.jsx(Qe,{sx:{mr:"2px",cursor:"pointer",width:"30px",height:"30px"}}):e.jsx(qe,{sx:{mr:"2px",cursor:"pointer",width:"30px",height:"30px"}})})]})}),e.jsx(pe,{onClick:()=>{h(gt(!k))},sx:{color:"white"},children:k?e.jsx(Ct,{}):e.jsx(At,{})})]})]})},qt=Tt,Qt=()=>{const s=Q(),x=Pt("(min-width:600px)"),[n,m]=i.useState(!1),[r,S]=i.useState(!1),{mode:C}=v(p=>p.dashboard),d=Z(C),j={new_password:"",confirmPassword:""},b=Lt().shape({new_password:Ke().required("Password is required").min(8,"Password must be at least 8 characters"),confirmPassword:Ke().oneOf([Nt("new_password"),null],"Passwords must match").required("Confirm password is required")}),y=p=>{console.log("values",p);let k=p.confirmPassword;s(pt({new_password:k}))};return e.jsx(o,{sx:{display:"flex",justifyContent:"center"},children:e.jsxs(o,{sx:{width:"30%"},children:[e.jsx(o,{sx:{align:"center"},children:e.jsx(O,{variant:"h5",sx:{mt:"25px",my:"",fontWeight:"bold",align:"center",color:d.grey[400]},children:"Change Password"})}),e.jsx(Et,{onSubmit:y,initialValues:j,validationSchema:b,children:({values:p,errors:k,touched:h,handleBlur:I,handleChange:D,handleSubmit:R})=>e.jsxs("form",{onSubmit:R,children:[e.jsxs(o,{display:"grid",gap:"15px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:x?void 0:"span 4"}},marginTop:"20px",children:[e.jsx(Ye,{fullWidth:!0,variant:"outlined",type:n?"text":"password",label:"New Password",onBlur:I,onChange:D,value:p.new_password,name:"new_password",error:!!h.new_password&&!!k.new_password,helperText:h.new_password&&k.new_password,sx:{gridColumn:"span 4",backgroundColor:"white",borderRadius:"5px"},InputProps:{endAdornment:e.jsx(Xe,{position:"end",children:e.jsx(pe,{"aria-label":"toggle password visibility",onClick:()=>m(!n),edge:"end",children:n?e.jsx(Ue,{}):e.jsx(Je,{})})})}}),e.jsx(Ye,{fullWidth:!0,variant:"outlined",type:r?"text":"password",label:"Confirm Password",onBlur:I,onChange:D,value:p.confirmPassword,name:"confirmPassword",error:!!h.confirmPassword&&!!k.confirmPassword,helperText:h.confirmPassword&&k.confirmPassword,sx:{gridColumn:"span 4",backgroundColor:"white",borderRadius:"5px"},InputProps:{endAdornment:e.jsx(Xe,{position:"end",children:e.jsx(pe,{"aria-label":"toggle password visibility",onClick:()=>S(!r),edge:"end",children:r?e.jsx(Ue,{}):e.jsx(Je,{})})})}})]}),e.jsx(o,{sx:{my:"29px"},children:e.jsx(E,{type:"submit",sx:{background:M.bgColor,width:"100%",p:"10px","&:hover":{background:M.bgShadow,color:d.grey[100]}},variant:"contained",children:"submit"})})]})})]})})};let Zt="https://admin.wikitrak.in";const $t=()=>{const s=JSON.parse(localStorage.getItem("w_userDetails")),{mode:x}=v(r=>r.dashboard),n=Z(x),m=()=>{window.open(Zt,"_blank")};return e.jsxs(o,{children:[e.jsxs(o,{sx:{backgroundColor:n.grey[200],m:"10px",borderRadius:"5px",height:"150px"},children:[e.jsx(o,{sx:{pl:"20px",pt:"10px",mb:"10px",color:`${n.grey[400]}`},children:e.jsx("b",{children:"User Settings"})}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderRadius:"8px",boxShadow:"0px 4px 10px rgba(0, 0, 0, 0.1)"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(o,{sx:{ml:"23px",mt:"11px",height:"70px",width:"70px",backgroundColor:"white",borderRadius:"50%",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"}}),e.jsxs(o,{sx:{height:"80px",width:"200px",display:"flex",justifyContent:"center",flexDirection:"column",ml:3,color:n.grey[400]},children:[e.jsx(o,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:s&&e.jsxs(e.Fragment,{children:[s.first_name.charAt(0).toUpperCase()+s.first_name.slice(1).toLowerCase()," ",s.last_name.charAt(0).toUpperCase()+s.last_name.slice(1).toLowerCase()]})}),e.jsx(o,{children:s&&s.role})]})]}),(s==null?void 0:s.role)&&ht.includes(s.role)&&e.jsx(o,{children:e.jsx(E,{variant:"contained",sx:{backgroundColor:"white",color:n.grey[300],textTransform:"none",fontWeight:"bold","&:hover":{backgroundColor:"black",color:"white"}},onClick:m,children:"Go to admin page"})})]})]}),e.jsx(o,{sx:{marginTop:"9%",alignContent:"center",textAlign:"center"},children:e.jsx(Qt,{})})]})},es=$t,ts="/assets/3W-KvFQeYgh.jpeg",ss="data:image/png;base64,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";function as({shapeType:s,setShapeType:x}){const n=m=>{console.log("selectedType",m),x(m)};return e.jsxs(o,{children:[e.jsx(E,{onClick:()=>{n("circular")},style:{background:s==="circular"?M.bgColor:"transparent",color:s==="circular"?"white":ee[400],margin:"0 5px"},children:"Circle"}),e.jsx(E,{onClick:()=>{n("polygon")},style:{background:s==="polygon"?M.bgColor:"transparent",color:s==="polygon"?"white":ee[400],margin:"0 5px"},children:"Polygon"})]})}function os({shapeType:s,center:x,radius:n,active:m,setActive:r,setInward:S,inward:C,setSpeedLimit:d,speedLimit:j,setSpeedValue:b,handleGeofence:y,speedValue:p,setRadius:k}){var R,l;const{selectedVehicle:h,locationData:I,tractorIcon:D}=v(w=>w.liveMap);return e.jsxs(o,{sx:{display:"flex",padding:"15px",flexDirection:"column",gap:"10px",color:ee[600]},children:[e.jsx(O,{sx:{fontWeight:"bold",fontSize:"16px"},children:"Geofence Setting"}),e.jsxs(O,{sx:{fontWeight:"400",fontSize:"14px",textTransform:"capitalize"},children:["Type: ",s]}),s==="circular"&&e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:{color:"#686868"},children:"Centered At "}),e.jsxs(O,{sx:{color:"#686868"},children:["Lat: ",(R=x==null?void 0:x.lat)==null?void 0:R.toFixed(2)]}),e.jsxs(O,{sx:{color:"#686868"},children:["Lng: ",(l=x==null?void 0:x.lng)==null?void 0:l.toFixed(2)]}),e.jsxs(O,{sx:{color:"#686868",border:"1px solid #686868",borderRadius:"4px",padding:"8px"},children:["Radius ( ",(n/1e3).toFixed(2)," in km) ",e.jsx("input",{type:"text",value:n/1e3,onChange:w=>{k(w.target.value*1e3)},placeholder:"enter radius"})," in KM"]})]}),e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(O,{variant:"body1",component:"b",children:m?"Active":"Inactive"}),e.jsx(xe,{defaultChecked:m,onChange:()=>{r(!m)},color:"primary",inputProps:{"aria-label":"toggle active state"}})]}),e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(O,{variant:"body1",component:"b",children:C?"Inward":"Outward"}),e.jsx(xe,{checked:C,onChange:()=>{S(!C)},color:"primary",inputProps:{"aria-label":"toggle direction"}})]}),e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(xe,{checked:j,onChange:()=>{d(!j)},color:"primary",inputProps:{"aria-label":"toggle direction"}}),e.jsx(O,{variant:"body1",component:"b",children:"Speed Limit"})]}),j&&e.jsx(o,{sx:{},children:e.jsx(_t,{sx:{width:"100%",color:ee[600],border:"none","&:focus":{outline:"none"}},value:p,placeholder:"Enter Speed Limit",type:"number",onChange:w=>{const u=Math.max(0,parseInt(w.target.value));b(u)}})}),e.jsx(E,{disabled:Object.keys(h).length===0&&!1,variant:"outlined",size:"small",sx:{color:"white",backgroundColor:M.bgColor,mt:"6px",mx:"5px",border:"1px solid white",height:"40px",width:"100%","&:hover":{color:"black",background:M.bgShadow,border:"1px solid black"},letterSpacing:"1.5px",fontSize:"16px"},onClick:()=>{if(Object.keys(h).length===0)return G.error("please select a vehicle.");y()},children:"SUBMIT"})]})}const rs="http://139.59.37.47:3031",ns="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA",ls=({showGfBar:s,showGfAlert:x})=>{const{isLoaded:n,loadError:m}=Mt({googleMapsApiKey:`${ns}`}),{selectedVehicle:r,locationData:S,tractorIcon:C}=v(a=>a.liveMap),{geofence:d,vehicleSideBar:j}=v(a=>a.geofence),{mode:b,styles:y,vehicles_details:p}=v(a=>a.dashboard),{collapsed:k}=v(a=>a.auth),[h,I]=i.useState(null),[D,R]=i.useState(null),[l,w]=i.useState(1e3),[u,se]=i.useState([]),[K,c]=i.useState(!0),[W,z]=i.useState(!1),[L,ae]=i.useState(!1),[A,B]=i.useState({lat:18.516726,lng:73.856255}),[oe,re]=i.useState(50),[P,ne]=i.useState("circular"),[fe,X]=i.useState([{lat:A.lat+.01,lng:A.lng},{lat:A.lat-.01,lng:A.lng-.01},{lat:A.lat-.01,lng:A.lng+.01}]),[le,ie]=i.useState(!1),Ze=i.useRef(null),ce=i.useRef(!1),Y=i.useRef(null);let $e=Q();i.useEffect(()=>{et()},[r]),i.useEffect(()=>{le&&X([{lat:A.lat+.01,lng:A.lng},{lat:A.lat-.01,lng:A.lng-.01},{lat:A.lat-.01,lng:A.lng+.01}])},[le]),i.useEffect(()=>{var a,g,f,N,_,H,V,T;if(S.length>0&&Object.keys(r).length>0){let F=S.filter($=>{var q;return((q=$.latestDocument)==null?void 0:q.imei)===r.imei});se(F),B({lat:(g=(a=F[0])==null?void 0:a.latestDocument)==null?void 0:g.lat,lng:(N=(f=F[0])==null?void 0:f.latestDocument)==null?void 0:N.lng});let U=(H=(_=F[0])==null?void 0:_.latestDocument)==null?void 0:H.lat,J=(T=(V=F[0])==null?void 0:V.latestDocument)==null?void 0:T.lng;le&&X([{lat:U+.01,lng:J},{lat:U-.01,lng:J-.01},{lat:U-.01,lng:J+.01}])}},[r,S,P]),i.useEffect(()=>{h&&D&&h.fitBounds(D)},[h,D]);const et=async()=>{var a,g,f,N,_,H,V,T,F,U,J,$,q,we,je,be,ye,Se,ve,Ce,Ae,ke,Re,De,Oe,Ie,Pe,Ee,Le,Ne,_e,Fe,Ge,Me,We;if(Object.keys(r).length>0)try{const t=await ut.get(`${rs}/api/get/geofance/${r==null?void 0:r.imei}`);if(console.log(t.data.geofenceData,"result"),((g=(a=t==null?void 0:t.data)==null?void 0:a.geofenceData)==null?void 0:g.area_type)==="circular")if(ne("circular"),ie(!0),(N=(f=t==null?void 0:t.data)==null?void 0:f.geofenceData)!=null&&N.lat)B({lat:(H=(_=t==null?void 0:t.data)==null?void 0:_.geofenceData)==null?void 0:H.lat,lng:(T=(V=t==null?void 0:t.data)==null?void 0:V.geofenceData)==null?void 0:T.long}),w((U=(F=t==null?void 0:t.data)==null?void 0:F.geofenceData)==null?void 0:U.radius),c(($=(J=t==null?void 0:t.data)==null?void 0:J.geofenceData)==null?void 0:$.isActive_Geofance),z(((we=(q=t==null?void 0:t.data)==null?void 0:q.geofenceData)==null?void 0:we.type)==="inward"),ae((be=(je=t==null?void 0:t.data)==null?void 0:je.geofenceData)==null?void 0:be.isActive_Speed),re((Se=(ye=t==null?void 0:t.data)==null?void 0:ye.geofenceData)==null?void 0:Se.speed);else return G.success("No Geofence For Selected Vehicle",{id:"getting geofence"});else((Ce=(ve=t==null?void 0:t.data)==null?void 0:ve.geofenceData)==null?void 0:Ce.area_type)==="polygon"&&(ie(!1),ne("polygon"),console.log("get for polygon",(Ae=t==null?void 0:t.data)==null?void 0:Ae.geofenceData),X((Re=(ke=t==null?void 0:t.data)==null?void 0:ke.geofenceData)==null?void 0:Re.polygon_points),re((Oe=(De=t==null?void 0:t.data)==null?void 0:De.geofenceData)==null?void 0:Oe.speed),c((Pe=(Ie=t==null?void 0:t.data)==null?void 0:Ie.geofenceData)==null?void 0:Pe.isActive_Geofance),z(((Le=(Ee=t==null?void 0:t.data)==null?void 0:Ee.geofenceData)==null?void 0:Le.type)==="inward"),B({lat:(_e=(Ne=t==null?void 0:t.data)==null?void 0:Ne.geofenceData)==null?void 0:_e.lat,lng:(Ge=(Fe=t==null?void 0:t.data)==null?void 0:Fe.geofenceData)==null?void 0:Ge.long}),ae((We=(Me=t==null?void 0:t.data)==null?void 0:Me.geofenceData)==null?void 0:We.isActive_Speed))}catch(t){ie(!0),console.log("vehicleDetail",u),console.log(t,"error while getting geofence"),G.error("No geofence has been set for this vehicle.",{id:"getting geofence"})}},tt=a=>{I(a)},st=()=>{if(Object.keys(r).length>0){let a;P==="circular"?a={imei:r.imei,area_type:P,type:W?"inward":"outward",lat:A.lat,long:A.lng,radius:l,isActive_Geofance:K,isActive_Speed:!!L,speed:L?oe:5}:P==="polygon"&&(a={imei:r.imei,area_type:P,type:W?"inward":"outward",polygon_points:fe,isActive_Geofance:K,isActive_Speed:!!L,speed:L?oe:50}),$e(ft({data:a})),G.success("Successful Saved",{id:"geofence"})}else G.error("Please Select Vehicle",{id:"geofence"})},at=()=>{if(!ce.current){ce.current=!0;const a=de.getRadius();console.log("newRadius",a),w(a),ce.current=!1}},ot=a=>{console.log("New Center:",a.toJSON()),B(a.toJSON())},rt=()=>{if(Y.current&&Y.current.getPath){const g=Y.current.getPath().getArray().map(f=>({lat:f.lat(),lng:f.lng()}));X(g),console.log("newVertices",g)}},nt=a=>{Y.current=a},lt=a=>{const g=p&&(p==null?void 0:p.length)>0&&p.find(f=>Number(f==null?void 0:f.value)===Number(a)&&(f==null?void 0:f.vehilce_type));return console.log("vehicle: ",g),g?g.vehilce_type:null},me={paths:fe,options:{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,editable:!0}};if(m)return"Error loading maps";if(!n)return"Loading maps";const it={width:"100%",height:"86.8vh"};let de;const ct=a=>{const g={lat:a.latLng.lat(),lng:a.latLng.lng()};if(P!=="circular"){let f=[{lat:g.lat+.01,lng:g.lng},{lat:g.lat-.01,lng:g.lng-.01},{lat:g.lat-.01,lng:g.lng+.01}];X(f),B(g)}else B(g)},dt=()=>{var g,f,N;let a=(N=(f=(g=Y.current)==null?void 0:g.getPath())==null?void 0:f.getArray())==null?void 0:N.map(_=>({lat:_.lat(),lng:_.lng()}));X(a)};return e.jsxs(e.Fragment,{children:[e.jsx(as,{setShapeType:ne,shapeType:P}),e.jsxs(o,{sx:{display:"flex",flexDirection:"row"},children:[e.jsxs(Wt,{ref:Ze,mapContainerStyle:it,zoom:15,center:A,onClick:ct,onLoad:tt,options:{mapTypeControl:!1,styles:b?y:""},children:[P==="circular"&&e.jsx(zt,{center:A,radius:l,options:{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,editable:!0},onLoad:a=>{de=a,de.addListener("radius_changed",at)},onDragEnd:a=>ot(a.latLng)}),P==="polygon"&&e.jsx(Bt,{paths:me.paths,options:me.options,draggable:!0,editable:!0,onDragEnd:rt,onLoad:nt,onMouseUp:a=>dt()}),u&&u.length>0&&u.map((a,g)=>{const f=lt(a.latestDocument.imei);return e.jsx(Xt,{position:{lat:a.latestDocument.lat,lng:a.latestDocument.lng},icon:{url:(()=>{switch(f){case"2W":return te;case"3W":return Gt;case"4W":return Te;case"Tractor":return Ft;default:return te}})(),fillColor:"red",fillOpacity:2,strokeWeight:1,size:new window.google.maps.Size(55,55),scaledSize:new window.google.maps.Size(55,55),scale:2}},g)})]}),s&&!x&&!j&&A&&e.jsx(o,{sx:{width:k?"25%":"20%"},children:e.jsx(os,{shapeType:P,center:A,radius:l,active:K,setActive:c,setInward:z,inward:W,setSpeedLimit:ae,speedLimit:L,setSpeedValue:re,handleGeofence:st,speedValue:oe,setRadius:w})})]})]})},is=({findTypeVehicle:s,statusVehicle:x})=>{var C,d,j;const{selectedVehicle:n}=v(b=>b.liveMap),{mode:m}=v(b=>b.dashboard),r=Z(m),S=[{label:"Reg Number",value:(n==null?void 0:n.reg_id)||"NA"},{label:"IMEI Number",value:(n==null?void 0:n.imei)||"NA"},{label:"Chassis Number",value:(s==null?void 0:s.chassis_no)||"NA"},{label:"Engine Number",value:(s==null?void 0:s.engine_no)||"NA"},{label:"Date of Sell",value:(s==null?void 0:s.sell_date)||"NA"},{label:"Workshop Name",value:((C=s==null?void 0:s.workShop)==null?void 0:C.name)+`(City:${(j=(d=s==null?void 0:s.workShop)==null?void 0:d.city)==null?void 0:j.name})`||"NA"},{label:"Customer Name",value:(s==null?void 0:s.customer_name)||"NA"},{label:"Status",value:x?"On":"Off"}];return e.jsx(o,{sx:{padding:"20px"},children:e.jsx(ze,{container:!0,spacing:2,children:S.map((b,y)=>e.jsx(ze,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(o,{sx:{padding:"20px",borderRadius:"8px",boxShadow:"rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px",textAlign:"center"},children:[e.jsx(O,{sx:{fontWeight:"bold",color:r.grey[600]},children:b.label}),e.jsx(O,{sx:{color:r.grey[300]},children:Object.keys(n).length>0?b.value:"Please select vehicle"})]})},y))})})},cs=({showMap:s,setShowMap:x,showGfBar:n,showGfAlert:m})=>{const{selectedVehicle:r,onlineVehicle:S}=v(l=>l.liveMap),{mode:C,vehicles_details:d}=v(l=>l.dashboard),j=Z(C),[b,y]=i.useState(!1),[p,k]=i.useState();let h=Q();i.useEffect(()=>{console.log("onlineVehicle",S),console.log("selectedVehicle",r);let l=S.find(w=>w==r.imei);console.log("isActive",l),l?y(!0):(y(!1),console.log("Vehicle is not active"))},[S,r]),i.useEffect(()=>{if(h(mt({})),Object.keys(r).length>0){let l=D(r==null?void 0:r.imei);console.log("result",l),k(l)}},[r]);const I=l=>{const w=d&&(d==null?void 0:d.length)>0&&d.find(u=>(u==null?void 0:u.value)===l&&(u==null?void 0:u.vehilce_type));return w?w.vehilce_type:null},D=l=>{const w=d&&(d==null?void 0:d.length)>0&&d.find(u=>(u==null?void 0:u.value)===l&&u);return w||null},R=Object.keys(r).length>0?I(r.imei):null;return`${j.grey[300]}`,j.grey[300],e.jsx(e.Fragment,{children:s?e.jsx(ls,{showGfBar:n,showGfAlert:m}):e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",background:j.grey[200],margin:"10px",padding:"10px",borderRadius:"8px"},children:[e.jsxs(o,{sx:{},children:[e.jsx(O,{sx:{fontWeight:"bold",fontSize:"16px",margin:"4px",color:j.grey[400]},children:"Vehicle Settings"}),e.jsx(o,{sx:{display:"flex"},children:e.jsx(o,{sx:{border:"2px solid white",padding:"10px",borderRadius:"5px",background:"white",marginRight:"5px"},children:e.jsx("img",{src:(()=>{switch(R){case"2W":return te;case"3W":return ts;case"4W":return Te;default:return te}})(),alt:"vehicleIcon",style:{width:"80px",height:"75px",borderRadius:"5px",marginRight:"20px"}})})})]}),e.jsxs(o,{onClick:()=>{x(!s)},sx:{cursor:"pointer",marginTop:"50px"},children:[e.jsx("img",{src:ss,alt:"tractorIcon",style:{width:"80px",height:"75px",borderRadius:"5px",marginRight:"20px"}}),e.jsx(O,{sx:{fontSize:"12px",color:j.grey[400]},children:"Set Geofence"})]})]}),e.jsx(is,{findTypeVehicle:p,statusVehicle:b})]})})};function Ps(){const{w_customer_id:s}=v(l=>l.auth),{vehicleSideBar:x}=v(l=>l.geofence),{collapsed:n}=v(l=>l.auth),{mode:m}=v(l=>l.dashboard),r=Z(m),[S,C]=i.useState([]);i.useState([]);const[d,j]=i.useState({user:!0,vehicle:!1}),[b,y]=i.useState(!1),[p,k]=i.useState(!1),[h,I]=i.useState(!1);let D=Q();i.useEffect(()=>{R()},[]);const R=async()=>{try{let l=[],w=[];const u=await D(wt({w_customer_id:s}));if(u.payload&&Array.isArray(u.payload)){u.payload.forEach(c=>{var W,z,L;c.imei&&Array.isArray(c.imei)&&c.imei.length>0&&((W=c.imei[0])!=null&&W.mac_id)?(l.push({id:c.id,label:c.registration_id,value:(z=c.imei[0])==null?void 0:z.mac_id,vehilce_type:c==null?void 0:c.segment,chassis_no:c==null?void 0:c.chassis_no,engine_no:c==null?void 0:c.engine_no,workShop:c==null?void 0:c.workshop,registration_id:c==null?void 0:c.registration_id,sell_date:c==null?void 0:c.sell_date}),w.push((L=c.imei[0])==null?void 0:L.mac_id)):console.error("IMEI data not found for item:",c)});const se="one",K=w;w.length>0&&D(jt({type:se,imei:K})),C(l),D(bt(l))}else console.error("Unexpected data format or empty payload:",u),G.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),G.error(`Error fetching vehicle data: ${l}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(kt,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:r.grey[100]},children:[e.jsx(qt,{title:"Settings",setShowContent:j,showContent:d,showMap:b,setShowMap:y,showGfBar:p,setShowGfBar:k,showGfAlert:h,setShowGfAlert:I}),e.jsxs(o,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(o,{style:{width:x?"80%":"100%",border:`1px solid ${r.grey[800]}`,borderRadius:"2px"},children:d.user?e.jsx(es,{}):e.jsx(cs,{showMap:b,setShowMap:y,showGfBar:p,showGfAlert:h})}),!h&&!p&&x&&e.jsx(o,{style:{width:"20%"},children:e.jsx(Ot,{vehicleData:S,title:"Setting"})}),h&&!p&&!x&&e.jsx(o,{sx:{width:n?"25%":"20%"},children:e.jsx(It,{})})]})]})]})}export{Ps as default};
