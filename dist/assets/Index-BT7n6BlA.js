import{aa as Me,ab as Ce,j as n,p as re,r as i,B as j,A as Be,T as z,D as ye,ac as Fe,R as at,o as We,w as me,a6 as rt,U as Ie,ad as lt,P as ct,ae as it,af as ut,ag as dt,ah as ft,m as gt,ai as pt,aj as ht,x as de,ak as xt,O as yt,al as Oe,a0 as kt,a1 as vt,a3 as bt,a4 as St,V as jt,X as wt,v as Dt,am as Te}from"./index-Cp4QFi0W.js";import{L as _t}from"./LiveMapTopBar-HkM1n6O8.js";import{V as mt}from"./VehicleMenu-Cl7KVXk5.js";import It from"./Loader-Du2YI5Q4.js";import{L as Mt}from"./LiveMapServices-BxiCdl_C.js";import{P as Ct}from"./Parameters-CI0qdzwc.js";/* empty css           */import{u as Lt,G as Rt,M as $t}from"./esm-CJLF7EjE.js";import{M as Vt,r as Et,g as At,y as Ot,b as Tt,a as Nt,c as Bt,d as Ft,e as Wt,f as Gt,h as Ut,i as Ht,j as zt,k as qt,l as Yt,m as Kt,n as Xt,o as Jt,p as Zt,q as Qt,s as Pt,t as en,u as tn,v as nn}from"./black_bike-BQCRLHhh.js";import{d as on}from"./ContentCopy-CjtvlaQ1.js";import{m as _e}from"./motorbike-Ci4voNFa.js";import{r as sn}from"./redTractor-NXgVJyvR.js";import{T as an}from"./TextField-DDxAz2Ki.js";import"./Autocomplete-sE5ONsgP.js";import"./Card-Boprh9Dj.js";import"./CardContent-VKOGL9Uv.js";var Le={},rn=Ce;Object.defineProperty(Le,"__esModule",{value:!0});var Ge=Le.default=void 0,ln=rn(Me()),cn=n;Ge=Le.default=(0,ln.default)((0,cn.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info");var Re={},un=Ce;Object.defineProperty(Re,"__esModule",{value:!0});var Ue=Re.default=void 0,dn=un(Me()),fn=n;Ue=Re.default=(0,dn.default)((0,fn.jsx)("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"NorthEast");var $e={},gn=Ce;Object.defineProperty($e,"__esModule",{value:!0});var He=$e.default=void 0,pn=gn(Me()),hn=n;He=$e.default=(0,pn.default)((0,hn.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn");const xn=({label:v,value:x})=>n.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[n.jsx(z,{variant:"body2",color:"textSecondary",children:v}),n.jsx(z,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:x||"N/A"})]}),yn=(v,x)=>(v==null?void 0:v.find(B=>{var _,C;return((C=(_=B.imei)==null?void 0:_[0])==null?void 0:C.mac_id)===x}))||{},Ne=({title:v,details:x})=>n.jsx(j,{sx:{width:"45%"},children:x.map(({label:B,value:_})=>n.jsx(xn,{label:B,value:_},B))});let kn=["vt200","wtkpltf001"];function vn({handleVehicleInfo:v,udpatedParams:x,handleClickOpen:B}){var ce,R,U,Y,$,K,te,ne,F,X,fe,ie,oe,se,ge,m,ae;const{collapsed:_}=re(k=>k.auth),{vehicleList:C,selectedVehicle:b,selectedImei:G}=re(k=>k.liveMap),[f,he]=i.useState({});let[s,le]=i.useState(null);i.useEffect(()=>{let k=x&&(x==null?void 0:x.length)>0&&(x==null?void 0:x.find(y=>{var V;return((V=y==null?void 0:y.latestDocument)==null?void 0:V.imei)==G}));le(k)},[x,G]),i.useEffect(()=>{he(yn(C,G))},[C,G]);const P=(k,y)=>{const V=`https://www.google.com/maps?q=${k},${y}`;window.open(V,"_blank")},ee=k=>{var T,l;let y=(T=k==null?void 0:k.latestDocument)==null?void 0:T.ignition,V=(l=k==null?void 0:k.latestDocument)==null?void 0:l.speed;return y===!0||y===1?V:0},q=[{label:"Vehicle No:",value:f==null?void 0:f.registration_id},{label:"Model:",value:(ce=f==null?void 0:f.vehicle_model)==null?void 0:ce.name},{label:"IMEI No:",value:(U=(R=f==null?void 0:f.imei)==null?void 0:R[0])==null?void 0:U.mac_id},{label:"Chassis No:",value:f==null?void 0:f.chassis_no},{label:"Engine No:",value:f==null?void 0:f.engine_no}],ke=[{label:"Customer Name:",value:(Y=f==null?void 0:f.user)!=null&&Y.us_user?`${f.user.us_user.first_name.charAt(0).toUpperCase()}${f.user.us_user.first_name.slice(1)} ${f.user.us_user.last_name.charAt(0).toUpperCase()}${f.user.us_user.last_name.slice(1)}`:null},{label:"Mobile: ",value:(($=f==null?void 0:f.user)==null?void 0:$.us_user)&&f.user.us_user.mobile},{label:"Date of Sell:",value:f==null?void 0:f.sell_date},{label:"Workshop Name:",value:(K=f==null?void 0:f.workshop)==null?void 0:K.name}];let L={border:"2px solid black",borderRadius:"5px",padding:"5px",color:"black"};const xe=k=>{let y=C.find(T=>{var l,h;return((l=T==null?void 0:T.imei)==null?void 0:l.length)>0&&((h=T.imei[0])==null?void 0:h.mac_id)==k.imei}),V=parseFloat((y==null?void 0:y.load_capacity)||0)/49*parseFloat((k==null?void 0:k.analogInput1)||0);return`${parseFloat(V).toFixed(2)} Kgs`||0};return n.jsxs(j,{sx:{position:"absolute",top:"600px",left:_?"280px":"450px",zIndex:1,background:Be.bgShadow,p:2,borderRadius:2,color:"white",width:"72%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[n.jsx(z,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),n.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[n.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",width:"100%",marginLeft:"10px"},children:[n.jsx(j,{sx:L,children:n.jsxs(z,{children:[((te=s==null?void 0:s.latestDocument)==null?void 0:te.venderId)==="Sinocastel"?"Cranking status":"Ignition",":"," ",((ne=s==null?void 0:s.latestDocument)==null?void 0:ne.ignition)===!0||((F=s==null?void 0:s.latestDocument)==null?void 0:F.ignition)===1?"On":"Off"]})}),kn.includes((fe=(X=s==null?void 0:s.latestDocument)==null?void 0:X.venderId)==null?void 0:fe.toLowerCase())&&n.jsx(j,{sx:L,children:n.jsxs(z,{children:["Pump:"," ",((ie=s==null?void 0:s.latestDocument)==null?void 0:ie.isAcreage)===!0||((oe=s==null?void 0:s.latestDocument)==null?void 0:oe.isAcreage)===1?"On":"Off"]})}),n.jsx(j,{sx:L,children:n.jsxs(z,{children:["Speed: ",ee(s)," km/h"]})}),n.jsx(j,{sx:L,children:n.jsxs(z,{children:["Main Voltage:"," ",s?`${((se=s==null?void 0:s.latestDocument)==null?void 0:se.mainInputVoltage)||0} Voltage`:0]})}),n.jsx(j,{sx:L,children:n.jsxs(z,{children:["Heading:"," ",s?`${(ge=s==null?void 0:s.latestDocument)==null?void 0:ge.heading} deg`:0]})}),s&&((m=s==null?void 0:s.latestDocument)==null?void 0:m.venderId)==="VT200"&&n.jsx(j,{sx:L,children:n.jsxs(z,{children:["Load:"," ",s?xe(s==null?void 0:s.latestDocument):0]})}),s&&((ae=s==null?void 0:s.latestDocument)==null?void 0:ae.venderId)==="VT200"&&n.jsx(j,{sx:L,children:n.jsxs(z,{children:["Remaining fuel:"," ","0 Ltr"]})}),n.jsxs(ye,{disabled:!s,onClick:()=>{var k,y;P((k=s==null?void 0:s.latestDocument)==null?void 0:k.lat,(y=s==null?void 0:s.latestDocument)==null?void 0:y.lng)},children:["Navigate to map",n.jsx(Ue,{})]}),n.jsxs(ye,{disabled:!s,onClick:()=>{B()},children:["Share live location",n.jsx(He,{})]})]}),n.jsx(Fe,{sx:{cursor:"pointer",color:"black"},onClick:v})]}),n.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[n.jsx(Ne,{title:"Vehicle Details",details:q}),n.jsx(Ne,{title:"Customer Details",details:ke})]})]})}const bn="https://cc.wikitrak.in/proxy-3031",Sn="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function jn({showCard:v,loadingVehicle:x,vehicleData:B}){const{center:_,selectedParameterList:C,selectedVehicle:b,vehicleList:G,zoom:f,icons:he,locationData:s,placesData:le,imeiNumbers:P,selectedImei:ee,onlineVehicle:q,loading:ke,services_loading:L}=re(e=>e.liveMap),{mode:xe,styles:ce,vehicles_details:R}=re(e=>e.dashboard),U=i.useRef(null),{collapsed:Y}=re(e=>e.auth),[$,K]=i.useState(null),[te,ne]=i.useState(""),[F,X]=i.useState([]),[fe,ie]=i.useState(),[oe,se]=i.useState(null);i.useState("");const[ge,m]=i.useState(),[ae,k]=i.useState(!1),[y,V]=i.useState(null),[T,l]=at.useState(!1),[h,E]=i.useState(""),J=async()=>{var e;if(!ee)return de.error("Please select vehicle");try{const t=await xt.post(`${bn}/api/generate-token`,{vehicleNo:ee});if((e=t==null?void 0:t.data)!=null&&e.token){const o=`http://cc.wikitrak.in/live-location/${ee}/${t.data.token}`;E(o),l(!0)}}catch(t){de.error("Error occurred while generating link"),l(!1),E(!1),console.error("Error generating link",t)}},Z=()=>{J()},c=()=>{l(!1)},D=We(),I={},W=i.useRef([]),w=i.useRef(null),A=i.useRef({}),{isLoaded:ve,loadError:be}=Lt({googleMapsApiKey:`${Sn}`,loadingElement:n.jsx(It,{})});i.useEffect(()=>{ve&&K(window.google.maps)},[ve]),i.useEffect(()=>{},[f]),i.useEffect(()=>{var e,t,o,r;if(Object.keys(b).length>0){const a=(y==null?void 0:y.length)>0?y:s,u=a==null?void 0:a.filter(d=>{var g;return((g=d==null?void 0:d.latestDocument)==null?void 0:g.imei)===(b==null?void 0:b.imei)});if((u==null?void 0:u.length)>0){X(u);const d={lat:(t=(e=u[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(r=(o=u[0])==null?void 0:o.latestDocument)==null?void 0:r.lng};D(me(d))}}},[s,b]),i.useEffect(()=>{var e,t,o,r;if(Object.keys(b).length>0){const a=(y==null?void 0:y.length)>0?y:s,u=a==null?void 0:a.filter(d=>{var g;return((g=d==null?void 0:d.latestDocument)==null?void 0:g.imei)===(b==null?void 0:b.imei)});if((u==null?void 0:u.length)>0){X(u);const d={lat:(t=(e=u[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(r=(o=u[0])==null?void 0:o.latestDocument)==null?void 0:r.lng};D(me(d))}}else{const a=s==null?void 0:s.filter(u=>B.some(d=>d.value===u.latestDocument.imei));X(a),V(a)}},[s,b]),i.useEffect(()=>{ie(C)},[C]),i.useEffect(()=>{D(rt({}))},[b]),i.useEffect(()=>{if(console.log("before: ",F),!$)return;const e=w.current;let t=null;return(async()=>{console.log("after: ",F);const r=await Se(F,e);t&&t.clearMarkers(),t=Ke(r,e),Ie.on("locationinfo",a=>{console.log("locationinfo: ",a),Je(a,W),V(u=>{const d=Array.isArray(u)?u:[],g=d.findIndex(p=>p.latestDocument.imei==a.imei);if(g!==-1){const p=[...d];return p[g]={...p[g],latestDocument:{...p[g].latestDocument,...a}},p}else return[...d,{_id:a.imei,latestDocument:a}]})})})(),()=>{t&&t.clearMarkers(),Object.keys(A.current).forEach(r=>cancelAnimationFrame(A.current[r])),Ie.off("locationinfo")}},[$,F,Ie,fe,W,s]);const Se=(e,t)=>e.map(o=>{const r=o.latestDocument.imei,a=W.current[r]||je(o,t);return W.current[r]&&we(o,a),a}),je=(e,t)=>{const o=e.latestDocument.imei,r=new $.Marker({position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},map:t,icon:pe(e,0)});return r.addListener("click",()=>Ye(e,r,t)),W.current[o]=r,r},we=async(e,t)=>{var g;const o=t.getPosition(),r=((g=t.getIcon())==null?void 0:g.rotation)||0,a={lat:e.latestDocument.lat,lng:e.latestDocument.lng},u=Ee(o,a);console.log("update marker",u),Ve(t,o,a,r,u);const d=await pe(e,u);t.setIcon(d)},pe=async(e,t)=>{var g,p,S,M;const o=(g=e==null?void 0:e.latestDocument)==null?void 0:g.imei,r=Ze(o),a=Pe(e==null?void 0:e.latestDocument,r);return ue((p=e==null?void 0:e.latestDocument)==null?void 0:p.imei)&&ze((S=e==null?void 0:e.latestDocument)==null?void 0:S.imei),{url:await qe(a,t),fillOpacity:2,strokeWeight:1,scale:12,rotation:(M=e==null?void 0:e.latestDocument)==null?void 0:M.heading}},ue=e=>{if(!e)return!1;const t=String(e).toLowerCase();return q.some(o=>String(o).toLowerCase()===t)},ze=e=>s==null?void 0:s.some(t=>String(t.latestDocument.imei)===String(e)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),qe=(e,t,o,r=50,a=40,u=45)=>{const d=`${e}-${t}-${r}-${o}-${a}-${u}`;if(I[d])return Promise.resolve(I[d]);const g=document.createElement("canvas"),p=g.getContext("2d");g.width=r,g.height=r;const S=new Image;return S.src=e,new Promise(M=>{S.onload=()=>{p.clearRect(0,0,g.width,g.height),p.translate(r/2,r/2),p.rotate(t*Math.PI/180),p.translate(-r/2,-r/2);const O=(r-a)/2,Q=(r-u)/2;if(p.drawImage(S,O,Q,a,u),o){const De=r-10-5,st=r-10-5;p.beginPath(),p.arc(De,st,10/2,0,Math.PI*2),p.fillStyle=o,p.fill()}const N=g.toDataURL("image/png");I[d]=N,M(N)},S.onerror=O=>{console.error("Error loading image for rotation:",O),M(e)}})},Ye=(e,t,o)=>{tt(e.latestDocument._id,e,t,o),nt(e.latestDocument.imei)},Ve=(e,t,o,r,a)=>{const d=performance.now(),g=()=>{const p=performance.now()-d,S=Math.min(p/500,1),M=t.lat()+S*(o.lat-t.lat()),O=t.lng()+S*(o.lng-t.lng()),Q=(a-r+360)%360-180,N=(r+Q*S+360)%360;e.setPosition({lat:M,lng:O});const H=e.getIcon();H&&typeof H=="object"&&e.setIcon({...H,rotation:N}),S<1?A.current[e.getPosition()]=requestAnimationFrame(g):(e.setPosition(o),H&&typeof H=="object"&&e.setIcon({...H,rotation:a}),delete A.current[e.getPosition()])};A.current[e.getPosition()]=requestAnimationFrame(g)},Ke=(e,t)=>new Vt({map:t,markers:e,renderer:{render:({count:o,position:r})=>Xe(o,r)}}),Xe=(e,t)=>{const o=40+Math.min(e*2,40),r=30;let a;return e<10?a={start:"#76c7c0",end:"#34a853"}:e<50?a={start:"#fbbc05",end:"#f2994a"}:a={start:"#f45c42",end:"#d32f2f"},new $.Marker({position:t,icon:{url:`data:image/svg+xml,${encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="${o}" height="${o}" viewBox="0 0 100 100">
            <defs>
              <radialGradient id="gradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="${a.start}" />
                <stop offset="100%" stop-color="${a.end}" />
              </radialGradient>
              <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0, 0, 0, 0.5)" />
              </filter>
            </defs>
            <!-- Outer Pulsating Ring -->
            <circle cx="50" cy="50" r="48" fill="url(#gradient)" filter="url(#shadow)" stroke="#ffffff" stroke-width="3" />
            <!-- Decorative Inner Ring -->
            <circle cx="50" cy="50" r="38" fill="none" stroke="#ffffff" stroke-width="2" stroke-dasharray="4 2" />
            <!-- Star Decoration -->
            <polygon points="50,15 54,38 70,38 57,50 62,68 50,57 38,68 43,50 30,38 46,38" fill="#ffffff" opacity="0.4" />
            <!-- Count Text -->
            <text x="50" y="55" font-size="${r}" fill="black" text-anchor="middle" font-family="'Courier New', monospace" font-weight="bold">
              ${e}
            </text>
          </svg>
        `)}`,scaledSize:new $.Size(o,o)},label:null})},Ee=(e,t)=>{const o=N=>N*Math.PI/180,r=N=>N*180/Math.PI,a=o(typeof e.lat=="function"?e.lat():e.lat),u=o(typeof e.lng=="function"?e.lng():e.lng),d=o(typeof t.lat=="function"?t.lat():t.lat),p=o(typeof t.lng=="function"?t.lng():t.lng)-u,S=Math.sin(p)*Math.cos(d),M=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(p),O=Math.atan2(S,M),Q=(r(O)+360)%360;return console.log("From:",e,"To:",t),console.log("Calculated heading (degrees):",Q),Q},Je=async(e,t,o)=>{var u;const r=e.imei,a=t.current[r];if(a){const d=a.getPosition(),g=((u=a.getIcon())==null?void 0:u.rotation)||0,p={lat:e.lat,lng:e.lng},S=Ee(d,p);console.log("location update",S,g),Ve(a,d,p,g,S);const M=await pe({latestDocument:e},S);if(a.setIcon(M),ee==(e==null?void 0:e.imei)){const O=w.current.getBounds();O&&!O.contains(p)&&w.current.panTo(p)}}},Ze=e=>{if(!e)return"motorBike";const t=Qe(e);return t||console.error(`No vehicle type found for IMEI: ${e}, defaulting to motorBike`),t||"motorBike"},Qe=e=>{if(!R||R.length===0)return console.error("vehicles_details is not available"),null;const t=R.find(o=>(o==null?void 0:o.value)===e&&(o==null?void 0:o.vehilce_type));return t||console.error(`No vehicle found for IMEI: ${e}`),t?t.vehilce_type:null},Pe=(e,t)=>{let{speed:o,ignition:r,imei:a}=e,u=ue(a);const d={"2W":{red:Et,green:At,yellow:Ot,black:Tt},"3W":{red:Nt,green:Bt,yellow:Ft,black:Wt},"4W":{red:Gt,green:Ut,yellow:Ht,black:zt},Tractor:{red:sn,green:qt,yellow:Yt,black:Kt},Harvestor:{red:Xt,green:Jt,yellow:Zt,black:Qt},BUS:{red:Pt,green:en,yellow:tn,black:nn},default:{red:_e,green:_e,yellow:_e,black:_e}};let g=d[t]||d.default;if(!u)return g.black;if(u&&!r)return g.red;if(u&&r&&o>0)return g.green;if(u&&r&&o<=0)return g.yellow},et=e=>{console.log("packet and type",e);let{speed:t,ignition:o,imei:r}=e;console.log("speed",t,o,r);let a=ue(r);if(console.log("isONline",a),!a)return"Offline";if(a&&!o)return"Online";if(a&&o&&t>0)return"Running";if(a&&o&&t<=0)return"Idle"},tt=(e,t,o,r)=>{var S,M,O,Q;let a=ct(new Date((S=t==null?void 0:t.latestDocument)==null?void 0:S.Date)).format("DD-MM-YYYY HH:mm");D(it(t.latestDocument.imei));const u={lat:(M=t==null?void 0:t.latestDocument)==null?void 0:M.lat,lng:(O=t==null?void 0:t.latestDocument)==null?void 0:O.lng};D(me(u)),D(ut(15)),U.current||(U.current=new $.InfoWindow);const d=U.current,p=`
      <div>
        <h3>Registration No: ${((Q=G.find(N=>{var H,De;return((H=N==null?void 0:N.imei[0])==null?void 0:H.mac_id)===((De=t==null?void 0:t.latestDocument)==null?void 0:De.imei)}))==null?void 0:Q.registration_id)||""}</h3>
        <h3>Status:${et(t==null?void 0:t.latestDocument)}</h3>
        <h3>Last updated time:${a}</h3>
      </div>
    `;oe===e?(d.close(),se(null)):(d.setContent(p),d.open(r,o),se(e))},nt=e=>{const t=R&&(R==null?void 0:R.length)>0&&R.find(o=>(o==null?void 0:o.value)===e&&o);m(t||null)},Ae=()=>{k(!ae)};if(be)return"Error loading maps";if(!ve)return"Loading maps";if(!$)return null;const ot={height:"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return n.jsxs(n.Fragment,{children:[n.jsx(j,{sx:{position:"absolute",top:"780px",left:Y?"74px":"250px",zIndex:1,background:Be.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:n.jsxs(ye,{sx:{color:"white"},onClick:Ae,children:[ae?"Hide":"Show"," Vehicle Info",n.jsx(Ge,{})]})}),ae===!0&&n.jsx(vn,{handleVehicleInfo:Ae,udpatedParams:y,handleClickOpen:Z}),n.jsxs(Rt,{id:"map",mapContainerStyle:ot,zoom:f,center:_,onLoad:e=>{w.current=e},options:{styles:xe?ce:""},children:[Object.keys(b).length>0&&n.jsx(Mt,{setPlace:ne,place:te}),L||x?n.jsx(j,{sx:{position:"absolute",top:"50%",left:"50%"},children:n.jsx(lt,{})}):le&&le.length>0&&le.map((e,t)=>{var o,r;return n.jsx($t,{position:{lat:parseFloat((o=e==null?void 0:e.location)==null?void 0:o.lat),lng:parseFloat((r=e==null?void 0:e.location)==null?void 0:r.lng)},animation:window.google.maps.Animation.DROP,icon:{path:he[`${te}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},t)}),n.jsx(wn,{open:T,shareLink:h,handleClose:c})]})]})}const wn=({open:v,handleClose:x,shareLink:B})=>{i.useState("");const _=i.useRef(null);i.useEffect(()=>{},[]);const C=()=>{const b=_.current;b?(b.select(),b.setSelectionRange(0,99999),document.execCommand("copy")?de.success("Text copied!"):de.error("Failed to copy!"),window.getSelection().removeAllRanges()):de.error("Failed to copy! No input found.")};return n.jsxs(dt,{onClose:x,"aria-labelledby":"customized-dialog-title",open:v,fullWidth:!0,maxWidth:"lg",children:[!1,n.jsxs(ft,{sx:{m:0,p:2},id:"customized-dialog-title",children:["Vehicle live location link",n.jsx(gt,{"aria-label":"close",onClick:x,sx:b=>({position:"absolute",right:8,top:8,color:b.palette.grey[500]}),children:n.jsx(Fe,{})})]}),n.jsx(pt,{dividers:!0,children:n.jsxs(j,{display:"flex",alignItems:"center",gap:2,mt:1,children:[n.jsx(an,{fullWidth:!0,variant:"outlined",inputRef:_,value:B,onChange:b=>{},sx:{flex:9}}),n.jsx(ye,{variant:"outlined",onClick:C,startIcon:n.jsx(on,{}),sx:{flex:1,minWidth:"auto"},children:"Copy"})]})}),n.jsx(ht,{children:n.jsx(ye,{onClick:x,children:"Close"})})]})};function Fn(){const{locationData:v,selectedVehicle:x,selectedParameterList:B,onlineVehicle:_}=re(l=>l.liveMap),{mode:C,selectedVehicleGroup:b}=re(l=>l.dashboard),G=Dt(C),[f,he]=i.useState([]),[s,le]=i.useState(""),[P,ee]=i.useState(""),[q,ke]=i.useState(""),[L,xe]=i.useState(""),{w_customer_id:ce}=re(l=>l.auth),[R,U]=i.useState(),[Y,$]=i.useState(!1),[K,te]=i.useState(!1),[ne,F]=i.useState([]),[X,fe]=i.useState(!0),[ie,oe]=i.useState(!1),[se,ge]=i.useState(!1);let m=We();i.useEffect(()=>()=>{m(yt({}))},[]),i.useEffect(()=>{ae()},[]),i.useEffect(()=>{var l;if(Object.keys(x).length>0){const h=v==null?void 0:v.filter(c=>c.latestDocument.imei==(x==null?void 0:x.imei)),{lat:E,lng:J}=((l=h==null?void 0:h[0])==null?void 0:l.latestDocument)??{},Z={lat:E||Te.lat,lng:J||Te.lat};m(me(Z))}},[x,v]),i.useEffect(()=>{F([]),m(Oe([{reg_id:"",imei:"",params:[]}]))},[x]);const ae=async()=>{try{oe(!0);let l=[],h=[];const E=await m(kt({w_customer_id:ce}));if(Array.isArray(E.payload)){E.payload.forEach(c=>{var D,I,W,w;Array.isArray(c.imei)&&c.imei.length>0&&((D=c.imei[0])!=null&&D.mac_id)?(l.push({id:c.id,label:c.registration_id,value:(I=c.imei[0])==null?void 0:I.mac_id,vehilce_type:c==null?void 0:c.segment,chassis_no:c==null?void 0:c.chassis_no,engine_no:c==null?void 0:c.engine_no,workShop:c==null?void 0:c.workshop,registration_id:c==null?void 0:c.registration_id,sell_date:c==null?void 0:c.sell_date,customer_name:c==null?void 0:c.customer_name,vehicle_model:(W=c==null?void 0:c.vehicle_model)==null?void 0:W.name,vehicle_group:c==null?void 0:c.vehicle_group}),h.push((w=c.imei[0])==null?void 0:w.mac_id)):console.error("IMEI data not found for item:",c)});const J="one",Z=h;h.length>0&&m(vt({type:J,imei:Z})),he(l),m(bt(l)),m(St({w_customer_id:ce})),oe(!1)}else oe(!1),console.error("Unexpected data format:",E),de.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),de.error(`Error fetching vehicle data: ${l}`)}},k=async l=>{const{label:h,imei:E,id:J,reg_id:Z,checked:c}=l;U(w=>w.map(A=>A.id===J?{...A,checked:!c}:A));let D=[...ne],I=[...ne];if(!c)v.forEach(w=>{w.latestDocument.imei===E&&(D.push({label:h,value:w.latestDocument[h==="maininputvoltage"?"mainInputVoltage":h]}),I=D,F(D))});else{let w=ne.filter(A=>A.label!==h);I=w,F(w)}m(Oe([{reg_id:Z,imei:E,params:I}]))},y=l=>v==null?void 0:v.some(h=>String(h.latestDocument.imei)===String(l)&&h.latestDocument.speed>0&&(h.latestDocument.ignition===!0||h.latestDocument.ignition===1)),V=l=>v==null?void 0:v.some(h=>String(h.latestDocument.imei)===String(l)&&h.latestDocument.speed<=0&&(h.latestDocument.ignition===!0||h.latestDocument.ignition===1)),T=f.filter(l=>{var be,Se,je,we,pe;if(!(Object.keys(b).length===0||l.vehicle_group===b.id))return!1;const E=(be=l==null?void 0:l.label)==null?void 0:be.toLowerCase().includes(s.toLowerCase()),J=L===""||((Se=l==null?void 0:l.workShop)==null?void 0:Se.region)===L,Z=q===""||((we=(je=l==null?void 0:l.workShop)==null?void 0:je.state)==null?void 0:we.toLowerCase())===(((pe=q==null?void 0:q.toString())==null?void 0:pe.toLowerCase())||""),c=l.value,D=String(l.value).toLowerCase(),I=_.some(ue=>String(ue).toLowerCase()===D),W=!_.some(ue=>String(ue).toLowerCase()===D),w=I&&y(c),A=I&&V(c);return E&&J&&Z&&(P==="online"?I:P==="offline"?W:P==="running"?w:P==="idling"?A:!0)}).sort((l,h)=>l.label.localeCompare(h.label));return n.jsxs("div",{className:"app",children:[n.jsx(jt,{}),n.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[n.jsx(_t,{title:"Live Map",setShowVehicles:$,showVehicles:Y,showParameters:K,setShowParameters:te,setShowCard:fe,showCard:X,setShowVehiclesGroup:ge,showVehiclesGroup:se}),n.jsx(wt,{setShowVehiclesGroup:ge,showVehiclesGroup:se,where:"livemap"}),n.jsxs(j,{style:{display:"flex",width:"100%",height:"95vh"},children:[n.jsx(j,{style:{width:Y||K?"80%":"100%"},children:n.jsx(jn,{showCard:X,loadingVehicle:ie,vehicleData:T})}),Y&&n.jsx(j,{style:{width:"20%",backgroundColor:G.grey[100]},children:n.jsx(mt,{vehicleData:T,title:"Live Map",setParameterData:U,loadingVehicle:ie,setShowVehicles:$,showVehicles:Y,showParameters:K,setShowParameters:te,setSearchedTerm:le,setOptions:ee,setState:ke,setRegion:xe,searchTerm:s,options:P,state:q,region:L})}),K&&n.jsx(j,{style:{width:"20%",backgroundColor:G.grey[100]},children:n.jsx(Ct,{parametersData:R,setParameterData:U,handleParameterChange:k})})]})]})]})}export{Fn as default};
