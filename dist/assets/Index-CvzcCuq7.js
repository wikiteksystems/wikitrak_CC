import{aq as M,ar as A,j as e,p as k,r as b,B as p,d9 as F,T as C,ch as Y,E,cQ as R,m as B,gM as z,aP as w,o as P,gF as N,gG as O,az as U,U as q,dn as W,dp as G,co as K,aw as Q,y,aF as L,gD as J}from"./index-BHh91Wj8.js";var _={},X=A;Object.defineProperty(_,"__esModule",{value:!0});var I=_.default=void 0,Z=X(M()),V=e;I=_.default=(0,Z.default)((0,V.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline");const $=65535,ee=[0,4489,8978,12955,17956,22445,25910,29887,35912,40385,44890,48851,51820,56293,59774,63735,4225,264,13203,8730,22181,18220,30135,25662,40137,36160,49115,44626,56045,52068,63999,59510,8450,12427,528,5017,26406,30383,17460,21949,44362,48323,36440,40913,60270,64231,51324,55797,12675,8202,4753,792,30631,26158,21685,17724,48587,44098,40665,36688,64495,60006,55549,51572,16900,21389,24854,28831,1056,5545,10034,14011,52812,57285,60766,64727,34920,39393,43898,47859,21125,17164,29079,24606,5281,1320,14259,9786,57037,53060,64991,60502,39145,35168,48123,43634,25350,29327,16404,20893,9506,13483,1584,6073,61262,65223,52316,56789,43370,47331,35448,39921,29575,25102,20629,16668,13731,9258,5809,1848,65487,60998,56541,52564,47595,43106,39673,35696,33800,38273,42778,46739,49708,54181,57662,61623,2112,6601,11090,15067,20068,24557,28022,31999,38025,34048,47003,42514,53933,49956,61887,57398,6337,2376,15315,10842,24293,20332,32247,27774,42250,46211,34328,38801,58158,62119,49212,53685,10562,14539,2640,7129,28518,32495,19572,24061,46475,41986,38553,34576,62383,57894,53437,49460,14787,10314,6865,2904,32743,28270,23797,19836,50700,55173,58654,62615,32808,37281,41786,45747,19012,23501,26966,30943,3168,7657,12146,16123,54925,50948,62879,58390,37033,33056,46011,41522,23237,19276,31191,26718,7393,3432,16371,11898,59150,63111,50204,54677,41258,45219,33336,37809,27462,31439,18516,23005,11618,15595,3696,8185,63375,58886,54429,50452,45483,40994,37561,33584,31687,27214,22741,18780,15843,11370,7921,3960];function te(c,a){let s=c^a;return c>>>8^ee[s&255]}function ae(c){const a=c.match(/.{2}/g).map(f=>parseInt(f,16));let s=$;for(let f of a)s=te(s,f);s=(s^$)&65535,console.log("original crc",s.toString(16).padStart(4,"0").toUpperCase());const o=s&255,l=s>>8&255;return console.log("reversed  crc",(o.toString(16).padStart(2,"0")+l.toString(16).padStart(2,"0")).toUpperCase()),(o.toString(16).padStart(2,"0")+l.toString(16).padStart(2,"0")).toUpperCase()}const xe=c=>{const a="4040210004",s=[...c].map(h=>h.charCodeAt(0).toString(16).toUpperCase().padStart(2,"0")).join(""),f=a+s+"000000"+"30020300",x=ae(f);return console.log("device id",c,s),console.log("dataforcrc",f),console.log("crc",x),f+x+"0D0A"},T="https://cc.wikitrak.in/proxy-3031",oe=()=>{const{selectedVehicle:c}=k(n=>n.diagnostics),[a,s]=b.useState(""),[o,l]=b.useState([]),[f,x]=b.useState(!1),g=b.useRef(null),j=async()=>{var m,d,r,i;const n={imei:c==null?void 0:c.imei,command:a};x(!0);try{const{data:t}=await L.post(`${T}/api/command/sinocastal`,n);console.log("data",(t==null?void 0:t.data)||"Empty response");const u={type:"incoming",text:`Incoming: ${(t==null?void 0:t.data)||"No response from device"}`};l(v=>[...v,u])}catch(t){console.log("err",(d=(m=t==null?void 0:t.response)==null?void 0:m.data)==null?void 0:d.message);const u={type:"incoming",text:`Incoming: ${((i=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:i.message)||"No response from device"}`};l(v=>[...v,u])}finally{x(!1)}},h=()=>{if(a.trim()==="")return;const n={type:"outgoing",text:a};j(),l(m=>[...m,n])},D=()=>{const n=o.map(m=>`${m.type==="outgoing"?">>":"<<"} ${m.text}`).join(`
`);navigator.clipboard.writeText(n),y.success("Logs copied to clipboard")},S=()=>{l([]),y.success("Logs cleared")};return b.useEffect(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[o]),e.jsxs(p,{sx:{width:"100%",px:2,py:4},children:[f&&e.jsx(F,{}),e.jsx(C,{variant:"h5",children:"Device Terminal"}),e.jsx(p,{display:"flex",justifyContent:"space-between",alignItems:"center",m:1,children:e.jsxs(p,{display:"flex",width:"80%",gap:2,mb:2,children:[e.jsx(Y,{fullWidth:!0,label:"Enter command",variant:"outlined",value:a,onChange:n=>s(n.target.value),onKeyDown:n=>n.key==="Enter"&&h()}),e.jsx(E,{variant:"contained",color:"primary",onClick:h,children:"Send"})]})}),e.jsxs(p,{sx:{float:"end"},children:[e.jsx(R,{title:"Copy Logs",children:e.jsx(B,{onClick:D,children:e.jsx(z,{sx:{color:"#4FC3F7"}})})}),e.jsx(R,{title:"Clear Logs",children:e.jsx(B,{onClick:S,children:e.jsx(I,{sx:{color:"#FF8A65"}})})})]}),e.jsx(w,{elevation:3,ref:g,sx:{backgroundColor:"#1e1e1e",color:"#d4d4d4",fontFamily:"monospace",p:2,height:600,overflowY:"auto",borderRadius:2,width:"100%"},children:o.map((n,m)=>e.jsx(p,{sx:{mb:1},children:e.jsxs(C,{sx:{color:n.type==="outgoing"?"#4FC3F7":"#81C784"},children:[n.type==="outgoing"?">> ":"<< ",n.text]})},m))})]})},ce=()=>{const{liveParameters:c,loading:a,isDtcLoader:s,activeVehicle:o,selectedVehicle:l}=k(x=>x.diagnostics),f=P();return b.useEffect(()=>{var x,g,j;if(console.log("selected vehicle",l),console.log("actie vehicle",o),Object.keys(l).length>0){let h=(j=(g=(x=o==null?void 0:o.sub_model)==null?void 0:x.ecus[0])==null?void 0:g.pid_datasets[0])==null?void 0:j.id;f(N({pid:h})),f(O({pid:h}))}},[l]),b.useEffect(()=>{console.log("liveparameter",c)},[c]),e.jsxs(p,{sx:{m:2},children:[e.jsx(C,{variant:"h6",children:"Live Parameter Monitoring"}),a&&e.jsx(F,{}),e.jsx("div",{style:{height:"85vh",overflow:"auto"},children:e.jsx(p,{sx:{mt:"20px"},children:c.filter(x=>x.checked).map((x,g)=>e.jsxs(p,{sx:{border:"1px solid grey",display:"flex",mx:"30px",mb:"10px",borderRadius:"5px",padding:"15px"},children:[e.jsx(p,{sx:{width:"95%"},children:x.label}),e.jsxs(p,{children:[" ",x&&(x==null?void 0:x.dataByte)&&x.dataByte," ",x.pi_code_variable[0].unit]})]}))})})]})},ne=()=>{const c=P(),{selectedVehicle:a,activeVehicle:s,dtcDataset:o}=k(d=>d.diagnostics),[l,f]=b.useState([]),[x,g]=b.useState(!1),[j,h]=b.useState(!1),D=async d=>{g(!0);try{const r=await L.get(`${T}/api/dtc/${d}`);f(r.data.dtcRecords||[])}catch(r){console.log("eroror",r),y.error("Failed to fetch DTC records")}finally{g(!1)}},S=async()=>{var r,i,t;let d=(t=(i=(r=s==null?void 0:s.sub_model)==null?void 0:r.ecus[0])==null?void 0:i.datasets[0])==null?void 0:t.id;c(J({id:d}))},n=async()=>{var d,r,i,t;h(!0);try{let u=xe(a==null?void 0:a.imei);const v={imei:a==null?void 0:a.imei,command:u};y.success("Clear DTC command sent"),y.success(e.jsx("span",{style:{wordBreak:"break-all"},children:u}));const{data:H}=await L.post(`${T}/api/command/sinocastal`,v);y.success(`${H.data}`),y.success("Response received from device")}catch(u){console.log("error",(r=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:r.message),y.error(((t=(i=u==null?void 0:u.response)==null?void 0:i.data)==null?void 0:t.message)||"No response from device")}finally{h(!1)}};b.useEffect(()=>{Object.keys(a).length>0&&(D(a.imei),S())},[a]),b.useEffect(()=>{console.log("dtc dataset",o)},[o]);const m=d=>{var r;return o&&o.length>0&&((r=o.find(t=>(t==null?void 0:t.code)===d))==null?void 0:r.description)||"Description not added"};return e.jsxs(p,{sx:{m:2},children:[e.jsxs(p,{sx:{flex:1,minWidth:"65%"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"Diagnostic Trouble Code Records"}),e.jsx(U,{sx:{mb:2}}),(x||j)&&e.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",height:100,children:e.jsx(F,{})}),e.jsx(p,{sx:{maxHeight:800,overflowY:"auto",pr:1},children:l.map((d,r)=>e.jsxs(w,{sx:{mb:2,p:2,backgroundColor:"#f9f9f9"},children:[e.jsxs(C,{variant:"subtitle1",children:[e.jsx("strong",{children:"Timestamp:"})," ",q(new Date(d.timestamp)).format("DD-MM-YYYY HH:mm")]}),e.jsxs(C,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Fault Count:"})," ",d.faultCount]}),e.jsx(W,{dense:!0,children:d.dtcCodes.map((i,t)=>e.jsx(G,{disablePadding:!0,divider:!0,children:e.jsx(K,{primary:`Hex: ${i.hex} | Dtc code: ${i.dtcCode} | Decimal: ${i.decimalCode}`,secondary:m(i.dtcCode)||"No description"})},i._id))})]},r))})]}),e.jsxs(w,{sx:{width:250,p:3,position:"sticky",bottom:30,left:"60%"},children:[e.jsx(C,{variant:"h6",children:"Actions"}),e.jsx(E,{variant:"contained",color:"error",onClick:n,disabled:j,fullWidth:!0,children:j?e.jsx(Q,{size:24,color:"inherit"}):"Clear DTC"})]})]})};export{ce as SinoCastalLiveParameter,ne as SinoCastalReadDTC,oe as SinoCastalTerminal};
