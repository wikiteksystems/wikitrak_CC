import{b as i,j as n,z as P,y as Ee,D as I,F as G,aO as qe,aj as W,C as v,T as F,bp as Ke,af as $e,bq as Je,U as Xe,aN as Qe}from"./index-BNYJaDkN.js";import{a as be,O as me,u as Ze,G as et,D as tt,b as H,I as nt}from"./esm-DOKnMChN.js";import{d as ot}from"./dayjs.min-DXPIKLiN.js";import{r as at}from"./redTractor-NXgVJyvR.js";import{T as st}from"./TripGraph-C6-SPixG.js";import{B as A,C as lt}from"./CircularProgress-C4G9TMPu.js";import{d as rt}from"./Info-DvFoO2RU.js";import{d as it}from"./Close-gXRuzW4U.js";function we({trip:s,tripPlay:a,onTripEnd:p}){const[l,h]=i.useState([]),[w,r]=i.useState([]),[d,S]=i.useState(0),x=i.useRef(null),f=1e4,[t,E]=i.useState(0);i.useEffect(()=>{if(Array.isArray(s)&&s.length>0){const o=s.filter(c=>(c==null?void 0:c.lat)&&(c==null?void 0:c.lng)).map(c=>({lat:parseFloat(c.lat),lng:parseFloat(c.lng),heading:c.heading||0}));h(o.length>0?o:[])}else h([])},[s]),i.useEffect(()=>{if(a&&l.length>1){S(0),r([]);const o=performance.now(),c=k=>{const m=k-o,y=Math.min(m/f,1);S(y),y<1?x.current=requestAnimationFrame(c):(r([...l]),p())};return x.current=requestAnimationFrame(c),()=>cancelAnimationFrame(x.current)}},[a,l]);const M=i.useMemo(()=>{var T;if(l.length<2||d===0)return l[0]||{lat:0,lng:0};const o=l.length-1,c=Math.floor(d*o),k=Math.min(c+1,o),m=d*o%1,y=l[c]||{lat:0,lng:0},U=l[k]||{lat:0,lng:0},O={lat:y.lat+(U.lat-y.lat)*m,lng:y.lng+(U.lng-y.lng)*m},L=((T=l[c])==null?void 0:T.heading)||0;return E(L),d>0&&a&&r(Y=>[...Y,O]),O},[l,d,a]);return n.jsxs(n.Fragment,{children:[l.length>1&&n.jsx(be,{path:l,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4,geodesic:!1}}),a&&w.length>1&&n.jsx(be,{path:w,options:{strokeColor:"green",strokeOpacity:1,strokeWeight:5,zIndex:1e3,geodesic:!1}}),a&&M.lat!==0&&M.lng!==0&&n.jsx(me,{position:M,mapPaneName:me.OVERLAY_MOUSE_TARGET,children:n.jsx("div",{style:{transform:`rotate(${t+180}deg)`,transition:"transform 0.2s linear",width:"30px",height:"30px",transformOrigin:"center center",position:"absolute",left:"50%",top:"50%",translate:"-50% -50%"},children:n.jsx("img",{src:at,alt:"Tractor",style:{width:"100%",height:"100%"}})})})]})}function dt({tripPlay:s,speed:a,totalDistance:p,Acreage:l,filterCoordinates:h,acreageTrips:w,handleTrip:r,showGraph:d,handleShowGraph:S}){const{selectedTripData:x}=P(E=>E.dashboard);let f=Ee();const t=()=>{var E,M,o;if(console.log("selected trip data",(E=x[0])==null?void 0:E.venderId,w),x.length>0)if(((M=x[0])==null?void 0:M.venderId)==="VT200"||((o=x[0])==null?void 0:o.venderId)==="wtkpltf001")if(Object.keys(w).length>0){let c=0;Object.keys(w).map(k=>{let m=qe(w[k]);c+=m}),console.log("final acerage",c),f(W(c))}else v.error("No acreage trip found");else h(x,f)};return n.jsxs(A,{sx:{bgcolor:I.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",gap:"5px",paddingLeft:"5px",padding:"10px 10px"},children:[n.jsxs(G,{sx:{background:"white",border:"1px solid white",borderRadius:"5px",padding:"5px 20px",color:"black"},onClick:t,children:[" ","Calculate Acerage"]}),n.jsxs(G,{sx:{background:s?"transparent":"white",border:"1px solid white",borderRadius:"5px",height:"38px",padding:"5px 20px",color:s?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{r()},children:[s?"Pause":"Play","-Trip"]}),n.jsxs(G,{style:{height:"38px",padding:"5px 20px"},sx:{background:d?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:d?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{S()},children:[d?"Hide":"Show","-Graph"]})]})}const ct=({label:s,value:a})=>n.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[n.jsx(F,{variant:"body2",color:"textSecondary",children:s}),n.jsx(F,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:a||"N/A"})]}),gt=(s,a)=>(s==null?void 0:s.find(p=>{var l,h;return((h=(l=p.imei)==null?void 0:l[0])==null?void 0:h.mac_id)===a.imei}))||{},Se=({title:s,details:a})=>n.jsx(A,{sx:{width:"45%"},children:a.map(({label:p,value:l})=>n.jsx(ct,{label:p,value:l},p))});function pt({handleVehicleInfo:s,vehicleReport:a,speed:p,totalDistance:l,Acreage:h,tripPlay:w,whereToUse:r}){var o,c,k;const{collapsed:d}=P(m=>m.auth),{vehicleList:S,selectedVehicle:x}=P(m=>m.liveMap),[f,t]=i.useState({});i.useEffect(()=>{t(gt(S,x))},[S,x]),i.useEffect(()=>{},[a]);const E=[{label:"Vehicle No:",value:f==null?void 0:f.registration_id},{label:"Model:",value:(o=f==null?void 0:f.vehicle_model)==null?void 0:o.name},{label:"IMEI No:",value:(k=(c=f==null?void 0:f.imei)==null?void 0:c[0])==null?void 0:k.mac_id},{label:"Chassis No:",value:f==null?void 0:f.chassis_no},{label:"Engine No:",value:f==null?void 0:f.engine_no}],M=[{label:"Equipment:",value:"N/A"},{label:"Avg Speed:",value:(a==null?void 0:a.averageSpeed)||"N/A"},{label:"Total Distance:",value:(a==null?void 0:a.totalDistance)||"N/A"},{label:"Avg trips/day:",value:(a==null?void 0:a.avgTrip)||"N/A"}];return n.jsxs(A,{sx:{position:"absolute",top:"570px",left:d?"280px":"450px",zIndex:1,background:I.bgShadow,p:2,borderRadius:2,color:"white",width:"58%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[n.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[n.jsx(F,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),n.jsx(it,{sx:{cursor:"pointer",color:"black"},onClick:s})]}),r==="TripMonitor"&&n.jsxs(A,{sx:{display:"flex",justifyContent:"flex-start",gap:"10px",paddingBottom:"20px"},children:[n.jsxs(A,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px",width:"150px",display:"flex",justifyContent:"space-evenly",background:I.bgColor},children:[n.jsx(F,{children:"Speed"}),n.jsxs(F,{children:[w?p:0," KM/H"]})]}),n.jsxs(F,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px",background:I.bgColor},children:["Total-Distance ",l," KM"]}),n.jsxs(F,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:I.bgColor},children:[parseFloat(parseFloat(h).toFixed(2)*43560).toFixed()," Sqft"]}),n.jsxs(F,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:I.bgColor},children:[parseFloat(h).toFixed(2)*8," Kanal"]}),n.jsxs(F,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:I.bgColor},children:[parseFloat(parseFloat(h).toFixed(2)*8/5).toFixed(2)," Bigha"]}),n.jsxs(F,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:I.bgColor},children:[parseFloat(h).toFixed(2)," acre"]})]}),n.jsxs(A,{sx:{display:"flex",justifyContent:"space-between"},children:[n.jsx(Se,{title:"Vehicle Details",details:E}),n.jsx(Se,{title:"Trip Details",details:M})]})]})}const ht="/assets/endTrip-CEqIwvWS.png",je="/assets/endTrip_-BsrUUtoJ.png",ye="/assets/startTrip-CGKteKGr.png",ut=(s,a)=>{const h=[];s.length>0&&s.forEach(r=>{let d={latitude:r.lat,longitude:r.lng},S=[];s.forEach(x=>{const f={latitude:x.lat,longitude:x.lng};if(f.latitude&&f.longitude&&f.latitude!==d.latitude&&f.longitude!==d.longitude){const t=ft(r.lat,r.lng,x.lat,x.lng);t<20&&t>10&&S.push(x)}}),S.length>10&&h.push(r)});const w=s.filter(r=>r.lat!==void 0&&r.lng!==void 0).map(r=>({lat:parseFloat(r.lat),lng:parseFloat(r.lng)}));if(w.length>0){a(Je(h));try{const r=xt(w),d=bt(r),S=new window.google.maps.Polygon({paths:d});return mt(S,a)}catch(r){return console.error("Error calculating convex hull or area:",r),a(W(0)),0}}else return a(W(0)),0},xt=s=>{const a=(r,d,S)=>{const x=(d.lat-r.lat)*(S.lng-d.lng)-(d.lng-r.lng)*(S.lat-d.lat);return x===0?0:x>0?1:2},p=s.reduce((r,d)=>d.lng<r.lng?d:r);let l=[],h=p,w;do{l.push(h),w=s[0]===h?s[1]:s[0];for(let r=0;r<s.length;r++)a(h,w,s[r])===2&&(w=s[r]);h=w}while(h!==p);return l};function ft(s,a,p,l){const w=s*Math.PI/180,r=p*Math.PI/180,d=(p-s)*Math.PI/180,S=(l-a)*Math.PI/180,x=Math.sin(d/2)*Math.sin(d/2)+Math.cos(w)*Math.cos(r)*Math.sin(S/2)*Math.sin(S/2);return 6371e3*(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)))}const bt=s=>{s.sort((l,h)=>l.lng-h.lng||l.lat-h.lat);const a=[],p=[];for(const l of s){for(;a.length>=2&&Ce(a[a.length-2],a[a.length-1],l)<=0;)a.pop();a.push(l)}for(let l=s.length-1;l>=0;l--){const h=s[l];for(;p.length>=2&&Ce(p[p.length-2],p[p.length-1],h)<=0;)p.pop();p.push(h)}return[...a.slice(0,-1),...p.slice(0,-1)]},mt=(s,a)=>{if(!window.google||!window.google.maps.geometry){console.log("not loaded");return}const l=window.google.maps.geometry.spherical.computeArea(s.getPath())/4046.86;return a(W(l)),l},Ce=(s,a,p)=>(a.lat-s.lat)*(p.lng-s.lng)-(a.lng-s.lng)*(p.lat-s.lat),wt=({selectedTrip:s,center:a,showCard:p})=>{var re,ie,de,ce,ge,pe,he,ue,xe,fe;const l=Ee(),{isLoaded:h,loadError:w}=Ze({googleMapsApiKey:"AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA",libraries:["drawing","geometry"]}),{Acreage:r}=P(e=>e.tripMonitor),{selectedVehicle:d}=P(e=>e.liveMap),{singleTrip_Data:S,tripLoading:x,cords:f}=P(e=>e.tripMonitor),{selectedTripData:t,mode:E,styles:M,allTripList:o,activeIndex:c}=P(e=>e.dashboard),{collapsed:k}=P(e=>e.auth),[m,y]=i.useState(null),U=i.useRef(null),[O,L]=i.useState(null),[T,Y]=i.useState(null),[J,X]=i.useState([]);i.useState([]);const[N,R]=i.useState(!1),[Q,V]=i.useState(0),[q,Me]=i.useState(!1),[Z,ke]=i.useState(0);i.useState([]),i.useState([]);const[D,ee]=i.useState(!1),[Fe,Ae]=i.useState({}),[z,te]=i.useState([]),[ne,oe]=i.useState(null),[Ie,ae]=i.useState(null),[Pe,ve]=i.useState({}),[se,K]=i.useState(0),[Oe,$]=i.useState([]);i.useEffect(()=>{ee(!0)},[d]),i.useEffect(()=>{(async()=>{if(d!=null&&d.imei){const g=ot(),u=g.startOf("day").format("MM/DD/YYYY HH:mm:ss"),b=g.endOf("day").format("MM/DD/YYYY HH:mm:ss"),j={imei:[d.imei],startDate:u,endDate:b};try{const C=await Xe(j);Ae(C.data[0].data)}catch(C){console.error("Error fetching report:",C)}}})()},[d,l]),i.useEffect(()=>{O&&T&&O.fitBounds(T)},[O,T,t]);let Te=e=>{let g=Qe(e),u={};g.map((b,j)=>{let C=e.slice(b.start,b.end+1);u[j]=C}),ve(u)};i.useEffect(()=>{if(console.log("selectedTripData",t),(t==null?void 0:t.length)>0){let e=t.map(u=>({lat:u.lat,lng:u.lng}));console.log("selected trip coordinate ",e);const g=Ne({selectedTripData:t});ke(g),Te(t)}},[t]);const Ne=({selectedTripData:e})=>{const g=e.reduce((u,b,j)=>{if(j===0)return u;const C=e[j-1],B=Ke(C.lat,C.lng,b.lat,b.lng);return u+B},0);return g==null?void 0:g.toFixed(2)};i.useEffect(()=>{var e,g,u,b,j;if(t&&(t==null?void 0:t.length)>0){const C=new window.google.maps.LatLngBounds,B=new window.google.maps.LatLng(parseFloat((e=t[0])==null?void 0:e.lat),parseFloat((g=t[0])==null?void 0:g.lng)),Le=new window.google.maps.LatLng(parseFloat((u=t[(t==null?void 0:t.length)-1])==null?void 0:u.lat),parseFloat((b=t[(t==null?void 0:t.length)-1])==null?void 0:b.lng));C.extend(B),C.extend(Le),V((j=t[0])==null?void 0:j.speed),Y(C)}R(!1),Re()},[t]),i.useEffect(()=>{if(c==="all"&&o.length>0){const e=new window.google.maps.LatLngBounds;o.forEach(g=>{g.data.forEach(u=>{u.lat&&u.lng&&e.extend(new window.google.maps.LatLng(u.lat,u.lng))})}),Y(e)}},[c,o]);const Re=()=>{if(t&&t.length>0){const e=(b,j)=>{const B=new Date(b.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:b.createdAt.substring(0,10),Time:B,value:b[j]}},u=["speed","mainInputVoltage","ignition"].map(b=>({label:b==="speed"?"Speed":b==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:Ve(),data:t.map(j=>e(j,b))}));X(u)}else X([])},Ve=()=>"#"+Math.floor(Math.random()*16777215).toString(16),ze=()=>{var e;if(c==="all")o&&o.length>0?(R(!N),V(0),K(0),$([])):v.error("No trips found");else if((t==null?void 0:t.length)>0)R(!N),V(0),K(0),$([]);else return((e=Object.keys(t))==null?void 0:e.length)===0?v.error("Please Select Vehicle",{id:"vehicle"}):v.error("Please Select Trip",{id:"trip error"})},_e=()=>{c==="all"&&se<o.length-1?K(e=>e+1):R(!1)},Be=()=>{var e;if((t==null?void 0:t.length)>0)Me(!q);else return((e=Object.keys(t))==null?void 0:e.length)===0?v.error("Please Select Vehicle",{id:"vehicle"}):v.error("Please Select Trip",{id:"trip error"})},le=()=>{Object.keys(d).length>0||D?ee(!D):v.error("Please select any vehicle")};if(w)return"Error loading maps";if(!h)return"Loading maps";const He={width:"100%",height:p?"87vh":"93vh"},Ue=e=>{if(e.type==="polygon"){const g=e.overlay;g.setEditable(!0),te(u=>[...u,g]),oe(g),google.maps.event.addListener(g.getPath(),"set_at",()=>_()),google.maps.event.addListener(g.getPath(),"insert_at",()=>_()),google.maps.event.addListener(g.getPath(),"remove_at",()=>_()),_(g)}},_=(e=null)=>{let g=0;if(z.forEach(u=>{const b=u.getPath().getArray(),j=google.maps.geometry.spherical.computeArea(b);g+=j}),e){const u=e.getPath().getArray(),b=google.maps.geometry.spherical.computeArea(u);g+=b}ae((g/4046.86).toFixed(2))},Ye=()=>{z.forEach(e=>e.setMap(null)),te([]),ae(0),oe(null)},De=()=>{z.forEach(e=>e.setEditable(!0))},Ge=()=>{z.forEach(e=>e.setEditable(!1))},We=()=>{ne?_(ne):alert("No shape is selected. Please draw or select a shape.")};return n.jsxs(n.Fragment,{children:[x&&n.jsx(A,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:n.jsx(lt,{})}),p&&n.jsx(dt,{tripPlay:N,speed:Q,totalDistance:Z,Acreage:r,filterCoordinates:ut,acreageTrips:Pe,handleTrip:ze,showGraph:q,handleShowGraph:Be}),n.jsx(A,{sx:{position:"absolute",top:"765px",left:k?"74px":"250px",zIndex:1,background:I.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:n.jsxs(G,{sx:{color:"white"},onClick:le,children:[D?"Hide":"Show"," Vehicle Info",n.jsx(rt,{})]})}),D===!0&&n.jsx(pt,{handleVehicleInfo:le,vehicleReport:Fe,tripPlay:N,speed:Q,totalDistance:Z,Acreage:r,whereToUse:"TripMonitor"}),n.jsxs(et,{ref:U,mapContainerStyle:He,zoom:10,center:a,onLoad:e=>L(e),options:{styles:E?M:""},children:[n.jsx(tt,{onOverlayComplete:Ue,options:{drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:["polygon"]}}}),n.jsxs("div",{style:{position:"absolute",bottom:30,left:20,background:"white",padding:"10px",borderRadius:"8px",boxShadow:"0 0 6px rgba(0,0,0,0.2)",zIndex:100,width:"auto"},children:[n.jsxs("p",{children:["Area: ",Ie||0," acres"]}),z.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:De,style:{marginTop:"10px",marginRight:"10px"},children:"Enable Editing"}),n.jsx("button",{onClick:Ge,style:{marginTop:"10px",marginRight:"10px"},children:"Disable Editing"}),n.jsx("button",{onClick:We,style:{marginTop:"10px",marginRight:"10px"},children:"Calculate Area"}),n.jsx("button",{onClick:Ye,style:{marginTop:"10px"},children:"Clear All Shapes"})]})]}),c==="all"&&o&&o.length>0&&n.jsx(H,{onClick:()=>y(o[0].data[0]),position:{lat:parseFloat((re=o[0].data[0])==null?void 0:re.lat)+1e-6,lng:parseFloat((ie=o[0].data[0])==null?void 0:ie.lng)+1e-6},animation:"BOUNCE",icon:{url:ye,scaledSize:new google.maps.Size(60,60)}}),c==="all"&&o&&o.length>0&&n.jsx(H,{onClick:()=>y(o[(o==null?void 0:o.length)-1].data[o[(o==null?void 0:o.length)-1].data.length-1]),position:{lat:parseFloat(((de=o[(o==null?void 0:o.length)-1].data[o[(o==null?void 0:o.length)-1].data.length-1])==null?void 0:de.lat)+1e-6),lng:parseFloat(((ce=o[(o==null?void 0:o.length)-1].data[o[(o==null?void 0:o.length)-1].data.length-1])==null?void 0:ce.lng)+1e-6)},animation:"BOUNCE",icon:{url:je,scaledSize:new google.maps.Size(60,60)}}),t&&(t==null?void 0:t.length)>0&&n.jsx(H,{onClick:()=>y(t[0]),position:{lat:parseFloat((ge=t[0])==null?void 0:ge.lat)+1e-6,lng:parseFloat((pe=t[0])==null?void 0:pe.lng)+1e-6},animation:"BOUNCE",icon:{url:ye,scaledSize:new google.maps.Size(60,60)}}),t&&(t==null?void 0:t.length)>0&&n.jsx(H,{onClick:()=>y(t[(t==null?void 0:t.length)-1]),position:{lat:parseFloat(((he=t[(t==null?void 0:t.length)-1])==null?void 0:he.lat)+1e-5),lng:parseFloat(((ue=t[(t==null?void 0:t.length)-1])==null?void 0:ue.lng)+1e-6)},animation:"BOUNCE",icon:{url:je,scaledSize:new google.maps.Size(60,60)}}),c==="all"&&o&&o.length>0&&o.map((e,g)=>{var u,b;return n.jsx(H,{position:{lat:parseFloat((u=e==null?void 0:e.data[(e==null?void 0:e.data.length)-1])==null?void 0:u.lat),lng:parseFloat((b=e==null?void 0:e.data[(e==null?void 0:e.data.length)-1])==null?void 0:b.lng)},onClick:()=>y(e==null?void 0:e.data[(e==null?void 0:e.data.length)-1]),label:{text:(g+1).toString(),color:"white",fontWeight:"bold",fontSize:"14px"},animation:"BOUNCE",icon:{url:ht,scaledSize:new google.maps.Size(40,40)}},g)}),m&&n.jsx(nt,{position:{lat:parseFloat(m==null?void 0:m.lat),lng:parseFloat(m==null?void 0:m.lng)},onCloseClick:()=>y(null),children:n.jsxs("div",{children:["Date-time:",m!=null&&m.Date?$e(new Date(m==null?void 0:m.Date)).format("DD-MM-YYYY HH:mm"):""]})}),t&&t.length>0&&n.jsx(we,{trip:t,tripPlay:N,setSpeed:V,onTripEnd:()=>R(!1)}),c==="all"&&o&&o.length>0&&o.map((e,g)=>n.jsx(we,{trip:e==null?void 0:e.data,tripPlay:g===se?N:!1,setSpeed:V,onTripEnd:_e,globalMarkerPath:Oe,setGlobalMarkerPath:$},e==null?void 0:e.id)),n.jsx("div",{style:{position:"relative",top:200,left:12,color:"green"},children:((fe=(xe=J[0])==null?void 0:xe.data)==null?void 0:fe.length)>0&&q&&n.jsx(st,{item:J})})]})]})},At=wt;export{At as T,ut as f};
