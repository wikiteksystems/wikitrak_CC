import{k as W,r as _,i as G,aF as ie,aO as le,bo as re,w as y,aQ as J,aT as H,aU as A,P as ae,j as e,T as R,B as T,bp as P,ak as Q,t as V,I as z}from"./index-LVpq-JUD.js";import{d as K}from"./Close-DdDboBFE.js";import{d as I}from"./Add-B-nOl889.js";import{u as ne,F as X}from"./formik.esm-CuUSKd2Q.js";import{c as $,a as m}from"./index.esm-DH1TTYC-.js";import{B as F}from"./menu2-DFxe3FzO.js";import{A as D}from"./Autocomplete-C0D0qjeR.js";import{T as u,M as Y}from"./TextField-F3KWkeiF.js";import{S as se}from"./SearchInput-Br1BxDRQ.js";import{u as Z}from"./useMediaQuery-BjZvOF1w.js";import{D as U,a as ee}from"./TablePagination-DkgCDaX8.js";import{D as oe}from"./Edit-B_liLkTS.js";function ce(){var d,s;const{vehicles_details:x}=W(t=>t.dashboard),{w_customer_id:f}=W(t=>t.auth),{breakdownTopics:g,UpdatedBreakdownData:i}=W(t=>t.breakdown),[v,N]=_.useState(null),[S,q]=_.useState(""),[C,j]=_.useState(!1),[L,w]=_.useState(!1),[k,p]=_.useState("");let c=G();_.useEffect(()=>{i&&(N(i.attachment),q("edit"))},[i]);const o=ne({initialValues:{vehicle:((d=i==null?void 0:i.vehicle)==null?void 0:d.id)||"",breakdown_topic:((s=i==null?void 0:i.breakdown_topic)==null?void 0:s.id)||"",odometer_reading:(i==null?void 0:i.odometer_reading)||"",description:(i==null?void 0:i.description)||"",mob_no:(i==null?void 0:i.mob_no)||"",email:(i==null?void 0:i.email)||"",attachment:(i==null?void 0:i.attachment)||"",location:(i==null?void 0:i.location)||""},validationSchema:$({vehicle:m().required("Vehicle is required"),breakdown_topic:m().required("Breakdown Topic is required"),odometer_reading:m().required("Odometer Reading is required"),description:m().required("Description is required"),mob_no:m().matches(/^\d{10,11}$/,"Mobile number must be 10-11 digits").required("Mobile number is required"),email:m().email("Invalid email format").required("Email is required"),location:m().required("Location is required")}),onSubmit:async(t,{resetForm:n})=>{var h,b,B;try{j(!0),console.log("Submitted values:",t);const M=l(t.vehicle);t.user=M[0].user.id,t.status="Open",t.workshop_group=(B=(b=(h=M[0])==null?void 0:h.workShop)==null?void 0:b.group_name)==null?void 0:B.id,t.submission_date=new Date().toISOString().split("T")[0];let E;if(i){let O=await ie(i.attachment);console.log("file conversion",O),t.attachment=O;const te=i.id;E=await c(le({values:t,id:te}))}else E=await c(re(t));if(E.payload.success)y.success("Breakdown submitted successfully!"),n(),q(""),N(null),c(J(null)),c(H(!1)),c(A(!1)),c(ae(f)),j(!1);else throw j(!1),new Error(E.payload.error||"Failed to submit breakdown")}catch(M){console.error("Submission Error:",M),y.error("Failed to submit breakdown. Please try again.")}}}),a=async()=>{w(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(async t=>{const{latitude:n,longitude:h}=t.coords;try{const b=await P(n,h);o.setFieldValue("location",b)}catch(b){console.error("Error fetching address:",b),y.error("Failed to convert coordinates to address.")}finally{w(!1)}},t=>{console.error("Geolocation Error:",t),y.error("Failed to retrieve location. Please try again."),w(!1)}):(y.error("Geolocation is not supported by this browser."),w(!1))},l=t=>(x==null?void 0:x.length)>0&&x.filter(h=>h.id===t),r=t=>{const n=t.currentTarget.files[0];if(o.setFieldValue("attachment",n),q((n==null?void 0:n.name)||""),n&&n.type.startsWith("image/")){const h=new FileReader;h.onload=()=>N(h.result),h.readAsDataURL(n)}else N(null)};return e.jsx(F,{sx:{p:3,maxWidth:600,margin:"auto"},children:C?e.jsx(R,{children:"Submitted the form data..."}):e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:o.handleSubmit,children:[e.jsx(D,{options:x,getOptionLabel:t=>t.registration_id,value:x.find(t=>t.id===o.values.vehicle)||null,onChange:(t,n)=>o.setFieldValue("vehicle",(n==null?void 0:n.id)||""),renderInput:t=>e.jsx(u,{...t,label:"Vehicle",error:o.touched.vehicle&&!!o.errors.vehicle,helperText:o.touched.vehicle&&o.errors.vehicle,fullWidth:!0})}),e.jsx(D,{options:g,getOptionLabel:t=>t.topic,value:g.find(t=>t.id===o.values.breakdown_topic)||null,onChange:(t,n)=>o.setFieldValue("breakdown_topic",(n==null?void 0:n.id)||""),renderOption:(t,n)=>_.createElement("li",{...t,key:n.id},n.topic),renderInput:t=>e.jsx(u,{...t,label:"Breakdown Topic",error:o.touched.breakdown_topic&&!!o.errors.breakdown_topic,helperText:o.touched.breakdown_topic&&o.errors.breakdown_topic,fullWidth:!0,sx:{mt:2}})}),e.jsx(u,{label:"Odometer Reading",name:"odometer_reading",value:o.values.odometer_reading,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.odometer_reading&&!!o.errors.odometer_reading,helperText:o.touched.odometer_reading&&o.errors.odometer_reading,fullWidth:!0,sx:{mt:2}}),e.jsx(u,{label:"Description",name:"description",value:o.values.description,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.description&&!!o.errors.description,helperText:o.touched.description&&o.errors.description,fullWidth:!0,sx:{mt:2}}),e.jsx(u,{label:"Mobile Number",name:"mob_no",value:o.values.mob_no,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.mob_no&&!!o.errors.mob_no,helperText:o.touched.mob_no&&o.errors.mob_no,fullWidth:!0,sx:{mt:2}}),e.jsx(u,{label:"Email",name:"email",type:"email",value:o.values.email,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.email&&!!o.errors.email,helperText:o.touched.email&&o.errors.email,fullWidth:!0,sx:{mt:2}}),e.jsx(u,{label:"Location",name:"location",value:k||o.values.location,onChange:t=>{p(t.target.value),o.setFieldValue("location",t.target.value)},onBlur:o.handleBlur,error:o.touched.location&&!!o.errors.location,helperText:o.touched.location&&o.errors.location,fullWidth:!0,sx:{mt:2}}),e.jsx(T,{variant:"outlined",onClick:a,disabled:L,sx:{mt:2},children:L?"Fetching Location...":"Use Current Location"}),e.jsxs(T,{component:"label",sx:{mt:2,border:"1px solid #f5f5f5",color:"black"},children:["Upload Attachment",e.jsx("input",{type:"file",hidden:!0,onChange:r})]}),S&&e.jsxs(R,{variant:"body2",sx:{mt:1},children:["Uploaded File: ",S]}),v&&e.jsx(F,{component:"img",src:v,alt:"Image Preview",sx:{mt:1,width:"100%",maxHeight:200}}),e.jsx(T,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3},children:"Submit"})]})})})}const de="http://128.199.28.173/api/v1",me=()=>{const{vehicleList:x}=W(a=>a.liveMap),f=Z("(min-width:600px)"),[g,i]=_.useState(!1),[v,N]=_.useState(!1),S=a=>{const{firstName:l,lastName:r,email:d,mobile:s,password:t}=a;console.log("Form Submitted:",a);let n={first_name:l,last_name:r,email:d,mobile:s,password:t};try{Q.post(`${de}/users/new/user/register/`,n).then(b=>{console.log("res",b);let B={}})}catch(h){console.log(h)}},q=async a=>{i(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(async l=>{const{latitude:r,longitude:d}=l.coords;try{const s=await P(r,d);a("location",s)}catch(s){console.error("Error fetching address:",s),y.error("Failed to convert coordinates to address.")}finally{i(!1)}},l=>{console.error("Geolocation Error:",l),y.error("Failed to retrieve location. Please try again."),i(!1)}):(y.error("Geolocation is not supported by this browser."),i(!1))},C=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,j=$().shape({firstName:m().required("required"),lastName:m().required("required"),fullName:m(),vehicleNo:m(),model:m(),email:m().email("invalid email").required("required"),mobile:m().matches(C,"Phone number is not valid").required("required"),location:m(),password:m().required("required"),description:m()}),L=JSON.parse(localStorage.getItem("w_userDetails")),{email:w,first_name:k,last_name:p,mobile:c}=L,o={firstName:k||"",lastName:p||"",fullName:`${k} ${p}`||"",vehicleNo:"",email:w||"",model:"",mobile:c||"",location:"",password:"",description:""};return e.jsxs(F,{m:"20px",children:[v&&e.jsx("h1",{children:"Loading"}),e.jsx(X,{onSubmit:S,initialValues:o,validationSchema:j,children:({values:a,errors:l,touched:r,handleBlur:d,handleChange:s,handleSubmit:t,setFieldValue:n})=>e.jsxs("form",{onSubmit:t,children:[e.jsxs(F,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:f?void 0:"span 4"}},children:[e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"First Name",onBlur:d,onChange:s,value:a.firstName,name:"firstName",error:!!r.firstName&&!!l.firstName,helperText:r.firstName&&l.firstName,sx:{gridColumn:"span 2"}}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Last Name",onBlur:d,onChange:s,value:a.lastName,name:"lastName",error:!!r.lastName&&!!l.lastName,helperText:r.lastName&&l.lastName,sx:{gridColumn:"span 2"}}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Full Name",onBlur:d,onChange:s,value:a.fullName,name:"fullName",error:!!r.fullName&&!!l.fullName,helperText:r.fullName&&l.fullName,sx:{gridColumn:"span 2"}}),e.jsx(u,{fullWidth:!0,select:!0,variant:"filled",label:"Vehicle No",onBlur:d,onChange:h=>{const b=x.find(B=>B.id===h.target.value);n("vehicleNo",h.target.value),n("model",(b==null?void 0:b.vehicle_model.name)||"")},value:a.vehicleNo,name:"vehicleNo",error:!!r.vehicleNo&&!!l.vehicleNo,helperText:r.vehicleNo&&l.vehicleNo,sx:{gridColumn:"span 2"},children:x.map(h=>e.jsx(Y,{value:h.id,children:h.registration_id},h.id))}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Email",onBlur:d,onChange:s,value:a.email,name:"email",error:!!r.email&&!!l.email,helperText:r.email&&l.email,sx:{gridColumn:"span 2"}}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Model",value:a==null?void 0:a.model,name:"model",disabled:!0,sx:{gridColumn:"span 2"}}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Mobile",onBlur:d,onChange:s,value:a.mobile,name:"mobile",error:!!r.mobile&&!!l.mobile,helperText:r.mobile&&l.mobile,sx:{gridColumn:"span 2"}}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"password",label:"Password",onBlur:d,onChange:s,value:a.password,name:"password",error:!!r.password&&!!l.password,helperText:r.password&&l.password,sx:{gridColumn:"span 2"}}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Location",onBlur:d,onChange:s,value:a.location,name:"location",disabled:!0,error:!!r.location&&!!l.location,helperText:r.location&&l.location,sx:{gridColumn:"span 2"}}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Description",onBlur:d,onChange:s,value:a.description,name:"description",error:!!r.description&&!!l.description,helperText:r.description&&l.description,sx:{gridColumn:"span 2"}}),e.jsx(T,{variant:"outlined",onClick:()=>q(n),disabled:g,sx:{mt:-2,width:"300px"},children:g?"Fetching Location...":"Use Current Location"})]}),e.jsx(F,{display:"flex",justifyContent:"center",mt:"25px",children:e.jsx(T,{type:"submit",color:"secondary",variant:"contained",children:"Submit"})})]})})]})},ue=()=>{const x=Z("(min-width:600px)"),[f,g]=_.useState(!1),i=p=>{console.log("Form Submitted:",p)},v=async p=>{g(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(async c=>{const{latitude:o,longitude:a}=c.coords;try{const l=await P(o,a);p("location",l)}catch(l){console.error("Error fetching address:",l),y.error("Failed to convert coordinates to address.")}finally{g(!1)}},c=>{console.error("Geolocation Error:",c),y.error("Failed to retrieve location. Please try again."),g(!1)}):(y.error("Geolocation is not supported by this browser."),g(!1))},N=$().shape({fullName:m().required("required"),vehicleNo:m().required("required"),model:m().required("required"),location:m().required("required"),description:m().required("required")}),S=JSON.parse(localStorage.getItem("w_userDetails")),{email:q,first_name:C,last_name:j,mobile:L}=S,w={fullName:`${C} ${j}`||"",vehicleNo:"",model:"",location:"",description:""},k=[{label:"Vehicle A",value:"vehicle_a",model:"Model A1"},{label:"Vehicle B",value:"vehicle_b",model:"Model B1"},{label:"Vehicle C",value:"vehicle_c",model:"Model C1"},{label:"Vehicle D",value:"vehicle_d",model:"Model D1"}];return e.jsx(F,{m:"20px",children:e.jsx(X,{onSubmit:i,initialValues:w,validationSchema:N,children:({values:p,errors:c,touched:o,handleBlur:a,handleChange:l,handleSubmit:r,setFieldValue:d})=>e.jsxs("form",{onSubmit:r,children:[e.jsxs(F,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:x?void 0:"span 4"}},children:[e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Full Name",onBlur:a,onChange:l,value:p.fullName,name:"fullName",error:!!o.fullName&&!!c.fullName,helperText:o.fullName&&c.fullName,sx:{gridColumn:"span 4"}}),e.jsx(u,{fullWidth:!0,select:!0,variant:"filled",label:"Vehicle No",onBlur:a,onChange:s=>{const t=k.find(n=>n.value===s.target.value);d("vehicleNo",s.target.value),d("model",(t==null?void 0:t.model)||"")},value:p.vehicleNo,name:"vehicleNo",error:!!o.vehicleNo&&!!c.vehicleNo,helperText:o.vehicleNo&&c.vehicleNo,sx:{gridColumn:"span 4"},children:k.map(s=>e.jsx(Y,{value:s.value,children:s.label},s.value))}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Model",value:p.model,name:"model",disabled:!0,sx:{gridColumn:"span 4"}}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Description",onBlur:a,onChange:l,value:p.description,name:"description",error:!!o.description&&!!c.description,helperText:o.description&&c.description,sx:{gridColumn:"span 4"}}),e.jsx(u,{fullWidth:!0,variant:"filled",type:"text",label:"Location",onBlur:a,onChange:l,value:p.location,name:"location",disabled:!0,error:!!o.location&&!!c.location,helperText:o.location&&c.location,sx:{gridColumn:"span 4"}}),e.jsx(T,{variant:"outlined",onClick:()=>v(d),disabled:f,sx:{mt:-2,width:"300px"},children:f?"Fetching Location...":"Use Current Location"})]}),e.jsx(F,{display:"flex",justifyContent:"center",mt:"25px",children:e.jsx(T,{type:"submit",color:"secondary",variant:"contained",children:"Submit"})})]})})})},pe="http://128.199.28.173/api/v1";function ke({where:x,isAdd:f,isUpdate:g,setIsUpdate:i,setIsAdd:v}){const{isAddBreakdown:N,isUpdateBreakdown:S,UpdatedBreakdownData:q}=W(p=>p.breakdown);let C=G();const j=()=>{C(A(!1)),C(H(!1)),C(J(null)),v(!1),i(!1)},L=()=>{C(A(!N))},w=async()=>{var a,l;const p=JSON.parse(localStorage.getItem("w_userDetails")),{email:c}=p;let o={email:c};try{Q.post(`${pe}/users/check/user`,o).then(d=>{i(!0),v(!0)}).catch(d=>{console.log("error",d)})}catch(r){console.log("eror",r),(l=(a=r==null?void 0:r.response)==null?void 0:a.data)!=null&&l.success||(v(!0),i(!1))}},k={fontSize:"18px",fontWeight:500,lineHeight:"18.38px",textAlign:"center",paddingTop:"5px",fontFamily:"ubuntu"};return e.jsxs(F,{sx:{bgcolor:"white",m:"10px",display:"flex",textAlign:"left",justifyContent:"space-between",alignItems:"center",borderRadius:"6px",padding:"20px"},children:[e.jsx(R,{variant:"h6",sx:k,children:`${x} New Requests`}),e.jsx(se,{}),x.toLowerCase()==="breakdown"&&e.jsxs(T,{onClick:L,sx:{color:"black",background:V.bgColor},children:[e.jsx(I,{}),x]}),x.toLowerCase()==="rsa"&&e.jsxs(T,{onClick:w,sx:{color:"black",background:V.bgColor},children:[e.jsx(I,{}),"Raise ticket"]}),e.jsxs(U,{open:N||S,onClose:j,maxWidth:"md",fullWidth:!0,children:[e.jsxs(oe,{children:[S?"Update":"Add"," Breakdown",e.jsx(z,{"aria-label":"close",onClick:j,sx:{position:"absolute",right:8,top:8,color:p=>p.palette.grey[500]},children:e.jsx(K,{})})]}),e.jsx(ee,{children:e.jsx(ce,{})})]}),e.jsx(he,{isAdd:f,isUpdate:g,setIsUpdate:i,setIsAdd:v,handleClose:j})]})}const he=({isAdd:x,isUpdate:f,handleClose:g})=>(console.log("idupdate",f,x),e.jsxs(U,{open:x,onClose:g,maxWidth:"md",fullWidth:!0,children:[e.jsxs(oe,{children:[f?"Ticket For RSA":"Registration form for RSA",e.jsx(z,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8,color:i=>i.palette.grey[500]},children:e.jsx(K,{})})]}),e.jsx(ee,{children:f?e.jsx(ue,{}):e.jsx(me,{})})]}));export{ke as A};
