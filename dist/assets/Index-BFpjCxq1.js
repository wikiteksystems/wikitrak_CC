import{p as A,r as l,j as e,cn as te,aR as ae,co as re,cp as ie,cq as K,cr as p,cs as ne,B as T,T as De,C as X,V as U,o as H,d2 as ce,d3 as Se,d4 as me,d5 as Ce,ag as ke,ah as Ae,ai as Te,aj as Le,m as we,d6 as Ee,d7 as Ie,d8 as Re,ak as Oe,d9 as Me,da as Pe,O as W,db as Ve,R as de,J as ee,a5 as Ne,dc as $e,M as Be,A as Fe,cM as he,N as Ge,aL as Ye,x as pe,dd as ye,ad as He,de as We,df as Ue,$ as ze,dg as ue,dh as ge,di as xe,dj as fe,dk as qe,a0 as Ke,a1 as Xe,a2 as Je,a4 as Qe,a6 as Ze,U as es,v as ss,W as ts,X as as,dl as rs}from"./index-D58bEPpO.js";import{D as _e,P as oe,a as is}from"./DateTimePicker-E3jSMjJQ.js";import{R as ns,B as os,x as ls,X as cs,Y as ds,y as hs,z as ps,E as us}from"./BarChart-DwRNlzJB.js";import{u as se,w as gs}from"./excelUtils-CIqDKLZ-.js";import{S as B}from"./index-Bww4uZJ7.js";import{D as xs}from"./DialogContentText-BYI-qSVO.js";import{E as fs,T as je}from"./Edit-DBn3Jx3n.js";import{S as js}from"./ServiceRecordTable-BSvCN4XR.js";import"./Loader-wlkYlbAq.js";import"./index-BIyco3rD.js";import"./TextField-DenrDSLS.js";import"./index.esm-W-7zsHkT.js";import"./ServiceJobCard-szyzfs7L.js";import"./formik.esm-BJdXKJ3s.js";import"./Autocomplete-dSkUzWNC.js";import"./Remove-6EWqKD1K.js";import"./Card-DhsXIvNU.js";import"./CardContent-BUgEzqNd.js";const vs=()=>{const{driver_behavior:v,driver_behavior_data:f,multipleVehicleReportsData:u}=A(x=>x.dashboard),{vehicleList:C}=A(x=>x.liveMap),{report:c}=A(x=>x.report);l.useEffect(()=>{},[u,c,v,f]);const L=()=>e.jsx("div",{style:{textAlign:"center"},children:e.jsx("span",{style:{color:"#8884d8",marginRight:10},children:"🟪 Total Distance (in km)"})});let s=u.map(x=>{var S;return{imei:((S=C.find(b=>{var D,t;return((D=b==null?void 0:b.imei)==null?void 0:D.length)>0&&((t=b.imei[0])==null?void 0:t.mac_id)==x.imei}))==null?void 0:S.registration_id)||"",totalDistance:parseFloat(x.data.totalDistance_).toFixed(2)}});return e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{textAlign:"center"},children:"Total Distance covered by vehicle"}),e.jsx(ns,{width:"100%",height:"80%",children:e.jsxs(os,{data:s,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(ls,{strokeDasharray:"3 3"}),e.jsx(cs,{dataKey:"imei",angle:-45,textAnchor:"end"}),e.jsx(ds,{label:{value:"Distance (km)",angle:-90,position:"insideLeft"}}),e.jsx(hs,{}),e.jsx(ps,{dataKey:"totalDistance",fill:"#8884d8"}),e.jsx(us,{content:L,wrapperStyle:{position:"relative",top:-10}})]})})]})};function bs({countAlerts:v}){const{driver_behavior:f}=A(o=>o.dashboard),{report:u}=A(o=>o.report),{driver_behavior_data:C,multipleVehicleReportsData:c}=A(o=>o.dashboard),{vehicleList:L}=A(o=>o.liveMap);l.useEffect(()=>{},[c,C]);let s=c.reduce((o,g)=>{var w;return o+=parseFloat((w=g==null?void 0:g.data)==null?void 0:w.totalDistance_)||0},0),x=c.reduce((o,g)=>{var w;return o+=parseFloat((w=g==null?void 0:g.data)==null?void 0:w.runningTime_)||0},0),d=c.reduce((o,g)=>{var w;return o+=parseFloat((w=g==null?void 0:g.data)==null?void 0:w.averageSpeed_)||0},0),S=C.reduce((o,g)=>o+=parseFloat(g.steadyTime),0),b=C.reduce((o,g)=>o+=parseFloat(g.overSpeedTime),0);const D=o=>{const g=Math.floor(o/3600),w=Math.floor(o%3600/60);return(o%60).toFixed(0),`${g}.${w}`},t=[{category:"Driving Metrics",metric:"Km Driven",value:(c==null?void 0:c.length)>0?`${parseFloat(s).toFixed(2)} km`:"0 km"},{category:"Driving Metrics",metric:"Hrs Driven",value:`${parseFloat(D(x)).toFixed(2)} hrs`},{category:"Driving Metrics",metric:"Idle Time",value:C&&S&&!isNaN(S)?`${D(S)} hrs`:"0 hrs"},{category:"Driving Metrics",metric:"Overspeed Time",value:C&&b&&!isNaN(b)?D(b):"0 hrs  "},{category:"Driving Metrics",metric:"Avg. Speed",value:(c==null?void 0:c.length)>0?`${(d/c.length).toFixed(2)} km/h`:"0 km/h"},{category:"Alerts",metric:"Outward Alerts",value:v.outward},{category:"Alerts",metric:"Inward Alerts",value:v.inward},{category:"Alerts",metric:"Speed Alerts",value:v.speed}],O=t.filter(o=>o.category==="Driving Metrics"),R=t.filter(o=>o.category==="Alerts");return e.jsx(te,{component:ae,sx:{maxWidth:800,margin:"auto",mt:"20px"},children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(K,{children:[e.jsx(p,{sx:{fontWeight:"bold",textAlign:"center",backgroundColor:"primary.light",color:"white"},colSpan:2,children:"Driving Metrics"}),e.jsx(p,{sx:{fontWeight:"bold",textAlign:"center",backgroundColor:"primary.light",color:"white"},colSpan:2,children:"Alerts"})]})}),e.jsx(ne,{children:O.map((o,g)=>e.jsxs(K,{children:[e.jsx(p,{children:o.metric}),e.jsx(p,{sx:{textAlign:"right"},children:o.value}),R[g]?e.jsxs(e.Fragment,{children:[e.jsx(p,{children:R[g].metric}),e.jsx(p,{sx:{textAlign:"right"},children:R[g].value})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{}),e.jsx(p,{})]})]},g))})]})})}function Z({handleBack:v,downloadData:f}){l.useEffect(()=>{},[f]);const u=()=>{if(f.length===0){U.error("No data available for download.");return}const C=se.json_to_sheet(f),c=se.book_new();se.book_append_sheet(c,C,"Sheet1"),gs(c,"Report.xlsx"),U.success("Excel file downloaded successfully!")};return e.jsx(T,{sx:{backgroundColor:"white",mb:2,display:"flex",textAlign:"center",justifyContent:"end",alignItems:"center",padding:"10px 20px",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsxs(T,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{sx:{fontWeight:"bold",mr:1},children:"Download In:"}),e.jsx(X,{variant:"outlined",onClick:u,sx:{borderColor:"green",color:"green","&:hover":{backgroundColor:"green",color:"white"}},children:"EXCEL"})]})})}const Ds=v=>{const f=Math.floor(v/3600),u=Math.floor(v%3600/60);return(v%60).toFixed(0),`${f}.${u}`},ve={outward:0,inward:0,speed:0};function ys({handleBack:v,setStartDate:f,startDate:u,setEndDate:C,endDate:c}){const{alerts:L,allAlerts:s}=A(r=>r.report),{driver_behavior:x,driver_behavior_data:d,multipleVehicleReportsData:S}=A(r=>r.dashboard),{report:b}=A(r=>r.report),{vehicleGroup:D,vehicleList:t}=A(r=>r.liveMap),[O,R]=l.useState(ve),[o,g]=l.useState([]),[w,k]=l.useState([]),[y,h]=l.useState([]),[M,a]=l.useState("All"),[_,P]=l.useState(null),[i,n]=l.useState(!1),E=H();l.useEffect(()=>{const r={...ve};s.forEach(m=>{m.type==="Geofence Alert"?m.geofance_type==="inward"?r.inward+=1:m.geofance_type==="outward"&&(r.outward+=1):m.type==="Speed Alert"&&(r.speed+=1)}),R(r);const j=[{name:"Outward Alerts",value:r.outward},{name:"Inward Alerts",value:r.inward},{name:"Speed Alerts",value:r.speed}];k(j)},[s]),l.useEffect(()=>{if(D&&D.length>0){let r=D.map(j=>({...j,label:j.group_name,value:j.id}));h(r)}},[D,t]);const Y=r=>{let j=t.find(m=>{var G;return((G=m==null?void 0:m.imei[0])==null?void 0:G.mac_id)==r});return(j==null?void 0:j.registration_id)||r},F=(r,j,m)=>{console.log("data1",r),console.log("data2",j),console.log("data3",m);let G=r.map(I=>{var le;let Q=(le=j.find(q=>q.imei===I.imei))==null?void 0:le.data;const z={outward:0,inward:0,speed:0};return m.forEach(q=>{q.imei===I.imei&&(q.type==="Geofence Alert"?q.geofance_type==="inward"?z.inward+=1:q.geofance_type==="outward"&&(z.outward+=1):q.type==="Speed Alert"&&(z.speed+=1))}),{...I,...Q,...z}});console.log("vehicle report data",G);let J=G.map(I=>({"Vehicle Name":Y(I.imei),"IMEI NO":I.imei,"KM Driven":I.totalDistance,"Hrs Driven":I.runningTime,"Idel Time":I!=null&&I.steadyTime&&!isNaN(I==null?void 0:I.steadyTime)?`${Ds(I==null?void 0:I.steadyTime)} hrs`:"0 hrs","Over speed time":I.overSpeedTime,"Avg speed":I.averageSpeed,"Outward alert":I.outward,"Inward alert":I.inward,"Speed alert":I.speed}));g(J)};l.useEffect(()=>{d.length>0&&ce.length>0&&F(d,S,s)},[d,S,s]);function N(r){console.log("value changed",r),a(r)}const $=async()=>{n(!0);try{const r=E(ce({imei:_,startDate:u,endDate:c})),j=E(me({imei:_,startDate:u,endDate:c})),m=E(Ce({imeiList:_,startDate:u,endDate:c}));await Promise.all([r,j,m]),n(!1),console.log("Report fetched successfully.")}catch(r){n(!1),console.error("Error fetching report:",r),U.error("An error occurred while fetching the report.")}},V=M==="All"?t:t.filter(r=>r.vehicle_group===M);return e.jsxs(T,{sx:{width:"100%",padding:"10px"},children:[i&&e.jsx(Se,{}),e.jsx(Z,{handleBack:v,downloadData:o}),e.jsxs(T,{children:[e.jsxs(B,{size:"large",value:M,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:N,filterOption:(r,j)=>{var m;return typeof((m=j==null?void 0:j.props)==null?void 0:m.children)=="string"&&j.props.children.toLowerCase().indexOf(r.toLowerCase())>=0},children:[e.jsx(B.Option,{value:"All",children:"All"}),y.map((r,j)=>e.jsx(B.Option,{value:r.value,children:r.label},j))]}),e.jsxs(B,{size:"large",mode:"multiple",showSearch:!0,value:_||[],style:{width:300,margin:"10px"},placeholder:"Select vehicles",maxTagCount:1,maxTagPlaceholder:r=>`+${r.length} more`,optionFilterProp:"children",onChange:r=>{r.includes("all")?(_==null?void 0:_.length)===V.length?P([]):P(V.map(j=>{var m;return(m=j.imei[0])==null?void 0:m.mac_id})):P(r)},filterOption:(r,j)=>{var m,G;return(G=(m=j==null?void 0:j.children)==null?void 0:m.toLowerCase())==null?void 0:G.includes(r.toLowerCase())},children:[e.jsx(B.Option,{value:"all",children:"Select All Vehicles"},"all"),V&&V.length>0&&V.map((r,j)=>{var m;return e.jsx(B.Option,{value:(m=r.imei[0])==null?void 0:m.mac_id,children:r.registration_id},j)})]}),e.jsx(_e,{setStartDate:f,setEndDate:C,selectedDate:!1}),e.jsx(X,{variant:"contained",style:{width:200,marginLeft:"10px"},onClick:$,disabled:!_,children:"Generate report"})]}),e.jsxs(T,{sx:{display:"flex",gap:"10px"},children:[e.jsx(T,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(oe,{chartData:w,title:"Alerts Distribution"})}),e.jsxs(T,{sx:{width:"60%",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(De,{variant:"h6",sx:{fontWeight:600,textAlign:"center",m:"0 30px"}}),e.jsx(vs,{})]})]}),e.jsx(bs,{countAlerts:O})]})}const _s=({open:v,onClose:f,onConfirm:u})=>e.jsxs(ke,{open:v,onClose:f,children:[e.jsx(Ae,{children:"Confirm Deletion"}),e.jsx(Te,{children:e.jsxs(xs,{children:["Are you sure you want to delete this vehicle data?"," ",e.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),e.jsxs(Le,{children:[e.jsx(X,{onClick:f,color:"primary",children:"Cancel"}),e.jsx(X,{onClick:u,color:"secondary",children:"Delete"})]})]}),Ss="https://cc.wikitrak.in/api-proxy/api/v1",ms={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Cs=({inspectionData:v,status:f})=>{const u=H(),{isUpdateInspection:C}=A(S=>S.inspection),[c,L]=l.useState(!1),s=()=>{localStorage.getItem("role"),u(Ee(!C)),u(Ie(v)),u(Re(v))},x=async()=>{console.log("Vehicle data deleting");try{await Oe.delete(`${Ss}/vehicles/delete/${vehicleData.id}/`),U.success("Vehicle data deleted successfully!"),u(Me())}catch(S){console.error("Error deleting vehicle data:",S),U.error("Failed to delete vehicle data. Please try again.")}L(!1)},d=()=>{L(!1)};return e.jsxs(T,{sx:ms,children:[e.jsx(we,{onClick:s,color:"primary","aria-label":"edit record",disabled:(f==null?void 0:f.toLowerCase())==="rejected"||(f==null?void 0:f.toLowerCase())==="close",children:e.jsx(fs,{})}),e.jsx(_s,{open:c,onClose:d,onConfirm:x})]})},ks=[{id:"BDID",label:"BDID"},{id:"Vehicle",label:"Vehicle"},{id:"User",label:"User"},{id:"SubmissionDate",label:"Submission Date"},{id:"SubmissionTime",label:"Submission Time"},{id:"WorkshopGroup",label:"Workshop Group"},{id:"Status",label:"Status"}],As=({where:v})=>{const{breakdowns:f}=A(a=>a.breakdown),u=H(),{searchTerm:C,inspectionHistory:c}=A(a=>a.inspection),[L,s]=l.useState("asc"),[x,d]=l.useState("BDID"),[S,b]=l.useState(0),[D,t]=l.useState(7),[O,R]=l.useState({id:"",status:"",workshop:"",user:""});l.useEffect(()=>{u(Pe({}))},[]);const o=a=>{s(x===a&&L==="asc"?"desc":"asc"),d(a)},g=(a,_)=>{b(_)},w=a=>{t(parseInt(a.target.value,10)),b(0)},y=((a,_,P)=>a.filter(i=>{var V,r,j,m,G,J,I,Q,z;const n=P.toLowerCase(),E=(r=(V=i==null?void 0:i.breakdown)==null?void 0:V.breakdown_id)==null?void 0:r.toLowerCase().includes(n),Y=`${(m=(j=i==null?void 0:i.submitted_by)==null?void 0:j.us_user)==null?void 0:m.first_name} ${(J=(G=i==null?void 0:i.submitted_by)==null?void 0:G.us_user)==null?void 0:J.last_name}`.toLowerCase().includes(n),F=(I=i==null?void 0:i.status)==null?void 0:I.toLowerCase().includes(n),N=(Q=i==null?void 0:i.workshop_group)==null?void 0:Q.group_name.toLowerCase().includes(n),$=(z=i==null?void 0:i.vehicle.registration_id)==null?void 0:z.toLowerCase().includes(n);return!(P&&!(E||Y||F||N||$)||_.id&&!i.breakdown_id.includes(_.id)||_.status&&i.status!==_.status||_.workshop&&i.workshop_group.group_name!==_.workshop||_.user&&!i.user.us_user.first_name.toLowerCase().includes(_.user.toLowerCase())&&!i.user.us_user.last_name.toLowerCase().includes(_.user.toLowerCase()))}))((c==null?void 0:c.slice())||[],O,C),h=y.slice(S*D,S*D+D),M={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};return e.jsx(T,{sx:{m:v!=="inspection report"&&"10px",width:v==="inspection report"?"60%":"99%"},children:e.jsxs(ae,{children:[e.jsx(te,{sx:{height:v==="inspection report"?"50vh":"65vh",bgcolor:"white",borderRadius:"10px"},children:e.jsxs(re,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsxs(K,{children:[ks.map(a=>e.jsx(p,{sx:M,children:e.jsx(je,{active:x===a.id,direction:x===a.id?L:"asc",onClick:()=>o(a.id),children:a.label})},a.id)),v!=="inspection report"&&e.jsx(p,{sx:M,children:e.jsx(je,{children:"Actions"})})]})}),e.jsx(ne,{children:h.map((a,_)=>{var P,i,n,E,Y,F,N,$,V,r,j;return e.jsxs(K,{children:[e.jsx(p,{children:((P=a==null?void 0:a.breakdown)==null?void 0:P.breakdown_id)||"N/A"}),e.jsx(p,{children:(i=a==null?void 0:a.vehicle)==null?void 0:i.registration_id}),e.jsx(p,{children:`${(E=(n=a==null?void 0:a.submitted_by)==null?void 0:n.us_user)==null?void 0:E.first_name} ${(F=(Y=a==null?void 0:a.submitted_by)==null?void 0:Y.us_user)==null?void 0:F.last_name}`}),e.jsx(p,{children:((N=a==null?void 0:a.breakdown)==null?void 0:N.submission_date)&&W.utc(($=a==null?void 0:a.breakdown)==null?void 0:$.submission_date).local().format("YYYY-MM-DD")||"N/A"}),e.jsx(p,{children:((V=a==null?void 0:a.breakdown)==null?void 0:V.submission_date)&&W.utc((r=a==null?void 0:a.breakdown)==null?void 0:r.submission_date).local().format("HH:mm A")||"N/A"}),e.jsx(p,{children:(j=a==null?void 0:a.workshop_group)==null?void 0:j.group_name}),e.jsx(p,{sx:{color:a.status==="Open"?"blue":a.status==="Close"?"green":"red"},children:a.status}),v!=="inspection report"&&e.jsx(p,{children:e.jsx(Cs,{inspectionData:a,status:a==null?void 0:a.status})})]},_)})})]})}),e.jsx(Ve,{component:"div",count:y.length,page:S,onPageChange:g,rowsPerPage:D,onRowsPerPageChange:w,rowsPerPageOptions:[5,10,15]})]})})},be={vehicleNo:"B35965",type:"Sprayer",operator:"Arjun",inspectionDate:"15/09/24",status:"Open",partsFailure:"Oil Pump, Filter",submittedBy:"Yograj"};function Ts({handleBack:v}){const{inspectionHistory:f}=A(k=>k.inspection),{breakdowns:u}=A(k=>k.breakdown),{w_customer_id:C}=A(k=>k.auth),[c,L]=l.useState([]),[s,x]=l.useState([]),[d,S]=l.useState({}),[b,D]=l.useState(be),[t,O]=de.useState(),[R,o]=de.useState();let g=H();l.useEffect(()=>{g(ee()),g(Ne(C)),g($e())},[]),l.useEffect(()=>{if(f.length>0){let k={open:0,rejected:0,close:0};({...be},f.map(y=>{y.status==="Open"&&(y!=null&&y.breakdown)&&k.open++,y.status==="Close"&&(y!=null&&y.breakdown)&&k.close++,y.status==="Rejected"&&(y!=null&&y.breakdown)&&k.rejected++})),S(k)}},[f]),l.useEffect(()=>{const k=[{name:"Rejected",value:d.rejected},{name:"Pending",value:d.open},{name:"Approved",value:d.close}];x(k)},[d]),l.useEffect(()=>{let k=[];if(console.log("inspection history",f),f.forEach(y=>{var F,N,$,V;const{breakdown:h,inspection_parts_inspection:M,status:a,submitted_by:_,resolved_issue:P,pending_issue:i,vehicle:n}=y;console.log("breakdown",h);const E=M&&M.length>0?M.map((r,j)=>{var m;return`${(m=r==null?void 0:r.spare_parts)==null?void 0:m.description}: Qty ${r==null?void 0:r.quantity}`}).join("; "):"N/A";let Y={Vehicle:n==null?void 0:n.registration_id,BDID:(h==null?void 0:h.breakdown_id)||"","Breakdown Topic":(F=h==null?void 0:h.breakdown_topic)==null?void 0:F.topic,"Resolved issue":P,"Pending issue":i,"Spare Parts":E,user:`${((N=_==null?void 0:_.us_user)==null?void 0:N.first_name)||""} ${(($=_==null?void 0:_.us_user)==null?void 0:$.last_name)||""}`,"Submission Date":(h==null?void 0:h.submission_date)&&W.utc(h==null?void 0:h.submission_date).local().format("YYYY-MM-DD")||"N/A","Submission Time":(h==null?void 0:h.submission_date)&&W.utc(h==null?void 0:h.submission_date).local().format("HH:mm A")||"N/A",workshop:((V=y==null?void 0:y.workshop_group)==null?void 0:V.group_name)||"",status:a};k.push(Y)}),Object.keys(d).length>0){let y={BDID:"Inspection Status",user:"","Submission Date":"",workshop:`Rejected: ${d.rejected||0}, Pending: ${d.open||0}, Approved: ${d.close||0}`};k.push(y)}L(k)},[u,d]);const w=()=>{if(t&&R){let k={startDate:W(new Date(t)).format("YYYY-MM-DD"),endDate:W(new Date(R)).format("YYYY-MM-DD")};g(ee(k))}else g(ee())};return e.jsxs(T,{sx:{width:"100%",m:"auto"},children:[e.jsx(Z,{handleBack:v,downloadData:c}),e.jsxs(T,{sx:{display:"flex",m:"10px"},children:[e.jsx(is,{setStartDate:O,setEndDate:o,selectedDate:!1}),e.jsx(X,{sx:{ml:"20px",background:"rgb(141, 166, 198)",color:"white"},onClick:()=>w(),children:"Apply"})]}),e.jsxs(T,{sx:{display:"flex",gap:"40px"},children:[e.jsx(As,{where:"inspection report"}),e.jsx(T,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(oe,{chartData:s,title:"Inspection Status"})})]})]})}function Ls({handleBack:v}){const{overdueCount:f,completedCount:u,serviceSoonCount:C}=A(b=>b.dashboard),{servicesData:c}=A(b=>b.services),[L,s]=l.useState([]),[x,d]=l.useState([]);let S=H();return l.useEffect(()=>{S(Be())},[]),l.useEffect(()=>{d([{name:"Over Due",value:f},{name:"Due Soon",value:C},{name:"Serviced",value:u}])},[f,C,u]),l.useEffect(()=>{console.log("servicesData",c);let b=[];c.forEach(t=>{var R,o,g,w,k,y,h,M;let O={SRID:t==null?void 0:t.service_record_id,Vehicle:((R=t==null?void 0:t.vehicle)==null?void 0:R.registration_id)||"",user:`${((g=(o=t==null?void 0:t.user)==null?void 0:o.us_user)==null?void 0:g.first_name)||""} ${((k=(w=t==null?void 0:t.user)==null?void 0:w.us_user)==null?void 0:k.last_name)||""}`,Vehicle_group:((h=(y=t==null?void 0:t.vehicle)==null?void 0:y.vehicle_group)==null?void 0:h.group_name)||"",Priority_Class:(t==null?void 0:t.priority_class)||"","Entry Date":W(new Date(t==null?void 0:t.created)).format("DD-MM-YYYY"),"Entry Time":W(new Date(t==null?void 0:t.created)).format("HH:mm A"),Completion_Date:(t==null?void 0:t.completion_date)||"",Next_Due_Date:(t==null?void 0:t.next_due_date)||"",Segment:((M=t==null?void 0:t.segment)==null?void 0:M.segment_name)||"",status:t==null?void 0:t.status};b.push(O)});let D={Vehicle:"Service Status",user:"",Priority_Class:"",Completion_Date:`Over Due: ${f||0}, Due Soon: ${C||0}, Serviced: ${u||0}`};b.push(D),s(b)},[c,u]),e.jsxs(T,{sx:{width:"100%",m:"auto"},children:[e.jsx(T,{sx:{ml:"10px"},children:e.jsx(Z,{handleBack:v,downloadData:L})}),e.jsx(js,{where:"service report"}),e.jsx(T,{sx:{display:"flex",gap:"40px",justifyContent:"center",paddingBottom:"50px"},children:e.jsx(T,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(oe,{chartData:x,title:"Service Status"})})})]})}function ws({tableData:v}){const{vehicleList:f}=A(s=>s.liveMap),u=H(),C=Fe();console.log("tableData: ",v);let c=s=>f.find(x=>{var d;return((d=x==null?void 0:x.imei[0])==null?void 0:d.mac_id)==s||""});const L=s=>{var x;u(Ge({imei:s==null?void 0:s.imei,reg_id:(x=c(s.imei))==null?void 0:x.registration_id})),u(Ye({startDate:pe(s.date).startOf("day").toISOString(),endDate:pe(s.date).endOf("day").toISOString()})),C("/trip-monitor?source=TripDetail")};return e.jsx(te,{component:ae,sx:{maxHeight:"70vh"},children:e.jsxs(re,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(K,{children:[e.jsx(p,{align:"left",children:"Date"}),e.jsx(p,{align:"left",children:"Vehicle Name"}),e.jsx(p,{align:"left",children:"Start location"}),e.jsx(p,{align:"left",children:"End location"}),e.jsx(p,{align:"left",children:"Segment"}),e.jsx(p,{align:"left",children:"Operator"}),e.jsx(p,{align:"left",children:"Work done (acre)"}),e.jsx(p,{align:"left",children:"Engine hours"}),e.jsx(p,{align:"left",children:"Running Time"}),e.jsx(p,{align:"left",children:"Idle time"}),e.jsx(p,{align:"left",children:"Total Distance (km)"}),e.jsx(p,{align:"left",children:"Average Speed"}),e.jsx(p,{align:"left",children:"View Trips"})]})}),e.jsx(ne,{children:v.map((s,x)=>{var d,S,b,D,t,O,R;return e.jsxs(K,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(p,{align:"left",children:s.date}),e.jsx(p,{align:"left",children:(d=c(s.imei))==null?void 0:d.registration_id}),e.jsx(p,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(he,{title:((S=s==null?void 0:s.startLocationName)==null?void 0:S.display_name)||(s==null?void 0:s.startLocationName)||"",children:e.jsx("span",{children:((b=s==null?void 0:s.startLocationName)==null?void 0:b.display_name)||(s==null?void 0:s.startLocationName)||""})})}),e.jsx(p,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(he,{title:((D=s==null?void 0:s.endLocationName)==null?void 0:D.display_name)||(s==null?void 0:s.endLocationName)||"",children:e.jsx("span",{children:((t=s==null?void 0:s.endLocationName)==null?void 0:t.display_name)||(s==null?void 0:s.endLocationName)||""})})}),e.jsx(p,{align:"left",children:(O=c(s.imei))==null?void 0:O.segment}),e.jsx(p,{align:"left",children:(R=c(s.imei))==null?void 0:R.customer_name}),e.jsx(p,{align:"left",children:s.acreageStr}),e.jsx(p,{align:"left",children:s.engineHours}),e.jsx(p,{align:"left",children:s.runningTime}),e.jsx(p,{align:"left",children:s.idleTime}),e.jsx(p,{align:"left",children:s.totalDistance}),e.jsx(p,{align:"left",children:s.averageSpeed}),e.jsx(p,{align:"left",children:e.jsx(T,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>L(s),children:"View on Map 🔍"})})]},x+1)})})]})})}function Es({handleBack:v,setStartDate:f,startDate:u,setEndDate:C,endDate:c}){const L=H(),{vehicleGroup:s,vehicleList:x}=A(i=>i.liveMap),{vehicleStatesData:d,loading:S,selectedGroup:b,selectedVehicle:D,distributorList:t}=A(i=>i.report),[O,R]=l.useState([]),[o,g]=l.useState([]),[w,k]=l.useState([]);l.useEffect(()=>{},[S]),l.useEffect(()=>{if(s&&s.length>0){let i=s.map(n=>({...n,label:n.group_name,value:n.id}));R(i)}},[s,x,t]),l.useEffect(()=>{},[u,c]);let y=i=>x.find(n=>{var E;return((E=n==null?void 0:n.imei[0])==null?void 0:E.mac_id)==i||""});l.useEffect(()=>{let i=(d==null?void 0:d.data)&&d.data.map(n=>{var N,$;let{customer_name:E,registration_id:Y,segment:F}=y(n==null?void 0:n.imei);return{Date:n.date,vehicle:Y,"Start Location":(N=n==null?void 0:n.startLocationName)==null?void 0:N.display_name,"End Location":($=n==null?void 0:n.endLocationName)==null?void 0:$.display_name,operator:E,segment:F,"Work Done":n==null?void 0:n.acreageStr,"Running Time":n.runningTime,"Idle Time":n.idleTime,"Engine hours":n.engineHours,"Total Distance (km)":n.totalDistance,"Average Speed":n.averageSpeed}});k(i)},[d]),l.useEffect(()=>{D||L(ye())},[]);function h(i){console.log("value changed",i),L(We(i))}function M(i){L(Ue(i))}const a=async()=>{const i=`${u} 00:00`,n=`${c} 23:59`;if(!_())return;L(ze({imei:D,startTime:i,endTime:n}))},_=()=>!u||!c||D==="all"?(U.error("Please select start date, end date, and vehicle."),!1):!0,P=b==="All"?x:x.filter(i=>i.vehicle_group===b);return e.jsxs(T,{sx:{width:"100%",m:"auto"},children:[e.jsx(T,{sx:{ml:"10px"},children:e.jsx(Z,{handleBack:v,downloadData:w})}),e.jsxs(T,{children:[e.jsxs(B,{size:"large",value:b,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:h,filterOption:(i,n)=>{var E;return typeof((E=n==null?void 0:n.props)==null?void 0:E.children)=="string"&&n.props.children.toLowerCase().indexOf(i.toLowerCase())>=0},children:[e.jsx(B.Option,{value:"All",children:"All"}),O.map((i,n)=>e.jsx(B.Option,{value:i.value,children:i.label},n))]}),e.jsxs(B,{size:"large",value:D,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:M,filterOption:(i,n)=>{var E;return typeof((E=n==null?void 0:n.props)==null?void 0:E.children)=="string"&&n.props.children.toLowerCase().indexOf(i.toLowerCase())>=0},children:[e.jsx(B.Option,{value:"all",children:"None"},"all"),P&&P.length>0&&P.map((i,n)=>{var E;return e.jsx(B.Option,{value:(E=i.imei[0])==null?void 0:E.mac_id,children:i.registration_id},n)})]}),e.jsx(_e,{setStartDate:f,setEndDate:C,selectedDate:!1,startDate:u,endDate:c}),e.jsx(X,{variant:"contained",style:{width:200,marginLeft:"10px"},onClick:a,disabled:!D,children:"Generate report"})]}),S&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(He,{})}),(d==null?void 0:d.data)&&(d==null?void 0:d.data.length)>0&&e.jsx(T,{ml:1.5,children:e.jsx(ws,{tableData:(d==null?void 0:d.data)||[]})})]})}function Is({showCard:v,setReportType:f,reportType:u}){const{mode:C}=A(o=>o.dashboard),{selectedVehicle:c}=A(o=>o.liveMap),{startDate:L,endDate:s}=A(o=>o.report),[x,d]=l.useState(!0),[S,b]=l.useState({}),[D,t]=l.useState(!1);let O=H();l.useEffect(()=>{},[s]),l.useEffect(()=>{O(ue()),O(ge())},[]);const R=()=>{O(ye()),O(ue()),O(ge()),O(f(null))};return e.jsx(e.Fragment,{children:e.jsx(T,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignItems:"center",gap:2,padding:2},children:u==="Vehicle"?e.jsx(ys,{handleBack:R,selectedDate:x,setEndDate:fe,setStartDate:xe,startDate:L,endDate:s}):u==="Service"?e.jsx(Ls,{handleBack:R}):u==="Inspection"?e.jsx(Ts,{handleBack:R}):e.jsx(Es,{handleBack:R,selectedDate:x,setEndDate:fe,setStartDate:xe,startDate:L,endDate:s})})})}function Js(){const{mode:v,showVehicles:f,selectedVehicleGroup:u}=A(o=>o.dashboard),{w_customer_id:C}=A(o=>o.auth),{reportType:c}=A(o=>o.report),[L,s]=l.useState([]),[x,d]=l.useState(!0),[S,b]=l.useState(!1),D=ss(v);let t=H();l.useEffect(()=>{R(),O()},[]);const O=()=>{t(qe())},R=async()=>{try{let o=[],g=[];const w=await t(Ke({w_customer_id:C}));if(Array.isArray(w.payload)){w.payload.forEach(h=>{var M,a;Array.isArray(h.imei)&&h.imei.length>0?(o.push({id:h.id,label:h.registration_id,value:(M=h==null?void 0:h.imei[0])==null?void 0:M.mac_id,workShop:h==null?void 0:h.workshop,vehicle_group:h==null?void 0:h.vehicle_group}),g.push((a=h.imei[0])==null?void 0:a.mac_id)):console.error("IMEI data not found for item:",h)});const k="one",y=g;g.length>0&&(t(Xe({type:k,imei:y})),t(Je(y))),s(o),t(Qe({w_customer_id:C})),t(Ze({}))}else console.error("Unexpected data format:",w),U.error("Unexpected data format:")}catch(o){console.error("Error fetching vehicle data:",o),U.error(`Error fetching vehicle data: ${o}`)}};return L.filter(o=>Object.keys(u).length===0||o.vehicle_group===u.id),e.jsxs("div",{className:"app",children:[e.jsx(es,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:D.grey[100]},children:[e.jsx(ts,{title:"Report",setShowVehiclesGroup:b,showVehiclesGroup:S,reportType:c}),e.jsx(as,{setShowVehiclesGroup:b,showVehiclesGroup:S}),e.jsxs(T,{style:{display:"flex",width:"100%",height:"95vh",background:D.grey[200]},children:[e.jsx(T,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(T,{style:{width:"100%"},children:e.jsx(Is,{showCard:x,setReportType:rs,reportType:c})})}),!1]})]})]})}export{Js as default};
