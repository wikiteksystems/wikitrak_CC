import{l as Oe,o as ze,p as Fe,b as j,q as $e,f as Me,_ as pe,j as e,eB as We,g as Ie,k as Ye,aW as L,T as Ge,bc as ae,b7 as X,a$ as N,a_ as J,bb as me,dT as Ce,cf as _e,dU as Ae,dV as Ve,dW as Z,dX as t,dY as De,eh as ge,bl as Be,ca as Pe,b8 as ue,eC as le,eD as R,bY as Ee,eE as Le,eF as ke,bv as He,bm as ee,eG as Ue,eH as fe,eI as je,eJ as Ke,eK as ve,eL as be,eM as Se,eN as qe,bw as Xe,bx as Je,by as Qe,bA as Ze,bC as we,bq as ea,br as aa,bs as la,eO as ta,b5 as sa}from"./index-NiJCgo_l.js";import{D as Re,R as na}from"./BatchRecipt-C0se7bco.js";import"./index.esm-BrItzKjM.js";import{u as w,w as ra}from"./xlsx-D5JNrnKm.js";function ca(S){return Oe("MuiTableFooter",S)}ze("MuiTableFooter",["root"]);const ia=["className","component"],da=S=>{const{classes:T}=S;return Ye({root:["root"]},ca,T)},oa=Fe("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(S,T)=>T.root})({display:"table-footer-group"}),ha={variant:"footer"},ye="tfoot",xa=j.forwardRef(function(T,b){const _=$e({props:T,name:"MuiTableFooter"}),{className:v,component:y=ye}=_,n=Me(_,ia),d=pe({},_,{component:y}),r=da(d);return e.jsx(We.Provider,{value:ha,children:e.jsx(oa,pe({as:y,className:Ie(r.root,v),ref:b,role:y===ye?null:"rowgroup",ownerState:d},n))})}),pa=xa;function Ne({handleBack:S,downloadData:T}){j.useEffect(()=>{},[T]);const b=()=>{if(T.length===0){X.error("No data available for download.");return}const _=w.json_to_sheet(T),v=w.book_new();w.book_append_sheet(v,_,"Sheet1"),ra(v,"Report.xlsx"),X.success("Excel file downloaded successfully!")};return e.jsx(L,{sx:{backgroundColor:"white",mb:2,display:"flex",textAlign:"center",justifyContent:"end",alignItems:"center",padding:"10px 20px",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsxs(L,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{sx:{fontWeight:"bold",mr:1},children:"Download In:"}),e.jsx(ae,{variant:"outlined",onClick:b,sx:{borderColor:"green",color:"green","&:hover":{backgroundColor:"green",color:"white"}},children:"EXCEL"})]})})}function ga({tableData:S}){const{vehicleList:T}=N(n=>n.liveMap),b=J(),_=me();console.log("tableData: ",S);let v=n=>T.find(d=>{var r;return((r=d==null?void 0:d.imei[0])==null?void 0:r.mac_id)==n||""});const y=n=>{var d;b(Be({imei:n==null?void 0:n.imei,reg_id:(d=v(n.imei))==null?void 0:d.registration_id})),b(Pe({startDate:ue(n.date).startOf("day").toISOString(),endDate:ue(n.date).endOf("day").toISOString()})),_("/trip-monitor?source=TripDetail")};return e.jsx(Ce,{component:_e,sx:{maxHeight:"70vh"},children:e.jsxs(Ae,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(Ve,{children:e.jsxs(Z,{children:[e.jsx(t,{align:"left",children:"Date"}),e.jsx(t,{align:"left",children:"Vehicle Name"}),e.jsx(t,{align:"left",children:"Start location"}),e.jsx(t,{align:"left",children:"End location"}),e.jsx(t,{align:"left",children:"Segment"}),e.jsx(t,{align:"left",children:"Operator"}),e.jsx(t,{align:"left",children:"Work done (acre)"}),e.jsx(t,{align:"left",children:"Engine hours"}),e.jsx(t,{align:"left",children:"Running Time"}),e.jsx(t,{align:"left",children:"Idle time"}),e.jsx(t,{align:"left",children:"Total Distance (km)"}),e.jsx(t,{align:"left",children:"Average Speed"}),e.jsx(t,{align:"left",children:"View Trips"})]})}),e.jsx(De,{children:S.map((n,d)=>{var r,l,h,p,u,V,f;return e.jsxs(Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{align:"left",children:n.date}),e.jsx(t,{align:"left",children:(r=v(n.imei))==null?void 0:r.registration_id}),e.jsx(t,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ge,{title:((l=n==null?void 0:n.startLocationName)==null?void 0:l.display_name)||(n==null?void 0:n.startLocationName)||"",children:e.jsx("span",{children:((h=n==null?void 0:n.startLocationName)==null?void 0:h.display_name)||(n==null?void 0:n.startLocationName)||""})})}),e.jsx(t,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ge,{title:((p=n==null?void 0:n.endLocationName)==null?void 0:p.display_name)||(n==null?void 0:n.endLocationName)||"",children:e.jsx("span",{children:((u=n==null?void 0:n.endLocationName)==null?void 0:u.display_name)||(n==null?void 0:n.endLocationName)||""})})}),e.jsx(t,{align:"left",children:(V=v(n.imei))==null?void 0:V.segment}),e.jsx(t,{align:"left",children:(f=v(n.imei))==null?void 0:f.customer_name}),e.jsx(t,{align:"left",children:n.acreageStr}),e.jsx(t,{align:"left",children:n.engineHours}),e.jsx(t,{align:"left",children:n.runningTime}),e.jsx(t,{align:"left",children:n.idleTime}),e.jsx(t,{align:"left",children:n.totalDistance}),e.jsx(t,{align:"left",children:n.averageSpeed}),e.jsx(t,{align:"left",children:e.jsx(L,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>y(n),children:"View on Map ðŸ”"})})]},d+1)})})]})})}function ua({handleBack:S,setStartDate:T,startDate:b,setEndDate:_,endDate:v}){const y=J(),{vehicleGroup:n,vehicleList:d}=N(x=>x.liveMap),{vehicleStatesData:r,loading:l,selectedGroup:h,selectedVehicle:p,distributorList:u}=N(x=>x.report),[V,f]=j.useState([]);j.useState([]);const[E,O]=j.useState([]);j.useEffect(()=>{},[l]),j.useEffect(()=>{if(n&&n.length>0){let x=n.map(o=>({...o,label:o.group_name,value:o.id}));f(x)}},[n,d,u]),j.useEffect(()=>{},[b,v]);let $=x=>d.find(o=>{var A;return((A=o==null?void 0:o.imei[0])==null?void 0:A.mac_id)==x||""});j.useEffect(()=>{let x=(r==null?void 0:r.data)&&r.data.map(o=>{var G,B;let{customer_name:A,registration_id:P,segment:H}=$(o==null?void 0:o.imei);return{Date:o.date,vehicle:P,"Start Location":(G=o==null?void 0:o.startLocationName)==null?void 0:G.display_name,"End Location":(B=o==null?void 0:o.endLocationName)==null?void 0:B.display_name,operator:A,segment:H,"Work Done":o==null?void 0:o.acreageStr,"Running Time":o.runningTime,"Idle Time":o.idleTime,"Engine hours":o.engineHours,"Total Distance (km)":o.totalDistance,"Average Speed":o.averageSpeed}});O(x)},[r]),j.useEffect(()=>{p||y(le())},[]);function M(x){console.log("value changed",x),y(Le(x))}function m(x){y(ke(x))}const F=async()=>{const x=`${b} 00:00`,o=`${v} 23:59`;if(!z())return;y(He({imei:p,startTime:x,endTime:o}))},z=()=>!b||!v||p==="all"?(X.error("Please select start date, end date, and vehicle."),!1):!0,W=h==="All"?d:d.filter(x=>x.vehicle_group===h);return e.jsxs(L,{sx:{width:"100%",m:"auto"},children:[e.jsx(L,{sx:{ml:"10px"},children:e.jsx(Ne,{handleBack:S,downloadData:E})}),e.jsxs(L,{children:[e.jsxs(R,{size:"large",value:h,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:M,filterOption:(x,o)=>{var A;return typeof((A=o==null?void 0:o.props)==null?void 0:A.children)=="string"&&o.props.children.toLowerCase().indexOf(x.toLowerCase())>=0},children:[e.jsx(R.Option,{value:"All",children:"All"}),V.map((x,o)=>e.jsx(R.Option,{value:x.value,children:x.label},o))]}),e.jsxs(R,{size:"large",value:p,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:m,filterOption:(x,o)=>{var A;return typeof((A=o==null?void 0:o.props)==null?void 0:A.children)=="string"&&o.props.children.toLowerCase().indexOf(x.toLowerCase())>=0},children:[e.jsx(R.Option,{value:"all",children:"None"},"all"),W&&W.length>0&&W.map((x,o)=>{var A;return e.jsx(R.Option,{value:(A=x.imei[0])==null?void 0:A.mac_id,children:x.registration_id},o)})]}),e.jsx(Re,{setStartDate:T,setEndDate:_,selectedDate:!1,startDate:b,endDate:v}),e.jsx(ae,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:F,disabled:!p,children:"Generate report"})]}),l&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(Ee,{})}),(r==null?void 0:r.data)&&(r==null?void 0:r.data.length)>0&&e.jsx(L,{ml:1.5,children:e.jsx(ga,{tableData:(r==null?void 0:r.data)||[]})})]})}function fa({tableData:S}){const{vehicleList:T}=N(l=>l.liveMap);J(),me();const[b,_]=j.useState(null),[v,y]=j.useState(!1);let n=l=>T.find(h=>{var p;return((p=h==null?void 0:h.imei[0])==null?void 0:p.mac_id)==l||""});const d=(l,h)=>h.find(u=>{var V;return((V=u==null?void 0:u.name)==null?void 0:V.toLowerCase().trim())===l})||null,r={fontSize:"12px",fontWeight:"bold"};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{component:_e,sx:{maxHeight:"70vh"},children:e.jsxs(Ae,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(Ve,{children:e.jsxs(Z,{children:[e.jsx(t,{align:"left",sx:r,children:"Date"}),e.jsx(t,{align:"left",sx:r,children:"Vehicle Name"}),e.jsx(t,{align:"left",sx:r,children:"Batch No"}),e.jsx(t,{align:"left",sx:r,children:"Start Time"}),e.jsx(t,{align:"left",sx:r,children:"End Time"}),e.jsx(t,{align:"left",sx:r,children:"Total Target Weight"}),e.jsx(t,{align:"left",sx:r,children:"Total Achieved Weight"}),e.jsx(t,{align:"left",sx:r,children:"Recipe 1"}),e.jsx(t,{align:"left",sx:r,children:"Cement"}),e.jsx(t,{align:"left",sx:r,children:"10mm"}),e.jsx(t,{align:"left",sx:r,children:"20mm"}),e.jsx(t,{align:"left",sx:r,children:"Sand"}),e.jsx(t,{align:"left",sx:r,children:"Crush Sand"}),e.jsx(t,{align:"left",sx:r,children:"River Sand"}),e.jsx(t,{align:"left",sx:r,children:"Fly Ash"}),e.jsx(t,{align:"left",sx:r,children:"30mm"}),e.jsx(t,{align:"left",sx:r,children:"Water"}),e.jsx(t,{align:"left",sx:r,children:"Admix"}),e.jsx(t,{align:"left",sx:r,children:"Receipt"})]})}),e.jsx(De,{children:S.map((l,h)=>{var p,u,V,f,E,O,$,M,m,F,z,W,x,o,A,P,H,G,B,U,c,s,g,i,k,a,D,C,Q,K,q,I,Y,te,se,ne,re,ce,ie,de,oe,he,xe;return e.jsxs(Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(l==null?void 0:l.date)&&ee(l==null?void 0:l.date,"DDMMYYYY").format("DD-MM-YYYY")||"-"}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(p=n(l.imei))==null?void 0:p.registration_id}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l.batch_no}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l.start_time}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.end_time}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(u=l==null?void 0:l.total_target)==null?void 0:u.replace(/^0+/,"")}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(V=l==null?void 0:l.totalAcheived)==null?void 0:V.replace(/^0+/,"")}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.mix_name}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(E=(f=d("cement",l.materials||[]))==null?void 0:f.target)==null?void 0:E.replace(/^0+/,""),":",($=(O=d("cement",l.materials||[]))==null?void 0:O.actual)==null?void 0:$.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(m=(M=d("10 mm",l.materials||[]))==null?void 0:M.target)==null?void 0:m.replace(/^0+/,""),":",(z=(F=d("10 mm",l.materials||[]))==null?void 0:F.actual)==null?void 0:z.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(x=(W=d("20 mm",l.materials||[]))==null?void 0:W.target)==null?void 0:x.replace(/^0+/,""),":",(A=(o=d("20 mm",l.materials||[]))==null?void 0:o.actual)==null?void 0:A.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(H=(P=d("sand",l.materials||[]))==null?void 0:P.target)==null?void 0:H.replace(/^0+/,""),":",(B=(G=d("sand",l.materials||[]))==null?void 0:G.actual)==null?void 0:B.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(c=(U=d("crush sand",l.materials||[]))==null?void 0:U.target)==null?void 0:c.replace(/^0+/,""),":",(g=(s=d("crush sand",l.materials||[]))==null?void 0:s.actual)==null?void 0:g.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(k=(i=d("river sand",l.materials||[]))==null?void 0:i.target)==null?void 0:k.replace(/^0+/,""),":",(D=(a=d("river sand",l.materials||[]))==null?void 0:a.actual)==null?void 0:D.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(Q=(C=d("fly ash",l.materials||[]))==null?void 0:C.target)==null?void 0:Q.replace(/^0+/,""),":",(q=(K=d("fly ash",l.materials||[]))==null?void 0:K.actual)==null?void 0:q.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(Y=(I=d("30 mm",l.materials||[]))==null?void 0:I.target)==null?void 0:Y.replace(/^0+/,""),":",(se=(te=d("30 mm",l.materials||[]))==null?void 0:te.actual)==null?void 0:se.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(re=(ne=d("water",l.materials||[]))==null?void 0:ne.target)==null?void 0:re.replace(/^0+/,""),":",(ie=(ce=d("water",l.materials||[]))==null?void 0:ce.actual)==null?void 0:ie.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(oe=(de=d("admix",l.materials||[]))==null?void 0:de.target)==null?void 0:oe.replace(/^0+/,""),":",(xe=(he=d("admix",l.materials||[]))==null?void 0:he.actual)==null?void 0:xe.replace(/^0+/,"")]}),e.jsx(t,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",l),_(l),y(!0)},children:"View Receipt"})]},h+1)})}),e.jsx(pa,{children:e.jsxs(Z,{children:[e.jsx(t,{colSpan:4}),e.jsx(t,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:"Total:"}),e.jsx(t,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:S.reduce((l,h)=>l+(h!=null&&h.total_target&&parseFloat(h.total_target.replace(/^0+/,""))||0),0)}),e.jsx(t,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:S.reduce((l,h)=>l+(h!=null&&h.totalAcheived&&parseFloat(h.totalAcheived.replace(/^0+/,""))||0),0)}),e.jsx(t,{}),["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"].map(l=>{const h=S.reduce((u,V)=>{var E;const f=(E=d(l,V.materials||[]))==null?void 0:E.target;return u+(f&&parseFloat(f.replace(/^0+/,""))||0)},0),p=S.reduce((u,V)=>{var E;const f=(E=d(l,V.materials||[]))==null?void 0:E.actual;return u+(f&&parseFloat(f.replace(/^0+/,""))||0)},0);return e.jsxs(t,{align:"left",sx:{fontSize:"10px",fontWeight:"bold"},children:[h,":",p]},l)}),e.jsx(t,{})]})})]})}),e.jsx(na,{receiptData:b,open:v,setOpen:y})]})}function ja({handleBack:S,setStartDate:T,startDate:b,setEndDate:_,endDate:v}){const y=J(),{vehicleGroup:n,vehicleList:d}=N(c=>c.liveMap),{batchReportsData:r,batchReportsData2:l,loading:h,selectedGroup:p,selectedVehicle:u,distributorList:V}=N(c=>c.report),[f,E]=j.useState([]);j.useState([]);const[O,$]=j.useState([]),[M,m]=j.useState([]);let F=c=>d.find(s=>{var g;return((g=s==null?void 0:s.imei[0])==null?void 0:g.mac_id)==c||""});const z=(c,s)=>s.find(i=>{var k;return((k=i==null?void 0:i.name)==null?void 0:k.toLowerCase().trim())===c})||null,W=(c,s)=>{if(!c||!c.length>0)return;const g=c.reduce((D,C)=>D+(C!=null&&C.total_target&&parseFloat(C.total_target.replace(/^0+/,""))||0),0),i=c.reduce((D,C)=>D+(C!=null&&C.totalAcheived&&parseFloat(C.totalAcheived.replace(/^0+/,""))||0),0),k=["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"],a={};return k.forEach(D=>{const C=c.reduce((K,q)=>{var Y;const I=(Y=s(D,q.materials||[]))==null?void 0:Y.target;return K+(I&&parseFloat(I.replace(/^0+/,""))||0)},0),Q=c.reduce((K,q)=>{var Y;const I=(Y=s(D,q.materials||[]))==null?void 0:Y.actual;return K+(I&&parseFloat(I.replace(/^0+/,""))||0)},0);a[D]=`${C}:${Q}`}),{"Total Target Weight":g,"Total Achieved Weight":i,...a}};j.useEffect(()=>{const c=a=>a&&String(a).replace(/^0+/,"")||"-",s=(a,D=[])=>{const C=z(a,D);return{target:c(C==null?void 0:C.target),actual:c(C==null?void 0:C.actual)}};let g=(r==null?void 0:r.map(a=>{const{customer_name:D="-",registration_id:C="-",segment:Q="-"}=F(a==null?void 0:a.imei)||{};return{Date:a!=null&&a.date&&ee(a==null?void 0:a.date,"DDMMYYYY").isValid()?ee(a==null?void 0:a.date,"DDMMYYYY").format("DD-MM-YYYY"):"-",Vehicle:C||"-","Batch No":(a==null?void 0:a.batch_no)||"-","Start Time":(a==null?void 0:a.start_time)||"-",EndTime:(a==null?void 0:a.end_time)||"-","Total Target Weight":c(a==null?void 0:a.total_target),"Total Achieved Weight":c(a==null?void 0:a.totalAcheived),"Recipe 1":(a==null?void 0:a.mix_name)||"-",Cement:`${s("cement",a==null?void 0:a.materials).target}:${s("cement",a==null?void 0:a.materials).actual}`,"10mm":`${s("10 mm",a==null?void 0:a.materials).target}:${s("10mm",a==null?void 0:a.materials).actual}`,"20mm":`${s("20 mm",a==null?void 0:a.materials).target}:${s("20mm",a==null?void 0:a.materials).actual}`,Sand:`${s("sand",a==null?void 0:a.materials).target}:${s("sand",a==null?void 0:a.materials).actual}`,"Crush Sand":`${s("crush sand",a==null?void 0:a.materials).target}:${s("crush sand",a==null?void 0:a.materials).actual}`,"River Sand":`${s("river sand",a==null?void 0:a.materials).target}:${s("river sand",a==null?void 0:a.materials).actual}`,"Fly Ash":`${s("fly ash",a==null?void 0:a.materials).target}:${s("fly ash",a==null?void 0:a.materials).actual}`,"30mm":`${s("30 mm",a==null?void 0:a.materials).target}:${s("30mm",a==null?void 0:a.materials).actual}`,Water:`${s("water",a==null?void 0:a.materials).target}:${s("water",a==null?void 0:a.materials).actual}`,Admix:`${s("admix",a==null?void 0:a.materials).target}:${s("admix",a==null?void 0:a.materials).actual}`}}))||[];const i=W(r,z),k=[...g,{Date:"",Vehicle:"-","Batch No":"-","Start Time":"-",EndTime:"Total","Total Target Weight":(i==null?void 0:i["Total Target Weight"])||0,"Total Achieved Weight":(i==null?void 0:i["Total Achieved Weight"])||0,"Recipe 1":"-",Cement:(i==null?void 0:i.cement)||"-","10mm":(i==null?void 0:i["10 mm"])||"-","20mm":(i==null?void 0:i["20 mm"])||"-",Sand:(i==null?void 0:i.sand)||"-","Crush Sand":(i==null?void 0:i["crush sand"])||"-","River Sand":(i==null?void 0:i["river sand"])||"-","Fly Ash":(i==null?void 0:i["fly ash"])||"-","30mm":(i==null?void 0:i["30 mm"])||"-",Water:(i==null?void 0:i.water)||"-",Admix:(i==null?void 0:i.admix)||"-"}];$(k)},[r]);const x=c=>{if(!c&&!c.length>0)return;let s=[];for(let g=0;g<c.length;g++)if(c[g].startsWith("Product:")){const i=c[g],k=c[g+1]||"",a=i.match(/Product:\s*(.*?)\s*Target.*:\s*(\d+)/),D=k.match(/Achieved.*:\s*(\d+)/);a&&s.push({product:a[1],target:Number(a[2]),achieved:D?Number(D[1]):0})}return s},o=["Batch No","Date","Start Time","Operator","Recipe Name","Cubic Meter","Cycle","End Time","Total Target","Total Achieved","Water","Admix"],A=c=>{if(!c&&!c.length>0)return;let s={};return c.forEach(g=>{o.forEach(i=>{var k;if(g.includes(i)){const D=((k=g.split(/[:\-](.+)/)[1])==null?void 0:k.trim())||"";s[i]=D}})}),s};j.useEffect(()=>{if(console.log("bacth reports data11",l),l&&l.length>0){let c=l.map(s=>{let g=x((s==null?void 0:s.parts)||[]),i=A((s==null?void 0:s.parts)||[]);return{productArr:g,generalKeyInfo:i,imei:s==null?void 0:s.deviceId}});c&&c.length>0?m(c):m([]),console.log("formatted arr",c)}},[l]),j.useEffect(()=>{if(n&&n.length>0){let c=n.map(s=>({...s,label:s.group_name,value:s.id}));E(c)}},[n,d,V]),j.useEffect(()=>{u||y(le())},[]);function P(c){console.log("value changed",c),y(Le(c))}function H(c){console.log("value",c),y(ke(c))}const G=async()=>{const c=`${b} 00:00`,s=`${v} 23:59`;if(!B())return;y(Ue({imei:u,startDate:c,endDate:s}))},B=()=>!b||!v||u==="all"?(X.error("Please select start date, end date, and vehicle."),!1):!0,U=p==="All"?d:d.filter(c=>c.vehicle_group===p);return e.jsxs(L,{sx:{width:"100%",m:"auto"},children:[e.jsx(L,{sx:{ml:"10px"},children:e.jsx(Ne,{handleBack:S,downloadData:O})}),e.jsxs(L,{children:[e.jsxs(R,{size:"large",value:p,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:P,filterOption:(c,s)=>{var g;return typeof((g=s==null?void 0:s.props)==null?void 0:g.children)=="string"&&s.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(R.Option,{value:"All",children:"All"}),f.map((c,s)=>e.jsx(R.Option,{value:c.value,children:c.label},s))]}),e.jsxs(R,{size:"large",value:u,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:H,filterOption:(c,s)=>{var g;return typeof((g=s==null?void 0:s.props)==null?void 0:g.children)=="string"&&s.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(R.Option,{value:"all",children:"None"},"all"),U&&U.length>0&&U.map((c,s)=>{var g;return e.jsx(R.Option,{value:(g=c.imei[0])==null?void 0:g.mac_id,children:c.registration_id},s)})]}),e.jsx(Re,{setStartDate:T,setEndDate:_,selectedDate:!1,startDate:b,endDate:v}),e.jsx(ae,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:G,disabled:!u,children:"Generate report"})]}),h&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(Ee,{})}),r&&r.length>0&&e.jsx(L,{ml:1.5,children:e.jsx(fa,{tableData:r||[]})})]})}function Te({children:S,value:T,index:b}){return e.jsx("div",{role:"tabpanel",hidden:T!==b,children:T===b&&e.jsx(L,{p:2,children:S})})}function va({showCard:S,setReportType:T,reportType:b}){N(p=>p.dashboard),N(p=>p.liveMap);const{startDate:_,endDate:v,tabValue:y}=N(p=>p.report),[n,d]=j.useState(!0);j.useState({}),j.useState(!1);let r=J();j.useEffect(()=>{},[v]),j.useEffect(()=>{r(fe()),r(je())},[]);const l=()=>{r(le()),r(fe()),r(je()),r(T(null))},h=(p,u)=>{r(qe(u))};return e.jsx(e.Fragment,{children:e.jsx(L,{sx:{},children:e.jsxs(L,{children:[e.jsxs(Ke,{value:y,onChange:h,children:[e.jsx(ve,{label:"Vehicle Report"}),e.jsx(ve,{label:"Batch data report"})]}),e.jsx(Te,{value:y,index:0,children:e.jsx(ua,{handleBack:l,selectedDate:n,setEndDate:be,setStartDate:Se,startDate:_,endDate:v})}),e.jsx(Te,{value:y,index:1,children:e.jsx(ja,{handleBack:l,selectedDate:n,setEndDate:be,setStartDate:Se,startDate:_,endDate:v})})]})})})}function ma(){const{mode:S,showVehicles:T,selectedVehicleGroup:b}=N(f=>f.dashboard),{w_customer_id:_}=N(f=>f.auth),{reportType:v}=N(f=>f.report),[y,n]=j.useState([]),[d,r]=j.useState(!0),[l,h]=j.useState(!1),p=sa(S);let u=J();j.useEffect(()=>{V()},[]);const V=async()=>{try{let f=[],E=[];const O=await u(Xe({w_customer_id:_}));if(Array.isArray(O.payload)){O.payload.forEach(m=>{var F,z;Array.isArray(m.imei)&&m.imei.length>0?(f.push({id:m.id,label:m.registration_id,value:(F=m==null?void 0:m.imei[0])==null?void 0:F.mac_id,workShop:m==null?void 0:m.workshop,vehicle_group:m==null?void 0:m.vehicle_group}),E.push((z=m.imei[0])==null?void 0:z.mac_id)):console.error("IMEI data not found for item:",m)});const $="one",M=E;E.length>0&&(u(Je({type:$,imei:M})),u(Qe(M))),n(f),u(Ze({w_customer_id:_})),u(we({}))}else console.error("Unexpected data format:",O),X.error("Unexpected data format:")}catch(f){console.error("Error fetching vehicle data:",f),X.error(`Error fetching vehicle data: ${f}`)}};return y.filter(f=>Object.keys(b).length===0||f.vehicle_group===b.id),e.jsxs("div",{className:"app",children:[e.jsx(ea,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:p.grey[100]},children:[e.jsx(aa,{title:"Report",setShowVehiclesGroup:h,showVehiclesGroup:l,reportType:v}),e.jsx(la,{setShowVehiclesGroup:h,showVehiclesGroup:l}),e.jsxs(L,{style:{display:"flex",width:"100%",height:"95vh",background:p.grey[200]},children:[e.jsx(L,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(L,{style:{width:"100%"},children:e.jsx(va,{showCard:d,setReportType:ta,reportType:v})})}),!1]})]})]})}export{ma as default};
