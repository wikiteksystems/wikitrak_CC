import{b as g,cX as vt,ge as wt,ds as ve,cZ as tt,cW as Et,_ as At,ck as Re,gf as Me,co as Dt,cw as Tt,cx as Pt,cB as It,ct as st,dp as $t,cj as Lt,cm as Rt,gg as Bt,dy as Ft,gh as Ot,a$ as de,b0 as M,j as e,aX as o,bb as De,bd as re,eb as Nt,ec as Mt,ed as Wt,ba as Ht,aZ as ge,ef as Ut,eg as Gt,T as Yt,b6 as oe,gi as rt,gj as Kt,gk as zt,gl as Xt,gm as qt,gn as Jt,go as Qt,gp as Zt,gq as Vt,gr as es,fl as Se,dM as be,dN as ye,dP as Ce,ek as je,a_ as _e,gs as me,gt as Te,gu as ts,gv as ss,gw as rs,gx as as,gy as os,gz as ns,gA as We,gB as He,gC as ne,c5 as le,b8 as H,gD as te,gE as bt,gF as Pe,gG as Ie,gH as ls,gI as at,bG as is,b$ as cs,gJ as ue,gK as ot,gL as nt,gM as Ue,gN as lt,gO as Fe,bn as ke,gP as it,bT as ds,bU as ps,d5 as us,gQ as xs,gR as hs,gS as ct,gT as gs,gU as dt,gV as pt,bx as fs,bA as ms,br as bs,gW as ys,gX as Cs,gY as js}from"./index-Cdz_WO7e.js";import{C as _s,I as yt}from"./index-Lz7Nc-Mb.js";import{SinoCastalTerminal as Ss,SinoCastalReadDTC as ks,SinoCastalLiveParameter as vs}from"./Index-4t94Pi3S.js";import"./index.esm-6HYcfm54.js";var ws={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Es=function(){var s=g.useRef([]),r=g.useRef(null);return g.useEffect(function(){var l=Date.now(),d=!1;s.current.forEach(function(w){if(w){d=!0;var x=w.style;x.transitionDuration=".3s, .3s, .3s, .06s",r.current&&l-r.current<100&&(x.transitionDuration="0s, 0s")}}),d&&(r.current=Date.now())}),s.current},ut=0,As=wt();function Ds(){var t;return As?(t=ut,ut+=1):t="TEST_OR_SSR",t}const Ts=function(t){var s=g.useState(),r=vt(s,2),l=r[0],d=r[1];return g.useEffect(function(){d("rc_progress_".concat(Ds()))},[]),t||l};var xt=function(s){var r=s.bg,l=s.children;return g.createElement("div",{style:{width:"100%",height:"100%",background:r}},l)};function ht(t,s){return Object.keys(t).map(function(r){var l=parseFloat(r),d="".concat(Math.floor(l*s),"%");return"".concat(t[r]," ").concat(d)})}var Ps=g.forwardRef(function(t,s){var r=t.prefixCls,l=t.color,d=t.gradientId,w=t.radius,x=t.style,p=t.ptg,_=t.strokeLinecap,n=t.strokeWidth,P=t.size,N=t.gapDegree,v=l&&ve(l)==="object",y=v?"#FFF":void 0,A=P/2,E=g.createElement("circle",{className:"".concat(r,"-circle-path"),r:w,cx:A,cy:A,stroke:y,strokeLinecap:_,strokeWidth:n,opacity:p===0?0:1,style:x,ref:s});if(!v)return E;var j="".concat(d,"-conic"),C=N?"".concat(180+N/2,"deg"):"0deg",O=ht(l,(360-N)/360),L=ht(l,1),m="conic-gradient(from ".concat(C,", ").concat(O.join(", "),")"),S="linear-gradient(to ".concat(N?"bottom":"top",", ").concat(L.join(", "),")");return g.createElement(g.Fragment,null,g.createElement("mask",{id:j},E),g.createElement("foreignObject",{x:0,y:0,width:P,height:P,mask:"url(#".concat(j,")")},g.createElement(xt,{bg:S},g.createElement(xt,{bg:m}))))}),we=100,Oe=function(s,r,l,d,w,x,p,_,n,P){var N=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,v=l/100*360*((360-x)/360),y=x===0?0:{bottom:0,top:180,left:90,right:-90}[p],A=(100-d)/100*r;n==="round"&&d!==100&&(A+=P/2,A>=r&&(A=r-.01));var E=we/2;return{stroke:typeof _=="string"?_:void 0,strokeDasharray:"".concat(r,"px ").concat(s),strokeDashoffset:A+N,transform:"rotate(".concat(w+v+y,"deg)"),transformOrigin:"".concat(E,"px ").concat(E,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Is=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function gt(t){var s=t??[];return Array.isArray(s)?s:[s]}var $s=function(s){var r=tt(tt({},ws),s),l=r.id,d=r.prefixCls,w=r.steps,x=r.strokeWidth,p=r.trailWidth,_=r.gapDegree,n=_===void 0?0:_,P=r.gapPosition,N=r.trailColor,v=r.strokeLinecap,y=r.style,A=r.className,E=r.strokeColor,j=r.percent,C=Et(r,Is),O=we/2,L=Ts(l),m="".concat(L,"-gradient"),S=O-x/2,I=Math.PI*2*S,b=n>0?90+n/2:-90,T=I*((360-n)/360),c=ve(w)==="object"?w:{count:w,space:2},F=c.count,a=c.space,k=gt(j),R=gt(E),u=R.find(function(G){return G&&ve(G)==="object"}),h=u&&ve(u)==="object",f=h?"butt":v,D=Oe(I,T,0,100,b,n,P,N,f,x),$=Es(),Y=function(){var B=0;return k.map(function(W,q){var K=R[q]||R[R.length-1],J=Oe(I,T,B,W,b,n,P,K,f,x);return B+=W,g.createElement(Ps,{key:q,color:K,ptg:W,radius:S,prefixCls:d,gradientId:m,style:J,strokeLinecap:f,strokeWidth:x,gapDegree:n,ref:function(ie){$[q]=ie},size:we})}).reverse()},i=function(){var B=Math.round(F*(k[0]/100)),W=100/F,q=0;return new Array(F).fill(null).map(function(K,J){var se=J<=B-1?R[0]:N,ie=se&&ve(se)==="object"?"url(#".concat(m,")"):void 0,U=Oe(I,T,q,W,b,n,P,se,"butt",x,a);return q+=(T-U.strokeDashoffset+a)*100/T,g.createElement("circle",{key:J,className:"".concat(d,"-circle-path"),r:S,cx:O,cy:O,stroke:ie,strokeWidth:x,opacity:1,style:U,ref:function(Z){$[J]=Z}})})};return g.createElement("svg",At({className:Re("".concat(d,"-circle"),A),viewBox:"0 0 ".concat(we," ").concat(we),style:y,id:l,role:"presentation"},C),!F&&g.createElement("circle",{className:"".concat(d,"-circle-trail"),r:S,cx:O,cy:O,stroke:N,strokeLinecap:f,strokeWidth:p||x,style:D}),F?i():Y())};function he(t){return!t||t<0?0:t>100?100:t}function $e(t){let{success:s,successPercent:r}=t,l=r;return s&&"progress"in s&&(l=s.progress),s&&"percent"in s&&(l=s.percent),l}const Ls=t=>{let{percent:s,success:r,successPercent:l}=t;const d=he($e({success:r,successPercent:l}));return[d,he(he(s)-d)]},Rs=t=>{let{success:s={},strokeColor:r}=t;const{strokeColor:l}=s;return[l||Me.green,r||null]},Be=(t,s,r)=>{var l,d,w,x;let p=-1,_=-1;if(s==="step"){const n=r.steps,P=r.strokeWidth;typeof t=="string"||typeof t>"u"?(p=t==="small"?2:14,_=P??8):typeof t=="number"?[p,_]=[t,t]:[p=14,_=8]=t,p*=n}else if(s==="line"){const n=r==null?void 0:r.strokeWidth;typeof t=="string"||typeof t>"u"?_=n||(t==="small"?6:8):typeof t=="number"?[p,_]=[t,t]:[p=-1,_=8]=t}else(s==="circle"||s==="dashboard")&&(typeof t=="string"||typeof t>"u"?[p,_]=t==="small"?[60,60]:[120,120]:typeof t=="number"?[p,_]=[t,t]:(p=(d=(l=t[0])!==null&&l!==void 0?l:t[1])!==null&&d!==void 0?d:120,_=(x=(w=t[0])!==null&&w!==void 0?w:t[1])!==null&&x!==void 0?x:120));return[p,_]},Bs=3,Fs=t=>Bs/t*100,Os=t=>{const{prefixCls:s,trailColor:r=null,strokeLinecap:l="round",gapPosition:d,gapDegree:w,width:x=120,type:p,children:_,success:n,size:P=x}=t,[N,v]=Be(P,"circle");let{strokeWidth:y}=t;y===void 0&&(y=Math.max(Fs(N),6));const A={width:N,height:v,fontSize:N*.15+6},E=g.useMemo(()=>{if(w||w===0)return w;if(p==="dashboard")return 75},[w,p]),j=d||p==="dashboard"&&"bottom"||void 0,C=Object.prototype.toString.call(t.strokeColor)==="[object Object]",O=Rs({success:n,strokeColor:t.strokeColor}),L=Re(`${s}-inner`,{[`${s}-circle-gradient`]:C}),m=g.createElement($s,{percent:Ls(t),strokeWidth:y,trailWidth:y,strokeColor:O,strokeLinecap:l,trailColor:r,prefixCls:s,gapDegree:E,gapPosition:j});return g.createElement("div",{className:L,style:A},N<=20?g.createElement(Dt,{title:_},g.createElement("span",null,m)):g.createElement(g.Fragment,null,m,_))},Ns=Os,Le="--progress-line-stroke-color",Ct="--progress-percent",ft=t=>{const s=t?"100%":"-100%";return new $t(`antProgress${t?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${s}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${s}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},Ms=t=>{const{componentCls:s,iconCls:r}=t;return{[s]:Object.assign(Object.assign({},It(t)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:t.fontSize},[`${s}-outer`]:{display:"inline-block",width:"100%"},[`&${s}-show-info`]:{[`${s}-outer`]:{marginInlineEnd:`calc(-2em - ${st(t.marginXS)})`,paddingInlineEnd:`calc(2em + ${st(t.paddingXS)})`}},[`${s}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:t.remainingColor,borderRadius:t.lineBorderRadius},[`${s}-inner:not(${s}-circle-gradient)`]:{[`${s}-circle-path`]:{stroke:t.defaultColor}},[`${s}-success-bg, ${s}-bg`]:{position:"relative",background:t.defaultColor,borderRadius:t.lineBorderRadius,transition:`all ${t.motionDurationSlow} ${t.motionEaseInOutCirc}`},[`${s}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Le})`]},height:"100%",width:`calc(1 / var(${Ct}) * 100%)`,display:"block"}},[`${s}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:t.colorSuccess},[`${s}-text`]:{display:"inline-block",width:"2em",marginInlineStart:t.marginXS,color:t.colorText,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[r]:{fontSize:t.fontSize}},[`&${s}-status-active`]:{[`${s}-bg::before`]:{position:"absolute",inset:0,backgroundColor:t.colorBgContainer,borderRadius:t.lineBorderRadius,opacity:0,animationName:ft(),animationDuration:t.progressActiveMotionDuration,animationTimingFunction:t.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${s}-rtl${s}-status-active`]:{[`${s}-bg::before`]:{animationName:ft(!0)}},[`&${s}-status-exception`]:{[`${s}-bg`]:{backgroundColor:t.colorError},[`${s}-text`]:{color:t.colorError}},[`&${s}-status-exception ${s}-inner:not(${s}-circle-gradient)`]:{[`${s}-circle-path`]:{stroke:t.colorError}},[`&${s}-status-success`]:{[`${s}-bg`]:{backgroundColor:t.colorSuccess},[`${s}-text`]:{color:t.colorSuccess}},[`&${s}-status-success ${s}-inner:not(${s}-circle-gradient)`]:{[`${s}-circle-path`]:{stroke:t.colorSuccess}}})}},Ws=t=>{const{componentCls:s,iconCls:r}=t;return{[s]:{[`${s}-circle-trail`]:{stroke:t.remainingColor},[`&${s}-circle ${s}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${s}-circle ${s}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:t.circleTextColor,fontSize:t.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[r]:{fontSize:t.circleIconFontSize}},[`${s}-circle&-status-exception`]:{[`${s}-text`]:{color:t.colorError}},[`${s}-circle&-status-success`]:{[`${s}-text`]:{color:t.colorSuccess}}},[`${s}-inline-circle`]:{lineHeight:1,[`${s}-inner`]:{verticalAlign:"bottom"}}}},Hs=t=>{const{componentCls:s}=t;return{[s]:{[`${s}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:t.progressStepMinWidth,marginInlineEnd:t.progressStepMarginInlineEnd,backgroundColor:t.remainingColor,transition:`all ${t.motionDurationSlow}`,"&-active":{backgroundColor:t.defaultColor}}}}}},Us=t=>{const{componentCls:s,iconCls:r}=t;return{[s]:{[`${s}-small&-line, ${s}-small&-line ${s}-text ${r}`]:{fontSize:t.fontSizeSM}}}},Gs=t=>({circleTextColor:t.colorText,defaultColor:t.colorInfo,remainingColor:t.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${t.fontSize/t.fontSizeSM}em`}),Ys=Tt("Progress",t=>{const s=t.calc(t.marginXXS).div(2).equal(),r=Pt(t,{progressStepMarginInlineEnd:s,progressStepMinWidth:s,progressActiveMotionDuration:"2.4s"});return[Ms(r),Ws(r),Hs(r),Us(r)]},Gs);var Ks=function(t,s){var r={};for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&s.indexOf(l)<0&&(r[l]=t[l]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,l=Object.getOwnPropertySymbols(t);d<l.length;d++)s.indexOf(l[d])<0&&Object.prototype.propertyIsEnumerable.call(t,l[d])&&(r[l[d]]=t[l[d]]);return r};const zs=t=>{let s=[];return Object.keys(t).forEach(r=>{const l=parseFloat(r.replace(/%/g,""));isNaN(l)||s.push({key:l,value:t[r]})}),s=s.sort((r,l)=>r.key-l.key),s.map(r=>{let{key:l,value:d}=r;return`${d} ${l}%`}).join(", ")},Xs=(t,s)=>{const{from:r=Me.blue,to:l=Me.blue,direction:d=s==="rtl"?"to left":"to right"}=t,w=Ks(t,["from","to","direction"]);if(Object.keys(w).length!==0){const p=zs(w),_=`linear-gradient(${d}, ${p})`;return{background:_,[Le]:_}}const x=`linear-gradient(${d}, ${r}, ${l})`;return{background:x,[Le]:x}},qs=t=>{const{prefixCls:s,direction:r,percent:l,size:d,strokeWidth:w,strokeColor:x,strokeLinecap:p="round",children:_,trailColor:n=null,success:P}=t,N=x&&typeof x!="string"?Xs(x,r):{[Le]:x,background:x},v=p==="square"||p==="butt"?0:void 0,y=d??[-1,w||(d==="small"?6:8)],[A,E]=Be(y,"line",{strokeWidth:w}),j={backgroundColor:n||void 0,borderRadius:v},C=Object.assign(Object.assign({width:`${he(l)}%`,height:E,borderRadius:v},N),{[Ct]:he(l)/100}),O=$e(t),L={width:`${he(O)}%`,height:E,borderRadius:v,backgroundColor:P==null?void 0:P.strokeColor},m={width:A<0?"100%":A,height:E};return g.createElement(g.Fragment,null,g.createElement("div",{className:`${s}-outer`,style:m},g.createElement("div",{className:`${s}-inner`,style:j},g.createElement("div",{className:`${s}-bg`,style:C}),O!==void 0?g.createElement("div",{className:`${s}-success-bg`,style:L}):null)),_)},Js=qs,Qs=t=>{const{size:s,steps:r,percent:l=0,strokeWidth:d=8,strokeColor:w,trailColor:x=null,prefixCls:p,children:_}=t,n=Math.round(r*(l/100)),N=s??[s==="small"?2:14,d],[v,y]=Be(N,"step",{steps:r,strokeWidth:d}),A=v/r,E=new Array(r);for(let j=0;j<r;j++){const C=Array.isArray(w)?w[j]:w;E[j]=g.createElement("div",{key:j,className:Re(`${p}-steps-item`,{[`${p}-steps-item-active`]:j<=n-1}),style:{backgroundColor:j<=n-1?C:x,width:A,height:y}})}return g.createElement("div",{className:`${p}-steps-outer`},E,_)},Zs=Qs;var Vs=function(t,s){var r={};for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&s.indexOf(l)<0&&(r[l]=t[l]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,l=Object.getOwnPropertySymbols(t);d<l.length;d++)s.indexOf(l[d])<0&&Object.prototype.propertyIsEnumerable.call(t,l[d])&&(r[l[d]]=t[l[d]]);return r};const er=["normal","exception","active","success"],tr=g.forwardRef((t,s)=>{const{prefixCls:r,className:l,rootClassName:d,steps:w,strokeColor:x,percent:p=0,size:_="default",showInfo:n=!0,type:P="line",status:N,format:v,style:y}=t,A=Vs(t,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style"]),E=g.useMemo(()=>{var R,u;const h=$e(t);return parseInt(h!==void 0?(R=h??0)===null||R===void 0?void 0:R.toString():(u=p??0)===null||u===void 0?void 0:u.toString(),10)},[p,t.success,t.successPercent]),j=g.useMemo(()=>!er.includes(N)&&E>=100?"success":N||"normal",[N,E]),{getPrefixCls:C,direction:O,progress:L}=g.useContext(Lt),m=C("progress",r),[S,I,b]=Ys(m),T=g.useMemo(()=>{if(!n)return null;const R=$e(t);let u;const h=v||(D=>`${D}%`),f=P==="line";return v||j!=="exception"&&j!=="success"?u=h(he(p),he(R)):j==="exception"?u=f?g.createElement(Bt,null):g.createElement(Ft,null):j==="success"&&(u=f?g.createElement(_s,null):g.createElement(Ot,null)),g.createElement("span",{className:`${m}-text`,title:typeof u=="string"?u:void 0},u)},[n,p,E,j,P,m,v]),c=Array.isArray(x)?x[0]:x,F=typeof x=="string"||Array.isArray(x)?x:void 0;let a;P==="line"?a=w?g.createElement(Zs,Object.assign({},t,{strokeColor:F,prefixCls:m,steps:w}),T):g.createElement(Js,Object.assign({},t,{strokeColor:c,prefixCls:m,direction:O}),T):(P==="circle"||P==="dashboard")&&(a=g.createElement(Ns,Object.assign({},t,{strokeColor:c,prefixCls:m,progressStatus:j}),T));const k=Re(m,`${m}-status-${j}`,`${m}-${P==="dashboard"&&"circle"||w&&"steps"||P}`,{[`${m}-inline-circle`]:P==="circle"&&Be(_,"circle")[0]<=20,[`${m}-show-info`]:n,[`${m}-${_}`]:typeof _=="string",[`${m}-rtl`]:O==="rtl"},L==null?void 0:L.className,l,d,I,b);return S(g.createElement("div",Object.assign({ref:s,style:Object.assign(Object.assign({},L==null?void 0:L.style),y),className:k,role:"progressbar","aria-valuenow":E},Rt(A,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),a))}),mt=tr;function sr({title:t,setShowVehicles:s,showVehicles:r,showParams:l,setShowParams:d}){const w=de(),{collapsed:x}=M(L=>L.auth),{isLiveParameter:p,isWriteParameter:_,isActuator:n,isRoutineTest:P,isFlashing:N,isJ1939:v,selectedVehicle:y}=M(L=>L.diagnostics),{tractorIcon:A}=M(L=>L.liveMap);JSON.parse(localStorage.getItem("w_userDetails"));const{mode:E,selectedVehicleGroup:j}=M(L=>L.dashboard),C=()=>{w(Gt(!x))},O={fontSize:"26px",fontWeight:500,lineHeight:"18.38px",color:"#fff",textAlign:"center",paddingTop:"5px",fontFamily:"ubuntu"};return e.jsxs(o,{style:{display:"flex",justifyContent:"space-between",paddingRight:"20px",backgroundColor:De.bgColor,alignItems:"center",textAlign:"center",height:"60px",color:"white"},children:[e.jsxs(o,{style:{display:"flex",justifyContent:"space-between",gap:"10px",alignItems:"center",width:"50%"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[x?e.jsx(re,{onClick:C,sx:{color:"white"},children:e.jsx(Nt,{style:{width:"30px",height:"30px"}})}):e.jsx(re,{onClick:C,sx:{color:"white"},children:e.jsx(Mt,{style:{width:"30px",height:"30px"}})}),e.jsx("img",{src:Wt,alt:"wikitrak logo"})]}),e.jsx(o,{children:e.jsx(Ht,{style:O,children:t})})]}),e.jsxs(o,{style:{display:"flex",gap:"5px"},children:[e.jsxs(re,{variant:"outlined",size:"small",sx:{color:r?"white":"black",backgroundColor:r?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:()=>{s(!r),d(!1)},children:[e.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",style:{marginRight:"5px"},children:e.jsx("path",{d:A.path1})}),Object.keys(y).length>0?y.reg_id:"Vehicles"]}),(p||_||n||P||N||v)&&e.jsxs(re,{variant:"outlined",size:"small",sx:{color:l?"blue":"white",backgroundColor:l?"white":"undefined",mt:"6px",mx:"5px",border:"1px solid white",height:"40px"},onClick:()=>{s(!1),d(!l)},children:[p&&"Live Parameter",_&&"Write Parameter",n&&"Actuator Test",P&&"Routine Test",N&&"Flashing",v&&"J1939 Parameter"]}),e.jsx(ge,{onClick:()=>{w(Ut(!E))},sx:{color:"white"}})]})]})}const rr=({vehicleData:t,handleChange:s})=>{const{selectedVehicle:r}=M(_=>_.diagnostics),[l,d]=g.useState(""),{mode:w}=M(_=>_.dashboard),x=oe(w),p=t&&t.length>0&&t.filter(_=>_.label.toLowerCase().includes(l));return e.jsxs(e.Fragment,{children:[e.jsx(yt,{style:{width:"85%",margin:"8px 20px",padding:"10px"},placeholder:"Search vehicle",onChange:_=>d(_.target.value)}),p.length>0?p.map((_,n)=>e.jsx(o,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(re,{variant:"outlined",onClick:()=>{s(_)},sx:{width:"90%",bgcolor:_.label===(r==null?void 0:r.reg_id)?De.bgColor:"undefined",color:_.label===(r==null?void 0:r.reg_id)?"white":x.grey[400],border:`1px solid ${De.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:De.bgShadow}},children:_.label})},n)):e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh"},children:e.jsx(Yt,{sx:{textAlign:"center",color:x.grey[400]},children:"Sorry! No vehicles"})})]})},ar=({options:t})=>{const{selectedMenu:s,selectedVehicle:r}=M(p=>p.diagnostics),l=de(),{mode:d}=M(p=>p.dashboard),w=oe(d),x=p=>{switch(rt(p),l(rt(p)),p){case"Terminal Application":l(es());break;case"Write Parameters":l(Vt());break;case"Read DTC":l(Zt());break;case"Live Parameters":l(Qt());break;case"Actuator Test":l(Jt());break;case"Routine Test":l(qt());break;case"ECU Information":l(Xt());break;case"Flashing":l(zt());break;case"J1939 Parameters":l(Kt());break}};return e.jsx(e.Fragment,{children:e.jsx("div",{children:t.length>0&&t.map((p,_)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsxs(o,{sx:{border:s!==p.label?"1px solid #E8E8E8":"",p:"8px",borderRadius:"5px",m:"10px",display:"flex",cursor:"pointer",color:s===p.label?"white":w.grey[400],backgroundColor:s===p.label?"#8DA6C6":void 0},onClick:()=>{x(p.label)},children:[e.jsx(o,{sx:{mx:"5px"},children:p.icon}),e.jsx(o,{sx:{mx:"5px",fontSize:"16px"},children:e.jsx("span",{children:p.label})})]})},_))})})},jt="https://cc.wikitrak.in/proxy-3031",or=({deviceType:t})=>{var I,b,T;const s=de(),{liveParameters:r,isLiveParameter:l,isWriteParameter:d,isActuator:w,isRoutineTest:x,isFlashing:p,loading:_,isDtcLoader:n,isJ1939:P,j1939Parameters:N}=M(c=>c.diagnostics),{vehicleList:v,selectedVehicle:y}=M(c=>c.liveMap);M(c=>c.dashboard);let E=(T=(b=(I=((v||[]).find(c=>{var F;return((F=c==null?void 0:c.imei[0])==null?void 0:F.mac_id)===(y==null?void 0:y.imei)})||{}).sub_model)==null?void 0:I.ecus[0])==null?void 0:b.ecu[0])==null?void 0:T.file;E=(E==null?void 0:E.map(c=>({...c,label:c.sw_part_no})))||[];const j=(c,F)=>{let a=r.map((k,R)=>(k.label,{...k,checked:k.label===F?c.target.checked:k.checked}));s(me(a))},C=(c,F)=>{let a=N.map((k,R)=>(k.label,{...k,checked:k.label===F?c.target.checked:k.checked}));s(Te(a))},O=c=>{s(ts(c.label)),s(ss(c))},L=c=>{s(rs(c.label)),s(as(c))},m=c=>{s(os(c.label)),s(ns(c))},S=c=>{s(We(c.label)),s(He(c))};return e.jsxs("div",{children:[n&&e.jsx(Se,{}),l&&e.jsx(nr,{handleLiveParameter:j,deviceType:t}),d&&e.jsx(lr,{handleWriteParameter:O}),w&&e.jsx(ir,{handleActuatorTest:L}),x&&e.jsx(cr,{handleRoutineTest:m}),p&&e.jsx(dr,{handleFlashing:S}),P&&e.jsx(pr,{handleJ1939Parameter:C})]})},nr=({handleLiveParameter:t,deviceType:s})=>{const r=de(),{liveParameters:l,liveParameterGroupList:d,selectedVehicle:w}=M(b=>b.diagnostics),{mode:x}=M(b=>b.dashboard),p=oe(x);M(b=>b.liveMap);const[_,n]=g.useState(""),[P,N]=g.useState(""),[v,y]=g.useState(!1);g.useState(!1);const A=l.length>0&&l.filter(b=>b.label.toLowerCase().includes(_.toLowerCase())),E=d.length>0&&d.filter(b=>b.label.toLowerCase().includes(P.toLowerCase())),j=(b,T)=>{T==="group"&&N(b.target.value),T==="one"&&n(b.target.value)};function C(b){return b.match(/../g).reverse().join("")}function O(b,T){const{pidArray:c,frames:F}=b,a=F[F.length-1];let k=0;for(const R of c){const h=R.toLowerCase().padStart(4,"0").match(/../g).reverse().join(""),f=l.find(G=>G.code===h);if(!f||!Array.isArray(f.pi_code_variable)||f.pi_code_variable.length===0){console.warn(`Invalid or missing pi_code_variable for PID: ${h}`);continue}const D=f.pi_code_variable[0];if(console.log("byteInfo",D),!D||typeof D.length!="number"||!D.message_type||D.length<=0){console.warn(`Invalid byte definition for PID: ${h}`,D);continue}const $=D.length,Y=$*2,i=a.slice(k*2,k*2+Y);if(R===T){const{resolution:G=1,offset:B=0,message_type:W}=D,q=C(i);let K=null;switch(W){case"CONTINUOUS":K=Ie(q)*G+B;break;case"ASCII":K=Pe(q);break;case"eNUM":case"bcd-hex":K=q;break;case"FLOAT":K=ls(q);break;default:return{pid:T,error:`Unknown message_type: ${W}`}}return{pidCheck:h,valueHex:i,valueHexLE:q,decimalValue:K}}k+=$}return{pid:T,error:"PID not found or byte definition missing"}}const L=async()=>{var T;const b=l.filter(c=>c.checked);if(s==="Sinocastel"){r(ne(!0));try{const F=b.map(u=>u.code).map(u=>u.toLowerCase().padStart(4,"0").match(/../g).reverse().join("")),{data:a}=await le.post(`${jt}/api/packet/latest`,{imei:w.imei,pid:F}),k=(T=a==null?void 0:a.results)!=null&&T.length?a.results.filter(u=>u==null?void 0:u.packet).map(u=>O(u.packet,u.pid)):[],R=l.map(u=>{const h=k.find(f=>f.pidCheck===u.code);return console.log("match",h,h==null?void 0:h.decimalValue),{...u,dataByte:h?h.decimalValue:""}});r(me(R)),r(ne(!1))}catch(c){r(ne(!1)),console.error("Error in Sinocastel flow:",c),H.error("Failed to read parameter data")}}else try{r(ne(!0));const c=b.map(u=>({command:te("4",u.code,"00"),id:u.id})),F=c.map(u=>u.command),a=await le.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:w.imei,commands:`{${F}}`}),k=a==null?void 0:a.data;if(!(k!=null&&k.success)||!Array.isArray(k.commands))throw new Error("Invalid API response");let R=[...l];k.commands.forEach((u,h)=>{var f;try{const D=bt(u),{id:$}=c[h]||{};if(!$)return;const Y=R.find(W=>W.id===$),i=(f=Y==null?void 0:Y.pi_code_variable)==null?void 0:f[0];if(!i||!D.startsWith("62")){i!=null&&i.short_name&&H.error(`Negative response from ECU for ${i.short_name}`);return}let G=D.toLowerCase().replace(Y.code.toLowerCase().slice(2),"").slice(2),B;switch(i.message_type){case"CONTINUOUS":B=Ie(G)*i.resolution+i.offset;break;case"ASCII":B=Pe(G);break;case"eNUM":case"bcd-hex":B=G;break;default:return}R=R.map(W=>W.id===$?{...W,dataByte:B}:W)}catch(D){console.error("Error decoding command:",D)}}),r(me(R))}catch(c){console.error("Error in handleSubmit:",c),H.error("Response timeout")}finally{r(ne(!1))}},m=()=>{y(!v)},S=(b,T)=>{const c=b.target.checked;console.log("ischeckd",c);const F=d.find(k=>k.id===T);if(!F)return;const a=l.map(k=>{var u,h,f;const R=(f=(h=(u=k.pi_code_variable)==null?void 0:u[0])==null?void 0:h.group)==null?void 0:f.some(D=>D.id===F.id);return console.log("belongsToGroup",R),R?{...k,checked:c}:k});r(me(a))},I=b=>{if(b.target.checked){let T=l.map(c=>({...c,checked:!0}));r(me(T))}else{let T=l.map(c=>({...c,checked:!1}));r(me(T))}};return e.jsxs(e.Fragment,{children:[e.jsxs(o,{children:[!v&&e.jsxs(e.Fragment,{children:[e.jsxs(be,{sx:{width:"75%",mt:"15px",mx:"15px",backgroundColor:p.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:p.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:b=>{j(b,"one")},inputProps:{style:{padding:7,color:p.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(ge,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]}),e.jsx("input",{type:"checkbox",style:{marginTop:"25px"},onChange:I})]}),v&&e.jsx(e.Fragment,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:p.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:p.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:b=>{j(b,"group")},inputProps:{style:{padding:7,color:p.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(ge,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})})]}),!v&&e.jsxs("div",{style:{height:"67vh",overflow:"auto"},children:[A.length>0&&A.map((b,T)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},title:b.label,children:e.jsxs(o,{sx:{border:"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:p.grey[400]},children:[e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:b.label.length<=25?b.label:`${b.label.substring(0,25)}...`})}),e.jsx(o,{sx:{fontSize:"16px",position:"relative",right:"2px"},children:e.jsx("input",{type:"checkbox",onChange:c=>{t(c,b.label)},checked:b.checked,style:{width:"20px",padding:0}})})]})},T)),!(A.length>0)&&e.jsx("h3",{children:"No Data"})]}),v&&e.jsx("div",{style:{height:"67vh",overflow:"auto"},children:E.length>0&&E.map((b,T)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},title:b.label,children:e.jsxs(o,{sx:{border:"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:p.grey[400]},children:[e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:b.label.length<=25?b.label:`${b.label.substring(0,20)}...`})}),e.jsx(o,{sx:{fontSize:"16px",position:"relative",right:"2px"},children:e.jsx("input",{type:"checkbox",onChange:c=>{S(c,b.id)},checked:b.checked,style:{width:"20px",padding:0}})})]})},T))}),e.jsx(o,{sx:{mt:"25px"},children:e.jsx(re,{variant:"contained",sx:{width:"90%",mx:"10px",backgroundColor:"#8DA6C6"},onClick:L,children:"Submit"})}),e.jsx(o,{sx:{mt:"10px"},children:e.jsx(re,{variant:"contained",sx:{width:"90%",mx:"10px",backgroundColor:"white",color:"black"},onClick:m,children:v?"Select Parameter":"Select Group"})})]})},lr=({handleWriteParameter:t})=>{const{writeParameter:s,activeWriteParameter:r}=M(n=>n.diagnostics),{mode:l}=M(n=>n.dashboard),d=oe(l),[w,x]=g.useState(""),p=s.length>0&&s.filter(n=>n.label.toLowerCase().includes(w.toLowerCase())),_=n=>{x(n.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:d.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:d.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:_,inputProps:{style:{padding:7,color:d.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(ge,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})}),p.length>0&&p.map((n,P)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(o,{sx:{p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",border:r===n.label?"1px solid #8DA6C6":"1px solid #E8E8E8",color:r===n.label?"white":d.grey[400],backgroundColor:r===n.label?"#8DA6C6":void 0},onClick:()=>{t(n)},children:e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:n.label.length<=25?n.label:`${n.label.substring(0,25)}...`})})})},P))]})},ir=({handleActuatorTest:t})=>{const{liveParameters:s,writeParameter:r,actuatorTestList:l,routineTestList:d,isLiveParameter:w,isWriteParameter:x,isActuator:p,activeWriteParameter:_,activeActuatorTest:n,activeRoutineTest:P,activeFlashingFile:N,isRoutineTest:v,isFlashing:y}=M(m=>m.diagnostics),{mode:A}=M(m=>m.dashboard),E=oe(A),[j,C]=g.useState(""),O=l.length>0&&l.filter(m=>m.label.toLowerCase().includes(j.toLowerCase())),L=m=>{C(m.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:E.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:E.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:L,inputProps:{style:{padding:7,color:E.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(ge,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})}),O.length>0&&O.map((m,S)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(o,{sx:{border:n===m.label?"1px solid #8DA6C6":"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:n===m.label?"white":E.grey[400],backgroundColor:n===m.label?"#8DA6C6":void 0},onClick:()=>{t(m)},children:e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:m.label.length<=25?m.label:`${m.label.substring(0,25)}...`})})})},S))]})},cr=({handleRoutineTest:t})=>{const{routineTestList:s,activeRoutineTest:r}=M(n=>n.diagnostics),{mode:l}=M(n=>n.dashboard),d=oe(l),[w,x]=g.useState(""),p=s.length>0&&s.filter(n=>n.label.toLowerCase().includes(w.toLowerCase())),_=n=>{x(n.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:d.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:d.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:_,inputProps:{style:{padding:7,color:d.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(ge,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})}),p.length>0&&p.map((n,P)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(o,{sx:{border:r===n.label?"1px solid #8DA6C6":"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:r===n.label?"white":d.grey[400],backgroundColor:r===n.label?"#8DA6C6":void 0},onClick:()=>{t(n)},children:e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:n.label.length<=25?n.label:`${n.label.substring(0,25)}...`})})})},P)),!s.length>0&&e.jsx("div",{style:{marginTop:"40%",textAlign:"center",color:d.grey[400]},children:e.jsx("h3",{children:"Routine test not available"})})]})},dr=({handleFlashing:t})=>{const{activeFlashingFile:s,fotaFiles:r}=M(n=>n.diagnostics),{mode:l}=M(n=>n.dashboard),d=oe(l),[w,x]=g.useState(""),p=r.length>0&&r.filter(n=>n.label.toLowerCase().includes(w.toLowerCase())),_=n=>{x(n.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:d.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:d.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:_,inputProps:{style:{padding:7,color:d.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(ge,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})}),e.jsx("div",{style:{height:"90vh",overflow:"auto"},children:p.length>0&&p.map((n,P)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(o,{sx:{border:s===n.label?"1px solid #8DA6C6":"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:s===n.label?"white":d.grey[400],backgroundColor:s===n.label?"#8DA6C6":d.grey[100]},onClick:()=>{t(n)},children:e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:n.label.length<=25?n.label:`${n.label.substring(0,25)}...`})})})},P))})]})},pr=({handleJ1939Parameter:t})=>{const s=de(),{j1939Parameters:r,selectedVehicle:l}=M(j=>j.diagnostics),{mode:d}=M(j=>j.dashboard),w=oe(d);M(j=>j.liveMap);const[x,p]=g.useState(""),[_,n]=g.useState(!1);g.useState(!1);const P=r.length>0&&r.filter(j=>j.label.toLowerCase().includes(x.toLowerCase())),N=(j,C)=>{C==="group"&&setSearchText2(j.target.value),C==="one"&&p(j.target.value)};function v(j){return j.match(/../g).reverse().join("")}function y(j,C){const{pidArray:O,frames:L}=j;L[L.length-1];for(const m of O){m.toLowerCase().padStart(4,"0");const S=m,I=r.find(c=>{var F;return((F=c==null?void 0:c.pgn)==null?void 0:F.toLowerCase())===(S==null?void 0:S.toLowerCase())});if(!I||!Array.isArray(I.spn)||I.spn.length===0){console.warn(`Invalid or missing pi_code_variable for PID: ${S}`);continue}const b=I.spn[0];if(!b||typeof b.no_of_bytes!="number"||!b.message_type||b.no_of_bytes<=0){console.warn(`Invalid byte definition for PID: ${S}`,b);continue}b.no_of_bytes;const T=L[O.indexOf(m)];if(m===C){const{resolution:c=1,offset:F=0,message_type:a,start_byte:k,start_bit:R,no_of_bit:u,endian:h,bitcoded:f,no_of_bytes:D}=b,$=(k-1)*2,Y=$+D*2;let i=T.slice($,Y),G;f?G=parseInt(i,16).toString(2).padStart(D*8,"0").slice(R-1,R-1+u):G=i;let B;h.toLowerCase()==="big"?B=G:B=v(G);let W=null;switch(a){case"CONTINUOUS":W=Ie(B)*c+F;break;case"ASCII":W=Pe(B);break;case"eNUM":case"bcd-hex":W=B;break;default:return{pid:C,error:`Unknown message_type: ${a}`}}return{pidCheck:S,valueHex:T,decimalValue:W}}}return{pid:C,error:"PID not found or byte definition missing"}}const A=async()=>{var j;s(ne(!0));try{const O=r.filter(I=>I.checked).map(I=>I.pgn),{data:L}=await le.post(`${jt}/api/packet/latest`,{imei:l.imei,pid:O}),m=(j=L==null?void 0:L.results)!=null&&j.length?L.results.filter(I=>I==null?void 0:I.packet).map(I=>y(I.packet,I.pid)):[];console.log("pidArray",m);const S=r.map(I=>{const b=m.find(T=>T.pidCheck===I.pgn);return console.log("match",b,b==null?void 0:b.decimalValue),{...I,dataByte:b?b.decimalValue:""}});s(Te(S)),s(ne(!1))}catch(C){s(ne(!1)),console.error("Error in Sinocastel flow:",C),H.error("Failed to read parameter data")}},E=j=>{if(j.target.checked){let C=r.map(O=>({...O,checked:!0}));s(Te(C))}else{let C=r.map(O=>({...O,checked:!1}));s(Te(C))}};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:!_&&e.jsxs(e.Fragment,{children:[e.jsxs(be,{sx:{width:"75%",mt:"15px",mx:"15px",backgroundColor:w.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:w.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:j=>{N(j,"one")},inputProps:{style:{padding:7,color:w.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(ge,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]}),e.jsx("input",{type:"checkbox",style:{marginTop:"25px"},onChange:E})]})}),!_&&e.jsxs("div",{style:{height:"67vh",overflow:"auto"},children:[P.length>0&&P.map((j,C)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},title:j.label,children:e.jsxs(o,{sx:{border:"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:w.grey[400]},children:[e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:j.label.length<=25?j.label:`${j.label.substring(0,25)}...`})}),e.jsx(o,{sx:{fontSize:"16px",position:"relative",right:"2px"},children:e.jsx("input",{type:"checkbox",onChange:O=>{t(O,j.label)},checked:j.checked,style:{width:"20px",padding:0}})})]})},C)),!(P.length>0)&&e.jsx("h3",{children:"No Data"})]}),e.jsx(o,{sx:{mt:"25px"},children:e.jsx(re,{variant:"contained",sx:{width:"90%",mx:"10px",backgroundColor:"#8DA6C6"},onClick:A,children:"Submit"})})]})},ur=()=>{var b,T,c,F,a,k,R;const t=de(),{vehicleList:s}=M(u=>u.liveMap),{terminalAppLogs:r,dtcDataset:l,loading:d,isDtcLoader:w,selectedVehicle:x}=M(u=>u.diagnostics),{mode:p}=M(u=>u.dashboard),_=oe(p),[n,P]=g.useState(0),[N,v]=g.useState(""),[y,A]=g.useState([]),[E,j]=g.useState(!1),C=(s||[]).find(u=>{var h;return((h=u==null?void 0:u.imei[0])==null?void 0:h.mac_id)===(x==null?void 0:x.imei)})||{};console.log("active vehilce ",C,x),console.log("vehicle list",s),g.useEffect(()=>{var u,h,f,D,$,Y;if(((u=Object.keys(C))==null?void 0:u.length)>0&&((f=(h=C==null?void 0:C.sub_model)==null?void 0:h.ecus)==null?void 0:f.length)>0){let i=(Y=($=(D=C==null?void 0:C.sub_model)==null?void 0:D.ecus[0])==null?void 0:$.datasets[0])==null?void 0:Y.id;t(at({id:i}))}},[]);const O=(u,h)=>{var W,q;P(h);let f=(q=(W=C==null?void 0:C.sub_model)==null?void 0:W.ecus[h].datasets[0])==null?void 0:q.id;t(at({id:f}));const{tx_header:D,rx_header:$,protocol:Y}=u,i=`02${Y.autopeepal},04${D},06${$}`;switch(C.sub_model.ecus[h].read_dtc_fn_index.value.split("_")[0]){case"GENERICOBD":{const K=te("4","03","00"),J=te("4","07","00");H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:K})),H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:J}));let se={imei:x.imei,commands:`{${K}, ${J}}`,tranCmd:`{${K}, ${J}}`};t(ue(se));break}case"UDS":{i||H.error("Please click again");let K,J=i.split(","),se=J==null?void 0:J.map(ie=>{if((J==null?void 0:J.length)%2===0){H.error("The Tx Frame format is not right. Must be odd length.");return}return K=te("2",ie,"00"),K});if(se){H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:se}));let ie={imei:x.imei,commands:`{${se}}`,tranCmd:se};t(ue(ie))}break}case"KWP":{const K=te("4","1800AF","00");H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:K}));let J={imei:x.imei,commands:`{${K}}`,tranCmd:`{${K}}`};t(ue(J));break}default:{j(!1);break}}},L=async(u,h,f)=>{var D,$;if(j(!0),f==="clear")try{v("");let Y;Y=te(4,h,"00");const i=await le.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:x.imei,commands:`{${Y}}`});if(i!=null&&i.data&&j(!1),!((D=i==null?void 0:i.data)!=null&&D.success)){j(!1),v("Time Response is out");return}if((($=i==null?void 0:i.data)==null?void 0:$.commands.filter(B=>B.toLowerCase()==="400000ffff")).length>0){v("No response from ECU");return}v("Ecu is clear dtc Success");return}catch{v("Time Response is out")}else if(f==="read"){v("");try{v("");let Y;Y=te(4,h,"00");const i=await le.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:x.imei,commands:`{${Y}}`});return i!=null&&i.data&&j(!1),i==null?void 0:i.data}catch{return{success:!1}}}},m=async()=>{if(j(!0),n===null)return H.error("Please select the tab");const u=C.sub_model.ecus[n].read_dtc_fn_index.value;if(u==="KWP_2BYTE_DTC"||u==="UDS_2BYTE12_DTC"||u==="UDS_2BYTE_DTC"||u==="UDS_2BYTE13_DTC"||u==="UDS_3BYTE_DTC"){let h=null,f=!1;if(u==="KWP_2BYTE_DTC"){let $=null;$=await L(4,"1800FFFF","read"),$.success?(h=$.commands[0],f=!0):f=!1}else{let $=null;$=await L(3,"1902FF","read"),$.success?(h=$.commands[0],f=!0):f=!1}f&&h==="400000ffff"?v("No response from ECU"):f||v("Time Response Out");let D=[];if(u!=="KWP_2BYTE_DTC"){h=h==null?void 0:h.slice(6),h=h==null?void 0:h.slice(6),h=h==null?void 0:h.slice(0,-4),console.log(h);const $=[];for(let i=0;i<(h==null?void 0:h.length);i+=8)$.push(h==null?void 0:h.slice(i,i+8));const Y=(i,G)=>((i&G)>>6).toString(16).padStart(2,"0");D=$.map(i=>{let G=0,B="",W="",q=i.slice(0,2),K=Y(q,192);if(K==="00"?B="P":K==="01"?B="C":K==="02"?B="B":K==="03"&&(B="U"),u!=="KWP_2BYTE_DTC"){q=i.slice(0,-2);let J=Y(q,129);switch(J){case"00":G="Inactive:LampOff";break;case"01":G="Active:LampOff";break;case"80":G="Inactive:LampOn";break;case"81":G="Active:LampOn";break}switch(u){case"UDS_3BYTE_DTC":q=i.slice(0,2),J=Y(q,63),W=`${B}${J}${i.slice(2,4)}-${i.slice(4,6)}`;break}}return{type:W,value:G}}),A(D)}}},S=async()=>{var h;if(n===null)return H.error("Please select the tab");const u=(h=C==null?void 0:C.sub_model)==null?void 0:h.ecus[n].clear_dtc_fn_index.value;if(u==="GENERICOBD"){const f=te("4","04","00");H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:f})),t(ue(x.imei,`{${f}}`))}else{let f=u,D=null,$=0;return f==="UDS_4BYTES"?($=4,D=L($,"14FFFFFF","clear")):f==="UDS_3BYTES"?($=3,D=L($,"14FFFF","clear")):f==="GENERIC_OBD"?($=1,D=L($,"04","clear")):f==="KWP_PRIMITIVE"&&($=1,D=L($,"14","clear")),D}},I=u=>{var f;let h=[];return h=l.filter(D=>(D==null?void 0:D.code)===u),(h==null?void 0:h.length)>0?(f=h[0])==null?void 0:f.description:"Description is Not found"};return e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[(d||w||E)&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((b=Object.keys(C))==null?void 0:b.length)>0&&((T=C==null?void 0:C.sub_model)==null?void 0:T.ecus.length)>0&&((c=C==null?void 0:C.sub_model)==null?void 0:c.ecus.map((u,h)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:n===h?"#333333":_.grey[400],mt:"20px",backgroundColor:n===h?"#D5E1FE":_.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{O(u,h)},children:e.jsx("b",{children:u.name})})})))}),e.jsx(o,{children:y&&y.length>0?e.jsx(o,{sx:{height:"65vh",overflow:"auto"},children:y&&y.length>0&&y.map((u,h)=>e.jsx(is,{sx:{minWidth:275,mx:4,my:2,display:"flex",backgroundColor:_.grey[100],color:_.grey[400]},children:e.jsxs(cs,{sx:{display:"flex"},children:[e.jsxs(o,{sx:{width:"35vw"},children:[e.jsx(o,{sx:{fontSize:"15px"},children:u==null?void 0:u.type}),e.jsx(o,{sx:{fontSize:"15px"},children:I(u==null?void 0:u.type)})]}),e.jsx(o,{children:e.jsx(re,{variant:"contained",sx:{color:"white",height:"25px",mt:"20px",ml:"50px",fontSize:"13px",backgroundColor:"#8DA6C6"},children:"Troubleshoot"})}),e.jsxs(o,{sx:{ml:"20px"},children:[e.jsx(o,{sx:{textAlign:"center"},children:"Status"}),e.jsxs(o,{children:[" ",e.jsx(re,{variant:"contained",sx:{color:"white",height:"25px",width:"150px",fontSize:"13px",backgroundColor:"#8DA6C6"},children:u==null?void 0:u.value})]})]})]})},h))}):e.jsx(o,{children:N.length>0?e.jsx(o,{sx:{textAlign:"center",marginTop:"20%"},children:N}):e.jsx(o,{sx:{textAlign:"center",marginTop:"20%",color:_.grey[400]},children:"Wait!, Your request is in progress..."})})}),r&&r.length>0&&r[r.length-1].color==="green"&&r.length>0&&((F=r[r.length-1].log)==null?void 0:F.length)>0&&((a=r[r.length-1].log[0])==null?void 0:a.toLowerCase())==="20010000e1f0"&&((k=r[r.length-1].log[1])==null?void 0:k.toLowerCase())==="20010000e1f0"&&((R=r[r.length-1].log[2])==null?void 0:R.toLowerCase())==="20010000e1f0"&&e.jsxs(o,{sx:{display:"flex",position:"fixed",top:"85%",left:"38%"},children:[e.jsx(o,{sx:{mx:"20px"},children:e.jsx(re,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:m,children:"Read Dtc"})}),e.jsx(o,{children:e.jsx(re,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:()=>{S()},children:"Clear Dtc"})})]})]})},xr=()=>{var j,C,O,L,m;const t=de(),{vehicleList:s}=M(S=>S.liveMap),{selectedVehicle:r}=M(S=>S.diagnostics),{liveParameters:l,loading:d,isDtcLoader:w}=M(S=>S.diagnostics),{mode:x}=M(S=>S.dashboard),p=oe(x),[_,n]=g.useState(0),[P,N]=g.useState(!1),v=(s||[]).find(S=>{var I;return((I=S==null?void 0:S.imei[0])==null?void 0:I.mac_id)===(r==null?void 0:r.imei)})||{};g.useEffect(()=>{var S,I,b,T,c,F;if(((S=Object.keys(v))==null?void 0:S.length)>0&&((b=(I=v==null?void 0:v.sub_model)==null?void 0:I.ecus)==null?void 0:b.length)>0){let a=(F=(c=(T=v==null?void 0:v.sub_model)==null?void 0:T.ecus[_])==null?void 0:c.pid_datasets[0])==null?void 0:F.id;t(ot({pid:a})),t(nt({pid:a}))}},[]);const y=(S,I)=>{var u,h;n(I);let b=(h=(u=v==null?void 0:v.sub_model)==null?void 0:u.ecus[I].pid_datasets[0])==null?void 0:h.id;t(ot({pid:b})),t(nt({pid:b}));const{tx_header:T,rx_header:c,protocol:F}=S,a=`02${F.autopeepal},04${T},06${c}`;switch(v.sub_model.ecus[I].read_dtc_fn_index.value.split("_")[0]){case"GENERICOBD":{const f=te("4","03","00"),D=te("4","07","00");H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:f})),H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:D}));let $={imei:r.imei,commands:`{${f}, ${D}}`,tranCmd:`{${f}, ${D}}`};t(ue($));break}case"UDS":{a||H.error("Please click again");let f,D=a.split(","),$=D==null?void 0:D.map(Y=>{if((D==null?void 0:D.length)%2===0){H.error("The Tx Frame format is not right. Must be odd length.");return}return f=te("2",Y,"00"),f});if($){H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:$}));let Y={imei:r.imei,commands:`{${$}}`,tranCmd:$};t(ue(Y))}break}case"KWP":{const f=te("4","1800AF","00");H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:f}));let D={imei:r.imei,commands:`{${f}}`,tranCmd:`{${f}}`};t(ue(D));break}}};function A(S){return parseInt(S,16)}const E=async()=>{var c,F;let S=[],I=[];l.filter(a=>a.checked).forEach(a=>{const k=te("4",a.code,"00");S.push(k),I.push({command:k,id:a==null?void 0:a.id})}),H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:S.join(",")}));const b=await le.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:r.imei,commands:`{${S}}`});let T;if((c=b==null?void 0:b.data)!=null&&c.success){let a=l;(F=b==null?void 0:b.data)==null||F.commands.forEach((k,R)=>{var i,G;T="62100d02520970",T.slice(0,2)!=="62"&&H.error("Error From Device"),T=T==null?void 0:T.slice(6),T=T==null?void 0:T.slice(0,-4);let h=(i=I[R])==null?void 0:i.id,f=(G=l.filter(B=>B.id===h)[0])==null?void 0:G.pi_code_variable[0],D=(f==null?void 0:f.byte_position)-1,$=(f==null?void 0:f.length)*2,Y=T.slice(D,$);if((f==null?void 0:f.message_type)==="CONTINUOUS"){let B=A(Y),W=f==null?void 0:f.resolution,q=f==null?void 0:f.offset,K=B*W+q;a=a.map(J=>h===J.id?{...J,dataByt:K}:{...J})}else if((f==null?void 0:f.message_type)==="ASCII"){let B=hexToAscii(Y);a=a.map(W=>h===W.id?{...W,dataByt:B}:{...W})}else(f==null?void 0:f.message_type)==="eNUM"?a=a.map(B=>h===B.id?{...B,dataByt:Y}:{...B}):(f==null?void 0:f.message_type)==="bcd-hex"&&(a=a.map(B=>h===B.id?{...B,dataByt:Y}:{...B}));t(me(a))})}};return console.log("ecus",v),e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[(d||w||P)&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((j=Object.keys(v))==null?void 0:j.length)>0&&((C=v==null?void 0:v.sub_model)==null?void 0:C.ecus.length)>0&&((O=v==null?void 0:v.sub_model)==null?void 0:O.ecus.map((S,I)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:_===I?"#333333":p.grey[400],mt:"20px",backgroundColor:_===I?"#D5E1FE":p.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{y(S,I)},children:e.jsx("b",{children:S.name})})})))}),e.jsxs(o,{children:[e.jsx(o,{sx:{ml:"30px",mt:"20px",color:p.grey[400]},children:e.jsx("span",{children:e.jsx("b",{children:_!==null&&((m=(L=v==null?void 0:v.sub_model)==null?void 0:L.ecus[_])==null?void 0:m.name)})})}),e.jsx("div",{style:{height:"60vh",overflow:"auto"},children:e.jsx(o,{sx:{mt:"20px"},children:l.filter(S=>S.checked).map((S,I)=>e.jsxs(o,{sx:{border:"1px solid grey",display:"flex",mx:"30px",mb:"10px",borderRadius:"5px",padding:"15px",color:p.grey[400]},children:[e.jsx(o,{sx:{width:"95%"},children:S.label}),e.jsxs(o,{children:[" ",S&&(S==null?void 0:S.dataByte)&&S.dataByte,S.pi_code_variable[0].unit]})]}))})}),e.jsx(o,{children:e.jsx(o,{sx:{display:"flex",mt:"20px",mx:"20px"},children:e.jsx(o,{children:e.jsx(re,{variant:"contained",sx:{background:"#8DA6C6"},onClick:E,children:"Refresh"})})})})]})]})},hr=()=>{var K,J,se,ie;const t=de(),{vehicleList:s}=M(U=>U.liveMap),{selectedVehicle:r}=M(U=>U.diagnostics);let l=JSON.parse(localStorage.getItem("w_userDetails"));const d={headers:{"Content-Type":"application/json",Authorization:`JWT ${(K=l==null?void 0:l.token)==null?void 0:K.access}`}},{mode:w}=M(U=>U.dashboard),x=oe(w),{selectedFlashingFile:p,ecuFotaId:_,fotaFiles:n}=M(U=>U.diagnostics),[P,N]=g.useState(0),[v,y]=g.useState(0),[A,E]=g.useState(0),[j,C]=g.useState(""),[O,L]=g.useState(""),[m,S]=g.useState(!1),[I,b]=g.useState(!1),[T,c]=g.useState(!1),[F,a]=g.useState(!1),[k,R]=g.useState(),[u,h]=g.useState(),[f,D]=g.useState({created_at:"",updated_at:""}),[$,Y]=g.useState({created_at:"",updated_at:""}),i=(s||[]).find(U=>{var V;return((V=U==null?void 0:U.imei[0])==null?void 0:V.mac_id)===(r==null?void 0:r.imei)})||{};g.useEffect(()=>{var U,V,Z,X,Q,z,ee,ae,ce;if(((U=Object.keys(i))==null?void 0:U.length)>0&&((Z=(V=i==null?void 0:i.sub_model)==null?void 0:V.ecus)==null?void 0:Z.length)>0){let fe=(z=(Q=(X=i==null?void 0:i.sub_model)==null?void 0:X.ecus[P])==null?void 0:Q.pid_datasets[0])==null?void 0:z.id;t(Ue({pid:fe}));let pe=(ce=(ae=(ee=i==null?void 0:i.sub_model)==null?void 0:ee.ecus[P])==null?void 0:ae.ecu[0])==null?void 0:ce.file;pe=(pe==null?void 0:pe.map(xe=>({...xe,label:xe.sw_part_no})))||[],t(lt(pe))}},[i]),g.useEffect(()=>{var U,V,Z,X;if(r&&(r!=null&&r.imei)&&((U=i==null?void 0:i.sub_model)!=null&&U.ecus)&&((V=i==null?void 0:i.sub_model)==null?void 0:V.ecus.length)>0){let Q=(X=(Z=i==null?void 0:i.sub_model)==null?void 0:Z.ecus[P])==null?void 0:X.id;G(Q)}},[r]),g.useEffect(()=>{},[p]);const G=U=>{if(r&&(r!=null&&r.imei)){let V={created_by:JSON.parse(localStorage.getItem("w_userDetails")).user_id,imei:r.imei,ecu:U};le.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/latest/ecu-fota/",V).then(X=>{var ae,ce,fe,pe,xe,Ye,Ke,ze,Xe,qe,Je,Qe,Ze,Ve;let Q=(ae=X==null?void 0:X.data)==null?void 0:ae.flashing_attempts,z=(ce=X==null?void 0:X.data)==null?void 0:ce.download_attempts;t(Fe((fe=X==null?void 0:X.data)==null?void 0:fe.id)),t(We((pe=X==null?void 0:X.data)==null?void 0:pe.server_sw));let ee=(Ke=(Ye=(xe=i.sub_model)==null?void 0:xe.ecus[P])==null?void 0:Ye.ecu[0])==null?void 0:Ke.file;if(ee&&ee.length>0){let St=ee.find(kt=>{var et;return kt.sw_part_no===((et=X==null?void 0:X.data)==null?void 0:et.server_sw)});t(He(St))}z&&(z==null?void 0:z.length)>0&&(R(z[0].id),y(z[0].latest_percentage),C(z[0].status),D({created_at:ke(new Date((ze=z[0])==null?void 0:ze.created)).format("DD-MM-YYYY HH:mm:ss"),updated_at:ke(new Date((Xe=z[0])==null?void 0:Xe.modified)).format("DD-MM-YYYY HH:mm:ss")}),z[0].latest_percentage<100&&z[0].status!=="Completed"&&z[0].status!=="Aborted"&&(c(!0),b(!0),a(!1),S(!1))),Q&&(Q==null?void 0:Q.length)>0&&(E((qe=Q[0])==null?void 0:qe.latest_percentage),h((Je=Q[0])==null?void 0:Je.id),L((Qe=Q[0])==null?void 0:Qe.status),Y({created_at:ke(new Date((Ze=Q[0])==null?void 0:Ze.created)).format("DD-MM-YYYY HH:mm:ss"),updated_at:ke(new Date((Ve=Q[0])==null?void 0:Ve.modified)).format("DD-MM-YYYY HH:mm:ss")}),Q[0].latest_percentage<100&&Q[0].status!=="Completed"&&Q[0].status!=="Aborted"&&(c(!1),b(!1),a(!0),S(!0)))}).catch(X=>{R(),h(),t(Fe("")),y(0),E(0),t(We("")),t(He({})),c(!1),b(!1),a(!1),S(!1)})}};g.useEffect(()=>{const U=setInterval(()=>{T&&I&&le.get("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/ecufota/downloadattempt/list/?id="+k,d).then(Z=>{var Q,z,ee,ae;const X=parseInt(Z.data.results[0].latest_percentage);y(X),C(Z.data.results[0].status),D({created_at:ke(new Date((Q=Z.data.results[0])==null?void 0:Q.created)).format("DD-MM-YYYY HH:mm:ss"),updated_at:ke(new Date((z=Z.data.results[0])==null?void 0:z.modified)).format("DD-MM-YYYY HH:mm:ss")}),(X=="100"||Z.data.results[0].status==="Completed"||Z.data.results[0].status==="Aborted")&&(clearInterval(U),b(!1),c(!1),G((ae=(ee=i==null?void 0:i.sub_model)==null?void 0:ee.ecus[P])==null?void 0:ae.id))}),F&&m&&le.get("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/ecufota/flashingattempt/list/?id="+u,d).then(Z=>{var Q,z;const X=parseInt(Z.data.results[0].latest_percentage);E(X),L(Z.data.results[0].status),(X=="100"||Z.data.results[0].status==="Completed"||Z.data.results[0].status==="Aborted")&&(clearInterval(U),S(!1),G((z=(Q=i==null?void 0:i.sub_model)==null?void 0:Q.ecus[P])==null?void 0:z.id))})},1e3);return()=>{clearInterval(U)}},[m,T,F,I,u,k]);const B=(U,V)=>{var Q,z,ee,ae;N(V);let Z=(Q=i==null?void 0:i.sub_model)==null?void 0:Q.ecus[V].id,X=(ae=(ee=(z=i.sub_model)==null?void 0:z.ecus[V])==null?void 0:ee.ecu[0])==null?void 0:ae.file;X=(X==null?void 0:X.map(ce=>({...ce,label:ce.sw_part_no})))||[],t(lt(X)),G(Z)},W=()=>{var V,Z,X;if(p&&!Object.keys(p).length>0)return H.error("Please select the flashing file");b(!I),C(""),c(!1),y(0),S(!1),console.log("selected file",p);let U={};if(U.current_ws="null",U.server_sw=p==null?void 0:p.sw_part_no,U.status="OPEN",U.ecu=(Z=(V=i==null?void 0:i.sub_model)==null?void 0:V.ecus[P])==null?void 0:Z.id,U.imei=r.imei,U.created_by=JSON.parse(localStorage.getItem("w_userDetails")).user_id,!I)try{le.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/create_ecufota/",U,d).then(z=>{let ee={};ee.ecu_fota=z.data.id,t(Fe(z.data.id)),ee.latest_percentage="0",ee.created_by=U.created_by,ee.status="New",le.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/create/ecufota/downloadattempt/",ee,d).then(ce=>{c(!0),a(!1),R(ce.data.id)})}).catch(z=>{var ee;if(b(!1),c(!1),((ee=z==null?void 0:z.response)==null?void 0:ee.status)===401)return console.log("Session expired, dispatching logout"),t(it()),H.error("Session Expired",{id:"clipboard"});z.message?H.error("Error occurred while downloading"):H.error("Internal server error")})}catch(Q){if(b(!1),c(!1),((X=Q==null?void 0:Q.response)==null?void 0:X.status)===401)return console.log("Session expired, dispatching logout"),t(it()),H.error("Session Expired",{id:"clipboard"});Q.message?H.error("Error occurred while downloading"):H.error("Internal server error")}},q=()=>{if(p&&!Object.keys(p).length>0)return H.error("Please select the flashing file");if(!_)return H.error("Fota id missing. Please download the file first");if(v!="100"&&j!=="Aborted")return H.error("Start the download operation before proceeding");b(!1),S(!m),a(!1),E(0);let U={};if(U.ecu_fota=_,U.latest_percentage="0",U.created_by=p.created_by,U.status="New",U.latest_response="OK",!m)try{le.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/create/ecufota/flashingattempt/",U,d).then(Z=>{c(!1),a(!0),h(Z.data.id)}).catch(Z=>{S(!1),a(!1),S(!m),Z.message?H.error("error occurred while flashing"):H.error("Internal server error")})}catch{S(!1),a(!1),S(!m)}};return e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((J=Object.keys(i))==null?void 0:J.length)>0&&((se=i==null?void 0:i.sub_model)==null?void 0:se.ecus.length)>0&&((ie=i==null?void 0:i.sub_model)==null?void 0:ie.ecus.map((U,V)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:P===V?"#333333":x.grey[400],mt:"20px",backgroundColor:P===V?"#D5E1FE":x.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{B(U,V)},children:e.jsx("b",{children:U.name})})})))}),e.jsx(o,{children:e.jsxs(o,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-evenly",mt:"15px"},children:[e.jsxs("div",{children:["ECU Fota id :",_," "]}),e.jsxs("div",{children:["Download Status:",j," "]}),e.jsxs("div",{children:["Flashing Status :",O," "]})]}),e.jsx(o,{sx:{mt:"50px",color:x.grey[400]},children:e.jsx("h2",{style:{textAlign:"center"},children:(I||"flashinBtn")&&"Start : Downloading"})}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-around"},children:[e.jsxs(o,{children:[e.jsx(o,{sx:{my:"50px",color:"white",textAlign:"center"},children:e.jsx(mt,{type:"circle",percent:v,size:180,strokeColor:"#8DA6C6",trailColor:"#d1d1d1",format:()=>e.jsxs("div",{style:{color:x.grey[400]},children:[v,"%"]})})}),e.jsx(o,{sx:{textAlign:"center"},children:e.jsx(re,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:W,children:I?"Stop Downloading":"Start Downloading"})}),e.jsxs(o,{sx:{textAlign:"left"},children:[e.jsxs("p",{children:["Start Time: ",f.created_at]}),e.jsxs("p",{children:["Last Updated Time: ",f.updated_at]})]})]}),e.jsxs(o,{children:[e.jsx(o,{sx:{my:"50px",textAlign:"center"},children:e.jsx(mt,{type:"circle",percent:A,size:180,trailColor:"#d1d1d1",strokeColor:"#8DA6C6",format:()=>e.jsxs("div",{style:{color:x.grey[400]},children:[A,"%"]})})}),e.jsx(o,{sx:{textAlign:"center"},children:e.jsxs(re,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:q,disabled:T,children:[" ",m?"Stop Flashing...":"Start Flashing"]})}),e.jsxs(o,{sx:{textAlign:"left"},children:[e.jsxs("p",{children:["Start Time: ",$.created_at]}),e.jsxs("p",{children:["Last Updated Time: ",$.updated_at]})]})]})]})]})})]})},gr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALySURBVHgB7Zi/bxJhGMefOw6O6a4LnUpjUjrVoa1TnWwX6yKd7CIYE3VRE1EX/gIGNTFRFzVpog6CS3GxLoILdKk6wGSHJjDBAkxQNPh+X3sEz+NAkub10veTXODe97n3eb7Pj2uDQoxUKnVK8/u3iJRFdjtF/zk96m3/7HYTyWTyQPkdfOAreSBwG40f3cMl1acFHpP3ggdTml/fUhWFouRZeosqeZsprwsgKUA0UoBopADRSAGikQJEIwWI5uQK0HX9WO3HZSIBpxcW6Patm2QYxlj29+/dpTPLy3QcaKMMkLn5SIR/bzabVKlW+3vToRCZTESz1aIWuyKROQrqQWp32lSr1fmaBcSGZ2ao0+lQrV7nz7bZd8sGe1jHvpvPfxYQj12mYDDIA9L1AL16/aa/t7a2yj9zuTx3fGF9nTlskWka1G63uS3Wwfx8hGZnw+ycGm1n39PGRpRKpTIVikWehM3NS5ROZ3iwgz7xG0Q6824yATjYNE36sPORyuXyX/tvmcPBLD95+ox/Tk+HWBAxmg2H6fv+Pl/b2/vCgx1FCFVlPrNMpPWsG64C0BqVSpVl9jwr6RwVCkVeZifQIuhzZBplB4EJBrd11I7R6MV+hQaTZGfkEKczGV5ywzApHo/xXnXi7MoKD/4Ta6dCcfePPauN7Di9mWD7/MVL2mFVR8tdYT7d3mAjBSDgSqVCuXye36M3m9bghWd45nHBCR9Q1uO47EHBFoOLC2BWrDWDtcygKPgssZZF6+LeesaJkTOA4bJAO9XqNe4cQWJoAYa4uFukjWiUbly/1rc/PMo8+n919RyvINoBGc7lc9wea5ZIYDj4dHsLKQ8ePuqRC8iAVUJ7L1p/B+yvSydb65xxznDzaWfkaxSZGdbDTocPczjsHCd7N5925D9zopECRCMFiEYKEI0UIBopQDRSgGggoEEehglQvpFH6fUoq2o+5Sp5sAqKojT8mnpHTSQSB5pPXYIa8gAInMX62acqS4j9F+WkUOZ/3jqMAAAAAElFTkSuQmCC";var Ge={},fr=ps;Object.defineProperty(Ge,"__esModule",{value:!0});var _t=Ge.default=void 0,mr=fr(ds()),br=e;_t=Ge.default=(0,mr.default)((0,br.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");const yr=()=>{M(y=>y.liveMap);const{terminalAppLogs:t,loading:s,selectedVehicle:r}=M(y=>y.diagnostics),{mode:l}=M(y=>y.dashboard),d=oe(!l),w=[5,2,4],x=de(),[p,_]=g.useState(5),[n,P]=g.useState();g.useEffect(()=>{Object.keys(r).length>0&&x(ue({imei:`${r==null?void 0:r.imei}`,commands:"{500a0047568afe56214e238000ffc3}",tranCmd:"500a0047568afe56214e238000ffc3"}))},[r]);const N=()=>{if(!n)return H.error("Please enter value");let y=n.split(","),A,E=!1;if(y=y.map(j=>{if((j==null?void 0:j.length)%2!==0){E=!0,H.error("The Tx Frame format is not right. Must be even length.");return}return A=te(p,j,"00"),A}),!E)if(Object.keys(r).length>0){let j={imei:r.imei,commands:`{${y}}`,tranCmd:y};x(ue(j))}else H.error("Please Select Vehicle",{id:"clipBoard"})},v=()=>{H.success("Copied to clipboard!");let y=[];y=t.map(E=>E.timestamp+" "+E.log);const A=document.createElement("textarea");A.value=y.length===0?" ":y.join(`
`),document.body.appendChild(A),A.select(),document.execCommand("copy"),document.body.removeChild(A)};return e.jsxs(o,{children:[s&&e.jsx(Se,{}),e.jsxs(o,{children:[e.jsxs(o,{children:[e.jsx(o,{sx:{display:"flex",justifyContent:"space-around"},children:w.map((y,A)=>e.jsxs("button",{style:{textAlign:"center",padding:"10px 20px",borderRadius:"5px",cursor:"pointer",width:"165px",margin:"20px",border:"1px solid #8DA6C6",backgroundColor:y===p?"#8DA6C6":"white",color:y===p?"white":"#8DA6C6"},onClick:E=>{_(y)},children:[y,"0"]}))}),e.jsxs(o,{sx:{display:"flex"},children:[e.jsx(yt,{name:"txFrame",type:"text",value:n,style:{width:"75%",height:"45px",border:"1px solid #8DA6C6",borderRadius:5,background:"#8DA6C6",color:"white",marginLeft:"9%"},pattern:"[A-Fa-f0-9,]+",onChange:y=>P(y.target.value),placeholder:"ENTER VALUE",className:"white-placeholder"}),e.jsx(us,{onClick:N,style:{margin:"5px"},children:"Send"}),e.jsx("img",{src:gr,style:{height:"44px",marginLeft:"15px",cursor:"pointer"}})]})]}),e.jsxs(o,{style:{background:d.grey[100],width:"90%",minHeight:"68vh",borderRadius:"2px",display:"flex",justifyContent:"space-between",flexDirection:"row",margin:"30px 60px",overflowY:"auto",color:d.grey[400]},children:[t&&e.jsx("div",{style:{textTransform:"uppercase",fontSize:"12px",padding:"20px"},children:t.map(y=>e.jsxs("p",{style:{display:"flex"},children:[e.jsx("span",{style:{marginLeft:"5px"},children:y.timestamp}),e.jsx("span",{style:{height:"15px",width:"15px",backgroundColor:y.color,borderRadius:"50%",marginLeft:"5px"}}),e.jsx("span",{style:{marginLeft:"5px"},children:y.log})]}))}),e.jsxs(o,{style:{display:"flex",justifyContent:"flex-end",padding:"20px",gap:"10px"},children:[e.jsx(_t,{style:{cursor:"pointer"},onClick:()=>x(xs())}),e.jsx(hs,{style:{cursor:"pointer"},onClick:()=>v()})]})]})]})]})};let Ee={Sanitas_BOSCH_BS6_PROD:"01",Sanitas_ADVANTEK_BS6_PROD:"02",Sanitas_ADVANTEK_BS4_PROD:"03",KOEL_BOSCH_BS4:"04",FLASH_KOEL_BOSCH_F6_CPCB4:"05",GREAVES_BOSCH_BS6_PROD:"02",ATUL_ADVANTEK_BS6_A46:"04",TVS_ADVANTEK_BS6_A46:"05",GREAVES_SEDEMAC_BL_BS6:"07",GREAVES_SEDEMAC_APP_BS6:"08",SEEDKEYALGO_VECV_BOSCH_BS6_01:"11",KOEL_AUTO_BS4:"12",KOEL_CPCB4_LOW_HP_ECU:"03",KOEL_CPCB4_HIGH_HP_ECU:"14",KOEL_CPCB4_MID_HP_ECU:"04",TATA_DNOX:"31"},Ae=t=>{let s="";return t==="SML_BOSCH_BS6_PROD"||t==="KOEL_BOSCH_BS4"?s="08":t==="SEEDKEYALGO_VECV_DELPHI_BS6"||t==="SEEDKEYALGO_VECV_AMT_BS6"?s="04":t==="SEEDKEYALGO_VECV_DELPHI_TCIC"?s="02":t==="GREAVES_BOSCH_BS6_PROD"||t==="GREAVES_BOSCH_BS6_DEV"?s="04":t==="Sanitas_BOSCH_BS6_PROD"||t==="KOEL_BOSCH_BS4"?s="08":t==="SEEDKEYALGO_VECV_DELPHI_BS6"||t==="SEEDKEYALGO_VECV_AMT_BS6"?s="04":t==="SEEDKEYALGO_VECV_DELPHI_TCIC"||t==="SEEDKEYALGO_VECV_DELPHI_TCIC"?s="02":t==="GREAVES_BOSCH_BS6_PROD"||t==="GREAVES_BOSCH_BS6_DEV"?s="04":s="08",s};const Cr=()=>{var T,c,F;const t=de(),{vehicleList:s}=M(a=>a.liveMap),{selectedVehicle:r}=M(a=>a.diagnostics),{mode:l}=M(a=>a.dashboard),d=oe(l),{activeWriteParameter:w,selectedWriteParam:x,loading:p,isDtcLoader:_}=M(a=>a.diagnostics),[n,P]=g.useState(0),[N,v]=g.useState(null),[y,A]=g.useState(null),[E,j]=g.useState(""),C=(s||[]).find(a=>{var k;return((k=a==null?void 0:a.imei[0])==null?void 0:k.mac_id)===(r==null?void 0:r.imei)})||{};g.useEffect(()=>{var a,k,R,u,h,f;if(((a=Object.keys(C))==null?void 0:a.length)>0&&((R=(k=C==null?void 0:C.sub_model)==null?void 0:k.ecus)==null?void 0:R.length)>0){let D=(f=(h=(u=C==null?void 0:C.sub_model)==null?void 0:u.ecus[n])==null?void 0:h.pid_datasets[0])==null?void 0:f.id;t(ct({pid:D}))}},[]);const O={padding:"10px 10px",width:"28.5vw",borderRadius:"5px",border:"1px solid grey",backgroundColor:"white",color:"black"},L=(a,k)=>{var i,G;P(k);let R=(G=(i=C==null?void 0:C.sub_model)==null?void 0:i.ecus[k].pid_datasets[0])==null?void 0:G.id;t(ct({pid:R}));const{tx_header:u,rx_header:h,protocol:f}=a,D=`02${f.autopeepal},04${u},06${h}`;switch(C.sub_model.ecus[k].read_dtc_fn_index.value.split("_")[0]){case"GENERICOBD":{const B=te("4","03","00"),W=te("4","07","00");H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:B})),H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:W}));let q={imei:r.imei,commands:`{${B}, ${W}}`,tranCmd:`{${B}, ${W}}`};t(ue(q));break}case"UDS":{D||H.error("Please click again");let B,W=D.split(","),q=W==null?void 0:W.map(K=>{if((W==null?void 0:W.length)%2===0){H.error("The Tx Frame format is not right. Must be odd length.");return}return B=te("2",K,"00"),B});if(q){H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:q}));let K={imei:r.imei,commands:`{${q}}`,tranCmd:q};t(ue(K))}break}case"KWP":{const B=te("4","1800AF","00");H.success(e.jsx("span",{style:{wordBreak:"break-all"},children:B}));let W={imei:r.imei,commands:`{${B}}`,tranCmd:`{${B}}`};t(ue(W));break}}};function m(a,k){if(a.length>=k)return a;{const R=k-a.length;return"0".repeat(R)+a}}function S(a,k,R){return R<0?k+a:R>=a.length?a+k:(a.slice(R,R+k.length),a.slice(0,R)+k+a.slice(R+k.length))}const I=async()=>{var B,W,q,K,J,se,ie,U,V,Z,X,Q;if(Object.keys(x).length===0)return H.error("Please select a write parameter");if(!N)return H.error("Please enter a write value");t(ne(!0));let a="",k,R;const u=x==null?void 0:x.pi_code_variable[0];console.log("element",u.message_type);let h;isNaN(N)?h=[...N].map(z=>z.charCodeAt(0).toString(16).padStart(2,"0")).join(""):h=gs(parseInt(N));let f=m(h,(u==null?void 0:u.length)*2),D=u!=null&&u.byte_position?(u.byte_position-1)*2:0,$=S(a,f,D);$=`2E${x==null?void 0:x.write_pid}${$}`,$=te(4,$,"00");const i=C.sub_model.ecus[n],G=(B=i==null?void 0:i.write_data_fn_index)==null?void 0:B.value;R=te(4,"1003","00"),G==="UDS_DS1003_SK090A"?k=`35${Ee[(W=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:W.value]}${Ae((q=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:q.value)}02270902270A`:G==="UDS_DS1003_SK0102"?k=`35${Ee[(K=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:K.value]}${Ae((J=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:J.value)}022701022702`:G==="UDS_DS1003_SK0B0C"?k=`35${Ee[(se=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:se.value]}${Ae((ie=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:ie.value)}02270B02270C`:(G==="UDS_DS1003_SK0304"||G==="UDS_DS1003_SK0506")&&(k=`35${Ee[(U=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:U.value]}${Ae((V=i==null?void 0:i.seedkeyalgo_fn_index)==null?void 0:V.value)}022703022704`),k=te(2,k,"00");try{const z=await le.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:r.imei,commands:`{${R},${k},${$}}`});if((Z=z==null?void 0:z.data)!=null&&Z.success){t(ne(!1));let ee="",ae="";(Q=(X=z==null?void 0:z.data)==null?void 0:X.commands)==null||Q.forEach(ce=>{const fe=ce.slice(0,2),pe=ce.slice(6),xe=pe.slice(0,2);fe==="40"&&(xe==="7f"?(ae=dt(pe.slice(4,6)),ee="Negative Response"):xe==="ff"&&(ee="No response from ecu")),fe==="20"&&xe==="01"&&(ae=dt(pe.slice(4,6)),ee="Negative Response")}),ee?(A(`${ee} ${ae}`),H.error(ee)):(A("Positive response from ecu"),H.success("Positive response from ecu"))}}catch{t(ne(!1)),H.error("Failed to send command")}},b=async()=>{var R,u,h;t(ne(!0));let a=te(4,x.code,"00"),k="";try{const f=await le.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:r.imei,commands:`{${a}}`});if((R=f==null?void 0:f.data)!=null&&R.success){t(ne(!1)),k=(u=f==null?void 0:f.data)==null?void 0:u.commands[0];const D=bt(k);if(console.log("cmd val",D),!D.startsWith("62")){H.error(`Negative response from ecu for ${$==null?void 0:$.short_name}`);return}let $=x==null?void 0:x.pi_code_variable[0],Y=x;const{byte_position:i,length:G,resolution:B,offset:W,message_type:q}=$;let K=D==null?void 0:D.toLowerCase().replace((h=x==null?void 0:x.code)==null?void 0:h.toLowerCase().slice(2),"").slice(2);console.log("Decoded Data:",K);let J;switch(q){case"CONTINUOUS":J=Ie(K)*B+W;break;case"ASCII":J=Pe(K);break;case"eNUM":case"bcd-hex":J=K;break;default:return}j(J)}}catch{t(ne(!1))}};return e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"80vh",borderRadius:"5px",margin:"10px 20px"},children:[(p||_)&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((T=Object.keys(C))==null?void 0:T.length)>0&&((c=C==null?void 0:C.sub_model)==null?void 0:c.ecus.length)>0&&((F=C==null?void 0:C.sub_model)==null?void 0:F.ecus.map((a,k)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:n===k?"#333333":d.grey[400],mt:"20px",backgroundColor:n===k?"#D5E1FE":d.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{L(a,k)},children:e.jsx("b",{children:a==null?void 0:a.name})})})))}),e.jsxs(o,{children:[e.jsx(o,{sx:{ml:"30px",my:"65px",color:d.grey[400],textAlign:"center",fontSize:"25px"},children:e.jsx("span",{children:e.jsx("b",{children:w||"Please select the parameter"})})}),e.jsx(o,{sx:{ml:"30px",color:w?"red":"green",textAlign:"center",fontSize:"15px"},children:e.jsx("span",{children:y})}),e.jsxs(o,{sx:{display:"flex",m:"20px",color:d.grey[400]},children:[e.jsxs(o,{children:[e.jsx("div",{style:{marginBottom:"5px"},children:e.jsx("b",{children:"Current value"})}),e.jsx("input",{style:O,value:E,disabled:!0}),e.jsx(o,{children:e.jsx(re,{variant:"contained",sx:{m:"10px",backgroundColor:"#8DA6C6"},onClick:b,children:"Read Here"})})]}),e.jsx(o,{sx:{m:"20px",color:d.grey[400]},children:e.jsx("div",{style:{marginTop:"5px"},children:e.jsx("b",{children:"UNIT"})})}),e.jsxs(o,{children:[e.jsx("div",{style:{marginBottom:"5px"},children:e.jsx("b",{children:"Write value"})}),e.jsx("input",{style:O,placeholder:"Enter here",value:N,onChange:a=>v(a.target.value)})]})]}),e.jsx(o,{children:e.jsx(o,{sx:{display:"flex",justifyContent:"center",mt:"30px"},children:e.jsx(o,{children:e.jsx(re,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:I,children:"Submit"})})})})]})]})},Ne=()=>{var N,v,y;const{mode:t}=M(A=>A.dashboard),s=oe(t),r=de(),{vehicleList:l}=M(A=>A.liveMap),{selectedVehicle:d}=M(A=>A.diagnostics),{ecuInfo:w,loading:x}=M(A=>A.diagnostics),[p,_]=g.useState(0),n=(l||[]).find(A=>{var E;return((E=A==null?void 0:A.imei[0])==null?void 0:E.mac_id)===(d==null?void 0:d.imei)})||{};g.useEffect(()=>{var A,E,j,C,O,L;if(((A=Object.keys(n))==null?void 0:A.length)>0&&((j=(E=n==null?void 0:n.sub_model)==null?void 0:E.ecus)==null?void 0:j.length)>0){let m=(L=(O=(C=n==null?void 0:n.sub_model)==null?void 0:C.ecus[0])==null?void 0:O.pid_datasets[0])==null?void 0:L.id;r(Ue({pid:m}))}},[]);const P=(A,E)=>{var C,O;_(E);let j=(O=(C=n==null?void 0:n.sub_model)==null?void 0:C.ecus[E].pid_datasets[0])==null?void 0:O.id;r(Ue({pid:j}))};return e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[x&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((N=Object.keys(n))==null?void 0:N.length)>0&&((v=n==null?void 0:n.sub_model)==null?void 0:v.ecus.length)>0&&((y=n==null?void 0:n.sub_model)==null?void 0:y.ecus.map((A,E)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:p===E?"#333333":s.grey[400],mt:"20px",backgroundColor:p===E?"#D5E1FE":s.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{P(A,E)},children:e.jsx("b",{children:A.name})})})))}),e.jsx(o,{sx:{color:s.grey[400]},children:w&&(w==null?void 0:w.length)>0&&w.map((A,E)=>e.jsxs(o,{sx:{border:"1px solid grey",display:"flex",m:"30px",borderRadius:"5px",padding:"15px"},children:[e.jsx(o,{sx:{width:"95%"},children:A.label}),e.jsx(o,{children:A.pi_code_variable[0].unit})]}))})]})},jr=()=>{var E,j,C,O,L;const t=de(),{vehicleList:s}=M(m=>m.liveMap),{selectedVehicle:r}=M(m=>m.diagnostics),{j1939Parameters:l,liveParameters:d,loading:w,isDtcLoader:x}=M(m=>m.diagnostics),{mode:p}=M(m=>m.dashboard),_=oe(p),[n,P]=g.useState(0),[N,v]=g.useState(!1),y=(s||[]).find(m=>{var S;return((S=m==null?void 0:m.imei[0])==null?void 0:S.mac_id)===(r==null?void 0:r.imei)})||{};g.useEffect(()=>{var m,S,I,b,T,c;if(((m=Object.keys(y))==null?void 0:m.length)>0&&((I=(S=y==null?void 0:y.sub_model)==null?void 0:S.ecus)==null?void 0:I.length)>0){let F=(c=(T=(b=y==null?void 0:y.sub_model)==null?void 0:b.ecus[n])==null?void 0:T.j1939_datasets[0])==null?void 0:c.id;t(pt({pid:F}))}},[]);const A=(m,S)=>{var b,T;P(S);let I=(T=(b=y==null?void 0:y.sub_model)==null?void 0:b.ecus[S].j1939_datasets[0])==null?void 0:T.id;t(pt({pid:I}))};return console.log("ecus",y),e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[(w||x||N)&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((E=Object.keys(y))==null?void 0:E.length)>0&&((j=y==null?void 0:y.sub_model)==null?void 0:j.ecus.length)>0&&((C=y==null?void 0:y.sub_model)==null?void 0:C.ecus.map((m,S)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:n===S?"#333333":_.grey[400],mt:"20px",backgroundColor:n===S?"#D5E1FE":_.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{A(m,S)},children:e.jsx("b",{children:m.name})},m.id)})))}),e.jsxs(o,{children:[e.jsx(o,{sx:{ml:"30px",mt:"20px",color:_.grey[400]},children:e.jsx("span",{children:e.jsx("b",{children:n!==null&&((L=(O=y==null?void 0:y.sub_model)==null?void 0:O.ecus[n])==null?void 0:L.name)})})}),e.jsx("div",{style:{height:"60vh",overflow:"auto"},children:e.jsx(o,{sx:{mt:"20px"},children:l.filter(m=>m.checked).map((m,S)=>e.jsxs(o,{sx:{border:"1px solid grey",display:"flex",mx:"30px",mb:"10px",borderRadius:"5px",padding:"15px",color:_.grey[400]},children:[e.jsx(o,{sx:{width:"95%"},children:m.label}),e.jsxs(o,{children:[" ",m&&(m==null?void 0:m.dataByte)&&m.dataByte,m.spn[0].unit]})]}))})}),e.jsx(o,{children:e.jsx(o,{sx:{display:"flex",mt:"20px",mx:"20px"}})})]})]})};let _r=["RetroFotax","Sinocastel"];const Er=()=>{const t=de(),{isTerminal:s,isReadDtc:r,isLiveParameter:l,isWriteParameter:d,isActuator:w,isRoutineTest:x,isEcuInfo:p,isFlashing:_,selectedVehicle:n,isJ1939:P}=M(c=>c.diagnostics),{w_customer_id:N}=M(c=>c.auth),{mode:v}=M(c=>c.dashboard),[y,A]=g.useState(!1);g.useState(!0);const[E,j]=g.useState(!1),[C,O]=g.useState([]),[L,m]=g.useState(null),S=oe(v);g.useEffect(()=>{I()},[]);const I=async()=>{try{const c=await t(fs({w_customer_id:N}));if(!Array.isArray(c.payload)){H.error("Unexpected data format");return}const F=c.payload.filter(a=>{var k;return Array.isArray(a.imei)&&((k=a.imei[0])==null?void 0:k.mac_id)}).map(a=>{var k,R;return{...a,id:a.id,label:a.registration_id,value:(k=a.imei[0])==null?void 0:k.mac_id,vehilce_type:a==null?void 0:a.segment,chassis_no:a==null?void 0:a.chassis_no,engine_no:a==null?void 0:a.engine_no,workShop:a==null?void 0:a.workshop,registration_id:a==null?void 0:a.registration_id,sell_date:a==null?void 0:a.sell_date,customer_name:a==null?void 0:a.customer_name,vehicle_model:(R=a==null?void 0:a.vehicle_model)==null?void 0:R.name,user:a==null?void 0:a.user,vehicle_group:a==null?void 0:a.vehicle_group}});O(F),t(ms(F))}catch(c){console.error("Error fetching vehicle data:",c),H.error("Error fetching vehicle data")}},b=c=>{var a,k;const F=(k=(a=c==null?void 0:c.imei)==null?void 0:a[0])==null?void 0:k.device_typ;m(F),t(Cs({imei:c.value,reg_id:c.label})),t(js(c)),A(!1),j(!1)},T=()=>L==="RetroFotax"?e.jsxs(e.Fragment,{children:[w&&e.jsx(Ne,{}),p&&e.jsx(Ne,{}),s&&e.jsx(yr,{}),r&&e.jsx(ur,{}),d&&e.jsx(Cr,{}),l&&e.jsx(xr,{}),x&&e.jsx(Ne,{}),_&&e.jsx(hr,{}),P&&e.jsx(jr,{})]}):L==="Sinocastel"?e.jsxs(e.Fragment,{children:[s&&e.jsx(Ss,{}),r&&e.jsx(ks,{}),l&&e.jsx(vs,{})]}):e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",color:"grey",height:"90%"},children:e.jsx("h1",{children:!Object.keys(n).length>0?"Please select a vehicle.":"Diagnostic not available for this device"})});return e.jsxs("div",{className:"app",children:[e.jsx(bs,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(sr,{title:"Diagnostics",setShowVehicles:A,showParams:E,setShowParams:j,showVehicles:y}),e.jsxs(o,{sx:{display:"flex",background:"#F5F5F5"},children:[e.jsx(o,{sx:{width:"80%",background:S.grey[100]},children:T()}),e.jsxs(o,{sx:{width:"20%",backgroundColor:S.grey[100],height:"90vh"},children:[y&&e.jsx(rr,{vehicleData:C.filter(c=>{var F;return _r.includes((F=c==null?void 0:c.imei[0])==null?void 0:F.device_typ)}),handleChange:b}),!y&&!E&&e.jsx(ar,{options:ys.filter(c=>c.allowedDevice.includes(L)),handleChange:()=>{},dota:!0,trip:!0}),E&&e.jsx(or,{deviceType:L})]})]})]})]})};export{Er as default};
