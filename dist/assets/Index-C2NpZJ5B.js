import{p as b,r as a,o as ce,S as le,x as ie,ae as q,a3 as he,a4 as ue,a6 as de,a7 as pe,y as F,j as r,Y as ge,$ as fe,B as L,af as Se,w as ve,ag as H}from"./index-BiuHTavI.js";import{L as we}from"./LiveMapTopBar-VYHZterq.js";import{V as _e}from"./VehicleMenu-B779m6HS.js";import{P as Le}from"./Parameters-DKrcxk6d.js";/* empty css           */import"./Autocomplete-Bgce0ybq.js";function Pe(){const{locationData:n,selectedVehicle:g,selectedParameterList:xe,onlineVehicle:C}=b(s=>s.liveMap),{mode:J,selectedVehicleGroup:P}=b(s=>s.dashboard),M=ve(J),[K,Q]=a.useState([]),[E,W]=a.useState(""),[f,X]=a.useState(""),[S,Z]=a.useState(""),[x,ee]=a.useState(""),{w_customer_id:m}=b(s=>s.auth),[se,y]=a.useState(),[w,I]=a.useState(!1),[_,A]=a.useState(!1),[j,D]=a.useState([]),[G,te]=a.useState(!0),[O,V]=a.useState(!1),[R,B]=a.useState(!1);let h=ce();a.useEffect(()=>()=>{h(le({}))},[]),a.useEffect(()=>{ae()},[]),a.useEffect(()=>{var s;if(Object.keys(g).length>0){const t=n==null?void 0:n.filter(e=>e.latestDocument.imei==(g==null?void 0:g.imei)),{lat:c,lng:u}=((s=t==null?void 0:t[0])==null?void 0:s.latestDocument)??{},d={lat:c||H.lat,lng:u||H.lat};h(ie(d))}},[g,n]),a.useEffect(()=>{D([]),h(q([{reg_id:"",imei:"",params:[]}]))},[g]);const ae=async()=>{try{V(!0);let s=[],t=[];const c=await h(he({w_customer_id:m}));if(Array.isArray(c.payload)){c.payload.forEach(e=>{var i,l,v,o;Array.isArray(e.imei)&&e.imei.length>0&&((i=e.imei[0])!=null&&i.mac_id)?(s.push({id:e.id,label:e.registration_id,value:(l=e.imei[0])==null?void 0:l.mac_id,vehilce_type:e==null?void 0:e.segment,chassis_no:e==null?void 0:e.chassis_no,engine_no:e==null?void 0:e.engine_no,workShop:e==null?void 0:e.workshop,registration_id:e==null?void 0:e.registration_id,sell_date:e==null?void 0:e.sell_date,customer_name:e==null?void 0:e.customer_name,vehicle_model:(v=e==null?void 0:e.vehicle_model)==null?void 0:v.name,vehicle_group:e==null?void 0:e.vehicle_group}),t.push((o=e.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",e)});const u="one",d=t;t.length>0&&h(ue({type:u,imei:d})),Q(s),h(de(s)),h(pe({w_customer_id:m})),V(!1)}else V(!1),console.error("Unexpected data format:",c),F.error("Unexpected data format:")}catch(s){console.error("Error fetching vehicle data:",s),F.error(`Error fetching vehicle data: ${s}`)}},oe=async s=>{const{label:t,imei:c,id:u,reg_id:d,checked:e}=s;y(o=>o.map(p=>p.id===u?{...p,checked:!e}:p));let i=[...j],l=[...j];if(!e)n.forEach(o=>{o.latestDocument.imei===c&&(i.push({label:t,value:o.latestDocument[t==="maininputvoltage"?"mainInputVoltage":t]}),l=i,D(i))});else{let o=j.filter(p=>p.label!==t);l=o,D(o)}h(q([{reg_id:d,imei:c,params:l}]))},re=s=>n==null?void 0:n.some(t=>String(t.latestDocument.imei)===String(s)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),ne=s=>n==null?void 0:n.some(t=>String(t.latestDocument.imei)===String(s)&&t.latestDocument.speed<=0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),N=K.filter(s=>{var T,U,$,z,Y;if(!(Object.keys(P).length===0||s.vehicle_group===P.id))return!1;const c=(T=s==null?void 0:s.label)==null?void 0:T.toLowerCase().includes(E.toLowerCase()),u=x===""||((U=s==null?void 0:s.workShop)==null?void 0:U.region)===x,d=S===""||((z=($=s==null?void 0:s.workShop)==null?void 0:$.state)==null?void 0:z.toLowerCase())===(((Y=S==null?void 0:S.toString())==null?void 0:Y.toLowerCase())||""),e=s.value,i=String(s.value).toLowerCase(),l=C.some(k=>String(k).toLowerCase()===i),v=!C.some(k=>String(k).toLowerCase()===i),o=l&&re(e),p=l&&ne(e);return c&&u&&d&&(f==="online"?l:f==="offline"?v:f==="running"?o:f==="idling"?p:!0)}).sort((s,t)=>s.label.localeCompare(t.label));return r.jsxs("div",{className:"app",children:[r.jsx(ge,{}),r.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[r.jsx(we,{title:"Live Map",setShowVehicles:I,showVehicles:w,showParameters:_,setShowParameters:A,setShowCard:te,showCard:G,setShowVehiclesGroup:B,showVehiclesGroup:R}),r.jsx(fe,{setShowVehiclesGroup:B,showVehiclesGroup:R,where:"livemap"}),r.jsxs(L,{style:{display:"flex",width:"100%",height:"95vh"},children:[r.jsx(L,{style:{width:w||_?"80%":"100%"},children:r.jsx(Se,{showCard:G,loadingVehicle:O,vehicleData:N})}),w&&r.jsx(L,{style:{width:"20%",backgroundColor:M.grey[100]},children:r.jsx(_e,{vehicleData:N,title:"Live Map",setParameterData:y,loadingVehicle:O,setShowVehicles:I,showVehicles:w,showParameters:_,setShowParameters:A,setSearchedTerm:W,setOptions:X,setState:Z,setRegion:ee,searchTerm:E,options:f,state:S,region:x})}),_&&r.jsx(L,{style:{width:"20%",backgroundColor:M.grey[100]},children:r.jsx(Le,{parametersData:se,setParameterData:y,handleParameterChange:oe})})]})]})]})}export{Pe as default};
