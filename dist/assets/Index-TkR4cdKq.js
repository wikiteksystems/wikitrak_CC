import{R as U,o as D,j as e,D as F,dg as Q,dh as Y,m as $,cQ as q,di as z,bP as G,r,B as h,f6 as H,f7 as T,f9 as K,fa as X,fd as Z,fc as ee,p as V,af as A,a3 as se,a4 as ae,a6 as te,V as B,Y as re,w as oe}from"./index-Ds6FVMyp.js";import{V as ne}from"./VehicleMenu-i2tPcDHX.js";import{P as ie}from"./Parameters-B2L7TnNt.js";/* empty css           */import"./index.esm-D6DYQ70I.js";import{C as ce,S as le}from"./ServiceRecordTable-hn_CHZN4.js";import{S as de}from"./ServiceJobCardTable-Bx9fE2sY.js";import{S as he}from"./ServicesTopBar-BE8e5QIo.js";import"./Autocomplete-DdKvbCmR.js";import"./ServiceJobCard-CMmeaskm.js";import"./formik.esm-B7HvObs5.js";import"./Remove-BIfc8E92.js";import"./excelUtils-g5PpiC3H.js";import"./Edit-cUm7yG9h.js";function pe(){const[n,t]=U.useState(!1);D();const i=()=>t(!0),l=()=>t(!1);return e.jsxs("div",{children:[e.jsx(F,{variant:"outlined",onClick:i,children:"+ Add New Entry"}),e.jsxs(Q,{open:n,onClose:l,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[e.jsxs(Y,{children:["+ Add new service entry",e.jsx($,{"aria-label":"close",onClick:l,sx:{position:"absolute",right:8,top:8},children:e.jsx(q,{})})]}),e.jsx(z,{dividers:!0,children:e.jsx(ce,{setOpen:t})})]})]})}function ue(){const[n]=G(),t=n.get("tab"),[i,l]=r.useState(0);r.useEffect(()=>{t&&l(Number(t))},[]);const g=(L,m)=>{l(m)};return e.jsxs(h,{sx:{width:"100%"},children:[e.jsx(h,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(H,{value:i,onChange:g,"aria-label":"Breakdown Tabs",children:[e.jsx(T,{label:"Service Tickets"}),e.jsx(T,{label:"Service Job Cards"})]})}),e.jsxs(h,{sx:{mt:2},children:[i===0&&e.jsx(le,{isInspection:!1}),i===1&&e.jsx(de,{isInspection:!1})]})]})}const xe=()=>{const n=D();r.useEffect(()=>{n(K()),n(X()),n(Z())},[]);let t=ee("Service");const i=(t==null?void 0:t.includes("Create"))||t==="Read-Write-Only";return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),i&&e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(pe,{})}),"      "]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(ue,{})})]})]})};function Le(){const{locationData:n,selectedVehicle:t,selectedParameterList:i}=V(a=>a.liveMap),{mode:l}=V(a=>a.dashboard),g=oe(l),[L,m]=r.useState([]),{w_customer_id:I}=V(a=>a.auth),[M,S]=r.useState(),[j,k]=r.useState(!1),[v,E]=r.useState(!1),[y,b]=r.useState([]),[R,N]=r.useState(!0),[O,_]=r.useState(!1);let x=D();r.useEffect(()=>{W()},[]),r.useEffect(()=>{b([]),x(A([{reg_id:"",imei:"",params:[]}]))},[t]);const W=async()=>{try{_(!0);let a=[],c=[];const p=await x(se({w_customer_id:I}));if(Array.isArray(p.payload)){p.payload.forEach(s=>{var u,d,P,o;Array.isArray(s.imei)&&s.imei.length>0&&((u=s.imei[0])!=null&&u.mac_id)?(a.push({id:s.id,label:s.registration_id,value:(d=s.imei[0])==null?void 0:d.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(P=s==null?void 0:s.vehicle_model)==null?void 0:P.name}),c.push((o=s.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",s)});const C="one",w=c;c.length>0&&x(ae({type:C,imei:w})),m(a),x(te(a)),_(!1)}else _(!1),console.error("Unexpected data format:",p),B.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),B.error(`Error fetching vehicle data: ${a}`)}},J=async a=>{const{label:c,imei:p,id:C,reg_id:w,checked:s}=a;S(o=>o.map(f=>f.id===C?{...f,checked:!s}:f));let u=[...y],d=[...y];if(!s)n.forEach(o=>{o.latestDocument.imei===p&&(u.push({label:c,value:o.latestDocument[c==="maininputvoltage"?"mainInputVoltage":c]}),d=u,b(u))});else{let o=y.filter(f=>f.label!==c);d=o,b(o)}console.log("tempParamList",d),x(A([{reg_id:w,imei:p,params:d}]))};return e.jsxs("div",{className:"app",children:[e.jsx(re,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(he,{title:"services",setShowVehicles:k,showVehicles:j,showParameters:v,setShowParameters:E,setShowCard:N,showCard:R}),e.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(h,{style:{width:j||v?"80%":"100%"},children:e.jsx(xe,{})}),j&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ne,{vehicleData:L,title:"Inspections",setParameterData:S,loadingVehicle:O,setShowVehicles:k,showVehicles:j,showParameters:v,setShowParameters:E})}),v&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ie,{parametersData:M,setParameterData:S,handleParameterChange:J})})]})]})]})}export{Le as default};
