import{l as Se,o as ye,p as De,_ as ae,b as o,q as we,f as ve,j as t,g as be,k as Ce,ab as ue,y as ge,z as Y,ah as Me,ai as Ae,aj as P,N as _,T as m,G as B,ak as re,al as Te,am as ke,an as le,ao as de,C as Q,ap as pe,D as he,aq as _e,$ as Ye,a1 as Ie,a2 as Ne,a5 as Le}from"./index-B0iMrQEg.js";import{L as Oe}from"./LeftSideBar2-ILkFk4yT.js";import{L as Ve}from"./LiveMapTopBar-Bdw0FtzZ.js";import{V as Ee}from"./VehicleMenu-C064iCFQ.js";import{T as Re}from"./TripMap-Ag_nWgbd.js";import{D as Be}from"./DateTimePicker-DnASClib.js";import{r as xe}from"./createSvgIcon-ChM2IOdI.js";import{t as fe}from"./SearchTab-D4Mao1HF.js";import{B as d,C as Pe}from"./CircularProgress-XdsXXIks.js";import{b as $e}from"./menu2-CYPHhAu2.js";import{C as qe}from"./Card-mZlXRmiI.js";import{C as Fe}from"./CardContent-MZnyGQ9F.js";import"./TripGraph-D_47ZWyJ.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as Ge}from"./VehicleGroups-CuACeEHb.js";import"./useControlled-C83z02Se.js";import"./Close-C5Pnwi4_.js";import"./jcb-aCHXMCXy.js";import"./Autocomplete-C-mO1nLV.js";import"./usePreviousProps-DREFKMbo.js";import"./TextField-CX7NsgBG.js";import"./esm-DaDYi9Qf.js";import"./redTractor-NXgVJyvR.js";import"./Info-BcqVw4-K.js";import"./isBetween-DMHXiRBW.js";import"./index-1kB7sMZi.js";function Ue(a){return Se("MuiCardActions",a)}ye("MuiCardActions",["root","spacing"]);const ze=["disableSpacing","className"],He=a=>{const{classes:w,disableSpacing:j}=a;return Ce({root:["root",!j&&"spacing"]},Ue,w)},We=De("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(a,w)=>{const{ownerState:j}=a;return[w.root,!j.disableSpacing&&w.spacing]}})(({ownerState:a})=>ae({display:"flex",alignItems:"center",padding:8},!a.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Xe=o.forwardRef(function(w,j){const v=we({props:w,name:"MuiCardActions"}),{disableSpacing:u=!1,className:S}=v,$=ve(v,ze),h=ae({},v,{disableSpacing:u}),g=He(h);return t.jsx(We,ae({className:be(g.root,S),ownerState:h,ref:j},$))}),Je=Xe;var oe={},Ke=ue;Object.defineProperty(oe,"__esModule",{value:!0});var me=oe.default=void 0,Qe=Ke(xe()),Ze=t;me=oe.default=(0,Qe.default)((0,Ze.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var ne={},et=ue;Object.defineProperty(ne,"__esModule",{value:!0});var je=ne.default=void 0,tt=et(xe()),st=t;je=ne.default=(0,tt.default)((0,st.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const rt=()=>{var n,f,C,M;const a=ge(),{tripList:w,selectedTripData:j,loading:v,trips:u,activeIndex:S,searchText:$,mode:h,isNavigate:g,allTripList:c,trip_payload:I,page:y,total_page:N,total_trips:Z}=Y(e=>e.dashboard),{selectedVehicle:L}=Y(e=>e.liveMap),D=fe(h),[q,F]=o.useState(!1),[i,G]=o.useState({}),[b,U]=o.useState(""),[k,z]=o.useState(null);o.useEffect(()=>{(u==null?void 0:u.length)>0},[u]),o.useEffect(()=>{const e=ie(c);a(Me(e))},[c]),o.useEffect(()=>{!(j.length>0)&&g&&S!==null&&x.length>0&&ee(x[S])},[j,g]);const ee=async e=>{var p;let r={imei:L.imei,startDate:e.startDate,endDate:e.endDate};const l=await Ae(r);((p=l==null?void 0:l.data)==null?void 0:p.documents.length)>0?(a(g(!1)),a(P(l.data.documents[0].data))):(a(g(!1)),a(P([])))},ie=e=>{const r=new Set,l=[];return e.forEach(p=>{const T=_(p.startTime).format("YYYY-MM-DD");r.has(T)||(r.add(T),l.push(T))}),l},H=(e,r)=>{a(re(null)),a(Te(e)),a(ke(!1)),b===e?(U(""),z(null)):(U(e),z(r))},x=b===""?c:c.filter(e=>_(e.startTime).format("YYYY-MM-DD")===b),W=async(e,r)=>{a(P(r.data)),a(re(e)),a(le(r.tripAcreage))},A=e=>{G(e),F(!0)},X=()=>{F(!1),G({})},J=e=>e?e.split(" ").slice(0,2).join(" "):"",te=async()=>{const e={...I,page:y+1,limit:20};try{(await a(de(e))).error?Q.error("No Trip! within selected date"):a(pe(y+1))}catch{Q.error("No Trip! within selected date")}},se=()=>{if(y<=1)return;const e={...I,page:y-1,limit:20};a(pe(y-1)),a(de(e))},s=e=>{let r=e==null?void 0:e.reduce((l,p)=>l+p.tripAcreage,0);console.log("merged array",r),a(P([])),a(re("all")),a(le(r))};return t.jsxs(t.Fragment,{children:[t.jsxs(d,{children:[t.jsxs(d,{sx:{m:"10px"},children:[t.jsx(d,{sx:{color:D.grey[400]},children:"Select Date"}),t.jsx(d,{sx:{mt:1},children:t.jsx(Be,{})})]}),v?t.jsx("div",{style:{width:"100%",margin:"38%"},children:t.jsx(Pe,{})}):t.jsxs(t.Fragment,{children:[t.jsx(d,{children:t.jsx(d,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:c&&(c==null?void 0:c.length)>0?t.jsx(t.Fragment,{}):t.jsx(m,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),c&&(c==null?void 0:c.length)>0&&t.jsxs(d,{ml:2,display:"flex",gap:1,children:[t.jsxs(m,{children:["Total trips:",Z]})," |",t.jsxs(m,{children:["Current page:",y]})," |",t.jsxs(m,{children:["Total page:",N]}),"|"]}),c&&(c==null?void 0:c.length)>0&&t.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",mt:"5px"},children:[t.jsx(B,{disabled:y<=1,onClick:se,children:t.jsx(me,{})}),t.jsx(B,{disabled:N===y||N===0,onClick:te,children:t.jsx(je,{})})]}),t.jsxs(d,{sx:{height:"75vh",width:"100%",overflowY:"auto"},children:[t.jsx(d,{display:"flex",gap:1,marginLeft:2,children:u.map((e,r)=>t.jsx(d,{children:t.jsx(B,{onClick:()=>{H(e,r)},style:{backgroundColor:k===r?D.grey[300]:D.grey[200],color:k===r?"black":D.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:e})},r))}),x&&x.length>0&&t.jsx(B,{variant:S==="all"?"contained":"outlined",sx:{width:"90%",mx:"20px",mt:"10px"},onClick:()=>{s(x)},children:"Select All trips"}),"              ",x&&x.length>0&&x.map((e,r)=>{var O,V,E,R;const l=(V=(O=e==null?void 0:e.startLocation)==null?void 0:O.address)==null?void 0:V.address,p=(R=(E=e==null?void 0:e.endLocation)==null?void 0:E.address)==null?void 0:R.address,T=l?`${l.town||l.city||""}`:"",ce=p?`${p.town||p.city||""}`:"";return t.jsxs(d,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:S===r?"black":D.grey[400],backgroundColor:S===r?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:h?D.grey[300]:D.grey[200]}},onClick:()=>W(r,e),children:[t.jsxs(m,{sx:{cursor:"text"},children:[r+1,". ",J(T)," to"," ",J(ce)," "]}),t.jsxs(m,{children:[e!=null&&e.startTime?_(new Date(e.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",e!=null&&e.endTime?_(new Date(e.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",t.jsx("span",{style:{color:h?"orange":"blue",cursor:"pointer"},onClick:K=>{K.stopPropagation(),A(e)},children:"...see more"})]})]},r)})]})]})]}),t.jsx($e,{open:q,onClose:X,children:t.jsxs(qe,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[t.jsxs(Fe,{children:[t.jsx(m,{variant:"h6",component:"div",children:"Trip Details"}),t.jsxs(m,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Location:"})," ",((f=(n=i==null?void 0:i.startLocation)==null?void 0:n.address)==null?void 0:f.display_name)||"N/A"]}),t.jsxs(m,{sx:{mt:2},children:[t.jsx("strong",{children:"End Location:"})," ",((M=(C=i==null?void 0:i.endLocation)==null?void 0:C.address)==null?void 0:M.display_name)||"N/A"]}),t.jsxs(m,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Time:"})," ",i!=null&&i.startTime?_(new Date(i.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),t.jsxs(m,{sx:{mt:2},children:[t.jsx("strong",{children:"End Time:"})," ",i!=null&&i.endTime?_(new Date(i.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),t.jsx(Je,{children:t.jsx(B,{onClick:X,children:"Close"})})]})})]})},at=rt;function It(){const{w_customer_id:a}=Y(s=>s.auth),{collapsed:w}=Y(s=>s.auth),{mode:j,selectedVehicleGroup:v}=Y(s=>s.dashboard),{vehicleList:u,selectedVehicle:S,onlineVehicle:$,locationData:h}=Y(s=>s.liveMap),[g,c]=o.useState(!1),[I,y]=o.useState(!0),[N,Z]=o.useState([]),[L,D]=o.useState(!0),[q,F]=o.useState(""),[i,G]=o.useState(""),[b,U]=o.useState(""),[k,z]=o.useState("");o.useState([]);const[ee,ie]=o.useState({lat:18.516726,lng:73.856255});o.useState([]);const[H,x]=o.useState(!1),W=fe(j);let A=ge();o.useEffect(()=>{A(P([])),X()},[]),o.useEffect(()=>{var f,C,M;const s=he().subtract(5,"day").startOf("day").toISOString(),n=he().endOf("day").toISOString();A(_e({startDate:s,endDate:n})),Object.keys(S).length===0&&u.length>0&&A(Ye({imei:(C=(f=u[0])==null?void 0:f.imei[0])==null?void 0:C.mac_id,reg_id:(M=u[0])==null?void 0:M.registration_id}))},[S,u]);const X=async()=>{try{let s=[],n=[];const f=await A(Ie({w_customer_id:a}));if(Array.isArray(f.payload)){f.payload.forEach(e=>{var r,l,p;Array.isArray(e.imei)&&e.imei.length>0&&((r=e.imei[0])!=null&&r.mac_id)?(s.push({id:e.id,label:e.registration_id,value:(l=e.imei[0])==null?void 0:l.mac_id,workShop:e==null?void 0:e.workshop,vehicle_group:e==null?void 0:e.vehicle_group}),n.push((p=e.imei[0])==null?void 0:p.mac_id)):console.error("IMEI data not found for item:",e)});const C="one",M=n;n.length>0&&A(Ne({type:C,imei:M})),A(Le({w_customer_id:a})),Z(s)}else console.error("Unexpected data format:",f),Q.error("Unexpected data format:")}catch(s){console.error("Error fetching vehicle data:",s),Q.error(`Error fetching vehicle data: ${s}`)}},J=s=>h==null?void 0:h.some(n=>Number(n.latestDocument.imei)===Number(s)&&n.latestDocument.speed>0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),te=s=>h==null?void 0:h.some(n=>Number(n.latestDocument.imei)===Number(s)&&n.latestDocument.speed<=0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),se=N.filter(s=>{var O,V,E,R,K;if(!(Object.keys(v).length===0||s.vehicle_group===v.id))return!1;const f=(O=s==null?void 0:s.label)==null?void 0:O.toLowerCase().includes(q.toLowerCase()),C=k===""||((V=s==null?void 0:s.workShop)==null?void 0:V.region)===k,M=b===""||((R=(E=s==null?void 0:s.workShop)==null?void 0:E.state)==null?void 0:R.toLowerCase())===(((K=b==null?void 0:b.toString())==null?void 0:K.toLowerCase())||""),e=Number(s.value),r=$.includes(e),l=!r,p=r&&J(e),T=r&&te(e);return f&&C&&M&&(i==="online"?r:i==="offline"?l:i==="running"?p:i==="idling"?T:!0)}).sort((s,n)=>s.label.localeCompare(n.label));return t.jsxs("div",{className:"app",children:[t.jsx(Oe,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(Ve,{title:"Trip Monitor",setShowVehicles:c,showVehicles:g,setShowCard:y,showCard:I,sideBarTrip:L,setSideBarTrip:D,setShowVehiclesGroup:x,showVehiclesGroup:H}),t.jsx(Ge,{setShowVehiclesGroup:x,showVehiclesGroup:H,where:"tripmonitor"}),t.jsxs(d,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(d,{style:{width:g||L?"80%":"100%"},children:t.jsx(Re,{center:ee,showCard:I})}),g&&t.jsx(d,{style:{width:"20%",backgroundColor:W.grey[100]},children:t.jsx(Ee,{vehicleData:se,setShowVehicles:c,showVehicles:g,title:"Live Monitor",setSearchedTerm:F,setOptions:G,setState:U,setRegion:z,searchTerm:q,options:i,state:b,region:k,setSideBarTrip:D})}),t.jsx(d,{style:{width:w?"22%":"20%",display:L?"block":"none",backgroundColor:W.grey[100]},children:t.jsx(at,{})})]})]})]})}export{It as default};
