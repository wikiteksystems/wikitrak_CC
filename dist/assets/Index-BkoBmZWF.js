import{n as Ve,j as s,a$ as q,b as l,a_ as ne,fi as Re,fo as qe,fp as Ie,fq as Oe,b7 as N,bk as ue,aW as $,ep as v,dK as W,bc as se,bY as Fe,T as _e,aY as Z,f1 as me,f2 as ye,f3 as Ce,R as Se,ff as Ee,bm as w,fg as he,bf as Me,d4 as fe,cf as We,dT as Ne,dU as Ye,dV as He,dW as ve,dX as j,dY as De,f5 as ze,c4 as Je,ed as Ge,da as Ke,eM as Qe,eN as ge,fa as Xe,fb as Ze,fh as ke,bH as be,bw as Be,bx as Ue,bz as we,bq as es,b5 as ss}from"./index-C_fl7o4d.js";import{V as ts}from"./VehicleMenu-BNp23o60.js";import{P as as}from"./Parameters-D68vMp5z.js";/* empty css           */import{c as rs,f as ns,a as ee,e as cs}from"./index.esm-CrGCYPLO.js";import{u as is}from"./formik.esm-CkDNdtUO.js";import{A as le}from"./Autocomplete-DQzPwokd.js";import{R as ls,A as os,D as Pe}from"./Remove-Db7Q6F84.js";import{a as ds,S as us}from"./ServiceJobCardTable-DiNh2Xr5.js";import{T as hs,d as ps,C as xs}from"./excelUtils-XEzm5y4L.js";import{T as _s,E as fs}from"./Edit-BDSp-1tk.js";import{S as vs}from"./ServicesTopBar-Dk8OMCSa.js";const gs=Ve(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Te=({UpdatedBreakdownData:n,setOpen:h})=>{var U,x,y,T;const{w_customer_id:g}=q(a=>a.auth),[C,A]=l.useState(null),{vehicleList:V}=q(a=>a.liveMap),{vendorList:I,segMentList:Y,loading:te}=q(a=>a.services),{technicianList:S}=q(a=>a.breakdown),{sparePartList:R}=q(a=>a.inspection),P=ne(),[H,O]=l.useState([]),[k,K]=l.useState([]),[Q,F]=l.useState(!1);l.useState(null),console.log("update service data",n),l.useEffect(()=>{},[S]);let B=n==null?void 0:n.service_parts.map(a=>{var i;return{spare_parts:(i=a==null?void 0:a.spare_parts)==null?void 0:i.id,quantity:a==null?void 0:a.quantity}});const t=is({initialValues:{start_date:(n==null?void 0:n.start_date)||Re(new Date),vehicle:((U=n==null?void 0:n.vehicle)==null?void 0:U.id)||"",service_type:(n==null?void 0:n.service_type)||"",technician:((x=n==null?void 0:n.technician)==null?void 0:x.id)||"",mob_no:(n==null?void 0:n.mob_no)||"",attachment:(n==null?void 0:n.attachment)||"",location:(n==null?void 0:n.location)||"",contact_person:(n==null?void 0:n.contact_person)||"",service_parts:B||[],status:"Pending",user:g},validationSchema:rs({start_date:ns().required("Submission Date is required"),vehicle:ee().required("Vehicle is required"),service_type:ee().required("Service type is required"),technician:ee().required("Technician is required"),mob_no:ee().matches(/^\d{10,11}$/,"Mobile number must be 10-11 digits").required("Mobile number is required"),location:ee().required("Location is required"),contact_person:ee().required("Contact Person is required"),attachment:cs()}),onSubmit:async a=>{console.log("values",a);let i;if(n?((a==null?void 0:a.attachment)instanceof File||typeof(a==null?void 0:a.attachment)=="string"&&(a.attachment=""),i=await P(qe({payload:a,id:n.id}))):i=await P(Ie(a)),i.payload){console.log(i.payload),console.log("values",a.service_parts);const{id:c}=i.payload,{service_parts:_}=a;await P(Oe({service:c,parts:_})),N.success("Service created successfully"),t.resetForm(),A(null),P(ue()),h(!1)}}}),E=["Routine","Overdue","Emergency"];l.useEffect(()=>{let a=V.map(i=>({label:i.registration_id,value:i.id}));O(a)},[V]),l.useEffect(()=>{let a=Y.map(i=>({label:i.segment_name,value:i.id}));K(a)},[Y]);const ae=async()=>{F(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(async a=>{const{latitude:i,longitude:c}=a.coords;try{const _=await getReadableAddress(i,c);t.setFieldValue("location",_)}catch{N.error("Failed to convert coordinates to address.")}finally{F(!1)}},()=>{N.error("Failed to retrieve location."),F(!1)}):(N.error("Geolocation not supported."),F(!1))};return s.jsx($,{sx:{p:3,maxWidth:"100%",margin:"auto"},children:s.jsx("form",{onSubmit:t.handleSubmit,children:s.jsxs(v,{container:!0,spacing:2,children:[s.jsx(v,{item:!0,xs:12,sm:6,children:s.jsx(W,{label:"Start date",name:"start_date",type:"datetime-local",value:t.values.start_date,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.start_date&&!!t.errors.start_date,helperText:t.touched.start_date&&t.errors.start_date,fullWidth:!0,InputLabelProps:{shrink:!0},disabled:!0})}),s.jsx(v,{item:!0,xs:12,sm:6,children:s.jsx(le,{options:V,getOptionLabel:a=>a.registration_id||"",value:V.find(a=>a.id===t.values.vehicle)||null,onChange:(a,i)=>t.setFieldValue("vehicle",(i==null?void 0:i.id)||""),renderInput:a=>s.jsx(W,{...a,label:"Vehicle",error:t.touched.vehicle&&!!t.errors.vehicle,helperText:t.touched.vehicle&&t.errors.vehicle})})}),s.jsx(v,{item:!0,xs:12,sm:6,children:s.jsx(le,{options:E,getOptionLabel:a=>a,value:t.values.service_type,onChange:(a,i)=>t.setFieldValue("service_type",i||""),renderInput:a=>s.jsx(W,{...a,label:"Service Type",error:t.touched.service_type&&!!t.errors.service_type,helperText:t.touched.service_type&&t.errors.service_type})})}),s.jsx(v,{item:!0,xs:12,sm:6,children:s.jsx(le,{options:S,getOptionLabel:a=>`${a.first_name} ${a.last_name}`||"",value:S.find(a=>a.id===t.values.technician)||null,onChange:(a,i)=>t.setFieldValue("technician",(i==null?void 0:i.id)||""),renderInput:a=>s.jsx(W,{...a,label:"Assign technician",error:t.touched.technician&&!!t.errors.technician,helperText:t.touched.technician&&t.errors.technician})})}),s.jsx(v,{item:!0,xs:12,sm:6,children:s.jsx(W,{label:"Contact Person Name*",name:"contact_person",value:t.values.contact_person,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.contact_person&&!!t.errors.contact_person,helperText:t.touched.contact_person&&t.errors.contact_person,fullWidth:!0})}),s.jsx(v,{item:!0,xs:12,sm:6,children:s.jsx(W,{label:"Contact Person Mobile No*",name:"mob_no",value:t.values.mob_no,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.mob_no&&!!t.errors.mob_no,helperText:t.touched.mob_no&&t.errors.mob_no,fullWidth:!0})}),s.jsxs(v,{item:!0,xs:12,sm:6,children:[s.jsx(W,{label:"Location",name:"location",value:t.values.location,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.location&&!!t.errors.location,helperText:t.touched.location&&t.errors.location,fullWidth:!0}),s.jsx(se,{size:"small",onClick:ae,disabled:Q,sx:{mt:1},children:Q?s.jsx(Fe,{size:16}):"Use Current Location"})]}),s.jsxs(v,{item:!0,xs:12,children:[s.jsx(_e,{variant:"h6",gutterBottom:!0,children:"Parts Requirement*(If any information available)"}),(T=(y=t==null?void 0:t.values)==null?void 0:y.service_parts)==null?void 0:T.map((a,i)=>{var b;const c=(b=t.values)==null?void 0:b.service_parts.map(o=>o.spare_parts).filter((o,d)=>d!==i),_=R.filter(o=>!c.includes(o.id));return s.jsxs(v,{container:!0,spacing:2,marginTop:"0px",alignItems:"center",children:[s.jsx(v,{item:!0,xs:12,md:6,children:s.jsx(le,{options:_,getOptionLabel:o=>o.description,value:R.find(o=>o.id===a.spare_parts)||null,onChange:(o,d)=>t.setFieldValue(`service_parts[${i}].spare_parts`,(d==null?void 0:d.id)||""),renderInput:o=>s.jsx(W,{...o,label:"Spare Part",fullWidth:!0})})}),s.jsx(v,{item:!0,xs:8,md:4,children:s.jsxs($,{display:"flex",alignItems:"center",children:[s.jsx(Z,{onClick:()=>t.setFieldValue(`service_parts[${i}].quantity`,Math.max(1,a.quantity-1)),children:s.jsx(ls,{})}),s.jsx(W,{value:a.quantity,type:"number",inputProps:{min:1},onChange:o=>t.setFieldValue(`service_parts[${i}].quantity`,parseInt(o.target.value,10)),sx:{width:90,mx:1,textAlign:"center"}}),s.jsx(Z,{onClick:()=>t.setFieldValue(`service_parts[${i}].quantity`,a.quantity+1),children:s.jsx(os,{})})]})}),s.jsx(v,{item:!0,xs:4,md:2,children:s.jsx(Z,{color:"error",onClick:()=>{var d;const o=[...(d=t.values)==null?void 0:d.service_parts];o.splice(i,1),t.setFieldValue("service_parts",o)},children:s.jsx(Pe,{})})})]},i)}),s.jsx(se,{variant:"outlined",onClick:()=>{var c,_,b;const a=(_=(c=t.values)==null?void 0:c.service_parts)==null?void 0:_.map(o=>o.spare_parts);if(R.filter(o=>!(a!=null&&a.includes(o.id))).length===0){N.error("All available spare parts have already been added.");return}t.setFieldValue("service_parts",[...(b=t.values)==null?void 0:b.service_parts,{spare_parts:"",quantity:1}])},sx:{mt:2},children:"+ Add Spare Part"})]}),s.jsxs(v,{item:!0,xs:6,children:[s.jsxs(se,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload File",s.jsx("input",{type:"file",hidden:!0,onChange:a=>{const i=a.currentTarget.files[0];i&&t.setFieldValue("attachment",i)}})]}),t.values.attachment&&s.jsxs(v,{container:!0,spacing:1,mt:1,alignItems:"center",children:[s.jsx(v,{item:!0,children:s.jsxs(_e,{variant:"body2",children:[s.jsx("b",{children:"Attachment:"})," ",typeof t.values.attachment=="string"?t.values.attachment.split("/").pop():t.values.attachment.name]})}),s.jsx(v,{item:!0,children:s.jsx(se,{size:"small",variant:"text",onClick:()=>{const a=typeof t.values.attachment=="string"?t.values.attachment:URL.createObjectURL(t.values.attachment);window.open(a,"_blank")},children:"View File"})})]})]}),s.jsx(v,{item:!0,xs:12,children:s.jsx(se,{variant:"contained",type:"submit",fullWidth:!0,disabled:te,children:n?"Update Service request":"Raise Service request"})})]})})})};function bs({open:n,setOpen:h,data:g,isInspection:C}){const A=()=>h(!1);return s.jsxs(me,{open:n,onClose:A,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[s.jsxs(ye,{children:["Update service entry",s.jsx(Z,{"aria-label":"close",onClick:()=>h(!1),sx:{position:"absolute",right:8,top:8},children:s.jsx(gs,{})})]}),s.jsx(Ce,{dividers:!0,children:s.jsx(Te,{UpdatedBreakdownData:g,setOpen:h})})]})}const je=[{id:"service_record_id",label:"Service Record ID"},{id:"registration_id",label:"Registration ID"},{id:"service_type",label:"Service Type"},{id:"user_name",label:"Created by"},{id:"technician_name",label:"Technician Name"},{id:"contact_person",label:"Contact Person"},{id:"mob_no",label:"Mobile No"},{id:"start_date",label:"Start Date"},{id:"start_time",label:"Start Time"},{id:"status",label:"Status"}],js="https://cc.wikitrak.in/api-proxy/api/v1",ms=()=>{const{servicesData:n}=q(e=>e.services),[h,g]=l.useState(!1),[C,A]=l.useState(null),{searchTerm:V}=q(e=>e.inspection),I=ne(),[Y,te]=l.useState("asc"),[S,R]=l.useState("BDID"),[P,H]=l.useState(0),[O,k]=l.useState(8),[K,Q]=l.useState(!1),[F,B]=l.useState(!1),[t,E]=l.useState(null),[ae,U]=Se.useState(null);l.useState({service_record_id:"",registration_id:"",service_type:"",user_name:"",technician_name:"",contact_person:"",mob_no:"",start_date:"",start_time:"",status:""});const[x,y]=l.useState("service_record_id");l.useEffect(()=>{I(Ee({})),I(ue())},[]);const T=e=>{te(S===e&&Y==="asc"?"desc":"asc"),R(e)},a=(e,f)=>{H(f)},i=e=>{k(parseInt(e.target.value,10)),H(0)},c=(e,f,m)=>!f||!m?e:e.filter(r=>(()=>{var u,L,D,z,J,G,M,de,re;switch(f){case"service_record_id":return((r==null?void 0:r.service_record_id)||"").toString();case"registration_id":return((u=r==null?void 0:r.vehicle)==null?void 0:u.registration_id)||"";case"service_type":return(r==null?void 0:r.service_type)||"";case"user_name":return`${((D=(L=r==null?void 0:r.user)==null?void 0:L.us_user)==null?void 0:D.first_name)||""} ${((J=(z=r==null?void 0:r.user)==null?void 0:z.us_user)==null?void 0:J.last_name)||""}`;case"technician_name":return`${((M=(G=r==null?void 0:r.technician)==null?void 0:G.us_user)==null?void 0:M.first_name)||""} ${((re=(de=r==null?void 0:r.technician)==null?void 0:de.us_user)==null?void 0:re.last_name)||""}`;case"contact_person":return(r==null?void 0:r.contact_person)||"";case"mob_no":return(r==null?void 0:r.mob_no)||"";case"start_date":return r!=null&&r.start_date?w(r.start_date).format("YYYY-MM-DD"):"";case"start_time":return r!=null&&r.start_date?w(r.start_date).format("HH:mm A"):"";case"status":return(r==null?void 0:r.status)||"";default:return""}})().toLowerCase().includes(m.toLowerCase())),_=async()=>{console.log("breakdownData data deleting",C);try{await Je.delete(`${js}/vehicles/new/service-record/create/${C.id}/`),N.success("service data deleted successfully!"),I(ue())}catch(e){console.error("Error deleting service data:",e),N.error("Failed to delete service data. Please try again.")}g(!1)},b=()=>{g(!1)},o=(e,f,m,r)=>{if(r==="User"){const p=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),u=`${f.user.us_user.first_name} ${f.user.us_user.last_name}`.toLowerCase();return m==="asc"?p.localeCompare(u):u.localeCompare(p)}if(r==="WorkshopGroup"){const p=e.workshop_group.group_name.toLowerCase(),u=f.workshop_group.group_name.toLowerCase();return m==="asc"?p.localeCompare(u):u.localeCompare(p)}if(r==="BDID"){const p=parseInt(e.service_record_id.replace("BD-",""),10),u=parseInt(f.service_record_id.replace("BD-",""),10);return m==="asc"?p-u:u-p}if(r==="SubmissionDate"){const p=new Date(e.submission_date),u=new Date(f.submission_date);return m==="asc"?p-u:u-p}if(r==="Status"){const p={Open:1,Close:2,Rejected:3},u=p[e.status]||0,L=p[f.status]||0;return m==="asc"?u-L:L-u}return 0},d=c((n==null?void 0:n.slice())||[],x,V).sort((e,f)=>o(e,f,Y,S)),X=d.slice(P*O,P*O+O),oe={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},Le=e=>{B(!F),U(e)},$e=e=>{A(e),g(!0)},Ae=d&&d.map(e=>{var m,r,p,u,L,D,z,J,G;const f=e!=null&&e.service_parts&&(e==null?void 0:e.service_parts.length)>0?e==null?void 0:e.service_parts.map((M,de)=>{var re;return`${(re=M==null?void 0:M.spare_parts)==null?void 0:re.description}: Qty ${M==null?void 0:M.quantity}`}).join(";"):"N/A";return{"Service Record ID":(e==null?void 0:e.service_record_id)||"","Registration ID":((m=e==null?void 0:e.vehicle)==null?void 0:m.registration_id)||"","Service Type":(e==null?void 0:e.service_type)||"","User Name":`${((p=(r=e==null?void 0:e.user)==null?void 0:r.us_user)==null?void 0:p.first_name)||""} ${((L=(u=e==null?void 0:e.user)==null?void 0:u.us_user)==null?void 0:L.last_name)||""}`,"Technician Name":`${((z=(D=e==null?void 0:e.technician)==null?void 0:D.us_user)==null?void 0:z.first_name)||""} ${((G=(J=e==null?void 0:e.technician)==null?void 0:J.us_user)==null?void 0:G.last_name)||""}`,"Contact Person":(e==null?void 0:e.contact_person)||"","Mobile No":(e==null?void 0:e.mob_no)||"","Start Date":e!=null&&e.start_date?w(e.start_date).format("YYYY-MM-DD"):"","Start Time":e!=null&&e.start_date?w(e.start_date).format("HH:mm A"):"",Status:(e==null?void 0:e.status)||"","Spare parts":f}});let ce=he("Service"),ie=he("Job Card");const pe=(ie==null?void 0:ie.includes("Create"))||ie==="Read-Write-Only",xe=(ce==null?void 0:ce.includes("Update"))||ce==="Read-Write-Only";return s.jsxs($,{sx:{m:"10px"},children:[s.jsxs($,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[s.jsx(hs,{columns:je,selectedColumn:x,onColumnChange:y,searchTerm:V,onSearchChange:e=>I(Me(e))}),s.jsx(fe,{variant:"contained",color:"success",onClick:()=>ps(Ae,"service-ticket.xlsx"),children:"Download Excel"})]}),s.jsxs(We,{children:[s.jsx(Ne,{sx:{height:"55vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(Ye,{stickyHeader:!0,children:[s.jsx(He,{children:s.jsxs(ve,{children:[je.map(e=>s.jsx(j,{sx:oe,children:s.jsx(_s,{active:S===e.id,direction:S===e.id?Y:"asc",onClick:()=>T(e.id),children:e.label})},e.id)),xe&&s.jsx(j,{sx:oe,children:"Action"}),pe&&s.jsx(j,{sx:oe,children:"Job card"})]})}),s.jsx(De,{children:X.map((e,f)=>{var m,r,p,u,L,D,z,J,G;return s.jsxs(ve,{children:[s.jsx(j,{children:e==null?void 0:e.service_record_id}),s.jsx(j,{children:(m=e==null?void 0:e.vehicle)==null?void 0:m.registration_id}),s.jsx(j,{children:e==null?void 0:e.service_type}),s.jsx(j,{children:`${(p=(r=e==null?void 0:e.user)==null?void 0:r.us_user)==null?void 0:p.first_name} ${(L=(u=e==null?void 0:e.user)==null?void 0:u.us_user)==null?void 0:L.last_name}`}),s.jsx(j,{children:`${((z=(D=e==null?void 0:e.technician)==null?void 0:D.us_user)==null?void 0:z.first_name)||""} ${((G=(J=e==null?void 0:e.technician)==null?void 0:J.us_user)==null?void 0:G.last_name)||""}`}),s.jsx(j,{children:e==null?void 0:e.contact_person}),s.jsx(j,{children:e==null?void 0:e.mob_no}),s.jsx(j,{children:(e==null?void 0:e.start_date)&&w(e.start_date).format("YYYY-MM-DD")||"N/A"}),s.jsx(j,{children:(e==null?void 0:e.start_date)&&w(e.start_date).format("HH:mm A")||"N/A"}),s.jsx(j,{sx:{color:e.status==="Open"?"blue":e.status==="Completed"?"green":"red"},children:e.status}),xe&&s.jsxs(j,{style:{display:"flex"},children:[s.jsx(Z,{onClick:()=>Le(e),color:"primary",disabled:(e==null?void 0:e.status.toLowerCase())==="completed","aria-label":"edit record",children:s.jsx(fs,{})}),s.jsx(Z,{onClick:()=>$e(e),"aria-label":"edit record",children:s.jsx(Pe,{})})]}),pe&&s.jsx(j,{children:s.jsx(fe,{variant:"outlined",onClick:()=>{Q(!0),E(e)},disabled:e==null?void 0:e.jobcard,children:"Create job card"})})]},f)})})]})}),s.jsx(ze,{component:"div",count:d.length,page:P,onPageChange:a,rowsPerPage:O,onRowsPerPageChange:i,rowsPerPageOptions:[5,10,15]}),s.jsx(ds,{rowData:t,open:K,handleClose:()=>Q(!1),isTechnician:!0})]}),s.jsx(bs,{open:F,setOpen:B,data:ae}),s.jsx(xs,{open:h,onClose:b,onConfirm:_})]})};function ys(){const[n,h]=Se.useState(!1);ne();const g=()=>h(!0),C=()=>h(!1);return s.jsxs("div",{children:[s.jsx(se,{variant:"outlined",onClick:g,children:"+ Add New Entry"}),s.jsxs(me,{open:n,onClose:C,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[s.jsxs(ye,{children:["+ Add new service entry",s.jsx(Z,{"aria-label":"close",onClick:C,sx:{position:"absolute",right:8,top:8},children:s.jsx(Ge,{})})]}),s.jsx(Ce,{dividers:!0,children:s.jsx(Te,{setOpen:h})})]})]})}function Cs(){const[n]=Ke(),h=n.get("tab"),[g,C]=l.useState(0);l.useEffect(()=>{h&&C(Number(h))},[]);const A=(V,I)=>{C(I)};return s.jsxs($,{sx:{width:"100%"},children:[s.jsx($,{sx:{borderBottom:1,borderColor:"divider"},children:s.jsxs(Qe,{value:g,onChange:A,"aria-label":"Breakdown Tabs",children:[s.jsx(ge,{label:"Service Tickets"}),s.jsx(ge,{label:"Service Job Cards"})]})}),s.jsxs($,{sx:{mt:2},children:[g===0&&s.jsx(ms,{isInspection:!1}),g===1&&s.jsx(us,{isInspection:!1})]})]})}const Ss=()=>{const n=ne();l.useEffect(()=>{n(Xe()),n(Ze()),n(ke())},[]);let h=he("Service");const g=(h==null?void 0:h.includes("Create"))||h==="Read-Write-Only";return s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[s.jsx("div",{style:{margin:"10px"},children:s.jsx("h3",{children:"Service Record"})}),g&&s.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:s.jsx(ys,{})}),"      "]}),s.jsxs("div",{children:[s.jsx("hr",{}),s.jsx("div",{style:{margin:"10px"},children:s.jsx(Cs,{})})]})]})},Ps=Ss;function Ws(){const{locationData:n,selectedVehicle:h,selectedParameterList:g}=q(x=>x.liveMap),{mode:C}=q(x=>x.dashboard),A=ss(C),[V,I]=l.useState([]),{w_customer_id:Y}=q(x=>x.auth),[te,S]=l.useState(),[R,P]=l.useState(!1),[H,O]=l.useState(!1),[k,K]=l.useState([]),[Q,F]=l.useState(!0),[B,t]=l.useState(!1);let E=ne();l.useEffect(()=>{ae()},[]),l.useEffect(()=>{K([]),E(be([{reg_id:"",imei:"",params:[]}]))},[h]);const ae=async()=>{try{t(!0);let x=[],y=[];const T=await E(Be({w_customer_id:Y}));if(Array.isArray(T.payload)){T.payload.forEach(c=>{var _,b,o,d;Array.isArray(c.imei)&&c.imei.length>0&&((_=c.imei[0])!=null&&_.mac_id)?(x.push({id:c.id,label:c.registration_id,value:(b=c.imei[0])==null?void 0:b.mac_id,vehilce_type:c==null?void 0:c.segment,chassis_no:c==null?void 0:c.chassis_no,engine_no:c==null?void 0:c.engine_no,workShop:c==null?void 0:c.workshop,registration_id:c==null?void 0:c.registration_id,sell_date:c==null?void 0:c.sell_date,customer_name:c==null?void 0:c.customer_name,vehicle_model:(o=c==null?void 0:c.vehicle_model)==null?void 0:o.name}),y.push((d=c.imei[0])==null?void 0:d.mac_id)):console.error("IMEI data not found for item:",c)});const a="one",i=y;y.length>0&&E(Ue({type:a,imei:i})),I(x),E(we(x)),t(!1)}else t(!1),console.error("Unexpected data format:",T),N.error("Unexpected data format:")}catch(x){console.error("Error fetching vehicle data:",x),N.error(`Error fetching vehicle data: ${x}`)}},U=async x=>{const{label:y,imei:T,id:a,reg_id:i,checked:c}=x;S(d=>d.map(X=>X.id===a?{...X,checked:!c}:X));let _=[...k],b=[...k];if(!c)n.forEach(d=>{d.latestDocument.imei===T&&(_.push({label:y,value:d.latestDocument[y==="maininputvoltage"?"mainInputVoltage":y]}),b=_,K(_))});else{let d=k.filter(X=>X.label!==y);b=d,K(d)}console.log("tempParamList",b),E(be([{reg_id:i,imei:T,params:b}]))};return s.jsxs("div",{className:"app",children:[s.jsx(es,{}),s.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[s.jsx(vs,{title:"services",setShowVehicles:P,showVehicles:R,showParameters:H,setShowParameters:O,setShowCard:F,showCard:Q}),s.jsxs($,{style:{display:"flex",width:"100%",height:"95vh"},children:[s.jsx($,{style:{width:R||H?"80%":"100%"},children:s.jsx(Ps,{})}),R&&s.jsx($,{style:{width:"20%",backgroundColor:A.grey[100]},children:s.jsx(ts,{vehicleData:V,title:"Inspections",setParameterData:S,loadingVehicle:B,setShowVehicles:P,showVehicles:R,showParameters:H,setShowParameters:O})}),H&&s.jsx($,{style:{width:"20%",backgroundColor:A.grey[100]},children:s.jsx(as,{parametersData:te,setParameterData:S,handleParameterChange:U})})]})]})]})}export{Ws as default};
