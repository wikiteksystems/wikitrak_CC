import{w as T,e as l,j as e,bP as he,bQ as pe,bR as ue,bS as ge,bT as q,bU as d,bV as xe,B as m,T as fe,J as K,C as W,v as B,ck as ae,cl as De,cm as be,cn as _e,R as te,O as J,a9 as me,co as we,V as H,S as Ae,H as Ce,c0 as se,U as Te,aC as ke,D as re,cp as je,ah as Ee,cq as Ie,cr as Oe,a3 as Ne,cs as ie,ct as le,cu as oe,cv as ne,cw as Ve,a4 as Le,a5 as Re,a6 as Me,a8 as $e,aa as Pe,Z as Ge,$ as Fe,a0 as Be,cx as Ye,z as He}from"./index-D-4drXyu.js";import{D as ve,P as Z,V as We,a as ze}from"./DateTimePicker-XEJbKlJr.js";import{u as X,w as Ue}from"./excelUtils-yr6D25ci.js";import{S as R}from"./index-iVrdIYH_.js";import{I as qe}from"./InspectionsTable-ysE0BnFW.js";import{S as Ke}from"./ServiceRecordTable-Dl3H3Xln.js";import"./Loader-DnMkWQ4n.js";import"./BarChart-DqPD6pj3.js";import"./TextField-bMkQvo3V.js";import"./DialogContentText-BUQwXzzv.js";import"./Edit-Ca6gsr85.js";import"./index.esm-Cv8pUgNR.js";import"./formik.esm-C6OwjR5a.js";import"./Autocomplete-DmWtk1bJ.js";import"./Card-CtaXDPgC.js";import"./CardContent-7hKbl_AX.js";function Qe({countAlerts:w}){T(a=>a.dashboard),T(a=>a.report);const{driver_behavior_data:g,multipleVehicleReportsData:o}=T(a=>a.dashboard);T(a=>a.liveMap),l.useEffect(()=>{},[o,g]);let k=o.reduce((a,n)=>{var v;return a+=parseFloat((v=n==null?void 0:n.data)==null?void 0:v.totalDistance_)||0},0),p=o.reduce((a,n)=>{var v;return a+=parseFloat((v=n==null?void 0:n.data)==null?void 0:v.runningTime_)||0},0),I=o.reduce((a,n)=>{var v;return a+=parseFloat((v=n==null?void 0:n.data)==null?void 0:v.averageSpeed_)||0},0),t=g.reduce((a,n)=>a+=parseFloat(n.steadyTime),0),u=g.reduce((a,n)=>a+=parseFloat(n.overSpeedTime),0);const i=a=>{const n=Math.floor(a/3600),v=Math.floor(a%3600/60);return(a%60).toFixed(0),`${n}.${v}`},b=[{category:"Driving Metrics",metric:"Km Driven",value:(o==null?void 0:o.length)>0?`${parseFloat(k).toFixed(2)} km`:"0 km"},{category:"Driving Metrics",metric:"Hrs Driven",value:`${parseFloat(i(p)).toFixed(2)} hrs`},{category:"Driving Metrics",metric:"Idle Time",value:g&&t&&!isNaN(t)?`${i(t)} hrs`:"0 hrs"},{category:"Driving Metrics",metric:"Overspeed Time",value:g&&u&&!isNaN(u)?i(u):"0 hrs  "},{category:"Driving Metrics",metric:"Avg. Speed",value:(o==null?void 0:o.length)>0?`${(I/o.length).toFixed(2)} km/h`:"0 km/h"},{category:"Alerts",metric:"Outward Alerts",value:w.outward},{category:"Alerts",metric:"Inward Alerts",value:w.inward},{category:"Alerts",metric:"Speed Alerts",value:w.speed}],j=b.filter(a=>a.category==="Driving Metrics"),_=b.filter(a=>a.category==="Alerts");return e.jsx(he,{component:pe,sx:{maxWidth:800,margin:"auto",mt:"20px"},children:e.jsxs(ue,{children:[e.jsx(ge,{children:e.jsxs(q,{children:[e.jsx(d,{sx:{fontWeight:"bold",textAlign:"center",backgroundColor:"primary.light",color:"white"},colSpan:2,children:"Driving Metrics"}),e.jsx(d,{sx:{fontWeight:"bold",textAlign:"center",backgroundColor:"primary.light",color:"white"},colSpan:2,children:"Alerts"})]})}),e.jsx(xe,{children:j.map((a,n)=>e.jsxs(q,{children:[e.jsx(d,{children:a.metric}),e.jsx(d,{sx:{textAlign:"right"},children:a.value}),_[n]?e.jsxs(e.Fragment,{children:[e.jsx(d,{children:_[n].metric}),e.jsx(d,{sx:{textAlign:"right"},children:_[n].value})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{}),e.jsx(d,{})]})]},n))})]})})}function Q({handleBack:w,downloadData:g}){l.useEffect(()=>{},[g]);const o=()=>{if(g.length===0){W.error("No data available for download.");return}const k=X.json_to_sheet(g),p=X.book_new();X.book_append_sheet(p,k,"Sheet1"),Ue(p,"Report.xlsx"),W.success("Excel file downloaded successfully!")};return e.jsx(m,{sx:{backgroundColor:"white",mb:2,display:"flex",textAlign:"center",justifyContent:"end",alignItems:"center",padding:"10px 20px",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(fe,{sx:{fontWeight:"bold",mr:1},children:"Download In:"}),e.jsx(K,{variant:"outlined",onClick:o,sx:{borderColor:"green",color:"green","&:hover":{backgroundColor:"green",color:"white"}},children:"EXCEL"})]})})}const Je=w=>{const g=Math.floor(w/3600),o=Math.floor(w%3600/60);return(w%60).toFixed(0),`${g}.${o}`},ce={outward:0,inward:0,speed:0};function Xe({handleBack:w,setStartDate:g,startDate:o,setEndDate:k,endDate:p}){const{alerts:I,allAlerts:t}=T(r=>r.report),{driver_behavior:u,driver_behavior_data:i,multipleVehicleReportsData:b}=T(r=>r.dashboard);T(r=>r.report);const{vehicleGroup:j,vehicleList:_}=T(r=>r.liveMap),[a,n]=l.useState(ce),[v,A]=l.useState([]),[x,f]=l.useState([]),[S,V]=l.useState([]),[y,N]=l.useState("All"),[O,c]=l.useState(null),[s,E]=l.useState(!1),$=B();l.useEffect(()=>{const r={...ce};t.forEach(D=>{D.type==="Geofence Alert"?D.geofance_type==="inward"?r.inward+=1:D.geofance_type==="outward"&&(r.outward+=1):D.type==="Speed Alert"&&(r.speed+=1)}),n(r);const h=[{name:"Outward Alerts",value:r.outward},{name:"Inward Alerts",value:r.inward},{name:"Speed Alerts",value:r.speed}];f(h)},[t]),l.useEffect(()=>{if(j&&j.length>0){let r=j.map(h=>({...h,label:h.group_name,value:h.id}));V(r)}},[j,_]);const Y=r=>{let h=_.find(D=>{var M;return((M=D==null?void 0:D.imei[0])==null?void 0:M.mac_id)==r});return(h==null?void 0:h.registration_id)||r},P=(r,h,D)=>{console.log("data1",r),console.log("data2",h),console.log("data3",D);let M=r.map(C=>{var ee;let ye=(ee=h.find(F=>F.imei===C.imei))==null?void 0:ee.data;const U={outward:0,inward:0,speed:0};return D.forEach(F=>{F.imei===C.imei&&(F.type==="Geofence Alert"?F.geofance_type==="inward"?U.inward+=1:F.geofance_type==="outward"&&(U.outward+=1):F.type==="Speed Alert"&&(U.speed+=1))}),{...C,...ye,...U}});console.log("vehicle report data",M);let Se=M.map(C=>({"Vehicle Name":Y(C.imei),"IMEI NO":C.imei,"KM Driven":C.totalDistance,"Hrs Driven":C.runningTime,"Idel Time":C!=null&&C.steadyTime&&!isNaN(C==null?void 0:C.steadyTime)?`${Je(C==null?void 0:C.steadyTime)} hrs`:"0 hrs","Over speed time":C.overSpeedTime,"Avg speed":C.averageSpeed,"Outward alert":C.outward,"Inward alert":C.inward,"Speed alert":C.speed}));A(Se)};l.useEffect(()=>{i.length>0&&ae.length>0&&P(i,b,t)},[i,b,t]);function G(r){console.log("value changed",r),N(r)}const z=async()=>{E(!0);try{const r=$(ae({imei:O,startDate:o,endDate:p})),h=$(be({imei:O,startDate:o,endDate:p})),D=$(_e({imeiList:O,startDate:o,endDate:p}));await Promise.all([r,h,D]),E(!1),console.log("Report fetched successfully.")}catch(r){E(!1),console.error("Error fetching report:",r),W.error("An error occurred while fetching the report.")}},L=y==="All"?_:_.filter(r=>r.vehicle_group===y);return e.jsxs(m,{sx:{width:"100%",padding:"10px"},children:[s&&e.jsx(De,{}),e.jsx(Q,{handleBack:w,downloadData:v}),e.jsxs(m,{children:[e.jsxs(R,{size:"large",value:y,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:G,filterOption:(r,h)=>{var D;return typeof((D=h==null?void 0:h.props)==null?void 0:D.children)=="string"&&h.props.children.toLowerCase().indexOf(r.toLowerCase())>=0},children:[e.jsx(R.Option,{value:"All",children:"All"}),S.map((r,h)=>e.jsx(R.Option,{value:r.value,children:r.label},h))]}),e.jsxs(R,{size:"large",mode:"multiple",showSearch:!0,value:O||[],style:{width:300,margin:"10px"},placeholder:"Select vehicles",maxTagCount:1,maxTagPlaceholder:r=>`+${r.length} more`,optionFilterProp:"children",onChange:r=>{r.includes("all")?(O==null?void 0:O.length)===L.length?c([]):c(L.map(h=>{var D;return(D=h.imei[0])==null?void 0:D.mac_id})):c(r)},filterOption:(r,h)=>{var D,M;return(M=(D=h==null?void 0:h.children)==null?void 0:D.toLowerCase())==null?void 0:M.includes(r.toLowerCase())},children:[e.jsx(R.Option,{value:"all",children:"Select All Vehicles"},"all"),L&&L.length>0&&L.map((r,h)=>{var D;return e.jsx(R.Option,{value:(D=r.imei[0])==null?void 0:D.mac_id,children:r.registration_id},h)})]}),e.jsx(ve,{setStartDate:g,setEndDate:k,selectedDate:!1}),e.jsx(K,{variant:"contained",style:{width:200,marginLeft:"10px"},onClick:z,disabled:!O,children:"Generate report"})]}),e.jsxs(m,{sx:{display:"flex",gap:"10px"},children:[e.jsx(m,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(Z,{chartData:x,title:"Alerts Distribution"})}),e.jsxs(m,{sx:{width:"60%",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(fe,{variant:"h6",sx:{fontWeight:600,textAlign:"center",m:"0 30px"}}),e.jsx(We,{})]})]}),e.jsx(Qe,{countAlerts:a})]})}const de={vehicleNo:"B35965",type:"Sprayer",operator:"Arjun",inspectionDate:"15/09/24",status:"Open",partsFailure:"Oil Pump, Filter",submittedBy:"Yograj"};function Ze({handleBack:w}){const{inspectionHistory:g}=T(x=>x.inspection),{breakdowns:o}=T(x=>x.breakdown),{w_customer_id:k}=T(x=>x.auth),[p,I]=l.useState([]),[t,u]=l.useState([]),[i,b]=l.useState({});l.useState(de);const[j,_]=te.useState(),[a,n]=te.useState();let v=B();l.useEffect(()=>{v(J()),v(me(k)),v(we())},[]),l.useEffect(()=>{if(g.length>0){let x={open:0,rejected:0,close:0};({...de},g.map(f=>{f.status==="Open"&&(f!=null&&f.breakdown)&&x.open++,f.status==="Close"&&(f!=null&&f.breakdown)&&x.close++,f.status==="Rejected"&&(f!=null&&f.breakdown)&&x.rejected++})),b(x)}},[g]),l.useEffect(()=>{const x=[{name:"Rejected",value:i.rejected},{name:"Pending",value:i.open},{name:"Approved",value:i.close}];u(x)},[i]),l.useEffect(()=>{let x=[];if(console.log("inspection history",g),g.forEach(f=>{var Y,P,G,z;const{breakdown:S,inspection_parts_inspection:V,status:y,submitted_by:N,resolved_issue:O,pending_issue:c,vehicle:s}=f;console.log("breakdown",S);const E=V&&V.length>0?V.map((L,r)=>{var h;return`${(h=L==null?void 0:L.spare_parts)==null?void 0:h.description}: Qty ${L==null?void 0:L.quantity}`}).join("; "):"N/A";let $={Vehicle:s==null?void 0:s.registration_id,BDID:(S==null?void 0:S.breakdown_id)||"","Breakdown Topic":(Y=S==null?void 0:S.breakdown_topic)==null?void 0:Y.topic,"Resolved issue":O,"Pending issue":c,"Spare Parts":E,user:`${((P=N==null?void 0:N.us_user)==null?void 0:P.first_name)||""} ${((G=N==null?void 0:N.us_user)==null?void 0:G.last_name)||""}`,"Submission Date":(S==null?void 0:S.submission_date)&&H.utc(S==null?void 0:S.submission_date).local().format("YYYY-MM-DD")||"N/A","Submission Time":(S==null?void 0:S.submission_date)&&H.utc(S==null?void 0:S.submission_date).local().format("HH:mm A")||"N/A",workshop:((z=f==null?void 0:f.workshop_group)==null?void 0:z.group_name)||"",status:y};x.push($)}),Object.keys(i).length>0){let f={BDID:"Inspection Status",user:"","Submission Date":"",workshop:`Rejected: ${i.rejected||0}, Pending: ${i.open||0}, Approved: ${i.close||0}`};x.push(f)}I(x)},[o,i]);const A=()=>{if(j&&a){let x={startDate:H(new Date(j)).format("YYYY-MM-DD"),endDate:H(new Date(a)).format("YYYY-MM-DD")};v(J(x))}else v(J())};return e.jsxs(m,{sx:{width:"100%",m:"auto"},children:[e.jsx(Q,{handleBack:w,downloadData:p}),e.jsxs(m,{sx:{display:"flex",m:"10px"},children:[e.jsx(ze,{setStartDate:_,setEndDate:n,selectedDate:!1}),e.jsx(K,{sx:{ml:"20px",background:"rgb(141, 166, 198)",color:"white"},onClick:()=>A(),children:"Apply"})]}),e.jsxs(m,{sx:{display:"flex",gap:"40px"},children:[e.jsx(qe,{where:"inspection report"}),e.jsx(m,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(Z,{chartData:t,title:"Inspection Status"})})]})]})}function ea({handleBack:w}){const{overdueCount:g,completedCount:o,serviceSoonCount:k}=T(j=>j.dashboard),{servicesData:p}=T(j=>j.services),[I,t]=l.useState([]),[u,i]=l.useState([]);let b=B();return l.useEffect(()=>{b(Ae())},[]),l.useEffect(()=>{i([{name:"Over Due",value:g},{name:"Due Soon",value:k},{name:"Serviced",value:o}])},[g,k,o]),l.useEffect(()=>{console.log("servicesData",p);let j=[];p.forEach(a=>{var v,A,x,f,S,V,y,N;let n={SRID:a==null?void 0:a.service_record_id,Vehicle:((v=a==null?void 0:a.vehicle)==null?void 0:v.registration_id)||"",user:`${((x=(A=a==null?void 0:a.user)==null?void 0:A.us_user)==null?void 0:x.first_name)||""} ${((S=(f=a==null?void 0:a.user)==null?void 0:f.us_user)==null?void 0:S.last_name)||""}`,Vehicle_group:((y=(V=a==null?void 0:a.vehicle)==null?void 0:V.vehicle_group)==null?void 0:y.group_name)||"",Priority_Class:(a==null?void 0:a.priority_class)||"","Entry Date":H(new Date(a==null?void 0:a.created)).format("DD-MM-YYYY"),"Entry Time":H(new Date(a==null?void 0:a.created)).format("HH:mm A"),Completion_Date:(a==null?void 0:a.completion_date)||"",Next_Due_Date:(a==null?void 0:a.next_due_date)||"",Segment:((N=a==null?void 0:a.segment)==null?void 0:N.segment_name)||"",status:a==null?void 0:a.status};j.push(n)});let _={Vehicle:"Service Status",user:"",Priority_Class:"",Completion_Date:`Over Due: ${g||0}, Due Soon: ${k||0}, Serviced: ${o||0}`};j.push(_),t(j)},[p,o]),e.jsxs(m,{sx:{width:"100%",m:"auto"},children:[e.jsx(m,{sx:{ml:"10px"},children:e.jsx(Q,{handleBack:w,downloadData:I})}),e.jsx(Ke,{where:"service report"}),e.jsx(m,{sx:{display:"flex",gap:"40px",justifyContent:"center",paddingBottom:"50px"},children:e.jsx(m,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(Z,{chartData:u,title:"Service Status"})})})]})}function aa({tableData:w}){const{vehicleList:g}=T(t=>t.liveMap),o=B(),k=Ce();console.log("tableData: ",w);let p=t=>g.find(u=>{var i;return((i=u==null?void 0:u.imei[0])==null?void 0:i.mac_id)==t||""});const I=t=>{var u;o(Te({imei:t==null?void 0:t.imei,reg_id:(u=p(t.imei))==null?void 0:u.registration_id})),o(ke({startDate:re(t.date).startOf("day").toISOString(),endDate:re(t.date).endOf("day").toISOString()})),k("/trip-monitor?source=TripDetail")};return e.jsx(he,{component:pe,sx:{maxHeight:"70vh"},children:e.jsxs(ue,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ge,{children:e.jsxs(q,{children:[e.jsx(d,{align:"left",children:"Date"}),e.jsx(d,{align:"left",children:"Vehicle Name"}),e.jsx(d,{align:"left",children:"Start location"}),e.jsx(d,{align:"left",children:"End location"}),e.jsx(d,{align:"left",children:"Segment"}),e.jsx(d,{align:"left",children:"Operator"}),e.jsx(d,{align:"left",children:"Work done (acre)"}),e.jsx(d,{align:"left",children:"Engine hours"}),e.jsx(d,{align:"left",children:"Running Time"}),e.jsx(d,{align:"left",children:"Idle time"}),e.jsx(d,{align:"left",children:"Total Distance (km)"}),e.jsx(d,{align:"left",children:"Average Speed"}),e.jsx(d,{align:"left",children:"View Trips"})]})}),e.jsx(xe,{children:w.map((t,u)=>{var i,b,j,_,a,n,v;return e.jsxs(q,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(d,{align:"left",children:t.date}),e.jsx(d,{align:"left",children:(i=p(t.imei))==null?void 0:i.registration_id}),e.jsx(d,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(se,{title:((b=t==null?void 0:t.startLocationName)==null?void 0:b.display_name)||(t==null?void 0:t.startLocationName)||"",children:e.jsx("span",{children:((j=t==null?void 0:t.startLocationName)==null?void 0:j.display_name)||(t==null?void 0:t.startLocationName)||""})})}),e.jsx(d,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(se,{title:((_=t==null?void 0:t.endLocationName)==null?void 0:_.display_name)||(t==null?void 0:t.endLocationName)||"",children:e.jsx("span",{children:((a=t==null?void 0:t.endLocationName)==null?void 0:a.display_name)||(t==null?void 0:t.endLocationName)||""})})}),e.jsx(d,{align:"left",children:(n=p(t.imei))==null?void 0:n.segment}),e.jsx(d,{align:"left",children:(v=p(t.imei))==null?void 0:v.customer_name}),e.jsx(d,{align:"left",children:t.acreageStr}),e.jsx(d,{align:"left",children:t.engineHours}),e.jsx(d,{align:"left",children:t.runningTime}),e.jsx(d,{align:"left",children:t.idleTime}),e.jsx(d,{align:"left",children:t.totalDistance}),e.jsx(d,{align:"left",children:t.averageSpeed}),e.jsx(d,{align:"left",children:e.jsx(m,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>I(t),children:"View on Map ðŸ”"})})]},u+1)})})]})})}function ta({handleBack:w,setStartDate:g,startDate:o,setEndDate:k,endDate:p}){const I=B(),{vehicleGroup:t,vehicleList:u}=T(c=>c.liveMap),{vehicleStatesData:i,loading:b,selectedGroup:j,selectedVehicle:_,distributorList:a}=T(c=>c.report),[n,v]=l.useState([]);l.useState([]);const[A,x]=l.useState([]);l.useEffect(()=>{},[b]),l.useEffect(()=>{if(t&&t.length>0){let c=t.map(s=>({...s,label:s.group_name,value:s.id}));v(c)}},[t,u,a]),l.useEffect(()=>{},[o,p]);let f=c=>u.find(s=>{var E;return((E=s==null?void 0:s.imei[0])==null?void 0:E.mac_id)==c||""});l.useEffect(()=>{let c=(i==null?void 0:i.data)&&i.data.map(s=>{var P,G;let{customer_name:E,registration_id:$,segment:Y}=f(s==null?void 0:s.imei);return{Date:s.date,vehicle:$,"Start Location":(P=s==null?void 0:s.startLocationName)==null?void 0:P.display_name,"End Location":(G=s==null?void 0:s.endLocationName)==null?void 0:G.display_name,operator:E,segment:Y,"Work Done":s==null?void 0:s.acreageStr,"Running Time":s.runningTime,"Idle Time":s.idleTime,"Engine hours":s.engineHours,"Total Distance (km)":s.totalDistance,"Average Speed":s.averageSpeed}});x(c)},[i]),l.useEffect(()=>{_||I(je())},[]);function S(c){console.log("value changed",c),I(Ie(c))}function V(c){I(Oe(c))}const y=async()=>{const c=`${o} 00:00`,s=`${p} 23:59`;if(!N())return;I(Ne({imei:_,startTime:c,endTime:s}))},N=()=>!o||!p||_==="all"?(W.error("Please select start date, end date, and vehicle."),!1):!0,O=j==="All"?u:u.filter(c=>c.vehicle_group===j);return e.jsxs(m,{sx:{width:"100%",m:"auto"},children:[e.jsx(m,{sx:{ml:"10px"},children:e.jsx(Q,{handleBack:w,downloadData:A})}),e.jsxs(m,{children:[e.jsxs(R,{size:"large",value:j,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:S,filterOption:(c,s)=>{var E;return typeof((E=s==null?void 0:s.props)==null?void 0:E.children)=="string"&&s.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(R.Option,{value:"All",children:"All"}),n.map((c,s)=>e.jsx(R.Option,{value:c.value,children:c.label},s))]}),e.jsxs(R,{size:"large",value:_,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:V,filterOption:(c,s)=>{var E;return typeof((E=s==null?void 0:s.props)==null?void 0:E.children)=="string"&&s.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(R.Option,{value:"all",children:"None"},"all"),O&&O.length>0&&O.map((c,s)=>{var E;return e.jsx(R.Option,{value:(E=c.imei[0])==null?void 0:E.mac_id,children:c.registration_id},s)})]}),e.jsx(ve,{setStartDate:g,setEndDate:k,selectedDate:!1,startDate:o,endDate:p}),e.jsx(K,{variant:"contained",style:{width:200,marginLeft:"10px"},onClick:y,disabled:!_,children:"Generate report"})]}),b&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(Ee,{})}),(i==null?void 0:i.data)&&(i==null?void 0:i.data.length)>0&&e.jsx(m,{ml:1.5,children:e.jsx(aa,{tableData:(i==null?void 0:i.data)||[]})})]})}function sa({showCard:w,setReportType:g,reportType:o}){T(b=>b.dashboard),T(b=>b.liveMap);const{startDate:k,endDate:p}=T(b=>b.report),[I,t]=l.useState(!0);l.useState({}),l.useState(!1);let u=B();l.useEffect(()=>{},[p]),l.useEffect(()=>{u(ie()),u(le())},[]);const i=()=>{u(je()),u(ie()),u(le()),u(g(null))};return e.jsx(e.Fragment,{children:e.jsx(m,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignItems:"center",gap:2,padding:2},children:o==="Vehicle"?e.jsx(Xe,{handleBack:i,selectedDate:I,setEndDate:oe,setStartDate:ne,startDate:k,endDate:p}):o==="Service"?e.jsx(ea,{handleBack:i}):o==="Inspection"?e.jsx(Ze,{handleBack:i}):e.jsx(ta,{handleBack:i,selectedDate:I,setEndDate:oe,setStartDate:ne,startDate:k,endDate:p})})})}function ya(){const{mode:w,showVehicles:g,selectedVehicleGroup:o}=T(A=>A.dashboard),{w_customer_id:k}=T(A=>A.auth),{reportType:p}=T(A=>A.report),[I,t]=l.useState([]),[u,i]=l.useState(!0),[b,j]=l.useState(!1),_=He(w);let a=B();l.useEffect(()=>{v(),n()},[]);const n=()=>{a(Ve())},v=async()=>{try{let A=[],x=[];const f=await a(Le({w_customer_id:k}));if(Array.isArray(f.payload)){f.payload.forEach(y=>{var N,O;Array.isArray(y.imei)&&y.imei.length>0?(A.push({id:y.id,label:y.registration_id,value:(N=y==null?void 0:y.imei[0])==null?void 0:N.mac_id,workShop:y==null?void 0:y.workshop,vehicle_group:y==null?void 0:y.vehicle_group}),x.push((O=y.imei[0])==null?void 0:O.mac_id)):console.error("IMEI data not found for item:",y)});const S="one",V=x;x.length>0&&(a(Re({type:S,imei:V})),a(Me(V))),t(A),a($e({w_customer_id:k})),a(Pe({}))}else console.error("Unexpected data format:",f),W.error("Unexpected data format:")}catch(A){console.error("Error fetching vehicle data:",A),W.error(`Error fetching vehicle data: ${A}`)}};return I.filter(A=>Object.keys(o).length===0||A.vehicle_group===o.id),e.jsxs("div",{className:"app",children:[e.jsx(Ge,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:_.grey[100]},children:[e.jsx(Fe,{title:"Report",setShowVehiclesGroup:j,showVehiclesGroup:b,reportType:p}),e.jsx(Be,{setShowVehiclesGroup:j,showVehiclesGroup:b}),e.jsxs(m,{style:{display:"flex",width:"100%",height:"95vh",background:_.grey[200]},children:[e.jsx(m,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(m,{style:{width:"100%"},children:e.jsx(sa,{showCard:u,setReportType:Ye,reportType:p})})}),!1]})]})]})}export{ya as default};
