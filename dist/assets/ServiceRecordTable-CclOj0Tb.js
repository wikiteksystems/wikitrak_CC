import{c as qe,j as e,ak as ve,al as be,T as ne,q as B,ag as Te,am as me,an as Pe,J as R,w as $,v as oe,cZ as le,c_ as Fe,c$ as Le,d0 as Ve,d1 as $e,B as ee,cl as Ae,c7 as o,e as g,eG as Re,eH as Oe,eI as Ie,C as te,S as je,ah as We,R as Me,cW as Be,V as w,cX as he,M as Ee,bF as _e,bQ as Ne,bP as He,bR as Ye,bS as Je,bT as xe,bU as y,bV as ze,cK as Ge}from"./index-Diq4l7Dq.js";import{c as ge,a as F,d as Qe,f as ce,e as Ke}from"./index.esm-CF2jjTSD.js";import{u as fe}from"./formik.esm-BYLq67Ll.js";import{T as x}from"./TextField-qTbTcyyL.js";import{A as K}from"./Autocomplete-DEa_thwn.js";import{R as ye,A as Ce,D as Se,T as Xe,d as Ze}from"./excelUtils-KMgkXs86.js";import{T as ke,E as Ue}from"./Edit-DxPNcG24.js";const De=qe(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),we=["Approved","Rejected","Open","On Hold"],es=["Open","Close","Rejected"],ss=({open:t,handleClose:b,updateData:L,rowData:E,isTechnician:f,isInspection:S})=>e.jsxs(ve,{open:t,onClose:b,maxWidth:"xl",fullWidth:!0,children:[e.jsxs(be,{sx:{m:0,p:2},children:[e.jsx(ne,{variant:"h6",children:"Vehicle Service Job Card"}),e.jsx(B,{"aria-label":"close",onClick:b,sx:{position:"absolute",right:8,top:8,color:O=>O.palette.grey[500]},children:e.jsx(Te,{})})]}),e.jsx(me,{dividers:!0,children:e.jsx(rs,{updateData:L,onClose:b,rowData:E,isTechnician:f,isInspection:S})}),e.jsx(Pe,{children:e.jsx(R,{onClick:b,color:"secondary",variant:"outlined",children:"Close"})})]}),rs=({updateData:t,rowData:b,onClose:L,isTechnician:E,isInspection:f})=>{var X,W,k,i,U,D;const{loading:S}=$(c=>c.breakdown),O=oe();$(c=>c.liveMap);const{w_customer_id:I}=$(c=>c.auth),{sparePartList:N}=$(c=>c.inspection),{id:A,vehicle:m,service_type:H}=b||{};let Z=(t?t==null?void 0:t.jobcard_parts:b==null?void 0:b.service_parts).map(c=>{var u;return{spare_parts:(u=c==null?void 0:c.spare_parts)==null?void 0:u.id,quantity:c==null?void 0:c.quantity}});const se=ge({vehicle:F().required("Vehicle is required"),chassis_no:F().required("Chassis No is required"),engine_no:F().required("Engine No is required"),hmr:Qe().required("Working Hrs is required").positive("Must be positive").integer("Must be an integer"),submission_date:ce().required("Date is required"),technician_observation:F().required("Technician Observations are required"),status:F().required("Status is required"),service_status:F().required("Status is required"),approval_date:f&&ce().required("Approval Date is required")}),r=fe({initialValues:{vehicle:((X=t==null?void 0:t.vehicle)==null?void 0:X.id)||(m==null?void 0:m.id)||"",service:((W=t==null?void 0:t.service)==null?void 0:W.id)||A||"",chassis_no:(t==null?void 0:t.chassis_no)||(m==null?void 0:m.chassis_no),engine_no:(t==null?void 0:t.engine_no)||(m==null?void 0:m.engine_no),hmr:(t==null?void 0:t.hmr)||"",service_type:(t==null?void 0:t.service_type)||H,submission_date:(t==null?void 0:t.submission_date)||le(new Date),completion_date:(t==null?void 0:t.completion_date)||"",technician_observation:(t==null?void 0:t.technician_observation)||"",jobcard_parts:Z||[],status:(t==null?void 0:t.status)||"Open",service_status:(t==null?void 0:t.service_status)||"Open",issued_attachment:(t==null?void 0:t.issued_attachment)||null,submitted_by:(t==null?void 0:t.submitted_by.id)||I,type:"ServiceRecord",approval_date:(t==null?void 0:t.approval_date)||"",reviewed_by:((k=t==null?void 0:t.reviewed_by)==null?void 0:k.id)||(f?I:"")},validationSchema:se,onSubmit:async c=>{var T,n;const u=new FormData;for(const l in r.values)if(l==="issued_attachment"){const d=r.values[l];d instanceof File?u.append("issued_attachment",d):typeof d=="string"&&u.append("issued_attachment_url",d)}else u.append(l,r.values[l]);let p;if(t?(console.log(t,c),p=await O(Fe({formData:u,id:t==null?void 0:t.id}))):p=await O(Le(u)),p!=null&&p.payload){console.log("api response",(T=p==null?void 0:p.payload)==null?void 0:T.data);const{id:l}=(n=p==null?void 0:p.payload)==null?void 0:n.data,{jobcard_parts:d}=c;O(Ve({jobcard:l,parts:d})),L(),O($e({job_card_type:"ServiceRecord",isInspection:f}))}}});return e.jsxs(ee,{sx:{padding:"15px"},children:[S&&e.jsx(Ae,{}),e.jsx("form",{onSubmit:r.handleSubmit,children:e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{label:"Vehicle*",fullWidth:!0,name:"vehicle",value:((i=t==null?void 0:t.vehicle)==null?void 0:i.registration_id)||(m==null?void 0:m.registration_id),onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.vehicle&&!!r.errors.vehicle,helperText:r.touched.vehicle&&r.errors.vehicle,disabled:!0})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{label:"Chassis No*",fullWidth:!0,name:"chassis_no",value:r.values.chassis_no,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.chassis_no&&!!r.errors.chassis_no,helperText:r.touched.chassis_no&&r.errors.chassis_no,disabled:!0})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{label:"Engine No*",fullWidth:!0,name:"engine_no",value:r.values.engine_no,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.engine_no&&!!r.errors.engine_no,helperText:r.touched.engine_no&&r.errors.engine_no,disabled:!0})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(K,{options:[],getOptionLabel:c=>c,value:r.values.service_type,onChange:(c,u)=>r.setFieldValue("service_type",u||""),disabled:!0,renderInput:c=>e.jsx(x,{...c,label:"Service Type",error:r.touched.service_type&&!!r.errors.service_type,helperText:r.touched.service_type&&r.errors.service_type})})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{label:"HMR*",fullWidth:!0,type:"number",name:"hmr",value:r.values.hmr,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.hmr&&!!r.errors.hmr,helperText:r.touched.hmr&&r.errors.hmr,disabled:f})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{label:"Date",name:"submission_date",type:"datetime-local",value:r.values.submission_date,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.submission_date&&!!r.errors.submission_date,helperText:r.touched.submission_date&&r.errors.submission_date,fullWidth:!0,InputLabelProps:{shrink:!0},disabled:!0})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{label:"Completion Date",name:"completion_date",type:"datetime-local",value:r.values.completion_date,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.completion_date&&!!r.errors.completion_date,helperText:r.touched.completion_date&&r.errors.completion_date,fullWidth:!0,InputLabelProps:{shrink:!0},disabled:!0})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{label:"Technician Observations*",fullWidth:!0,name:"technician_observation",value:r.values.technician_observation,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.technician_observation&&!!r.errors.technician_observation,helperText:r.touched.technician_observation&&r.errors.technician_observation,disabled:f})}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(ne,{variant:"h6",gutterBottom:!0,children:"Parts Requirement*(If any information available)"}),(D=(U=r==null?void 0:r.values)==null?void 0:U.jobcard_parts)==null?void 0:D.map((c,u)=>{var n;const p=(n=r.values)==null?void 0:n.jobcard_parts.map(l=>l.spare_parts).filter((l,d)=>d!==u),T=N.filter(l=>!p.includes(l.id));return e.jsxs(o,{container:!0,spacing:2,marginTop:"0px",alignItems:"center",children:[e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(K,{options:T,getOptionLabel:l=>l.description,value:N.find(l=>l.id===c.spare_parts)||null,onChange:(l,d)=>r.setFieldValue(`jobcard_parts[${u}].spare_parts`,(d==null?void 0:d.id)||""),renderInput:l=>e.jsx(x,{...l,label:"Spare Part",fullWidth:!0})})}),e.jsx(o,{item:!0,xs:8,md:4,children:e.jsxs(ee,{display:"flex",alignItems:"center",children:[e.jsx(B,{onClick:()=>r.setFieldValue(`jobcard_parts[${u}].quantity`,Math.max(1,c.quantity-1)),children:e.jsx(ye,{})}),e.jsx(x,{value:c.quantity,type:"number",inputProps:{min:1},onChange:l=>r.setFieldValue(`jobcard_parts[${u}].quantity`,parseInt(l.target.value,10)),sx:{width:90,mx:1,textAlign:"center"}}),e.jsx(B,{onClick:()=>r.setFieldValue(`jobcard_parts[${u}].quantity`,c.quantity+1),children:e.jsx(Ce,{})})]})}),e.jsx(o,{item:!0,xs:4,md:2,children:e.jsx(B,{color:"error",onClick:()=>{var d;const l=[...(d=r.values)==null?void 0:d.jobcard_parts];l.splice(u,1),r.setFieldValue("jobcard_parts",l)},children:e.jsx(Se,{})})})]},u)}),e.jsx(R,{variant:"outlined",onClick:()=>{var p,T,n;const c=(T=(p=r.values)==null?void 0:p.jobcard_parts)==null?void 0:T.map(l=>l.spare_parts);if(N.filter(l=>!(c!=null&&c.includes(l.id))).length===0){toast.error("All available spare parts have already been added.");return}r.setFieldValue("jobcard_parts",[...(n=r.values)==null?void 0:n.jobcard_parts,{spare_parts:"",quantity:1}])},sx:{mt:2},children:"+ Add Spare Part"})]}),e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{label:"Approval Date",name:"approval_date",type:"datetime-local",value:r.values.approval_date,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.approval_date&&!!r.errors.approval_date,helperText:r.touched.approval_date&&r.errors.approval_date,fullWidth:!0,InputLabelProps:{shrink:!0},disabled:!0})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(K,{options:we,value:r.values.service_status,onChange:(c,u)=>{r.setFieldValue("service_status",u||""),r.setFieldValue("approval_date",le(new Date))},disabled:!f,renderInput:c=>e.jsx(x,{...c,label:"Approval Status by Service Engineer*",error:r.touched.service_status&&!!r.errors.service_status,helperText:r.touched.service_status&&r.errors.service_status})})}),!f&&e.jsx(o,{item:!0,xs:6,children:e.jsx(K,{options:es,value:r.values.status,onChange:(c,u)=>{r.setFieldValue("status",u||""),r.setFieldValue("completion_date",le(new Date))},disabled:r.values.service_status!=="Approved",renderInput:c=>e.jsx(x,{...c,label:"Technician Status"})})}),e.jsxs(o,{item:!0,xs:6,children:[!f&&e.jsxs(R,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload File",e.jsx("input",{type:"file",hidden:!0,onChange:c=>{const u=c.currentTarget.files[0];u&&r.setFieldValue("issued_attachment",u)}})]}),r.values.issued_attachment&&e.jsxs(o,{container:!0,spacing:1,mt:1,alignItems:"center",children:[e.jsx(o,{item:!0,children:e.jsxs(ne,{variant:"body2",children:[e.jsx("b",{children:"Attachment:"})," ",typeof r.values.issued_attachment=="string"?r.values.issued_attachment.split("/").pop():r.values.issued_attachment.name]})}),e.jsx(o,{item:!0,children:e.jsx(R,{size:"small",variant:"text",onClick:()=>{const c=typeof r.values.issued_attachment=="string"?r.values.issued_attachment:URL.createObjectURL(r.values.issued_attachment);window.open(c,"_blank")},children:"View File"})})]})]}),e.jsx(o,{item:!0,xs:12,children:e.jsx(R,{type:"submit",variant:"contained",fullWidth:!0,color:"primary",children:t?"Update":"Submit"})})]})})]})},ts=({UpdatedBreakdownData:t,setOpen:b})=>{var c,u,p,T;const{w_customer_id:L}=$(n=>n.auth),[E,f]=g.useState(null),{vehicleList:S}=$(n=>n.liveMap),{vendorList:O,segMentList:I,loading:N}=$(n=>n.services),{technicianList:A}=$(n=>n.breakdown),{sparePartList:m}=$(n=>n.inspection),H=oe(),[ie,Z]=g.useState([]),[se,r]=g.useState([]),[X,W]=g.useState(!1);g.useState(null),console.log("update service data",t),g.useEffect(()=>{},[A]);let k=t==null?void 0:t.service_parts.map(n=>{var l;return{spare_parts:(l=n==null?void 0:n.spare_parts)==null?void 0:l.id,quantity:n==null?void 0:n.quantity}});const i=fe({initialValues:{start_date:(t==null?void 0:t.start_date)||le(new Date),vehicle:((c=t==null?void 0:t.vehicle)==null?void 0:c.id)||"",service_type:(t==null?void 0:t.service_type)||"",technician:((u=t==null?void 0:t.technician)==null?void 0:u.id)||"",mob_no:(t==null?void 0:t.mob_no)||"",attachment:(t==null?void 0:t.attachment)||"",location:(t==null?void 0:t.location)||"",contact_person:(t==null?void 0:t.contact_person)||"",service_parts:k||[],status:"Pending",user:L},validationSchema:ge({start_date:ce().required("Submission Date is required"),vehicle:F().required("Vehicle is required"),service_type:F().required("Service type is required"),technician:F().required("Technician is required"),mob_no:F().matches(/^\d{10,11}$/,"Mobile number must be 10-11 digits").required("Mobile number is required"),location:F().required("Location is required"),contact_person:F().required("Contact Person is required"),attachment:Ke()}),onSubmit:async n=>{console.log("values",n);let l;if(t?((n==null?void 0:n.attachment)instanceof File||typeof(n==null?void 0:n.attachment)=="string"&&(n.attachment=""),l=await H(Re({payload:n,id:t.id}))):l=await H(Oe(n)),l.payload){console.log(l.payload),console.log("values",n.service_parts);const{id:d}=l.payload,{service_parts:P}=n;await H(Ie({service:d,parts:P})),te.success("Service created successfully"),i.resetForm(),f(null),H(je()),b(!1)}}}),U=["Routine","Overdue","Emergency"];g.useEffect(()=>{let n=S.map(l=>({label:l.registration_id,value:l.id}));Z(n)},[S]),g.useEffect(()=>{let n=I.map(l=>({label:l.segment_name,value:l.id}));r(n)},[I]);const D=async()=>{W(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(async n=>{const{latitude:l,longitude:d}=n.coords;try{const P=await getReadableAddress(l,d);i.setFieldValue("location",P)}catch{te.error("Failed to convert coordinates to address.")}finally{W(!1)}},()=>{te.error("Failed to retrieve location."),W(!1)}):(te.error("Geolocation not supported."),W(!1))};return e.jsx(ee,{sx:{p:3,maxWidth:"100%",margin:"auto"},children:e.jsx("form",{onSubmit:i.handleSubmit,children:e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(x,{label:"Start date",name:"start_date",type:"datetime-local",value:i.values.start_date,onChange:i.handleChange,onBlur:i.handleBlur,error:i.touched.start_date&&!!i.errors.start_date,helperText:i.touched.start_date&&i.errors.start_date,fullWidth:!0,InputLabelProps:{shrink:!0},disabled:!0})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(K,{options:S,getOptionLabel:n=>n.registration_id||"",value:S.find(n=>n.id===i.values.vehicle)||null,onChange:(n,l)=>i.setFieldValue("vehicle",(l==null?void 0:l.id)||""),renderInput:n=>e.jsx(x,{...n,label:"Vehicle",error:i.touched.vehicle&&!!i.errors.vehicle,helperText:i.touched.vehicle&&i.errors.vehicle})})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(K,{options:U,getOptionLabel:n=>n,value:i.values.service_type,onChange:(n,l)=>i.setFieldValue("service_type",l||""),renderInput:n=>e.jsx(x,{...n,label:"Service Type",error:i.touched.service_type&&!!i.errors.service_type,helperText:i.touched.service_type&&i.errors.service_type})})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(K,{options:A,getOptionLabel:n=>`${n.first_name} ${n.last_name}`||"",value:A.find(n=>n.id===i.values.technician)||null,onChange:(n,l)=>i.setFieldValue("technician",(l==null?void 0:l.id)||""),renderInput:n=>e.jsx(x,{...n,label:"Assign technician",error:i.touched.technician&&!!i.errors.technician,helperText:i.touched.technician&&i.errors.technician})})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(x,{label:"Contact Person Name*",name:"contact_person",value:i.values.contact_person,onChange:i.handleChange,onBlur:i.handleBlur,error:i.touched.contact_person&&!!i.errors.contact_person,helperText:i.touched.contact_person&&i.errors.contact_person,fullWidth:!0})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(x,{label:"Contact Person Mobile No*",name:"mob_no",value:i.values.mob_no,onChange:i.handleChange,onBlur:i.handleBlur,error:i.touched.mob_no&&!!i.errors.mob_no,helperText:i.touched.mob_no&&i.errors.mob_no,fullWidth:!0})}),e.jsxs(o,{item:!0,xs:12,sm:6,children:[e.jsx(x,{label:"Location",name:"location",value:i.values.location,onChange:i.handleChange,onBlur:i.handleBlur,error:i.touched.location&&!!i.errors.location,helperText:i.touched.location&&i.errors.location,fullWidth:!0}),e.jsx(R,{size:"small",onClick:D,disabled:X,sx:{mt:1},children:X?e.jsx(We,{size:16}):"Use Current Location"})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(ne,{variant:"h6",gutterBottom:!0,children:"Parts Requirement*(If any information available)"}),(T=(p=i==null?void 0:i.values)==null?void 0:p.service_parts)==null?void 0:T.map((n,l)=>{var Y;const d=(Y=i.values)==null?void 0:Y.service_parts.map(h=>h.spare_parts).filter((h,q)=>q!==l),P=m.filter(h=>!d.includes(h.id));return e.jsxs(o,{container:!0,spacing:2,marginTop:"0px",alignItems:"center",children:[e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(K,{options:P,getOptionLabel:h=>h.description,value:m.find(h=>h.id===n.spare_parts)||null,onChange:(h,q)=>i.setFieldValue(`service_parts[${l}].spare_parts`,(q==null?void 0:q.id)||""),renderInput:h=>e.jsx(x,{...h,label:"Spare Part",fullWidth:!0})})}),e.jsx(o,{item:!0,xs:8,md:4,children:e.jsxs(ee,{display:"flex",alignItems:"center",children:[e.jsx(B,{onClick:()=>i.setFieldValue(`service_parts[${l}].quantity`,Math.max(1,n.quantity-1)),children:e.jsx(ye,{})}),e.jsx(x,{value:n.quantity,type:"number",inputProps:{min:1},onChange:h=>i.setFieldValue(`service_parts[${l}].quantity`,parseInt(h.target.value,10)),sx:{width:90,mx:1,textAlign:"center"}}),e.jsx(B,{onClick:()=>i.setFieldValue(`service_parts[${l}].quantity`,n.quantity+1),children:e.jsx(Ce,{})})]})}),e.jsx(o,{item:!0,xs:4,md:2,children:e.jsx(B,{color:"error",onClick:()=>{var q;const h=[...(q=i.values)==null?void 0:q.service_parts];h.splice(l,1),i.setFieldValue("service_parts",h)},children:e.jsx(Se,{})})})]},l)}),e.jsx(R,{variant:"outlined",onClick:()=>{var d,P,Y;const n=(P=(d=i.values)==null?void 0:d.service_parts)==null?void 0:P.map(h=>h.spare_parts);if(m.filter(h=>!(n!=null&&n.includes(h.id))).length===0){te.error("All available spare parts have already been added.");return}i.setFieldValue("service_parts",[...(Y=i.values)==null?void 0:Y.service_parts,{spare_parts:"",quantity:1}])},sx:{mt:2},children:"+ Add Spare Part"})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs(R,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload File",e.jsx("input",{type:"file",hidden:!0,onChange:n=>{const l=n.currentTarget.files[0];l&&i.setFieldValue("attachment",l)}})]}),i.values.attachment&&e.jsxs(o,{container:!0,spacing:1,mt:1,alignItems:"center",children:[e.jsx(o,{item:!0,children:e.jsxs(ne,{variant:"body2",children:[e.jsx("b",{children:"Attachment:"})," ",typeof i.values.attachment=="string"?i.values.attachment.split("/").pop():i.values.attachment.name]})}),e.jsx(o,{item:!0,children:e.jsx(R,{size:"small",variant:"text",onClick:()=>{const n=typeof i.values.attachment=="string"?i.values.attachment:URL.createObjectURL(i.values.attachment);window.open(n,"_blank")},children:"View File"})})]})]}),e.jsx(o,{item:!0,xs:12,children:e.jsx(R,{variant:"contained",type:"submit",fullWidth:!0,disabled:N,children:t?"Update Service request":"Raise Service request"})})]})})})};function ns({open:t,setOpen:b,data:L,isInspection:E}){const f=()=>b(!1);return e.jsxs(ve,{open:t,onClose:f,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[e.jsxs(be,{children:["Update service entry",e.jsx(B,{"aria-label":"close",onClick:()=>b(!1),sx:{position:"absolute",right:8,top:8},children:e.jsx(De,{})})]}),e.jsx(me,{dividers:!0,children:e.jsx(ts,{UpdatedBreakdownData:L,setOpen:b})})]})}const pe=[{id:"service_record_id",label:"Service Record ID"},{id:"registration_id",label:"Registration ID"},{id:"service_type",label:"Service Type"},{id:"user_name",label:"Created by"},{id:"technician_name",label:"Technician Name"},{id:"contact_person",label:"Contact Person"},{id:"mob_no",label:"Mobile No"},{id:"start_date",label:"Start Date"},{id:"start_time",label:"Start Time"},{id:"status",label:"Status"}],is=()=>{const{servicesData:t}=$(s=>s.services),{searchTerm:b}=$(s=>s.inspection),L=oe(),[E,f]=g.useState("asc"),[S,O]=g.useState("BDID"),[I,N]=g.useState(0),[A,m]=g.useState(8),[H,ie]=g.useState(!1),[Z,se]=g.useState(!1),[r,X]=g.useState(null),[W,k]=Me.useState(null);g.useState({service_record_id:"",registration_id:"",service_type:"",user_name:"",technician_name:"",contact_person:"",mob_no:"",start_date:"",start_time:"",status:""});const[i,U]=g.useState("service_record_id");g.useEffect(()=>{L(Be({})),L(je())},[]);const D=s=>{f(S===s&&E==="asc"?"desc":"asc"),O(s)},c=(s,j)=>{N(j)},u=s=>{m(parseInt(s.target.value,10)),N(0)},p=(s,j,C)=>!j||!C?s:s.filter(a=>(()=>{var _,V,J,z,G,Q,M,ae,re;switch(j){case"service_record_id":return((a==null?void 0:a.service_record_id)||"").toString();case"registration_id":return((_=a==null?void 0:a.vehicle)==null?void 0:_.registration_id)||"";case"service_type":return(a==null?void 0:a.service_type)||"";case"user_name":return`${((J=(V=a==null?void 0:a.user)==null?void 0:V.us_user)==null?void 0:J.first_name)||""} ${((G=(z=a==null?void 0:a.user)==null?void 0:z.us_user)==null?void 0:G.last_name)||""}`;case"technician_name":return`${((M=(Q=a==null?void 0:a.technician)==null?void 0:Q.us_user)==null?void 0:M.first_name)||""} ${((re=(ae=a==null?void 0:a.technician)==null?void 0:ae.us_user)==null?void 0:re.last_name)||""}`;case"contact_person":return(a==null?void 0:a.contact_person)||"";case"mob_no":return(a==null?void 0:a.mob_no)||"";case"start_date":return a!=null&&a.start_date?w(a.start_date).format("YYYY-MM-DD"):"";case"start_time":return a!=null&&a.start_date?w(a.start_date).format("HH:mm A"):"";case"status":return(a==null?void 0:a.status)||"";default:return""}})().toLowerCase().includes(C.toLowerCase())),T=(s,j,C,a)=>{if(a==="User"){const v=`${s.user.us_user.first_name} ${s.user.us_user.last_name}`.toLowerCase(),_=`${j.user.us_user.first_name} ${j.user.us_user.last_name}`.toLowerCase();return C==="asc"?v.localeCompare(_):_.localeCompare(v)}if(a==="WorkshopGroup"){const v=s.workshop_group.group_name.toLowerCase(),_=j.workshop_group.group_name.toLowerCase();return C==="asc"?v.localeCompare(_):_.localeCompare(v)}if(a==="BDID"){const v=parseInt(s.service_record_id.replace("BD-",""),10),_=parseInt(j.service_record_id.replace("BD-",""),10);return C==="asc"?v-_:_-v}if(a==="SubmissionDate"){const v=new Date(s.submission_date),_=new Date(j.submission_date);return C==="asc"?v-_:_-v}if(a==="Status"){const v={Open:1,Close:2,Rejected:3},_=v[s.status]||0,V=v[j.status]||0;return C==="asc"?_-V:V-_}return 0},n=p((t==null?void 0:t.slice())||[],i,b).sort((s,j)=>T(s,j,E,S)),l=n.slice(I*A,I*A+A),d={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},P=s=>{se(!Z),k(s)},Y=n&&n.map(s=>{var C,a,v,_,V,J,z,G,Q;const j=s!=null&&s.service_parts&&(s==null?void 0:s.service_parts.length)>0?s==null?void 0:s.service_parts.map((M,ae)=>{var re;return`${(re=M==null?void 0:M.spare_parts)==null?void 0:re.description}: Qty ${M==null?void 0:M.quantity}`}).join(";"):"N/A";return{"Service Record ID":(s==null?void 0:s.service_record_id)||"","Registration ID":((C=s==null?void 0:s.vehicle)==null?void 0:C.registration_id)||"","Service Type":(s==null?void 0:s.service_type)||"","User Name":`${((v=(a=s==null?void 0:s.user)==null?void 0:a.us_user)==null?void 0:v.first_name)||""} ${((V=(_=s==null?void 0:s.user)==null?void 0:_.us_user)==null?void 0:V.last_name)||""}`,"Technician Name":`${((z=(J=s==null?void 0:s.technician)==null?void 0:J.us_user)==null?void 0:z.first_name)||""} ${((Q=(G=s==null?void 0:s.technician)==null?void 0:G.us_user)==null?void 0:Q.last_name)||""}`,"Contact Person":(s==null?void 0:s.contact_person)||"","Mobile No":(s==null?void 0:s.mob_no)||"","Start Date":s!=null&&s.start_date?w(s.start_date).format("YYYY-MM-DD"):"","Start Time":s!=null&&s.start_date?w(s.start_date).format("HH:mm A"):"",Status:(s==null?void 0:s.status)||"","Spare parts":j}});let h=he("Service"),q=he("Job Card");const ue=(q==null?void 0:q.includes("Create"))||q==="Read-Write-Only",de=(h==null?void 0:h.includes("Update"))||h==="Read-Write-Only";return e.jsxs(ee,{sx:{m:"10px"},children:[e.jsxs(ee,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(Xe,{columns:pe,selectedColumn:i,onColumnChange:U,searchTerm:b,onSearchChange:s=>L(Ee(s))}),e.jsx(_e,{variant:"contained",color:"success",onClick:()=>Ze(Y,"service-ticket.xlsx"),children:"Download Excel"})]}),e.jsxs(Ne,{children:[e.jsx(He,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:e.jsxs(Ye,{stickyHeader:!0,children:[e.jsx(Je,{children:e.jsxs(xe,{children:[pe.map(s=>e.jsx(y,{sx:d,children:e.jsx(ke,{active:S===s.id,direction:S===s.id?E:"asc",onClick:()=>D(s.id),children:s.label})},s.id)),de&&e.jsx(y,{sx:d,children:"Action"}),ue&&e.jsx(y,{sx:d,children:"Job card"})]})}),e.jsx(ze,{children:l.map((s,j)=>{var C,a,v,_,V,J,z,G,Q;return e.jsxs(xe,{children:[e.jsx(y,{children:s==null?void 0:s.service_record_id}),e.jsx(y,{children:(C=s==null?void 0:s.vehicle)==null?void 0:C.registration_id}),e.jsx(y,{children:s==null?void 0:s.service_type}),e.jsx(y,{children:`${(v=(a=s==null?void 0:s.user)==null?void 0:a.us_user)==null?void 0:v.first_name} ${(V=(_=s==null?void 0:s.user)==null?void 0:_.us_user)==null?void 0:V.last_name}`}),e.jsx(y,{children:`${((z=(J=s==null?void 0:s.technician)==null?void 0:J.us_user)==null?void 0:z.first_name)||""} ${((Q=(G=s==null?void 0:s.technician)==null?void 0:G.us_user)==null?void 0:Q.last_name)||""}`}),e.jsx(y,{children:s==null?void 0:s.contact_person}),e.jsx(y,{children:s==null?void 0:s.mob_no}),e.jsx(y,{children:(s==null?void 0:s.start_date)&&w(s.start_date).format("YYYY-MM-DD")||"N/A"}),e.jsx(y,{children:(s==null?void 0:s.start_date)&&w(s.start_date).format("HH:mm A")||"N/A"}),e.jsx(y,{sx:{color:s.status==="Open"?"blue":s.status==="Completed"?"green":"red"},children:s.status}),de&&e.jsx(y,{children:e.jsx(B,{onClick:()=>P(s),color:"primary",disabled:(s==null?void 0:s.status.toLowerCase())==="completed","aria-label":"edit record",children:e.jsx(Ue,{})})}),ue&&e.jsx(y,{children:e.jsx(_e,{variant:"outlined",onClick:()=>{ie(!0),X(s)},disabled:s==null?void 0:s.jobcard,children:"Create job card"})})]},j)})})]})}),e.jsx(Ge,{component:"div",count:n.length,page:I,onPageChange:c,rowsPerPage:A,onRowsPerPageChange:u,rowsPerPageOptions:[5,10,15]}),e.jsx(ss,{rowData:r,open:H,handleClose:()=>ie(!1),isTechnician:!0})]}),e.jsx(ns,{open:Z,setOpen:se,data:W})]})},_s=is;export{ts as C,_s as S,ss as a};
