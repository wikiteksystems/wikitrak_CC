import{l as ye,o as Se,p as De,_ as oe,b as o,q as ve,f as we,j as e,g as be,k as Ce,y as ne,z as A,aa as Z,ab as ue,a4 as fe,ac as Me,ad as Te,ae as re,af as O,T as v,F as X,ag as he,ah as ke,ai as Ae,aj as _e,C as J,ak as ge,Q as Ye,V as Ie,W as Ne,Z as Le}from"./index-oCcClIVR.js";import{L as Oe}from"./LeftSideBar2-D1dFanV7.js";import{L as Ee}from"./LiveMapTopBar-UGx8LpYo.js";import{V as Re}from"./VehicleMenu-BJJQv1Ay.js";import{T as Pe}from"./TripMap-CIbdVKeO.js";import{d as k}from"./dayjs.min-BrLTYef8.js";import{t as ie}from"./SearchTab-BIH25pLr.js";import{S as Ve,D as Be}from"./index-DeTjC0FR.js";import{r as xe}from"./createSvgIcon-DQJnhenv.js";import{B as h,C as Fe}from"./CircularProgress-DrVUYvWS.js";import{M as $e}from"./menu2-Cq-QiCPW.js";import{C as qe}from"./Card-BEm9TwcF.js";import{C as Ge}from"./CardContent-DyloKXxI.js";import"./TripVehicleInfo-DzJgVFmg.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as Ue}from"./VehicleGroups-B-ap7of7.js";import"./useControlled-MXhu2rHQ.js";import"./Close-SjTNqcL9.js";import"./jcb-aCHXMCXy.js";import"./TextField-CpgzIzbu.js";import"./Autocomplete-C1fNGI-Q.js";import"./esm-C6opi8fg.js";import"./redTractor-NXgVJyvR.js";import"./Info-CqEWa4kz.js";function ze(r){return ye("MuiCardActions",r)}Se("MuiCardActions",["root","spacing"]);const He=["disableSpacing","className"],We=r=>{const{classes:c,disableSpacing:y}=r;return Ce({root:["root",!y&&"spacing"]},ze,c)},Qe=De("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(r,c)=>{const{ownerState:y}=r;return[c.root,!y.disableSpacing&&c.spacing]}})(({ownerState:r})=>oe({display:"flex",alignItems:"center",padding:8},!r.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Xe=o.forwardRef(function(c,y){const S=ve({props:c,name:"MuiCardActions"}),{disableSpacing:f=!1,className:j}=S,_=we(S,He),u=oe({},S,{disableSpacing:f}),x=We(u);return e.jsx(Qe,oe({className:be(x.root,j),ownerState:u,ref:y},_))}),Ze=Xe,{RangePicker:Je}=Be,Ke=()=>{const r=ne(),{selectedVehicle:c}=A(g=>g.liveMap),{selectedTripData:y,mode:S}=A(g=>g.dashboard),[f,j]=o.useState(),[_,u]=o.useState(),x=ie(S);o.useEffect(()=>{const g=k().subtract(5,"day");if(j(g),u(k()),c!=null&&c.imei){let l={imei:c==null?void 0:c.imei,startDate:k().subtract(5,"day").startOf("day").toISOString(),endDate:k().endOf("day").toISOString(),page:1,limit:10};r(Z(l)),r(ue(l))}},[c]);const i=(g,l)=>{if(g){const Y=k(l[0]).startOf("day"),E=k(l[1]).endOf("day");let M={imei:c==null?void 0:c.imei,startDate:Y.format(),endDate:E.format(),page:1,limit:10};j(k(l[0])),u(k(l[1])),r(Z(M)),r(ue(M))}else console.log("Clear date")};return e.jsx(Ve,{direction:"vertical",size:12,children:e.jsx(Je,{value:[f,_],onChange:(g,l)=>{i(g,l)},style:{backgroundColor:x.grey[500],color:x.grey[400]}})})};var ce={},et=fe;Object.defineProperty(ce,"__esModule",{value:!0});var me=ce.default=void 0,tt=et(xe()),st=e;me=ce.default=(0,tt.default)((0,st.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var le={},at=fe;Object.defineProperty(le,"__esModule",{value:!0});var je=le.default=void 0,rt=at(xe()),ot=e;je=le.default=(0,rt.default)((0,ot.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const nt=()=>{var a,n,D,L;const r=ne(),{tripList:c,selectedTripData:y,loading:S,trips:f,activeIndex:j,searchText:_,mode:u,isNavigate:x,allTripList:i,trip_payload:g,page:l,total_page:Y,total_trips:E}=A(t=>t.dashboard),{selectedVehicle:M}=A(t=>t.liveMap),b=ie(u),[B,F]=o.useState(!1),[d,$]=o.useState({}),[C,q]=o.useState(""),[I,G]=o.useState(null);o.useEffect(()=>{(f==null?void 0:f.length)>0},[f]),o.useEffect(()=>{const t=de(i);r(Me(t))},[i]),o.useEffect(()=>{!(y.length>0)&&x&&j!==null&&T.length>0&&K(T[j])},[y,x]);const K=async t=>{var m;let s={imei:M.imei,startDate:t.startDate,endDate:t.endDate};const p=await Te(s);((m=p==null?void 0:p.data)==null?void 0:m.documents.length)>0?(r(x(!1)),r(re(p.data.documents[0].data))):(r(x(!1)),r(re([])))},de=t=>{const s=new Set,p=[];return t.forEach(m=>{const w=O(m.startTime).format("YYYY-MM-DD");s.has(w)||(s.add(w),p.push(w))}),p},U=(t,s)=>{r(he(null)),r(ke(t)),r(Ae(!1)),C===t?(console.log("hi"),q(""),G(null)):(q(t),G(s))},T=C===""?i:i.filter(t=>O(t.startTime).format("YYYY-MM-DD")===C),z=async(t,s)=>{r(re(s.data)),r(he(t)),r(_e(0))},N=t=>{$(t),F(!0)},H=()=>{F(!1),$({})},W=t=>t?t.split(" ").slice(0,2).join(" "):"",ee=async()=>{const t={...g,page:l+1,limit:10};try{(await r(Z(t))).error?J.error("No Trip! within selected date"):r(ge(l+1))}catch{J.error("No Trip! within selected date")}},te=()=>{if(l<=1)return;const t={...g,page:l-1,limit:10};r(ge(l-1)),r(Z(t))};return e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsxs(h,{sx:{m:"10px"},children:[e.jsx(h,{sx:{color:b.grey[400]},children:"Select Date"}),e.jsx(h,{sx:{mt:1},children:e.jsx(Ke,{})})]}),S?e.jsx("div",{style:{width:"100%",margin:"38%"},children:e.jsx(Fe,{})}):e.jsxs(e.Fragment,{children:[e.jsx(h,{children:e.jsx(h,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:i&&(i==null?void 0:i.length)>0?e.jsx(e.Fragment,{}):e.jsx(v,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),i&&(i==null?void 0:i.length)>0&&e.jsxs(h,{ml:2,display:"flex",gap:1,children:[e.jsxs(v,{children:["Total trips:",E]})," |",e.jsxs(v,{children:["Current page:",l]})," |",e.jsxs(v,{children:["Total page:",Y]}),"|"]}),i&&(i==null?void 0:i.length)>0&&e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:"5px"},children:[e.jsx(X,{disabled:l<=1,onClick:te,children:e.jsx(me,{})}),e.jsx(X,{disabled:Y===l,onClick:ee,children:e.jsx(je,{})})]}),e.jsxs(h,{sx:{height:"75vh",width:"100%",overflowY:"auto"},children:[e.jsx(h,{display:"flex",gap:1,marginLeft:2,children:f.map((t,s)=>e.jsx(h,{children:e.jsx(X,{onClick:()=>{U(t,s)},style:{backgroundColor:I===s?b.grey[300]:b.grey[200],color:I===s?"black":b.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:t})},s))}),T&&T.length>0&&T.map((t,s)=>{var ae,R,P,V;const p=(R=(ae=t==null?void 0:t.startLocation)==null?void 0:ae.address)==null?void 0:R.address,m=(V=(P=t==null?void 0:t.endLocation)==null?void 0:P.address)==null?void 0:V.address,w=p?`${p.town||p.city||""}`:"",se=m?`${m.town||m.city||""}`:"";return e.jsxs(h,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:j===s?"black":b.grey[400],backgroundColor:j===s?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:u?b.grey[300]:b.grey[200]}},onClick:()=>z(s,t),children:[e.jsxs(v,{sx:{cursor:"text"},children:[s+1,". ",W(w)," to"," ",W(se)," "]}),e.jsxs(v,{children:[t!=null&&t.startTime?O(new Date(t.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",t!=null&&t.endTime?O(new Date(t.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",e.jsx("span",{style:{color:u?"orange":"blue",cursor:"pointer"},onClick:Q=>{Q.stopPropagation(),N(t)},children:"...see more"})]})]},s)})]})]})]}),e.jsx($e,{open:B,onClose:H,children:e.jsxs(qe,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[e.jsxs(Ge,{children:[e.jsx(v,{variant:"h6",component:"div",children:"Trip Details"}),e.jsxs(v,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Location:"})," ",((n=(a=d==null?void 0:d.startLocation)==null?void 0:a.address)==null?void 0:n.display_name)||"N/A"]}),e.jsxs(v,{sx:{mt:2},children:[e.jsx("strong",{children:"End Location:"})," ",((L=(D=d==null?void 0:d.endLocation)==null?void 0:D.address)==null?void 0:L.display_name)||"N/A"]}),e.jsxs(v,{sx:{mt:2},children:[e.jsx("strong",{children:"Start Time:"})," ",d!=null&&d.startTime?O(new Date(d.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),e.jsxs(v,{sx:{mt:2},children:[e.jsx("strong",{children:"End Time:"})," ",d!=null&&d.endTime?O(new Date(d.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),e.jsx(Ze,{children:e.jsx(X,{onClick:H,children:"Close"})})]})})]})},it=nt;function Nt(){const{w_customer_id:r}=A(a=>a.auth),{collapsed:c}=A(a=>a.auth),{mode:y,selectedVehicleGroup:S}=A(a=>a.dashboard),{vehicleList:f,selectedVehicle:j,onlineVehicle:_,locationData:u}=A(a=>a.liveMap),[x,i]=o.useState(!1),[g,l]=o.useState(!0),[Y,E]=o.useState([]),[M,b]=o.useState(!1),[B,F]=o.useState(""),[d,$]=o.useState(""),[C,q]=o.useState(""),[I,G]=o.useState("");o.useState([]);const[K,de]=o.useState({lat:18.516726,lng:73.856255});o.useState([]);const[U,T]=o.useState(!1),z=ie(y);let N=ne();o.useEffect(()=>{H()},[]),o.useEffect(()=>{var a,n,D;Object.keys(j).length===0&&f.length>0&&N(Ye({imei:(n=(a=f[0])==null?void 0:a.imei[0])==null?void 0:n.mac_id,reg_id:(D=f[0])==null?void 0:D.registration_id}))},[j,f]);const H=async()=>{try{let a=[],n=[];const D=await N(Ie({w_customer_id:r}));if(Array.isArray(D.payload)){D.payload.forEach(s=>{var p,m,w;Array.isArray(s.imei)&&s.imei.length>0&&((p=s.imei[0])!=null&&p.mac_id)?(a.push({id:s.id,label:s.registration_id,value:(m=s.imei[0])==null?void 0:m.mac_id,workShop:s==null?void 0:s.workshop,vehicle_group:s==null?void 0:s.vehicle_group}),n.push((w=s.imei[0])==null?void 0:w.mac_id)):console.error("IMEI data not found for item:",s)});const L="one",t=n;n.length>0&&N(Ne({type:L,imei:t})),N(Le({w_customer_id:r})),E(a)}else console.error("Unexpected data format:",D),J.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),J.error(`Error fetching vehicle data: ${a}`)}},W=a=>u==null?void 0:u.some(n=>Number(n.latestDocument.imei)===Number(a)&&n.latestDocument.speed>0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),ee=a=>u==null?void 0:u.some(n=>Number(n.latestDocument.imei)===Number(a)&&n.latestDocument.speed<=0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),te=Y.filter(a=>{var R,P,V,Q,pe;if(!(Object.keys(S).length===0||a.vehicle_group===S.id))return!1;const D=(R=a==null?void 0:a.label)==null?void 0:R.toLowerCase().includes(B.toLowerCase()),L=I===""||((P=a==null?void 0:a.workShop)==null?void 0:P.region)===I,t=C===""||((Q=(V=a==null?void 0:a.workShop)==null?void 0:V.state)==null?void 0:Q.toLowerCase())===(((pe=C==null?void 0:C.toString())==null?void 0:pe.toLowerCase())||""),s=Number(a.value),p=_.includes(s),m=!p,w=p&&W(s),se=p&&ee(s);return D&&L&&t&&(d==="online"?p:d==="offline"?m:d==="running"?w:d==="idling"?se:!0)}).sort((a,n)=>a.label.localeCompare(n.label));return e.jsxs("div",{className:"app",children:[e.jsx(Oe,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Ee,{title:"Trip Monitor",setShowVehicles:i,showVehicles:x,setShowCard:l,showCard:g,sideBarTrip:M,setSideBarTrip:b,setShowVehiclesGroup:T,showVehiclesGroup:U}),e.jsx(Ue,{setShowVehiclesGroup:T,showVehiclesGroup:U,where:"tripmonitor"}),e.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(h,{style:{width:x||M?"80%":"100%"},children:e.jsx(Pe,{center:K,showCard:g})}),x&&e.jsx(h,{style:{width:"20%",backgroundColor:z.grey[100]},children:e.jsx(Re,{vehicleData:te,setShowVehicles:i,showVehicles:x,title:"Live Monitor",setSearchedTerm:F,setOptions:$,setState:q,setRegion:G,searchTerm:B,options:d,state:C,region:I})}),e.jsx(h,{style:{width:c?"22%":"20%",display:M?"block":"none",backgroundColor:z.grey[100]},children:e.jsx(it,{})})]})]})]})}export{Nt as default};
