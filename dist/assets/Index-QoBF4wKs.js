import{o as _e,l as Te,p as le,aT as Ze,v as Qe,_ as w,b as d,q as je,f as be,g as Q,j as r,k as Ie,b5 as xt,b6 as pe,b7 as vt,b8 as xe,b9 as St,z as te,y as ke,aY as yt,ba as wt,bb as Bt,C as ee,bc as Ve,bd as et,be as Ct,bf as De,$ as we,L as tt,bg as _t,T as Be,F as qe,I as Tt,E as jt,bh as It,bi as kt,au as Et,aK as Pt,a8 as He,V as Rt,W as Wt,Y as Mt,Z as Lt,D as Nt}from"./index-IGyMW_ne.js";import{V as $t}from"./VehicleMenu-DPnxtcDj.js";import{t as Ft}from"./SearchTab-CpmxHA27.js";import"./Loader-mogguUBq.js";import"./LiveMapServices-Qn5YmN7_.js";import"./Socket-0N_gnJcr.js";import{P as zt}from"./Parameters-DycnOatg.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as At}from"./LeftSideBar2-B9zgLwj1.js";import{I as Ot}from"./InspectionsTable-Dv_vhTIu.js";import{c as Vt,a as q}from"./index.esm-Btjs818_.js";import{V as Dt}from"./VehicleGroups-BJMRrfEM.js";import{P as ve}from"./index-sv_47b4B.js";import{S as qt}from"./ServiceRecordTable-Bn2Z6vAd.js";import{d as Ht}from"./Close-jAr7MkDK.js";import{a as Xt}from"./formik.esm-D0F7RFcM.js";import{B as H}from"./CircularProgress-B6w4ThxH.js";import{A as Xe}from"./Autocomplete-C7x-b_ML.js";import{T as G,S as Yt,M as Se}from"./TextField-R_VnFds-.js";import{c as ot,F as Ut,a as Gt}from"./menu2-C58dgL4v.js";import{S as Kt}from"./SearchInput-BOjKeCgt.js";import{D as Jt,a as Zt,b as Qt}from"./DialogTitle-BlVyFHpy.js";import{d as rt,o as st}from"./useControlled-BLdTgnb8.js";import{K as eo,a as to}from"./TablePagination-C0Z6QGqO.js";import{S as oo}from"./ServicesTopBar-Co3Q9-oL.js";import"./createSvgIcon-BW8N8nGN.js";import"./Card-D-EhWXNn.js";import"./CardContent-7qygKkcd.js";import"./Edit-XmKTxEzA.js";import"./TableRow-BCuYn0nX.js";import"./DateTimePicker-C579iBYp.js";import"./NewLoader-B5zLKQ1z.js";import"./dayjs.min-Cj5lgudY.js";import"./index-BSooDKTd.js";let ne;function lt(){if(ne)return ne;const e=document.createElement("div"),t=document.createElement("div");return t.style.width="10px",t.style.height="1px",e.appendChild(t),e.dir="rtl",e.style.fontSize="14px",e.style.width="4px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.overflow="scroll",document.body.appendChild(e),ne="reverse",e.scrollLeft>0?ne="default":(e.scrollLeft=1,e.scrollLeft===0&&(ne="negative")),document.body.removeChild(e),ne}function ro(e,t){const n=e.scrollLeft;if(t!=="rtl")return n;switch(lt()){case"negative":return e.scrollWidth-e.clientWidth+n;case"reverse":return e.scrollWidth-e.clientWidth-n;default:return n}}function so(e){return Te("MuiTab",e)}const lo=_e("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper"]),Z=lo,no=["className","disabled","disableFocusRipple","fullWidth","icon","iconPosition","indicator","label","onChange","onClick","onFocus","selected","selectionFollowsFocus","textColor","value","wrapped"],ao=e=>{const{classes:t,textColor:n,fullWidth:i,wrapped:s,icon:h,label:x,selected:v,disabled:m}=e,B={root:["root",h&&x&&"labelIcon",`textColor${Qe(n)}`,i&&"fullWidth",s&&"wrapped",v&&"selected",m&&"disabled"],iconWrapper:["iconWrapper"]};return Ie(B,so,t)},io=le(Ze,{name:"MuiTab",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.label&&n.icon&&t.labelIcon,t[`textColor${Qe(n.textColor)}`],n.fullWidth&&t.fullWidth,n.wrapped&&t.wrapped,{[`& .${Z.iconWrapper}`]:t.iconWrapper}]}})(({theme:e,ownerState:t})=>w({},e.typography.button,{maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center"},t.label&&{flexDirection:t.iconPosition==="top"||t.iconPosition==="bottom"?"column":"row"},{lineHeight:1.25},t.icon&&t.label&&{minHeight:72,paddingTop:9,paddingBottom:9,[`& > .${Z.iconWrapper}`]:w({},t.iconPosition==="top"&&{marginBottom:6},t.iconPosition==="bottom"&&{marginTop:6},t.iconPosition==="start"&&{marginRight:e.spacing(1)},t.iconPosition==="end"&&{marginLeft:e.spacing(1)})},t.textColor==="inherit"&&{color:"inherit",opacity:.6,[`&.${Z.selected}`]:{opacity:1},[`&.${Z.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity}},t.textColor==="primary"&&{color:(e.vars||e).palette.text.secondary,[`&.${Z.selected}`]:{color:(e.vars||e).palette.primary.main},[`&.${Z.disabled}`]:{color:(e.vars||e).palette.text.disabled}},t.textColor==="secondary"&&{color:(e.vars||e).palette.text.secondary,[`&.${Z.selected}`]:{color:(e.vars||e).palette.secondary.main},[`&.${Z.disabled}`]:{color:(e.vars||e).palette.text.disabled}},t.fullWidth&&{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"},t.wrapped&&{fontSize:e.typography.pxToRem(12)})),co=d.forwardRef(function(t,n){const i=je({props:t,name:"MuiTab"}),{className:s,disabled:h=!1,disableFocusRipple:x=!1,fullWidth:v,icon:m,iconPosition:B="top",indicator:R,label:y,onChange:p,onClick:k,onFocus:o,selected:W,selectionFollowsFocus:j,textColor:$="inherit",value:c,wrapped:g=!1}=i,C=be(i,no),X=w({},i,{disabled:h,disableFocusRipple:x,selected:W,icon:!!m,iconPosition:B,label:!!y,fullWidth:v,textColor:$,wrapped:g}),S=ao(X),M=m&&y&&d.isValidElement(m)?d.cloneElement(m,{className:Q(S.iconWrapper,m.props.className)}):m,F=A=>{!W&&p&&p(A,c),k&&k(A)},z=A=>{j&&!W&&p&&p(A,c),o&&o(A)};return r.jsxs(io,w({focusRipple:!x,className:Q(S.root,s),ref:n,role:"tab","aria-selected":W,disabled:h,onClick:F,onFocus:z,ownerState:X,tabIndex:W?0:-1},C,{children:[B==="top"||B==="start"?r.jsxs(d.Fragment,{children:[M,y]}):r.jsxs(d.Fragment,{children:[y,M]}),R]}))}),Ye=co;function uo(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2}function ho(e,t,n,i={},s=()=>{}){const{ease:h=uo,duration:x=300}=i;let v=null;const m=t[e];let B=!1;const R=()=>{B=!0},y=p=>{if(B){s(new Error("Animation cancelled"));return}v===null&&(v=p);const k=Math.min(1,(p-v)/x);if(t[e]=h(k)*(n-m)+m,k>=1){requestAnimationFrame(()=>{s(null)});return}requestAnimationFrame(y)};return m===n?(s(new Error("Element already at target position")),R):(requestAnimationFrame(y),R)}const po=["onChange"],bo={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};function fo(e){const{onChange:t}=e,n=be(e,po),i=d.useRef(),s=d.useRef(null),h=()=>{i.current=s.current.offsetHeight-s.current.clientHeight};return xt(()=>{const x=rt(()=>{const m=i.current;h(),m!==i.current&&t(i.current)}),v=st(s.current);return v.addEventListener("resize",x),()=>{x.clear(),v.removeEventListener("resize",x)}},[t]),d.useEffect(()=>{h(),t(i.current)},[t]),r.jsx("div",w({style:bo,ref:s},n))}function mo(e){return Te("MuiTabScrollButton",e)}const go=_e("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),xo=go,vo=["className","slots","slotProps","direction","orientation","disabled"],So=e=>{const{classes:t,orientation:n,disabled:i}=e;return Ie({root:["root",n,i&&"disabled"]},mo,t)},yo=le(Ze,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.orientation&&t[n.orientation]]}})(({ownerState:e})=>w({width:40,flexShrink:0,opacity:.8,[`&.${xo.disabled}`]:{opacity:0}},e.orientation==="vertical"&&{width:"100%",height:40,"& svg":{transform:`rotate(${e.isRtl?-90:90}deg)`}})),wo=d.forwardRef(function(t,n){var i,s;const h=je({props:t,name:"MuiTabScrollButton"}),{className:x,slots:v={},slotProps:m={},direction:B}=h,R=be(h,vo),y=ot(),p=w({isRtl:y},h),k=So(p),o=(i=v.StartScrollButtonIcon)!=null?i:eo,W=(s=v.EndScrollButtonIcon)!=null?s:to,j=pe({elementType:o,externalSlotProps:m.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:p}),$=pe({elementType:W,externalSlotProps:m.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:p});return r.jsx(yo,w({component:"div",className:Q(k.root,x),ref:n,role:null,ownerState:p,tabIndex:null},R,{children:B==="left"?r.jsx(o,w({},j)):r.jsx(W,w({},$))}))}),Bo=wo;function Co(e){return Te("MuiTabs",e)}const _o=_e("MuiTabs",["root","vertical","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),ye=_o,To=["aria-label","aria-labelledby","action","centered","children","className","component","allowScrollButtonsMobile","indicatorColor","onChange","orientation","ScrollButtonComponent","scrollButtons","selectionFollowsFocus","slots","slotProps","TabIndicatorProps","TabScrollButtonProps","textColor","value","variant","visibleScrollbar"],Ue=(e,t)=>e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:e.firstChild,Ge=(e,t)=>e===t?e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:e.lastChild,he=(e,t,n)=>{let i=!1,s=n(e,t);for(;s;){if(s===e.firstChild){if(i)return;i=!0}const h=s.disabled||s.getAttribute("aria-disabled")==="true";if(!s.hasAttribute("tabindex")||h)s=n(e,s);else{s.focus();return}}},jo=e=>{const{vertical:t,fixed:n,hideScrollbar:i,scrollableX:s,scrollableY:h,centered:x,scrollButtonsHideMobile:v,classes:m}=e;return Ie({root:["root",t&&"vertical"],scroller:["scroller",n&&"fixed",i&&"hideScrollbar",s&&"scrollableX",h&&"scrollableY"],flexContainer:["flexContainer",t&&"flexContainerVertical",x&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",v&&"scrollButtonsHideMobile"],scrollableX:[s&&"scrollableX"],hideScrollbar:[i&&"hideScrollbar"]},Co,m)},Io=le("div",{name:"MuiTabs",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${ye.scrollButtons}`]:t.scrollButtons},{[`& .${ye.scrollButtons}`]:n.scrollButtonsHideMobile&&t.scrollButtonsHideMobile},t.root,n.vertical&&t.vertical]}})(({ownerState:e,theme:t})=>w({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex"},e.vertical&&{flexDirection:"column"},e.scrollButtonsHideMobile&&{[`& .${ye.scrollButtons}`]:{[t.breakpoints.down("sm")]:{display:"none"}}})),ko=le("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.scroller,n.fixed&&t.fixed,n.hideScrollbar&&t.hideScrollbar,n.scrollableX&&t.scrollableX,n.scrollableY&&t.scrollableY]}})(({ownerState:e})=>w({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap"},e.fixed&&{overflowX:"hidden",width:"100%"},e.hideScrollbar&&{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},e.scrollableX&&{overflowX:"auto",overflowY:"hidden"},e.scrollableY&&{overflowY:"auto",overflowX:"hidden"})),Eo=le("div",{name:"MuiTabs",slot:"FlexContainer",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.flexContainer,n.vertical&&t.flexContainerVertical,n.centered&&t.centered]}})(({ownerState:e})=>w({display:"flex"},e.vertical&&{flexDirection:"column"},e.centered&&{justifyContent:"center"})),Po=le("span",{name:"MuiTabs",slot:"Indicator",overridesResolver:(e,t)=>t.indicator})(({ownerState:e,theme:t})=>w({position:"absolute",height:2,bottom:0,width:"100%",transition:t.transitions.create()},e.indicatorColor==="primary"&&{backgroundColor:(t.vars||t).palette.primary.main},e.indicatorColor==="secondary"&&{backgroundColor:(t.vars||t).palette.secondary.main},e.vertical&&{height:"100%",width:2,right:0})),Ro=le(fo)({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),Ke={},Wo=d.forwardRef(function(t,n){const i=je({props:t,name:"MuiTabs"}),s=vt(),h=ot(),{"aria-label":x,"aria-labelledby":v,action:m,centered:B=!1,children:R,className:y,component:p="div",allowScrollButtonsMobile:k=!1,indicatorColor:o="primary",onChange:W,orientation:j="horizontal",ScrollButtonComponent:$=Bo,scrollButtons:c="auto",selectionFollowsFocus:g,slots:C={},slotProps:X={},TabIndicatorProps:S={},TabScrollButtonProps:M={},textColor:F="primary",value:z,variant:A="standard",visibleScrollbar:ae=!1}=i,E=be(i,To),_=A==="scrollable",P=j==="vertical",Y=P?"scrollTop":"scrollLeft",K=P?"top":"left",u=P?"bottom":"right",V=P?"clientHeight":"clientWidth",N=P?"height":"width",O=w({},i,{component:p,allowScrollButtonsMobile:k,indicatorColor:o,orientation:j,vertical:P,scrollButtons:c,textColor:F,variant:A,visibleScrollbar:ae,fixed:!_,hideScrollbar:_&&!ae,scrollableX:_&&!P,scrollableY:_&&P,centered:B&&!_,scrollButtonsHideMobile:!k}),I=jo(O),oe=pe({elementType:C.StartScrollButtonIcon,externalSlotProps:X.startScrollButtonIcon,ownerState:O}),nt=pe({elementType:C.EndScrollButtonIcon,externalSlotProps:X.endScrollButtonIcon,ownerState:O}),[Ee,at]=d.useState(!1),[re,Pe]=d.useState(Ke),[Re,it]=d.useState(!1),[We,ct]=d.useState(!1),[Me,dt]=d.useState(!1),[Le,ut]=d.useState({overflow:"hidden",scrollbarWidth:0}),Ne=new Map,U=d.useRef(null),se=d.useRef(null),$e=()=>{const l=U.current;let a;if(l){const b=l.getBoundingClientRect();a={clientWidth:l.clientWidth,scrollLeft:l.scrollLeft,scrollTop:l.scrollTop,scrollLeftNormalized:ro(l,h?"rtl":"ltr"),scrollWidth:l.scrollWidth,top:b.top,bottom:b.bottom,left:b.left,right:b.right}}let f;if(l&&z!==!1){const b=se.current.children;if(b.length>0){const T=b[Ne.get(z)];f=T?T.getBoundingClientRect():null}}return{tabsMeta:a,tabMeta:f}},ie=xe(()=>{const{tabsMeta:l,tabMeta:a}=$e();let f=0,b;if(P)b="top",a&&l&&(f=a.top-l.top+l.scrollTop);else if(b=h?"right":"left",a&&l){const L=h?l.scrollLeftNormalized+l.clientWidth-l.scrollWidth:l.scrollLeft;f=(h?-1:1)*(a[b]-l[b]+L)}const T={[b]:f,[N]:a?a[N]:0};if(isNaN(re[b])||isNaN(re[N]))Pe(T);else{const L=Math.abs(re[b]-T[b]),D=Math.abs(re[N]-T[N]);(L>=1||D>=1)&&Pe(T)}}),fe=(l,{animation:a=!0}={})=>{a?ho(Y,U.current,l,{duration:s.transitions.duration.standard}):U.current[Y]=l},Fe=l=>{let a=U.current[Y];P?a+=l:(a+=l*(h?-1:1),a*=h&&lt()==="reverse"?-1:1),fe(a)},ze=()=>{const l=U.current[V];let a=0;const f=Array.from(se.current.children);for(let b=0;b<f.length;b+=1){const T=f[b];if(a+T[V]>l){b===0&&(a=l);break}a+=T[V]}return a},ht=()=>{Fe(-1*ze())},pt=()=>{Fe(ze())},bt=d.useCallback(l=>{ut({overflow:null,scrollbarWidth:l})},[]),ft=()=>{const l={};l.scrollbarSizeListener=_?r.jsx(Ro,{onChange:bt,className:Q(I.scrollableX,I.hideScrollbar)}):null;const f=_&&(c==="auto"&&(Re||We)||c===!0);return l.scrollButtonStart=f?r.jsx($,w({slots:{StartScrollButtonIcon:C.StartScrollButtonIcon},slotProps:{startScrollButtonIcon:oe},orientation:j,direction:h?"right":"left",onClick:ht,disabled:!Re},M,{className:Q(I.scrollButtons,M.className)})):null,l.scrollButtonEnd=f?r.jsx($,w({slots:{EndScrollButtonIcon:C.EndScrollButtonIcon},slotProps:{endScrollButtonIcon:nt},orientation:j,direction:h?"left":"right",onClick:pt,disabled:!We},M,{className:Q(I.scrollButtons,M.className)})):null,l},Ae=xe(l=>{const{tabsMeta:a,tabMeta:f}=$e();if(!(!f||!a)){if(f[K]<a[K]){const b=a[Y]+(f[K]-a[K]);fe(b,{animation:l})}else if(f[u]>a[u]){const b=a[Y]+(f[u]-a[u]);fe(b,{animation:l})}}}),de=xe(()=>{_&&c!==!1&&dt(!Me)});d.useEffect(()=>{const l=rt(()=>{U.current&&ie()});let a;const f=L=>{L.forEach(D=>{D.removedNodes.forEach(ce=>{var J;(J=a)==null||J.unobserve(ce)}),D.addedNodes.forEach(ce=>{var J;(J=a)==null||J.observe(ce)})}),l(),de()},b=st(U.current);b.addEventListener("resize",l);let T;return typeof ResizeObserver<"u"&&(a=new ResizeObserver(l),Array.from(se.current.children).forEach(L=>{a.observe(L)})),typeof MutationObserver<"u"&&(T=new MutationObserver(f),T.observe(se.current,{childList:!0})),()=>{var L,D;l.clear(),b.removeEventListener("resize",l),(L=T)==null||L.disconnect(),(D=a)==null||D.disconnect()}},[ie,de]),d.useEffect(()=>{const l=Array.from(se.current.children),a=l.length;if(typeof IntersectionObserver<"u"&&a>0&&_&&c!==!1){const f=l[0],b=l[a-1],T={root:U.current,threshold:.99},L=ge=>{it(!ge[0].isIntersecting)},D=new IntersectionObserver(L,T);D.observe(f);const ce=ge=>{ct(!ge[0].isIntersecting)},J=new IntersectionObserver(ce,T);return J.observe(b),()=>{D.disconnect(),J.disconnect()}}},[_,c,Me,R==null?void 0:R.length]),d.useEffect(()=>{at(!0)},[]),d.useEffect(()=>{ie()}),d.useEffect(()=>{Ae(Ke!==re)},[Ae,re]),d.useImperativeHandle(m,()=>({updateIndicator:ie,updateScrollButtons:de}),[ie,de]);const Oe=r.jsx(Po,w({},S,{className:Q(I.indicator,S.className),ownerState:O,style:w({},re,S.style)}));let ue=0;const mt=d.Children.map(R,l=>{if(!d.isValidElement(l))return null;const a=l.props.value===void 0?ue:l.props.value;Ne.set(a,ue);const f=a===z;return ue+=1,d.cloneElement(l,w({fullWidth:A==="fullWidth",indicator:f&&!Ee&&Oe,selected:f,selectionFollowsFocus:g,onChange:W,textColor:F,value:a},ue===1&&z===!1&&!l.props.tabIndex?{tabIndex:0}:{}))}),gt=l=>{const a=se.current,f=St(a).activeElement;if(f.getAttribute("role")!=="tab")return;let T=j==="horizontal"?"ArrowLeft":"ArrowUp",L=j==="horizontal"?"ArrowRight":"ArrowDown";switch(j==="horizontal"&&h&&(T="ArrowRight",L="ArrowLeft"),l.key){case T:l.preventDefault(),he(a,f,Ge);break;case L:l.preventDefault(),he(a,f,Ue);break;case"Home":l.preventDefault(),he(a,null,Ue);break;case"End":l.preventDefault(),he(a,null,Ge);break}},me=ft();return r.jsxs(Io,w({className:Q(I.root,y),ownerState:O,ref:n,as:p},E,{children:[me.scrollButtonStart,me.scrollbarSizeListener,r.jsxs(ko,{className:I.scroller,ownerState:O,style:{overflow:Le.overflow,[P?`margin${h?"Left":"Right"}`:"marginBottom"]:ae?void 0:-Le.scrollbarWidth},ref:U,children:[r.jsx(Eo,{"aria-label":x,"aria-labelledby":v,"aria-orientation":j==="vertical"?"vertical":null,className:I.flexContainer,ownerState:O,onKeyDown:gt,ref:se,role:"tablist",children:mt}),Ee&&Oe]}),me.scrollButtonEnd]}))}),Mo=Wo;function Lo({searchTerm:e}){var j,$;const{vehicles_details:t}=te(c=>c.dashboard),{breakdownTopics:n,UpdatedBreakdownData:i}=te(c=>c.breakdown),{UpdatedInspectionData:s}=te(c=>c.inspection),{w_customer_id:h}=te(c=>c.auth),[x,v]=d.useState(null),[m,B]=d.useState(""),[R,y]=d.useState(!1);let p=ke(),k=JSON.parse(localStorage.getItem("w_userDetails"));d.useEffect(()=>{console.log("UpdatedInspectionData",s)},[s]),d.useEffect(()=>{s&&(v(s.attachment),B("edit"))},[s]);const o=Xt({initialValues:{vehicle:((j=s==null?void 0:s.vehicle)==null?void 0:j.id)||"",breakdown_topic:(($=s==null?void 0:s.breakdown_topic)==null?void 0:$.id)||"",odometer_reading:(s==null?void 0:s.odometer_reading)||"",description:(s==null?void 0:s.description)||"",mob_no:(s==null?void 0:s.mob_no)||"",email:(s==null?void 0:s.email)||"",attachment:(s==null?void 0:s.attachment)||"",submitted_by:`${k.first_name} ${k.last_name}`||"",resolved_issue:"",pending_issue:"",status:"Open"},validationSchema:Vt({vehicle:q().required("Vehicle is required"),breakdown_topic:q().required("Breakdown Topic is required"),odometer_reading:q().required("Odometer Reading is required"),description:q().required("Description is required"),mob_no:q().matches(/^\d{10,11}$/,"Mobile number must be 10-11 digits").required("Mobile number is required"),email:q().email("Invalid email format").required("Email is required"),resolved_issue:q().required("Resolved issue is required"),pending_issue:q().required("Pending issue is required"),status:q().oneOf(["Open","Close","Rejected"],"Invalid status").required("Status is required"),submitted_by:q().required("Submitted is required")}),onSubmit:async(c,{resetForm:g})=>{try{y(!0),console.log("Submitted values:",c),c.submitted_by=k.user_id,c.location=i.location,c.breakdown=i.id,c.workshop_group=i.workshop_group.id;const C=[];if(i){if(i.attachment){let F=await yt(i.attachment);console.log("file conversion",F),c.attachment=F}const M=i.id;C.push(p(wt({values:c,id:M})))}C.push(p(Bt({values:c})));const X=await Promise.allSettled(C);let S=!0;X.forEach((M,F)=>{if(M.status==="fulfilled"){const z=M.value.payload;z.success?(F===0&&i?ee.success("Breakdown updated successfully!"):ee.success("Inspection created successfully!"),g(),B(""),v(null),p(Ve(null)),p(et(!1)),p(Ct(null)),p(De(!1)),p(we(h)),p(tt()),y(!1)):(S=!1,ee.error(z.error||"Failed to submit breakdown or inspection"))}else S=!1,ee.error(M.reason.message||"Error occurred during submission")}),S&&(g(),B(""),v(null),p(Ve(null)),p(De(!1)),p(_t(!1)),p(we(h))),y(!1)}catch(C){console.error("Submission Error:",C),ee.error("Failed to submit breakdown or inspection. Please try again."),y(!1)}}}),W=c=>{const g=c.currentTarget.files[0];if(o.setFieldValue("attachment",g),B((g==null?void 0:g.name)||""),g&&g.type.startsWith("image/")){const C=new FileReader;C.onload=()=>v(C.result),C.readAsDataURL(g)}else v(null)};return r.jsx(H,{sx:{p:3,maxWidth:600,margin:"auto"},children:R?r.jsx(Be,{children:"Submitted the form data..."}):r.jsx(r.Fragment,{children:r.jsxs("form",{onSubmit:o.handleSubmit,children:[r.jsx(Xe,{options:t,getOptionLabel:c=>c.registration_id,value:t.find(c=>c.id===o.values.vehicle)||null,onChange:(c,g)=>o.setFieldValue("vehicle",(g==null?void 0:g.id)||""),renderInput:c=>r.jsx(G,{...c,label:"Vehicle",error:o.touched.vehicle&&!!o.errors.vehicle,helperText:o.touched.vehicle&&o.errors.vehicle,fullWidth:!0})}),r.jsx(Xe,{options:n,getOptionLabel:c=>c.topic,value:n.find(c=>c.id===o.values.breakdown_topic)||null,onChange:(c,g)=>o.setFieldValue("breakdown_topic",(g==null?void 0:g.id)||""),renderOption:(c,g)=>d.createElement("li",{...c,key:g.id},g.topic),renderInput:c=>r.jsx(G,{...c,label:"Breakdown Topic",error:o.touched.breakdown_topic&&!!o.errors.breakdown_topic,helperText:o.touched.breakdown_topic&&o.errors.breakdown_topic,fullWidth:!0,sx:{mt:2}})}),r.jsx(G,{label:"Odometer Reading",name:"odometer_reading",value:o.values.odometer_reading,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.odometer_reading&&!!o.errors.odometer_reading,helperText:o.touched.odometer_reading&&o.errors.odometer_reading,fullWidth:!0,sx:{mt:2}}),r.jsx(G,{label:"Description",name:"description",value:o.values.description,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.description&&!!o.errors.description,helperText:o.touched.description&&o.errors.description,fullWidth:!0,sx:{mt:2}}),r.jsx(G,{label:"Mobile Number",name:"mob_no",value:o.values.mob_no,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.mob_no&&!!o.errors.mob_no,helperText:o.touched.mob_no&&o.errors.mob_no,fullWidth:!0,sx:{mt:2}}),r.jsx(G,{label:"Email",name:"email",type:"email",value:o.values.email,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.email&&!!o.errors.email,helperText:o.touched.email&&o.errors.email,fullWidth:!0,sx:{mt:2}}),r.jsx(G,{label:"Submitted By",name:"submitted_by",value:o.values.submitted_by,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.submitted_by&&!!o.errors.submitted_by,helperText:o.touched.submitted_by&&o.errors.submitted_by,fullWidth:!0,sx:{mt:2}}),r.jsx(G,{label:"Resolved Issue",name:"resolved_issue",value:o.values.resolved_issue,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.resolved_issue&&!!o.errors.resolved_issue,helperText:o.touched.resolved_issue&&o.errors.resolved_issue,fullWidth:!0,sx:{mt:2}}),r.jsx(G,{label:"Pending Issue",name:"pending_issue",value:o.values.pending_issue,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.pending_issue&&!!o.errors.pending_issue,helperText:o.touched.pending_issue&&o.errors.pending_issue,fullWidth:!0,sx:{mt:2}}),r.jsxs(Ut,{fullWidth:!0,sx:{mt:2},children:[r.jsx(Gt,{children:"Status"}),r.jsxs(Yt,{label:"Status",name:"status",value:o.values.status,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.status&&!!o.errors.status,children:[r.jsx(Se,{value:"Open",children:"Open"}),r.jsx(Se,{value:"Close",children:"Close"}),r.jsx(Se,{value:"Rejected",children:"Rejected"})]})]}),r.jsxs(qe,{component:"label",sx:{mt:2,border:"1px solid #f5f5f5",color:"black"},children:["Upload Attachment",r.jsx("input",{type:"file",hidden:!0,onChange:W})]}),m&&r.jsxs(Be,{variant:"body2",sx:{mt:1},children:["Uploaded File: ",m]}),x&&r.jsx(H,{component:"img",src:x,alt:"Image Preview",sx:{mt:1,width:"100%",maxHeight:200}}),r.jsx(qe,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3},children:"Submit"})]})})})}function No({where:e}){const{isUpdateInspection:t,UpdatedInspectionData:n}=te(x=>x.inspection);let i=ke();const s=()=>{i(et(!1))},h={fontSize:"18px",fontWeight:500,lineHeight:"18.38px",textAlign:"center",paddingTop:"5px",fontFamily:"ubuntu"};return r.jsxs(H,{sx:{bgcolor:"white",m:"10px",display:"flex",textAlign:"left",justifyContent:"space-between",alignItems:"center",borderRadius:"6px",padding:"20px"},children:[r.jsx(Kt,{}),r.jsx(Be,{variant:"h6",sx:h,children:"New Breakdown Requests"}),r.jsxs(Jt,{open:t,onClose:s,maxWidth:"md",fullWidth:!0,children:[r.jsxs(Zt,{children:["Update Breakdown Status",r.jsx(Tt,{"aria-label":"close",onClick:s,sx:{position:"absolute",right:8,top:8,color:x=>x.palette.grey[500]},children:r.jsx(Ht,{})})]}),r.jsx(Qt,{children:r.jsx(Lo,{})})]})]})}function Ce(e){const{children:t,value:n,index:i,...s}=e;return r.jsx("div",{role:"tabpanel",hidden:n!==i,id:`simple-tabpanel-${i}`,"aria-labelledby":`simple-tab-${i}`,...s,children:n===i&&r.jsx(H,{sx:{p:3},children:t})})}Ce.propTypes={children:ve.node,index:ve.number.isRequired,value:ve.number.isRequired};function Je(e){return{id:`simple-tab-${e}`,"aria-controls":`simple-tabpanel-${e}`}}function $o(){const[e,t]=d.useState(0),n=(i,s)=>{t(s)};return r.jsxs(H,{sx:{width:"100%"},children:[r.jsx(H,{sx:{borderBottom:1,borderColor:"divider"},children:r.jsxs(Mo,{value:e,onChange:n,"aria-label":"basic tabs example",children:[r.jsx(Ye,{label:"Breakdowns",...Je(0)}),r.jsx(Ye,{label:"Services",...Je(1)})]})}),r.jsxs(Ce,{value:e,index:0,children:[r.jsx(No,{where:"inspection"}),r.jsx(Ot,{})]}),r.jsx(Ce,{value:e,index:1,children:r.jsx(qt,{isInspection:!0})})]})}function vr(){const{locationData:e,selectedVehicle:t,selectedParameterList:n}=te(E=>E.liveMap),{mode:i,selectedVehicleGroup:s}=te(E=>E.dashboard),h=Ft(i),[x,v]=d.useState([]),{w_customer_id:m}=te(E=>E.auth),[B,R]=d.useState(),[y,p]=d.useState(!1),[k,o]=d.useState(!1),[W,j]=d.useState([]);d.useState(!0);const[$,c]=d.useState(!1),[g,C]=d.useState(!1),X=JSON.parse(localStorage.getItem("w_userDetails"));let S=ke(),M=jt();d.useEffect(()=>{S(It()),S(kt())},[]),d.useEffect(()=>{Et.includes(X.role)?console.log("you can access this route"):(console.log("you can't access this route"),F())},[]);const F=()=>{console.log("oh! this route not allowed"),M("/dashboard"),ee.error("You're not allowed to access inspection.")};d.useEffect(()=>{z(),S(tt()),S(we(m)),S(Pt())},[]),d.useEffect(()=>{j([]),S(He([{reg_id:"",imei:"",params:[]}]))},[t]);const z=async()=>{try{C(!0);let E=[],_=[];const P=await S(Rt({w_customer_id:m}));if(Array.isArray(P.payload)){P.payload.forEach(u=>{var V,N,O,I;Array.isArray(u.imei)&&u.imei.length>0&&((V=u.imei[0])!=null&&V.mac_id)?(E.push({id:u.id,label:u.registration_id,value:(N=u.imei[0])==null?void 0:N.mac_id,vehilce_type:u==null?void 0:u.segment,chassis_no:u==null?void 0:u.chassis_no,engine_no:u==null?void 0:u.engine_no,workShop:u==null?void 0:u.workshop,registration_id:u==null?void 0:u.registration_id,sell_date:u==null?void 0:u.sell_date,customer_name:u==null?void 0:u.customer_name,vehicle_model:(O=u==null?void 0:u.vehicle_model)==null?void 0:O.name,vehicle_group:u==null?void 0:u.vehicle_group}),_.push((I=u.imei[0])==null?void 0:I.mac_id)):console.error("IMEI data not found for item:",u)});const Y="one",K=_;_.length>0&&S(Wt({type:Y,imei:K})),v(E),S(Mt(E)),C(!1),S(Lt({w_customer_id:m}))}else C(!1),console.error("Unexpected data format:",P),ee.error("Unexpected data format:")}catch(E){console.error("Error fetching vehicle data:",E),ee.error(`Error fetching vehicle data: ${E}`)}},A=async E=>{const{label:_,imei:P,id:Y,reg_id:K,checked:u}=E;R(I=>I.map(oe=>oe.id===Y?{...oe,checked:!u}:oe));let V=[...W],N=[...W];if(!u)e.forEach(I=>{I.latestDocument.imei===P&&(V.push({label:_,value:I.latestDocument[_==="maininputvoltage"?"mainInputVoltage":_]}),N=V,j(V))});else{let I=W.filter(oe=>oe.label!==_);N=I,j(I)}console.log("tempParamList",N),S(He([{reg_id:K,imei:P,params:N}]))},ae=x.filter(E=>Object.keys(s).length===0||E.vehicle_group===s.id);return r.jsxs("div",{className:"app",children:[r.jsx(At,{}),r.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[r.jsx(oo,{title:"Inspections",setShowVehicles:p,showVehicles:y,setShowVehiclesGroup:c,showVehiclesGroup:$}),r.jsx(Dt,{setShowVehiclesGroup:c,showVehiclesGroup:$}),r.jsxs(H,{style:{display:"flex",width:"100%",height:"95vh"},children:[r.jsx(H,{style:{width:y||k?"80%":"100%",background:Nt.bgShadow},children:r.jsx($o,{})}),y&&r.jsx(H,{style:{width:"20%",backgroundColor:h.grey[100]},children:r.jsx($t,{vehicleData:ae,title:"Inspections",setParameterData:R,loadingVehicle:g,setShowVehicles:p,showVehicles:y,showParameters:k,setShowParameters:o})}),k&&r.jsx(H,{style:{width:"20%",backgroundColor:h.grey[100]},children:r.jsx(zt,{parametersData:B,setParameterData:R,handleParameterChange:A})})]})]})]})}export{vr as default};
