import{j as s,ak as ie,al as de,am as ue,an as he,J as ee,v as X,w as I,e as o,B as j,q as se,cU as pe,cV as be,ao as _e,C as z,a9 as le,cW as ge,V as U,cX as ae,M as xe,bF as ne,bQ as fe,bP as je,bR as ke,bS as Ce,bT as te,bU as u,bV as De,cK as Se,aD as Be,cO as ve,cP as ce,co as ye,cY as me,ap as oe,a4 as Te,a5 as Pe,a8 as Ae,a7 as Ve,Z as $e,a0 as Le,z as Ie}from"./index-B2ZlNlRE.js";import{V as Ee}from"./VehicleMenu-8stJX0qy.js";import"./Loader-BIvjZLK7.js";import"./LiveMapServices-B4mCCwzS.js";import{P as Re}from"./Parameters-B-Bb244u.js";/* empty css           */import{D as Oe}from"./DialogContentText-VtAUNg5T.js";import{E as Ye,T as Ue}from"./Edit-CiGnqifa.js";import{D as Me,T as Ne,d as Ge}from"./excelUtils-ydDYs-q0.js";import{a as He,B as Je}from"./BreakDownJobCardTable-B2OnnDZr.js";import{A as Fe}from"./AddBreakdown-CjKIqBV-.js";import"./index.esm-enTKG49W.js";import{S as We}from"./ServicesTopBar-Do_ZudnO.js";import"./Autocomplete-C9-NI_FV.js";import"./TextField-DVigl5yY.js";import"./Card-DNIDBit1.js";import"./CardContent-DAmmmgkF.js";import"./formik.esm-CEJL6TCQ.js";import"./Add-DepLaFgQ.js";import"./useMediaQuery-CQXn2zXn.js";const qe=({open:p,onClose:d,onConfirm:b})=>s.jsxs(ie,{open:p,onClose:d,children:[s.jsx(de,{children:"Confirm Deletion"}),s.jsx(ue,{children:s.jsxs(Oe,{children:["Are you sure you want to delete this vehicle data?"," ",s.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),s.jsxs(he,{children:[s.jsx(ee,{onClick:d,color:"primary",children:"Cancel"}),s.jsx(ee,{onClick:b,color:"secondary",children:"Delete"})]})]}),ze="https://cc.wikitrak.in/api-proxy/api/v1",Qe={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Ze=({breakdownData:p,status:d})=>{const b=X(),{isUpdateBreakdown:k}=I(g=>g.equipment),{w_customer_id:V}=I(g=>g.auth),[_,S]=o.useState(!1),B=()=>{console.log("breakdownData",p),localStorage.getItem("role"),b(pe(!k)),b(be(p))},E=()=>{console.log("dlt btn clicked"),localStorage.getItem("role"),S(!0)},v=async()=>{console.log("breakdownData data deleting");try{await _e.delete(`${ze}/vehicles/new/breakdown/create/${p.id}/`),z.success("breakdownData data deleted successfully!"),b(le(V))}catch(g){console.error("Error deleting breakdown data:",g),z.error("Failed to delete breakdown data. Please try again.")}S(!1)},$=()=>{S(!1)},M={color:"#686868"};return s.jsxs(j,{sx:Qe,children:[s.jsx(se,{onClick:B,color:"primary",disabled:(d==null?void 0:d.toLowerCase())==="rejected"||(d==null?void 0:d.toLowerCase())==="close",children:s.jsx(Ye,{})}),s.jsx(se,{onClick:E,children:s.jsx(Me,{sx:M})}),s.jsx(qe,{open:_,onClose:$,onConfirm:v})]})},re=[{id:"breakdown_id",label:"BDID"},{id:"registration_id",label:"Vehicle No"},{id:"breakdown_topic",label:"Topic"},{id:"breakdown_sub_topic",label:"Sub Topic"},{id:"user",label:"Created"},{id:"technician",label:"Technician"},{id:"contact_person",label:"Contact person"},{id:"mob_no",label:"Contact person mobile"},{id:"description",label:"Cust. complaint"},{id:"submission_date",label:"Submission Date"},{id:"submission_time",label:"Submission Time"},{id:"status",label:"Status"}],Ke=()=>{const{breakdowns:p}=I(e=>e.breakdown),{searchTerm:d}=I(e=>e.inspection),b=X(),[k,V]=o.useState("asc"),[_,S]=o.useState("BDID"),[B,E]=o.useState(0),[v,$]=o.useState(8),[M,g]=o.useState(!1),[R,W]=o.useState(null),[O,Q]=o.useState("breakdown_id");o.useState({id:"",status:"",workshop:"",user:""}),o.useEffect(()=>{b(ge({}))},[]);const N=e=>{V(_===e&&k==="asc"?"desc":"asc"),S(e)},G=(e,r)=>{E(r)},Z=e=>{$(parseInt(e.target.value,10)),E(0)},H=(e,r,n)=>!r||!n?e:e.filter(a=>(()=>{var c,l,h,y,m,T,P,A,F,D;switch(r){case"breakdown_id":return((a==null?void 0:a.breakdown_id)||"").toString();case"registration_id":return((c=a==null?void 0:a.vehicle)==null?void 0:c.registration_id)||"";case"breakdown_topic":return((l=a==null?void 0:a.breakdown_topic)==null?void 0:l.topic)||"";case"user_name":return`${((y=(h=a==null?void 0:a.user)==null?void 0:h.us_user)==null?void 0:y.first_name)||""} ${((T=(m=a==null?void 0:a.user)==null?void 0:m.us_user)==null?void 0:T.last_name)||""}`;case"technician_name":return`${((A=(P=a==null?void 0:a.technician)==null?void 0:P.us_user)==null?void 0:A.first_name)||""} ${((D=(F=a==null?void 0:a.technician)==null?void 0:F.us_user)==null?void 0:D.last_name)||""}`;case"contact_person":return(a==null?void 0:a.contact_person)||"";case"mob_no":return(a==null?void 0:a.mob_no)||"";case"submission_date":return a!=null&&a.submission_date?U(a.submission_date).format("YYYY-MM-DD"):"";case"start_time":return a!=null&&a.submission_date?U(a.submission_date).format("HH:mm A"):"";case"status":return(a==null?void 0:a.status)||"";default:return""}})().toLowerCase().includes(n.toLowerCase())),q=(e,r,n,a)=>{if(a==="User"){const t=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),c=`${r.user.us_user.first_name} ${r.user.us_user.last_name}`.toLowerCase();return n==="asc"?t.localeCompare(c):c.localeCompare(t)}if(a==="WorkshopGroup"){const t=e.workshop_group.group_name.toLowerCase(),c=r.workshop_group.group_name.toLowerCase();return n==="asc"?t.localeCompare(c):c.localeCompare(t)}if(a==="BDID"){const t=parseInt(e.breakdown_id.replace("BD-",""),10),c=parseInt(r.breakdown_id.replace("BD-",""),10);return n==="asc"?t-c:c-t}if(a==="SubmissionDate"){const t=new Date(e.submission_date),c=new Date(r.submission_date);return n==="asc"?t-c:c-t}if(a==="Status"){const t={Open:1,Close:2,Rejected:3},c=t[e.status]||0,l=t[r.status]||0;return n==="asc"?c-l:l-c}return 0},L=H((p==null?void 0:p.slice())||[],O,d).sort((e,r)=>q(e,r,k,_)),x=L.slice(B*v,B*v+v);console.log(x,"paginatedData");const J={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},K=L&&L.map(e=>{var n,a,t,c,l,h,y,m,T,P,A,F;const r=e!=null&&e.breakdown_parts&&(e==null?void 0:e.breakdown_parts.length)>0?e==null?void 0:e.breakdown_parts.map((D,es)=>{var w;return`${(w=D==null?void 0:D.spare_parts)==null?void 0:w.description}: Qty ${D==null?void 0:D.quantity}`}).join(";"):"N/A";return{BDID:(e==null?void 0:e.breakdown_id)||"","Registration ID":((n=e==null?void 0:e.vehicle)==null?void 0:n.registration_id)||"","Breakdown Topic":((a=e==null?void 0:e.breakdown_topic)==null?void 0:a.topic)||"","Breakdown Sub Topic":((c=(t=e.breakdown_topic)==null?void 0:t.breakdown_sub_topic)==null?void 0:c.name)||"","Customer Complaint":(e==null?void 0:e.description)||"","Created By":`${((h=(l=e==null?void 0:e.user)==null?void 0:l.us_user)==null?void 0:h.first_name)||""} ${((m=(y=e==null?void 0:e.user)==null?void 0:y.us_user)==null?void 0:m.last_name)||""}`,"Technician Name":`${((P=(T=e==null?void 0:e.technician)==null?void 0:T.us_user)==null?void 0:P.first_name)||""} ${((F=(A=e==null?void 0:e.technician)==null?void 0:A.us_user)==null?void 0:F.last_name)||""}`,"Contact Person":(e==null?void 0:e.contact_person)||"","Mobile No":(e==null?void 0:e.mob_no)||"","Submission Date":e!=null&&e.submission_date?U(e.submission_date).format("YYYY-MM-DD"):"","Submission Time":e!=null&&e.submission_date?U(e.submission_date).format("HH:mm A"):"",Status:(e==null?void 0:e.status)||"","Spare parts":r}});let Y=ae("Breakdown"),i=ae("Job Card");const f=(i==null?void 0:i.includes("Create"))||i==="Read-Write-Only",C=(Y==null?void 0:Y.includes("Update"))||Y==="Read-Write-Only";return s.jsxs(j,{sx:{m:"10px"},children:[s.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[s.jsx(Ne,{columns:re,selectedColumn:O,onColumnChange:Q,searchTerm:d,onSearchChange:e=>b(xe(e))}),s.jsx(ne,{variant:"contained",color:"success",onClick:()=>Ge(K,"breakdown-tickets.xlsx"),children:"Download Excel"})]}),s.jsxs(fe,{children:[s.jsx(je,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(ke,{stickyHeader:!0,children:[s.jsx(Ce,{children:s.jsxs(te,{children:[re.map(e=>s.jsx(u,{sx:J,children:s.jsx(Ue,{active:_===e.id,direction:_===e.id?k:"asc",onClick:()=>N(e.id),children:e.label})},e.id)),C&&s.jsx(u,{sx:J,children:"Action"}),f&&s.jsx(u,{sx:J,children:"Job card"})]})}),s.jsx(De,{children:x.map((e,r)=>{var n,a,t,c,l,h,y,m,T,P,A;return s.jsxs(te,{children:[s.jsx(u,{children:e==null?void 0:e.breakdown_id}),s.jsx(u,{children:(n=e==null?void 0:e.vehicle)==null?void 0:n.registration_id}),s.jsx(u,{children:(a=e==null?void 0:e.breakdown_topic)==null?void 0:a.topic}),s.jsx(u,{children:(t=e==null?void 0:e.breakdown_sub_topic)==null?void 0:t.name}),s.jsx(u,{children:`${(l=(c=e==null?void 0:e.user)==null?void 0:c.us_user)==null?void 0:l.first_name} ${(y=(h=e==null?void 0:e.user)==null?void 0:h.us_user)==null?void 0:y.last_name}`}),s.jsx(u,{children:`${((T=(m=e==null?void 0:e.technician)==null?void 0:m.us_user)==null?void 0:T.first_name)||"N/A"} ${((A=(P=e==null?void 0:e.technician)==null?void 0:P.us_user)==null?void 0:A.last_name)||""}`}),s.jsx(u,{children:e==null?void 0:e.contact_person}),s.jsx(u,{children:e==null?void 0:e.mob_no}),s.jsx(u,{children:e==null?void 0:e.description}),s.jsx(u,{children:(e==null?void 0:e.submission_date)&&U(e.submission_date).format("YYYY-MM-DD")||"N/A"}),s.jsx(u,{children:(e==null?void 0:e.submission_date)&&U(e.submission_date).format("HH:mm A")||"N/A"}),s.jsx(u,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),C&&s.jsx(u,{children:s.jsx(Ze,{breakdownData:e,status:e.status})}),f&&s.jsx(u,{children:s.jsx(ne,{variant:"outlined",onClick:()=>{g(!0),W(e)},disabled:e.jobcard,children:"Create job card"})})]},r)})})]})}),s.jsx(Se,{component:"div",count:L.length,page:B,onPageChange:G,rowsPerPage:v,onRowsPerPageChange:Z,rowsPerPageOptions:[5,10,15]}),s.jsx(He,{rowData:R,open:M,handleClose:()=>g(!1),isTechnician:!0})]})]})},Xe=Ke;function we(){const[p]=Be(),d=p.get("tab"),[b,k]=o.useState(0),V=(_,S)=>{k(S)};return o.useEffect(()=>{d&&k(Number(d))},[]),s.jsxs(j,{sx:{width:"100%"},children:[s.jsx(j,{sx:{borderBottom:1,borderColor:"divider"},children:s.jsxs(ve,{value:b,onChange:V,"aria-label":"Breakdown Tabs",children:[s.jsx(ce,{label:"Breakdown Tickets"}),s.jsx(ce,{label:"Breakdown Job Cards"})]})}),s.jsxs(j,{sx:{mt:2},children:[b===0&&s.jsx(Xe,{}),b===1&&s.jsx(Je,{})]})]})}function Cs(){const{locationData:p,selectedVehicle:d,selectedParameterList:b,onlineVehicle:k}=I(i=>i.liveMap),{mode:V,selectedVehicleGroup:_,vehicleZone:S}=I(i=>i.dashboard),B=Ie(V),[E,v]=o.useState([]),{w_customer_id:$}=I(i=>i.auth),[M,g]=o.useState(),[R,W]=o.useState(!1),[O,Q]=o.useState(!1),[N,G]=o.useState([]);o.useState(!0);const[Z,H]=o.useState(!1),[q,L]=o.useState(!1);let x=X();o.useEffect(()=>{J(),x(ye()),x(le($)),x(me())},[]),o.useEffect(()=>{console.log("selectedVehicleGroup",_)},[_]),o.useEffect(()=>{G([]),x(oe([{reg_id:"",imei:"",params:[]}]))},[d]);const J=async()=>{try{H(!0);let i=[],f=[];const C=await x(Te({w_customer_id:$}));if(Array.isArray(C.payload)){C.payload.forEach(n=>{var a,t,c,l;Array.isArray(n.imei)&&n.imei.length>0&&((a=n.imei[0])!=null&&a.mac_id)?(i.push({id:n.id,label:n.registration_id,value:(t=n.imei[0])==null?void 0:t.mac_id,vehilce_type:n==null?void 0:n.segment,chassis_no:n==null?void 0:n.chassis_no,engine_no:n==null?void 0:n.engine_no,workShop:n==null?void 0:n.workshop,registration_id:n==null?void 0:n.registration_id,sell_date:n==null?void 0:n.sell_date,customer_name:n==null?void 0:n.customer_name,vehicle_model:(c=n==null?void 0:n.vehicle_model)==null?void 0:c.name,user:n==null?void 0:n.user,vehicle_group:n==null?void 0:n.vehicle_group}),f.push((l=n.imei[0])==null?void 0:l.mac_id)):console.error("IMEI data not found for item:",n)});const e="one",r=f;f.length>0&&x(Pe({type:e,imei:r})),v(i),x(Ae({w_customer_id:$})),x(Ve(i)),H(!1)}else H(!1),console.error("Unexpected data format:",C),z.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),z.error(`Error fetching vehicle data: ${i}`)}},K=async i=>{const{label:f,imei:C,id:e,reg_id:r,checked:n}=i;g(l=>l.map(h=>h.id===e?{...h,checked:!n}:h));let a=[...N],t=[...N];if(!n)p.forEach(l=>{l.latestDocument.imei===C&&(a.push({label:f,value:l.latestDocument[f==="maininputvoltage"?"mainInputVoltage":f]}),t=a,G(a))});else{let l=N.filter(h=>h.label!==f);t=l,G(l)}console.log("tempParamList",t),x(oe([{reg_id:r,imei:C,params:t}]))},Y=E.filter(i=>Object.keys(_).length===0||i.vehicle_group===_.id);return s.jsxs("div",{className:"app",children:[s.jsx($e,{}),s.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[s.jsx(We,{title:"Breakdown",setShowVehicles:W,showVehicles:R,setShowVehiclesGroup:L,showVehiclesGroup:q}),s.jsx(Le,{setShowVehiclesGroup:L,showVehiclesGroup:q}),s.jsxs(j,{style:{display:"flex",width:"100%",height:"95vh"},children:[s.jsxs(j,{style:{width:R||O?"80%":"100%"},children:[s.jsx(Fe,{where:"Breakdown"}),s.jsx(we,{})]}),R&&s.jsx(j,{style:{width:"20%",backgroundColor:B.grey[100]},children:s.jsx(Ee,{vehicleData:Y,title:"Inspections",setParameterData:g,loadingVehicle:Z,setShowVehicles:W,showVehicles:R,showParameters:O,setShowParameters:Q})}),O&&s.jsx(j,{style:{width:"20%",backgroundColor:B.grey[100]},children:s.jsx(Re,{parametersData:M,setParameterData:g,handleParameterChange:K})})]})]})]})}export{Cs as default};
