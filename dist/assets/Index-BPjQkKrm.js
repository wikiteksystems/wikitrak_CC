import{R as J,o as D,j as e,C as F,ag as X,ah as Z,m as $,ac as q,ai as z,bN as G,r,B as h,eT as H,eU as T,eW as K,eX as Q,e_ as Y,eZ as ee,p as P,am as A,a0 as se,a1 as ae,a3 as te,V as B,U as re,v as oe}from"./index-rJKC5kjD.js";import{V as ie}from"./VehicleMenu-C5wAK07t.js";import"./Loader-NF5TPeeb.js";import{P as ne}from"./Parameters-DGM56T4G.js";/* empty css           */import"./index.esm-CEVXtRC0.js";import{C as le,S as ce}from"./ServiceRecordTable-457lyMxc.js";import{S as de}from"./ServiceJobCardTable-BYUgpD8O.js";import{S as he}from"./ServicesTopBar-C9wtvMit.js";import"./Autocomplete-B2Typk08.js";import"./TextField-W0cXux5x.js";import"./Card-BxFMOVCc.js";import"./CardContent-Bp_7u0mY.js";import"./ServiceJobCard-Dp_yfnpC.js";import"./formik.esm-qVM3QrQ9.js";import"./Remove-DCgaVOEP.js";import"./excelUtils-Dh47Wo3v.js";import"./Edit-CpP3oP6N.js";function pe(){const[i,t]=J.useState(!1);D();const n=()=>t(!0),c=()=>t(!1);return e.jsxs("div",{children:[e.jsx(F,{variant:"outlined",onClick:n,children:"+ Add New Entry"}),e.jsxs(X,{open:i,onClose:c,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[e.jsxs(Z,{children:["+ Add new service entry",e.jsx($,{"aria-label":"close",onClick:c,sx:{position:"absolute",right:8,top:8},children:e.jsx(q,{})})]}),e.jsx(z,{dividers:!0,children:e.jsx(le,{setOpen:t})})]})]})}function ue(){const[i]=G(),t=i.get("tab"),[n,c]=r.useState(0);r.useEffect(()=>{t&&c(Number(t))},[]);const g=(L,v)=>{c(v)};return e.jsxs(h,{sx:{width:"100%"},children:[e.jsx(h,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(H,{value:n,onChange:g,"aria-label":"Breakdown Tabs",children:[e.jsx(T,{label:"Service Tickets"}),e.jsx(T,{label:"Service Job Cards"})]})}),e.jsxs(h,{sx:{mt:2},children:[n===0&&e.jsx(ce,{isInspection:!1}),n===1&&e.jsx(de,{isInspection:!1})]})]})}const xe=()=>{const i=D();r.useEffect(()=>{i(K()),i(Q()),i(Y())},[]);let t=ee("Service");const n=(t==null?void 0:t.includes("Create"))||t==="Read-Write-Only";return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),n&&e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(pe,{})}),"      "]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(ue,{})})]})]})};function Ae(){const{locationData:i,selectedVehicle:t,selectedParameterList:n}=P(a=>a.liveMap),{mode:c}=P(a=>a.dashboard),g=oe(c),[L,v]=r.useState([]),{w_customer_id:I}=P(a=>a.auth),[M,S]=r.useState(),[m,k]=r.useState(!1),[j,E]=r.useState(!1),[y,b]=r.useState([]),[N,R]=r.useState(!0),[U,_]=r.useState(!1);let x=D();r.useEffect(()=>{W()},[]),r.useEffect(()=>{b([]),x(A([{reg_id:"",imei:"",params:[]}]))},[t]);const W=async()=>{try{_(!0);let a=[],l=[];const p=await x(se({w_customer_id:I}));if(Array.isArray(p.payload)){p.payload.forEach(s=>{var u,d,V,o;Array.isArray(s.imei)&&s.imei.length>0&&((u=s.imei[0])!=null&&u.mac_id)?(a.push({id:s.id,label:s.registration_id,value:(d=s.imei[0])==null?void 0:d.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(V=s==null?void 0:s.vehicle_model)==null?void 0:V.name}),l.push((o=s.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",s)});const C="one",w=l;l.length>0&&x(ae({type:C,imei:w})),v(a),x(te(a)),_(!1)}else _(!1),console.error("Unexpected data format:",p),B.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),B.error(`Error fetching vehicle data: ${a}`)}},O=async a=>{const{label:l,imei:p,id:C,reg_id:w,checked:s}=a;S(o=>o.map(f=>f.id===C?{...f,checked:!s}:f));let u=[...y],d=[...y];if(!s)i.forEach(o=>{o.latestDocument.imei===p&&(u.push({label:l,value:o.latestDocument[l==="maininputvoltage"?"mainInputVoltage":l]}),d=u,b(u))});else{let o=y.filter(f=>f.label!==l);d=o,b(o)}console.log("tempParamList",d),x(A([{reg_id:w,imei:p,params:d}]))};return e.jsxs("div",{className:"app",children:[e.jsx(re,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(he,{title:"services",setShowVehicles:k,showVehicles:m,showParameters:j,setShowParameters:E,setShowCard:R,showCard:N}),e.jsxs(h,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(h,{style:{width:m||j?"80%":"100%"},children:e.jsx(xe,{})}),m&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ie,{vehicleData:L,title:"Inspections",setParameterData:S,loadingVehicle:U,setShowVehicles:k,showVehicles:m,showParameters:j,setShowParameters:E})}),j&&e.jsx(h,{style:{width:"20%",backgroundColor:g.grey[100]},children:e.jsx(ne,{parametersData:M,setParameterData:S,handleParameterChange:O})})]})]})]})}export{Ae as default};
