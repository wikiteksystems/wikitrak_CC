import{j as s,F as w,x as X,y as L,b as r,bc as le,bd as ie,ab as de,B as q,a4 as ce,be as ue,L as Y,bf as ee,I as pe,ao as he,aR as be,bg as _e,ac as se,$ as fe,a0 as ge,a3 as xe,a2 as me}from"./index-Cjcv2yiw.js";import{V as je}from"./VehicleMenu-BTFqGXXo.js";import{t as ke}from"./Search-wFQ36W0J.js";import"./Loader-CmKehkq9.js";import"./LiveMapServices-C16_zXrU.js";import"./Socket-CFpJY01f.js";import{P as Ce}from"./Parameters-A0de0iQm.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as De}from"./LeftSideBar2-BLzV6rCI.js";import{D as Se,a as Be,b as ye,c as ve}from"./DialogTitle-D8a1u6PL.js";import{D as Te}from"./DialogContentText-CVoyYXse.js";import{B as m}from"./CircularProgress-Cn0algju.js";import{I as ae}from"./IconButton-B7ebUwQR.js";import{E as Pe,T as Ae}from"./Edit-sisMAAMV.js";import{D as Ve,T as $e,d as Le}from"./excelUtils-JQGYlDTb.js";import{a as Ie,B as Ee}from"./BreakDownJobCardTable-KRA6UAQS.js";import{B as te}from"./button-CZkZ6ZGA.js";import{P as Re}from"./Paper-0bDLGP_t.js";import{T as Oe,a as Ye,b as Ne,c as ne,d as u,e as Ge}from"./TableRow-CU74lMp-.js";import{T as Me}from"./TablePagination-BWnyw0m5.js";import{A as Ue}from"./AddBreakdown-CymZhlE5.js";import"./index.esm-BXIrN0Qv.js";import{V as He}from"./VehicleGroups-ujb7RQ97.js";import{S as Fe}from"./ServicesTopBar-tEAvuHPC.js";import{T as Je,a as oe}from"./Tabs-OZqB44-2.js";import"./RegionSelector-CHsRpA3J.js";import"./SearchTab-Blzx4UAv.js";import"./OutlinedInput-BE-FtkV-.js";import"./InputAdornment-FeX10cGW.js";import"./Select-C2O_k6ln.js";import"./MenuItem-B01abXCo.js";import"./menu2-BCDBIrTl.js";import"./Autocomplete-V9I2sc5o.js";import"./Tooltip-C6d_MvKh.js";import"./usePreviousProps-6n5ImV6D.js";import"./TextField-CaGYm5P2.js";import"./createSvgIcon-8aK18HEv.js";import"./index-H3vNewaO.js";import"./Card-41acQzXU.js";import"./CardContent-DguYpzSv.js";import"./formik.esm-Cr1NXLIG.js";import"./Close-Bbe5XJTL.js";import"./NewLoader-CNewrlCe.js";import"./Add-ZSgupdaR.js";import"./useMediaQuery-CoI7LjqC.js";import"./index-D7n_34d4.js";import"./roundedArrow-DwzcAo8c.js";import"./TextArea-CUxITgO_.js";const We=({open:h,onClose:d,onConfirm:b})=>s.jsxs(Se,{open:h,onClose:d,children:[s.jsx(Be,{children:"Confirm Deletion"}),s.jsx(ye,{children:s.jsxs(Te,{children:["Are you sure you want to delete this vehicle data?"," ",s.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),s.jsxs(ve,{children:[s.jsx(w,{onClick:d,color:"primary",children:"Cancel"}),s.jsx(w,{onClick:b,color:"secondary",children:"Delete"})]})]}),qe="https://cc.wikitrak.in/api-proxy/api/v1",ze={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Qe=({breakdownData:h,status:d})=>{const b=X(),{isUpdateBreakdown:j}=L(f=>f.equipment),{w_customer_id:A}=L(f=>f.auth),[_,D]=r.useState(!1),S=()=>{console.log("breakdownData",h),localStorage.getItem("role"),b(le(!j)),b(ie(h))},I=()=>{console.log("dlt btn clicked"),localStorage.getItem("role"),D(!0)},B=async()=>{console.log("breakdownData data deleting");try{await de.delete(`${qe}/vehicles/new/breakdown/create/${h.id}/`),q.success("breakdownData data deleted successfully!"),b(ce(A))}catch(f){console.error("Error deleting breakdown data:",f),q.error("Failed to delete breakdown data. Please try again.")}D(!1)},V=()=>{D(!1)},N={color:"#686868"};return s.jsxs(m,{sx:ze,children:[s.jsx(ae,{onClick:S,color:"primary",disabled:(d==null?void 0:d.toLowerCase())==="rejected"||(d==null?void 0:d.toLowerCase())==="close",children:s.jsx(Pe,{})}),s.jsx(ae,{onClick:I,children:s.jsx(Ve,{sx:N})}),s.jsx(We,{open:_,onClose:V,onConfirm:B})]})},re=[{id:"breakdown_id",label:"BDID"},{id:"registration_id",label:"Vehicle No"},{id:"breakdown_topic",label:"Topic"},{id:"user",label:"Created"},{id:"technician",label:"Technician"},{id:"contact_person",label:"Contact person"},{id:"mob_no",label:"Contact person mobile"},{id:"description",label:"Cust. complaint"},{id:"submission_date",label:"Submission Date"},{id:"submission_time",label:"Submission Time"},{id:"status",label:"Status"}],Ze=()=>{const{breakdowns:h}=L(e=>e.breakdown),{searchTerm:d}=L(e=>e.inspection),b=X(),[j,A]=r.useState("asc"),[_,D]=r.useState("BDID"),[S,I]=r.useState(0),[B,V]=r.useState(8),[N,f]=r.useState(!1),[E,J]=r.useState(null),[R,z]=r.useState("breakdown_id");r.useState({id:"",status:"",workshop:"",user:""}),r.useEffect(()=>{b(ue({}))},[]);const G=e=>{A(_===e&&j==="asc"?"desc":"asc"),D(e)},M=(e,c)=>{I(c)},Q=e=>{V(parseInt(e.target.value,10)),I(0)},U=(e,c,t)=>!c||!t?e:e.filter(a=>(()=>{var o,l,p,y,v,T,P,C,K,F;switch(c){case"breakdown_id":return((a==null?void 0:a.breakdown_id)||"").toString();case"registration_id":return((o=a==null?void 0:a.vehicle)==null?void 0:o.registration_id)||"";case"breakdown_topic":return((l=a==null?void 0:a.breakdown_topic)==null?void 0:l.topic)||"";case"user_name":return`${((y=(p=a==null?void 0:a.user)==null?void 0:p.us_user)==null?void 0:y.first_name)||""} ${((T=(v=a==null?void 0:a.user)==null?void 0:v.us_user)==null?void 0:T.last_name)||""}`;case"technician_name":return`${((C=(P=a==null?void 0:a.technician)==null?void 0:P.us_user)==null?void 0:C.first_name)||""} ${((F=(K=a==null?void 0:a.technician)==null?void 0:K.us_user)==null?void 0:F.last_name)||""}`;case"contact_person":return(a==null?void 0:a.contact_person)||"";case"mob_no":return(a==null?void 0:a.mob_no)||"";case"submission_date":return a!=null&&a.submission_date?Y(a.submission_date).format("YYYY-MM-DD"):"";case"start_time":return a!=null&&a.submission_date?Y(a.submission_date).format("HH:mm A"):"";case"status":return(a==null?void 0:a.status)||"";default:return""}})().toLowerCase().includes(t.toLowerCase())),W=(e,c,t,a)=>{if(a==="User"){const n=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),o=`${c.user.us_user.first_name} ${c.user.us_user.last_name}`.toLowerCase();return t==="asc"?n.localeCompare(o):o.localeCompare(n)}if(a==="WorkshopGroup"){const n=e.workshop_group.group_name.toLowerCase(),o=c.workshop_group.group_name.toLowerCase();return t==="asc"?n.localeCompare(o):o.localeCompare(n)}if(a==="BDID"){const n=parseInt(e.breakdown_id.replace("BD-",""),10),o=parseInt(c.breakdown_id.replace("BD-",""),10);return t==="asc"?n-o:o-n}if(a==="SubmissionDate"){const n=new Date(e.submission_date),o=new Date(c.submission_date);return t==="asc"?n-o:o-n}if(a==="Status"){const n={Open:1,Close:2,Rejected:3},o=n[e.status]||0,l=n[c.status]||0;return t==="asc"?o-l:l-o}return 0},$=U((h==null?void 0:h.slice())||[],R,d).sort((e,c)=>W(e,c,j,_)),x=$.slice(S*B,S*B+B),H={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},Z=$&&$.map(e=>{var t,a,n,o,l,p,y,v,T,P;const c=e!=null&&e.breakdown_parts&&(e==null?void 0:e.breakdown_parts.length)>0?e==null?void 0:e.breakdown_parts.map((C,K)=>{var F;return`${(F=C==null?void 0:C.spare_parts)==null?void 0:F.description}: Qty ${C==null?void 0:C.quantity}`}).join(";"):"N/A";return{BDID:(e==null?void 0:e.breakdown_id)||"","Registration ID":((t=e==null?void 0:e.vehicle)==null?void 0:t.registration_id)||"","Breakdown Topic":((a=e==null?void 0:e.breakdown_topic)==null?void 0:a.topic)||"","Customer Complaint":(e==null?void 0:e.description)||"","Created By":`${((o=(n=e==null?void 0:e.user)==null?void 0:n.us_user)==null?void 0:o.first_name)||""} ${((p=(l=e==null?void 0:e.user)==null?void 0:l.us_user)==null?void 0:p.last_name)||""}`,"Technician Name":`${((v=(y=e==null?void 0:e.technician)==null?void 0:y.us_user)==null?void 0:v.first_name)||""} ${((P=(T=e==null?void 0:e.technician)==null?void 0:T.us_user)==null?void 0:P.last_name)||""}`,"Contact Person":(e==null?void 0:e.contact_person)||"","Mobile No":(e==null?void 0:e.mob_no)||"","Submission Date":e!=null&&e.submission_date?Y(e.submission_date).format("YYYY-MM-DD"):"","Submission Time":e!=null&&e.submission_date?Y(e.submission_date).format("HH:mm A"):"",Status:(e==null?void 0:e.status)||"","Spare parts":c}});let O=ee("Breakdown"),i=ee("Job Card");const g=(i==null?void 0:i.includes("Create"))||i==="Read-Write-Only",k=(O==null?void 0:O.includes("Update"))||O==="Read-Write-Only";return s.jsxs(m,{sx:{m:"10px"},children:[s.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[s.jsx($e,{columns:re,selectedColumn:R,onColumnChange:z,searchTerm:d,onSearchChange:e=>b(pe(e))}),s.jsx(te,{variant:"contained",color:"success",onClick:()=>Le(Z,"breakdown-tickets.xlsx"),children:"Download Excel"})]}),s.jsxs(Re,{children:[s.jsx(Oe,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(Ye,{stickyHeader:!0,children:[s.jsx(Ne,{children:s.jsxs(ne,{children:[re.map(e=>s.jsx(u,{sx:H,children:s.jsx(Ae,{active:_===e.id,direction:_===e.id?j:"asc",onClick:()=>G(e.id),children:e.label})},e.id)),k&&s.jsx(u,{sx:H,children:"Action"}),g&&s.jsx(u,{sx:H,children:"Job card"})]})}),s.jsx(Ge,{children:x.map((e,c)=>{var t,a,n,o,l,p,y,v,T,P;return s.jsxs(ne,{children:[s.jsx(u,{children:e==null?void 0:e.breakdown_id}),s.jsx(u,{children:(t=e==null?void 0:e.vehicle)==null?void 0:t.registration_id}),s.jsx(u,{children:(a=e==null?void 0:e.breakdown_topic)==null?void 0:a.topic}),s.jsx(u,{children:`${(o=(n=e==null?void 0:e.user)==null?void 0:n.us_user)==null?void 0:o.first_name} ${(p=(l=e==null?void 0:e.user)==null?void 0:l.us_user)==null?void 0:p.last_name}`}),s.jsx(u,{children:`${((v=(y=e==null?void 0:e.technician)==null?void 0:y.us_user)==null?void 0:v.first_name)||"N/A"} ${((P=(T=e==null?void 0:e.technician)==null?void 0:T.us_user)==null?void 0:P.last_name)||""}`}),s.jsx(u,{children:e==null?void 0:e.contact_person}),s.jsx(u,{children:e==null?void 0:e.mob_no}),s.jsx(u,{children:e==null?void 0:e.description}),s.jsx(u,{children:(e==null?void 0:e.submission_date)&&Y(e.submission_date).format("YYYY-MM-DD")||"N/A"}),s.jsx(u,{children:(e==null?void 0:e.submission_date)&&Y(e.submission_date).format("HH:mm A")||"N/A"}),s.jsx(u,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),k&&s.jsx(u,{children:s.jsx(Qe,{breakdownData:e,status:e.status})}),g&&s.jsx(u,{children:s.jsx(te,{variant:"outlined",onClick:()=>{f(!0),J(e)},disabled:e.jobcard,children:"Create job card"})})]},c)})})]})}),s.jsx(Me,{component:"div",count:$.length,page:S,onPageChange:M,rowsPerPage:B,onRowsPerPageChange:Q,rowsPerPageOptions:[5,10,15]}),s.jsx(Ie,{rowData:E,open:N,handleClose:()=>f(!1),isTechnician:!0})]})]})},Ke=Ze;function Xe(){const[h]=he(),d=h.get("tab"),[b,j]=r.useState(0),A=(_,D)=>{j(D)};return r.useEffect(()=>{d&&j(Number(d))},[]),s.jsxs(m,{sx:{width:"100%"},children:[s.jsx(m,{sx:{borderBottom:1,borderColor:"divider"},children:s.jsxs(Je,{value:b,onChange:A,"aria-label":"Breakdown Tabs",children:[s.jsx(oe,{label:"Breakdown Tickets"}),s.jsx(oe,{label:"Breakdown Job Cards"})]})}),s.jsxs(m,{sx:{mt:2},children:[b===0&&s.jsx(Ke,{}),b===1&&s.jsx(Ee,{})]})]})}function zs(){const{locationData:h,selectedVehicle:d,selectedParameterList:b,onlineVehicle:j}=L(i=>i.liveMap),{mode:A,selectedVehicleGroup:_,vehicleZone:D}=L(i=>i.dashboard),S=ke(A),[I,B]=r.useState([]),{w_customer_id:V}=L(i=>i.auth),[N,f]=r.useState(),[E,J]=r.useState(!1),[R,z]=r.useState(!1),[G,M]=r.useState([]);r.useState(!0);const[Q,U]=r.useState(!1),[W,$]=r.useState(!1);let x=X();r.useEffect(()=>{H(),x(be()),x(ce(V)),x(_e())},[]),r.useEffect(()=>{console.log("selectedVehicleGroup",_)},[_]),r.useEffect(()=>{M([]),x(se([{reg_id:"",imei:"",params:[]}]))},[d]);const H=async()=>{try{U(!0);let i=[],g=[];const k=await x(fe({w_customer_id:V}));if(Array.isArray(k.payload)){k.payload.forEach(t=>{var a,n,o,l;Array.isArray(t.imei)&&t.imei.length>0&&((a=t.imei[0])!=null&&a.mac_id)?(i.push({id:t.id,label:t.registration_id,value:(n=t.imei[0])==null?void 0:n.mac_id,vehilce_type:t==null?void 0:t.segment,chassis_no:t==null?void 0:t.chassis_no,engine_no:t==null?void 0:t.engine_no,workShop:t==null?void 0:t.workshop,registration_id:t==null?void 0:t.registration_id,sell_date:t==null?void 0:t.sell_date,customer_name:t==null?void 0:t.customer_name,vehicle_model:(o=t==null?void 0:t.vehicle_model)==null?void 0:o.name,user:t==null?void 0:t.user,vehicle_group:t==null?void 0:t.vehicle_group}),g.push((l=t.imei[0])==null?void 0:l.mac_id)):console.error("IMEI data not found for item:",t)});const e="one",c=g;g.length>0&&x(ge({type:e,imei:c})),B(i),x(xe({w_customer_id:V})),x(me(i)),U(!1)}else U(!1),console.error("Unexpected data format:",k),q.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),q.error(`Error fetching vehicle data: ${i}`)}},Z=async i=>{const{label:g,imei:k,id:e,reg_id:c,checked:t}=i;f(l=>l.map(p=>p.id===e?{...p,checked:!t}:p));let a=[...G],n=[...G];if(!t)h.forEach(l=>{l.latestDocument.imei===k&&(a.push({label:g,value:l.latestDocument[g==="maininputvoltage"?"mainInputVoltage":g]}),n=a,M(a))});else{let l=G.filter(p=>p.label!==g);n=l,M(l)}console.log("tempParamList",n),x(se([{reg_id:c,imei:k,params:n}]))},O=I.filter(i=>Object.keys(_).length===0||i.vehicle_group===_.id);return s.jsxs("div",{className:"app",children:[s.jsx(De,{}),s.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[s.jsx(Fe,{title:"Breakdown",setShowVehicles:J,showVehicles:E,setShowVehiclesGroup:$,showVehiclesGroup:W}),s.jsx(He,{setShowVehiclesGroup:$,showVehiclesGroup:W}),s.jsxs(m,{style:{display:"flex",width:"100%",height:"95vh"},children:[s.jsxs(m,{style:{width:E||R?"80%":"100%"},children:[s.jsx(Ue,{where:"Breakdown"}),s.jsx(Xe,{})]}),E&&s.jsx(m,{style:{width:"20%",backgroundColor:S.grey[100]},children:s.jsx(je,{vehicleData:O,title:"Inspections",setParameterData:f,loadingVehicle:Q,setShowVehicles:J,showVehicles:E,showParameters:R,setShowParameters:z})}),R&&s.jsx(m,{style:{width:"20%",backgroundColor:S.grey[100]},children:s.jsx(Ce,{parametersData:N,setParameterData:f,handleParameterChange:Z})})]})]})]})}export{zs as default};
