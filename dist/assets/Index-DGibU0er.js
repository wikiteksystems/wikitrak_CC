import{a4 as De,j as o,z as ee,b as l,D as Oe,T as X,F as pe,R as nt,y as Te,B as we,a0 as st,a5 as rt,a6 as at,I as lt,C as te,a7 as ct,Q as it,a8 as Ee,V as ut,W as dt,Y as ft,Z as ht,a9 as Ne}from"./index-BjKbbhRI.js";import{L as gt}from"./LiveMapTopBar-DCqOqv4Y.js";import{V as pt}from"./VehicleMenu-BFvFRuTD.js";import{t as xt}from"./SearchTab-DEMuHaIK.js";import{F as yt}from"./Loader-B_-DJcev.js";import{L as bt}from"./LiveMapServices-CIM5n4Jv.js";import{s as _e}from"./Socket-0N_gnJcr.js";import{P as mt}from"./Parameters-s9kQ9Lp8.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as vt}from"./LeftSideBar2-B2rkFzIR.js";import{V as kt}from"./VehicleGroups-B_U8Ld0I.js";import{u as jt,G as wt,M as St}from"./esm-o5lAkwhQ.js";import{M as _t,r as Dt,g as It,y as Ct,b as Mt,a as Vt,c as Lt,d as Rt,e as $t,f as Et,h as Nt,i as At,j as Ot,k as Tt,l as Bt,m as Ft,n as Wt,o as Pt,p as Gt,q as Ht,s as Ut,t as zt,u as qt,v as Kt}from"./black_bike-Dy1znCFH.js";import{d as Be}from"./Close-CyMvo-n1.js";import{r as Ie}from"./createSvgIcon-HQorTm9D.js";import"./NewLoader-xcmT3NLZ.js";import{m as je}from"./motorbike-Ci4voNFa.js";import{d as Yt}from"./Info-B7vlerut.js";import{B as j,C as Xt}from"./CircularProgress-7yZBRxbk.js";import{r as Zt}from"./redTractor-NXgVJyvR.js";import{D as Jt,a as Qt,b as eo,c as to}from"./DialogTitle-B0lUwlBA.js";import{T as oo}from"./TextField-KUr0-h8Y.js";import"./jcb-aCHXMCXy.js";import"./menu2-FiX0qVDV.js";import"./useControlled-BiWaVT-L.js";import"./Autocomplete-xYia0FUg.js";import"./index-Q37k3Ydf.js";import"./Card-OgCobG5k.js";import"./CardContent-KcO03i34.js";var Ce={},no=De;Object.defineProperty(Ce,"__esModule",{value:!0});var Fe=Ce.default=void 0,so=no(Ie()),ro=o;Fe=Ce.default=(0,so.default)((0,ro.jsx)("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"NorthEast");var Me={},ao=De;Object.defineProperty(Me,"__esModule",{value:!0});var We=Me.default=void 0,lo=ao(Ie()),co=o;We=Me.default=(0,lo.default)((0,co.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn");const io=({label:y,value:x})=>o.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[o.jsx(X,{variant:"body2",color:"textSecondary",children:y}),o.jsx(X,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:x||"N/A"})]}),uo=(y,x)=>(y==null?void 0:y.find(D=>{var I,C;return((C=(I=D.imei)==null?void 0:I[0])==null?void 0:C.mac_id)===x}))||{},Ae=({title:y,details:x})=>o.jsx(j,{sx:{width:"45%"},children:x.map(({label:D,value:I})=>o.jsx(io,{label:D,value:I},D))});function fo({handleVehicleInfo:y,udpatedParams:x,handleClickOpen:D}){var se,M,G,z,V,q,J,Q,T,H,ie,re;const{collapsed:I}=ee(p=>p.auth),{vehicleList:C,selectedVehicle:m,selectedImei:P}=ee(p=>p.liveMap),[u,fe]=l.useState({});let[r,oe]=l.useState(null);l.useEffect(()=>{let p=x&&(x==null?void 0:x.length)>0&&(x==null?void 0:x.find(v=>{var $;return Number(($=v==null?void 0:v.latestDocument)==null?void 0:$.imei)===Number(P)}));oe(p)},[x,P]),l.useEffect(()=>{fe(uo(C,P))},[C,P]);const Z=(p,v)=>{const $=`https://www.google.com/maps?q=${p},${v}`;window.open($,"_blank")},ne=p=>{var k,B;let v=(k=p==null?void 0:p.latestDocument)==null?void 0:k.ignition,$=(B=p==null?void 0:p.latestDocument)==null?void 0:B.speed;return v===!0||v===1?$:0},U=[{label:"Vehicle No:",value:u==null?void 0:u.registration_id},{label:"Model:",value:(se=u==null?void 0:u.vehicle_model)==null?void 0:se.name},{label:"IMEI No:",value:(G=(M=u==null?void 0:u.imei)==null?void 0:M[0])==null?void 0:G.mac_id},{label:"Chassis No:",value:u==null?void 0:u.chassis_no},{label:"Engine No:",value:u==null?void 0:u.engine_no}],xe=[{label:"Customer Name:",value:(z=u==null?void 0:u.user)!=null&&z.us_user?`${u.user.us_user.first_name.charAt(0).toUpperCase()}${u.user.us_user.first_name.slice(1)} ${u.user.us_user.last_name.charAt(0).toUpperCase()}${u.user.us_user.last_name.slice(1)}`:null},{label:"Mobile: ",value:((V=u==null?void 0:u.user)==null?void 0:V.us_user)&&u.user.us_user.mobile},{label:"Date of Sell:",value:u==null?void 0:u.sell_date},{label:"Workshop Name:",value:(q=u==null?void 0:u.workshop)==null?void 0:q.name}];let R={border:"2px solid black",borderRadius:"5px",padding:"5px",color:"black"};const he=p=>{let v=C.find(k=>{var B,ae;return((B=k==null?void 0:k.imei)==null?void 0:B.length)>0&&((ae=k.imei[0])==null?void 0:ae.mac_id)==p.imei}),$=parseFloat((v==null?void 0:v.load_capacity)||0)/49*parseFloat((p==null?void 0:p.analogInput1)||0);return`${parseFloat($).toFixed(2)} Kgs`||0};return o.jsxs(j,{sx:{position:"absolute",top:"600px",left:I?"280px":"450px",zIndex:1,background:Oe.bgShadow,p:2,borderRadius:2,color:"white",width:"72%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[o.jsx(X,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),o.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[o.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",width:"100%",marginLeft:"10px"},children:[o.jsx(j,{sx:R,children:o.jsxs(X,{children:["Ignition:"," ",((J=r==null?void 0:r.latestDocument)==null?void 0:J.ignition)===!0||((Q=r==null?void 0:r.latestDocument)==null?void 0:Q.ignition)===1?"On":"Off"]})}),o.jsx(j,{sx:R,children:o.jsxs(X,{children:["Speed: ",ne(r)," km/h"]})}),o.jsx(j,{sx:R,children:o.jsxs(X,{children:["Main Voltage:"," ",r?`${(T=r==null?void 0:r.latestDocument)==null?void 0:T.mainInputVoltage} Voltage`:0]})}),o.jsx(j,{sx:R,children:o.jsxs(X,{children:["Heading:"," ",r?`${(H=r==null?void 0:r.latestDocument)==null?void 0:H.heading} deg`:0]})}),r&&((ie=r==null?void 0:r.latestDocument)==null?void 0:ie.venderId)==="VT200"&&o.jsx(j,{sx:R,children:o.jsxs(X,{children:["Load:"," ",r?he(r==null?void 0:r.latestDocument):0]})}),r&&((re=r==null?void 0:r.latestDocument)==null?void 0:re.venderId)==="VT200"&&o.jsx(j,{sx:R,children:o.jsxs(X,{children:["Remaining fuel:"," ","0 Ltr"]})}),o.jsxs(pe,{disabled:!r,onClick:()=>{var p,v;Z((p=r==null?void 0:r.latestDocument)==null?void 0:p.lat,(v=r==null?void 0:r.latestDocument)==null?void 0:v.lng)},children:["Navigate to map",o.jsx(Fe,{})]}),o.jsxs(pe,{disabled:!r,onClick:()=>{D()},children:["Share live location",o.jsx(We,{})]})]}),o.jsx(Be,{sx:{cursor:"pointer",color:"black"},onClick:y})]}),o.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[o.jsx(Ae,{title:"Vehicle Details",details:U}),o.jsx(Ae,{title:"Customer Details",details:xe})]})]})}var Ve={},ho=De;Object.defineProperty(Ve,"__esModule",{value:!0});var Pe=Ve.default=void 0,go=ho(Ie()),po=o;Pe=Ve.default=(0,go.default)((0,po.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");const xo="http://139.59.37.47:3031",yo="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function bo({showCard:y,loadingVehicle:x,vehicleData:D}){const{center:I,selectedParameterList:C,selectedVehicle:m,vehicleList:P,zoom:u,icons:fe,locationData:r,placesData:oe,imeiNumbers:Z,selectedImei:ne,onlineVehicle:U,loading:xe,services_loading:R}=ee(e=>e.liveMap),{mode:he,styles:se,vehicles_details:M}=ee(e=>e.dashboard),G=l.useRef(null),{collapsed:z}=ee(e=>e.auth),[V,q]=l.useState(null),[J,Q]=l.useState(""),[T,H]=l.useState([]),[ie,re]=l.useState(),[p,v]=l.useState(null);l.useState("");const[$,k]=l.useState(),[B,ae]=l.useState(!1),[F,ge]=l.useState(null),[ye,i]=nt.useState(!1),[g,L]=l.useState(""),K=async()=>{var e;if(!ne)return te.error("Please select vehicle");try{const t=await ct.post(`${xo}/api/generate-token`,{vehicleNo:ne});if((e=t==null?void 0:t.data)!=null&&e.token){const n=`http://cc.wikitrak.in/live-location/${ne}/${t.data.token}`;L(n),i(!0)}}catch(t){te.error("Error occurred while generating link"),i(!1),L(!1),console.error("Error generating link",t)}},Y=()=>{K()},a=()=>{i(!1)},w=Te(),E={},W=l.useRef([]),_=l.useRef(null),N=l.useRef({}),{isLoaded:ue,loadError:be}=jt({googleMapsApiKey:`${yo}`,loadingElement:o.jsx(yt,{})});l.useEffect(()=>{ue&&q(window.google.maps)},[ue]),l.useEffect(()=>{},[u]),l.useEffect(()=>{var e,t,n,s;if(Object.keys(m).length>0){const f=((F==null?void 0:F.length)>0?F:r).filter(h=>{var d;return((d=h==null?void 0:h.latestDocument)==null?void 0:d.imei)===(m==null?void 0:m.imei)});if(f.length>0){H(f);const h={lat:(t=(e=f[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(s=(n=f[0])==null?void 0:n.latestDocument)==null?void 0:s.lng};w(we(h))}}},[r,m]),l.useEffect(()=>{if(!(Object.keys(m).length>0)){const e=r.filter(t=>D.some(n=>n.value===t.latestDocument.imei));H(e),ge(e)}},[r,m,D]),l.useEffect(()=>{var e,t,n,s;if(Object.keys(m).length>0){const f=((F==null?void 0:F.length)>0?F:r).filter(h=>{var d;return((d=h==null?void 0:h.latestDocument)==null?void 0:d.imei)===(m==null?void 0:m.imei)});if(f.length>0){H(f);const h={lat:(t=(e=f[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(s=(n=f[0])==null?void 0:n.latestDocument)==null?void 0:s.lng};w(we(h))}}else{const c=r.filter(f=>D.some(h=>h.value===f.latestDocument.imei));H(c),ge(c)}},[r,m]),l.useEffect(()=>{re(C)},[C]),l.useEffect(()=>{w(st({})),ae(!0)},[m]),l.useEffect(()=>{if(console.log("before: ",T),!V)return;const e=_.current;let t=null;return(async()=>{console.log("after: ",T);const s=await me(T,e);t&&t.clearMarkers(),t=ze(s,e),_e.on("locationinfo",c=>{console.log("locationinfo: ",c),Ke(c,W),ge(f=>{const h=Array.isArray(f)?f:[],d=h.findIndex(b=>Number(b.latestDocument.imei)===Number(c.imei));if(d!==-1){const b=[...h];return b[d]={...b[d],latestDocument:{...b[d].latestDocument,...c}},b}else return[...h,{_id:c.imei,latestDocument:c}]})})})(),()=>{t&&t.clearMarkers(),Object.keys(N.current).forEach(s=>cancelAnimationFrame(N.current[s])),_e.off("locationinfo")}},[V,T,_e,ie,W,r]);const me=(e,t)=>e.map(n=>{const s=n.latestDocument.imei,c=W.current[s]||ve(n,t);return W.current[s]&&ke(n,c),c}),ve=(e,t)=>{const n=e.latestDocument.imei,s=new V.Marker({position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},map:t,icon:Se(e)});return s.addListener("click",()=>Ue(e,s,t)),W.current[n]=s,s},ke=async(e,t)=>{var d;const n=t.getPosition(),s=((d=t.getIcon())==null?void 0:d.rotation)||0,c={lat:e.latestDocument.lat,lng:e.latestDocument.lng},f=e.latestDocument.heading||0;Re(t,n,c,s,f);const h=await Se(e);t.setIcon(h)},Se=async e=>{var d,b,S,A,O;const t=(d=e==null?void 0:e.latestDocument)==null?void 0:d.imei,n=Ye(t),s=Ze(e==null?void 0:e.latestDocument,n),c=((b=e==null?void 0:e.latestDocument)==null?void 0:b.heading)||0;return Le((S=e==null?void 0:e.latestDocument)==null?void 0:S.imei)&&Ge((A=e==null?void 0:e.latestDocument)==null?void 0:A.imei),{url:await He(s,c),fillOpacity:2,strokeWeight:1,scale:12,rotation:(O=e==null?void 0:e.latestDocument)==null?void 0:O.heading}},Le=e=>U.includes(Number(e)),Ge=e=>r==null?void 0:r.some(t=>Number(t.latestDocument.imei)===Number(e)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),He=(e,t,n,s=50,c=40,f=45)=>{const h=`${e}-${t}-${s}-${n}-${c}-${f}`;if(E[h])return Promise.resolve(E[h]);const d=document.createElement("canvas"),b=d.getContext("2d");d.width=s,d.height=s;const S=new Image;return S.src=e,new Promise(A=>{S.onload=()=>{b.clearRect(0,0,d.width,d.height),b.translate(s/2,s/2),b.rotate(t*Math.PI/180),b.translate(-s/2,-s/2);const O=(s-c)/2,de=(s-f)/2;if(b.drawImage(S,O,de,c,f),n){const tt=s-10-5,ot=s-10-5;b.beginPath(),b.arc(tt,ot,10/2,0,Math.PI*2),b.fillStyle=n,b.fill()}const le=d.toDataURL("image/png");E[h]=le,A(le)},S.onerror=O=>{console.error("Error loading image for rotation:",O),A(e)}})},Ue=(e,t,n)=>{Je(e.latestDocument._id,e,t,n),Qe(e.latestDocument.imei)},Re=(e,t,n,s,c)=>{const h=performance.now(),d=()=>{const b=performance.now()-h,S=Math.min(b/500,1),A=t.lat()+S*(n.lat-t.lat()),O=t.lng()+S*(n.lng-t.lng()),de=(c-s+360)%360-180,le=(s+de*S+360)%360;e.setPosition({lat:A,lng:O});const ce=e.getIcon();ce&&typeof ce=="object"&&e.setIcon({...ce,rotation:le}),S<1?N.current[e.getPosition()]=requestAnimationFrame(d):(e.setPosition(n),ce&&typeof ce=="object"&&e.setIcon({...ce,rotation:c}),delete N.current[e.getPosition()])};N.current[e.getPosition()]=requestAnimationFrame(d)},ze=(e,t)=>new _t({map:t,markers:e,renderer:{render:({count:n,position:s})=>qe(n,s)}}),qe=(e,t)=>{const n=40+Math.min(e*2,40),s=30;let c;return e<10?c={start:"#76c7c0",end:"#34a853"}:e<50?c={start:"#fbbc05",end:"#f2994a"}:c={start:"#f45c42",end:"#d32f2f"},new V.Marker({position:t,icon:{url:`data:image/svg+xml,${encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 100 100">
            <defs>
              <radialGradient id="gradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="${c.start}" />
                <stop offset="100%" stop-color="${c.end}" />
              </radialGradient>
              <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0, 0, 0, 0.5)" />
              </filter>
            </defs>
            <!-- Outer Pulsating Ring -->
            <circle cx="50" cy="50" r="48" fill="url(#gradient)" filter="url(#shadow)" stroke="#ffffff" stroke-width="3" />
            <!-- Decorative Inner Ring -->
            <circle cx="50" cy="50" r="38" fill="none" stroke="#ffffff" stroke-width="2" stroke-dasharray="4 2" />
            <!-- Star Decoration -->
            <polygon points="50,15 54,38 70,38 57,50 62,68 50,57 38,68 43,50 30,38 46,38" fill="#ffffff" opacity="0.4" />
            <!-- Count Text -->
            <text x="50" y="55" font-size="${s}" fill="black" text-anchor="middle" font-family="'Courier New', monospace" font-weight="bold">
              ${e}
            </text>
          </svg>
        `)}`,scaledSize:new V.Size(n,n)},label:null})},Ke=async(e,t,n)=>{var f;const s=e.imei,c=t.current[s];if(c){const h=c.getPosition(),d=((f=c.getIcon())==null?void 0:f.rotation)||0,b={lat:e.lat,lng:e.lng},S=e.heading||0;Re(c,h,b,d,S);const A=await Se({latestDocument:e});c.setIcon(A)}},Ye=e=>{if(!e)return"motorBike";const t=Xe(e);return t||console.error(`No vehicle type found for IMEI: ${e}, defaulting to motorBike`),t||"motorBike"},Xe=e=>{if(!M||M.length===0)return console.error("vehicles_details is not available"),null;const t=M.find(n=>(n==null?void 0:n.value)===e&&(n==null?void 0:n.vehilce_type));return t||console.error(`No vehicle found for IMEI: ${e}`),t?t.vehilce_type:null},Ze=(e,t)=>{let{speed:n,ignition:s,imei:c}=e,f=Le(c);const h={"2W":{red:Dt,green:It,yellow:Ct,black:Mt},"3W":{red:Vt,green:Lt,yellow:Rt,black:$t},"4W":{red:Et,green:Nt,yellow:At,black:Ot},Tractor:{red:Zt,green:Tt,yellow:Bt,black:Ft},Harvestor:{red:Wt,green:Pt,yellow:Gt,black:Ht},BUS:{red:Ut,green:zt,yellow:qt,black:Kt},default:{red:je,green:je,yellow:je,black:je}};let d=h[t]||h.default;if(!f)return d.black;if(f&&!s)return d.red;if(f&&s&&n>0)return d.green;if(f&&s&&n<=0)return d.yellow},Je=(e,t,n,s)=>{var b,S,A;w(rt(t.latestDocument.imei));const c={lat:(b=t==null?void 0:t.latestDocument)==null?void 0:b.lat,lng:(S=t==null?void 0:t.latestDocument)==null?void 0:S.lng};w(we(c)),w(at(15)),G.current||(G.current=new V.InfoWindow);const f=G.current,d=`
      <div>
        <h3>Registration No: ${((A=P.find(O=>{var de,le;return((de=O==null?void 0:O.imei[0])==null?void 0:de.mac_id)===((le=t==null?void 0:t.latestDocument)==null?void 0:le.imei)}))==null?void 0:A.registration_id)||""}</h3>
      </div>
    `;p===e?(f.close(),v(null)):(f.setContent(d),f.open(s,n),v(e))},Qe=e=>{const t=M&&(M==null?void 0:M.length)>0&&M.find(n=>(n==null?void 0:n.value)===e&&n);k(t||null)},$e=()=>{ae(!B)};if(be)return"Error loading maps";if(!ue)return"Loading maps";if(!V)return null;const et={height:"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return o.jsxs(o.Fragment,{children:[o.jsx(j,{sx:{position:"absolute",top:"780px",left:z?"74px":"250px",zIndex:1,background:Oe.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:o.jsxs(pe,{sx:{color:"white"},onClick:$e,children:[B?"Hide":"Show"," Vehicle Info",o.jsx(Yt,{})]})}),B===!0&&o.jsx(fo,{handleVehicleInfo:$e,udpatedParams:F,handleClickOpen:Y}),o.jsxs(wt,{id:"map",mapContainerStyle:et,zoom:u,center:I,onLoad:e=>{_.current=e},options:{styles:he?se:""},children:[Object.keys(m).length>0&&o.jsx(bt,{setPlace:Q,place:J}),R||x?o.jsx(j,{sx:{position:"absolute",top:"50%",left:"50%"},children:o.jsx(Xt,{})}):oe&&oe.length>0&&oe.map((e,t)=>{var n,s;return o.jsx(St,{position:{lat:parseFloat((n=e==null?void 0:e.location)==null?void 0:n.lat),lng:parseFloat((s=e==null?void 0:e.location)==null?void 0:s.lng)},animation:window.google.maps.Animation.DROP,icon:{path:fe[`${J}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},t)}),o.jsx(mo,{open:ye,shareLink:g,handleClose:a})]})]})}const mo=({open:y,handleClose:x,shareLink:D})=>{l.useState("");const I=l.useRef(null);l.useEffect(()=>{},[]);const C=()=>{const m=I.current;m?(m.select(),m.setSelectionRange(0,99999),document.execCommand("copy")?te.success("Text copied!"):te.error("Failed to copy!"),window.getSelection().removeAllRanges()):te.error("Failed to copy! No input found.")};return o.jsxs(Jt,{onClose:x,"aria-labelledby":"customized-dialog-title",open:y,fullWidth:!0,maxWidth:"lg",children:[!1,o.jsxs(Qt,{sx:{m:0,p:2},id:"customized-dialog-title",children:["Vehicle live location link",o.jsx(lt,{"aria-label":"close",onClick:x,sx:m=>({position:"absolute",right:8,top:8,color:m.palette.grey[500]}),children:o.jsx(Be,{})})]}),o.jsx(eo,{dividers:!0,children:o.jsxs(j,{display:"flex",alignItems:"center",gap:2,mt:1,children:[o.jsx(oo,{fullWidth:!0,variant:"outlined",inputRef:I,value:D,onChange:m=>{},sx:{flex:9}}),o.jsx(pe,{variant:"outlined",onClick:C,startIcon:o.jsx(Pe,{}),sx:{flex:1,minWidth:"auto"},children:"Copy"})]})}),o.jsx(to,{children:o.jsx(pe,{onClick:x,children:"Close"})})]})};function Xo(){const{locationData:y,selectedVehicle:x,selectedParameterList:D,onlineVehicle:I}=ee(i=>i.liveMap),{mode:C,selectedVehicleGroup:m}=ee(i=>i.dashboard),P=xt(C),[u,fe]=l.useState([]),[r,oe]=l.useState(""),[Z,ne]=l.useState(""),[U,xe]=l.useState(""),[R,he]=l.useState(""),{w_customer_id:se}=ee(i=>i.auth),[M,G]=l.useState(),[z,V]=l.useState(!1),[q,J]=l.useState(!1),[Q,T]=l.useState([]),[H,ie]=l.useState(!0),[re,p]=l.useState(!1),[v,$]=l.useState(!1);let k=Te();l.useEffect(()=>{k(it({}))},[]),l.useEffect(()=>{B()},[]),l.useEffect(()=>{var i;if(Object.keys(x).length>0){const g=(y==null?void 0:y.length)>0&&(y==null?void 0:y.filter(a=>Number(a.latestDocument.imei)===Number(x==null?void 0:x.imei)));if((g==null?void 0:g.length)<=0){te.error("Data not available for this vehicle",{id:"clipboard"});return}const{lat:L,lng:K}=((i=g==null?void 0:g[0])==null?void 0:i.latestDocument)??{},Y={lat:L||Ne.lat,lng:K||Ne.lat};k(we(Y))}},[x,y]),l.useEffect(()=>{T([]),k(Ee([{reg_id:"",imei:"",params:[]}]))},[x]);const B=async()=>{try{p(!0);let i=[],g=[];const L=await k(ut({w_customer_id:se}));if(Array.isArray(L.payload)){L.payload.forEach(a=>{var w,E,W,_;Array.isArray(a.imei)&&a.imei.length>0&&((w=a.imei[0])!=null&&w.mac_id)?(i.push({id:a.id,label:a.registration_id,value:(E=a.imei[0])==null?void 0:E.mac_id,vehilce_type:a==null?void 0:a.segment,chassis_no:a==null?void 0:a.chassis_no,engine_no:a==null?void 0:a.engine_no,workShop:a==null?void 0:a.workshop,registration_id:a==null?void 0:a.registration_id,sell_date:a==null?void 0:a.sell_date,customer_name:a==null?void 0:a.customer_name,vehicle_model:(W=a==null?void 0:a.vehicle_model)==null?void 0:W.name,vehicle_group:a==null?void 0:a.vehicle_group}),g.push((_=a.imei[0])==null?void 0:_.mac_id)):console.error("IMEI data not found for item:",a)});const K="one",Y=g;g.length>0&&k(dt({type:K,imei:Y})),fe(i),k(ft(i)),k(ht({w_customer_id:se})),p(!1)}else p(!1),console.error("Unexpected data format:",L),te.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),te.error(`Error fetching vehicle data: ${i}`)}},ae=async i=>{const{label:g,imei:L,id:K,reg_id:Y,checked:a}=i;G(_=>_.map(N=>N.id===K?{...N,checked:!a}:N));let w=[...Q],E=[...Q];if(!a)y.forEach(_=>{_.latestDocument.imei===L&&(w.push({label:g,value:_.latestDocument[g==="maininputvoltage"?"mainInputVoltage":g]}),E=w,T(w))});else{let _=Q.filter(N=>N.label!==g);E=_,T(_)}k(Ee([{reg_id:Y,imei:L,params:E}]))},F=i=>y==null?void 0:y.some(g=>Number(g.latestDocument.imei)===Number(i)&&g.latestDocument.speed>0&&(g.latestDocument.ignition===!0||g.latestDocument.ignition===1)),ge=i=>y==null?void 0:y.some(g=>Number(g.latestDocument.imei)===Number(i)&&g.latestDocument.speed<=0&&(g.latestDocument.ignition===!0||g.latestDocument.ignition===1)),ye=u.filter(i=>{var ue,be,me,ve,ke;if(!(Object.keys(m).length===0||i.vehicle_group===m.id))return!1;const L=(ue=i==null?void 0:i.label)==null?void 0:ue.toLowerCase().includes(r.toLowerCase()),K=R===""||((be=i==null?void 0:i.workShop)==null?void 0:be.region)===R,Y=U===""||((ve=(me=i==null?void 0:i.workShop)==null?void 0:me.state)==null?void 0:ve.toLowerCase())===(((ke=U==null?void 0:U.toString())==null?void 0:ke.toLowerCase())||""),a=Number(i.value),w=I.includes(a),E=!w,W=w&&F(a),_=w&&ge(a);return L&&K&&Y&&(Z==="online"?w:Z==="offline"?E:Z==="running"?W:Z==="idling"?_:!0)}).sort((i,g)=>i.label.localeCompare(g.label));return o.jsxs("div",{className:"app",children:[o.jsx(vt,{}),o.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[o.jsx(gt,{title:"Live Map",setShowVehicles:V,showVehicles:z,showParameters:q,setShowParameters:J,setShowCard:ie,showCard:H,setShowVehiclesGroup:$,showVehiclesGroup:v}),o.jsx(kt,{setShowVehiclesGroup:$,showVehiclesGroup:v,where:"livemap"}),o.jsxs(j,{style:{display:"flex",width:"100%",height:"95vh"},children:[o.jsx(j,{style:{width:z||q?"80%":"100%"},children:o.jsx(bo,{showCard:H,loadingVehicle:re,vehicleData:ye})}),z&&o.jsx(j,{style:{width:"20%",backgroundColor:P.grey[100]},children:o.jsx(pt,{vehicleData:ye,title:"Live Map",setParameterData:G,loadingVehicle:re,setShowVehicles:V,showVehicles:z,showParameters:q,setShowParameters:J,setSearchedTerm:oe,setOptions:ne,setState:xe,setRegion:he,searchTerm:r,options:Z,state:U,region:R})}),q&&o.jsx(j,{style:{width:"20%",backgroundColor:P.grey[100]},children:o.jsx(mt,{parametersData:M,setParameterData:G,handleParameterChange:ae})})]})]})]})}export{Xo as default};
