import{b as i,j as o,z as P,y as je,D as A,F as U,aO as qe,aj as Y,C as v,T as E,bp as Ke,af as Le,bq as Je,U as $e,aN as Xe}from"./index-DSq3v83j.js";import{a as xe,b as T,u as Qe,G as Ze,D as et,I as tt}from"./esm-DNIwa8r0.js";import{d as nt}from"./dayjs.min-YGbIGSzw.js";import{r as ot}from"./redTractor-NXgVJyvR.js";import{T as at}from"./TripGraph-DxNiPLCj.js";import{B as I,C as st}from"./CircularProgress-D3sJZm66.js";import{d as lt}from"./Info-BgqxHCdZ.js";import{d as rt}from"./Close-CZChFfzQ.js";function fe({trip:s,tripPlay:a,onTripEnd:d}){const[l,p]=i.useState([]),[b,r]=i.useState([]),[c,w]=i.useState(0),h=i.useRef(null),u=1e4;i.useEffect(()=>{if(Array.isArray(s)&&s.length>0){const j=s.filter(n=>(n==null?void 0:n.lat)&&(n==null?void 0:n.lng)).map(n=>({lat:parseFloat(n.lat),lng:parseFloat(n.lng)}));p(j.length>0?j:[])}else p([])},[s]),i.useEffect(()=>{if(a&&l.length>1){w(0),r([]);const j=performance.now(),n=S=>{const M=S-j,x=Math.min(M/u,1);w(x),x<1?h.current=requestAnimationFrame(n):(r([...l]),d())};return h.current=requestAnimationFrame(n),()=>cancelAnimationFrame(h.current)}},[a,l]);const e=i.useMemo(()=>{if(l.length<2||c===0)return l[0]||{lat:0,lng:0};const j=l.length-1,n=Math.floor(c*j),S=Math.min(n+1,j),M=c*j%1,x=l[n]||{lat:0,lng:0},F=l[S]||{lat:0,lng:0},B={lat:x.lat+(F.lat-x.lat)*M,lng:x.lng+(F.lng-x.lng)*M};return c>0&&a&&r(O=>[...O,B]),B},[l,c,a]),k=i.useMemo(()=>({url:ot,size:new window.google.maps.Size(30,30),scaledSize:new window.google.maps.Size(30,30)}),[]);return o.jsxs(o.Fragment,{children:[l.length>1&&o.jsx(xe,{path:l,options:{strokeColor:"red",strokeOpacity:1,strokeWeight:4,geodesic:!1}}),a&&b.length>1&&o.jsx(xe,{path:b,options:{strokeColor:"green",strokeOpacity:1,strokeWeight:5,zIndex:1e3,geodesic:!1}}),a&&e.lat!==0&&e.lng!==0&&o.jsx(T,{position:e,icon:k})]})}function it({tripPlay:s,speed:a,totalDistance:d,Acreage:l,filterCoordinates:p,acreageTrips:b,handleTrip:r,showGraph:c,handleShowGraph:w}){const{selectedTripData:h}=P(k=>k.dashboard);let u=je();const e=()=>{var k,j,n;if(console.log("selected trip data",(k=h[0])==null?void 0:k.venderId,b),h.length>0)if(((j=h[0])==null?void 0:j.venderId)==="VT200"||((n=h[0])==null?void 0:n.venderId)==="wtkpltf001")if(Object.keys(b).length>0){let S=0;Object.keys(b).map(M=>{let x=qe(b[M]);S+=x}),console.log("final acerage",S),u(Y(S))}else v.error("No acreage trip found");else p(h,u)};return o.jsxs(I,{sx:{bgcolor:A.bgColor,position:"relative",color:"white",display:"flex",alignItems:"center",overflowX:"hidden",flexWrap:"wrap",border:"1px solid white",gap:"5px",paddingLeft:"5px",padding:"10px 10px"},children:[o.jsxs(U,{sx:{background:"white",border:"1px solid white",borderRadius:"5px",padding:"5px 20px",color:"black"},onClick:e,children:[" ","Calculate Acerage"]}),o.jsxs(U,{sx:{background:s?"transparent":"white",border:"1px solid white",borderRadius:"5px",height:"38px",padding:"5px 20px",color:s?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{r()},children:[s?"Pause":"Play","-Trip"]}),o.jsxs(U,{style:{height:"38px",padding:"5px 20px"},sx:{background:c?"transparent":"white",border:"1px solid white",borderRadius:"5px",color:c?"white":"black","&:hover":{background:"transparent",color:"white"}},onClick:()=>{w()},children:[c?"Hide":"Show","-Graph"]})]})}const ct=({label:s,value:a})=>o.jsxs(I,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[o.jsx(E,{variant:"body2",color:"textSecondary",children:s}),o.jsx(E,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:a||"N/A"})]}),dt=(s,a)=>(s==null?void 0:s.find(d=>{var l,p;return((p=(l=d.imei)==null?void 0:l[0])==null?void 0:p.mac_id)===a.imei}))||{},be=({title:s,details:a})=>o.jsx(I,{sx:{width:"45%"},children:a.map(({label:d,value:l})=>o.jsx(ct,{label:d,value:l},d))});function gt({handleVehicleInfo:s,vehicleReport:a,speed:d,totalDistance:l,Acreage:p,tripPlay:b,whereToUse:r}){var n,S,M;const{collapsed:c}=P(x=>x.auth),{vehicleList:w,selectedVehicle:h}=P(x=>x.liveMap),[u,e]=i.useState({});i.useEffect(()=>{e(dt(w,h))},[w,h]),i.useEffect(()=>{},[a]);const k=[{label:"Vehicle No:",value:u==null?void 0:u.registration_id},{label:"Model:",value:(n=u==null?void 0:u.vehicle_model)==null?void 0:n.name},{label:"IMEI No:",value:(M=(S=u==null?void 0:u.imei)==null?void 0:S[0])==null?void 0:M.mac_id},{label:"Chassis No:",value:u==null?void 0:u.chassis_no},{label:"Engine No:",value:u==null?void 0:u.engine_no}],j=[{label:"Equipment:",value:"N/A"},{label:"Avg Speed:",value:(a==null?void 0:a.averageSpeed)||"N/A"},{label:"Total Distance:",value:(a==null?void 0:a.totalDistance)||"N/A"},{label:"Avg trips/day:",value:(a==null?void 0:a.avgTrip)||"N/A"}];return o.jsxs(I,{sx:{position:"absolute",top:"570px",left:c?"280px":"450px",zIndex:1,background:A.bgShadow,p:2,borderRadius:2,color:"white",width:"58%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[o.jsxs(I,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[o.jsx(E,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),o.jsx(rt,{sx:{cursor:"pointer",color:"black"},onClick:s})]}),r==="TripMonitor"&&o.jsxs(I,{sx:{display:"flex",justifyContent:"flex-start",gap:"10px",paddingBottom:"20px"},children:[o.jsxs(I,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px",width:"150px",display:"flex",justifyContent:"space-evenly",background:A.bgColor},children:[o.jsx(E,{children:"Speed"}),o.jsxs(E,{children:[b?d:0," KM/H"]})]}),o.jsxs(E,{sx:{padding:"5px 5px",border:"1px solid white",borderRadius:"5px",background:A.bgColor},children:["Total-Distance ",l," KM"]}),o.jsxs(E,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:A.bgColor},children:[parseFloat(parseFloat(p).toFixed(2)*43560).toFixed()," Sqft"]}),o.jsxs(E,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:A.bgColor},children:[parseFloat(p).toFixed(2)*8," Kanal"]}),o.jsxs(E,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:A.bgColor},children:[parseFloat(parseFloat(p).toFixed(2)*8/5).toFixed(2)," Bigha"]}),o.jsxs(E,{sx:{padding:"5px 15px",border:"1px solid white",borderRadius:"5px",background:A.bgColor},children:[parseFloat(p).toFixed(2)," acre"]})]}),o.jsxs(I,{sx:{display:"flex",justifyContent:"space-between"},children:[o.jsx(be,{title:"Vehicle Details",details:k}),o.jsx(be,{title:"Trip Details",details:j})]})]})}const pt="/assets/endTrip-CEqIwvWS.png",me="/assets/endTrip_-BsrUUtoJ.png",we="/assets/startTrip-CGKteKGr.png",ht=(s,a)=>{const p=[];s.length>0&&s.forEach(r=>{let c={latitude:r.lat,longitude:r.lng},w=[];s.forEach(h=>{const u={latitude:h.lat,longitude:h.lng};if(u.latitude&&u.longitude&&u.latitude!==c.latitude&&u.longitude!==c.longitude){const e=xt(r.lat,r.lng,h.lat,h.lng);e<20&&e>10&&w.push(h)}}),w.length>10&&p.push(r)});const b=s.filter(r=>r.lat!==void 0&&r.lng!==void 0).map(r=>({lat:parseFloat(r.lat),lng:parseFloat(r.lng)}));if(b.length>0){a(Je(p));try{const r=ut(b),c=ft(r),w=new window.google.maps.Polygon({paths:c});return bt(w,a)}catch(r){return console.error("Error calculating convex hull or area:",r),a(Y(0)),0}}else return a(Y(0)),0},ut=s=>{const a=(r,c,w)=>{const h=(c.lat-r.lat)*(w.lng-c.lng)-(c.lng-r.lng)*(w.lat-c.lat);return h===0?0:h>0?1:2},d=s.reduce((r,c)=>c.lng<r.lng?c:r);let l=[],p=d,b;do{l.push(p),b=s[0]===p?s[1]:s[0];for(let r=0;r<s.length;r++)a(p,b,s[r])===2&&(b=s[r]);p=b}while(p!==d);return l};function xt(s,a,d,l){const b=s*Math.PI/180,r=d*Math.PI/180,c=(d-s)*Math.PI/180,w=(l-a)*Math.PI/180,h=Math.sin(c/2)*Math.sin(c/2)+Math.cos(b)*Math.cos(r)*Math.sin(w/2)*Math.sin(w/2);return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}const ft=s=>{s.sort((l,p)=>l.lng-p.lng||l.lat-p.lat);const a=[],d=[];for(const l of s){for(;a.length>=2&&Se(a[a.length-2],a[a.length-1],l)<=0;)a.pop();a.push(l)}for(let l=s.length-1;l>=0;l--){const p=s[l];for(;d.length>=2&&Se(d[d.length-2],d[d.length-1],p)<=0;)d.pop();d.push(p)}return[...a.slice(0,-1),...d.slice(0,-1)]},bt=(s,a)=>{if(!window.google||!window.google.maps.geometry){console.log("not loaded");return}const l=window.google.maps.geometry.spherical.computeArea(s.getPath())/4046.86;return a(Y(l)),l},Se=(s,a,d)=>(a.lat-s.lat)*(d.lng-s.lng)-(a.lng-s.lng)*(d.lat-s.lat),mt=({selectedTrip:s,center:a,showCard:d})=>{var se,le,re,ie,ce,de,ge,pe,he,ue;const l=je(),{isLoaded:p,loadError:b}=Qe({googleMapsApiKey:"AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA",libraries:["drawing","geometry"]}),{Acreage:r}=P(t=>t.tripMonitor),{selectedVehicle:c}=P(t=>t.liveMap),{singleTrip_Data:w,tripLoading:h,cords:u}=P(t=>t.tripMonitor),{selectedTripData:e,mode:k,styles:j,allTripList:n,activeIndex:S}=P(t=>t.dashboard),{collapsed:M}=P(t=>t.auth),[x,F]=i.useState(null),B=i.useRef(null),[O,Ce]=i.useState(null),[G,ye]=i.useState(null),[L,J]=i.useState([]);i.useState([]);const[z,N]=i.useState(!1),[$,R]=i.useState(0),[W,Me]=i.useState(!1),[X,ke]=i.useState(0);i.useState([]),i.useState([]);const[H,Q]=i.useState(!1),[Ee,Ie]=i.useState({}),[D,Z]=i.useState([]),[ee,V]=i.useState(null),[Fe,te]=i.useState(null),[Ae,Pe]=i.useState({}),[ne,q]=i.useState(0),[ve,K]=i.useState([]);i.useEffect(()=>{Q(!0)},[c]),i.useEffect(()=>{(async()=>{if(c!=null&&c.imei){const g=nt(),m=g.startOf("day").format("MM/DD/YYYY HH:mm:ss"),f=g.endOf("day").format("MM/DD/YYYY HH:mm:ss"),C={imei:[c.imei],startDate:m,endDate:f};try{const y=await $e(C);Ie(y.data[0].data)}catch(y){console.error("Error fetching report:",y)}}})()},[c,l]),i.useEffect(()=>{O&&G&&O.fitBounds(G)},[O,G,e]);let ze=t=>{let g=Xe(t),m={};g.map((f,C)=>{let y=t.slice(f.start,f.end+1);m[C]=y}),Pe(m)};i.useEffect(()=>{if(console.log("selectedTripData",e),(e==null?void 0:e.length)>0){let t=e.map(m=>({lat:m.lat,lng:m.lng}));console.log("selected trip coordinate ",t);const g=Te({selectedTripData:e});ke(g),ze(e)}},[e]);const Te=({selectedTripData:t})=>{const g=t.reduce((m,f,C)=>{if(C===0)return m;const y=t[C-1],_=Ke(y.lat,y.lng,f.lat,f.lng);return m+_},0);return g==null?void 0:g.toFixed(2)};i.useEffect(()=>{var t,g,m,f,C;if(e&&(e==null?void 0:e.length)>0){const y=new window.google.maps.LatLngBounds,_=new window.google.maps.LatLng(parseFloat((t=e[0])==null?void 0:t.lat),parseFloat((g=e[0])==null?void 0:g.lng)),We=new window.google.maps.LatLng(parseFloat((m=e[(e==null?void 0:e.length)-1])==null?void 0:m.lat),parseFloat((f=e[(e==null?void 0:e.length)-1])==null?void 0:f.lng));y.extend(_),y.extend(We),R((C=e[0])==null?void 0:C.speed),ye(y)}N(!1),Oe()},[e]);const Oe=()=>{if(e&&e.length>0){const t=(f,C)=>{const _=new Date(f.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{Date:f.createdAt.substring(0,10),Time:_,value:f[C]}},m=["speed","mainInputVoltage","ignition"].map(f=>({label:f==="speed"?"Speed":f==="mainInputVoltage"?"MainInputVoltage":"Ignition",randomColor:Ne(),data:e.map(C=>t(C,f))}));J(m)}else J([])},Ne=()=>"#"+Math.floor(Math.random()*16777215).toString(16),Re=()=>{var t;if(S==="all")n&&n.length>0?(N(!z),R(0),q(0),K([])):v.error("No trips found");else if((e==null?void 0:e.length)>0)N(!z),R(0),q(0),K([]);else return((t=Object.keys(e))==null?void 0:t.length)===0?v.error("Please Select Vehicle",{id:"vehicle"}):v.error("Please Select Trip",{id:"trip error"})},Ve=()=>{S==="all"&&ne<n.length-1?q(t=>t+1):N(!1)},_e=()=>{var t;if((e==null?void 0:e.length)>0)Me(!W);else return((t=Object.keys(e))==null?void 0:t.length)===0?v.error("Please Select Vehicle",{id:"vehicle"}):v.error("Please Select Trip",{id:"trip error"})},oe=()=>{Object.keys(c).length>0||H?Q(!H):v.error("Please select any vehicle")};if(b)return"Error loading maps";if(!p)return"Loading maps";const Be={width:"100%",height:d?"87vh":"93vh"},He=t=>{if(t.type==="polygon"){const g=t.overlay;g.setEditable(!0),Z(m=>[...m,g]),V(g),google.maps.event.addListener(g.getPath(),"set_at",()=>V(g)),google.maps.event.addListener(g.getPath(),"insert_at",()=>V(g)),google.maps.event.addListener(g.getPath(),"remove_at",()=>V(g)),ae(g)}},ae=t=>{if(!t)return;const g=t.getPath().getArray(),f=(google.maps.geometry.spherical.computeArea(g)/4046.86).toFixed(2);te(f)},De=()=>{D.forEach(t=>t.setMap(null)),Z([]),te(null),V(null)},Ue=()=>{D.forEach(t=>t.setEditable(!0))},Ye=()=>{D.forEach(t=>t.setEditable(!1))},Ge=()=>{ee?ae(ee):alert("No shape is selected. Please draw or select a shape.")};return console.log("acitve index",S,n),o.jsxs(o.Fragment,{children:[h&&o.jsx(I,{sx:{position:"absolute",top:"50vh",left:"50%",zIndex:"1000"},children:o.jsx(st,{})}),d&&o.jsx(it,{tripPlay:z,speed:$,totalDistance:X,Acreage:r,filterCoordinates:ht,acreageTrips:Ae,handleTrip:Re,showGraph:W,handleShowGraph:_e}),o.jsx(I,{sx:{position:"absolute",top:"795px",left:M?"74px":"250px",zIndex:1,background:A.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:o.jsxs(U,{sx:{color:"white"},onClick:oe,children:[H?"Hide":"Show"," Vehicle Info",o.jsx(lt,{})]})}),H===!0&&o.jsx(gt,{handleVehicleInfo:oe,vehicleReport:Ee,tripPlay:z,speed:$,totalDistance:X,Acreage:r,whereToUse:"TripMonitor"}),o.jsxs(Ze,{ref:B,mapContainerStyle:Be,zoom:10,center:a,onLoad:t=>Ce(t),options:{styles:k?j:""},children:[o.jsx(et,{onOverlayComplete:He,options:{drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:["polygon"]}}}),o.jsxs("div",{style:{position:"absolute",bottom:80,left:20,background:"white",padding:"10px",borderRadius:"8px",boxShadow:"0 0 6px rgba(0,0,0,0.2)",zIndex:100,width:"auto"},children:[o.jsxs("p",{children:["Area: ",Fe||0," acres"]}),D.length>0&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:Ue,style:{marginTop:"10px",marginRight:"10px"},children:"Enable Editing"}),o.jsx("button",{onClick:Ye,style:{marginTop:"10px",marginRight:"10px"},children:"Disable Editing"}),o.jsx("button",{onClick:Ge,style:{marginTop:"10px",marginRight:"10px"},children:"Calculate Area"}),o.jsx("button",{onClick:De,style:{marginTop:"10px"},children:"Clear All Shapes"})]})]}),S==="all"&&n&&n.length>0&&o.jsx(T,{onClick:()=>F(n[0].data[0]),position:{lat:parseFloat((se=n[0].data[0])==null?void 0:se.lat)+1e-6,lng:parseFloat((le=n[0].data[0])==null?void 0:le.lng)+1e-6},animation:"BOUNCE",icon:{url:we,scaledSize:new google.maps.Size(60,60)}}),S==="all"&&n&&n.length>0&&o.jsx(T,{onClick:()=>F(n[(n==null?void 0:n.length)-1].data[n[(n==null?void 0:n.length)-1].data.length-1]),position:{lat:parseFloat(((re=n[(n==null?void 0:n.length)-1].data[n[(n==null?void 0:n.length)-1].data.length-1])==null?void 0:re.lat)+1e-5),lng:parseFloat(((ie=n[(n==null?void 0:n.length)-1].data[n[(n==null?void 0:n.length)-1].data.length-1])==null?void 0:ie.lng)+1e-6)},animation:"BOUNCE",icon:{url:me,scaledSize:new google.maps.Size(60,60)}}),e&&(e==null?void 0:e.length)>0&&o.jsx(T,{onClick:()=>F(e[0]),position:{lat:parseFloat((ce=e[0])==null?void 0:ce.lat)+1e-6,lng:parseFloat((de=e[0])==null?void 0:de.lng)+1e-6},animation:"BOUNCE",icon:{url:we,scaledSize:new google.maps.Size(60,60)}}),e&&(e==null?void 0:e.length)>0&&o.jsx(T,{onClick:()=>F(e[(e==null?void 0:e.length)-1]),position:{lat:parseFloat(((ge=e[(e==null?void 0:e.length)-1])==null?void 0:ge.lat)+1e-5),lng:parseFloat(((pe=e[(e==null?void 0:e.length)-1])==null?void 0:pe.lng)+1e-6)},animation:"BOUNCE",icon:{url:me,scaledSize:new google.maps.Size(60,60)}}),S==="all"&&n&&n.length>0&&n.map((t,g)=>{var m,f;return o.jsx(T,{position:{lat:parseFloat((m=t==null?void 0:t.data[(t==null?void 0:t.data.length)-1])==null?void 0:m.lat),lng:parseFloat((f=t==null?void 0:t.data[(t==null?void 0:t.data.length)-1])==null?void 0:f.lng)},onClick:()=>F(t==null?void 0:t.data[(t==null?void 0:t.data.length)-1]),label:{text:(g+1).toString(),color:"white",fontWeight:"bold",fontSize:"14px"},animation:"BOUNCE",icon:{url:pt,scaledSize:new google.maps.Size(40,40)}},g)}),x&&o.jsx(tt,{position:{lat:parseFloat(x==null?void 0:x.lat),lng:parseFloat(x==null?void 0:x.lng)},onCloseClick:()=>F(null),children:o.jsxs("div",{children:["Date-time:",x!=null&&x.Date?Le(new Date(x==null?void 0:x.Date)).format("DD-MM-YYYY HH:mm"):""]})}),e&&e.length>0&&o.jsx(fe,{trip:e,tripPlay:z,setSpeed:R,onTripEnd:()=>N(!1)}),S==="all"&&n&&n.length>0&&n.map((t,g)=>o.jsx(fe,{trip:t==null?void 0:t.data,tripPlay:g===ne?z:!1,setSpeed:R,onTripEnd:Ve,globalMarkerPath:ve,setGlobalMarkerPath:K},t==null?void 0:t.id)),o.jsx("div",{style:{position:"relative",top:200,left:12,color:"green"},children:((ue=(he=L[0])==null?void 0:he.data)==null?void 0:ue.length)>0&&W&&o.jsx(at,{item:L})})]})]})},It=mt;export{It as T,ht as f};
