import{b as o,z as w,y as L,bk as U,C as N,j as e,F as I,R as Y,bh as H,bi as J,a8 as $,V as G,W as K,Y as Q}from"./index-CmWSrtPV.js";import{V as X}from"./VehicleMenu-BEvqggxw.js";import{t as Z}from"./SearchTab-_kuc_mEj.js";import"./Loader-D0pY_dDq.js";import"./LiveMapServices-CnaZqsdW.js";import"./Socket-0N_gnJcr.js";import{P as ee}from"./Parameters-CuPxkLAy.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as se}from"./LeftSideBar2-y9IOQlcD.js";import{S as re}from"./ServiceRecordTable-pdk85RLa.js";import{a as ae}from"./formik.esm-BN_IFpXb.js";import{c as te,a as S,e as oe}from"./index.esm-D71Ar0CG.js";import{N as ie}from"./NewLoader-BeAVzGCH.js";import{L as le,A as ne}from"./DateTimePicker-D8pdfXzG.js";import{T as b,M as F}from"./TextField-Cm0vdtX7.js";import{B as C}from"./CircularProgress-DzH6_aEN.js";import{D as ce,a as de,b as he}from"./DialogTitle-D1cYA53a.js";import{S as pe}from"./ServicesTopBar-BrSk3zgV.js";import"./menu2-CIJgSciK.js";import"./useControlled-DB9LViCL.js";import"./Autocomplete-BbLcs8qC.js";import"./index-4Wun7u7X.js";import"./createSvgIcon-DaEK0Aow.js";import"./Card-oH6AJuOy.js";import"./CardContent-BrGaqCVm.js";import"./dayjs.min-DDD_9kiF.js";import"./index-DZ0Ra_6y.js";import"./TableRow-CakS8b-a.js";import"./TablePagination-FJN_lIZq.js";const ue=({setOpen:n})=>{const[h,x]=o.useState(null),{vehicleList:u}=w(a=>a.liveMap),{vendorList:E,segMentList:P,loading:k}=w(a=>a.services),A=L(),[q,f]=o.useState([]),[c,D]=o.useState([]),s=ae({initialValues:{vehicle:"",vendor:"",priority_class:"",chassis_no:"",odometer:"",attachment:null,status:"Pending"},validationSchema:te().shape({vehicle:S().required("Vehicle is required"),vendor:S().required("Vendor is required"),priority_class:S().required("Priority class is required"),chassis_no:S().required("Chassis number is required"),odometer:S().required("Odometer is required"),attachment:oe().nullable().required("Attachment is required")}),onSubmit:async a=>{const t=new FormData;t.append("vehicle",a.vehicle),t.append("segment",a.vendor),t.append("priority_class",a.priority_class),t.append("chassis_no",a.chassis_no),t.append("odometer",a.odometer),t.append("attachment",h),t.append("status",a.status),t.append("user",JSON.parse(localStorage.getItem("w_userDetails")).user_id),console.log("form data",a),(await A(U(t))).payload&&(N.success("Service created successfully"),s.resetForm(),x(null),n(!1))}}),V=a=>{const t=a.target.files[0];x(t),s.setFieldValue("attachment",t)},g=["On Time","Over Due","Emergency"];o.useEffect(()=>{let a=u.map(t=>({label:t.registration_id,value:t.id}));f(a)},[u]),o.useEffect(()=>{let a=P.map(t=>({label:t.segment_name,value:t.id}));D(a)},[P]);const y={PaperProps:{style:{maxHeight:300,overflowY:"auto"}}};return e.jsxs(le,{dateAdapter:ne,children:[k&&e.jsx(ie,{}),e.jsxs("form",{onSubmit:s.handleSubmit,style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx(b,{select:!0,name:"vehicle",label:"Select Vehicle",value:s.values.vehicle,onChange:s.handleChange,error:s.touched.vehicle&&!!s.errors.vehicle,helperText:s.touched.vehicle&&s.errors.vehicle,SelectProps:{MenuProps:y},children:q.map(a=>e.jsx(F,{value:a.value,children:a.label},a.value))}),e.jsx(b,{select:!0,name:"vendor",label:"Select segment",value:s.values.vendor,onChange:s.handleChange,error:s.touched.vendor&&!!s.errors.vendor,helperText:s.touched.vendor&&s.errors.vendor,children:c&&c.length>0&&c.map(a=>e.jsx(F,{value:a.value,children:a.label},a.value))}),e.jsx(b,{select:!0,name:"priority_class",label:"Priority Class",value:s.values.priority_class,onChange:s.handleChange,error:s.touched.priority_class&&!!s.errors.priority_class,helperText:s.touched.priority_class&&s.errors.priority_class,children:g.map(a=>e.jsx(F,{value:a,children:a},a))}),e.jsx(b,{name:"chassis_no",label:"Chassis Number",value:s.values.chassis_no,onChange:s.handleChange,error:s.touched.chassis_no&&!!s.errors.chassis_no,helperText:s.touched.chassis_no&&s.errors.chassis_no}),e.jsx(b,{name:"odometer",label:"Odometer",value:s.values.odometer,onChange:s.handleChange,error:s.touched.odometer&&!!s.errors.odometer,helperText:s.touched.odometer&&s.errors.odometer}),e.jsxs(C,{children:[e.jsx("input",{type:"file",name:"attachment",onChange:V}),s.touched.attachment&&s.errors.attachment&&e.jsx("div",{style:{color:"red"},children:s.errors.attachment})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[e.jsx(I,{type:"submit",variant:"contained",color:"primary",sx:{mr:2},children:"Save"}),e.jsx(I,{variant:"outlined",onClick:()=>n(!1),children:"Cancel"})]})]})]})};function me(){const[n,h]=Y.useState(!1);L();const x=()=>h(!0),u=()=>h(!1);return e.jsxs("div",{children:[e.jsx(I,{variant:"outlined",onClick:x,children:"+ Add New Entry"}),e.jsxs(ce,{open:n,onClose:u,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[e.jsx(de,{children:"Add New Entry"}),e.jsx(he,{dividers:!0,children:e.jsx(ue,{setOpen:h})})]})]})}const ve=()=>{const n=L();return o.useEffect(()=>{n(H()),n(J())},[]),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(me,{})})]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(re,{isInspection:!1})})]})]})},xe=ve;function He(){const{locationData:n,selectedVehicle:h,selectedParameterList:x}=w(i=>i.liveMap),{mode:u}=w(i=>i.dashboard),E=Z(u),[P,k]=o.useState([]),{w_customer_id:A}=w(i=>i.auth),[q,f]=o.useState(),[c,D]=o.useState(!1),[s,V]=o.useState(!1),[g,y]=o.useState([]),[a,t]=o.useState(!0),[R,M]=o.useState(!1);let j=L();o.useEffect(()=>{W()},[]),o.useEffect(()=>{y([]),j($([{reg_id:"",imei:"",params:[]}]))},[h]);const W=async()=>{try{M(!0);let i=[],d=[];const m=await j(G({w_customer_id:A}));if(Array.isArray(m.payload)){m.payload.forEach(r=>{var v,p,B,l;Array.isArray(r.imei)&&r.imei.length>0&&((v=r.imei[0])!=null&&v.mac_id)?(i.push({id:r.id,label:r.registration_id,value:(p=r.imei[0])==null?void 0:p.mac_id,vehilce_type:r==null?void 0:r.segment,chassis_no:r==null?void 0:r.chassis_no,engine_no:r==null?void 0:r.engine_no,workShop:r==null?void 0:r.workshop,registration_id:r==null?void 0:r.registration_id,sell_date:r==null?void 0:r.sell_date,customer_name:r==null?void 0:r.customer_name,vehicle_model:(B=r==null?void 0:r.vehicle_model)==null?void 0:B.name}),d.push((l=r.imei[0])==null?void 0:l.mac_id)):console.error("IMEI data not found for item:",r)});const T="one",O=d;d.length>0&&j(K({type:T,imei:O})),k(i),j(Q(i)),M(!1)}else M(!1),console.error("Unexpected data format:",m),N.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),N.error(`Error fetching vehicle data: ${i}`)}},z=async i=>{const{label:d,imei:m,id:T,reg_id:O,checked:r}=i;f(l=>l.map(_=>_.id===T?{..._,checked:!r}:_));let v=[...g],p=[...g];if(!r)n.forEach(l=>{l.latestDocument.imei===m&&(v.push({label:d,value:l.latestDocument[d==="maininputvoltage"?"mainInputVoltage":d]}),p=v,y(v))});else{let l=g.filter(_=>_.label!==d);p=l,y(l)}console.log("tempParamList",p),j($([{reg_id:O,imei:m,params:p}]))};return e.jsxs("div",{className:"app",children:[e.jsx(se,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(pe,{title:"services",setShowVehicles:D,showVehicles:c,showParameters:s,setShowParameters:V,setShowCard:t,showCard:a}),e.jsxs(C,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(C,{style:{width:c||s?"80%":"100%"},children:e.jsx(xe,{})}),c&&e.jsx(C,{style:{width:"20%",backgroundColor:E.grey[100]},children:e.jsx(X,{vehicleData:P,title:"Inspections",setParameterData:f,loadingVehicle:R,setShowVehicles:D,showVehicles:c,showParameters:s,setShowParameters:V})}),s&&e.jsx(C,{style:{width:"20%",backgroundColor:E.grey[100]},children:e.jsx(ee,{parametersData:q,setParameterData:f,handleParameterChange:z})})]})]})]})}export{He as default};
