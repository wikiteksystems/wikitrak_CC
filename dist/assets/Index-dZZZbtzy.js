import{ab as Ce,j as o,z as re,b as c,E as Te,T as z,G as xe,R as st,y as Be,B as Se,a7 as rt,N as at,ac as lt,ad as ct,I as it,C as ae,ae as ut,$ as dt,af as Ne,a1 as ft,a2 as pt,a4 as gt,a5 as ht,ag as Ae}from"./index-CkVXv9ba.js";import{L as xt}from"./LiveMapTopBar-DQ2CMMJ1.js";import{V as yt}from"./VehicleMenu-BMHzUesm.js";import{t as bt}from"./SearchTab-C-4HC9hN.js";import{F as kt}from"./Loader-Dd5DES-9.js";import{L as mt}from"./LiveMapServices-Bn2VoQkL.js";import{s as Ie}from"./Socket-DLjvxrzW.js";import{P as vt}from"./Parameters-DxS22gQJ.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as jt}from"./LeftSideBar2-DFaE75pF.js";import{V as wt}from"./VehicleGroups-DdhBzoFG.js";import{u as St,G as Dt,M as _t}from"./esm-D_ehsHmD.js";import{M as It,r as Ct,g as Mt,y as Lt,b as $t,a as Rt,c as Vt,d as Et,e as Nt,f as At,h as Ot,i as Tt,j as Bt,k as Ft,l as Wt,m as Gt,n as Ht,o as Ut,p as zt,q as qt,s as Pt,t as Yt,u as Kt,v as Xt}from"./black_bike-BZsqKxKS.js";import{d as Fe}from"./Close-BIpuYj36.js";import{r as Me}from"./createSvgIcon-jWlltDFa.js";import"./NewLoader-_sRgAODE.js";import{m as we}from"./motorbike-Ci4voNFa.js";import{d as Jt}from"./Info-Bn9n0MRz.js";import{B as v,C as Zt}from"./CircularProgress-DDaf_W8R.js";import{r as Qt}from"./redTractor-NXgVJyvR.js";import{D as eo,a as to,b as oo,c as no}from"./DialogTitle-DEIakIKz.js";import{T as so}from"./TextField-BjXx7y32.js";import"./jcb-aCHXMCXy.js";import"./menu2-DYWuZo2I.js";import"./useControlled-DkJKKhqe.js";import"./Autocomplete-D25IVYCE.js";import"./usePreviousProps-Qwsarr8y.js";import"./index-DSiY7ezQ.js";import"./Card--tRU4De9.js";import"./CardContent-B-xbxThi.js";var Le={},ro=Ce;Object.defineProperty(Le,"__esModule",{value:!0});var We=Le.default=void 0,ao=ro(Me()),lo=o;We=Le.default=(0,ao.default)((0,lo.jsx)("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"NorthEast");var $e={},co=Ce;Object.defineProperty($e,"__esModule",{value:!0});var Ge=$e.default=void 0,io=co(Me()),uo=o;Ge=$e.default=(0,io.default)((0,uo.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn");const fo=({label:b,value:x})=>o.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[o.jsx(z,{variant:"body2",color:"textSecondary",children:b}),o.jsx(z,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:x||"N/A"})]}),po=(b,x)=>(b==null?void 0:b.find(T=>{var C,M;return((M=(C=T.imei)==null?void 0:C[0])==null?void 0:M.mac_id)===x}))||{},Oe=({title:b,details:x})=>o.jsx(v,{sx:{width:"45%"},children:x.map(({label:T,value:C})=>o.jsx(fo,{label:T,value:C},T))});let go=["vt200","wtkpltf001"];function ho({handleVehicleInfo:b,udpatedParams:x,handleClickOpen:T}){var ce,$,G,P,R,Y,ee,te,B,K,ue,ie,oe,ne,de,_;const{collapsed:C}=re(h=>h.auth),{vehicleList:M,selectedVehicle:k,selectedImei:W}=re(h=>h.liveMap),[u,ge]=c.useState({});let[s,le]=c.useState(null);c.useEffect(()=>{let h=x&&(x==null?void 0:x.length)>0&&(x==null?void 0:x.find(j=>{var m;return Number((m=j==null?void 0:j.latestDocument)==null?void 0:m.imei)===Number(W)}));le(h)},[x,W]),c.useEffect(()=>{ge(po(M,W))},[M,W]);const Z=(h,j)=>{const m=`https://www.google.com/maps?q=${h},${j}`;window.open(m,"_blank")},Q=h=>{var E,H;let j=(E=h==null?void 0:h.latestDocument)==null?void 0:E.ignition,m=(H=h==null?void 0:h.latestDocument)==null?void 0:H.speed;return j===!0||j===1?m:0},q=[{label:"Vehicle No:",value:u==null?void 0:u.registration_id},{label:"Model:",value:(ce=u==null?void 0:u.vehicle_model)==null?void 0:ce.name},{label:"IMEI No:",value:(G=($=u==null?void 0:u.imei)==null?void 0:$[0])==null?void 0:G.mac_id},{label:"Chassis No:",value:u==null?void 0:u.chassis_no},{label:"Engine No:",value:u==null?void 0:u.engine_no}],ye=[{label:"Customer Name:",value:(P=u==null?void 0:u.user)!=null&&P.us_user?`${u.user.us_user.first_name.charAt(0).toUpperCase()}${u.user.us_user.first_name.slice(1)} ${u.user.us_user.last_name.charAt(0).toUpperCase()}${u.user.us_user.last_name.slice(1)}`:null},{label:"Mobile: ",value:((R=u==null?void 0:u.user)==null?void 0:R.us_user)&&u.user.us_user.mobile},{label:"Date of Sell:",value:u==null?void 0:u.sell_date},{label:"Workshop Name:",value:(Y=u==null?void 0:u.workshop)==null?void 0:Y.name}];let L={border:"2px solid black",borderRadius:"5px",padding:"5px",color:"black"};const he=h=>{let j=M.find(E=>{var H,i;return((H=E==null?void 0:E.imei)==null?void 0:H.length)>0&&((i=E.imei[0])==null?void 0:i.mac_id)==h.imei}),m=parseFloat((j==null?void 0:j.load_capacity)||0)/49*parseFloat((h==null?void 0:h.analogInput1)||0);return`${parseFloat(m).toFixed(2)} Kgs`||0};return o.jsxs(v,{sx:{position:"absolute",top:"600px",left:C?"280px":"450px",zIndex:1,background:Te.bgShadow,p:2,borderRadius:2,color:"white",width:"72%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[o.jsx(z,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),o.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[o.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",width:"100%",marginLeft:"10px"},children:[o.jsx(v,{sx:L,children:o.jsxs(z,{children:["Ignition:"," ",((ee=s==null?void 0:s.latestDocument)==null?void 0:ee.ignition)===!0||((te=s==null?void 0:s.latestDocument)==null?void 0:te.ignition)===1?"On":"Off"]})}),go.includes((K=(B=s==null?void 0:s.latestDocument)==null?void 0:B.venderId)==null?void 0:K.toLowerCase())&&o.jsx(v,{sx:L,children:o.jsxs(z,{children:["Pump:"," ",((ue=s==null?void 0:s.latestDocument)==null?void 0:ue.isAcreage)===!0||((ie=s==null?void 0:s.latestDocument)==null?void 0:ie.isAcreage)===1?"On":"Off"]})}),o.jsx(v,{sx:L,children:o.jsxs(z,{children:["Speed: ",Q(s)," km/h"]})}),o.jsx(v,{sx:L,children:o.jsxs(z,{children:["Main Voltage:"," ",s?`${(oe=s==null?void 0:s.latestDocument)==null?void 0:oe.mainInputVoltage} Voltage`:0]})}),o.jsx(v,{sx:L,children:o.jsxs(z,{children:["Heading:"," ",s?`${(ne=s==null?void 0:s.latestDocument)==null?void 0:ne.heading} deg`:0]})}),s&&((de=s==null?void 0:s.latestDocument)==null?void 0:de.venderId)==="VT200"&&o.jsx(v,{sx:L,children:o.jsxs(z,{children:["Load:"," ",s?he(s==null?void 0:s.latestDocument):0]})}),s&&((_=s==null?void 0:s.latestDocument)==null?void 0:_.venderId)==="VT200"&&o.jsx(v,{sx:L,children:o.jsxs(z,{children:["Remaining fuel:"," ","0 Ltr"]})}),o.jsxs(xe,{disabled:!s,onClick:()=>{var h,j;Z((h=s==null?void 0:s.latestDocument)==null?void 0:h.lat,(j=s==null?void 0:s.latestDocument)==null?void 0:j.lng)},children:["Navigate to map",o.jsx(We,{})]}),o.jsxs(xe,{disabled:!s,onClick:()=>{T()},children:["Share live location",o.jsx(Ge,{})]})]}),o.jsx(Fe,{sx:{cursor:"pointer",color:"black"},onClick:b})]}),o.jsxs(v,{sx:{display:"flex",justifyContent:"space-between"},children:[o.jsx(Oe,{title:"Vehicle Details",details:q}),o.jsx(Oe,{title:"Customer Details",details:ye})]})]})}var Re={},xo=Ce;Object.defineProperty(Re,"__esModule",{value:!0});var He=Re.default=void 0,yo=xo(Me()),bo=o;He=Re.default=(0,yo.default)((0,bo.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");const ko="https://cc.wikitrak.in/proxy-3031",mo="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function vo({showCard:b,loadingVehicle:x,vehicleData:T}){const{center:C,selectedParameterList:M,selectedVehicle:k,vehicleList:W,zoom:u,icons:ge,locationData:s,placesData:le,imeiNumbers:Z,selectedImei:Q,onlineVehicle:q,loading:ye,services_loading:L}=re(e=>e.liveMap),{mode:he,styles:ce,vehicles_details:$}=re(e=>e.dashboard),G=c.useRef(null),{collapsed:P}=re(e=>e.auth),[R,Y]=c.useState(null),[ee,te]=c.useState(""),[B,K]=c.useState([]),[ue,ie]=c.useState(),[oe,ne]=c.useState(null);c.useState("");const[de,_]=c.useState(),[h,j]=c.useState(!1),[m,E]=c.useState(null),[H,i]=st.useState(!1),[g,V]=c.useState(""),X=async()=>{var e;if(!Q)return ae.error("Please select vehicle");try{const t=await ut.post(`${ko}/api/generate-token`,{vehicleNo:Q});if((e=t==null?void 0:t.data)!=null&&e.token){const n=`http://cc.wikitrak.in/live-location/${Q}/${t.data.token}`;V(n),i(!0)}}catch(t){ae.error("Error occurred while generating link"),i(!1),V(!1),console.error("Error generating link",t)}},J=()=>{X()},l=()=>{i(!1)},w=Be(),N={},F=c.useRef([]),S=c.useRef(null),A=c.useRef({}),{isLoaded:fe,loadError:be}=St({googleMapsApiKey:`${mo}`,loadingElement:o.jsx(kt,{})});c.useEffect(()=>{fe&&Y(window.google.maps)},[fe]),c.useEffect(()=>{},[u]),c.useEffect(()=>{var e,t,n,r;if(Object.keys(k).length>0){const a=(m==null?void 0:m.length)>0?m:s,d=a==null?void 0:a.filter(f=>{var p;return((p=f==null?void 0:f.latestDocument)==null?void 0:p.imei)===(k==null?void 0:k.imei)});if((d==null?void 0:d.length)>0){K(d);const f={lat:(t=(e=d[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(r=(n=d[0])==null?void 0:n.latestDocument)==null?void 0:r.lng};w(Se(f))}}},[s,k]),c.useEffect(()=>{var e,t,n,r;if(Object.keys(k).length>0){const a=(m==null?void 0:m.length)>0?m:s,d=a==null?void 0:a.filter(f=>{var p;return((p=f==null?void 0:f.latestDocument)==null?void 0:p.imei)===(k==null?void 0:k.imei)});if((d==null?void 0:d.length)>0){K(d);const f={lat:(t=(e=d[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(r=(n=d[0])==null?void 0:n.latestDocument)==null?void 0:r.lng};w(Se(f))}}else{const a=s==null?void 0:s.filter(d=>T.some(f=>f.value===d.latestDocument.imei));K(a),E(a)}},[s,k]),c.useEffect(()=>{ie(M)},[M]),c.useEffect(()=>{w(rt({}))},[k]),c.useEffect(()=>{if(console.log("before: ",B),!R)return;const e=S.current;let t=null;return(async()=>{console.log("after: ",B);const r=await ke(B,e);t&&t.clearMarkers(),t=Pe(r,e),Ie.on("locationinfo",a=>{Ke(a,F),E(d=>{const f=Array.isArray(d)?d:[],p=f.findIndex(y=>Number(y.latestDocument.imei)===Number(a.imei));if(p!==-1){const y=[...f];return y[p]={...y[p],latestDocument:{...y[p].latestDocument,...a}},y}else return[...f,{_id:a.imei,latestDocument:a}]})})})(),()=>{t&&t.clearMarkers(),Object.keys(A.current).forEach(r=>cancelAnimationFrame(A.current[r])),Ie.off("locationinfo")}},[R,B,Ie,ue,F,s]);const ke=(e,t)=>e.map(n=>{const r=n.latestDocument.imei,a=F.current[r]||me(n,t);return F.current[r]&&ve(n,a),a}),me=(e,t)=>{const n=e.latestDocument.imei,r=new R.Marker({position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},map:t,icon:De(e)});return r.addListener("click",()=>qe(e,r,t)),F.current[n]=r,r},ve=async(e,t)=>{var p;const n=t.getPosition(),r=((p=t.getIcon())==null?void 0:p.rotation)||0,a={lat:e.latestDocument.lat,lng:e.latestDocument.lng},d=e.latestDocument.heading||0;Ve(t,n,a,r,d);const f=await De(e);t.setIcon(f)},De=async e=>{var p,y,D,O,I;const t=(p=e==null?void 0:e.latestDocument)==null?void 0:p.imei,n=Xe(t),r=Ze(e==null?void 0:e.latestDocument,n),a=((y=e==null?void 0:e.latestDocument)==null?void 0:y.heading)||0;return _e((D=e==null?void 0:e.latestDocument)==null?void 0:D.imei)&&Ue((O=e==null?void 0:e.latestDocument)==null?void 0:O.imei),{url:await ze(r,a),fillOpacity:2,strokeWeight:1,scale:12,rotation:(I=e==null?void 0:e.latestDocument)==null?void 0:I.heading}},_e=e=>q.includes(Number(e)),Ue=e=>s==null?void 0:s.some(t=>Number(t.latestDocument.imei)===Number(e)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),ze=(e,t,n,r=50,a=40,d=45)=>{const f=`${e}-${t}-${r}-${n}-${a}-${d}`;if(N[f])return Promise.resolve(N[f]);const p=document.createElement("canvas"),y=p.getContext("2d");p.width=r,p.height=r;const D=new Image;return D.src=e,new Promise(O=>{D.onload=()=>{y.clearRect(0,0,p.width,p.height),y.translate(r/2,r/2),y.rotate(t*Math.PI/180),y.translate(-r/2,-r/2);const I=(r-a)/2,pe=(r-d)/2;if(y.drawImage(D,I,pe,a,d),n){const je=r-10-5,nt=r-10-5;y.beginPath(),y.arc(je,nt,10/2,0,Math.PI*2),y.fillStyle=n,y.fill()}const se=p.toDataURL("image/png");N[f]=se,O(se)},D.onerror=I=>{console.error("Error loading image for rotation:",I),O(e)}})},qe=(e,t,n)=>{et(e.latestDocument._id,e,t,n),tt(e.latestDocument.imei)},Ve=(e,t,n,r,a)=>{const f=performance.now(),p=()=>{const y=performance.now()-f,D=Math.min(y/500,1),O=t.lat()+D*(n.lat-t.lat()),I=t.lng()+D*(n.lng-t.lng()),pe=(a-r+360)%360-180,se=(r+pe*D+360)%360;e.setPosition({lat:O,lng:I});const U=e.getIcon();U&&typeof U=="object"&&e.setIcon({...U,rotation:se}),D<1?A.current[e.getPosition()]=requestAnimationFrame(p):(e.setPosition(n),U&&typeof U=="object"&&e.setIcon({...U,rotation:a}),delete A.current[e.getPosition()])};A.current[e.getPosition()]=requestAnimationFrame(p)},Pe=(e,t)=>new It({map:t,markers:e,renderer:{render:({count:n,position:r})=>Ye(n,r)}}),Ye=(e,t)=>{const n=40+Math.min(e*2,40),r=30;let a;return e<10?a={start:"#76c7c0",end:"#34a853"}:e<50?a={start:"#fbbc05",end:"#f2994a"}:a={start:"#f45c42",end:"#d32f2f"},new R.Marker({position:t,icon:{url:`data:image/svg+xml,${encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 100 100">
            <defs>
              <radialGradient id="gradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="${a.start}" />
                <stop offset="100%" stop-color="${a.end}" />
              </radialGradient>
              <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0, 0, 0, 0.5)" />
              </filter>
            </defs>
            <!-- Outer Pulsating Ring -->
            <circle cx="50" cy="50" r="48" fill="url(#gradient)" filter="url(#shadow)" stroke="#ffffff" stroke-width="3" />
            <!-- Decorative Inner Ring -->
            <circle cx="50" cy="50" r="38" fill="none" stroke="#ffffff" stroke-width="2" stroke-dasharray="4 2" />
            <!-- Star Decoration -->
            <polygon points="50,15 54,38 70,38 57,50 62,68 50,57 38,68 43,50 30,38 46,38" fill="#ffffff" opacity="0.4" />
            <!-- Count Text -->
            <text x="50" y="55" font-size="${r}" fill="black" text-anchor="middle" font-family="'Courier New', monospace" font-weight="bold">
              ${e}
            </text>
          </svg>
        `)}`,scaledSize:new R.Size(n,n)},label:null})},Ke=async(e,t,n)=>{var d;const r=e.imei,a=t.current[r];if(a){const f=a.getPosition(),p=((d=a.getIcon())==null?void 0:d.rotation)||0,y={lat:e.lat,lng:e.lng},D=e.heading||0;Ve(a,f,y,p,D);const O=await De({latestDocument:e});if(a.setIcon(O),Q==(e==null?void 0:e.imei)){const I=S.current.getBounds();I&&!I.contains(y)&&S.current.panTo(y)}}},Xe=e=>{if(!e)return"motorBike";const t=Je(e);return t||console.error(`No vehicle type found for IMEI: ${e}, defaulting to motorBike`),t||"motorBike"},Je=e=>{if(!$||$.length===0)return console.error("vehicles_details is not available"),null;const t=$.find(n=>(n==null?void 0:n.value)===e&&(n==null?void 0:n.vehilce_type));return t||console.error(`No vehicle found for IMEI: ${e}`),t?t.vehilce_type:null},Ze=(e,t)=>{let{speed:n,ignition:r,imei:a}=e,d=_e(a);const f={"2W":{red:Ct,green:Mt,yellow:Lt,black:$t},"3W":{red:Rt,green:Vt,yellow:Et,black:Nt},"4W":{red:At,green:Ot,yellow:Tt,black:Bt},Tractor:{red:Qt,green:Ft,yellow:Wt,black:Gt},Harvestor:{red:Ht,green:Ut,yellow:zt,black:qt},BUS:{red:Pt,green:Yt,yellow:Kt,black:Xt},default:{red:we,green:we,yellow:we,black:we}};let p=f[t]||f.default;if(!d)return p.black;if(d&&!r)return p.red;if(d&&r&&n>0)return p.green;if(d&&r&&n<=0)return p.yellow},Qe=e=>{console.log("packet and type",e);let{speed:t,ignition:n,imei:r}=e;console.log("speed",t,n,r);let a=_e(r);if(console.log("isONline",a),!a)return"Offline";if(a&&!n)return"Online";if(a&&n&&t>0)return"Running";if(a&&n&&t<=0)return"Idle"},et=(e,t,n,r)=>{var D,O,I,pe;let a=at(new Date((D=t==null?void 0:t.latestDocument)==null?void 0:D.Date)).format("DD-MM-YYYY HH:mm");w(lt(t.latestDocument.imei));const d={lat:(O=t==null?void 0:t.latestDocument)==null?void 0:O.lat,lng:(I=t==null?void 0:t.latestDocument)==null?void 0:I.lng};w(Se(d)),w(ct(15)),G.current||(G.current=new R.InfoWindow);const f=G.current,y=`
      <div>
        <h3>Registration No: ${((pe=W.find(se=>{var U,je;return((U=se==null?void 0:se.imei[0])==null?void 0:U.mac_id)===((je=t==null?void 0:t.latestDocument)==null?void 0:je.imei)}))==null?void 0:pe.registration_id)||""}</h3>
        <h3>Status:${Qe(t==null?void 0:t.latestDocument)}</h3>
        <h3>Last updated time:${a}</h3>
      </div>
    `;oe===e?(f.close(),ne(null)):(f.setContent(y),f.open(r,n),ne(e))},tt=e=>{const t=$&&($==null?void 0:$.length)>0&&$.find(n=>(n==null?void 0:n.value)===e&&n);_(t||null)},Ee=()=>{j(!h)};if(be)return"Error loading maps";if(!fe)return"Loading maps";if(!R)return null;const ot={height:"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return o.jsxs(o.Fragment,{children:[o.jsx(v,{sx:{position:"absolute",top:"780px",left:P?"74px":"250px",zIndex:1,background:Te.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:o.jsxs(xe,{sx:{color:"white"},onClick:Ee,children:[h?"Hide":"Show"," Vehicle Info",o.jsx(Jt,{})]})}),h===!0&&o.jsx(ho,{handleVehicleInfo:Ee,udpatedParams:m,handleClickOpen:J}),o.jsxs(Dt,{id:"map",mapContainerStyle:ot,zoom:u,center:C,onLoad:e=>{S.current=e},options:{styles:he?ce:""},children:[Object.keys(k).length>0&&o.jsx(mt,{setPlace:te,place:ee}),L||x?o.jsx(v,{sx:{position:"absolute",top:"50%",left:"50%"},children:o.jsx(Zt,{})}):le&&le.length>0&&le.map((e,t)=>{var n,r;return o.jsx(_t,{position:{lat:parseFloat((n=e==null?void 0:e.location)==null?void 0:n.lat),lng:parseFloat((r=e==null?void 0:e.location)==null?void 0:r.lng)},animation:window.google.maps.Animation.DROP,icon:{path:ge[`${ee}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},t)}),o.jsx(jo,{open:H,shareLink:g,handleClose:l})]})]})}const jo=({open:b,handleClose:x,shareLink:T})=>{c.useState("");const C=c.useRef(null);c.useEffect(()=>{},[]);const M=()=>{const k=C.current;k?(k.select(),k.setSelectionRange(0,99999),document.execCommand("copy")?ae.success("Text copied!"):ae.error("Failed to copy!"),window.getSelection().removeAllRanges()):ae.error("Failed to copy! No input found.")};return o.jsxs(eo,{onClose:x,"aria-labelledby":"customized-dialog-title",open:b,fullWidth:!0,maxWidth:"lg",children:[!1,o.jsxs(to,{sx:{m:0,p:2},id:"customized-dialog-title",children:["Vehicle live location link",o.jsx(it,{"aria-label":"close",onClick:x,sx:k=>({position:"absolute",right:8,top:8,color:k.palette.grey[500]}),children:o.jsx(Fe,{})})]}),o.jsx(oo,{dividers:!0,children:o.jsxs(v,{display:"flex",alignItems:"center",gap:2,mt:1,children:[o.jsx(so,{fullWidth:!0,variant:"outlined",inputRef:C,value:T,onChange:k=>{},sx:{flex:9}}),o.jsx(xe,{variant:"outlined",onClick:M,startIcon:o.jsx(He,{}),sx:{flex:1,minWidth:"auto"},children:"Copy"})]})}),o.jsx(no,{children:o.jsx(xe,{onClick:x,children:"Close"})})]})};function en(){const{locationData:b,selectedVehicle:x,selectedParameterList:T,onlineVehicle:C}=re(i=>i.liveMap),{mode:M,selectedVehicleGroup:k}=re(i=>i.dashboard),W=bt(M),[u,ge]=c.useState([]),[s,le]=c.useState(""),[Z,Q]=c.useState(""),[q,ye]=c.useState(""),[L,he]=c.useState(""),{w_customer_id:ce}=re(i=>i.auth),[$,G]=c.useState(),[P,R]=c.useState(!1),[Y,ee]=c.useState(!1),[te,B]=c.useState([]),[K,ue]=c.useState(!0),[ie,oe]=c.useState(!1),[ne,de]=c.useState(!1);let _=Be();c.useEffect(()=>{_(dt({}))},[]),c.useEffect(()=>{h()},[]),c.useEffect(()=>{var i;if(Object.keys(x).length>0){const g=(b==null?void 0:b.length)>0&&(b==null?void 0:b.filter(l=>Number(l.latestDocument.imei)===Number(x==null?void 0:x.imei)));if((g==null?void 0:g.length)<=0){ae.error("Data not available for this vehicle",{id:"clipboard"});return}const{lat:V,lng:X}=((i=g==null?void 0:g[0])==null?void 0:i.latestDocument)??{},J={lat:V||Ae.lat,lng:X||Ae.lat};_(Se(J))}},[x,b]),c.useEffect(()=>{B([]),_(Ne([{reg_id:"",imei:"",params:[]}]))},[x]);const h=async()=>{try{oe(!0);let i=[],g=[];const V=await _(ft({w_customer_id:ce}));if(Array.isArray(V.payload)){V.payload.forEach(l=>{var w,N,F,S;Array.isArray(l.imei)&&l.imei.length>0&&((w=l.imei[0])!=null&&w.mac_id)?(i.push({id:l.id,label:l.registration_id,value:(N=l.imei[0])==null?void 0:N.mac_id,vehilce_type:l==null?void 0:l.segment,chassis_no:l==null?void 0:l.chassis_no,engine_no:l==null?void 0:l.engine_no,workShop:l==null?void 0:l.workshop,registration_id:l==null?void 0:l.registration_id,sell_date:l==null?void 0:l.sell_date,customer_name:l==null?void 0:l.customer_name,vehicle_model:(F=l==null?void 0:l.vehicle_model)==null?void 0:F.name,vehicle_group:l==null?void 0:l.vehicle_group}),g.push((S=l.imei[0])==null?void 0:S.mac_id)):console.error("IMEI data not found for item:",l)});const X="one",J=g;g.length>0&&_(pt({type:X,imei:J})),ge(i),_(gt(i)),_(ht({w_customer_id:ce})),oe(!1)}else oe(!1),console.error("Unexpected data format:",V),ae.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),ae.error(`Error fetching vehicle data: ${i}`)}},j=async i=>{const{label:g,imei:V,id:X,reg_id:J,checked:l}=i;G(S=>S.map(A=>A.id===X?{...A,checked:!l}:A));let w=[...te],N=[...te];if(!l)b.forEach(S=>{S.latestDocument.imei===V&&(w.push({label:g,value:S.latestDocument[g==="maininputvoltage"?"mainInputVoltage":g]}),N=w,B(w))});else{let S=te.filter(A=>A.label!==g);N=S,B(S)}_(Ne([{reg_id:J,imei:V,params:N}]))},m=i=>b==null?void 0:b.some(g=>Number(g.latestDocument.imei)===Number(i)&&g.latestDocument.speed>0&&(g.latestDocument.ignition===!0||g.latestDocument.ignition===1)),E=i=>b==null?void 0:b.some(g=>Number(g.latestDocument.imei)===Number(i)&&g.latestDocument.speed<=0&&(g.latestDocument.ignition===!0||g.latestDocument.ignition===1)),H=u.filter(i=>{var fe,be,ke,me,ve;if(!(Object.keys(k).length===0||i.vehicle_group===k.id))return!1;const V=(fe=i==null?void 0:i.label)==null?void 0:fe.toLowerCase().includes(s.toLowerCase()),X=L===""||((be=i==null?void 0:i.workShop)==null?void 0:be.region)===L,J=q===""||((me=(ke=i==null?void 0:i.workShop)==null?void 0:ke.state)==null?void 0:me.toLowerCase())===(((ve=q==null?void 0:q.toString())==null?void 0:ve.toLowerCase())||""),l=Number(i.value),w=C.includes(l),N=!w,F=w&&m(l),S=w&&E(l);return V&&X&&J&&(Z==="online"?w:Z==="offline"?N:Z==="running"?F:Z==="idling"?S:!0)}).sort((i,g)=>i.label.localeCompare(g.label));return o.jsxs("div",{className:"app",children:[o.jsx(jt,{}),o.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[o.jsx(xt,{title:"Live Map",setShowVehicles:R,showVehicles:P,showParameters:Y,setShowParameters:ee,setShowCard:ue,showCard:K,setShowVehiclesGroup:de,showVehiclesGroup:ne}),o.jsx(wt,{setShowVehiclesGroup:de,showVehiclesGroup:ne,where:"livemap"}),o.jsxs(v,{style:{display:"flex",width:"100%",height:"95vh"},children:[o.jsx(v,{style:{width:P||Y?"80%":"100%"},children:o.jsx(vo,{showCard:K,loadingVehicle:ie,vehicleData:H})}),P&&o.jsx(v,{style:{width:"20%",backgroundColor:W.grey[100]},children:o.jsx(yt,{vehicleData:H,title:"Live Map",setParameterData:G,loadingVehicle:ie,setShowVehicles:R,showVehicles:P,showParameters:Y,setShowParameters:ee,setSearchedTerm:le,setOptions:Q,setState:ye,setRegion:he,searchTerm:s,options:Z,state:q,region:L})}),Y&&o.jsx(v,{style:{width:"20%",backgroundColor:W.grey[100]},children:o.jsx(vt,{parametersData:$,setParameterData:G,handleParameterChange:j})})]})]})]})}export{en as default};
