import{j as l,k as A,r as i,i as J,B,w as O,t as d,T as K,l as Q,v as U,m as E,n as Z,X as D}from"./index-Djz6wYYU.js";import{S as ee,R as le,t as se}from"./LeftSideBar2-CkfLfF6L.js";import{F as ne,a as te,B as S,C as oe}from"./menu2-D8V5ddHX.js";import{S as re,M as b}from"./Select-Bhg5CmAs.js";function ie({options:w,setOptions:f}){const C=V=>{f(V.target.value)};return l.jsx("div",{children:l.jsxs(ne,{variant:"standard",sx:{m:0,minWidth:240,ml:2.85,mb:1},children:[l.jsx(te,{id:"demo-simple-select-standard-label",children:"Vehicle State Options"}),l.jsxs(re,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",value:w,onChange:C,label:"state-options",children:[l.jsx(b,{value:"",children:l.jsx("em",{children:"None"})}),l.jsx(b,{value:"offline",children:"Offline Vehicles"}),l.jsx(b,{value:"online",children:"Online Vehicles"}),l.jsx(b,{value:"running",children:"Running Vehicles"}),l.jsx(b,{value:"idling",children:"Idling Vehicles"})]})]})})}const ue=({vehicleData:w,title:f,setParameterData:C,loadingVehicle:V})=>{const{selectedVehicle:h,locationData:n,loading:F,onlineVehicle:a}=A(e=>e.liveMap),{mode:P,showVehicles:W}=A(e=>e.dashboard),m=se(P),[T,$]=i.useState(""),[o,X]=i.useState(""),[j,Y]=i.useState(""),u=i.useRef(null),M=i.useRef(0);let v=J();i.useEffect(()=>{console.log("onlineVehicle",a),console.log("options",o)},[a,o]),i.useEffect(()=>{u.current&&setTimeout(()=>{u.current.scrollTop=M.current},0)});const I=e=>n==null?void 0:n.some(s=>Number(s.latestDocument.imei)===Number(e)&&s.latestDocument.speed>0&&(s.latestDocument.ignition===!0||s.latestDocument.ignition===1)),g=w.filter(e=>{var p,x;const s=(p=e==null?void 0:e.label)==null?void 0:p.toLowerCase().includes(T.toLowerCase()),k=j===""||((x=e==null?void 0:e.workShop)==null?void 0:x.region)===j,t=Number(e.value),_=a.includes(t),R=!a.includes(t),L=a.includes(t)&&I(t),y=a.includes(t)&&!I(t);let r=!0;return o==="online"?r=_:o==="offline"?r=R:o==="running"?r=L:o==="idling"&&(r=y),s&&k&&r}),q=async e=>{var p,x;if(u.current&&(M.current=u.current.scrollTop),Q(!W),(n==null?void 0:n.length)<=0)return O.error("Data not available for this vehicle",{id:"clipboard"});const s=n==null?void 0:n.filter(c=>c.latestDocument.imei===e.value);if((s==null?void 0:s.length)<=0)return O.error("Data not available for this vehicle",{id:"clipboard"});const{lat:k,lng:t}=((p=s==null?void 0:s[0])==null?void 0:p.latestDocument)??{},_={lat:k||D.lat,lng:t||D.lat};v(U(_)),v(E({imei:e.value,reg_id:e.label}));const R=e.label,L=await v(Z({w_registration_id:R})),y=[];let r=0;(x=L.payload)==null||x.map(c=>{c[c.parameter_type.toLowerCase()+"_parameter"].forEach(N=>{y.push({reg_id:e.label,imei:e.value,id:N.id,_id:c.id,key:r++,label:c.parameter_type==="Telematic"&&N.short_name})})}),f==="Live Map"&&C(y)},z=()=>{v(E({}))},G=e=>{Y(e)},H={backgroundColor:m.grey[100],position:"relative",width:"100%",float:"right",height:"90vh",overflowY:"auto",scrollBehavior:"smooth",scrollbarWidth:"thin"};return l.jsx(l.Fragment,{children:l.jsx("div",{ref:u,style:H,children:F||V?l.jsx(S,{sx:{display:"flex",justifyContent:"center",height:"88vh",alignItems:"center"},children:l.jsx(oe,{})}):l.jsxs(l.Fragment,{children:[l.jsx(ee,{searchTerm:T,setSearchedTerm:$}),l.jsx(le,{region:j,handleRegion:G}),l.jsx(ie,{options:o,setOptions:X}),f==="Live Map"&&l.jsx(S,{sx:{align:"center",my:"8px",ml:"20px"},children:l.jsxs(B,{variant:"outlined",onClick:()=>{if(Object.keys(h).length>0)z();else return O.success("Already Selected To View All Vehicle Location.",{id:"already selected"})},sx:{width:"90%",bgcolor:Object.keys(h).length===0?d.bgColor:"undefined",color:Object.keys(h).length===0?"white":m.grey[400],border:`1px solid ${d.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:d.bgShadow}},children:["All Vehicles: ",g==null?void 0:g.length]})}),g.length>0?g.map((e,s)=>l.jsx(S,{sx:{align:"center",my:"8px",ml:"20px"},children:l.jsx(B,{variant:"outlined",onClick:()=>{q(e)},sx:{width:"90%",bgcolor:e.label===h.reg_id?d.bgColor:"undefined",color:e.label===h.reg_id?"white":m.grey[400],border:`1px solid ${d.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:d.bgShadow}},children:e.label})},s)):l.jsx(S,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh"},children:l.jsxs(K,{sx:{textAlign:"center",color:m.grey[400]},children:["Sorry! No vehicles in"," ",l.jsx("span",{style:{fontWeight:"bold"},children:j})," region"]})})]})})})};export{ue as V};
