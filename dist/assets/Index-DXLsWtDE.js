import{l as xe,o as me,p as je,_ as se,b as o,q as ye,f as Se,j as t,g as De,k as ve,x as ae,y as k,ab as X,ac as le,a6 as he,ad as we,ae as be,af as te,ag as E,B as W,T as M,ah as de,ai as Ce,aj as Me,ak as Te,J,al as pe,C as ke,X as Ae,Y as _e,a0 as Ye}from"./index-jaVnQRPi.js";import{L as Le}from"./LeftSideBar2-tdXzoJb4.js";import{L as Ie}from"./LiveMapTopBar-C9aEHstR.js";import{V as Ne}from"./VehicleMenu-Ds4t_B4h.js";import{T as Ee}from"./TripMap-BJGFdQnx.js";import{d as T}from"./dayjs.min-B7H9YK_U.js";import{t as re}from"./SearchTab-CYCs8w-e.js";import{S as Oe,D as Re}from"./index-9_7ofxCy.js";import{r as ue}from"./createSvgIcon-DpjpuhMU.js";import{B as u,C as Pe,M as Be}from"./menu2-OL55J3AA.js";import{C as Ve}from"./Card-CTAXsb82.js";import{C as $e}from"./CardContent-CmlU94TW.js";import"./TripVehicleInfo-Dp_1B89Z.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{V as qe}from"./VehicleGroups-BnEr0XnM.js";import"./useControlled-CZJjk3CB.js";import"./Close-Dd79NdZ_.js";import"./jcb-aCHXMCXy.js";import"./index-NDoB9TXL.js";import"./TextField-ClBhxCKL.js";import"./Autocomplete-yHd7O_Yg.js";import"./esm-CmsKZHcR.js";import"./preet_tractor-CDwt_mVh.js";import"./Info-Cb8d1Bmu.js";function Fe(s){return xe("MuiCardActions",s)}me("MuiCardActions",["root","spacing"]);const Ge=["disableSpacing","className"],Ue=s=>{const{classes:n,disableSpacing:S}=s;return ve({root:["root",!S&&"spacing"]},Fe,n)},ze=je("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,n)=>{const{ownerState:S}=s;return[n.root,!S.disableSpacing&&n.spacing]}})(({ownerState:s})=>se({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),He=o.forwardRef(function(n,S){const D=ye({props:n,name:"MuiCardActions"}),{disableSpacing:l=!1,className:m}=D,Y=Se(D,Ge),h=se({},D,{disableSpacing:l}),j=Ue(h);return t.jsx(ze,se({className:De(j.root,m),ownerState:h,ref:S},Y))}),We=He,{RangePicker:Xe}=Re,Je=()=>{const s=ae(),{selectedVehicle:n}=k(c=>c.liveMap),{selectedTripData:S,mode:D}=k(c=>c.dashboard),[l,m]=o.useState(),[Y,h]=o.useState(),j=re(D);o.useEffect(()=>{const c=T().subtract(5,"day");if(m(c),h(T()),n!=null&&n.imei){let i={imei:n==null?void 0:n.imei,startDate:T().subtract(5,"day").startOf("day"),endDate:T().endOf("day"),page:1};s(X(i)),s(le(i))}},[n]);const g=(c,i)=>{if(c){const O=T(i[0]).startOf("day"),f=T(i[1]).endOf("day");let L={imei:n==null?void 0:n.imei,startDate:O.format(),endDate:f.format(),page:1};m(T(i[0])),h(T(i[1])),s(X(L)),s(le(L))}else console.log("Clear date")};return t.jsx(Oe,{direction:"vertical",size:12,children:t.jsx(Xe,{value:[l,Y],onChange:(c,i)=>{g(c,i)},style:{backgroundColor:j.grey[500],color:j.grey[400]}})})};var oe={},Ke=he;Object.defineProperty(oe,"__esModule",{value:!0});var ge=oe.default=void 0,Qe=Ke(ue()),Ze=t;ge=oe.default=(0,Qe.default)((0,Ze.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var ne={},et=he;Object.defineProperty(ne,"__esModule",{value:!0});var fe=ne.default=void 0,tt=et(ue()),st=t;fe=ne.default=(0,tt.default)((0,st.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const at=()=>{var y,v,I,N;const s=ae(),{tripList:n,selectedTripData:S,loading:D,trips:l,activeIndex:m,searchText:Y,mode:h,isNavigate:j,allTripList:g,trip_payload:c,page:i}=k(e=>e.dashboard),{selectedVehicle:O}=k(e=>e.liveMap),f=re(h),[L,R]=o.useState(!1),[d,w]=o.useState({}),[K,b]=o.useState(""),[F,P]=o.useState(0);o.useEffect(()=>{console.log("trips",l),(l==null?void 0:l.length)>0&&b(l[0])},[l]),o.useEffect(()=>{console.log("allTripList",g);const e=Z(g);s(we(e))},[g]),o.useEffect(()=>{!(S.length>0)&&j&&m!==null&&C.length>0&&Q(C[m])},[S,j]);const Q=async e=>{var x;let r={imei:O.imei,startDate:e.startDate,endDate:e.endDate};const p=await be(r);((x=p==null?void 0:p.data)==null?void 0:x.documents.length)>0?(s(j(!1)),s(te(p.data.documents[0].data))):(s(j(!1)),s(te([])))},Z=e=>{const r=new Set,p=[];return e.forEach(x=>{const _=E(x.startTime).format("YYYY-MM-DD");r.has(_)||(r.add(_),p.push(_))}),p},ie=(e,r)=>{s(de(null)),s(Ce(e)),s(Me(!1)),b(e),P(r)},C=g.filter(e=>E(e.startTime).format("YYYY-MM-DD")===K),G=async(e,r)=>{s(te(r.data)),s(de(e)),s(Te(0))},U=e=>{w(e),R(!0)},A=()=>{R(!1),w({})},z=e=>e?e.split(" ").slice(0,2).join(" "):"",ee=async()=>{const e={...c,page:i+1};try{(await s(X(e))).error?J.error("No Trip! within selected date"):s(pe(i+1))}catch{J.error("No Trip! within selected date")}},a=()=>{if(i<=1)return;const e={...c,page:i-1};s(pe(i-1)),s(X(e))};return t.jsxs(t.Fragment,{children:[t.jsxs(u,{children:[t.jsxs(u,{children:[t.jsx(u,{sx:{color:f.grey[400]},children:"Select Date"}),t.jsx(u,{sx:{mt:1},children:t.jsx(Je,{})})]}),D?t.jsx("div",{style:{width:"100%",margin:"38%"},children:t.jsx(Pe,{})}):t.jsxs(t.Fragment,{children:[t.jsx(u,{children:t.jsx(u,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:g&&(g==null?void 0:g.length)>0?t.jsx(t.Fragment,{children:l.map((e,r)=>t.jsx(u,{children:t.jsx(W,{onClick:()=>{ie(e,r)},style:{backgroundColor:F===r?f.grey[300]:f.grey[200],color:F===r?"black":f.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:e})},r))}):t.jsx(M,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),t.jsxs(u,{sx:{height:"70vh",width:"100%",overflowY:"auto"},children:[t.jsxs(u,{sx:{display:"flex",justifyContent:"space-between"},children:[t.jsx(W,{disabled:i<=1,onClick:a,children:t.jsx(ge,{})}),t.jsx(W,{disabled:!(c!=null&&c.imei),onClick:ee,children:t.jsx(fe,{})})]}),C&&C.length>0&&C.map((e,r)=>{var B,V,$,q;const p=(V=(B=e==null?void 0:e.startLocation)==null?void 0:B.address)==null?void 0:V.address,x=(q=($=e==null?void 0:e.endLocation)==null?void 0:$.address)==null?void 0:q.address,_=p?`${p.town||p.city||""}`:"",ce=x?`${x.town||x.city||""}`:"";return t.jsxs(u,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:m===r?"black":f.grey[400],backgroundColor:m===r?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:h?f.grey[300]:f.grey[200]}},onClick:()=>G(r,e),children:[t.jsxs(M,{sx:{cursor:"text"},children:[r+1,". ",z(_)," to"," ",z(ce)," "]}),t.jsxs(M,{children:[e!=null&&e.startTime?E(new Date(e.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",e!=null&&e.endTime?E(new Date(e.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",t.jsx("span",{style:{color:h?"orange":"blue",cursor:"pointer"},onClick:H=>{H.stopPropagation(),U(e)},children:"...see more"})]})]},r)})]})]})]}),t.jsx(Be,{open:L,onClose:A,children:t.jsxs(Ve,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[t.jsxs($e,{children:[t.jsx(M,{variant:"h6",component:"div",children:"Trip Details"}),t.jsxs(M,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Location:"})," ",((v=(y=d==null?void 0:d.startLocation)==null?void 0:y.address)==null?void 0:v.display_name)||"N/A"]}),t.jsxs(M,{sx:{mt:2},children:[t.jsx("strong",{children:"End Location:"})," ",((N=(I=d==null?void 0:d.endLocation)==null?void 0:I.address)==null?void 0:N.display_name)||"N/A"]}),t.jsxs(M,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Time:"})," ",d!=null&&d.startTime?E(new Date(d.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),t.jsxs(M,{sx:{mt:2},children:[t.jsx("strong",{children:"End Time:"})," ",d!=null&&d.endTime?E(new Date(d.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),t.jsx(We,{children:t.jsx(W,{onClick:A,children:"Close"})})]})})]})},rt=at;function _t(){const{w_customer_id:s}=k(a=>a.auth),{collapsed:n}=k(a=>a.auth),{mode:S,selectedVehicleGroup:D}=k(a=>a.dashboard),{vehicleList:l,selectedVehicle:m,onlineVehicle:Y}=k(a=>a.liveMap),[h,j]=o.useState(!1),[g,c]=o.useState(!0),[i,O]=o.useState([]),[f,L]=o.useState(!1),[R,d]=o.useState(""),[w,K]=o.useState(""),[b,F]=o.useState(""),[P,Q]=o.useState("");o.useState([]);const[Z,ie]=o.useState({lat:18.516726,lng:73.856255});o.useState([]);const[C,G]=o.useState(!1),U=re(S);let A=ae();o.useEffect(()=>{z()},[]),o.useEffect(()=>{var a,y,v;Object.keys(m).length===0&&l.length>0&&A(ke({imei:(y=(a=l[0])==null?void 0:a.imei[0])==null?void 0:y.mac_id,reg_id:(v=l[0])==null?void 0:v.registration_id}))},[m,l]);const z=async()=>{try{let a=[],y=[];const v=await A(Ae({w_customer_id:s}));if(Array.isArray(v.payload)){v.payload.forEach(e=>{var r,p,x;Array.isArray(e.imei)&&e.imei.length>0&&((r=e.imei[0])!=null&&r.mac_id)?(a.push({id:e.id,label:e.registration_id,value:(p=e.imei[0])==null?void 0:p.mac_id,workShop:e==null?void 0:e.workshop,vehicle_group:e==null?void 0:e.vehicle_group}),y.push((x=e.imei[0])==null?void 0:x.mac_id)):console.error("IMEI data not found for item:",e)});const I="one",N=y;y.length>0&&A(_e({type:I,imei:N})),A(Ye({w_customer_id:s})),O(a)}else console.error("Unexpected data format:",v),J.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),J.error(`Error fetching vehicle data: ${a}`)}},ee=i.filter(a=>{var B,V,$,q,H;if(!(Object.keys(D).length===0||a.vehicle_group===D.id))return!1;const v=(B=a==null?void 0:a.label)==null?void 0:B.toLowerCase().includes(R.toLowerCase()),I=P===""||((V=a==null?void 0:a.workShop)==null?void 0:V.region)===P,N=b===""||((q=($=a==null?void 0:a.workShop)==null?void 0:$.state)==null?void 0:q.toLowerCase())===(((H=b==null?void 0:b.toString())==null?void 0:H.toLowerCase())||""),e=Number(a.value),r=Y.includes(e),p=!r,x=r&&checkLastPacketRunning(e),_=r&&checkLastPacketRunning2(e);return v&&I&&N&&(w==="online"?r:w==="offline"?p:w==="running"?x:w==="idling"?_:!0)}).sort((a,y)=>a.label.localeCompare(y.label));return t.jsxs("div",{className:"app",children:[t.jsx(Le,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(Ie,{title:"Trip Monitor",setShowVehicles:j,showVehicles:h,setShowCard:c,showCard:g,sideBarTrip:f,setSideBarTrip:L,setShowVehiclesGroup:G,showVehiclesGroup:C}),t.jsx(qe,{setShowVehiclesGroup:G,showVehiclesGroup:C,where:"tripmonitor"}),t.jsxs(u,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(u,{style:{width:h||f?"80%":"100%"},children:t.jsx(Ee,{center:Z,showCard:g})}),h&&t.jsx(u,{style:{width:"20%",backgroundColor:U.grey[100]},children:t.jsx(Ne,{vehicleData:ee,setShowVehicles:j,showVehicles:h,title:"Live Monitor",setSearchedTerm:d,setOptions:K,setState:F,setRegion:Q,searchTerm:R,options:w,state:b,region:P})}),t.jsx(u,{style:{width:n?"22%":"20%",display:f?"block":"none",backgroundColor:U.grey[100]},children:t.jsx(rt,{})})]})]})]})}export{_t as default};
