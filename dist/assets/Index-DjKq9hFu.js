import{j as a,G as ee,y as re,z as L,b as i,I as se,bh as le,be as ce,aC as ie,C as M,ae as de,a6 as ne,P as ue,N as ae,aU as he,af as oe,a1 as pe,a2 as ge,a5 as fe,a4 as _e,E as xe}from"./index-CacN93qF.js";import{V as be}from"./VehicleMenu-Ds59MW8S.js";import{t as ke}from"./SearchTab-CdLD1gTP.js";import"./Loader-aXQLpJNJ.js";import"./LiveMapServices-DZvq79R_.js";import"./Socket-DLjvxrzW.js";import{P as je}from"./Parameters-CYc6kZv-.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as Ce}from"./LeftSideBar2-BwkQRRHQ.js";import{D as De,a as me,b as we,c as ve}from"./DialogTitle-BNdJ_ti5.js";import{D as Se,E as ye,T as Le}from"./Edit-B28UuLm6.js";import{B as V}from"./CircularProgress-DzZZsU67.js";import{D as Be}from"./Delete-BPSZX-cE.js";import{T as Pe,a as Ae,b as Ve,c as te,d as x,e as Ie}from"./TableRow-DMTc0tJv.js";import{T as Ee}from"./TablePagination-oTuvnKOX.js";import{A as Te}from"./AddBreakdown-C3htCKFa.js";import"./index.esm-d8zh13kM.js";import{V as Ge}from"./VehicleGroups-DIq4HoXd.js";import{S as $e}from"./ServicesTopBar-DvqqBmgr.js";import"./menu2-KEMXhPrS.js";import"./useControlled-BXHThFOr.js";import"./Autocomplete-qaXh0VnZ.js";import"./usePreviousProps-MKzw59pG.js";import"./TextField-6YjVvODZ.js";import"./index-Cg7om6Xs.js";import"./createSvgIcon-DvNtrQm6.js";import"./Card-CYXROPVQ.js";import"./CardContent-WBRQe_rl.js";import"./Close-CaDFqelt.js";import"./Add-DmUzPyFb.js";import"./formik.esm-8vBi-df4.js";import"./SearchInput-BhrDPnJa.js";import"./NewLoader-7qFqfefi.js";const Me=({open:b,onClose:p,onConfirm:f})=>a.jsxs(De,{open:b,onClose:p,children:[a.jsx(me,{children:"Confirm Deletion"}),a.jsx(we,{children:a.jsxs(Se,{children:["Are you sure you want to delete this vehicle data?"," ",a.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),a.jsxs(ve,{children:[a.jsx(ee,{onClick:p,color:"primary",children:"Cancel"}),a.jsx(ee,{onClick:f,color:"secondary",children:"Delete"})]})]}),Ue="https://cc.wikitrak.in/api-proxy/api/v1",Oe={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Re=({breakdownData:b,status:p})=>{const f=re(),{isUpdateBreakdown:U}=L(d=>d.equipment),{w_customer_id:j}=L(d=>d.auth),[C,D]=i.useState(!1),S=()=>{console.log("breakdownData",b),localStorage.getItem("role"),f(le(!U)),f(ce(b))},m=()=>{console.log("dlt btn clicked");const d=localStorage.getItem("role");ie.includes(d)?D(!0):M.error(`Sorry! Your role is ${d}. You're not allowed to add, edit or delete the vehicle`)},I=async()=>{console.log("breakdownData data deleting");try{await de.delete(`${Ue}/vehicles/breakdown/create/${b.id}/`),M.success("breakdownData data deleted successfully!"),f(ne(j))}catch(d){console.error("Error deleting breakdown data:",d),M.error("Failed to delete breakdown data. Please try again.")}D(!1)},y=()=>{D(!1)},O={color:"#686868"};return a.jsxs(V,{sx:Oe,children:[a.jsx(se,{onClick:S,color:"primary",disabled:(p==null?void 0:p.toLowerCase())==="rejected"||(p==null?void 0:p.toLowerCase())==="close",children:a.jsx(ye,{})}),a.jsx(se,{onClick:m,children:a.jsx(Be,{sx:O})}),a.jsx(Me,{open:C,onClose:y,onConfirm:I})]})},He=[{id:"BDID",label:"BDID"},{id:"Vehicle",label:"Vehicle No"},{id:"Topic",label:"Topic"},{id:"User",label:"User"},{id:"SubmissionDate",label:"Submission Date"},{id:"SubmissionTime",label:"Submission Time"},{id:"WorkshopGroup",label:"Workshop Group"},{id:"Status",label:"Status"},{id:"Actions",label:"Actions"}],Ne=()=>{const{breakdowns:b}=L(e=>e.breakdown),{searchTerm:p}=L(e=>e.inspection),[f,U]=i.useState("asc"),[j,C]=i.useState("BDID"),[D,S]=i.useState(0),[m,I]=i.useState(8),[y,O]=i.useState({id:"",status:"",workshop:"",user:""}),d=e=>{U(j===e&&f==="asc"?"desc":"asc"),C(e)},B=(e,t)=>{S(t)},R=e=>{I(parseInt(e.target.value,10)),S(0)},E=(e,t,c)=>e.filter(s=>{var k,_,A,g,v,Y,F,W,q,z,Z,J,K,Q,X;const r=new Date,n=new Date(s.submission_date);if(r.setHours(0,0,0,0),n.setHours(0,0,0,0),(c==null?void 0:c.toLowerCase())==="overdue"&&n<r&&s.status.toLowerCase()==="open")return!0;const u=(c==null?void 0:c.toLowerCase())||"",l=(k=s==null?void 0:s.breakdown_id)==null?void 0:k.toLowerCase().includes(u),h=`${(A=(_=s==null?void 0:s.user)==null?void 0:_.us_user)==null?void 0:A.first_name} ${(v=(g=s==null?void 0:s.user)==null?void 0:g.us_user)==null?void 0:v.last_name}`.toLowerCase().includes(u),w=(Y=s==null?void 0:s.status)==null?void 0:Y.toLowerCase().includes(u),G=(F=s==null?void 0:s.workshop_group)==null?void 0:F.group_name.toLowerCase().includes(u),$=(q=(W=s==null?void 0:s.breakdown_topic)==null?void 0:W.topic)==null?void 0:q.toLowerCase().includes(u),o=(Z=(z=s==null?void 0:s.vehicle)==null?void 0:z.registration_id)==null?void 0:Z.toLowerCase().includes(u);return!(c&&!(l||h||w||G||$||o)||t.id&&!s.breakdown_id.includes(t.id)||t.status&&s.status!==t.status||t.workshop&&s.workshop_group.group_name!==t.workshop||t.user&&!s.user.us_user.first_name.toLowerCase().includes(t.user.toLowerCase())&&!s.user.us_user.last_name.toLowerCase().includes(t.user.toLowerCase())||t.topic&&!((K=(J=s.breakdown_topic)==null?void 0:J.topic)!=null&&K.toLowerCase().includes(t.topic.toLowerCase()))||t.vehicle&&!((X=(Q=s.vehicle)==null?void 0:Q.registration_id)!=null&&X.toLowerCase().includes(t.vehicle.toLowerCase())))}),H=(e,t,c,s)=>{if(s==="User"){const r=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),n=`${t.user.us_user.first_name} ${t.user.us_user.last_name}`.toLowerCase();return c==="asc"?r.localeCompare(n):n.localeCompare(r)}if(s==="WorkshopGroup"){const r=e.workshop_group.group_name.toLowerCase(),n=t.workshop_group.group_name.toLowerCase();return c==="asc"?r.localeCompare(n):n.localeCompare(r)}if(s==="BDID"){const r=parseInt(e.breakdown_id.replace("BD-",""),10),n=parseInt(t.breakdown_id.replace("BD-",""),10);return c==="asc"?r-n:n-r}if(s==="SubmissionDate"){const r=new Date(e.submission_date),n=new Date(t.submission_date);return c==="asc"?r-n:n-r}if(s==="Status"){const r={Open:1,Close:2,Rejected:3},n=r[e.status]||0,u=r[t.status]||0;return c==="asc"?n-u:u-n}return 0},P=E(b.slice(),y,p).sort((e,t)=>H(e,t,f,j)),T=P.slice(D*m,D*m+m),N={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};return a.jsx(V,{sx:{m:"10px"},children:a.jsxs(ue,{children:[a.jsx(Pe,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:a.jsxs(Ae,{stickyHeader:!0,children:[a.jsx(Ve,{children:a.jsx(te,{children:He.map(e=>a.jsx(x,{sx:N,children:a.jsx(Le,{active:j===e.id,direction:j===e.id?f:"asc",onClick:()=>d(e.id),children:e.label})},e.id))})}),a.jsx(Ie,{children:T.map((e,t)=>{var c,s,r,n,u,l,h;return a.jsxs(te,{children:[a.jsx(x,{children:e==null?void 0:e.breakdown_id}),a.jsx(x,{children:(c=e==null?void 0:e.vehicle)==null?void 0:c.registration_id}),a.jsx(x,{children:(s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic}),a.jsx(x,{children:`${(n=(r=e==null?void 0:e.user)==null?void 0:r.us_user)==null?void 0:n.first_name} ${(l=(u=e==null?void 0:e.user)==null?void 0:u.us_user)==null?void 0:l.last_name}`}),a.jsx(x,{children:(e==null?void 0:e.submission_date)&&ae.utc(e.submission_date).local().format("YYYY-MM-DD")||"N/A"}),a.jsx(x,{children:(e==null?void 0:e.submission_date)&&ae.utc(e.submission_date).local().format("HH:mm A")||"N/A"}),a.jsx(x,{children:(h=e==null?void 0:e.workshop_group)==null?void 0:h.group_name}),a.jsx(x,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),a.jsx(x,{children:a.jsx(Re,{breakdownData:e,status:e.status})})]},t)})})]})}),a.jsx(Ee,{component:"div",count:P.length,page:D,onPageChange:B,rowsPerPage:m,onRowsPerPageChange:R,rowsPerPageOptions:[5,10,15]})]})})},Ye=Ne;function vs(){const{locationData:b,selectedVehicle:p,selectedParameterList:f,onlineVehicle:U}=L(l=>l.liveMap),{mode:j,selectedVehicleGroup:C,vehicleZone:D}=L(l=>l.dashboard),S=ke(j),[m,I]=i.useState([]),{w_customer_id:y}=L(l=>l.auth),[O,d]=i.useState(),[B,R]=i.useState(!1),[E,H]=i.useState(!1),[P,T]=i.useState([]);i.useState(!0);const[N,e]=i.useState(!1),[t,c]=i.useState(!1);let s=re();i.useEffect(()=>{r(),s(he()),s(ne(y))},[]),i.useEffect(()=>{console.log("selectedVehicleGroup",C)},[C]),i.useEffect(()=>{T([]),s(oe([{reg_id:"",imei:"",params:[]}]))},[p]);const r=async()=>{try{e(!0);let l=[],h=[];const w=await s(pe({w_customer_id:y}));if(Array.isArray(w.payload)){w.payload.forEach(o=>{var k,_,A,g;Array.isArray(o.imei)&&o.imei.length>0&&((k=o.imei[0])!=null&&k.mac_id)?(l.push({id:o.id,label:o.registration_id,value:(_=o.imei[0])==null?void 0:_.mac_id,vehilce_type:o==null?void 0:o.segment,chassis_no:o==null?void 0:o.chassis_no,engine_no:o==null?void 0:o.engine_no,workShop:o==null?void 0:o.workshop,registration_id:o==null?void 0:o.registration_id,sell_date:o==null?void 0:o.sell_date,customer_name:o==null?void 0:o.customer_name,vehicle_model:(A=o==null?void 0:o.vehicle_model)==null?void 0:A.name,user:o==null?void 0:o.user,vehicle_group:o==null?void 0:o.vehicle_group}),h.push((g=o.imei[0])==null?void 0:g.mac_id)):console.error("IMEI data not found for item:",o)});const G="one",$=h;h.length>0&&s(ge({type:G,imei:$})),I(l),s(fe({w_customer_id:y})),s(_e(l)),e(!1)}else e(!1),console.error("Unexpected data format:",w),M.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),M.error(`Error fetching vehicle data: ${l}`)}},n=async l=>{const{label:h,imei:w,id:G,reg_id:$,checked:o}=l;d(g=>g.map(v=>v.id===G?{...v,checked:!o}:v));let k=[...P],_=[...P];if(!o)b.forEach(g=>{g.latestDocument.imei===w&&(k.push({label:h,value:g.latestDocument[h==="maininputvoltage"?"mainInputVoltage":h]}),_=k,T(k))});else{let g=P.filter(v=>v.label!==h);_=g,T(g)}console.log("tempParamList",_),s(oe([{reg_id:$,imei:w,params:_}]))},u=m.filter(l=>Object.keys(C).length===0||l.vehicle_group===C.id);return a.jsxs("div",{className:"app",children:[a.jsx(Ce,{}),a.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[a.jsx($e,{title:"Breakdown",setShowVehicles:R,showVehicles:B,setShowVehiclesGroup:c,showVehiclesGroup:t}),a.jsx(Ge,{setShowVehiclesGroup:c,showVehiclesGroup:t}),a.jsxs(V,{style:{display:"flex",width:"100%",height:"95vh"},children:[a.jsxs(V,{style:{width:B||E?"80%":"100%",background:xe.bgShadow},children:[a.jsx(Te,{where:"Breakdown"}),a.jsx(Ye,{})]}),B&&a.jsx(V,{style:{width:"20%",backgroundColor:S.grey[100]},children:a.jsx(be,{vehicleData:u,title:"Inspections",setParameterData:d,loadingVehicle:N,setShowVehicles:R,showVehicles:B,showParameters:E,setShowParameters:H})}),E&&a.jsx(V,{style:{width:"20%",backgroundColor:S.grey[100]},children:a.jsx(je,{parametersData:O,setParameterData:d,handleParameterChange:n})})]})]})]})}export{vs as default};
