import{R as F,x as L,j as e,F as J,ao as U,b as t,ba as q,bb as z,bg as G,bf as H,y as D,ac as T,$ as K,a0 as Q,a2 as X,B as A}from"./index-CTkhISWS.js";import{V as Y}from"./VehicleMenu-Cqr3r_B1.js";import{t as Z}from"./Search-B8KaEu9H.js";import"./Loader-CfnhVkcH.js";import"./LiveMapServices-CvdgHIU6.js";import"./Socket-DLjvxrzW.js";import{P as ee}from"./Parameters-Cl_1FD01.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as se}from"./LeftSideBar2-ChCnEeg2.js";import{C as ae,S as re}from"./ServiceRecordTable-CEKuR8Zi.js";import{d as te}from"./Close-Pg18Ol1R.js";import{D as oe,a as ie,b as ne}from"./DialogTitle-1Pr93vft.js";import{I as ce}from"./IconButton-BFq29S61.js";import"./NewLoader-qxQ6gpZB.js";import{S as le}from"./ServiceJobCardTable-CKeYT0x0.js";import{B as p}from"./CircularProgress-BtfWMK0B.js";import{T as de,a as B}from"./Tabs-C0Fosbcz.js";import{S as pe}from"./ServicesTopBar-D-wnulPg.js";import"./RegionSelector-PPpxxeXN.js";import"./SearchTab-YHMQLTXW.js";import"./OutlinedInput-BptfRdp1.js";import"./InputAdornment-BQGdcE5C.js";import"./Select-DvAnSXcw.js";import"./Paper-CiQNsGfa.js";import"./MenuItem-CNipEDD9.js";import"./menu2-CSH6e-AV.js";import"./Autocomplete-DbnD44Tt.js";import"./Tooltip-CROS0JFr.js";import"./usePreviousProps-CqKwpGw7.js";import"./TextField-C-2EsYxU.js";import"./createSvgIcon-B8RWTts6.js";import"./index-VrboQCeR.js";import"./Card-CYV0s3wQ.js";import"./CardContent-CSfT-bXO.js";import"./index.esm-VHIyZZ1X.js";import"./formik.esm-dnupI6vH.js";import"./excelUtils-DnQ0Klv3.js";import"./button-CZ2IJZOD.js";import"./TableRow-B_DBKy_d.js";import"./Edit-C0KEOGWg.js";import"./TablePagination-DgfdBqA4.js";import"./index-Dswl9mzP.js";import"./roundedArrow-D1JlIit0.js";import"./TextArea-CDyH6ymW.js";function he(){const[i,r]=F.useState(!1);L();const n=()=>r(!0),l=()=>r(!1);return e.jsxs("div",{children:[e.jsx(J,{variant:"outlined",onClick:n,children:"+ Add New Entry"}),e.jsxs(oe,{open:i,onClose:l,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[e.jsxs(ie,{children:["+ Add new service entry",e.jsx(ce,{"aria-label":"close",onClick:l,sx:{position:"absolute",right:8,top:8},children:e.jsx(te,{})})]}),e.jsx(ne,{dividers:!0,children:e.jsx(ae,{setOpen:r})})]})]})}function me(){const[i]=U(),r=i.get("tab"),[n,l]=t.useState(0);t.useEffect(()=>{r&&l(Number(r))},[]);const f=(V,v)=>{l(v)};return e.jsxs(p,{sx:{width:"100%"},children:[e.jsx(p,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(de,{value:n,onChange:f,"aria-label":"Breakdown Tabs",children:[e.jsx(B,{label:"Service Tickets"}),e.jsx(B,{label:"Service Job Cards"})]})}),e.jsxs(p,{sx:{mt:2},children:[n===0&&e.jsx(re,{isInspection:!1}),n===1&&e.jsx(le,{isInspection:!1})]})]})}const ue=()=>{const i=L();t.useEffect(()=>{i(q()),i(z()),i(G())},[]);let r=H("Service");const n=(r==null?void 0:r.includes("Create"))||r==="Read-Write-Only";return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),n&&e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(he,{})}),"      "]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(me,{})})]})]})},xe=ue;function ns(){const{locationData:i,selectedVehicle:r,selectedParameterList:n}=D(a=>a.liveMap),{mode:l}=D(a=>a.dashboard),f=Z(l),[V,v]=t.useState([]),{w_customer_id:I}=D(a=>a.auth),[M,b]=t.useState(),[g,k]=t.useState(!1),[j,E]=t.useState(!1),[S,y]=t.useState([]),[R,N]=t.useState(!0),[O,_]=t.useState(!1);let u=L();t.useEffect(()=>{W()},[]),t.useEffect(()=>{y([]),u(T([{reg_id:"",imei:"",params:[]}]))},[r]);const W=async()=>{try{_(!0);let a=[],c=[];const h=await u(K({w_customer_id:I}));if(Array.isArray(h.payload)){h.payload.forEach(s=>{var m,d,P,o;Array.isArray(s.imei)&&s.imei.length>0&&((m=s.imei[0])!=null&&m.mac_id)?(a.push({id:s.id,label:s.registration_id,value:(d=s.imei[0])==null?void 0:d.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(P=s==null?void 0:s.vehicle_model)==null?void 0:P.name}),c.push((o=s.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",s)});const C="one",w=c;c.length>0&&u(Q({type:C,imei:w})),v(a),u(X(a)),_(!1)}else _(!1),console.error("Unexpected data format:",h),A.error("Unexpected data format:")}catch(a){console.error("Error fetching vehicle data:",a),A.error(`Error fetching vehicle data: ${a}`)}},$=async a=>{const{label:c,imei:h,id:C,reg_id:w,checked:s}=a;b(o=>o.map(x=>x.id===C?{...x,checked:!s}:x));let m=[...S],d=[...S];if(!s)i.forEach(o=>{o.latestDocument.imei===h&&(m.push({label:c,value:o.latestDocument[c==="maininputvoltage"?"mainInputVoltage":c]}),d=m,y(m))});else{let o=S.filter(x=>x.label!==c);d=o,y(o)}console.log("tempParamList",d),u(T([{reg_id:w,imei:h,params:d}]))};return e.jsxs("div",{className:"app",children:[e.jsx(se,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(pe,{title:"services",setShowVehicles:k,showVehicles:g,showParameters:j,setShowParameters:E,setShowCard:N,showCard:R}),e.jsxs(p,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(p,{style:{width:g||j?"80%":"100%"},children:e.jsx(xe,{})}),g&&e.jsx(p,{style:{width:"20%",backgroundColor:f.grey[100]},children:e.jsx(Y,{vehicleData:V,title:"Inspections",setParameterData:b,loadingVehicle:O,setShowVehicles:k,showVehicles:g,showParameters:j,setShowParameters:E})}),j&&e.jsx(p,{style:{width:"20%",backgroundColor:f.grey[100]},children:e.jsx(ee,{parametersData:M,setParameterData:b,handleParameterChange:$})})]})]})]})}export{ns as default};
