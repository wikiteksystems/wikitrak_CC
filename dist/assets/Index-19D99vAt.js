import{b as o,z as w,y as L,bm as W,C as N,j as e,G as I,R as G,be as H,bf as J,af as $,a1 as Y,a2 as K,a4 as Q}from"./index-D0FmrQMl.js";import{V as X}from"./VehicleMenu-B4RKhbj8.js";import{t as Z}from"./SearchTab-EBUI1uS_.js";import"./Loader-CRuSs28W.js";import"./LiveMapServices-C2rCKPJc.js";import"./Socket-DLjvxrzW.js";import{P as ee}from"./Parameters-CqDLlWqE.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as se}from"./LeftSideBar2-CM-CVVSt.js";import{S as re}from"./ServiceRecordTable-w0KJlffy.js";import{a as ae}from"./formik.esm-CGi3yw3H.js";import{c as te,a as S}from"./index.esm-B0m3l6wU.js";import{N as oe}from"./NewLoader-DhBTqkFy.js";import{L as ie,A as le}from"./DateTimePicker-Bz7QZFBE.js";import{T as b}from"./TextField-w1664Esy.js";import{M as F}from"./menu2-27zSHRom.js";import{B as C}from"./CircularProgress-DhkJPjti.js";import{D as ne,a as ce,b as de}from"./DialogTitle-Cx-MtLkH.js";import{S as he}from"./ServicesTopBar-Czqff-ui.js";import"./Autocomplete-8MhQmwzD.js";import"./useControlled-BwwN02Wn.js";import"./usePreviousProps-Dj-Y536L.js";import"./index-x016YJoK.js";import"./createSvgIcon-DKzWMzHB.js";import"./Card-GH12E0wI.js";import"./CardContent-BIiiz5YM.js";import"./SearchInput-C0SUE3zU.js";import"./index--GRiqBtc.js";import"./TableRow-DWzwPe8B.js";import"./TablePagination-D30uMeQs.js";const pe=({setOpen:n})=>{const[c,f]=o.useState(null),{vehicleList:u}=w(a=>a.liveMap),{vendorList:E,segMentList:P,loading:k}=w(a=>a.services),A=L(),[M,x]=o.useState([]),[d,D]=o.useState([]),s=ae({initialValues:{vehicle:"",vendor:"",priority_class:"",chassis_no:"",odometer:"",attachment:null,status:"Pending"},validationSchema:te().shape({vehicle:S().required("Vehicle is required"),vendor:S().required("Vendor is required"),priority_class:S().required("Priority class is required"),chassis_no:S().required("Chassis number is required"),odometer:S().required("Odometer is required")}),onSubmit:async a=>{const t=new FormData;t.append("vehicle",a.vehicle),t.append("segment",a.vendor),t.append("priority_class",a.priority_class),t.append("chassis_no",a.chassis_no),t.append("odometer",a.odometer),c&&t.append("attachment",c),t.append("status",a.status),t.append("user",JSON.parse(localStorage.getItem("w_userDetails")).user_id),console.log("form data",a),(await A(W(t))).payload&&(N.success("Service created successfully"),s.resetForm(),f(null),n(!1))}}),V=a=>{const t=a.target.files[0];f(t),s.setFieldValue("attachment",t)},g=["On Time","Over Due","Emergency"];o.useEffect(()=>{let a=u.map(t=>({label:t.registration_id,value:t.id}));x(a)},[u]),o.useEffect(()=>{let a=P.map(t=>({label:t.segment_name,value:t.id}));D(a)},[P]);const y={PaperProps:{style:{maxHeight:300,overflowY:"auto"}}};return e.jsxs(ie,{dateAdapter:le,children:[k&&e.jsx(oe,{}),e.jsxs("form",{onSubmit:s.handleSubmit,style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx(b,{select:!0,name:"vehicle",label:"Select Vehicle",value:s.values.vehicle,onChange:s.handleChange,error:s.touched.vehicle&&!!s.errors.vehicle,helperText:s.touched.vehicle&&s.errors.vehicle,SelectProps:{MenuProps:y},children:M.map(a=>e.jsx(F,{value:a.value,children:a.label},a.value))}),e.jsx(b,{select:!0,name:"vendor",label:"Select segment",value:s.values.vendor,onChange:s.handleChange,error:s.touched.vendor&&!!s.errors.vendor,helperText:s.touched.vendor&&s.errors.vendor,children:d&&d.length>0&&d.map(a=>e.jsx(F,{value:a.value,children:a.label},a.value))}),e.jsx(b,{select:!0,name:"priority_class",label:"Priority Class",value:s.values.priority_class,onChange:s.handleChange,error:s.touched.priority_class&&!!s.errors.priority_class,helperText:s.touched.priority_class&&s.errors.priority_class,children:g.map(a=>e.jsx(F,{value:a,children:a},a))}),e.jsx(b,{name:"chassis_no",label:"Chassis Number",value:s.values.chassis_no,onChange:s.handleChange,error:s.touched.chassis_no&&!!s.errors.chassis_no,helperText:s.touched.chassis_no&&s.errors.chassis_no}),e.jsx(b,{name:"odometer",label:"Odometer",value:s.values.odometer,onChange:s.handleChange,error:s.touched.odometer&&!!s.errors.odometer,helperText:s.touched.odometer&&s.errors.odometer}),e.jsxs(C,{children:[e.jsx("input",{type:"file",name:"attachment",onChange:V}),s.touched.attachment&&s.errors.attachment&&e.jsx("div",{style:{color:"red"},children:s.errors.attachment})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[e.jsx(I,{type:"submit",variant:"contained",color:"primary",sx:{mr:2},children:"Save"}),e.jsx(I,{variant:"outlined",onClick:()=>n(!1),children:"Cancel"})]})]})]})};function ue(){const[n,c]=G.useState(!1);L();const f=()=>c(!0),u=()=>c(!1);return e.jsxs("div",{children:[e.jsx(I,{variant:"outlined",onClick:f,children:"+ Add New Entry"}),e.jsxs(ne,{open:n,onClose:u,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[e.jsx(ce,{children:"Add New Entry"}),e.jsx(de,{dividers:!0,children:e.jsx(pe,{setOpen:c})})]})]})}const me=()=>{const n=L();return o.useEffect(()=>{n(H()),n(J())},[]),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(ue,{})})]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(re,{isInspection:!1})})]})]})},ve=me;function He(){const{locationData:n,selectedVehicle:c,selectedParameterList:f}=w(i=>i.liveMap),{mode:u}=w(i=>i.dashboard),E=Z(u),[P,k]=o.useState([]),{w_customer_id:A}=w(i=>i.auth),[M,x]=o.useState(),[d,D]=o.useState(!1),[s,V]=o.useState(!1),[g,y]=o.useState([]),[a,t]=o.useState(!0),[R,T]=o.useState(!1);let j=L();o.useEffect(()=>{z()},[]),o.useEffect(()=>{y([]),j($([{reg_id:"",imei:"",params:[]}]))},[c]);const z=async()=>{try{T(!0);let i=[],h=[];const m=await j(Y({w_customer_id:A}));if(Array.isArray(m.payload)){m.payload.forEach(r=>{var v,p,B,l;Array.isArray(r.imei)&&r.imei.length>0&&((v=r.imei[0])!=null&&v.mac_id)?(i.push({id:r.id,label:r.registration_id,value:(p=r.imei[0])==null?void 0:p.mac_id,vehilce_type:r==null?void 0:r.segment,chassis_no:r==null?void 0:r.chassis_no,engine_no:r==null?void 0:r.engine_no,workShop:r==null?void 0:r.workshop,registration_id:r==null?void 0:r.registration_id,sell_date:r==null?void 0:r.sell_date,customer_name:r==null?void 0:r.customer_name,vehicle_model:(B=r==null?void 0:r.vehicle_model)==null?void 0:B.name}),h.push((l=r.imei[0])==null?void 0:l.mac_id)):console.error("IMEI data not found for item:",r)});const O="one",q=h;h.length>0&&j(K({type:O,imei:q})),k(i),j(Q(i)),T(!1)}else T(!1),console.error("Unexpected data format:",m),N.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),N.error(`Error fetching vehicle data: ${i}`)}},U=async i=>{const{label:h,imei:m,id:O,reg_id:q,checked:r}=i;x(l=>l.map(_=>_.id===O?{..._,checked:!r}:_));let v=[...g],p=[...g];if(!r)n.forEach(l=>{l.latestDocument.imei===m&&(v.push({label:h,value:l.latestDocument[h==="maininputvoltage"?"mainInputVoltage":h]}),p=v,y(v))});else{let l=g.filter(_=>_.label!==h);p=l,y(l)}console.log("tempParamList",p),j($([{reg_id:q,imei:m,params:p}]))};return e.jsxs("div",{className:"app",children:[e.jsx(se,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(he,{title:"services",setShowVehicles:D,showVehicles:d,showParameters:s,setShowParameters:V,setShowCard:t,showCard:a}),e.jsxs(C,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(C,{style:{width:d||s?"80%":"100%"},children:e.jsx(ve,{})}),d&&e.jsx(C,{style:{width:"20%",backgroundColor:E.grey[100]},children:e.jsx(X,{vehicleData:P,title:"Inspections",setParameterData:x,loadingVehicle:R,setShowVehicles:D,showVehicles:d,showParameters:s,setShowParameters:V})}),s&&e.jsx(C,{style:{width:"20%",backgroundColor:E.grey[100]},children:e.jsx(ee,{parametersData:M,setParameterData:x,handleParameterChange:U})})]})]})]})}export{He as default};
