import{r as o,k as x,i as L,a5 as Y,b3 as U,w as N,j as e,B as M,b4 as W,b5 as K,t as Z,I as Q,af as X,ag as ee,Z as $,K as te,L as ae,N as se}from"./index-BqbafYZ_.js";import{V as re}from"./VehicleMenu-BK6frfrr.js";import{b as oe,c as le,w as ie,e as ne,f as ce,L as de,t as he}from"./LeftSideBar2-CZpYIOYM.js";import"./Loader-ZFscCc2o.js";import"./LiveMapServices-BFWNuyH6.js";import"./Socket-0N_gnJcr.js";import{P as pe}from"./Parameters-C2mcSZqn.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as ue,A as me,D as R,S as xe}from"./ServiceRecordTable-BkyWg0uh.js";import{u as ge}from"./formik.esm-Ctx3TEWd.js";import{c as fe,a as V,f as G,e as ve}from"./index.esm-DkA8kRq-.js";import{T as y,M as O}from"./TextField-pbAiEyqG.js";import{B as n,M as _e}from"./menu2-be6SFaqr.js";import{T as ye}from"./index-CJxgHOxQ.js";import"./useControlled-Xop6mU4U.js";import"./createSvgIcon-BDSOXZTB.js";import"./index-CSuzkuwo.js";import"./Card-Br1VoqnT.js";import"./CardContent-D-W0CJcz.js";import"./dayjs.min-qQx061uA.js";import"./customParseFormat-GJVJ9Tkj.js";import"./useMediaQuery-D8sANfQf.js";import"./TablePagination-Ca3No-5S.js";import"./TableCell-DGzQ8pqq.js";import"./Checkbox-BC1MGZ-k.js";import"./SwitchBase-CTAvL2Sc.js";import"./FormControlLabel-BrxgXyZM.js";const je=({setOpen:i})=>{const[h,j]=o.useState(null),{vehicleList:g}=x(a=>a.liveMap),{vendorList:b,segMentList:D}=x(a=>a.services),T=L(),[B,q]=o.useState([]),[p,f]=o.useState([]),t=ge({initialValues:{vehicle:"",vendor:"",priority_class:"",completion_date:null,next_due_date:null,chassis_no:"",odometer:"",attachment:null,status:"Pending"},validationSchema:fe().shape({vehicle:V().required("Vehicle is required"),vendor:V().required("Vendor is required"),priority_class:V().required("Priority class is required"),completion_date:G().nullable().required("Completion date is required"),next_due_date:G().nullable().required("Next due date is required"),chassis_no:V().required("Chassis number is required"),odometer:V().required("Odometer is required"),attachment:ve().nullable().required("Attachment is required")}),onSubmit:async a=>{const r=new FormData;r.append("vehicle",a.vehicle),r.append("segment",a.vendor),r.append("priority_class",a.priority_class),r.append("completion_date",Y(new Date(a.completion_date)).format("YYYY-MM-DD")),r.append("next_due_date",Y(new Date(a.next_due_date)).format("YYYY-MM-DD")),r.append("chassis_no",a.chassis_no),r.append("odometer",a.odometer),r.append("attachment",h),r.append("status",a.status),r.append("user",JSON.parse(localStorage.getItem("w_userDetails")).user_id),console.log("form data",a),(await T(U(r))).payload&&(N.success("Service created successfully"),t.resetForm(),j(null),i(!1))}}),d=a=>{const r=a.target.files[0];j(r),t.setFieldValue("attachment",r)},v=["On Time","Over Due","Emergency"];o.useEffect(()=>{let a=g.map(r=>({label:r.registration_id,value:r.id}));q(a)},[g]),o.useEffect(()=>{let a=D.map(r=>({label:r.segment_name,value:r.id}));f(a)},[D]);const w={PaperProps:{style:{maxHeight:300,overflowY:"auto"}}};return e.jsx(ue,{dateAdapter:me,children:e.jsxs("form",{onSubmit:t.handleSubmit,style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx(y,{select:!0,name:"vehicle",label:"Select Vehicle",value:t.values.vehicle,onChange:t.handleChange,error:t.touched.vehicle&&!!t.errors.vehicle,helperText:t.touched.vehicle&&t.errors.vehicle,SelectProps:{MenuProps:w},children:B.map(a=>e.jsx(O,{value:a.value,children:a.label},a.value))}),e.jsx(y,{select:!0,name:"vendor",label:"Select segment",value:t.values.vendor,onChange:t.handleChange,error:t.touched.vendor&&!!t.errors.vendor,helperText:t.touched.vendor&&t.errors.vendor,children:p&&p.length>0&&p.map(a=>e.jsx(O,{value:a.value,children:a.label},a.value))}),e.jsx(y,{select:!0,name:"priority_class",label:"Priority Class",value:t.values.priority_class,onChange:t.handleChange,error:t.touched.priority_class&&!!t.errors.priority_class,helperText:t.touched.priority_class&&t.errors.priority_class,children:v.map(a=>e.jsx(O,{value:a,children:a},a))}),e.jsx(R,{label:"Completion Date",value:t.values.completion_date,onChange:a=>t.setFieldValue("completion_date",a),renderInput:a=>e.jsx(y,{...a,error:t.touched.completion_date&&!!t.errors.completion_date,helperText:t.touched.completion_date&&t.errors.completion_date})}),e.jsx(R,{label:"Next Due Date",value:t.values.next_due_date,onChange:a=>t.setFieldValue("next_due_date",a),renderInput:a=>e.jsx(y,{...a,error:t.touched.next_due_date&&!!t.errors.next_due_date,helperText:t.touched.next_due_date&&t.errors.next_due_date})}),e.jsx(y,{name:"chassis_no",label:"Chassis Number",value:t.values.chassis_no,onChange:t.handleChange,error:t.touched.chassis_no&&!!t.errors.chassis_no,helperText:t.touched.chassis_no&&t.errors.chassis_no}),e.jsx(y,{name:"odometer",label:"Odometer",value:t.values.odometer,onChange:t.handleChange,error:t.touched.odometer&&!!t.errors.odometer,helperText:t.touched.odometer&&t.errors.odometer}),e.jsxs(n,{children:[e.jsx("input",{type:"file",name:"attachment",onChange:d}),t.touched.attachment&&t.errors.attachment&&e.jsx("div",{style:{color:"red"},children:t.errors.attachment})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[e.jsx(M,{type:"submit",variant:"contained",color:"primary",sx:{mr:2},children:"Save"}),e.jsx(M,{variant:"outlined",onClick:()=>i(!1),children:"Cancel"})]})]})})},be={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid black",borderRadius:"5px",boxShadow:24,p:4,height:"600px",overflowY:"auto",scrollbarWidth:"50%"};function we(){const[i,h]=o.useState(!1);L();const j=()=>h(!0),g=()=>h(!1);return e.jsxs("div",{children:[e.jsx(M,{variant:"outlined",onClick:j,children:"+ Add New Entry"}),e.jsx(_e,{open:i,onClose:g,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",BackdropProps:{onClick:b=>b.stopPropagation()},children:e.jsx(n,{sx:be,children:e.jsx(je,{setOpen:h})})})]})}const Se=()=>{const i=L();return o.useEffect(()=>{i(W()),i(K())},[]),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[e.jsx("div",{style:{margin:"10px"},children:e.jsx("h3",{children:"Service Record"})}),e.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:e.jsx(we,{})})]}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("div",{style:{margin:"10px"},children:e.jsx(xe,{})})]})]})},Ce=Se;function De({title:i,showVehicles:h,setShowVehicles:j,setShowParameters:g,showParameters:b,setShowCard:D,showCard:T,setSideBarTrip:B,sideBarTrip:q,setShowVehiclesGroup:p,showVehiclesGroup:f}){const t=L(),{collapsed:d}=x(u=>u.auth);x(u=>u.liveMap),JSON.parse(localStorage.getItem("w_userDetails"));const{mode:v,selectedVehicleGroup:w}=x(u=>u.dashboard),a=()=>{t(ee(!d))},r={fontSize:"26px",fontWeight:500,lineHeight:"18.38px",color:"#fff",textAlign:"center",paddingTop:"5px",fontFamily:"ubuntu"};return e.jsxs(n,{style:{display:"flex",justifyContent:"space-between",paddingRight:"20px",backgroundColor:Z.bgColor,alignItems:"center",textAlign:"center",height:"60px",color:"white"},children:[e.jsxs(n,{style:{display:"flex",justifyContent:"space-between",gap:"10px",alignItems:"center",width:"50%"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[d?e.jsx(M,{onClick:a,sx:{color:"white"},children:e.jsx(oe,{style:{width:"30px",height:"30px"}})}):e.jsx(M,{onClick:a,sx:{color:"white"},children:e.jsx(le,{style:{width:"30px",height:"30px"}})}),e.jsx("img",{src:ie,alt:"wikitrak logo"})]}),e.jsx(n,{children:e.jsx(ye,{style:r,children:i})})]}),e.jsx(n,{style:{display:"flex",gap:"5px"},children:e.jsx(Q,{onClick:()=>{t(X(!v))},sx:{color:"white"},children:v?e.jsx(ne,{}):e.jsx(ce,{})})})]})}function tt(){const{locationData:i,selectedVehicle:h,selectedParameterList:j}=x(l=>l.liveMap),{mode:g}=x(l=>l.dashboard),b=he(g),[D,T]=o.useState([]),{w_customer_id:B}=x(l=>l.auth),[q,p]=o.useState(),[f,t]=o.useState(!1),[d,v]=o.useState(!1),[w,a]=o.useState([]),[r,u]=o.useState(!0),[z,I]=o.useState(!1);let k=L();o.useEffect(()=>{H()},[]),o.useEffect(()=>{a([]),k($([{reg_id:"",imei:"",params:[]}]))},[h]);const H=async()=>{try{I(!0);let l=[],m=[];const S=await k(te({w_customer_id:B}));if(Array.isArray(S.payload)){S.payload.forEach(s=>{var C,_,F,c;Array.isArray(s.imei)&&s.imei.length>0&&((C=s.imei[0])!=null&&C.mac_id)?(l.push({id:s.id,label:s.registration_id,value:(_=s.imei[0])==null?void 0:_.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(F=s==null?void 0:s.vehicle_model)==null?void 0:F.name}),m.push((c=s.imei[0])==null?void 0:c.mac_id)):console.error("IMEI data not found for item:",s)});const A="one",E=m;m.length>0&&k(ae({type:A,imei:E})),T(l),k(se(l)),I(!1)}else I(!1),console.error("Unexpected data format:",S),N.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),N.error(`Error fetching vehicle data: ${l}`)}},J=async l=>{const{label:m,imei:S,id:A,reg_id:E,checked:s}=l;p(c=>c.map(P=>P.id===A?{...P,checked:!s}:P));let C=[...w],_=[...w];if(!s)i.forEach(c=>{c.latestDocument.imei===S&&(C.push({label:m,value:c.latestDocument[m==="maininputvoltage"?"mainInputVoltage":m]}),_=C,a(C))});else{let c=w.filter(P=>P.label!==m);_=c,a(c)}console.log("tempParamList",_),k($([{reg_id:E,imei:S,params:_}]))};return e.jsxs("div",{className:"app",children:[e.jsx(de,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(De,{title:"services",setShowVehicles:t,showVehicles:f,showParameters:d,setShowParameters:v,setShowCard:u,showCard:r}),e.jsxs(n,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(n,{style:{width:f||d?"80%":"100%"},children:e.jsx(Ce,{})}),f&&e.jsx(n,{style:{width:"20%",backgroundColor:b.grey[100]},children:e.jsx(re,{vehicleData:D,title:"Inspections",setParameterData:p,loadingVehicle:z,setShowVehicles:t,showVehicles:f,showParameters:d,setShowParameters:v})}),d&&e.jsx(n,{style:{width:"20%",backgroundColor:b.grey[100]},children:e.jsx(pe,{parametersData:q,setParameterData:p,handleParameterChange:J})})]})]})]})}export{tt as default};
