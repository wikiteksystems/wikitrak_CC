import{a6 as w,j as l,y as q,b as d,x as ee,U as le,I as z,aq as te}from"./index-CHT5l6Jo.js";import{r as se}from"./createSvgIcon-DEtj2y43.js";import{U as ae}from"./moment-DyFufuAI.js";import{D as de,a as ie,b as ne,T as ce}from"./TablePagination-DxbkSGr5.js";import{d as P}from"./dayjs.min-CcwmJVNu.js";import"./NewLoader-DHRK_WEI.js";import{B as N}from"./customParseFormat-CKor5obk.js";import{B as oe}from"./menu2-0k5jUaug.js";import{T as re,a as he,b as ue,c as G,d as a,e as xe}from"./TableRow-BHcmgH-R.js";var E={},ge=w;Object.defineProperty(E,"__esModule",{value:!0});var k=E.default=void 0,ve=ge(se()),pe=l;k=E.default=(0,ve.default)((0,pe.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");function fe({open:h,setOpen:f,data:_,isInspection:u}){const R=()=>f(!1);return l.jsxs(de,{open:h,onClose:R,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[l.jsx(ie,{children:"Update Information"}),l.jsx(ne,{dividers:!0,children:l.jsx(ae,{setOpen:f,data:_,isInspection:u})})]})}const o={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};function ke({where:h,isInspection:f}){const{collapsed:_}=q(e=>e.auth),{servicesData:u,loading:R,selectedService:m,statusBasedRecord:S}=q(e=>e.services),[T,B]=d.useState(!1),[L,O]=d.useState(null),[x,j]=d.useState(null),[b,I]=d.useState(null),[g,W]=d.useState(""),[D,H]=d.useState(),[C,A]=d.useState(0),[v,J]=d.useState(12),K=ee();d.useEffect(()=>{K(le())},[]),d.useEffect(()=>{let e=u.map(s=>{var t,i,n,c,r;return{...s,vehicle_id:s.vehicle.id,vehicle:s.vehicle.registration_id,vehicle_group:((t=s==null?void 0:s.vehicle)==null?void 0:t.vehicle_group)||"N/A",sub_model:(n=(i=s==null?void 0:s.vehicle)==null?void 0:i.sub_model)==null?void 0:n.name,model:(r=(c=s==null?void 0:s.vehicle)==null?void 0:c.vehicle_model)==null?void 0:r.name}});j(e)},[u]),d.useEffect(()=>{var e,s;if(m&&S.length>0){const i={Overdue:2,"Due soon":1,Serviced:0}[m],n=i!==void 0&&((s=(e=S[i])==null?void 0:e.data)==null?void 0:s.map(c=>{var r,F,M;return{...c,vehicle_id:((r=c.vehicle)==null?void 0:r.id)||"N/A",vehicle:((F=c.vehicle)==null?void 0:F.registration_id)||"N/A",vehicle_group:((M=c.vehicle)==null?void 0:M.vehicle_group)||"N/A"}}))||[];console.log("Filtered Data:",n),H(n)}},[m,S]),d.useEffect(()=>{console.log("tableData: ",x),D&&j(D)},[D]),d.useEffect(()=>{console.log("tableData: ",x)},[x]);const U=e=>{console.log("handleEditClick",e);let s={id:e.id,vehicle:e.vehicle_id,user:e.user.id,priority_class:e.priority_class,completion_date:P(e.completion_date),next_due_date:P(e.next_due_date),segment:e.segment.id,chassis_no:e.chassis_no,odometer:e.odometer,attachment:e.attachment,status:e.status,entry_date:P(e.created)};console.log("objecct",s),B(!T),O(s)};let p=_?150:140,Q=_?220:210;const[_e,X]=d.useState([{field:"vehicle",headerName:"Vehicle",width:p},{field:"vehicle_group",headerName:"Vehicle group",width:p,valueGetter:e=>(e==null?void 0:e.group_name)||"N/A"},{field:"priority_class",headerName:"Priority Class",width:p},{field:"completion_date",headerName:"Completion Date",width:p},{field:"next_due_date",headerName:"Next Due Date",width:p},{field:"segment",headerName:"Segment",width:100,valueGetter:e=>(e==null?void 0:e.segment_name)||""},{field:"user",headerName:"User",width:Q,valueGetter:e=>(e==null?void 0:e.email)||""},{field:"status",headerName:"Status",width:130}]);d.useEffect(()=>{h!=="service report"&&X(e=>[...e,{field:"edit",headerName:"Edit",width:100,renderCell:s=>l.jsx(z,{onClick:()=>U(s.row),color:"primary","aria-label":"edit record",children:l.jsx(k,{})})}])},[h]);const Y=e=>{let s=e.target.value;I(s)},V=x&&x.length>0?x.filter(e=>{var s;return(s=e.vehicle)==null?void 0:s.toLowerCase().includes((b==null?void 0:b.toLowerCase())||"")}):[],y=e=>{if(I(""),W(e),e){let s=u.filter(t=>t.status===e).map(t=>{var i,n,c,r;return{...t,vehicle_id:t.vehicle.id,vehicle:t.vehicle.registration_id,vehicle_group:((i=t==null?void 0:t.vehicle)==null?void 0:i.vehicle_group)||"N/A",sub_model:(c=(n=t==null?void 0:t.vehicle)==null?void 0:n.sub_model)==null?void 0:c.name,model:(r=t==null?void 0:t.vehicle_model)==null?void 0:r.name}});j(s)}else{let s=u.map(t=>{var i,n,c,r;return{...t,vehicle_id:t.vehicle.id,vehicle:t.vehicle.registration_id,vehicle_group:((i=t==null?void 0:t.vehicle)==null?void 0:i.vehicle_group)||"N/A",sub_model:(c=(n=t==null?void 0:t.vehicle)==null?void 0:n.sub_model)==null?void 0:c.name,model:(r=t==null?void 0:t.vehicle_model)==null?void 0:r.name}});j(s)}},Z=(e,s)=>{A(s)},$=e=>{J(parseInt(e.target.value,10)),A(0)};return l.jsxs(l.Fragment,{children:[h!=="service report"&&l.jsxs("div",{children:[l.jsx("input",{placeholder:"Search by vehicle ",value:b,type:"text",style:{padding:"10px",border:"1px solid grey",borderRadius:"5px",width:"250px",margin:"10px"},onChange:Y}),l.jsx(N,{style:{margin:"10px",backgroundColor:g===""?"rgb(141, 166, 198)":void 0,color:g===""?"white":void 0},onClick:()=>y(""),children:"All"}),l.jsx(N,{style:{margin:"10px",backgroundColor:g==="Completed"?"rgb(141, 166, 198)":void 0,color:g==="Completed"?"white":void 0},onClick:()=>y("Completed"),children:"Completed"}),l.jsx(N,{style:{margin:"10px",backgroundColor:g==="Pending"?"rgb(141, 166, 198)":void 0,color:g==="Pending"?"white":void 0},onClick:()=>y("Pending"),children:"Pending"})]}),l.jsxs(oe,{sx:{overflow:"auto",margin:"10px",borderRadius:"5px",background:"white"},children:[l.jsxs(re,{component:te,children:[l.jsxs(he,{children:[l.jsx(ue,{children:l.jsxs(G,{children:[l.jsx(a,{sx:o,children:"Sr no"}),l.jsx(a,{sx:o,children:"Vehicle"}),l.jsx(a,{sx:o,children:"Vehicle group"}),l.jsx(a,{sx:o,children:"Vehicle model"}),l.jsx(a,{sx:o,children:"Vehicle submodel"}),l.jsx(a,{sx:o,children:"Priority class"}),l.jsx(a,{sx:o,children:"Completion date"}),l.jsx(a,{sx:o,children:"Next due date"}),l.jsx(a,{sx:o,children:"Segment"}),l.jsx(a,{sx:o,children:"User"}),l.jsx(a,{sx:o,children:"Status"}),h!=="service report"&&l.jsx(a,{sx:o,children:"Action"}),"          "]})}),l.jsx(xe,{children:V.slice(C*v,C*v+v).map((e,s)=>{var t,i,n;return l.jsxs(G,{children:[l.jsx(a,{children:C*v+s+1}),l.jsx(a,{children:e==null?void 0:e.vehicle}),l.jsx(a,{children:(t=e==null?void 0:e.vehicle_group)==null?void 0:t.group_name}),l.jsx(a,{children:e==null?void 0:e.model}),l.jsx(a,{children:e==null?void 0:e.sub_model}),l.jsx(a,{children:e==null?void 0:e.priority_class}),l.jsx(a,{children:e==null?void 0:e.completion_date}),l.jsx(a,{children:e==null?void 0:e.next_due_date}),l.jsx(a,{children:(i=e==null?void 0:e.segment)==null?void 0:i.segment_name}),l.jsx(a,{children:(n=e==null?void 0:e.user)==null?void 0:n.email}),l.jsx(a,{children:e==null?void 0:e.status}),h!=="service report"&&l.jsx(a,{children:l.jsx(z,{onClick:()=>U(e),color:"primary","aria-label":"edit record",children:l.jsx(k,{})})})]},e==null?void 0:e.id)})})]}),l.jsx(ce,{rowsPerPageOptions:[12],component:"div",count:V.length,rowsPerPage:v,page:C,onPageChange:Z,onRowsPerPageChange:$})]}),l.jsx(fe,{open:T,setOpen:B,data:L,isInspection:f})]})]})}export{ke as S};
