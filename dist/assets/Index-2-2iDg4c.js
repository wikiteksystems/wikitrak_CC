import{j as a,G as ee,y as te,z as y,b as i,I as se,bc as ne,b9 as le,aB as ce,C as M,ad as ie,a5 as re,P as de,aQ as ue,ae,a0 as he,a1 as pe,a4 as ge,a3 as fe,E as xe}from"./index-BmWIDii2.js";import{V as _e}from"./VehicleMenu-5fRHhbk0.js";import{t as be}from"./SearchTab-TjdYir7h.js";import"./Loader-BFcu80bO.js";import"./LiveMapServices-BO8VosQR.js";import"./Socket-CFpJY01f.js";import{P as ke}from"./Parameters-PGa_E4qR.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as je}from"./LeftSideBar2-BwIIZBXC.js";import{D as we,a as Ce,b as De,c as ve}from"./DialogTitle-DDEOHbuj.js";import{D as Se,E as me,T as ye}from"./Edit-8_5l5NTb.js";import{B as V}from"./CircularProgress-Dzyac9k7.js";import{D as Le}from"./Delete-it83uDOQ.js";import{T as Be,a as Pe,b as Ae,c as oe,d as k,e as Ve}from"./TableRow-D2gUmkT5.js";import{T as Ie}from"./TablePagination-e6JW7gPG.js";import{A as Ee}from"./AddBreakdown-_aT2fQEi.js";import"./index.esm-Bm7Ih4V6.js";import{V as Ge}from"./VehicleGroups-CqXGj6H-.js";import{S as Te}from"./ServicesTopBar-CAsn6dAZ.js";import"./menu2-VjQtaw_r.js";import"./useControlled-BdXpx6zC.js";import"./Autocomplete-COp0w6q7.js";import"./usePreviousProps-DXodIgEr.js";import"./TextField-C0mK_xHp.js";import"./index-C_OJDYlU.js";import"./createSvgIcon-Jgvla9HZ.js";import"./Card-DgfOcpHr.js";import"./CardContent-BWw8KEeS.js";import"./Close-CQQW2Oo-.js";import"./Add-CxHSCGUN.js";import"./formik.esm-DEURnl4a.js";import"./SearchInput-HevQ0k-K.js";import"./NewLoader-Boq_6vGC.js";const $e=({open:_,onClose:g,onConfirm:j})=>a.jsxs(we,{open:_,onClose:g,children:[a.jsx(Ce,{children:"Confirm Deletion"}),a.jsx(De,{children:a.jsxs(Se,{children:["Are you sure you want to delete this vehicle data?"," ",a.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),a.jsxs(ve,{children:[a.jsx(ee,{onClick:g,color:"primary",children:"Cancel"}),a.jsx(ee,{onClick:j,color:"secondary",children:"Delete"})]})]}),Ue="https://cc.wikitrak.in/api-proxy/api/v1",Me={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Oe=({breakdownData:_})=>{const g=te(),{isUpdateBreakdown:j}=y(p=>p.equipment),{w_customer_id:O}=y(p=>p.auth),[w,f]=i.useState(!1),L=()=>{console.log("breakdownData",_),localStorage.getItem("role"),g(ne(!j)),g(le(_))},m=()=>{console.log("dlt btn clicked");const p=localStorage.getItem("role");ce.includes(p)?f(!0):M.error(`Sorry! Your role is ${p}. You're not allowed to add, edit or delete the vehicle`)},C=async()=>{console.log("breakdownData data deleting");try{await ie.delete(`${Ue}/vehicles/breakdown/create/${_.id}/`),M.success("breakdownData data deleted successfully!"),g(re(O))}catch(p){console.error("Error deleting breakdown data:",p),M.error("Failed to delete breakdown data. Please try again.")}f(!1)},I=()=>{f(!1)},D={color:"#686868"};return a.jsxs(V,{sx:Me,children:[a.jsx(se,{onClick:L,children:a.jsx(me,{sx:D})}),a.jsx(se,{onClick:m,children:a.jsx(Le,{sx:D})}),a.jsx($e,{open:w,onClose:I,onConfirm:C})]})},Re=[{id:"BDID",label:"BDID"},{id:"Vehicle",label:"Vehicle No"},{id:"Topic",label:"Topic"},{id:"User",label:"User"},{id:"SubmissionDate",label:"Submission Date"},{id:"WorkshopGroup",label:"Workshop Group"},{id:"Status",label:"Status"},{id:"Actions",label:"Actions"}],He=()=>{const{breakdowns:_}=y(e=>e.breakdown),{searchTerm:g}=y(e=>e.inspection),[j,O]=i.useState("asc"),[w,f]=i.useState("BDID"),[L,m]=i.useState(0),[C,I]=i.useState(5),[D,p]=i.useState({id:"",status:"",workshop:"",user:""}),E=e=>{O(w===e&&j==="asc"?"desc":"asc"),f(e)},B=(e,t)=>{m(t)},R=e=>{I(parseInt(e.target.value,10)),m(0)},G=(e,t,c)=>e.filter(s=>{var b,x,A,h,S,F,W,q,z,Y,Q,Z,J,K,X;const r=new Date,n=new Date(s.submission_date);if(r.setHours(0,0,0,0),n.setHours(0,0,0,0),(c==null?void 0:c.toLowerCase())==="overdue"&&n<r&&s.status.toLowerCase()==="open")return!0;const d=(c==null?void 0:c.toLowerCase())||"",l=(b=s==null?void 0:s.breakdown_id)==null?void 0:b.toLowerCase().includes(d),u=`${(A=(x=s==null?void 0:s.user)==null?void 0:x.us_user)==null?void 0:A.first_name} ${(S=(h=s==null?void 0:s.user)==null?void 0:h.us_user)==null?void 0:S.last_name}`.toLowerCase().includes(d),v=(F=s==null?void 0:s.status)==null?void 0:F.toLowerCase().includes(d),$=(W=s==null?void 0:s.workshop_group)==null?void 0:W.group_name.toLowerCase().includes(d),U=(z=(q=s==null?void 0:s.breakdown_topic)==null?void 0:q.topic)==null?void 0:z.toLowerCase().includes(d),o=(Q=(Y=s==null?void 0:s.vehicle)==null?void 0:Y.registration_id)==null?void 0:Q.toLowerCase().includes(d);return!(c&&!(l||u||v||$||U||o)||t.id&&!s.breakdown_id.includes(t.id)||t.status&&s.status!==t.status||t.workshop&&s.workshop_group.group_name!==t.workshop||t.user&&!s.user.us_user.first_name.toLowerCase().includes(t.user.toLowerCase())&&!s.user.us_user.last_name.toLowerCase().includes(t.user.toLowerCase())||t.topic&&!((J=(Z=s.breakdown_topic)==null?void 0:Z.topic)!=null&&J.toLowerCase().includes(t.topic.toLowerCase()))||t.vehicle&&!((X=(K=s.vehicle)==null?void 0:K.registration_id)!=null&&X.toLowerCase().includes(t.vehicle.toLowerCase())))}),H=(e,t,c,s)=>{if(s==="User"){const r=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),n=`${t.user.us_user.first_name} ${t.user.us_user.last_name}`.toLowerCase();return c==="asc"?r.localeCompare(n):n.localeCompare(r)}if(s==="WorkshopGroup"){const r=e.workshop_group.group_name.toLowerCase(),n=t.workshop_group.group_name.toLowerCase();return c==="asc"?r.localeCompare(n):n.localeCompare(r)}if(s==="BDID"){const r=parseInt(e.breakdown_id.replace("BD-",""),10),n=parseInt(t.breakdown_id.replace("BD-",""),10);return c==="asc"?r-n:n-r}if(s==="SubmissionDate"){const r=new Date(e.submission_date),n=new Date(t.submission_date);return c==="asc"?r-n:n-r}if(s==="Status"){const r={Open:1,Close:2,Rejected:3},n=r[e.status]||0,d=r[t.status]||0;return c==="asc"?n-d:d-n}return 0},P=G(_.slice(),D,g).sort((e,t)=>H(e,t,j,w)),T=P.slice(L*C,L*C+C),N={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};return a.jsx(V,{sx:{m:"10px"},children:a.jsxs(de,{children:[a.jsx(Be,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:a.jsxs(Pe,{stickyHeader:!0,children:[a.jsx(Ae,{children:a.jsx(oe,{children:Re.map(e=>a.jsx(k,{sx:N,children:a.jsx(ye,{active:w===e.id,direction:w===e.id?j:"asc",onClick:()=>E(e.id),children:e.label})},e.id))})}),a.jsx(Ve,{children:T.map((e,t)=>{var c,s,r,n,d,l,u;return a.jsxs(oe,{children:[a.jsx(k,{children:e==null?void 0:e.breakdown_id}),a.jsx(k,{children:(c=e==null?void 0:e.vehicle)==null?void 0:c.registration_id}),a.jsx(k,{children:(s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic}),a.jsx(k,{children:`${(n=(r=e==null?void 0:e.user)==null?void 0:r.us_user)==null?void 0:n.first_name} ${(l=(d=e==null?void 0:e.user)==null?void 0:d.us_user)==null?void 0:l.last_name}`}),a.jsx(k,{children:e.submission_date||"N/A"}),a.jsx(k,{children:(u=e==null?void 0:e.workshop_group)==null?void 0:u.group_name}),a.jsx(k,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),a.jsx(k,{children:a.jsx(Oe,{breakdownData:e})})]},t)})})]})}),a.jsx(Ie,{component:"div",count:P.length,page:L,onPageChange:B,rowsPerPage:C,onRowsPerPageChange:R,rowsPerPageOptions:[5,10,15]})]})})},Ne=He;function vs(){const{locationData:_,selectedVehicle:g,selectedParameterList:j,onlineVehicle:O}=y(l=>l.liveMap),{mode:w,selectedVehicleGroup:f,vehicleZone:L}=y(l=>l.dashboard),m=be(w),[C,I]=i.useState([]),{w_customer_id:D}=y(l=>l.auth),[p,E]=i.useState(),[B,R]=i.useState(!1),[G,H]=i.useState(!1),[P,T]=i.useState([]);i.useState(!0);const[N,e]=i.useState(!1),[t,c]=i.useState(!1);let s=te();i.useEffect(()=>{r(),s(ue()),s(re(D))},[]),i.useEffect(()=>{console.log("selectedVehicleGroup",f)},[f]),i.useEffect(()=>{T([]),s(ae([{reg_id:"",imei:"",params:[]}]))},[g]);const r=async()=>{try{e(!0);let l=[],u=[];const v=await s(he({w_customer_id:D}));if(Array.isArray(v.payload)){v.payload.forEach(o=>{var b,x,A,h;Array.isArray(o.imei)&&o.imei.length>0&&((b=o.imei[0])!=null&&b.mac_id)?(l.push({id:o.id,label:o.registration_id,value:(x=o.imei[0])==null?void 0:x.mac_id,vehilce_type:o==null?void 0:o.segment,chassis_no:o==null?void 0:o.chassis_no,engine_no:o==null?void 0:o.engine_no,workShop:o==null?void 0:o.workshop,registration_id:o==null?void 0:o.registration_id,sell_date:o==null?void 0:o.sell_date,customer_name:o==null?void 0:o.customer_name,vehicle_model:(A=o==null?void 0:o.vehicle_model)==null?void 0:A.name,user:o==null?void 0:o.user,vehicle_group:o==null?void 0:o.vehicle_group}),u.push((h=o.imei[0])==null?void 0:h.mac_id)):console.error("IMEI data not found for item:",o)});const $="one",U=u;u.length>0&&s(pe({type:$,imei:U})),I(l),s(ge({w_customer_id:D})),s(fe(l)),e(!1)}else e(!1),console.error("Unexpected data format:",v),M.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),M.error(`Error fetching vehicle data: ${l}`)}},n=async l=>{const{label:u,imei:v,id:$,reg_id:U,checked:o}=l;E(h=>h.map(S=>S.id===$?{...S,checked:!o}:S));let b=[...P],x=[...P];if(!o)_.forEach(h=>{h.latestDocument.imei===v&&(b.push({label:u,value:h.latestDocument[u==="maininputvoltage"?"mainInputVoltage":u]}),x=b,T(b))});else{let h=P.filter(S=>S.label!==u);x=h,T(h)}console.log("tempParamList",x),s(ae([{reg_id:U,imei:v,params:x}]))},d=C.filter(l=>Object.keys(f).length===0||l.vehicle_group===f.id);return a.jsxs("div",{className:"app",children:[a.jsx(je,{}),a.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[a.jsx(Te,{title:"Breakdown",setShowVehicles:R,showVehicles:B,setShowVehiclesGroup:c,showVehiclesGroup:t}),a.jsx(Ge,{setShowVehiclesGroup:c,showVehiclesGroup:t}),a.jsxs(V,{style:{display:"flex",width:"100%",height:"95vh"},children:[a.jsxs(V,{style:{width:B||G?"80%":"100%",background:xe.bgShadow},children:[a.jsx(Ee,{where:"Breakdown"}),a.jsx(Ne,{})]}),B&&a.jsx(V,{style:{width:"20%",backgroundColor:m.grey[100]},children:a.jsx(_e,{vehicleData:d,title:"Inspections",setParameterData:E,loadingVehicle:N,setShowVehicles:R,showVehicles:B,showParameters:G,setShowParameters:H})}),G&&a.jsx(V,{style:{width:"20%",backgroundColor:m.grey[100]},children:a.jsx(ke,{parametersData:p,setParameterData:E,handleParameterChange:n})})]})]})]})}export{vs as default};
