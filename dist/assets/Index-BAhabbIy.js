import{g as we,d as De,s as ve,a as ne,e as o,f as Ce,_ as Me,j as t,h as Ae,i as be,ae as xe,af as fe,v as Se,w as I,ar as Te,as as _e,at as P,V as k,B as d,au as ke,ah as Ie,T as S,J as B,av as Ye,z as je,aw as oe,ax as Le,ay as Ne,az as he,aA as pe,C as Z,aB as ue,D as ge,aC as Oe,U as Ve,a4 as Ee,a5 as Re,a8 as Be,Z as Pe,a0 as $e}from"./index-6PM0p98e.js";import{L as Fe}from"./LiveMapTopBar-CkAk3XY_.js";import{V as Ue}from"./VehicleMenu-ChlwQ8Fy.js";import{T as qe}from"./TripMap-Cgc8NYFR.js";import{C as ze}from"./Card-JDQl3YTh.js";import{C as Ge}from"./CardContent-CIphYqA0.js";/* empty css           */import"./Autocomplete-AIdIqPAx.js";import"./TextField-CS2JOTI8.js";import"./esm-BzYbrRup.js";import"./redTractor-NXgVJyvR.js";import"./Info-C4ptFMdx.js";function He(r){return we("MuiCardActions",r)}De("MuiCardActions",["root","spacing"]);const We=["disableSpacing","className"],Je=r=>{const{classes:D,disableSpacing:j}=r;return be({root:["root",!j&&"spacing"]},He,D)},Xe=ve("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(r,D)=>{const{ownerState:j}=r;return[D.root,!j.disableSpacing&&D.spacing]}})(({ownerState:r})=>ne({display:"flex",alignItems:"center",padding:8},!r.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Ze=o.forwardRef(function(D,j){const v=Ce({props:D,name:"MuiCardActions"}),{disableSpacing:u=!1,className:y}=v,Y=Me(v,We),p=ne({},v,{disableSpacing:u}),g=Je(p);return t.jsx(Xe,ne({className:Ae(g.root,y),ownerState:p,ref:j},Y))}),Ke=Ze;var ie={},Qe=fe;Object.defineProperty(ie,"__esModule",{value:!0});var ye=ie.default=void 0,et=Qe(xe()),tt=t;ye=ie.default=(0,et.default)((0,tt.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");var ce={},st=fe;Object.defineProperty(ce,"__esModule",{value:!0});var me=ce.default=void 0,at=st(xe()),rt=t;me=ce.default=(0,at.default)((0,rt.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");const ot=()=>{var n,f,M,A;const r=Se(),{tripList:D,selectedTripData:j,loading:v,trips:u,activeIndex:y,searchText:Y,mode:p,isNavigate:g,allTripList:l,trip_payload:L,page:m,total_page:N,total_trips:K}=I(e=>e.dashboard),{selectedVehicle:O}=I(e=>e.liveMap),w=je(p),[$,F]=o.useState(!1),[i,U]=o.useState({}),[C,q]=o.useState(""),[_,z]=o.useState(null);o.useEffect(()=>{(u==null?void 0:u.length)>0},[u]),o.useEffect(()=>{const e=le(l);r(Te(e))},[l]),o.useEffect(()=>{!(j.length>0)&&g&&y!==null&&x.length>0&&Q(x[y])},[j,g]);const Q=async e=>{var h;let a={imei:O.imei,startDate:e.startDate,endDate:e.endDate};const c=await _e(a);((h=c==null?void 0:c.data)==null?void 0:h.documents.length)>0?(r(g(!1)),r(P(c.data.documents[0].data))):(r(g(!1)),r(P([])))},le=e=>{const a=new Set,c=[];return e.forEach(h=>{const T=k(h.startTime).format("YYYY-MM-DD");a.has(T)||(a.add(T),c.push(T))}),c},G=(e,a)=>{r(oe(null)),r(Le(e)),r(Ne(!1)),C===e?(q(""),z(null)):(q(e),z(a))},x=C===""?l:l.filter(e=>k(e.startTime).format("YYYY-MM-DD")===C),H=async(e,a)=>{r(P(a.data)),r(oe(e)),r(he(a.tripAcreage))},b=e=>{U(e),F(!0)},W=()=>{F(!1),U({})},J=e=>e?e.split(" ").slice(0,2).join(" "):"",ee=async()=>{const e={...L,page:m+1,limit:20};try{(await r(pe(e))).error?Z.error("No Trip! within selected date"):r(ue(m+1))}catch{Z.error("No Trip! within selected date")}},te=()=>{if(m<=1)return;const e={...L,page:m-1,limit:20};r(ue(m-1)),r(pe(e))},s=e=>{let a=e==null?void 0:e.reduce((c,h)=>c+h.tripAcreage,0);console.log("merged array",a),r(P([])),r(oe("all")),r(he(a))};return t.jsxs(t.Fragment,{children:[t.jsxs(d,{children:[t.jsxs(d,{sx:{m:"10px"},children:[t.jsx(d,{sx:{color:w.grey[400]},children:"Select Date"}),t.jsx(d,{sx:{mt:1},children:t.jsx(ke,{})})]}),v?t.jsx("div",{style:{width:"100%",margin:"38%"},children:t.jsx(Ie,{})}):t.jsxs(t.Fragment,{children:[t.jsx(d,{children:t.jsx(d,{sx:{display:"flex",overflowX:"auto",gap:"10px",paddingBottom:"5px"},children:l&&(l==null?void 0:l.length)>0?t.jsx(t.Fragment,{}):t.jsx(S,{sx:{width:"100%",mt:"50%",textAlign:"center"},children:"Sorry! No Trips Found"})})}),l&&(l==null?void 0:l.length)>0&&t.jsxs(d,{ml:2,display:"flex",gap:1,children:[t.jsxs(S,{children:["Total trips:",K]})," |",t.jsxs(S,{children:["Current page:",m]})," |",t.jsxs(S,{children:["Total page:",N]}),"|"]}),l&&(l==null?void 0:l.length)>0&&t.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",mt:"5px"},children:[t.jsx(B,{disabled:m<=1,onClick:te,children:t.jsx(ye,{})}),t.jsx(B,{disabled:N===m||N===0,onClick:ee,children:t.jsx(me,{})})]}),t.jsxs(d,{sx:{height:"75vh",width:"100%",overflowY:"auto"},children:[t.jsx(d,{display:"flex",gap:1,marginLeft:2,children:u.map((e,a)=>t.jsx(d,{children:t.jsx(B,{onClick:()=>{G(e,a)},style:{backgroundColor:_===a?w.grey[300]:w.grey[200],color:_===a?"black":w.grey[300],height:"35px",fontWeight:700,fontSize:"12px",width:"90px",marginTop:"20px"},children:e})},a))}),x&&x.length>0&&t.jsx(B,{variant:y==="all"?"contained":"outlined",sx:{width:"90%",mx:"20px",mt:"10px"},onClick:()=>{s(x)},children:"Select All trips"}),"              ",x&&x.length>0&&x.map((e,a)=>{var ae,V,E,R;const c=(V=(ae=e==null?void 0:e.startLocation)==null?void 0:ae.address)==null?void 0:V.address,h=(R=(E=e==null?void 0:e.endLocation)==null?void 0:E.address)==null?void 0:R.address,T=c?`${c.town||c.city||""}`:"",se=h?`${h.town||h.city||""}`:"";return t.jsxs(d,{sx:{m:"15px",border:"1px solid #e8edea",borderRadius:"5px",padding:"10px",justifyContent:"space-between",alignItems:"center",color:y===a?"black":w.grey[400],backgroundColor:y===a?"#e8edea":"undefined",fontSize:"10px",cursor:"pointer","&:hover":{background:p?w.grey[300]:w.grey[200]}},onClick:()=>H(a,e),children:[t.jsxs(S,{sx:{cursor:"text"},children:[a+1,". ",J(T)," to"," ",J(se)," "]}),t.jsxs(S,{children:[e!=null&&e.startTime?k(new Date(e.startTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):""," ","/"," ",e!=null&&e.endTime?k(new Date(e.endTime).toISOString()).format("YYYY-MM-DD, HH:mm a"):"----",t.jsx("span",{style:{color:p?"orange":"blue",cursor:"pointer"},onClick:X=>{X.stopPropagation(),b(e)},children:"...see more"})]})]},a)})]})]})]}),t.jsx(Ye,{open:$,onClose:W,children:t.jsxs(ze,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40%",bgcolor:"background.paper",boxShadow:24,p:4},children:[t.jsxs(Ge,{children:[t.jsx(S,{variant:"h6",component:"div",children:"Trip Details"}),t.jsxs(S,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Location:"})," ",((f=(n=i==null?void 0:i.startLocation)==null?void 0:n.address)==null?void 0:f.display_name)||"N/A"]}),t.jsxs(S,{sx:{mt:2},children:[t.jsx("strong",{children:"End Location:"})," ",((A=(M=i==null?void 0:i.endLocation)==null?void 0:M.address)==null?void 0:A.display_name)||"N/A"]}),t.jsxs(S,{sx:{mt:2},children:[t.jsx("strong",{children:"Start Time:"})," ",i!=null&&i.startTime?k(new Date(i.startTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]}),t.jsxs(S,{sx:{mt:2},children:[t.jsx("strong",{children:"End Time:"})," ",i!=null&&i.endTime?k(new Date(i.endTime).toISOString()).format("MMMM Do YYYY, h:mm:ss A"):"N/A"]})]}),t.jsx(Ke,{children:t.jsx(B,{onClick:W,children:"Close"})})]})})]})},nt=ot;function yt(){const{w_customer_id:r}=I(s=>s.auth),{collapsed:D}=I(s=>s.auth),{mode:j,selectedVehicleGroup:v}=I(s=>s.dashboard),{vehicleList:u,selectedVehicle:y,onlineVehicle:Y,locationData:p}=I(s=>s.liveMap),[g,l]=o.useState(!1),[L,m]=o.useState(!0),[N,K]=o.useState([]),[O,w]=o.useState(!0),[$,F]=o.useState(""),[i,U]=o.useState(""),[C,q]=o.useState(""),[_,z]=o.useState("");o.useState([]);const[Q,le]=o.useState({lat:18.516726,lng:73.856255});o.useState([]);const[G,x]=o.useState(!1),H=je(j);let b=Se();o.useEffect(()=>{b(P([])),W()},[]),o.useEffect(()=>{var f,M,A;const s=ge().subtract(5,"day").startOf("day").toISOString(),n=ge().endOf("day").toISOString();b(Oe({startDate:s,endDate:n})),Object.keys(y).length===0&&u.length>0&&b(Ve({imei:(M=(f=u[0])==null?void 0:f.imei[0])==null?void 0:M.mac_id,reg_id:(A=u[0])==null?void 0:A.registration_id}))},[y,u]);const W=async()=>{try{let s=[],n=[];const f=await b(Ee({w_customer_id:r}));if(Array.isArray(f.payload)){f.payload.forEach(e=>{var a,c,h;Array.isArray(e.imei)&&e.imei.length>0&&((a=e.imei[0])!=null&&a.mac_id)?(s.push({id:e.id,label:e.registration_id,value:(c=e.imei[0])==null?void 0:c.mac_id,workShop:e==null?void 0:e.workshop,vehicle_group:e==null?void 0:e.vehicle_group}),n.push((h=e.imei[0])==null?void 0:h.mac_id)):console.error("IMEI data not found for item:",e)});const M="one",A=n;n.length>0&&b(Re({type:M,imei:A})),b(Be({w_customer_id:r})),K(s)}else console.error("Unexpected data format:",f),Z.error("Unexpected data format:")}catch(s){console.error("Error fetching vehicle data:",s),Z.error(`Error fetching vehicle data: ${s}`)}},J=s=>p==null?void 0:p.some(n=>String(n.latestDocument.imei)===String(s)&&n.latestDocument.speed>0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),ee=s=>p==null?void 0:p.some(n=>String(n.latestDocument.imei)===String(s)&&n.latestDocument.speed<=0&&(n.latestDocument.ignition===!0||n.latestDocument.ignition===1)),te=N.filter(s=>{var V,E,R,X,de;if(!(Object.keys(v).length===0||s.vehicle_group===v.id))return!1;const f=(V=s==null?void 0:s.label)==null?void 0:V.toLowerCase().includes($.toLowerCase()),M=_===""||((E=s==null?void 0:s.workShop)==null?void 0:E.region)===_,A=C===""||((X=(R=s==null?void 0:s.workShop)==null?void 0:R.state)==null?void 0:X.toLowerCase())===(((de=C==null?void 0:C.toString())==null?void 0:de.toLowerCase())||""),e=s.value,a=String(s.value).toLowerCase(),c=Y.some(re=>String(re).toLowerCase()===a),h=!Y.some(re=>String(re).toLowerCase()===a),T=c&&J(e),se=c&&ee(e);return f&&M&&A&&(i==="online"?c:i==="offline"?h:i==="running"?T:i==="idling"?se:!0)}).sort((s,n)=>s.label.localeCompare(n.label));return t.jsxs("div",{className:"app",children:[t.jsx(Pe,{}),t.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[t.jsx(Fe,{title:"Trip Monitor",setShowVehicles:l,showVehicles:g,setShowCard:m,showCard:L,sideBarTrip:O,setSideBarTrip:w,setShowVehiclesGroup:x,showVehiclesGroup:G}),t.jsx($e,{setShowVehiclesGroup:x,showVehiclesGroup:G,where:"tripmonitor"}),t.jsxs(d,{style:{display:"flex",width:"100%",height:"95vh"},children:[t.jsx(d,{style:{width:g||O?"80%":"100%"},children:t.jsx(qe,{center:Q,showCard:L})}),g&&t.jsx(d,{style:{width:"20%",backgroundColor:H.grey[100]},children:t.jsx(Ue,{vehicleData:te,setShowVehicles:l,showVehicles:g,title:"Live Monitor",setSearchedTerm:F,setOptions:U,setState:q,setRegion:z,searchTerm:$,options:i,state:C,region:_,setSideBarTrip:w})}),t.jsx(d,{style:{width:D?"22%":"20%",display:O?"block":"none",backgroundColor:H.grey[100]},children:t.jsx(nt,{})})]})]})]})}export{yt as default};
