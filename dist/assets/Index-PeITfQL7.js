import{l as Ie,o as Me,p as Ye,b,q as ke,f as He,_ as Ne,j as e,eB as $e,g as We,k as Pe,a$ as $,a_ as w,bb as xe,dT as le,cf as se,dU as ne,dV as ie,dW as J,dX as t,dY as re,eh as Le,bm as G,aW as M,bl as Re,ca as Ee,b8 as ae,eC as ge,eD as ue,eE as k,bc as pe,bY as fe,eF as je,eG as me,bv as Be,b7 as te,eH as Ge,eI as Ke,eJ as Fe,c4 as Ue,eK as Ve,eL as ze,eM as qe,eN as ce,eO as de,eP as he,eQ as Je,bw as Qe,bx as Xe,by as Ze,bA as we,bC as et,bq as tt,br as at,bs as lt,eR as st,b5 as nt}from"./index-DozFmvVg.js";import{D as ve,R as it,a as rt}from"./BatchRecipt2-Di1v2vdS.js";import"./index.esm-BASSbZdp.js";function ct(C){return Ie("MuiTableFooter",C)}Me("MuiTableFooter",["root"]);const dt=["className","component"],ht=C=>{const{classes:R}=C;return Pe({root:["root"]},ct,R)},ot=Ye("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(C,R)=>R.root})({display:"table-footer-group"}),xt={variant:"footer"},Oe="tfoot",gt=b.forwardRef(function(R,S){const E=ke({props:R,name:"MuiTableFooter"}),{className:g,component:T=Oe}=E,A=He(E,dt),l=Ne({},E,{component:T}),a=ht(l);return e.jsx($e.Provider,{value:xt,children:e.jsx(ot,Ne({as:T,className:We(a.root,g),ref:S,role:T===Oe?null:"rowgroup",ownerState:l},A))})}),ut=gt;function pt({tableData:C}){const{vehicleList:R}=$(a=>a.liveMap),S=w(),E=xe();console.log("tableData: ",C);let g=a=>R.find(s=>{var r;return((r=s==null?void 0:s.imei[0])==null?void 0:r.mac_id)==a||""});const T=a=>{var s;S(Re({imei:a==null?void 0:a.imei,reg_id:(s=g(a.imei))==null?void 0:s.registration_id})),S(Ee({startDate:ae(a.date).startOf("day").toISOString(),endDate:ae(a.date).endOf("day").toISOString()})),E("/trip-monitor?source=TripDetail")},A=a=>{var s;S(Re({imei:a==null?void 0:a.imei,reg_id:(s=g(a.imei))==null?void 0:s.registration_id})),S(Ee({startDate:ae(a.date).startOf("day").toISOString(),endDate:ae(a.date).endOf("day").toISOString()})),E("/trip-report")},l=a=>{const s=Math.floor(a),n=(a-s)*60,u=Math.floor(n),m=Math.round((n-u)*60);return`${s} hrs ${u} min ${m} sec`};return e.jsx(le,{component:se,sx:{maxHeight:"70vh"},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(t,{align:"left",children:"Date"}),e.jsx(t,{align:"left",children:"Vehicle Name"}),e.jsx(t,{align:"left",children:"Start location"}),e.jsx(t,{align:"left",children:"End location"}),e.jsx(t,{align:"left",children:"Segment"}),e.jsx(t,{align:"left",children:"Operator"}),e.jsx(t,{align:"left",children:"Work done (acre)"}),e.jsx(t,{align:"left",children:"Engine hours"}),e.jsx(t,{align:"left",children:"Total Trips Hours"}),e.jsx(t,{align:"left",children:"Running Time"}),e.jsx(t,{align:"left",children:"Idle time"}),e.jsx(t,{align:"left",children:"Total Distance (km)"}),e.jsx(t,{align:"left",children:"Average Speed"}),e.jsx(t,{align:"left",children:"Per Day Engine Hours"}),e.jsx(t,{align:"left",children:"Total Engine Hours"}),e.jsx(t,{align:"left",children:"Last Reset Engine Hours"}),e.jsx(t,{align:"left",children:"Last Reset Timestamp"}),e.jsx(t,{align:"left",children:"Duration Since Last Reset"}),e.jsx(t,{align:"left",children:"Reset Perform By"}),e.jsx(t,{align:"left",children:"View Trips"}),e.jsx(t,{align:"left",children:"View Trip Report"})]})}),e.jsx(re,{children:C.map((a,s)=>{var r,n,u,m,j,N,V,Y,z,D;return e.jsxs(J,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{align:"left",children:a.date}),e.jsx(t,{align:"left",children:(r=g(a.imei))==null?void 0:r.registration_id}),e.jsx(t,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Le,{title:((n=a==null?void 0:a.startLocationName)==null?void 0:n.display_name)||(a==null?void 0:a.startLocationName)||"",children:e.jsx("span",{children:((u=a==null?void 0:a.startLocationName)==null?void 0:u.display_name)||(a==null?void 0:a.startLocationName)||""})})}),e.jsx(t,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Le,{title:((m=a==null?void 0:a.endLocationName)==null?void 0:m.display_name)||(a==null?void 0:a.endLocationName)||"",children:e.jsx("span",{children:((j=a==null?void 0:a.endLocationName)==null?void 0:j.display_name)||(a==null?void 0:a.endLocationName)||""})})}),e.jsx(t,{align:"left",children:(N=g(a.imei))==null?void 0:N.segment}),e.jsx(t,{align:"left",children:(V=g(a.imei))==null?void 0:V.customer_name}),e.jsx(t,{align:"left",children:a.acreageStr}),e.jsx(t,{align:"left",children:a.engineHours}),e.jsx(t,{align:"left",children:(a==null?void 0:a.tripHours)||"--"}),e.jsx(t,{align:"left",children:a.runningTime}),e.jsx(t,{align:"left",children:a.idleTime}),e.jsx(t,{align:"left",children:a.totalDistance}),e.jsx(t,{align:"left",children:a.averageSpeed}),e.jsx(t,{align:"left",children:l((a==null?void 0:a.daily_engine_hours)||0)}),e.jsx(t,{align:"left",children:l((a==null?void 0:a.daily_total_engine_hours)||0)}),e.jsx(t,{align:"left",children:Number(((Y=g(a.imei))==null?void 0:Y.old_total_engine_hours)??0).toFixed(2)}),e.jsx(t,{align:"left",children:(()=>{const _=g(a.imei);return _!=null&&_.updated_engine_hours_date?G(_.updated_engine_hours_date).format("DD-MM-YYYY"):"--"})()}),e.jsx(t,{align:"left",children:(()=>{const _=g(a.imei),I=_==null?void 0:_.updated_engine_hours_date;if(!I)return"--";const P=G(),v=G.utc(I).local(),x=G.duration(P.diff(v)),F=Math.floor(x.asDays()),K=x.hours(),B=x.minutes();return`${F}d ${K}h ${B}m`})()}),e.jsx(t,{align:"left",children:((D=(z=g(a.imei))==null?void 0:z.reset_by_user)==null?void 0:D.email)||"--"}),e.jsx(t,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>T(a),children:"View on Map ðŸ”"})}),e.jsx(t,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer"},onClick:()=>A(a),children:"View Trip Report"})})]},s+1)})})]})})}function ft({handleBack:C,setStartDate:R,startDate:S,setEndDate:E,endDate:g}){const T=w(),{vehicleGroup:A,vehicleList:l}=$(v=>v.liveMap),{vehicleStatesData:a,loading:s,selectedGroup:r,selectedVehicle:n,distributorList:u}=$(v=>v.report),[m,j]=b.useState([]);b.useState([]);const[N,V]=b.useState([]);b.useEffect(()=>{},[s]),b.useEffect(()=>{if(A&&A.length>0){let v=A.map(x=>({...x,label:x.group_name,value:x.id}));j(v)}},[A,l,u]),b.useEffect(()=>{},[S,g]);let Y=v=>l.find(x=>{var F;return((F=x==null?void 0:x.imei[0])==null?void 0:F.mac_id)==v||""});b.useEffect(()=>{let v=(a==null?void 0:a.data)&&a.data.map(x=>{var W,c;let{customer_name:F,registration_id:K,segment:B,total_engine_hours:Q,old_total_engine_hours:p,updated_engine_hours_date:d,reset_by_user:y}=Y(x==null?void 0:x.imei);return{Date:x.date,vehicle:K,"Start Location":(W=x==null?void 0:x.startLocationName)==null?void 0:W.display_name,"End Location":(c=x==null?void 0:x.endLocationName)==null?void 0:c.display_name,operator:F,segment:B,"Work Done":x==null?void 0:x.acreageStr,"Running Time":x.runningTime,"Idle Time":x.idleTime,"Engine hours":x.engineHours,"Total Distance (km)":x.totalDistance,"Average Speed":x.averageSpeed,"Total Engine Hours":Q,"Last Reset Engine Hours":p,"Last Reset Timestamp":d,"Reset Perform By":(y==null?void 0:y.email)||"--"}});V(v)},[a]),b.useEffect(()=>{n||T(ge())},[]);function z(v){console.log("value changed",v),T(je(v))}function D(v){T(me(v))}const _=async()=>{const v=`${S} 00:00`,x=`${g} 23:59`;if(!I())return;T(Be({imei:n,startTime:v,endTime:x}))},I=()=>!S||!g||n==="all"?(te.error("Please select start date, end date, and vehicle."),!1):!0,P=r==="All"?l:l.filter(v=>v.vehicle_group===r);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(ue,{handleBack:C,downloadData:N})}),e.jsxs(M,{children:[e.jsxs(k,{size:"large",value:r,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:z,filterOption:(v,x)=>{var F;return typeof((F=x==null?void 0:x.props)==null?void 0:F.children)=="string"&&x.props.children.toLowerCase().indexOf(v.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"All",children:"All"}),m.map((v,x)=>e.jsx(k.Option,{value:v.value,children:v.label},x))]}),e.jsxs(k,{size:"large",value:n,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:D,filterOption:(v,x)=>{var F;return typeof((F=x==null?void 0:x.props)==null?void 0:F.children)=="string"&&x.props.children.toLowerCase().indexOf(v.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"all",children:"None"},"all"),P&&P.length>0&&P.map((v,x)=>{var F;return e.jsx(k.Option,{value:(F=v.imei[0])==null?void 0:F.mac_id,children:v.registration_id},x)})]}),e.jsx(ve,{setStartDate:R,setEndDate:E,selectedDate:!1,startDate:S,endDate:g}),e.jsx(pe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:_,disabled:!n,children:"Generate report"})]}),s&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(fe,{})}),(a==null?void 0:a.data)&&(a==null?void 0:a.data.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(pt,{tableData:(a==null?void 0:a.data)||[]})})]})}function jt({tableData:C}){const{vehicleList:R}=$(s=>s.liveMap);w(),xe();const[S,E]=b.useState(null),[g,T]=b.useState(!1);let A=s=>R.find(r=>{var n;return((n=r==null?void 0:r.imei[0])==null?void 0:n.mac_id)==s||""});const l=(s,r)=>r.find(u=>{var m;return((m=u==null?void 0:u.name)==null?void 0:m.toLowerCase().trim())===s})||null,a={fontSize:"12px",fontWeight:"bold"};return e.jsxs(e.Fragment,{children:[e.jsx(le,{component:se,sx:{maxHeight:"70vh"},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(t,{align:"left",sx:a,children:"Date"}),e.jsx(t,{align:"left",sx:a,children:"Vehicle Name"}),e.jsx(t,{align:"left",sx:a,children:"Batch No"}),e.jsx(t,{align:"left",sx:a,children:"Start Time"}),e.jsx(t,{align:"left",sx:a,children:"End Time"}),e.jsx(t,{align:"left",sx:a,children:"Total Target Weight"}),e.jsx(t,{align:"left",sx:a,children:"Total Achieved Weight"}),e.jsx(t,{align:"left",sx:a,children:"Recipe 1"}),e.jsx(t,{align:"left",sx:a,children:"Cement"}),e.jsx(t,{align:"left",sx:a,children:"10mm"}),e.jsx(t,{align:"left",sx:a,children:"20mm"}),e.jsx(t,{align:"left",sx:a,children:"Sand"}),e.jsx(t,{align:"left",sx:a,children:"Crush Sand"}),e.jsx(t,{align:"left",sx:a,children:"River Sand"}),e.jsx(t,{align:"left",sx:a,children:"Fly Ash"}),e.jsx(t,{align:"left",sx:a,children:"30mm"}),e.jsx(t,{align:"left",sx:a,children:"Water"}),e.jsx(t,{align:"left",sx:a,children:"Admix"}),e.jsx(t,{align:"left",sx:a,children:"Receipt"})]})}),e.jsx(re,{children:C.map((s,r)=>{var n,u,m,j,N,V,Y,z,D,_,I,P,v,x,F,K,B,Q,p,d,y,W,c,h,f,o,H,i,O,L,ee,X,U,q,Z,be,ye,Se,Te,Ae,_e,Ce,De;return e.jsxs(J,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(s==null?void 0:s.date)&&G(s==null?void 0:s.date,"DDMMYYYY").format("DD-MM-YYYY")||"-"}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(n=A(s.imei))==null?void 0:n.registration_id}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:s.batch_no}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:s.start_time}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:s==null?void 0:s.end_time}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(u=s==null?void 0:s.total_target)==null?void 0:u.replace(/^0+/,"")}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(m=s==null?void 0:s.totalAcheived)==null?void 0:m.replace(/^0+/,"")}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:s==null?void 0:s.mix_name}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(N=(j=l("cement",s.materials||[]))==null?void 0:j.target)==null?void 0:N.replace(/^0+/,""),":",(Y=(V=l("cement",s.materials||[]))==null?void 0:V.actual)==null?void 0:Y.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(D=(z=l("10 mm",s.materials||[]))==null?void 0:z.target)==null?void 0:D.replace(/^0+/,""),":",(I=(_=l("10 mm",s.materials||[]))==null?void 0:_.actual)==null?void 0:I.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(v=(P=l("20 mm",s.materials||[]))==null?void 0:P.target)==null?void 0:v.replace(/^0+/,""),":",(F=(x=l("20 mm",s.materials||[]))==null?void 0:x.actual)==null?void 0:F.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(B=(K=l("sand",s.materials||[]))==null?void 0:K.target)==null?void 0:B.replace(/^0+/,""),":",(p=(Q=l("sand",s.materials||[]))==null?void 0:Q.actual)==null?void 0:p.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(y=(d=l("crush sand",s.materials||[]))==null?void 0:d.target)==null?void 0:y.replace(/^0+/,""),":",(c=(W=l("crush sand",s.materials||[]))==null?void 0:W.actual)==null?void 0:c.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(f=(h=l("river sand",s.materials||[]))==null?void 0:h.target)==null?void 0:f.replace(/^0+/,""),":",(H=(o=l("river sand",s.materials||[]))==null?void 0:o.actual)==null?void 0:H.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(O=(i=l("fly ash",s.materials||[]))==null?void 0:i.target)==null?void 0:O.replace(/^0+/,""),":",(ee=(L=l("fly ash",s.materials||[]))==null?void 0:L.actual)==null?void 0:ee.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(U=(X=l("30 mm",s.materials||[]))==null?void 0:X.target)==null?void 0:U.replace(/^0+/,""),":",(Z=(q=l("30 mm",s.materials||[]))==null?void 0:q.actual)==null?void 0:Z.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(ye=(be=l("water",s.materials||[]))==null?void 0:be.target)==null?void 0:ye.replace(/^0+/,""),":",(Te=(Se=l("water",s.materials||[]))==null?void 0:Se.actual)==null?void 0:Te.replace(/^0+/,"")]}),e.jsxs(t,{align:"left",sx:{fontSize:"10px"},children:[(_e=(Ae=l("admix",s.materials||[]))==null?void 0:Ae.target)==null?void 0:_e.replace(/^0+/,""),":",(De=(Ce=l("admix",s.materials||[]))==null?void 0:Ce.actual)==null?void 0:De.replace(/^0+/,"")]}),e.jsx(t,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",s),E(s),T(!0)},children:"View Receipt"})]},r+1)})}),e.jsx(ut,{children:e.jsxs(J,{children:[e.jsx(t,{children:e.jsx("b",{children:"Total"})}),e.jsx(t,{colSpan:3}),e.jsx(t,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"}}),e.jsx(t,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:C.reduce((r,n)=>{const u=(n==null?void 0:n.total_target)||"0",m=String(u).replace(/^0+/,""),j=parseFloat(m)||0;return r+j},0).toFixed(2)}),e.jsx(t,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:C.reduce((s,r)=>s+(r!=null&&r.totalAcheived&&parseFloat(r.totalAcheived.replace(/^0+/,""))||0),0)}),e.jsx(t,{}),["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"].map(s=>{const r=C.reduce((u,m)=>{var N;const j=(N=l(s,m.materials||[]))==null?void 0:N.target;return u+(j&&parseFloat(j.replace(/^0+/,""))||0)},0),n=C.reduce((u,m)=>{var N;const j=(N=l(s,m.materials||[]))==null?void 0:N.actual;return u+(j&&parseFloat(j.replace(/^0+/,""))||0)},0);return e.jsxs(t,{align:"left",sx:{fontSize:"10px",fontWeight:"bold"},children:[r,":",n]},s)}),e.jsx(t,{})]})})]})}),e.jsx(it,{receiptData:S,open:g,setOpen:T})]})}function mt({tableData:C}){const{vehicleList:R}=$(n=>n.liveMap);w(),xe();const[S,E]=b.useState(null),[g,T]=b.useState(!1);let A=n=>R.find(u=>{var m;return((m=u==null?void 0:u.imei[0])==null?void 0:m.mac_id)==n})||{};const l=(n,u)=>u.find(m=>{var j;return((j=m==null?void 0:m.product)==null?void 0:j.toLowerCase())===n.toLowerCase()})||{},a={fontSize:"12px",fontWeight:"bold"},s={fontSize:"10px"};let r={totalTarget:0,totalAchieved:0,cement:{target:0,achieved:0},mm10:{target:0,achieved:0},mm20:{target:0,achieved:0},sand:{target:0,achieved:0},water:0,cubic:0,mm30:{target:0,achieved:0},crushSand:{target:0,achieved:0},riverSand:{target:0,achieved:0},flyAsh:{target:0,achieved:0},admix:{target:0,achieved:0}};return C.forEach(n=>{r.totalTarget+=Number((n==null?void 0:n.generalKeyInfo["Total Target"])||0),r.totalAchieved+=Number((n==null?void 0:n.generalKeyInfo["Total Achieved"])||0),r.water+=Number((n==null?void 0:n.generalKeyInfo.Water)||0),r.cubic+=Number((n==null?void 0:n.generalKeyInfo["Cubic Meter"])||0),r.cement.target+=Number(l("cement",n.productArr).target||0),r.cement.achieved+=Number(l("cement",n.productArr).achieved||0),r.mm10.target+=Number(l("10 mm agg",n.productArr).target||0),r.mm10.achieved+=Number(l("10 mm agg",n.productArr).achieved||0),r.mm20.target+=Number(l("20 mm agg",n.productArr).target||0),r.mm20.achieved+=Number(l("20 mm agg",n.productArr).achieved||0),r.sand.target+=Number(l("sand",n.productArr).target||0),r.sand.achieved+=Number(l("sand",n.productArr).achieved||0),r.mm30.target+=Number(l("30mm",n.productArr).target||0),r.mm30.achieved+=Number(l("30mm",n.productArr).achieved||0),r.crushSand.target+=Number(l("crush sand",n.productArr).target||0),r.crushSand.achieved+=Number(l("crush sand",n.productArr).achieved||0),r.riverSand.target+=Number(l("river sand",n.productArr).target||0),r.riverSand.achieved+=Number(l("river sand",n.productArr).achieved||0),r.flyAsh.target+=Number(l("fly ash",n.productArr).target||0),r.flyAsh.achieved+=Number(l("fly ash",n.productArr).achieved||0),r.admix.target+=Number(l("admix",n.productArr).target||0),r.admix.achieved+=Number(l("admix",n.productArr).achieved||0)}),e.jsxs(le,{component:se,sx:{maxHeight:"70vh"},children:[e.jsxs(ne,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(t,{sx:a,children:"Date"}),e.jsx(t,{sx:a,children:"Vehicle Name"}),e.jsx(t,{sx:a,children:"Batch No"}),e.jsx(t,{sx:a,children:"Start Time"}),e.jsx(t,{sx:a,children:"End Time"}),e.jsx(t,{sx:a,children:"Total Target Weight"}),e.jsx(t,{sx:a,children:"Total Achieved Weight"}),e.jsx(t,{sx:a,children:"Recipe 1"}),e.jsx(t,{sx:a,children:"Cycle"}),e.jsx(t,{sx:a,children:"Cement"}),e.jsx(t,{sx:a,children:"10mm"}),e.jsx(t,{sx:a,children:"20mm"}),e.jsx(t,{sx:a,children:"Sand"}),e.jsx(t,{sx:a,children:"Water"}),e.jsx(t,{sx:a,children:"Cubic Meter"}),e.jsx(t,{sx:a,children:"30mm"}),e.jsx(t,{sx:a,children:"Crush Sand"}),e.jsx(t,{sx:a,children:"River Sand"}),e.jsx(t,{sx:a,children:"Fly Ash"}),e.jsx(t,{sx:a,children:"Admix"}),e.jsx(t,{sx:a,children:"Receipt"})]})}),e.jsxs(re,{children:[C.map((n,u)=>{var m;return e.jsxs(J,{children:[e.jsx(t,{sx:s,children:n.generalKeyInfo.Date}),e.jsx(t,{sx:s,children:((m=A(n.imei))==null?void 0:m.registration_id)||"-"}),e.jsx(t,{sx:s,children:n.generalKeyInfo["Batch No"]}),e.jsx(t,{sx:s,children:n.generalKeyInfo["Start Time"]}),e.jsx(t,{sx:s,children:n.generalKeyInfo["End Time"]}),e.jsx(t,{sx:s,children:n.generalKeyInfo["Total Target"]}),e.jsx(t,{sx:s,children:n.generalKeyInfo["Total Achieved"]}),e.jsx(t,{sx:s,children:n.generalKeyInfo["Recipe Name"]}),e.jsx(t,{sx:s,children:n.generalKeyInfo.Cycle}),e.jsxs(t,{sx:s,children:[l("cement",n.productArr).target||0," :",l("cement",n.productArr).achieved||0]}),e.jsxs(t,{sx:s,children:[l("10 mm agg",n.productArr).target||0," :",l("10 mm agg",n.productArr).achieved||0]}),e.jsxs(t,{sx:s,children:[l("20 mm agg",n.productArr).target||0," :",l("20 mm agg",n.productArr).achieved||0]}),e.jsxs(t,{sx:s,children:[l("sand",n.productArr).target||0," :",l("sand",n.productArr).achieved||0]}),e.jsx(t,{sx:s,children:n.generalKeyInfo.Water}),e.jsx(t,{sx:s,children:n.generalKeyInfo["Cubic Meter"]}),e.jsxs(t,{sx:s,children:[l("30mm",n.productArr).target||0," :",l("30mm",n.productArr).achieved||0]}),e.jsxs(t,{sx:s,children:[l("crush sand",n.productArr).target||0," :",l("crush sand",n.productArr).achieved||0]}),e.jsxs(t,{sx:s,children:[l("river sand",n.productArr).target||0," :",l("river sand",n.productArr).achieved||0]}),e.jsxs(t,{sx:s,children:[l("fly ash",n.productArr).target||0," :",l("fly ash",n.productArr).achieved||0]}),e.jsxs(t,{sx:s,children:[l("admix",n.productArr).target||0," :",l("admix",n.productArr).achieved||0]}),e.jsx(t,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",n),E(n),T(!0)},children:"View Receipt"})]},u)}),e.jsxs(J,{children:[e.jsx(t,{sx:s,children:e.jsx("b",{children:"TOTAL"})}),e.jsx(t,{}),e.jsx(t,{}),e.jsx(t,{}),e.jsx(t,{}),e.jsx(t,{sx:s,children:e.jsx("b",{children:r.totalTarget})}),e.jsx(t,{sx:s,children:e.jsx("b",{children:r.totalAchieved})}),e.jsx(t,{}),e.jsx(t,{}),e.jsx(t,{sx:s,children:e.jsxs("b",{children:[r.cement.target,":",r.cement.achieved]})}),e.jsx(t,{sx:s,children:e.jsxs("b",{children:[r.mm10.target,":",r.mm10.achieved]})}),e.jsx(t,{sx:s,children:e.jsxs("b",{children:[" ",r.mm20.target,":",r.mm20.achieved]})}),e.jsx(t,{sx:s,children:e.jsxs("b",{children:[r.sand.target,":",r.sand.achieved]})}),e.jsx(t,{sx:s,children:e.jsx("b",{children:r.water})}),e.jsx(t,{sx:s,children:e.jsx("b",{children:r.cubic})}),e.jsx(t,{sx:s,children:e.jsxs("b",{children:[r.mm30.target,":",r.mm30.achieved]})}),e.jsx(t,{sx:s,children:e.jsxs("b",{children:[" ",r.crushSand.target,":",r.crushSand.achieved]})}),e.jsxs(t,{sx:s,children:[r.riverSand.target,":",r.riverSand.achieved]}),e.jsx(t,{sx:s,children:e.jsxs("b",{children:[r.flyAsh.target,":",r.flyAsh.achieved]})}),e.jsx(t,{sx:s,children:e.jsxs("b",{children:[r.admix.target,":",r.admix.achieved]})})]})]})]}),e.jsx(rt,{receiptData:S,open:g,setOpen:T})]})}function vt({handleBack:C,setStartDate:R,startDate:S,setEndDate:E,endDate:g}){var W;const T=w(),{vehicleGroup:A,vehicleList:l}=$(c=>c.liveMap),{batchReportsData:a,batchReportsData2:s,loading:r,selectedGroup:n,selectedVehicle:u,distributorList:m}=$(c=>c.report),[j,N]=b.useState([]);b.useState([]);const[V,Y]=b.useState([]),[z,D]=b.useState([]);let _=c=>(console.log(l.find(h=>{var f;return((f=h==null?void 0:h.imei[0])==null?void 0:f.mac_id)==c||""})),l.find(h=>{var f;return((f=h==null?void 0:h.imei[0])==null?void 0:f.mac_id)==c||""}));const I=(c,h)=>h.find(o=>{var H;return((H=o==null?void 0:o.name)==null?void 0:H.toLowerCase().trim())===c})||null,P=(c,h)=>{if(!c||!c.length>0)return;const f=c.reduce((O,L)=>O+(L!=null&&L.total_target&&parseFloat(L.total_target.replace(/^0+/,""))||0),0),o=c.reduce((O,L)=>O+(L!=null&&L.totalAcheived&&parseFloat(L.totalAcheived.replace(/^0+/,""))||0),0),H=["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"],i={};return H.forEach(O=>{const L=c.reduce((X,U)=>{var Z;const q=(Z=h(O,U.materials||[]))==null?void 0:Z.target;return X+(q&&parseFloat(q.replace(/^0+/,""))||0)},0),ee=c.reduce((X,U)=>{var Z;const q=(Z=h(O,U.materials||[]))==null?void 0:Z.actual;return X+(q&&parseFloat(q.replace(/^0+/,""))||0)},0);i[O]=`${L}:${ee}`}),{"Total Target Weight":f,"Total Achieved Weight":o,...i}};b.useEffect(()=>{const c=i=>i&&String(i).replace(/^0+/,"")||"-",h=(i,O=[])=>{const L=I(i,O);return{target:c(L==null?void 0:L.target),actual:c(L==null?void 0:L.actual)}};let f=(a==null?void 0:a.map(i=>{const{customer_name:O="-",registration_id:L="-",segment:ee="-"}=_(i==null?void 0:i.imei)||{};return{Date:i!=null&&i.date&&G(i==null?void 0:i.date,"DDMMYYYY").isValid()?G(i==null?void 0:i.date,"DDMMYYYY").format("DD-MM-YYYY"):"-",Vehicle:L||"-","Batch No":(i==null?void 0:i.batch_no)||"-","Start Time":(i==null?void 0:i.start_time)||"-",EndTime:(i==null?void 0:i.end_time)||"-","Total Target Weight":c(i==null?void 0:i.total_target),"Total Achieved Weight":c(i==null?void 0:i.totalAcheived),"Recipe 1":(i==null?void 0:i.mix_name)||"-",Cement:`${h("cement",i==null?void 0:i.materials).target}:${h("cement",i==null?void 0:i.materials).actual}`,"10mm":`${h("10 mm",i==null?void 0:i.materials).target}:${h("10mm",i==null?void 0:i.materials).actual}`,"20mm":`${h("20 mm",i==null?void 0:i.materials).target}:${h("20mm",i==null?void 0:i.materials).actual}`,Sand:`${h("sand",i==null?void 0:i.materials).target}:${h("sand",i==null?void 0:i.materials).actual}`,"Crush Sand":`${h("crush sand",i==null?void 0:i.materials).target}:${h("crush sand",i==null?void 0:i.materials).actual}`,"River Sand":`${h("river sand",i==null?void 0:i.materials).target}:${h("river sand",i==null?void 0:i.materials).actual}`,"Fly Ash":`${h("fly ash",i==null?void 0:i.materials).target}:${h("fly ash",i==null?void 0:i.materials).actual}`,"30mm":`${h("30 mm",i==null?void 0:i.materials).target}:${h("30mm",i==null?void 0:i.materials).actual}`,Water:`${h("water",i==null?void 0:i.materials).target}:${h("water",i==null?void 0:i.materials).actual}`,Admix:`${h("admix",i==null?void 0:i.materials).target}:${h("admix",i==null?void 0:i.materials).actual}`}}))||[];const o=P(a,I),H=[...f,{Date:"",Vehicle:"-","Batch No":"-","Start Time":"-",EndTime:"Total","Total Target Weight":(o==null?void 0:o["Total Target Weight"])||0,"Total Achieved Weight":(o==null?void 0:o["Total Achieved Weight"])||0,"Recipe 1":"-",Cement:(o==null?void 0:o.cement)||"-","10mm":(o==null?void 0:o["10 mm"])||"-","20mm":(o==null?void 0:o["20 mm"])||"-",Sand:(o==null?void 0:o.sand)||"-","Crush Sand":(o==null?void 0:o["crush sand"])||"-","River Sand":(o==null?void 0:o["river sand"])||"-","Fly Ash":(o==null?void 0:o["fly ash"])||"-","30mm":(o==null?void 0:o["30 mm"])||"-",Water:(o==null?void 0:o.water)||"-",Admix:(o==null?void 0:o.admix)||"-"}];Y(H)},[a]);const v=c=>{if(!c&&!c.length>0)return;let h=[];for(let f=0;f<c.length;f++)if(c[f].startsWith("Product:")){const o=c[f],H=c[f+1]||"",i=o.match(/Product:\s*(.*?)\s*Target.*:\s*(\d+)/),O=H.match(/Achieved.*:\s*(\d+)/);i&&h.push({product:i[1],target:Number(i[2]),achieved:O?Number(O[1]):0})}return h},x=["Batch No","Date","Start Time","Operator","Recipe Name","Cubic Meter","Cycle","End Time","Total Target","Total Achieved","Water","Admix"],F=c=>{if(!c&&!c.length>0)return;let h={};return c.forEach(f=>{x.forEach(o=>{var H;if(f.includes(o)){const O=((H=f.split(/[:\-](.+)/)[1])==null?void 0:H.trim())||"";h[o]=O}})}),h};b.useEffect(()=>{if(console.log("bacth reports data11",s),s&&s.length>0){let c=s.map(h=>{let f=v((h==null?void 0:h.parts)||[]),o=F((h==null?void 0:h.parts)||[]);return{productArr:f,generalKeyInfo:o,imei:h==null?void 0:h.deviceId}});c&&c.length>0?D(c):D([]),console.log("formatted arr",c)}},[s]),b.useEffect(()=>{if(A&&A.length>0){let c=A.map(h=>({...h,label:h.group_name,value:h.id}));N(c)}},[A,l,m]),b.useEffect(()=>{u||T(ge())},[]);function K(c){console.log("value changed",c),T(je(c))}function B(c){console.log("value",c),T(me(c))}const Q=async()=>{const c=`${S} 00:00`,h=`${g} 23:59`;let f=_(u);if(console.log("vehicle info",f),!p())return;let o={imei:u,startDate:c,endDate:h};f.vehicle_type==="Sprint"&&T(Ge(o)),f.vehicle_type==="Appalto"&&T(Ke(o))},p=()=>!S||!g||u==="all"?(te.error("Please select start date, end date, and vehicle."),!1):!0,d=(W=_(u))==null?void 0:W.vehicle_type;console.log("device type",d);const y=n==="All"?l:l.filter(c=>c.vehicle_group===n);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(ue,{handleBack:C,downloadData:V})}),e.jsxs(M,{children:[e.jsxs(k,{size:"large",value:n,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:K,filterOption:(c,h)=>{var f;return typeof((f=h==null?void 0:h.props)==null?void 0:f.children)=="string"&&h.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"All",children:"All"}),j.map((c,h)=>e.jsx(k.Option,{value:c.value,children:c.label},h))]}),e.jsxs(k,{size:"large",value:u,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:B,filterOption:(c,h)=>{var f;return typeof((f=h==null?void 0:h.props)==null?void 0:f.children)=="string"&&h.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"all",children:"None"},"all"),y&&y.length>0&&y.map((c,h)=>{var f;return e.jsx(k.Option,{value:(f=c.imei[0])==null?void 0:f.mac_id,children:c.registration_id},h)})]}),e.jsx(ve,{setStartDate:R,setEndDate:E,selectedDate:!1,startDate:S,endDate:g}),e.jsx(pe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:Q,disabled:!u,children:"Generate report"})]}),r&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(fe,{})}),d==="Sprint"&&(a==null?void 0:a.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(jt,{tableData:a})}),d==="Appalto"&&(z==null?void 0:z.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(mt,{tableData:z})})]})}function bt({tableData:C}){const{vehicleList:R}=$(l=>l.liveMap),{selectedVehicle:S}=$(l=>l.report);let E=l=>R.find(a=>{var s;return((s=a==null?void 0:a.imei[0])==null?void 0:s.mac_id)==l||""});b.useEffect(()=>{},[R]);const g={fontSize:"12px",fontWeight:"bold"};function T(l){return console.log("hex",l),l.match(/../g).reverse().join("")}const A=(l,a)=>{var u,m,j,N;console.log("pid",l);const s=a.find(V=>l===(V==null?void 0:V.pid));if(console.log("matched pid",s),!s)return"NA";const r=((N=(j=(m=(u=E(S))==null?void 0:u.sub_model)==null?void 0:m.model_modelecu)==null?void 0:j[0])==null?void 0:N.pgn)||[];console.log("j1939 parameter",r);const n=r.find(V=>{var Y,z;return(l==null?void 0:l.toLowerCase())===((z=(Y=V==null?void 0:V.spn[0])==null?void 0:Y.spn)==null?void 0:z.toLowerCase())});if(console.log("matchedPidConfig",n),n){const{message_type:V,resolution:Y,offset:z}=n==null?void 0:n.spn[0];console.log("message",V,Y,z);let D=T(s==null?void 0:s.rawHex),_=Fe(V,D,Y,z);if(l==="0060"){let I=E(S),P=_/100*(I==null?void 0:I.tank_capacity)||0;return parseFloat(P.toFixed(2))||0}return _||0}return"NA"};return e.jsx(e.Fragment,{children:e.jsx(le,{component:se,sx:{maxHeight:"70vh"},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(J,{children:[e.jsx(t,{align:"left",sx:g,children:"Entry Date"}),e.jsx(t,{align:"left",sx:g,children:"Device Date"}),e.jsx(t,{align:"left",sx:g,children:"HWID"}),e.jsx(t,{align:"left",sx:g,children:"Latitude"}),e.jsx(t,{align:"left",sx:g,children:"Longitude"}),e.jsx(t,{align:"left",sx:g,children:"Engine Coolant Temperature"}),e.jsx(t,{align:"left",sx:g,children:"DFF Level"}),e.jsx(t,{align:"left",sx:g,children:"Fuel Level"}),e.jsx(t,{align:"left",sx:g,children:"Engine Speed"}),e.jsx(t,{align:"left",sx:g,children:"Real time Fuel Consumtion"}),e.jsx(t,{align:"left",sx:g,children:"Total Engine Hours"}),e.jsx(t,{align:"left",sx:g,children:"Engine Oil Pressure"}),e.jsx(t,{align:"left",sx:g,children:"Equip Status"}),e.jsx(t,{align:"left",sx:g,children:"Battery Voltage"})]})}),e.jsx(re,{children:C&&C.map((l,a)=>{var s,r,n,u;return e.jsxs(J,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:(l==null?void 0:l.createdAt)&&G(l==null?void 0:l.createdAt).format("DD-MM-YYYY HH:mm:ss")||"-"}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:((s=l==null?void 0:l.accOnTime)==null?void 0:s.utc)&&G((r=l==null?void 0:l.accOnTime)==null?void 0:r.utc).format("DD-MM-YYYY HH:mm:ss")||"-"}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.deviceId}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l!=null&&l.latitude?(n=parseFloat(l==null?void 0:l.latitude))==null?void 0:n.toFixed(2):"NA"}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:l!=null&&l.longitude?(u=parseFloat(l==null?void 0:l.longitude))==null?void 0:u.toFixed(2):"NA"}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:A("006e",l==null?void 0:l.pids)}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:A("06e1",l==null?void 0:l.pids)}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:A("0060",l==null?void 0:l.pids)}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:A("00be",l==null?void 0:l.pids)}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:A("00b7",l==null?void 0:l.pids)}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:A("00f7",l==null?void 0:l.pids)}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:A("0064",l==null?void 0:l.pids)}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:A("sas",l==null?void 0:l.pids)}),e.jsx(t,{align:"left",sx:{fontSize:"10px"},children:A("00a8",l==null?void 0:l.pids)})]},a+1)})})]})})})}const yt="https://cc.wikitrak.in/proxy-3031";function St({handleBack:C,setStartDate:R,startDate:S,setEndDate:E,endDate:g}){var Q;const T=w(),{vehicleGroup:A,vehicleList:l}=$(p=>p.liveMap),{selectedGroup:a,selectedVehicle:s,distributorList:r}=$(p=>p.report),[n,u]=b.useState([]);b.useState([]);const[m,j]=b.useState([]),[N,V]=b.useState([]),[Y,z]=b.useState(!1);function D(p){return p.match(/../g).reverse().join("")}const _=(p,d)=>{var h,f,o,H;console.log("pid",p);const y=d.find(i=>p===(i==null?void 0:i.pid));if(console.log("matched pid",y),!y)return"NA";const W=((H=(o=(f=(h=I(s))==null?void 0:h.sub_model)==null?void 0:f.model_modelecu)==null?void 0:o[0])==null?void 0:H.pgn)||[];console.log("j1939 parameter",W);const c=W.find(i=>{var O,L;return(p==null?void 0:p.toLowerCase())===((L=(O=i==null?void 0:i.spn[0])==null?void 0:O.spn)==null?void 0:L.toLowerCase())});if(console.log("matchedPidConfig",c),c){const{message_type:i,resolution:O,offset:L}=c==null?void 0:c.spn[0];console.log("message",i,O,L);let ee=D(y==null?void 0:y.rawHex),X=Fe(i,ee,O,L);if(p==="0060"){let U=I(s),q=X/100*(U==null?void 0:U.tank_capacity)||0;return parseFloat(q.toFixed(2))||0}return X||0}return"NA"};b.useEffect(()=>{if(N&&N.length>0){let p=N.map(d=>{var y,W;return{"Entry Date":(d==null?void 0:d.createdAt)&&G(d==null?void 0:d.createdAt).format("DD-MM-YYYY HH:mm:ss")||"-","Device Date":((y=d==null?void 0:d.accOnTime)==null?void 0:y.utc)&&G((W=d==null?void 0:d.accOnTime)==null?void 0:W.utc).format("DD-MM-YYYY HH:mm:ss")||"-",HWID:d==null?void 0:d.deviceId,Latitude:d==null?void 0:d.latitude,Longitude:d.longitude,"Engine Coolant Temperature":_("006e",d==null?void 0:d.pids),"DFF Level":_("06e1",d==null?void 0:d.pids),"Fuel Level":_("0060",d==null?void 0:d.pids),"Engine Speed":_("00be",d==null?void 0:d.pids),"Real time Fuel Consumtion":_("00b7",d==null?void 0:d.pids),"Total Engine Hours":_("00f7",d==null?void 0:d.pids),"E,ngine Oil Pressure":_("0064",d==null?void 0:d.pids),"Equip Status":"NA","Battery Voltage":_("00a8",d==null?void 0:d.pids)}});j(p)}},[N]);let I=p=>(console.log(l.find(d=>{var y;return((y=d==null?void 0:d.imei[0])==null?void 0:y.mac_id)==p||""})),l.find(d=>{var y;return((y=d==null?void 0:d.imei[0])==null?void 0:y.mac_id)==p||""}));function P(p){console.log("value changed",p),T(je(p))}function v(p){console.log("value",p),T(me(p))}const x=async()=>{z(!0);const p=`${S}`,d=`${g}`;let y=I(s);if(console.log("vehicle info",y),!F())return;let W={deviceId:s,startDate:p,endDate:d};try{const{data:c}=await Ue.post(`${yt}/api/ivn-pid/by-date`,W);console.log("data",c),c&&Array.isArray(c==null?void 0:c.packets)&&V(c==null?void 0:c.packets),z(!1)}catch(c){z(!1),console.log("error",c)}},F=()=>!S||!g||s==="all"?(te.error("Please select start date, end date, and vehicle."),!1):!0,K=(Q=I(s))==null?void 0:Q.vehicle_type;console.log("device type",K);const B=a==="All"?l:l.filter(p=>p.vehicle_group===a);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(ue,{handleBack:C,downloadData:m})}),e.jsxs(M,{children:[e.jsxs(k,{size:"large",value:a,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:P,filterOption:(p,d)=>{var y;return typeof((y=d==null?void 0:d.props)==null?void 0:y.children)=="string"&&d.props.children.toLowerCase().indexOf(p.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"All",children:"All"}),n.map((p,d)=>e.jsx(k.Option,{value:p.value,children:p.label},d))]}),e.jsxs(k,{size:"large",value:s,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:v,filterOption:(p,d)=>{var y;return typeof((y=d==null?void 0:d.props)==null?void 0:y.children)=="string"&&d.props.children.toLowerCase().indexOf(p.toLowerCase())>=0},children:[e.jsx(k.Option,{value:"all",children:"None"},"all"),B&&B.length>0&&B.map((p,d)=>{var y;return e.jsx(k.Option,{value:(y=p.imei[0])==null?void 0:y.mac_id,children:p.registration_id},d)})]}),e.jsx(ve,{setStartDate:R,setEndDate:E,selectedDate:!1,startDate:S,endDate:g}),e.jsx(pe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:x,disabled:!s,children:"Generate report"})]}),Y&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(fe,{})}),e.jsx(bt,{tableData:N})]})}function oe({children:C,value:R,index:S}){return e.jsx("div",{role:"tabpanel",hidden:R!==S,children:R===S&&e.jsx(M,{p:2,children:C})})}function Tt({showCard:C,setReportType:R,reportType:S}){$(n=>n.dashboard),$(n=>n.liveMap);const{startDate:E,endDate:g,tabValue:T}=$(n=>n.report),[A,l]=b.useState(!0);b.useState({}),b.useState(!1);let a=w();b.useEffect(()=>{},[g]),b.useEffect(()=>{a(Ve()),a(ze())},[]);const s=()=>{a(ge()),a(Ve()),a(ze()),a(R(null))},r=(n,u)=>{a(Je(u))};return e.jsx(e.Fragment,{children:e.jsx(M,{sx:{},children:e.jsxs(M,{children:[e.jsxs(qe,{value:T,onChange:r,children:[e.jsx(ce,{label:"Vehicle Report"}),e.jsx(ce,{label:"Batch data report"}),e.jsx(ce,{label:"PID Report"})]}),e.jsx(oe,{value:T,index:0,children:e.jsx(ft,{handleBack:s,selectedDate:A,setEndDate:de,setStartDate:he,startDate:E,endDate:g})}),e.jsx(oe,{value:T,index:1,children:e.jsx(vt,{handleBack:s,selectedDate:A,setEndDate:de,setStartDate:he,startDate:E,endDate:g})}),e.jsx(oe,{value:T,index:2,children:e.jsx(St,{handleBack:s,selectedDate:A,setEndDate:de,setStartDate:he,startDate:E,endDate:g})})]})})})}function Dt(){const{mode:C,showVehicles:R,selectedVehicleGroup:S}=$(j=>j.dashboard),{w_customer_id:E}=$(j=>j.auth),{reportType:g}=$(j=>j.report),[T,A]=b.useState([]),[l,a]=b.useState(!0),[s,r]=b.useState(!1),n=nt(C);let u=w();b.useEffect(()=>{m()},[]);const m=async()=>{try{let j=[],N=[];const V=await u(Qe({w_customer_id:E}));if(Array.isArray(V.payload)){V.payload.forEach(D=>{var _,I;Array.isArray(D.imei)&&D.imei.length>0?(j.push({id:D.id,label:D.registration_id,value:(_=D==null?void 0:D.imei[0])==null?void 0:_.mac_id,workShop:D==null?void 0:D.workshop,vehicle_group:D==null?void 0:D.vehicle_group}),N.push((I=D.imei[0])==null?void 0:I.mac_id)):console.error("IMEI data not found for item:",D)});const Y="one",z=N;N.length>0&&(u(Xe({type:Y,imei:z})),u(Ze(z))),A(j),u(we({w_customer_id:E})),u(et({}))}else console.error("Unexpected data format:",V),te.error("Unexpected data format:")}catch(j){console.error("Error fetching vehicle data:",j),te.error(`Error fetching vehicle data: ${j}`)}};return T.filter(j=>Object.keys(S).length===0||j.vehicle_group===S.id),e.jsxs("div",{className:"app",children:[e.jsx(tt,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:n.grey[100]},children:[e.jsx(at,{title:"Report",setShowVehiclesGroup:r,showVehiclesGroup:s,reportType:g}),e.jsx(lt,{setShowVehiclesGroup:r,showVehiclesGroup:s}),e.jsxs(M,{style:{display:"flex",width:"100%",height:"95vh",background:n.grey[200]},children:[e.jsx(M,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(M,{style:{width:"100%"},children:e.jsx(Tt,{showCard:l,setReportType:st,reportType:g})})}),!1]})]})]})}export{Dt as default};
