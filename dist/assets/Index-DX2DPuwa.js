import{a_ as X,a$ as m,b as n,j as a,aW as k,aY as w,fa as oe,fb as re,c4 as de,b7 as F,bB as le,fc as ie,bm as H,fd as ee,bf as ue,d4 as se,cf as he,dT as pe,dU as be,dV as _e,dW as ae,dX as l,dY as fe,f2 as xe,da as ge,eJ as je,eK as ne,f9 as ke,fe as Se,bH as te,bw as Ce,bx as De,bA as ye,bz as ve,bq as Be,bs as Pe,b5 as Te}from"./index-NiJCgo_l.js";import{V as Ve}from"./VehicleMenu-DZ7XNwWq.js";import{P as Ae}from"./Parameters-DKn5h8MZ.js";/* empty css           */import{C as $e,T as Ee,d as me}from"./excelUtils-LM2XzKSr.js";import{E as Ie,T as Le}from"./Edit-CTSAOby1.js";import{D as Ye}from"./Remove-DYLQMzkc.js";import{a as Re,B as Ne}from"./BreakDownJobCardTable-DR1O8xep.js";import{A as He}from"./AddBreakdown-BYBnX_GU.js";import"./index.esm-BrItzKjM.js";import{S as Me}from"./ServicesTopBar-BzhXQ1Ta.js";import"./Autocomplete-CXYKbOYu.js";import"./xlsx-D5JNrnKm.js";import"./formik.esm-BH7pk3wp.js";import"./Add-DI9DJxDv.js";import"./useMediaQuery-DteeoZuT.js";const Oe="https://cc.wikitrak.in/api-proxy/api/v1",Ue={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},Ge=({breakdownData:x,status:r})=>{const g=X(),{isUpdateBreakdown:C}=m(p=>p.equipment),{w_customer_id:$}=m(p=>p.auth),[j,D]=n.useState(!1),y=()=>{console.log("breakdownData",x),localStorage.getItem("role"),g(oe(!C)),g(re(x))},I=()=>{console.log("dlt btn clicked"),localStorage.getItem("role"),D(!0)},v=async()=>{console.log("breakdownData data deleting");try{await de.delete(`${Oe}/vehicles/new/breakdown/create/${x.id}/`),F.success("breakdownData data deleted successfully!"),g(le($))}catch(p){console.error("Error deleting breakdown data:",p),F.error("Failed to delete breakdown data. Please try again.")}D(!1)},E=()=>{D(!1)},M={color:"#686868"};return a.jsxs(k,{sx:Ue,children:[a.jsx(w,{onClick:y,color:"primary",disabled:(r==null?void 0:r.toLowerCase())==="rejected"||(r==null?void 0:r.toLowerCase())==="close",children:a.jsx(Ie,{})}),a.jsx(w,{onClick:I,children:a.jsx(Ye,{sx:M})}),a.jsx($e,{open:j,onClose:E,onConfirm:v})]})},ce=[{id:"breakdown_id",label:"BDID"},{id:"registration_id",label:"Vehicle No"},{id:"breakdown_topic",label:"Topic"},{id:"breakdown_sub_topic",label:"Sub Topic"},{id:"user",label:"Created"},{id:"technician",label:"Technician"},{id:"contact_person",label:"Contact person"},{id:"mob_no",label:"Contact person mobile"},{id:"description",label:"Cust. complaint"},{id:"submission_date",label:"Submission Date"},{id:"submission_time",label:"Submission Time"},{id:"status",label:"Status"}],Je=()=>{const{breakdowns:x}=m(e=>e.breakdown),{searchTerm:r}=m(e=>e.inspection),g=X(),[C,$]=n.useState("asc"),[j,D]=n.useState("BDID"),[y,I]=n.useState(0),[v,E]=n.useState(8),[M,p]=n.useState(!1),[L,W]=n.useState(null),[Y,z]=n.useState("breakdown_id");n.useState({id:"",status:"",workshop:"",user:""}),n.useEffect(()=>{g(ie({}))},[]);const O=e=>{$(j===e&&C==="asc"?"desc":"asc"),D(e)},U=(e,u)=>{I(u)},K=e=>{E(parseInt(e.target.value,10)),I(0)},B=((e,u,_)=>!u||!_?e:e.filter(s=>(()=>{var o,f,c,d,P,T,V,A,J,S;switch(u){case"breakdown_id":return((s==null?void 0:s.breakdown_id)||"").toString();case"registration_id":return((o=s==null?void 0:s.vehicle)==null?void 0:o.registration_id)||"";case"breakdown_topic":return((f=s==null?void 0:s.breakdown_topic)==null?void 0:f.topic)||"";case"user_name":return`${((d=(c=s==null?void 0:s.user)==null?void 0:c.us_user)==null?void 0:d.first_name)||""} ${((T=(P=s==null?void 0:s.user)==null?void 0:P.us_user)==null?void 0:T.last_name)||""}`;case"technician_name":return`${((A=(V=s==null?void 0:s.technician)==null?void 0:V.us_user)==null?void 0:A.first_name)||""} ${((S=(J=s==null?void 0:s.technician)==null?void 0:J.us_user)==null?void 0:S.last_name)||""}`;case"contact_person":return(s==null?void 0:s.contact_person)||"";case"mob_no":return(s==null?void 0:s.mob_no)||"";case"submission_date":return s!=null&&s.submission_date?H(s.submission_date).format("YYYY-MM-DD"):"";case"start_time":return s!=null&&s.submission_date?H(s.submission_date).format("HH:mm A"):"";case"status":return(s==null?void 0:s.status)||"";default:return""}})().toLowerCase().includes(_.toLowerCase())))((x==null?void 0:x.slice())||[],Y,r),G=B.slice(y*v,y*v+v);console.log(G,B,"paginatedData");const i={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},Q=B&&B.map(e=>{var _,s,h,o,f,c,d,P,T,V,A,J;const u=e!=null&&e.breakdown_parts&&(e==null?void 0:e.breakdown_parts.length)>0?e==null?void 0:e.breakdown_parts.map((S,Fe)=>{var Z;return`${(Z=S==null?void 0:S.spare_parts)==null?void 0:Z.description}: Qty ${S==null?void 0:S.quantity}`}).join(";"):"N/A";return{BDID:(e==null?void 0:e.breakdown_id)||"","Registration ID":((_=e==null?void 0:e.vehicle)==null?void 0:_.registration_id)||"","Breakdown Topic":((s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic)||"","Breakdown Sub Topic":((o=(h=e.breakdown_topic)==null?void 0:h.breakdown_sub_topic)==null?void 0:o.name)||"","Customer Complaint":(e==null?void 0:e.description)||"","Created By":`${((c=(f=e==null?void 0:e.user)==null?void 0:f.us_user)==null?void 0:c.first_name)||""} ${((P=(d=e==null?void 0:e.user)==null?void 0:d.us_user)==null?void 0:P.last_name)||""}`,"Technician Name":`${((V=(T=e==null?void 0:e.technician)==null?void 0:T.us_user)==null?void 0:V.first_name)||""} ${((J=(A=e==null?void 0:e.technician)==null?void 0:A.us_user)==null?void 0:J.last_name)||""}`,"Contact Person":(e==null?void 0:e.contact_person)||"","Mobile No":(e==null?void 0:e.mob_no)||"","Submission Date":e!=null&&e.submission_date?H(e.submission_date).format("YYYY-MM-DD"):"","Submission Time":e!=null&&e.submission_date?H(e.submission_date).format("HH:mm A"):"",Status:(e==null?void 0:e.status)||"","Spare parts":u}});let R=ee("Breakdown"),N=ee("Job Card");const t=(N==null?void 0:N.includes("Create"))||N==="Read-Write-Only",b=(R==null?void 0:R.includes("Update"))||R==="Read-Write-Only";return a.jsxs(k,{sx:{m:"10px"},children:[a.jsxs(k,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsx(Ee,{columns:ce,selectedColumn:Y,onColumnChange:z,searchTerm:r,onSearchChange:e=>g(ue(e))}),a.jsx(se,{variant:"contained",color:"success",onClick:()=>me(Q,"breakdown-tickets.xlsx"),children:"Download Excel"})]}),a.jsxs(he,{children:[a.jsx(pe,{sx:{height:"55vh",bgcolor:"white",borderRadius:"10px"},children:a.jsxs(be,{stickyHeader:!0,children:[a.jsx(_e,{children:a.jsxs(ae,{children:[ce.map(e=>a.jsx(l,{sx:i,children:a.jsx(Le,{active:j===e.id,direction:j===e.id?C:"asc",onClick:()=>O(e.id),children:e.label})},e.id)),b&&a.jsx(l,{sx:i,children:"Action"}),t&&a.jsx(l,{sx:i,children:"Job card"})]})}),a.jsx(fe,{children:G.map((e,u)=>{var _,s,h,o,f,c,d,P,T,V,A;return a.jsxs(ae,{children:[a.jsx(l,{children:e==null?void 0:e.breakdown_id}),a.jsx(l,{children:(_=e==null?void 0:e.vehicle)==null?void 0:_.registration_id}),a.jsx(l,{children:(s=e==null?void 0:e.breakdown_topic)==null?void 0:s.topic}),a.jsx(l,{children:(h=e==null?void 0:e.breakdown_sub_topic)==null?void 0:h.name}),a.jsx(l,{children:`${(f=(o=e==null?void 0:e.user)==null?void 0:o.us_user)==null?void 0:f.first_name} ${(d=(c=e==null?void 0:e.user)==null?void 0:c.us_user)==null?void 0:d.last_name}`}),a.jsx(l,{children:`${((T=(P=e==null?void 0:e.technician)==null?void 0:P.us_user)==null?void 0:T.first_name)||"N/A"} ${((A=(V=e==null?void 0:e.technician)==null?void 0:V.us_user)==null?void 0:A.last_name)||""}`}),a.jsx(l,{children:e==null?void 0:e.contact_person}),a.jsx(l,{children:e==null?void 0:e.mob_no}),a.jsx(l,{children:e==null?void 0:e.description}),a.jsx(l,{children:(e==null?void 0:e.submission_date)&&H(e.submission_date).format("YYYY-MM-DD")||"N/A"}),a.jsx(l,{children:(e==null?void 0:e.submission_date)&&H(e.submission_date).format("HH:mm A")||"N/A"}),a.jsx(l,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),b&&a.jsx(l,{children:a.jsx(Ge,{breakdownData:e,status:e.status})}),t&&a.jsx(l,{children:a.jsx(se,{variant:"outlined",onClick:()=>{p(!0),W(e)},disabled:e.jobcard,children:"Create job card"})})]},u)})})]})}),a.jsx(xe,{component:"div",count:B.length,page:y,onPageChange:U,rowsPerPage:v,onRowsPerPageChange:K,rowsPerPageOptions:[5,10,15]}),a.jsx(Re,{rowData:L,open:M,handleClose:()=>p(!1),isTechnician:!0})]})]})},We=Je;function qe(){const[x]=ge(),r=x.get("tab"),[g,C]=n.useState(0),$=(j,D)=>{C(D)};return n.useEffect(()=>{r&&C(Number(r))},[]),a.jsxs(k,{sx:{width:"100%"},children:[a.jsx(k,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsxs(je,{value:g,onChange:$,"aria-label":"Breakdown Tabs",children:[a.jsx(ne,{label:"Breakdown Tickets"}),a.jsx(ne,{label:"Breakdown Job Cards"})]})}),a.jsxs(k,{sx:{mt:2},children:[g===0&&a.jsx(We,{}),g===1&&a.jsx(Ne,{})]})]})}function is(){const{locationData:x,selectedVehicle:r,selectedParameterList:g,onlineVehicle:C}=m(t=>t.liveMap),{mode:$,selectedVehicleGroup:j,vehicleZone:D}=m(t=>t.dashboard),y=Te($),[I,v]=n.useState([]),{w_customer_id:E}=m(t=>t.auth),[M,p]=n.useState(),[L,W]=n.useState(!1),[Y,z]=n.useState(!1),[O,U]=n.useState([]);n.useState(!0);const[K,q]=n.useState(!1),[B,G]=n.useState(!1);let i=X();n.useEffect(()=>{Q(),i(ke()),i(le(E)),i(Se())},[]),n.useEffect(()=>{console.log("selectedVehicleGroup",j)},[j]),n.useEffect(()=>{U([]),i(te([{reg_id:"",imei:"",params:[]}]))},[r]);const Q=async()=>{try{q(!0);let t=[],b=[];const e=await i(Ce({w_customer_id:E}));if(Array.isArray(e.payload)){e.payload.forEach(s=>{var h,o,f,c;Array.isArray(s.imei)&&s.imei.length>0&&((h=s.imei[0])!=null&&h.mac_id)?(t.push({id:s.id,label:s.registration_id,value:(o=s.imei[0])==null?void 0:o.mac_id,vehilce_type:s==null?void 0:s.segment,chassis_no:s==null?void 0:s.chassis_no,engine_no:s==null?void 0:s.engine_no,workShop:s==null?void 0:s.workshop,registration_id:s==null?void 0:s.registration_id,sell_date:s==null?void 0:s.sell_date,customer_name:s==null?void 0:s.customer_name,vehicle_model:(f=s==null?void 0:s.vehicle_model)==null?void 0:f.name,user:s==null?void 0:s.user,vehicle_group:s==null?void 0:s.vehicle_group}),b.push((c=s.imei[0])==null?void 0:c.mac_id)):console.error("IMEI data not found for item:",s)});const u="one",_=b;b.length>0&&i(De({type:u,imei:_})),v(t),i(ye({w_customer_id:E})),i(ve(t)),q(!1)}else q(!1),console.error("Unexpected data format:",e),F.error("Unexpected data format:")}catch(t){console.error("Error fetching vehicle data:",t),F.error(`Error fetching vehicle data: ${t}`)}},R=async t=>{const{label:b,imei:e,id:u,reg_id:_,checked:s}=t;p(c=>c.map(d=>d.id===u?{...d,checked:!s}:d));let h=[...O],o=[...O];if(!s)x.forEach(c=>{c.latestDocument.imei===e&&(h.push({label:b,value:c.latestDocument[b==="maininputvoltage"?"mainInputVoltage":b]}),o=h,U(h))});else{let c=O.filter(d=>d.label!==b);o=c,U(c)}console.log("tempParamList",o),i(te([{reg_id:_,imei:e,params:o}]))},N=I.filter(t=>Object.keys(j).length===0||t.vehicle_group===j.id);return a.jsxs("div",{className:"app",children:[a.jsx(Be,{}),a.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[a.jsx(Me,{title:"Breakdown",setShowVehicles:W,showVehicles:L,setShowVehiclesGroup:G,showVehiclesGroup:B}),a.jsx(Pe,{setShowVehiclesGroup:G,showVehiclesGroup:B}),a.jsxs(k,{style:{display:"flex",width:"100%",height:"95vh"},children:[a.jsxs(k,{style:{width:L||Y?"80%":"100%"},children:[a.jsx(He,{where:"Breakdown"}),a.jsx(qe,{})]}),L&&a.jsx(k,{style:{width:"20%",backgroundColor:y.grey[100]},children:a.jsx(Ve,{vehicleData:N,title:"Inspections",setParameterData:p,loadingVehicle:K,setShowVehicles:W,showVehicles:L,showParameters:Y,setShowParameters:z})}),Y&&a.jsx(k,{style:{width:"20%",backgroundColor:y.grey[100]},children:a.jsx(Ae,{parametersData:M,setParameterData:p,handleParameterChange:R})})]})]})]})}export{is as default};
