import{a8 as Oe,j as o,y as ae,b as i,D as Te,T as q,F as xe,R as ot,x as Ne,A as we,a5 as st,L as rt,a9 as at,aa as lt,B as ue,ab as ct,Y as it,ac as Ve,$ as ut,a0 as dt,a2 as ft,a3 as gt,ad as Ee}from"./index-2qwa_C6N.js";import{L as pt}from"./LiveMapTopBar-CLqVyGah.js";import{V as ht}from"./VehicleMenu-Xavn-zwz.js";import{t as xt}from"./Search-BeE3YBk3.js";import yt from"./Loader-B_VA9rsF.js";import{L as kt}from"./LiveMapServices-dcu9pfT9.js";import{s as Ie}from"./Socket-CFpJY01f.js";import{P as mt}from"./Parameters-BZRgmMIq.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as bt}from"./LeftSideBar2-CcehIvzl.js";import{V as vt}from"./VehicleGroups-CdvA7MDc.js";import{u as St,G as jt,M as wt}from"./esm-BFt7xoYk.js";import{M as Dt,r as _t,g as It,y as Mt,b as Ct,a as Lt,c as Rt,d as $t,e as Vt,f as Et,h as At,i as Ot,j as Tt,k as Nt,l as Bt,m as Ft,n as Wt,o as Gt,p as Ht,q as Ut,s as qt,t as zt,u as Yt,v as Kt}from"./black_bike-VhNuHshc.js";import{d as Be}from"./Close-8WyII2w5.js";import{d as Xt}from"./ContentCopy-Dfbtq6zq.js";import"./NewLoader-D_WWT4JL.js";import{m as je}from"./motorbike-Ci4voNFa.js";import{d as Jt}from"./Info-C3TNZKjZ.js";import{r as Fe}from"./createSvgIcon-C3cRd_x5.js";import{B as S,C as Zt}from"./CircularProgress-DKpyBPD3.js";import{r as Qt}from"./redTractor-NXgVJyvR.js";import{D as Pt,a as en,b as tn,c as nn}from"./DialogTitle-B7EjHANB.js";import{I as on}from"./IconButton-BrND1_vM.js";import{T as sn}from"./TextField-G9G52kuZ.js";import"./index-BiLviLiP.js";import"./roundedArrow-DLNFiPpz.js";import"./TextArea-BetKKTVh.js";import"./RegionSelector-Bi3sTBN9.js";import"./SearchTab-BZIU0kR2.js";import"./OutlinedInput-WgdAgE-B.js";import"./InputAdornment-CDJjHh2C.js";import"./Select-DwI_hWbf.js";import"./Paper-DHFVui5V.js";import"./MenuItem-C6xxLimY.js";import"./menu2-BCzTtSy4.js";import"./Autocomplete-B7g0Ltei.js";import"./Tooltip-yABlZkr0.js";import"./usePreviousProps-CbL4Ol_d.js";import"./index-s8UfsHCF.js";import"./Card-nMod1s4S.js";import"./CardContent-DFTI0K6D.js";var Me={},rn=Oe;Object.defineProperty(Me,"__esModule",{value:!0});var We=Me.default=void 0,an=rn(Fe()),ln=o;We=Me.default=(0,an.default)((0,ln.jsx)("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"NorthEast");var Ce={},cn=Oe;Object.defineProperty(Ce,"__esModule",{value:!0});var Ge=Ce.default=void 0,un=cn(Fe()),dn=o;Ge=Ce.default=(0,un.default)((0,dn.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn");const fn=({label:m,value:x})=>o.jsxs(S,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[o.jsx(q,{variant:"body2",color:"textSecondary",children:m}),o.jsx(q,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:x||"N/A"})]}),gn=(m,x)=>(m==null?void 0:m.find(B=>{var I,M;return((M=(I=B.imei)==null?void 0:I[0])==null?void 0:M.mac_id)===x}))||{},Ae=({title:m,details:x})=>o.jsx(S,{sx:{width:"45%"},children:x.map(({label:B,value:I})=>o.jsx(fn,{label:B,value:I},B))});let pn=["vt200","wtkpltf001"];function hn({handleVehicleInfo:m,udpatedParams:x,handleClickOpen:B}){var ce,L,H,Y,R,K,te,ne,F,X,de,ie,oe,se,fe,D,re;const{collapsed:I}=ae(k=>k.auth),{vehicleList:M,selectedVehicle:b,selectedImei:G}=ae(k=>k.liveMap),[f,pe]=i.useState({});let[s,le]=i.useState(null);i.useEffect(()=>{let k=x&&(x==null?void 0:x.length)>0&&(x==null?void 0:x.find(y=>{var $;return(($=y==null?void 0:y.latestDocument)==null?void 0:$.imei)==G}));le(k)},[x,G]),i.useEffect(()=>{pe(gn(M,G))},[M,G]);const P=(k,y)=>{const $=`https://www.google.com/maps?q=${k},${y}`;window.open($,"_blank")},ee=k=>{var A,c;let y=(A=k==null?void 0:k.latestDocument)==null?void 0:A.ignition,$=(c=k==null?void 0:k.latestDocument)==null?void 0:c.speed;return y===!0||y===1?$:0},z=[{label:"Vehicle No:",value:f==null?void 0:f.registration_id},{label:"Model:",value:(ce=f==null?void 0:f.vehicle_model)==null?void 0:ce.name},{label:"IMEI No:",value:(H=(L=f==null?void 0:f.imei)==null?void 0:L[0])==null?void 0:H.mac_id},{label:"Chassis No:",value:f==null?void 0:f.chassis_no},{label:"Engine No:",value:f==null?void 0:f.engine_no}],ye=[{label:"Customer Name:",value:(Y=f==null?void 0:f.user)!=null&&Y.us_user?`${f.user.us_user.first_name.charAt(0).toUpperCase()}${f.user.us_user.first_name.slice(1)} ${f.user.us_user.last_name.charAt(0).toUpperCase()}${f.user.us_user.last_name.slice(1)}`:null},{label:"Mobile: ",value:((R=f==null?void 0:f.user)==null?void 0:R.us_user)&&f.user.us_user.mobile},{label:"Date of Sell:",value:f==null?void 0:f.sell_date},{label:"Workshop Name:",value:(K=f==null?void 0:f.workshop)==null?void 0:K.name}];let C={border:"2px solid black",borderRadius:"5px",padding:"5px",color:"black"};const he=k=>{let y=M.find(A=>{var c,h;return((c=A==null?void 0:A.imei)==null?void 0:c.length)>0&&((h=A.imei[0])==null?void 0:h.mac_id)==k.imei}),$=parseFloat((y==null?void 0:y.load_capacity)||0)/49*parseFloat((k==null?void 0:k.analogInput1)||0);return`${parseFloat($).toFixed(2)} Kgs`||0};return o.jsxs(S,{sx:{position:"absolute",top:"600px",left:I?"280px":"450px",zIndex:1,background:Te.bgShadow,p:2,borderRadius:2,color:"white",width:"72%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[o.jsx(q,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),o.jsxs(S,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[o.jsxs(S,{sx:{display:"flex",justifyContent:"space-between",width:"100%",marginLeft:"10px"},children:[o.jsx(S,{sx:C,children:o.jsxs(q,{children:[((te=s==null?void 0:s.latestDocument)==null?void 0:te.venderId)==="Sinocastel"?"Cranking status":"Ignition",":"," ",((ne=s==null?void 0:s.latestDocument)==null?void 0:ne.ignition)===!0||((F=s==null?void 0:s.latestDocument)==null?void 0:F.ignition)===1?"On":"Off"]})}),pn.includes((de=(X=s==null?void 0:s.latestDocument)==null?void 0:X.venderId)==null?void 0:de.toLowerCase())&&o.jsx(S,{sx:C,children:o.jsxs(q,{children:["Pump:"," ",((ie=s==null?void 0:s.latestDocument)==null?void 0:ie.isAcreage)===!0||((oe=s==null?void 0:s.latestDocument)==null?void 0:oe.isAcreage)===1?"On":"Off"]})}),o.jsx(S,{sx:C,children:o.jsxs(q,{children:["Speed: ",ee(s)," km/h"]})}),o.jsx(S,{sx:C,children:o.jsxs(q,{children:["Main Voltage:"," ",s?`${((se=s==null?void 0:s.latestDocument)==null?void 0:se.mainInputVoltage)||0} Voltage`:0]})}),o.jsx(S,{sx:C,children:o.jsxs(q,{children:["Heading:"," ",s?`${(fe=s==null?void 0:s.latestDocument)==null?void 0:fe.heading} deg`:0]})}),s&&((D=s==null?void 0:s.latestDocument)==null?void 0:D.venderId)==="VT200"&&o.jsx(S,{sx:C,children:o.jsxs(q,{children:["Load:"," ",s?he(s==null?void 0:s.latestDocument):0]})}),s&&((re=s==null?void 0:s.latestDocument)==null?void 0:re.venderId)==="VT200"&&o.jsx(S,{sx:C,children:o.jsxs(q,{children:["Remaining fuel:"," ","0 Ltr"]})}),o.jsxs(xe,{disabled:!s,onClick:()=>{var k,y;P((k=s==null?void 0:s.latestDocument)==null?void 0:k.lat,(y=s==null?void 0:s.latestDocument)==null?void 0:y.lng)},children:["Navigate to map",o.jsx(We,{})]}),o.jsxs(xe,{disabled:!s,onClick:()=>{B()},children:["Share live location",o.jsx(Ge,{})]})]}),o.jsx(Be,{sx:{cursor:"pointer",color:"black"},onClick:m})]}),o.jsxs(S,{sx:{display:"flex",justifyContent:"space-between"},children:[o.jsx(Ae,{title:"Vehicle Details",details:z}),o.jsx(Ae,{title:"Customer Details",details:ye})]})]})}const xn="https://cc.wikitrak.in/proxy-3031",yn="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function kn({showCard:m,loadingVehicle:x,vehicleData:B}){const{center:I,selectedParameterList:M,selectedVehicle:b,vehicleList:G,zoom:f,icons:pe,locationData:s,placesData:le,imeiNumbers:P,selectedImei:ee,onlineVehicle:z,loading:ye,services_loading:C}=ae(e=>e.liveMap),{mode:he,styles:ce,vehicles_details:L}=ae(e=>e.dashboard),H=i.useRef(null),{collapsed:Y}=ae(e=>e.auth),[R,K]=i.useState(null),[te,ne]=i.useState(""),[F,X]=i.useState([]),[de,ie]=i.useState(),[oe,se]=i.useState(null);i.useState("");const[fe,D]=i.useState(),[re,k]=i.useState(!1),[y,$]=i.useState(null),[A,c]=ot.useState(!1),[h,V]=i.useState(""),J=async()=>{var e;if(!ee)return ue.error("Please select vehicle");try{const t=await ct.post(`${xn}/api/generate-token`,{vehicleNo:ee});if((e=t==null?void 0:t.data)!=null&&e.token){const n=`http://cc.wikitrak.in/live-location/${ee}/${t.data.token}`;V(n),c(!0)}}catch(t){ue.error("Error occurred while generating link"),c(!1),V(!1),console.error("Error generating link",t)}},Z=()=>{J()},l=()=>{c(!1)},j=Ne(),O={},W=i.useRef([]),w=i.useRef(null),T=i.useRef({}),{isLoaded:ge,loadError:ke}=St({googleMapsApiKey:`${yn}`,loadingElement:o.jsx(yt,{})});i.useEffect(()=>{ge&&K(window.google.maps)},[ge]),i.useEffect(()=>{},[f]),i.useEffect(()=>{var e,t,n,a;if(Object.keys(b).length>0){const r=(y==null?void 0:y.length)>0?y:s,u=r==null?void 0:r.filter(d=>{var g;return((g=d==null?void 0:d.latestDocument)==null?void 0:g.imei)===(b==null?void 0:b.imei)});if((u==null?void 0:u.length)>0){X(u);const d={lat:(t=(e=u[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(a=(n=u[0])==null?void 0:n.latestDocument)==null?void 0:a.lng};j(we(d))}}},[s,b]),i.useEffect(()=>{var e,t,n,a;if(Object.keys(b).length>0){const r=(y==null?void 0:y.length)>0?y:s,u=r==null?void 0:r.filter(d=>{var g;return((g=d==null?void 0:d.latestDocument)==null?void 0:g.imei)===(b==null?void 0:b.imei)});if((u==null?void 0:u.length)>0){X(u);const d={lat:(t=(e=u[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(a=(n=u[0])==null?void 0:n.latestDocument)==null?void 0:a.lng};j(we(d))}}else{const r=s==null?void 0:s.filter(u=>B.some(d=>d.value===u.latestDocument.imei));X(r),$(r)}},[s,b]),i.useEffect(()=>{ie(M)},[M]),i.useEffect(()=>{j(st({}))},[b]),i.useEffect(()=>{if(console.log("before: ",F),!R)return;const e=w.current;let t=null;return(async()=>{console.log("after: ",F);const a=await me(F,e);t&&t.clearMarkers(),t=ze(a,e),Ie.on("locationinfo",r=>{console.log("locationinfo: ",r),Ke(r,W),$(u=>{const d=Array.isArray(u)?u:[],g=d.findIndex(p=>p.latestDocument.imei==r.imei);if(g!==-1){const p=[...d];return p[g]={...p[g],latestDocument:{...p[g].latestDocument,...r}},p}else return[...d,{_id:r.imei,latestDocument:r}]})})})(),()=>{t&&t.clearMarkers(),Object.keys(T.current).forEach(a=>cancelAnimationFrame(T.current[a])),Ie.off("locationinfo")}},[R,F,Ie,de,W,s]);const me=(e,t)=>e.map(n=>{const a=n.latestDocument.imei,r=W.current[a]||be(n,t);return W.current[a]&&ve(n,r),r}),be=(e,t)=>{const n=e.latestDocument.imei,a=new R.Marker({position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},map:t,icon:De(e,0)});return a.addListener("click",()=>qe(e,a,t)),W.current[n]=a,a},ve=async(e,t)=>{var g;const n=t.getPosition(),a=((g=t.getIcon())==null?void 0:g.rotation)||0,r={lat:e.latestDocument.lat,lng:e.latestDocument.lng},u=Re(n,r);console.log("update marker",u),Le(t,n,r,a,u);const d=await De(e,u);t.setIcon(d)},De=async(e,t)=>{var g,p,v,_;const n=(g=e==null?void 0:e.latestDocument)==null?void 0:g.imei,a=Xe(n),r=Ze(e==null?void 0:e.latestDocument,a);return _e((p=e==null?void 0:e.latestDocument)==null?void 0:p.imei)&&He((v=e==null?void 0:e.latestDocument)==null?void 0:v.imei),{url:await Ue(r,t),fillOpacity:2,strokeWeight:1,scale:12,rotation:(_=e==null?void 0:e.latestDocument)==null?void 0:_.heading}},_e=e=>{if(!e)return!1;const t=String(e).toLowerCase();return z.some(n=>String(n).toLowerCase()===t)},He=e=>s==null?void 0:s.some(t=>String(t.latestDocument.imei)===String(e)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),Ue=(e,t,n,a=50,r=40,u=45)=>{const d=`${e}-${t}-${a}-${n}-${r}-${u}`;if(O[d])return Promise.resolve(O[d]);const g=document.createElement("canvas"),p=g.getContext("2d");g.width=a,g.height=a;const v=new Image;return v.src=e,new Promise(_=>{v.onload=()=>{p.clearRect(0,0,g.width,g.height),p.translate(a/2,a/2),p.rotate(t*Math.PI/180),p.translate(-a/2,-a/2);const E=(a-r)/2,Q=(a-u)/2;if(p.drawImage(v,E,Q,r,u),n){const Se=a-10-5,nt=a-10-5;p.beginPath(),p.arc(Se,nt,10/2,0,Math.PI*2),p.fillStyle=n,p.fill()}const N=g.toDataURL("image/png");O[d]=N,_(N)},v.onerror=E=>{console.error("Error loading image for rotation:",E),_(e)}})},qe=(e,t,n)=>{Pe(e.latestDocument._id,e,t,n),et(e.latestDocument.imei)},Le=(e,t,n,a,r)=>{const d=performance.now(),g=()=>{const p=performance.now()-d,v=Math.min(p/500,1),_=t.lat()+v*(n.lat-t.lat()),E=t.lng()+v*(n.lng-t.lng()),Q=(r-a+360)%360-180,N=(a+Q*v+360)%360;e.setPosition({lat:_,lng:E});const U=e.getIcon();U&&typeof U=="object"&&e.setIcon({...U,rotation:N}),v<1?T.current[e.getPosition()]=requestAnimationFrame(g):(e.setPosition(n),U&&typeof U=="object"&&e.setIcon({...U,rotation:r}),delete T.current[e.getPosition()])};T.current[e.getPosition()]=requestAnimationFrame(g)},ze=(e,t)=>new Dt({map:t,markers:e,renderer:{render:({count:n,position:a})=>Ye(n,a)}}),Ye=(e,t)=>{const n=40+Math.min(e*2,40),a=30;let r;return e<10?r={start:"#76c7c0",end:"#34a853"}:e<50?r={start:"#fbbc05",end:"#f2994a"}:r={start:"#f45c42",end:"#d32f2f"},new R.Marker({position:t,icon:{url:`data:image/svg+xml,${encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 100 100">
            <defs>
              <radialGradient id="gradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="${r.start}" />
                <stop offset="100%" stop-color="${r.end}" />
              </radialGradient>
              <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0, 0, 0, 0.5)" />
              </filter>
            </defs>
            <!-- Outer Pulsating Ring -->
            <circle cx="50" cy="50" r="48" fill="url(#gradient)" filter="url(#shadow)" stroke="#ffffff" stroke-width="3" />
            <!-- Decorative Inner Ring -->
            <circle cx="50" cy="50" r="38" fill="none" stroke="#ffffff" stroke-width="2" stroke-dasharray="4 2" />
            <!-- Star Decoration -->
            <polygon points="50,15 54,38 70,38 57,50 62,68 50,57 38,68 43,50 30,38 46,38" fill="#ffffff" opacity="0.4" />
            <!-- Count Text -->
            <text x="50" y="55" font-size="${a}" fill="black" text-anchor="middle" font-family="'Courier New', monospace" font-weight="bold">
              ${e}
            </text>
          </svg>
        `)}`,scaledSize:new R.Size(n,n)},label:null})},Re=(e,t)=>{const n=N=>N*Math.PI/180,a=N=>N*180/Math.PI,r=n(typeof e.lat=="function"?e.lat():e.lat),u=n(typeof e.lng=="function"?e.lng():e.lng),d=n(typeof t.lat=="function"?t.lat():t.lat),p=n(typeof t.lng=="function"?t.lng():t.lng)-u,v=Math.sin(p)*Math.cos(d),_=Math.cos(r)*Math.sin(d)-Math.sin(r)*Math.cos(d)*Math.cos(p),E=Math.atan2(v,_),Q=(a(E)+360)%360;return console.log("From:",e,"To:",t),console.log("Calculated heading (degrees):",Q),Q},Ke=async(e,t,n)=>{var u;const a=e.imei,r=t.current[a];if(r){const d=r.getPosition(),g=((u=r.getIcon())==null?void 0:u.rotation)||0,p={lat:e.lat,lng:e.lng},v=Re(d,p);console.log("location update",v,g),Le(r,d,p,g,v);const _=await De({latestDocument:e},v);if(r.setIcon(_),ee==(e==null?void 0:e.imei)){const E=w.current.getBounds();E&&!E.contains(p)&&w.current.panTo(p)}}},Xe=e=>{if(!e)return"motorBike";const t=Je(e);return t||console.error(`No vehicle type found for IMEI: ${e}, defaulting to motorBike`),t||"motorBike"},Je=e=>{if(!L||L.length===0)return console.error("vehicles_details is not available"),null;const t=L.find(n=>(n==null?void 0:n.value)===e&&(n==null?void 0:n.vehilce_type));return t||console.error(`No vehicle found for IMEI: ${e}`),t?t.vehilce_type:null},Ze=(e,t)=>{let{speed:n,ignition:a,imei:r}=e,u=_e(r);const d={"2W":{red:_t,green:It,yellow:Mt,black:Ct},"3W":{red:Lt,green:Rt,yellow:$t,black:Vt},"4W":{red:Et,green:At,yellow:Ot,black:Tt},Tractor:{red:Qt,green:Nt,yellow:Bt,black:Ft},Harvestor:{red:Wt,green:Gt,yellow:Ht,black:Ut},BUS:{red:qt,green:zt,yellow:Yt,black:Kt},default:{red:je,green:je,yellow:je,black:je}};let g=d[t]||d.default;if(!u)return g.black;if(u&&!a)return g.red;if(u&&a&&n>0)return g.green;if(u&&a&&n<=0)return g.yellow},Qe=e=>{console.log("packet and type",e);let{speed:t,ignition:n,imei:a}=e;console.log("speed",t,n,a);let r=_e(a);if(console.log("isONline",r),!r)return"Offline";if(r&&!n)return"Online";if(r&&n&&t>0)return"Running";if(r&&n&&t<=0)return"Idle"},Pe=(e,t,n,a)=>{var v,_,E,Q;let r=rt(new Date((v=t==null?void 0:t.latestDocument)==null?void 0:v.Date)).format("DD-MM-YYYY HH:mm");j(at(t.latestDocument.imei));const u={lat:(_=t==null?void 0:t.latestDocument)==null?void 0:_.lat,lng:(E=t==null?void 0:t.latestDocument)==null?void 0:E.lng};j(we(u)),j(lt(15)),H.current||(H.current=new R.InfoWindow);const d=H.current,p=`
      <div>
        <h3>Registration No: ${((Q=G.find(N=>{var U,Se;return((U=N==null?void 0:N.imei[0])==null?void 0:U.mac_id)===((Se=t==null?void 0:t.latestDocument)==null?void 0:Se.imei)}))==null?void 0:Q.registration_id)||""}</h3>
        <h3>Status:${Qe(t==null?void 0:t.latestDocument)}</h3>
        <h3>Last updated time:${r}</h3>
      </div>
    `;oe===e?(d.close(),se(null)):(d.setContent(p),d.open(a,n),se(e))},et=e=>{const t=L&&(L==null?void 0:L.length)>0&&L.find(n=>(n==null?void 0:n.value)===e&&n);D(t||null)},$e=()=>{k(!re)};if(ke)return"Error loading maps";if(!ge)return"Loading maps";if(!R)return null;const tt={height:"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return o.jsxs(o.Fragment,{children:[o.jsx(S,{sx:{position:"absolute",top:"780px",left:Y?"74px":"250px",zIndex:1,background:Te.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:o.jsxs(xe,{sx:{color:"white"},onClick:$e,children:[re?"Hide":"Show"," Vehicle Info",o.jsx(Jt,{})]})}),re===!0&&o.jsx(hn,{handleVehicleInfo:$e,udpatedParams:y,handleClickOpen:Z}),o.jsxs(jt,{id:"map",mapContainerStyle:tt,zoom:f,center:I,onLoad:e=>{w.current=e},options:{styles:he?ce:""},children:[Object.keys(b).length>0&&o.jsx(kt,{setPlace:ne,place:te}),C||x?o.jsx(S,{sx:{position:"absolute",top:"50%",left:"50%"},children:o.jsx(Zt,{})}):le&&le.length>0&&le.map((e,t)=>{var n,a;return o.jsx(wt,{position:{lat:parseFloat((n=e==null?void 0:e.location)==null?void 0:n.lat),lng:parseFloat((a=e==null?void 0:e.location)==null?void 0:a.lng)},animation:window.google.maps.Animation.DROP,icon:{path:pe[`${te}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},t)}),o.jsx(mn,{open:A,shareLink:h,handleClose:l})]})]})}const mn=({open:m,handleClose:x,shareLink:B})=>{i.useState("");const I=i.useRef(null);i.useEffect(()=>{},[]);const M=()=>{const b=I.current;b?(b.select(),b.setSelectionRange(0,99999),document.execCommand("copy")?ue.success("Text copied!"):ue.error("Failed to copy!"),window.getSelection().removeAllRanges()):ue.error("Failed to copy! No input found.")};return o.jsxs(Pt,{onClose:x,"aria-labelledby":"customized-dialog-title",open:m,fullWidth:!0,maxWidth:"lg",children:[!1,o.jsxs(en,{sx:{m:0,p:2},id:"customized-dialog-title",children:["Vehicle live location link",o.jsx(on,{"aria-label":"close",onClick:x,sx:b=>({position:"absolute",right:8,top:8,color:b.palette.grey[500]}),children:o.jsx(Be,{})})]}),o.jsx(tn,{dividers:!0,children:o.jsxs(S,{display:"flex",alignItems:"center",gap:2,mt:1,children:[o.jsx(sn,{fullWidth:!0,variant:"outlined",inputRef:I,value:B,onChange:b=>{},sx:{flex:9}}),o.jsx(xe,{variant:"outlined",onClick:M,startIcon:o.jsx(Xt,{}),sx:{flex:1,minWidth:"auto"},children:"Copy"})]})}),o.jsx(nn,{children:o.jsx(xe,{onClick:x,children:"Close"})})]})};function co(){const{locationData:m,selectedVehicle:x,selectedParameterList:B,onlineVehicle:I}=ae(c=>c.liveMap),{mode:M,selectedVehicleGroup:b}=ae(c=>c.dashboard),G=xt(M),[f,pe]=i.useState([]),[s,le]=i.useState(""),[P,ee]=i.useState(""),[z,ye]=i.useState(""),[C,he]=i.useState(""),{w_customer_id:ce}=ae(c=>c.auth),[L,H]=i.useState(),[Y,R]=i.useState(!1),[K,te]=i.useState(!1),[ne,F]=i.useState([]),[X,de]=i.useState(!0),[ie,oe]=i.useState(!1),[se,fe]=i.useState(!1);let D=Ne();i.useEffect(()=>{D(it({}))},[]),i.useEffect(()=>{re()},[]),i.useEffect(()=>{var c;if(Object.keys(x).length>0){const h=m==null?void 0:m.filter(l=>l.latestDocument.imei==(x==null?void 0:x.imei)),{lat:V,lng:J}=((c=h==null?void 0:h[0])==null?void 0:c.latestDocument)??{},Z={lat:V||Ee.lat,lng:J||Ee.lat};D(we(Z))}},[x,m]),i.useEffect(()=>{F([]),D(Ve([{reg_id:"",imei:"",params:[]}]))},[x]);const re=async()=>{try{oe(!0);let c=[],h=[];const V=await D(ut({w_customer_id:ce}));if(Array.isArray(V.payload)){V.payload.forEach(l=>{var j,O,W,w;Array.isArray(l.imei)&&l.imei.length>0&&((j=l.imei[0])!=null&&j.mac_id)?(c.push({id:l.id,label:l.registration_id,value:(O=l.imei[0])==null?void 0:O.mac_id,vehilce_type:l==null?void 0:l.segment,chassis_no:l==null?void 0:l.chassis_no,engine_no:l==null?void 0:l.engine_no,workShop:l==null?void 0:l.workshop,registration_id:l==null?void 0:l.registration_id,sell_date:l==null?void 0:l.sell_date,customer_name:l==null?void 0:l.customer_name,vehicle_model:(W=l==null?void 0:l.vehicle_model)==null?void 0:W.name,vehicle_group:l==null?void 0:l.vehicle_group}),h.push((w=l.imei[0])==null?void 0:w.mac_id)):console.error("IMEI data not found for item:",l)});const J="one",Z=h;h.length>0&&D(dt({type:J,imei:Z})),pe(c),D(ft(c)),D(gt({w_customer_id:ce})),oe(!1)}else oe(!1),console.error("Unexpected data format:",V),ue.error("Unexpected data format:")}catch(c){console.error("Error fetching vehicle data:",c),ue.error(`Error fetching vehicle data: ${c}`)}},k=async c=>{const{label:h,imei:V,id:J,reg_id:Z,checked:l}=c;H(w=>w.map(T=>T.id===J?{...T,checked:!l}:T));let j=[...ne],O=[...ne];if(!l)m.forEach(w=>{w.latestDocument.imei===V&&(j.push({label:h,value:w.latestDocument[h==="maininputvoltage"?"mainInputVoltage":h]}),O=j,F(j))});else{let w=ne.filter(T=>T.label!==h);O=w,F(w)}D(Ve([{reg_id:Z,imei:V,params:O}]))},y=c=>m==null?void 0:m.some(h=>String(h.latestDocument.imei)===String(c)&&h.latestDocument.speed>0&&(h.latestDocument.ignition===!0||h.latestDocument.ignition===1)),$=c=>m==null?void 0:m.some(h=>String(h.latestDocument.imei)===String(c)&&h.latestDocument.speed<=0&&(h.latestDocument.ignition===!0||h.latestDocument.ignition===1)),A=f.filter(c=>{var ge,ke,me,be,ve;if(!(Object.keys(b).length===0||c.vehicle_group===b.id))return!1;const V=(ge=c==null?void 0:c.label)==null?void 0:ge.toLowerCase().includes(s.toLowerCase()),J=C===""||((ke=c==null?void 0:c.workShop)==null?void 0:ke.region)===C,Z=z===""||((be=(me=c==null?void 0:c.workShop)==null?void 0:me.state)==null?void 0:be.toLowerCase())===(((ve=z==null?void 0:z.toString())==null?void 0:ve.toLowerCase())||""),l=c.value,j=I.includes(l),O=!j,W=j&&y(l),w=j&&$(l);return V&&J&&Z&&(P==="online"?j:P==="offline"?O:P==="running"?W:P==="idling"?w:!0)}).sort((c,h)=>c.label.localeCompare(h.label));return o.jsxs("div",{className:"app",children:[o.jsx(bt,{}),o.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[o.jsx(pt,{title:"Live Map",setShowVehicles:R,showVehicles:Y,showParameters:K,setShowParameters:te,setShowCard:de,showCard:X,setShowVehiclesGroup:fe,showVehiclesGroup:se}),o.jsx(vt,{setShowVehiclesGroup:fe,showVehiclesGroup:se,where:"livemap"}),o.jsxs(S,{style:{display:"flex",width:"100%",height:"95vh"},children:[o.jsx(S,{style:{width:Y||K?"80%":"100%"},children:o.jsx(kn,{showCard:X,loadingVehicle:ie,vehicleData:A})}),Y&&o.jsx(S,{style:{width:"20%",backgroundColor:G.grey[100]},children:o.jsx(ht,{vehicleData:A,title:"Live Map",setParameterData:H,loadingVehicle:ie,setShowVehicles:R,showVehicles:Y,showParameters:K,setShowParameters:te,setSearchedTerm:le,setOptions:ee,setState:ye,setRegion:he,searchTerm:s,options:P,state:z,region:C})}),K&&o.jsx(S,{style:{width:"20%",backgroundColor:G.grey[100]},children:o.jsx(mt,{parametersData:L,setParameterData:H,handleParameterChange:k})})]})]})]})}export{co as default};
