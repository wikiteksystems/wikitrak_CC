import{bT as fe,bU as be,j as e,b0 as y,r as i,a$ as Y,c8 as pe,b8 as N,aX as o,b4 as V,bZ as ut,bb as _,T as D,bE as ft,bd as F,ef as bt,eg as wt,eh as jt,ei as He,el as ge,em as xe,en as mt,aZ as ue,ej as yt,ek as vt,dP as Ke,eo as Ye,ep as St,eq as oe,er as At,b1 as Ct,b5 as kt,es as Rt,dl as Dt,b6 as It,et as Ot,eu as Ve,bD as Et,bx as Lt,by as _t,bA as Pt,br as Nt,bu as Ft}from"./index-B9W9A0YN.js";import{V as qe,a as Ze}from"./Form-D5M00bNQ.js";import{F as Mt}from"./formik.esm-D-reUPUz.js";import{c as Gt,a as Te,b as zt}from"./index.esm-R3Gd3xrx.js";import{u as Wt}from"./useMediaQuery-BlPD5u51.js";import{S as he}from"./Switch--ytAWPxi.js";/* empty css           */var we={},Bt=fe;Object.defineProperty(we,"__esModule",{value:!0});var $e=we.default=void 0,Xt=Bt(be()),Ut=e;$e=we.default=(0,Xt.default)((0,Ut.jsx)("path",{d:"M12 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c2.7 0 5.8 1.29 6 2H6c.23-.72 3.31-2 6-2m0-12C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 10c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonOutlined");var je={},Jt=fe;Object.defineProperty(je,"__esModule",{value:!0});var et=je.default=void 0,Ht=Jt(be()),Kt=e;et=je.default=(0,Ht.default)((0,Kt.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");const Qe="https://cc.wikitrak.in/proxy-3031",Yt=()=>{const{selectedVehicle:t}=y(r=>r.liveMap),{gf_alert:b}=y(r=>r.geofence),{mode:d}=y(r=>r.dashboard),p=V(d),[a,u]=i.useState([]),[x,I]=i.useState(null),[j,h]=i.useState(!1),[v,w]=i.useState(10),S=i.useRef(null);let A=Y();i.useEffect(()=>{L()},[A,t]),i.useEffect(()=>{S.current&&(S.current.scrollTop=0)},[a]);const L=async()=>{var r,c,l;if(Object.keys(t).length>0){let R={imei:t==null?void 0:t.imei};try{h(!0);const k=await pe.post(`${Qe}/ccServer/location/getNotifications`,R);((c=(r=k==null?void 0:k.data)==null?void 0:r.notifications)==null?void 0:c.length)>0?u((l=k==null?void 0:k.data)==null?void 0:l.notifications):N.error("No Geofence Alert For Selected Vehicle."),h(!1)}catch(k){console.log("error while getting gfAlertHistory",k),N.error(`Geofence ${k==null?void 0:k.message}`),h(!1)}}},O=async r=>{try{const c=await pe.post(`${Qe}/ccServer/location/updateNotifications`,{_id:r==null?void 0:r._id});L()}catch(c){console.log("error while getting gfAlertHistory",c),N.error(`Geofence ${c==null?void 0:c.message}`),h(!1)}},E=()=>{w(r=>r+10)};return e.jsxs(o,{sx:{padding:"15px",display:"flex",flexDirection:"column",gap:"15px",color:p.grey[400],backgroundColor:p.grey[100],height:"86vh",overflowY:"auto",scrollBehavior:"smooth"},ref:S,children:[j&&e.jsx(o,{style:{width:"100%",margin:"auto",display:"flex",justifyContent:"center"},children:e.jsx(ut,{style:{color:_.bgColor}})}),!j&&a.length===0&&e.jsx(D,{style:{width:"100%",margin:"auto",color:p.grey[400],textAlign:"center"},children:"No Alerts"}),!j&&a.length>0&&a.slice(0,v).map((r,c)=>{var l;return e.jsxs(o,{sx:{position:"relative"},onMouseEnter:()=>I(c),onMouseLeave:()=>I(null),children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",color:p.grey[400]},children:[e.jsx(D,{children:e.jsx("b",{children:r==null?void 0:r.type})}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:(l=r==null?void 0:r.createdAt)==null?void 0:l.slice(0,10)}),e.jsx("span",{style:{paddingLeft:"15px"},children:new Date(r==null?void 0:r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})]}),e.jsxs(o,{sx:{display:"flex",border:"1px solid #686868",padding:"5px",borderRadius:"5px",color:"#686868","&:hover":{background:_.bgShadow,color:"black"}},children:[e.jsx("img",{style:{width:"30px",height:"30px",borderRadius:"5px",marginRight:"15px",alignItems:"center",marginTop:"15px"},src:ft,alt:"logo"}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(D,{sx:{fontSize:"15px",width:"100%"},children:["Your Vehicle No."," ",Object.keys(t).length>0?t.reg_id:"XXX"]}),e.jsx(D,{children:r==null?void 0:r.msg})]})]}),x===c&&e.jsx(et,{onClick:()=>{O(r)},sx:{position:"absolute",top:"35%",left:"84.4%",transform:"translate(-50%, -50%)",fontWeight:"600",color:"black",cursor:"pointer"}})]},c)}),!j&&v<a.length&&e.jsx(o,{sx:{display:"flex",justifyContent:"center",marginTop:"15px"},children:e.jsx(F,{variant:"outlined",onClick:E,sx:{border:`1px solid ${_.bgShadow}`,color:p.grey[400],"&:hover":{background:_.bgColor,color:"white",border:`1px solid ${_.bgShadow}`}},children:"Load More"})})]})};var me={},Vt=fe;Object.defineProperty(me,"__esModule",{value:!0});var tt=me.default=void 0,qt=Vt(be()),Zt=e;tt=me.default=(0,qt.default)((0,Zt.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"Place");const Tt=({title:t,setShowContent:b,showContent:d,showMap:p,setShowMap:a,setShowGfBar:u,showGfBar:x,setShowGfAlert:I,showGfAlert:j})=>{const{collapsed:h}=y(l=>l.auth),{selectedVehicle:v,tractorIcon:w}=y(l=>l.liveMap),{vehicleSideBar:S}=y(l=>l.geofence),[A,L]=i.useState(!1),{mode:O}=y(l=>l.dashboard);JSON.parse(localStorage.getItem("w_userDetails"));const E=Y(),r=()=>{E(vt(!h))},c=()=>{b({...d,vehicle:!d.vehicle}),u(!1),I(!1),E(ge({data:!S}))};return e.jsxs(o,{display:"flex",justifyContent:"space-between",p:1,sx:{bgcolor:_.bgColor,border:"1px solid white",borderRadius:"4px",height:"65px"},children:[e.jsxs(o,{style:{display:"flex",justifyContent:"space-between",gap:"10px",alignItems:"center"},children:[h?e.jsx(F,{onClick:r,sx:{color:"white"},children:e.jsx(bt,{style:{width:"30px",height:"30px"}})}):e.jsx(F,{onClick:r,sx:{color:"white"},children:e.jsx(wt,{style:{width:"30px",height:"30px"}})}),e.jsx("img",{src:jt,alt:"wikitrak logo"})]}),e.jsx(o,{children:e.jsx(D,{variant:"h6",color:"white",fontWeight:"bold",sx:{ml:"15px",mt:"15px"},children:Object.keys(v).length>0&&p?`${t} - Geofence (${v.reg_id})`:e.jsxs(e.Fragment,{children:[t," ",Object.keys(v).length>0&&v.reg_id]})})}),e.jsxs(o,{sx:{display:"flex"},children:[e.jsxs(F,{variant:"outlined",size:"small",sx:{color:d.vehicle?"white":"black",backgroundColor:d.vehicle?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:c,children:[d.vehicle&&e.jsx(He,{style:{marginRight:"5px",fontWeight:"bold"}}),e.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",style:{marginRight:"5px"},children:e.jsx("path",{d:w.path1})}),Object.keys(v).length>0?v.reg_id:"Vehicles"]}),p&&e.jsx(o,{children:e.jsxs(F,{variant:"outlined",size:"small",sx:{color:x?"white":"black",backgroundColor:x?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:()=>{I(!1),u(!x),E(ge({data:!1}))},children:[x&&e.jsx(He,{style:{marginRight:"5px",fontWeight:"bold"}}),"Geofence"]})}),e.jsx(o,{sx:{color:"white",mr:"10px"},children:e.jsxs(o,{sx:{display:"flex",marginTop:"14px",gap:"10px"},children:[e.jsx(o,{onClick:()=>{u(!1),I(!j),E(ge({data:!1}))},children:e.jsx(xe,{title:"Notifications",children:e.jsx(mt,{sx:{cursor:"pointer",width:"30px",height:"30px"}})})}),e.jsx(o,{onClick:()=>{b({...d,user:!d.user}),a(!1)},children:d.user?e.jsx(xe,{title:"Geofence setting",children:e.jsx(tt,{sx:{mr:"2px",cursor:"pointer",width:"30px",height:"30px"}})}):e.jsx(xe,{title:"User setting",children:e.jsx($e,{sx:{mr:"2px",cursor:"pointer",width:"30px",height:"30px"}})})})]})}),e.jsx(ue,{onClick:()=>{E(yt(!O))},sx:{color:"white"}})]})]})},Qt=()=>{const t=Y(),b=Wt("(min-width:600px)"),[d,p]=i.useState(!1),[a,u]=i.useState(!1),{mode:x}=y(w=>w.dashboard),I=V(x),j={new_password:"",confirmPassword:""},h=Gt().shape({new_password:Te().required("Password is required").min(8,"Password must be at least 8 characters"),confirmPassword:Te().oneOf([zt("new_password"),null],"Passwords must match").required("Confirm password is required")}),v=w=>{console.log("values",w);let S=w.confirmPassword;t(St({new_password:S}))};return e.jsx(o,{sx:{display:"flex",justifyContent:"center"},children:e.jsxs(o,{sx:{width:"30%"},children:[e.jsx(o,{sx:{align:"center"},children:e.jsx(D,{variant:"h5",sx:{mt:"25px",my:"",fontWeight:"bold",align:"center",color:I.grey[400]},children:"Change Password"})}),e.jsx(Mt,{onSubmit:v,initialValues:j,validationSchema:h,children:({values:w,errors:S,touched:A,handleBlur:L,handleChange:O,handleSubmit:E})=>e.jsxs("form",{onSubmit:E,children:[e.jsxs(o,{display:"grid",gap:"15px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:b?void 0:"span 4"}},marginTop:"20px",children:[e.jsx(Ke,{fullWidth:!0,variant:"outlined",type:d?"text":"password",label:"New Password",onBlur:L,onChange:O,value:w.new_password,name:"new_password",error:!!A.new_password&&!!S.new_password,helperText:A.new_password&&S.new_password,sx:{gridColumn:"span 4",backgroundColor:"white",borderRadius:"5px"},InputProps:{endAdornment:e.jsx(Ye,{position:"end",children:e.jsx(ue,{"aria-label":"toggle password visibility",onClick:()=>p(!d),edge:"end",children:d?e.jsx(qe,{}):e.jsx(Ze,{})})})}}),e.jsx(Ke,{fullWidth:!0,variant:"outlined",type:a?"text":"password",label:"Confirm Password",onBlur:L,onChange:O,value:w.confirmPassword,name:"confirmPassword",error:!!A.confirmPassword&&!!S.confirmPassword,helperText:A.confirmPassword&&S.confirmPassword,sx:{gridColumn:"span 4",backgroundColor:"white",borderRadius:"5px"},InputProps:{endAdornment:e.jsx(Ye,{position:"end",children:e.jsx(ue,{"aria-label":"toggle password visibility",onClick:()=>u(!a),edge:"end",children:a?e.jsx(qe,{}):e.jsx(Ze,{})})})}})]}),e.jsx(o,{sx:{my:"29px"},children:e.jsx(F,{type:"submit",sx:{background:_.bgColor,width:"100%",p:"10px","&:hover":{background:_.bgShadow,color:I.grey[100]}},variant:"contained",children:"submit"})})]})})]})})};let $t="https://admin.wikitrak.in";const es=()=>{var a,u;const t=JSON.parse(localStorage.getItem("w_userDetails")),{mode:b}=y(x=>x.dashboard),d=V(b),p=()=>{window.open($t,"_blank")};return e.jsxs(o,{children:[e.jsxs(o,{sx:{backgroundColor:d.grey[200],m:"10px",borderRadius:"5px",height:"150px"},children:[e.jsx(o,{sx:{pl:"20px",pt:"10px",mb:"10px",color:`${d.grey[400]}`},children:e.jsx("b",{children:"User Settings"})}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderRadius:"8px",boxShadow:"0px 4px 10px rgba(0, 0, 0, 0.1)"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(o,{sx:{ml:"23px",mt:"11px",height:"70px",width:"70px",backgroundColor:"white",borderRadius:"50%",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"}}),e.jsxs(o,{sx:{height:"80px",width:"200px",display:"flex",justifyContent:"center",flexDirection:"column",ml:3,color:d.grey[400]},children:[e.jsx(o,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:t&&e.jsxs(e.Fragment,{children:[t.first_name.charAt(0).toUpperCase()+t.first_name.slice(1).toLowerCase()," ",t.last_name.charAt(0).toUpperCase()+t.last_name.slice(1).toLowerCase()]})}),e.jsx(o,{children:t&&(t==null?void 0:t.role1)})]})]}),t&&Array.isArray(t==null?void 0:t.feature_access)&&((u=(a=t==null?void 0:t.feature_access[0])==null?void 0:a.feature_access)==null?void 0:u.some(x=>x.name==="Admin"))&&e.jsx(o,{children:e.jsx(F,{variant:"contained",sx:{backgroundColor:"white",color:d.grey[300],textTransform:"none",fontWeight:"bold","&:hover":{backgroundColor:"black",color:"white"}},onClick:p,children:"Go to admin page"})})]})]}),e.jsx(o,{sx:{marginTop:"9%",alignContent:"center",textAlign:"center"},children:e.jsx(Qt,{})})]})},M="/assets/mixer-BYFIcLbw.png",ts="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAABuCAYAAADGWyb7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAizSURBVHgB7Z0xbxNJFMfH6AQNSBHQQBOnABoQSFDRJBU0oDuJjga+wX2Ey1e4bwAVFegQVDQXGmgAIUEDFHEaaICLBA00uf05fj5fsL1vPLO776H5SZtdJ3Zs73/emzdv3s72Qg07OzvL1W6t2voT29JoC3uOC3oGo/32xPZStl6vtzXvxb1pv6zEQojfq+1m2BWq0D6Daluvto1pIv4gXCXar9XuVihWZIVBta1X4t2e/OW+yQeVaH9Uu79CEc0S/Wq7NdJmzNjiqj/cCLuWVrDLb5Xl3edgKFwlWr/a/R1Kf2YdApiVSrxtcZWroYjmAQkaxxa3GYpwXhhUFrfSG7nJzVDwRB9XeTYUvLGGcOdCwRv9IpxPhsKVwbY/inBOWSrC+WTpl/AT8OXLl7C1tRU+fvwYPnz4EL5//x6+ffs2/NuBAwfCwYMHw6FDh8Lx48fD8vLy8Ng7jON2gkMQ5t27d2EwGIT3799HvfbIkSPhzJkz4eTJk8Ep2y6Fe/v2bXj69OnYqhYFyzt//rxLAV0Jh0t8/PhxtIXVgXAI6MmFuhEO0R4+fDjcNwGiXblyxY14LoT79OnTULRU11jH/v37w9WrV4d9oHX2BeNgYY8ePWpcNCAa5b2asuqcmBeuSfc4jTYbSgqmhXv27FknrR/X/OLFi2AZswNwBIs9efRRRIhHjx4dDroB9ydjva9fv6r/16tXr8Lp06fNBitmg5ONjY3heE0DghHOM6iex5s3b8Lz58/VAvb7/XDp0qVgEZMWh7VpRcOyiAQ1lnHq1Klh2uvBgwcq8bBU+jrSZtYw2cdxwjTEiCbwXF4jrrSO169fB4u4Fi5WNIHXrK2tqZ5L0toi5oTDNWlOFkFISuCAyzx27Fjt8whqLA4NzAlHKK6B/ioVAhoNMdFoW5gTjvBdg8Za6sDqiEjr0DamNjEnnGbAnTOXqIkYi6tUoLG4nOG5JrrUeoE2MSecJuDImQbTiGIxe2JOOE2fg+vK5b40/VcRToGm/8JKPn/+HFLRzqQfPnw4WMOkq9S0cHKOqWjSajSkkvJSoh0Yp2Q1yM5ohMsx7GgCk8IxvtLADMIigQqvoUpMw8rKSrCISeEoWtUEKYsUEMW8hqFCsbgI6FO0g2wEuHPnzrDPmycGUSjPuXfvnlporeV3gdmJVPowLCMGBMdCOOFYC9EnG6XplKjHDiGuXbtmtuLLbOkCJwx3GZO1QBiCDu200DwQ3nKZntliIayny9Jw7cxBV5iu8qLmoyss929gWjjtZGduUidp28B8QWwXVpdjkrZpzAtH69eM6XJheew2iXnhCFIoTG0L60GJYF44aMt1YW0e3CS4EI5AoQ33ZT2SnMSFcNCGC/PiJsGNcFhDk5kMoldPlxK7EQ6azKTUXTBiDXfCNTE08DIEmMSVcE0NDTz1bYIr4SC3S8PausyJLoo74WTOLRcEPRaLgepwJxzkdG0e3SS4FC7XrAH/x+uCbC6Fgxz90okTJ4JX3AqXOjTwlJechlvhUksbPOUlp+FWOEhxl16DEsG1cIsGKZ6DEsG1cLCI1XkOSgT3wsUGKTzXc1AidF4QK8tjsLKBLIaNG1tdXVW5MylX1165E2OhlKrLElIILlNLXC/Xdbal9RJ0hJIVy9nPquPnRFECrhEvplydRW00/WLdxSEIyEZDYN92n9mKxS2yYjml56xgd/HixdrnasvVY6ZveO95F4dwCTKbXGOHNeK2+f9tiNiocLgvXM2ii19rrxvAbdHy6y5UjBm7xa60wHeU7ykiNjnx24hwnMC6y540xIT6nKQ64WKCEt5bu4LfXkREzkFTy+NnFQ7XwZWeOZaX58vGnGiNu4xpCLw33ydl9TwaLlfNImDuFdazBSf0CdrLc6fBiefEsrqrdPyxsA7lrOgS98XJi4VGKP2ZbIuC9eXK2GSxONZOjl2GF5HkIsRcKxvQz80SjsuTF4HPN9k3EmghHu8Tu4CArBSRQ7xk4bA0rWgIhQviJDYxDppnpVhyDvjcIiYC4A4RkP5QIyLi4dJTSzCShNOsXsCHpMCHD9r0oHVeP9dUFRf9Fo2RjfNBQ2bYM2+pRM5Zah1nknB1i8QgGK2yrSwD78PJ2NsPtXVJMO/NuJNGysLd8zyRdow6i6Rc5ayOmlZPIMAHazs1NE2ktrMavN+FCxeGmZ9ZeVSyRik0IhzrHXc1UTlNpK4uwud9Zy1/nzrGTRJuVmvqcgHqaZ+pzQsj95L7lmlCUh83KyuP/5abOLTNtEuyurK4J0+ezBzAp3qkpAF43fjN8x0RU6AxI9q8wTrTVinzgknCMRi9e/du7SrhImBT4zcLxMyAMEtx/fr1kEJyyotWRapJu5Yy4jGGwZ15F1EmgRFLu+RUrpsLZslVxog3iRT7sLcwq1wHwrAyraS6YgOPnHeEzJZkJrzV3mxoFjKTLElmjnErbQuKQHwPGiTfiw2hUkJ4vsfly5ezBUrZSxcWSTjXITdhn7wZO7CnFU8Ky+Np4f9kgxIB5EbvPOaYPc/LeZ+BplJ+jdScSJHNohORPwNN52gbLRaSzDljGYu3OWkCma5qOqneWpUXIspaklZv7bUoIhbjsrbyop2sECthtERn3qxRZuslKu4iGka4f6r9UugYKRHAMtkTJHR9P26JcAmIpKSiiyh3Ggi3We37wSiIKOE5QnIsESBMixZnMenGRACJQmUuj+MuClwjGZhdk1mwvC5ylzCtsx0K3tguwvlkKNwgFLxRhHPKS4RLq1opdMFLhgP96mAzFDzR39fr9QahuEtPDCrNtqTK61YoeGGdHz1+VO6SlBfusvPUV2Eug2pbG1tcdcBY7mYoWGcd0TgYF8RWv7gfRmZYMAmi3ZYHvb1/rdzmjbArYD8ULDD0hiPDGtOb9szREGE1FAG7ZBB2g8Y/R13Z/+jVvXok4rlqOzvaL01s0A+FWLbDfzliOR6MNvqwjdEwbSb/AmA6VQ6UiC1pAAAAAElFTkSuQmCC";function ss({shapeType:t,setShapeType:b}){const d=p=>{console.log("selectedType",p),b(p)};return e.jsxs(o,{children:[e.jsx(F,{onClick:()=>{d("circular")},style:{background:t==="circular"?_.bgColor:"transparent",color:t==="circular"?"white":oe[400],margin:"0 5px"},children:"Circle"}),e.jsx(F,{onClick:()=>{d("polygon")},style:{background:t==="polygon"?_.bgColor:"transparent",color:t==="polygon"?"white":oe[400],margin:"0 5px"},children:"Polygon"})]})}function os({shapeType:t,center:b,radius:d,active:p,setActive:a,setInward:u,inward:x,setSpeedLimit:I,speedLimit:j,setSpeedValue:h,handleGeofence:v,speedValue:w,setRadius:S}){var E,r;const{selectedVehicle:A,locationData:L,tractorIcon:O}=y(c=>c.liveMap);return e.jsxs(o,{sx:{display:"flex",padding:"15px",flexDirection:"column",gap:"10px",color:oe[600]},children:[e.jsx(D,{sx:{fontWeight:"bold",fontSize:"16px"},children:"Geofence Setting"}),e.jsxs(D,{sx:{fontWeight:"400",fontSize:"14px",textTransform:"capitalize"},children:["Type: ",t]}),t==="circular"&&e.jsxs(e.Fragment,{children:[e.jsx(D,{sx:{color:"#686868"},children:"Centered At "}),e.jsxs(D,{sx:{color:"#686868"},children:["Lat: ",(E=b==null?void 0:b.lat)==null?void 0:E.toFixed(2)]}),e.jsxs(D,{sx:{color:"#686868"},children:["Lng: ",(r=b==null?void 0:b.lng)==null?void 0:r.toFixed(2)]}),e.jsxs(D,{sx:{color:"#686868",border:"1px solid #686868",borderRadius:"4px",padding:"8px"},children:["Radius ( ",(d/1e3).toFixed(2)," in km) ",e.jsx("input",{type:"text",value:d/1e3,onChange:c=>{S(c.target.value*1e3)},placeholder:"enter radius"})," in KM"]})]}),e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(D,{variant:"body1",component:"b",children:p?"Active":"Inactive"}),e.jsx(he,{defaultChecked:p,onChange:()=>{a(!p)},color:"primary",inputProps:{"aria-label":"toggle active state"}})]}),e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(D,{variant:"body1",component:"b",children:x?"Inward":"Outward"}),e.jsx(he,{checked:x,onChange:()=>{u(!x)},color:"primary",inputProps:{"aria-label":"toggle direction"}})]}),e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(he,{checked:j,onChange:()=>{I(!j)},color:"primary",inputProps:{"aria-label":"toggle direction"}}),e.jsx(D,{variant:"body1",component:"b",children:"Speed Limit"})]}),j&&e.jsx(o,{sx:{},children:e.jsx(At,{sx:{width:"100%",color:oe[600],border:"none","&:focus":{outline:"none"}},value:w,placeholder:"Enter Speed Limit",type:"number",onChange:c=>{const l=Math.max(0,parseInt(c.target.value));h(l)}})}),e.jsx(F,{disabled:Object.keys(A).length===0&&!1,variant:"outlined",size:"small",sx:{color:"white",backgroundColor:_.bgColor,mt:"6px",mx:"5px",border:"1px solid white",height:"40px",width:"100%","&:hover":{color:"black",background:_.bgShadow,border:"1px solid black"},letterSpacing:"1.5px",fontSize:"16px"},onClick:()=>{if(Object.keys(A).length===0)return N.error("please select a vehicle.");v()},children:"SUBMIT"})]})}const as="https://cc.wikitrak.in/proxy-3031",rs="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA",ns=({showGfBar:t,showGfAlert:b})=>{const{isLoaded:d,loadError:p}=Ct({googleMapsApiKey:`${rs}`}),{selectedVehicle:a,locationData:u,tractorIcon:x}=y(n=>n.liveMap),{geofence:I,vehicleSideBar:j}=y(n=>n.geofence),{mode:h,styles:v,vehicles_details:w}=y(n=>n.dashboard),{collapsed:S}=y(n=>n.auth),[A,L]=i.useState(null),[O,E]=i.useState(null),[r,c]=i.useState(1e3),[l,R]=i.useState([]),[k,q]=i.useState(!0),[Z,g]=i.useState(!1),[G,X]=i.useState(!1),[C,U]=i.useState({lat:18.516726,lng:73.856255}),[ae,re]=i.useState(50),[P,ne]=i.useState("circular"),[ye,J]=i.useState([{lat:C.lat+.01,lng:C.lng},{lat:C.lat-.01,lng:C.lng-.01},{lat:C.lat-.01,lng:C.lng+.01}]),[le,ie]=i.useState(!1),st=i.useRef(null),ce=i.useRef(!1),T=i.useRef(null);let ot=Y();i.useEffect(()=>{at()},[a]),i.useEffect(()=>{le&&J([{lat:C.lat+.01,lng:C.lng},{lat:C.lat-.01,lng:C.lng-.01},{lat:C.lat-.01,lng:C.lng+.01}])},[le]),i.useEffect(()=>{var n,f,m,z,W,Q,$,ee;if(u.length>0&&Object.keys(a).length>0){let B=u==null?void 0:u.filter(se=>{var te;return((te=se.latestDocument)==null?void 0:te.imei)===a.imei});R(B),U({lat:(f=(n=B[0])==null?void 0:n.latestDocument)==null?void 0:f.lat,lng:(z=(m=B[0])==null?void 0:m.latestDocument)==null?void 0:z.lng});let H=(Q=(W=B[0])==null?void 0:W.latestDocument)==null?void 0:Q.lat,K=(ee=($=B[0])==null?void 0:$.latestDocument)==null?void 0:ee.lng;le&&J([{lat:H+.01,lng:K},{lat:H-.01,lng:K-.01},{lat:H-.01,lng:K+.01}])}},[a,u,P]),i.useEffect(()=>{A&&O&&A.fitBounds(O)},[A,O]);const at=async()=>{var n,f,m,z,W,Q,$,ee,B,H,K,se,te,Se,Ae,Ce,ke,Re,De,Ie,Oe,Ee,Le,_e,Pe,Ne,Fe,Me,Ge,ze,We,Be,Xe,Ue,Je;if(Object.keys(a).length>0)try{const s=await pe.get(`${as}/api/get/geofance/${a==null?void 0:a.imei}`);if(console.log(s.data.geofenceData,"result"),((f=(n=s==null?void 0:s.data)==null?void 0:n.geofenceData)==null?void 0:f.area_type)==="circular")if(ne("circular"),ie(!0),(z=(m=s==null?void 0:s.data)==null?void 0:m.geofenceData)!=null&&z.lat)U({lat:(Q=(W=s==null?void 0:s.data)==null?void 0:W.geofenceData)==null?void 0:Q.lat,lng:(ee=($=s==null?void 0:s.data)==null?void 0:$.geofenceData)==null?void 0:ee.long}),c((H=(B=s==null?void 0:s.data)==null?void 0:B.geofenceData)==null?void 0:H.radius),q((se=(K=s==null?void 0:s.data)==null?void 0:K.geofenceData)==null?void 0:se.isActive_Geofance),g(((Se=(te=s==null?void 0:s.data)==null?void 0:te.geofenceData)==null?void 0:Se.type)==="inward"),X((Ce=(Ae=s==null?void 0:s.data)==null?void 0:Ae.geofenceData)==null?void 0:Ce.isActive_Speed),re((Re=(ke=s==null?void 0:s.data)==null?void 0:ke.geofenceData)==null?void 0:Re.speed);else return N.success("No Geofence For Selected Vehicle",{id:"getting geofence"});else((Ie=(De=s==null?void 0:s.data)==null?void 0:De.geofenceData)==null?void 0:Ie.area_type)==="polygon"&&(ie(!1),ne("polygon"),console.log("get for polygon",(Oe=s==null?void 0:s.data)==null?void 0:Oe.geofenceData),J((Le=(Ee=s==null?void 0:s.data)==null?void 0:Ee.geofenceData)==null?void 0:Le.polygon_points),re((Pe=(_e=s==null?void 0:s.data)==null?void 0:_e.geofenceData)==null?void 0:Pe.speed),q((Fe=(Ne=s==null?void 0:s.data)==null?void 0:Ne.geofenceData)==null?void 0:Fe.isActive_Geofance),g(((Ge=(Me=s==null?void 0:s.data)==null?void 0:Me.geofenceData)==null?void 0:Ge.type)==="inward"),U({lat:(We=(ze=s==null?void 0:s.data)==null?void 0:ze.geofenceData)==null?void 0:We.lat,lng:(Xe=(Be=s==null?void 0:s.data)==null?void 0:Be.geofenceData)==null?void 0:Xe.long}),X((Je=(Ue=s==null?void 0:s.data)==null?void 0:Ue.geofenceData)==null?void 0:Je.isActive_Speed))}catch(s){ie(!0),console.log("vehicleDetail",l),console.log(s,"error while getting geofence"),N.error("No geofence has been set for this vehicle.",{id:"getting geofence"})}},rt=n=>{L(n)},nt=()=>{if(Object.keys(a).length>0){let n;P==="circular"?n={imei:a.imei,area_type:P,type:Z?"inward":"outward",lat:C.lat,long:C.lng,radius:r,isActive_Geofance:k,isActive_Speed:!!G,speed:G?ae:5}:P==="polygon"&&(n={imei:a.imei,area_type:P,type:Z?"inward":"outward",polygon_points:ye,isActive_Geofance:k,isActive_Speed:!!G,speed:G?ae:50}),ot(Ot({data:n})),N.success("Successful Saved",{id:"geofence"})}else N.error("Please Select Vehicle",{id:"geofence"})},lt=()=>{if(!ce.current){ce.current=!0;const n=de.getRadius();console.log("newRadius",n),c(n),ce.current=!1}},it=n=>{console.log("New Center:",n.toJSON()),U(n.toJSON())},ct=()=>{if(T.current&&T.current.getPath){const f=T.current.getPath().getArray().map(m=>({lat:m.lat(),lng:m.lng()}));J(f),console.log("newVertices",f)}},dt=n=>{T.current=n},gt=n=>{const f=w&&(w==null?void 0:w.length)>0&&w.find(m=>String(m==null?void 0:m.value)===String(n)&&(m==null?void 0:m.vehilce_type));return console.log("vehicle: ",f),f?f.vehilce_type:null},ve={paths:ye,options:{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,editable:!0}};if(p)return"Error loading maps";if(!d)return"Loading maps";const xt={width:"100%",height:"86.8vh"};let de;const ht=n=>{const f={lat:n.latLng.lat(),lng:n.latLng.lng()};if(P!=="circular"){let m=[{lat:f.lat+.01,lng:f.lng},{lat:f.lat-.01,lng:f.lng-.01},{lat:f.lat-.01,lng:f.lng+.01}];J(m),U(f)}else U(f)},pt=()=>{var f,m,z;let n=(z=(m=(f=T.current)==null?void 0:f.getPath())==null?void 0:m.getArray())==null?void 0:z.map(W=>({lat:W.lat(),lng:W.lng()}));J(n)};return e.jsxs(e.Fragment,{children:[e.jsx(ss,{setShapeType:ne,shapeType:P}),e.jsxs(o,{sx:{display:"flex",flexDirection:"row"},children:[e.jsxs(kt,{ref:st,mapContainerStyle:xt,zoom:15,center:C,onClick:ht,onLoad:rt,options:{mapTypeControl:!1,styles:h?v:""},children:[P==="circular"&&e.jsx(Rt,{center:C,radius:r,options:{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,editable:!0},onLoad:n=>{de=n,de.addListener("radius_changed",lt)},onDragEnd:n=>it(n.latLng)}),P==="polygon"&&e.jsx(Dt,{paths:ve.paths,options:ve.options,draggable:!0,editable:!0,onDragEnd:ct,onLoad:dt,onMouseUp:n=>pt()}),l&&l.length>0&&l.map((n,f)=>{const m=gt(n.latestDocument.imei);return e.jsx(It,{position:{lat:n.latestDocument.lat,lng:n.latestDocument.lng},icon:{url:(()=>{switch(m){case"2W":return M;case"3W":return M;case"4W":return M;case"Tractor":return M;default:return M}})(),fillColor:"red",fillOpacity:2,strokeWeight:1,size:new window.google.maps.Size(45,45),scaledSize:new window.google.maps.Size(45,45),scale:2}},f)})]}),t&&!b&&!j&&C&&e.jsx(o,{sx:{width:S?"25%":"20%"},children:e.jsx(os,{shapeType:P,center:C,radius:r,active:k,setActive:q,setInward:g,inward:Z,setSpeedLimit:X,speedLimit:G,setSpeedValue:re,handleGeofence:nt,speedValue:ae,setRadius:c})})]})]})},ls=({findTypeVehicle:t,statusVehicle:b})=>{var x,I,j;const{selectedVehicle:d}=y(h=>h.liveMap),{mode:p}=y(h=>h.dashboard),a=V(p),u=[{label:"Reg Number",value:(d==null?void 0:d.reg_id)||"NA"},{label:"IMEI Number",value:(d==null?void 0:d.imei)||"NA"},{label:"Chassis Number",value:(t==null?void 0:t.chassis_no)||"NA"},{label:"Engine Number",value:(t==null?void 0:t.engine_no)||"NA"},{label:"Date of Sell",value:(t==null?void 0:t.sell_date)||"NA"},{label:"Workshop Name",value:((x=t==null?void 0:t.workshop)==null?void 0:x.name)+`(City:${(j=(I=t==null?void 0:t.workshop)==null?void 0:I.city)==null?void 0:j.name})`||"NA"},{label:"Customer Name",value:(t==null?void 0:t.customer_name)||"NA"},{label:"Status",value:t!=null&&t.status?"On":"Off"}];return e.jsx(o,{sx:{padding:"20px"},children:e.jsx(Ve,{container:!0,spacing:2,children:u.map((h,v)=>e.jsx(Ve,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(o,{sx:{padding:"20px",borderRadius:"8px",boxShadow:"rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px",textAlign:"center"},children:[e.jsx(D,{sx:{fontWeight:"bold",color:a.grey[600]},children:h.label}),e.jsx(D,{sx:{color:a.grey[300]},children:Object.keys(d).length>0?h.value:"Please select vehicle"})]})},v))})})},is=({showMap:t,setShowMap:b,showGfBar:d,showGfAlert:p})=>{const{selectedVehicle:a,onlineVehicle:u,vehicleList:x}=y(c=>c.liveMap),{mode:I,vehicles_details:j}=y(c=>c.dashboard),h=V(I),[v,w]=i.useState(!1),[S,A]=i.useState();let L=Y();i.useEffect(()=>{console.log("onlineVehicle",u),console.log("selectedVehicle",a);let c=u.find(l=>l==a.imei);console.log("isActive",c),c?w(!0):(w(!1),console.log("Vehicle is not active"))},[u,a]),i.useEffect(()=>{if(L(Et({})),Object.keys(a).length>0){let c=E(a==null?void 0:a.imei);console.log("result11",c),A(c)}},[a]),i.useEffect(()=>{},[x]);const O=c=>{const l=j&&(j==null?void 0:j.length)>0&&j.find(R=>(R==null?void 0:R.value)===c&&(R==null?void 0:R.vehilce_type));return l?l.vehilce_type:null},E=c=>{console.log("vehicle list",x);const l=x&&(x==null?void 0:x.length)>0&&x.find(R=>(R==null?void 0:R.imei[0].mac_id)===c&&R);return l||null},r=Object.keys(a).length>0?O(a.imei):null;return`${h.grey[300]}`,h.grey[300],e.jsx(e.Fragment,{children:t?e.jsx(ns,{showGfBar:d,showGfAlert:p}):e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",background:h.grey[200],margin:"10px",padding:"10px",borderRadius:"8px"},children:[e.jsxs(o,{sx:{},children:[e.jsx(D,{sx:{fontWeight:"bold",fontSize:"16px",margin:"4px",color:h.grey[400]},children:"Vehicle Settings"}),e.jsx(o,{sx:{display:"flex"},children:e.jsx(o,{sx:{border:"2px solid white",padding:"10px",borderRadius:"5px",background:"white",marginRight:"5px"},children:e.jsx("img",{src:(()=>{switch(r){case"2W":return M;case"3W":return M;case"4W":return M;default:return M}})(),alt:"vehicleIcon",style:{width:"80px",height:"70px",borderRadius:"5px",marginRight:"20px"}})})})]}),e.jsxs(o,{onClick:()=>{b(!t)},sx:{cursor:"pointer",marginTop:"50px"},children:[e.jsx("img",{src:ts,alt:"tractorIcon",style:{width:"80px",height:"75px",borderRadius:"5px",marginRight:"20px"}}),e.jsx(D,{sx:{fontSize:"12px",color:h.grey[400]},children:"Set Geofence"})]})]}),e.jsx(ls,{findTypeVehicle:S,statusVehicle:v})]})})};function fs(){const{w_customer_id:t}=y(l=>l.auth),{vehicleSideBar:b}=y(l=>l.geofence),{collapsed:d}=y(l=>l.auth),{mode:p}=y(l=>l.dashboard),a=V(p),[u,x]=i.useState([]),[I,j]=i.useState([]),[h,v]=i.useState({user:!0,vehicle:!1}),[w,S]=i.useState(!1),[A,L]=i.useState(!1),[O,E]=i.useState(!1);let r=Y();i.useEffect(()=>{c()},[]);const c=async()=>{try{let l=[],R=[];const k=await r(Lt({w_customer_id:t}));if(k.payload&&Array.isArray(k.payload)){k.payload.forEach(g=>{var G,X,C;g.imei&&Array.isArray(g.imei)&&g.imei.length>0&&((G=g.imei[0])!=null&&G.mac_id)?(l.push({id:g.id,label:g.registration_id,value:(X=g.imei[0])==null?void 0:X.mac_id,vehilce_type:g==null?void 0:g.segment,chassis_no:g==null?void 0:g.chassis_no,engine_no:g==null?void 0:g.engine_no,workShop:g==null?void 0:g.workshop,registration_id:g==null?void 0:g.registration_id,sell_date:g==null?void 0:g.sell_date}),R.push((C=g.imei[0])==null?void 0:C.mac_id)):console.error("IMEI data not found for item:",g)});const q="one",Z=R;R.length>0&&r(_t({type:q,imei:Z})),x(l),r(Pt(l))}else console.error("Unexpected data format or empty payload:",k),N.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),N.error(`Error fetching vehicle data: ${l}`)}};return e.jsxs("div",{className:"app",children:[e.jsx(Nt,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:a.grey[100]},children:[e.jsx(Tt,{title:"Settings",setShowContent:v,showContent:h,showMap:w,setShowMap:S,showGfBar:A,setShowGfBar:L,showGfAlert:O,setShowGfAlert:E}),e.jsxs(o,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(o,{style:{width:b?"80%":"100%",border:`1px solid ${a.grey[800]}`,borderRadius:"2px"},children:h.user?e.jsx(es,{}):e.jsx(is,{showMap:w,setShowMap:S,showGfBar:A,showGfAlert:O})}),!O&&!A&&b&&e.jsx(o,{style:{width:"20%"},children:e.jsx(Ft,{vehicleData:u,title:"Setting"})}),O&&!A&&!b&&e.jsx(o,{sx:{width:d?"25%":"20%"},children:e.jsx(Yt,{})})]})]})]})}export{fs as default};
