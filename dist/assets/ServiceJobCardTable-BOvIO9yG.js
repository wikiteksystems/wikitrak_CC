import{p as O,o as ee,r as n,dO as se,dV as ae,U as i,dP as te,j as a,B as I,K as ne,bE as ce,aP as de,cq as ie,cr as le,cs as ue,ct as J,cu as t,cv as re,m as _e,dC as be}from"./index-D6bA2BTr.js";import{a as pe}from"./ServiceRecordTable-DViQHnjq.js";import{T as he,d as oe}from"./excelUtils-uqvKIJQ7.js";import{T as ve,E as xe}from"./Edit-CAnvdfSt.js";const L=[{id:"service_record_id",label:"SRID"},{id:"registration_id",label:"Vehicle No"},{id:"service_type",label:"Service Type"},{id:"submission_date",label:"Submission Date"},{id:"submission_time",label:"Submission Time"},{id:"completion_date",label:"Completion date"},{id:"submitted_by",label:"Created By"},{id:"reviewed_by",label:"Reviewed By"},{id:"service_status",label:"Approval status"},{id:"status",label:"Status"}],fe=({isInspection:A})=>{const{breakdowns:ye,breakdownJobCardList:ge,serviceJobCardList:j}=O(e=>e.breakdown),{searchTerm:T}=O(e=>e.inspection),S=ee(),[P,V]=n.useState("asc"),[C,U]=n.useState("BDID"),[D,$]=n.useState(0),[f,q]=n.useState(8),[F,R]=n.useState(!1),[W,z]=n.useState(null),[B,K]=n.useState("service_record_id");n.useState({id:"",status:"",workshop:"",user:""}),n.useEffect(()=>{S(se({}))},[]),n.useEffect(()=>{S(ae({job_card_type:"ServiceRecord",isInspection:A}))},[]);const Q=e=>{V(C===e&&P==="asc"?"desc":"asc"),U(e)},G=(e,c)=>{$(c)},X=e=>{q(parseInt(e.target.value,10)),$(0)},y=((e,c,l)=>!c||!l?e:e.filter(s=>(()=>{var u,r,_,b,p,h,o,d,Y,x,M,m,E,N;switch(c){case"service_record_id":return(((u=s==null?void 0:s.service)==null?void 0:u.service_record_id)||"").toString();case"registration_id":return((r=s==null?void 0:s.vehicle)==null?void 0:r.registration_id)||"";case"service_type":return(s==null?void 0:s.service_type)||"";case"user_name":return`${((b=(_=s==null?void 0:s.user)==null?void 0:_.us_user)==null?void 0:b.first_name)||""} ${((h=(p=s==null?void 0:s.user)==null?void 0:p.us_user)==null?void 0:h.last_name)||""}`;case"submission_date":return s!=null&&s.submission_date?i(s.submission_date).format("YYYY-MM-DD"):"";case"submission_time":return s!=null&&s.submission_date?i(s.submission_date).format("HH:mm A"):"";case"completion_date":return s!=null&&s.completion_date?i(s.completion_date).format("YYYY-MM-DD"):"";case"submitted_by":return`${((d=(o=s==null?void 0:s.submitted_by)==null?void 0:o.us_user)==null?void 0:d.first_name)||""} ${((x=(Y=s==null?void 0:s.submitted_by)==null?void 0:Y.us_user)==null?void 0:x.last_name)||""}`;case"reviewed_by":return`${((m=(M=s==null?void 0:s.reviewed_by)==null?void 0:M.us_user)==null?void 0:m.first_name)||""} ${((N=(E=s==null?void 0:s.reviewed_by)==null?void 0:E.us_user)==null?void 0:N.last_name)||""}`||"";case"service_status":return(s==null?void 0:s.service_status)||"";case"status":return(s==null?void 0:s.status)||"";default:return""}})().toLowerCase().includes(l.toLowerCase())))((j==null?void 0:j.slice())||[],B,T),Z=y.slice(D*f,D*f+f),H={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},w=y&&y.map(e=>{var l,s,v,u,r,_,b,p,h,o;const c=e!=null&&e.jobcard_parts&&(e==null?void 0:e.jobcard_parts.length)>0?e==null?void 0:e.jobcard_parts.map((d,Y)=>{var x;return`${(x=d==null?void 0:d.spare_parts)==null?void 0:x.description}: Qty ${d==null?void 0:d.quantity}`}).join(";"):"N/A";return{SRID:((l=e==null?void 0:e.service)==null?void 0:l.service_record_id)||"","Vehicle No":((s=e==null?void 0:e.vehicle)==null?void 0:s.registration_id)||"","Service Type":(e==null?void 0:e.service_type)||"","Submission Date":e!=null&&e.submission_date?i(e.submission_date).format("YYYY-MM-DD"):"","Submission Time":e!=null&&e.submission_date?i(e.submission_date).format("HH:mm A"):"","Completion date":e!=null&&e.completion_date?i(e.completion_date).format("YYYY-MM-DD HH:mm A"):"","Created By":`${((u=(v=e==null?void 0:e.submitted_by)==null?void 0:v.us_user)==null?void 0:u.first_name)||""} ${((_=(r=e==null?void 0:e.submitted_by)==null?void 0:r.us_user)==null?void 0:_.last_name)||""}`,"Reviewed By":`${((p=(b=e==null?void 0:e.reviewed_by)==null?void 0:b.us_user)==null?void 0:p.first_name)||""} ${((o=(h=e==null?void 0:e.reviewed_by)==null?void 0:h.us_user)==null?void 0:o.last_name)||""}`,"Approval status":(e==null?void 0:e.service_status)||"",Status:(e==null?void 0:e.status)||"","Spare parts":c}});let g=te("Job Card");const k=(g==null?void 0:g.includes("Update"))||g==="Read-Write-Only";return a.jsxs(I,{sx:{m:"10px"},children:[a.jsxs(I,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsx(he,{columns:L,selectedColumn:B,onColumnChange:K,searchTerm:T,onSearchChange:e=>S(ne(e))}),a.jsx(ce,{variant:"contained",color:"success",onClick:()=>oe(w,"service-job-card.xlsx"),children:"Download Excel"})]}),a.jsxs(de,{children:[a.jsx(ie,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:a.jsxs(le,{stickyHeader:!0,children:[a.jsx(ue,{children:a.jsxs(J,{children:[L.map(e=>a.jsx(t,{sx:H,children:a.jsx(ve,{active:C===e.id,direction:C===e.id?P:"asc",onClick:()=>Q(e.id),children:e.label})},e.id)),k&&a.jsx(t,{sx:H,children:"Action"}),"              "]})}),a.jsx(re,{children:Z.map((e,c)=>{var l,s,v,u,r,_,b,p,h,o;return a.jsxs(J,{children:[a.jsx(t,{children:(l=e==null?void 0:e.service)==null?void 0:l.service_record_id}),a.jsx(t,{children:(s=e==null?void 0:e.vehicle)==null?void 0:s.registration_id}),a.jsx(t,{children:e==null?void 0:e.service_type}),a.jsx(t,{children:(e==null?void 0:e.submission_date)&&i(e.submission_date).format("YYYY-MM-DD")||"N/A"}),a.jsx(t,{children:(e==null?void 0:e.submission_date)&&i(e.submission_date).format("HH:mm A")||"N/A"}),a.jsx(t,{children:(e==null?void 0:e.completion_date)&&i(e.completion_date).format("YYYY-MM-DD HH:mm A")||"N/A"}),a.jsx(t,{children:`${(u=(v=e==null?void 0:e.submitted_by)==null?void 0:v.us_user)==null?void 0:u.first_name} ${(_=(r=e==null?void 0:e.submitted_by)==null?void 0:r.us_user)==null?void 0:_.last_name}`||"N/A"}),a.jsx(t,{children:`${((p=(b=e==null?void 0:e.reviewed_by)==null?void 0:b.us_user)==null?void 0:p.first_name)||""} ${((o=(h=e==null?void 0:e.reviewed_by)==null?void 0:h.us_user)==null?void 0:o.last_name)||""}`||"N/A"}),a.jsx(t,{sx:{color:e.service_status==="Open"?"blue":e.service_status==="Approved"?"green":"red"},children:(e==null?void 0:e.service_status)||"N/A"}),a.jsx(t,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),k&&a.jsx(t,{children:a.jsx(_e,{onClick:()=>{R(!0),z(e)},color:"primary",disabled:(e==null?void 0:e.status.toLowerCase())==="close","aria-label":"edit record",children:a.jsx(xe,{})})})]},c)})})]})}),a.jsx(be,{component:"div",count:y.length,page:D,onPageChange:G,rowsPerPage:f,onRowsPerPageChange:X,rowsPerPageOptions:[5,10,15]}),a.jsx(pe,{updateData:W,open:F,handleClose:()=>R(!1),isTechnician:!0,isInspection:A})]})]})},Ae=fe;export{Ae as S};
