import{r as y,bv as vt,gc as kt,c1 as we,bx as tt,bu as wt,b as At,aT as ke,gd as Me,aX as Et,b3 as Dt,b4 as Tt,b8 as $t,b0 as It,ca as Pt,b9 as Lt,aS as Rt,aV as Bt,ge as Ot,c7 as Ft,gf as Nt,o as de,p as W,j as e,B as o,A as Te,D as ae,cN as Mt,cO as Wt,cP as Ht,z as Ut,m as he,cR as Gt,cS as Yt,w as ne,T as Kt,gg as st,gh as zt,gi as Xt,gj as qt,gk as Jt,gl as Qt,gm as Zt,gn as Vt,go as es,gp as ts,dd as Se,cm as be,cn as ye,cs as Ce,cW as je,n as _e,gq as me,gr as ss,gs as rs,gt as as,gu as os,gv as ns,gw as ls,gx as We,gy as He,gz as $e,gA as le,aH as ie,V as G,gB as se,gC as mt,gD as Ie,gE as Pe,gF as is,gG as rt,ac as cs,ay as ds,gH as ue,gI as at,gJ as ot,gK as Ue,gL as nt,gM as Oe,S as ve,gN as lt,aq as ps,ar as us,bJ as xs,gO as gs,gP as hs,gQ as it,gR as fs,gS as ct,gT as dt,a3 as ms,a6 as bs,Y as ys,gU as Cs,gV as js,gW as _s}from"./index-CHz_ICGe.js";import{R as Ss,I as bt}from"./index-zsjYuvy9.js";import{SinoCastalTerminal as vs,SinoCastalReadDTC as ks,SinoCastalLiveParameter as ws}from"./Index-B6k8nowZ.js";import"./index.esm-DuXd6zM4.js";var As={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Es=function(){var s=y.useRef([]),r=y.useRef(null);return y.useEffect(function(){var i=Date.now(),u=!1;s.current.forEach(function(k){if(k){u=!0;var g=k.style;g.transitionDuration=".3s, .3s, .3s, .06s",r.current&&i-r.current<100&&(g.transitionDuration="0s, 0s")}}),u&&(r.current=Date.now())}),s.current},pt=0,Ds=kt();function Ts(){var t;return Ds?(t=pt,pt+=1):t="TEST_OR_SSR",t}const $s=function(t){var s=y.useState(),r=vt(s,2),i=r[0],u=r[1];return y.useEffect(function(){u("rc_progress_".concat(Ts()))},[]),t||i};var ut=function(s){var r=s.bg,i=s.children;return y.createElement("div",{style:{width:"100%",height:"100%",background:r}},i)};function xt(t,s){return Object.keys(t).map(function(r){var i=parseFloat(r),u="".concat(Math.floor(i*s),"%");return"".concat(t[r]," ").concat(u)})}var Is=y.forwardRef(function(t,s){var r=t.prefixCls,i=t.color,u=t.gradientId,k=t.radius,g=t.style,d=t.ptg,C=t.strokeLinecap,c=t.strokeWidth,T=t.size,H=t.gapDegree,A=i&&we(i)==="object",w=A?"#FFF":void 0,_=T/2,$=y.createElement("circle",{className:"".concat(r,"-circle-path"),r:k,cx:_,cy:_,stroke:w,strokeLinecap:C,strokeWidth:c,opacity:d===0?0:1,style:g,ref:s});if(!A)return $;var B="".concat(u,"-conic"),p=H?"".concat(180+H/2,"deg"):"0deg",N=xt(i,(360-H)/360),E=xt(i,1),j="conic-gradient(from ".concat(p,", ").concat(N.join(", "),")"),m="linear-gradient(to ".concat(H?"bottom":"top",", ").concat(E.join(", "),")");return y.createElement(y.Fragment,null,y.createElement("mask",{id:B},$),y.createElement("foreignObject",{x:0,y:0,width:T,height:T,mask:"url(#".concat(B,")")},y.createElement(ut,{bg:m},y.createElement(ut,{bg:j}))))}),Ae=100,Fe=function(s,r,i,u,k,g,d,C,c,T){var H=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,A=i/100*360*((360-g)/360),w=g===0?0:{bottom:0,top:180,left:90,right:-90}[d],_=(100-u)/100*r;c==="round"&&u!==100&&(_+=T/2,_>=r&&(_=r-.01));var $=Ae/2;return{stroke:typeof C=="string"?C:void 0,strokeDasharray:"".concat(r,"px ").concat(s),strokeDashoffset:_+H,transform:"rotate(".concat(k+A+w,"deg)"),transformOrigin:"".concat($,"px ").concat($,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Ps=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function gt(t){var s=t??[];return Array.isArray(s)?s:[s]}var Ls=function(s){var r=tt(tt({},As),s),i=r.id,u=r.prefixCls,k=r.steps,g=r.strokeWidth,d=r.trailWidth,C=r.gapDegree,c=C===void 0?0:C,T=r.gapPosition,H=r.trailColor,A=r.strokeLinecap,w=r.style,_=r.className,$=r.strokeColor,B=r.percent,p=wt(r,Ps),N=Ae/2,E=$s(i),j="".concat(E,"-gradient"),m=N-g/2,I=Math.PI*2*m,R=c>0?90+c/2:-90,L=I*((360-c)/360),P=we(k)==="object"?k:{count:k,gap:2},l=P.count,n=P.gap,S=gt(B),b=gt($),h=b.find(function(Y){return Y&&we(Y)==="object"}),x=h&&we(h)==="object",f=x?"butt":A,v=Fe(I,L,0,100,R,c,T,H,f,g),D=Es(),O=function(){var F=0;return S.map(function(M,X){var K=b[X]||b[b.length-1],U=Fe(I,L,F,M,R,c,T,K,f,g);return F+=M,y.createElement(Is,{key:X,color:K,ptg:M,radius:m,prefixCls:u,gradientId:j,style:U,strokeLinecap:f,strokeWidth:g,gapDegree:c,ref:function(re){D[X]=re},size:Ae})}).reverse()},a=function(){var F=Math.round(l*(S[0]/100)),M=100/l,X=0;return new Array(l).fill(null).map(function(K,U){var te=U<=F-1?b[0]:H,re=te&&we(te)==="object"?"url(#".concat(j,")"):void 0,z=Fe(I,L,X,M,R,c,T,te,"butt",g,n);return X+=(L-z.strokeDashoffset+n)*100/L,y.createElement("circle",{key:U,className:"".concat(u,"-circle-path"),r:m,cx:N,cy:N,stroke:re,strokeWidth:g,opacity:1,style:z,ref:function(Z){D[U]=Z}})})};return y.createElement("svg",At({className:ke("".concat(u,"-circle"),_),viewBox:"0 0 ".concat(Ae," ").concat(Ae),style:w,id:i,role:"presentation"},p),!l&&y.createElement("circle",{className:"".concat(u,"-circle-trail"),r:m,cx:N,cy:N,stroke:H,strokeLinecap:f,strokeWidth:d||g,style:v}),l?a():O())};function ge(t){return!t||t<0?0:t>100?100:t}function Le({success:t,successPercent:s}){let r=s;return t&&"progress"in t&&(r=t.progress),t&&"percent"in t&&(r=t.percent),r}const Rs=({percent:t,success:s,successPercent:r})=>{const i=ge(Le({success:s,successPercent:r}));return[i,ge(ge(t)-i)]},Bs=({success:t={},strokeColor:s})=>{const{strokeColor:r}=t;return[r||Me.green,s||null]},Be=(t,s,r)=>{var i,u,k,g;let d=-1,C=-1;if(s==="step"){const c=r.steps,T=r.strokeWidth;typeof t=="string"||typeof t>"u"?(d=t==="small"?2:14,C=T??8):typeof t=="number"?[d,C]=[t,t]:[d=14,C=8]=Array.isArray(t)?t:[t.width,t.height],d*=c}else if(s==="line"){const c=r==null?void 0:r.strokeWidth;typeof t=="string"||typeof t>"u"?C=c||(t==="small"?6:8):typeof t=="number"?[d,C]=[t,t]:[d=-1,C=8]=Array.isArray(t)?t:[t.width,t.height]}else(s==="circle"||s==="dashboard")&&(typeof t=="string"||typeof t>"u"?[d,C]=t==="small"?[60,60]:[120,120]:typeof t=="number"?[d,C]=[t,t]:Array.isArray(t)&&(d=(u=(i=t[0])!==null&&i!==void 0?i:t[1])!==null&&u!==void 0?u:120,C=(g=(k=t[0])!==null&&k!==void 0?k:t[1])!==null&&g!==void 0?g:120));return[d,C]},Os=3,Fs=t=>Os/t*100,Ns=t=>{const{prefixCls:s,trailColor:r=null,strokeLinecap:i="round",gapPosition:u,gapDegree:k,width:g=120,type:d,children:C,success:c,size:T=g,steps:H}=t,[A,w]=Be(T,"circle");let{strokeWidth:_}=t;_===void 0&&(_=Math.max(Fs(A),6));const $={width:A,height:w,fontSize:A*.15+6},B=y.useMemo(()=>{if(k||k===0)return k;if(d==="dashboard")return 75},[k,d]),p=Rs(t),N=u||d==="dashboard"&&"bottom"||void 0,E=Object.prototype.toString.call(t.strokeColor)==="[object Object]",j=Bs({success:c,strokeColor:t.strokeColor}),m=ke(`${s}-inner`,{[`${s}-circle-gradient`]:E}),I=y.createElement(Ls,{steps:H,percent:H?p[1]:p,strokeWidth:_,trailWidth:_,strokeColor:H?j[1]:j,strokeLinecap:i,trailColor:r,prefixCls:s,gapDegree:B,gapPosition:N}),R=A<=20,L=y.createElement("div",{className:m,style:$},I,!R&&C);return R?y.createElement(Et,{title:C},L):L},Re="--progress-line-stroke-color",yt="--progress-percent",ht=t=>{const s=t?"100%":"-100%";return new Pt(`antProgress${t?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${s}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${s}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},Ms=t=>{const{componentCls:s,iconCls:r}=t;return{[s]:Object.assign(Object.assign({},$t(t)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:t.fontSize},[`${s}-outer`]:{display:"inline-flex",alignItems:"center",width:"100%"},[`${s}-inner`]:{position:"relative",display:"inline-block",width:"100%",flex:1,overflow:"hidden",verticalAlign:"middle",backgroundColor:t.remainingColor,borderRadius:t.lineBorderRadius},[`${s}-inner:not(${s}-circle-gradient)`]:{[`${s}-circle-path`]:{stroke:t.defaultColor}},[`${s}-success-bg, ${s}-bg`]:{position:"relative",background:t.defaultColor,borderRadius:t.lineBorderRadius,transition:`all ${t.motionDurationSlow} ${t.motionEaseInOutCirc}`},[`${s}-layout-bottom`]:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",[`${s}-text`]:{width:"max-content",marginInlineStart:0,marginTop:t.marginXXS}},[`${s}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Re})`]},height:"100%",width:`calc(1 / var(${yt}) * 100%)`,display:"block"},[`&${s}-bg-inner`]:{minWidth:"max-content","&::after":{content:"none"},[`${s}-text-inner`]:{color:t.colorWhite,[`&${s}-text-bright`]:{color:"rgba(0, 0, 0, 0.45)"}}}},[`${s}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:t.colorSuccess},[`${s}-text`]:{display:"inline-block",marginInlineStart:t.marginXS,color:t.colorText,lineHeight:1,width:"2em",whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[r]:{fontSize:t.fontSize},[`&${s}-text-outer`]:{width:"max-content"},[`&${s}-text-outer${s}-text-start`]:{width:"max-content",marginInlineStart:0,marginInlineEnd:t.marginXS}},[`${s}-text-inner`]:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",marginInlineStart:0,padding:`0 ${It(t.paddingXXS)}`,[`&${s}-text-start`]:{justifyContent:"start"},[`&${s}-text-end`]:{justifyContent:"end"}},[`&${s}-status-active`]:{[`${s}-bg::before`]:{position:"absolute",inset:0,backgroundColor:t.colorBgContainer,borderRadius:t.lineBorderRadius,opacity:0,animationName:ht(),animationDuration:t.progressActiveMotionDuration,animationTimingFunction:t.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${s}-rtl${s}-status-active`]:{[`${s}-bg::before`]:{animationName:ht(!0)}},[`&${s}-status-exception`]:{[`${s}-bg`]:{backgroundColor:t.colorError},[`${s}-text`]:{color:t.colorError}},[`&${s}-status-exception ${s}-inner:not(${s}-circle-gradient)`]:{[`${s}-circle-path`]:{stroke:t.colorError}},[`&${s}-status-success`]:{[`${s}-bg`]:{backgroundColor:t.colorSuccess},[`${s}-text`]:{color:t.colorSuccess}},[`&${s}-status-success ${s}-inner:not(${s}-circle-gradient)`]:{[`${s}-circle-path`]:{stroke:t.colorSuccess}}})}},Ws=t=>{const{componentCls:s,iconCls:r}=t;return{[s]:{[`${s}-circle-trail`]:{stroke:t.remainingColor},[`&${s}-circle ${s}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${s}-circle ${s}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:t.circleTextColor,fontSize:t.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[r]:{fontSize:t.circleIconFontSize}},[`${s}-circle&-status-exception`]:{[`${s}-text`]:{color:t.colorError}},[`${s}-circle&-status-success`]:{[`${s}-text`]:{color:t.colorSuccess}}},[`${s}-inline-circle`]:{lineHeight:1,[`${s}-inner`]:{verticalAlign:"bottom"}}}},Hs=t=>{const{componentCls:s}=t;return{[s]:{[`${s}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:t.progressStepMinWidth,marginInlineEnd:t.progressStepMarginInlineEnd,backgroundColor:t.remainingColor,transition:`all ${t.motionDurationSlow}`,"&-active":{backgroundColor:t.defaultColor}}}}}},Us=t=>{const{componentCls:s,iconCls:r}=t;return{[s]:{[`${s}-small&-line, ${s}-small&-line ${s}-text ${r}`]:{fontSize:t.fontSizeSM}}}},Gs=t=>({circleTextColor:t.colorText,defaultColor:t.colorInfo,remainingColor:t.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${t.fontSize/t.fontSizeSM}em`}),Ys=Dt("Progress",t=>{const s=t.calc(t.marginXXS).div(2).equal(),r=Tt(t,{progressStepMarginInlineEnd:s,progressStepMinWidth:s,progressActiveMotionDuration:"2.4s"});return[Ms(r),Ws(r),Hs(r),Us(r)]},Gs);var Ks=function(t,s){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&s.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,i=Object.getOwnPropertySymbols(t);u<i.length;u++)s.indexOf(i[u])<0&&Object.prototype.propertyIsEnumerable.call(t,i[u])&&(r[i[u]]=t[i[u]]);return r};const zs=t=>{let s=[];return Object.keys(t).forEach(r=>{const i=parseFloat(r.replace(/%/g,""));Number.isNaN(i)||s.push({key:i,value:t[r]})}),s=s.sort((r,i)=>r.key-i.key),s.map(({key:r,value:i})=>`${i} ${r}%`).join(", ")},Xs=(t,s)=>{const{from:r=Me.blue,to:i=Me.blue,direction:u=s==="rtl"?"to left":"to right"}=t,k=Ks(t,["from","to","direction"]);if(Object.keys(k).length!==0){const d=zs(k),C=`linear-gradient(${u}, ${d})`;return{background:C,[Re]:C}}const g=`linear-gradient(${u}, ${r}, ${i})`;return{background:g,[Re]:g}},qs=t=>{const{prefixCls:s,direction:r,percent:i,size:u,strokeWidth:k,strokeColor:g,strokeLinecap:d="round",children:C,trailColor:c=null,percentPosition:T,success:H}=t,{align:A,type:w}=T,_=g&&typeof g!="string"?Xs(g,r):{[Re]:g,background:g},$=d==="square"||d==="butt"?0:void 0,B=u??[-1,k||(u==="small"?6:8)],[p,N]=Be(B,"line",{strokeWidth:k}),E={backgroundColor:c||void 0,borderRadius:$},j=Object.assign(Object.assign({width:`${ge(i)}%`,height:N,borderRadius:$},_),{[yt]:ge(i)/100}),m=Le(t),I={width:`${ge(m)}%`,height:N,borderRadius:$,backgroundColor:H==null?void 0:H.strokeColor},R={width:p<0?"100%":p},L=y.createElement("div",{className:`${s}-inner`,style:E},y.createElement("div",{className:ke(`${s}-bg`,`${s}-bg-${w}`),style:j},w==="inner"&&C),m!==void 0&&y.createElement("div",{className:`${s}-success-bg`,style:I})),P=w==="outer"&&A==="start",l=w==="outer"&&A==="end";return w==="outer"&&A==="center"?y.createElement("div",{className:`${s}-layout-bottom`},L,C):y.createElement("div",{className:`${s}-outer`,style:R},P&&C,L,l&&C)},Js=t=>{const{size:s,steps:r,rounding:i=Math.round,percent:u=0,strokeWidth:k=8,strokeColor:g,trailColor:d=null,prefixCls:C,children:c}=t,T=i(r*(u/100)),A=s??[s==="small"?2:14,k],[w,_]=Be(A,"step",{steps:r,strokeWidth:k}),$=w/r,B=Array.from({length:r});for(let p=0;p<r;p++){const N=Array.isArray(g)?g[p]:g;B[p]=y.createElement("div",{key:p,className:ke(`${C}-steps-item`,{[`${C}-steps-item-active`]:p<=T-1}),style:{backgroundColor:p<=T-1?N:d,width:$,height:_}})}return y.createElement("div",{className:`${C}-steps-outer`},B,c)};var Qs=function(t,s){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&s.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,i=Object.getOwnPropertySymbols(t);u<i.length;u++)s.indexOf(i[u])<0&&Object.prototype.propertyIsEnumerable.call(t,i[u])&&(r[i[u]]=t[i[u]]);return r};const Zs=["normal","exception","active","success"],ft=y.forwardRef((t,s)=>{const{prefixCls:r,className:i,rootClassName:u,steps:k,strokeColor:g,percent:d=0,size:C="default",showInfo:c=!0,type:T="line",status:H,format:A,style:w,percentPosition:_={}}=t,$=Qs(t,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style","percentPosition"]),{align:B="end",type:p="outer"}=_,N=Array.isArray(g)?g[0]:g,E=typeof g=="string"||Array.isArray(g)?g:void 0,j=y.useMemo(()=>{if(N){const O=typeof N=="string"?N:Object.values(N)[0];return new Lt(O).isLight()}return!1},[g]),m=y.useMemo(()=>{var O,a;const Y=Le(t);return parseInt(Y!==void 0?(O=Y??0)===null||O===void 0?void 0:O.toString():(a=d??0)===null||a===void 0?void 0:a.toString(),10)},[d,t.success,t.successPercent]),I=y.useMemo(()=>!Zs.includes(H)&&m>=100?"success":H||"normal",[H,m]),{getPrefixCls:R,direction:L,progress:P}=y.useContext(Rt),l=R("progress",r),[n,S,b]=Ys(l),h=T==="line",x=h&&!k,f=y.useMemo(()=>{if(!c)return null;const O=Le(t);let a;const Y=A||(M=>`${M}%`),F=h&&j&&p==="inner";return p==="inner"||A||I!=="exception"&&I!=="success"?a=Y(ge(d),ge(O)):I==="exception"?a=h?y.createElement(Ot,null):y.createElement(Ft,null):I==="success"&&(a=h?y.createElement(Ss,null):y.createElement(Nt,null)),y.createElement("span",{className:ke(`${l}-text`,{[`${l}-text-bright`]:F,[`${l}-text-${B}`]:x,[`${l}-text-${p}`]:x}),title:typeof a=="string"?a:void 0},a)},[c,d,m,I,T,l,A]);let v;T==="line"?v=k?y.createElement(Js,Object.assign({},t,{strokeColor:E,prefixCls:l,steps:typeof k=="object"?k.count:k}),f):y.createElement(qs,Object.assign({},t,{strokeColor:N,prefixCls:l,direction:L,percentPosition:{align:B,type:p}}),f):(T==="circle"||T==="dashboard")&&(v=y.createElement(Ns,Object.assign({},t,{strokeColor:N,prefixCls:l,progressStatus:I}),f));const D=ke(l,`${l}-status-${I}`,{[`${l}-${T==="dashboard"&&"circle"||T}`]:T!=="line",[`${l}-inline-circle`]:T==="circle"&&Be(C,"circle")[0]<=20,[`${l}-line`]:x,[`${l}-line-align-${B}`]:x,[`${l}-line-position-${p}`]:x,[`${l}-steps`]:k,[`${l}-show-info`]:c,[`${l}-${C}`]:typeof C=="string",[`${l}-rtl`]:L==="rtl"},P==null?void 0:P.className,i,u,S,b);return n(y.createElement("div",Object.assign({ref:s,style:Object.assign(Object.assign({},P==null?void 0:P.style),w),className:D,role:"progressbar","aria-valuenow":m,"aria-valuemin":0,"aria-valuemax":100},Bt($,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),v))});function Vs({title:t,setShowVehicles:s,showVehicles:r,showParams:i,setShowParams:u}){const k=de(),{collapsed:g}=W(E=>E.auth),{isLiveParameter:d,isWriteParameter:C,isActuator:c,isRoutineTest:T,isFlashing:H,isJ1939:A,selectedVehicle:w}=W(E=>E.diagnostics),{tractorIcon:_}=W(E=>E.liveMap);JSON.parse(localStorage.getItem("w_userDetails"));const{mode:$,selectedVehicleGroup:B}=W(E=>E.dashboard),p=()=>{k(Yt(!g))},N={fontSize:"26px",fontWeight:500,lineHeight:"18.38px",color:"#fff",textAlign:"center",paddingTop:"5px",fontFamily:"ubuntu"};return e.jsxs(o,{style:{display:"flex",justifyContent:"space-between",paddingRight:"20px",backgroundColor:Te.bgColor,alignItems:"center",textAlign:"center",height:"60px",color:"white"},children:[e.jsxs(o,{style:{display:"flex",justifyContent:"space-between",gap:"10px",alignItems:"center",width:"50%"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[g?e.jsx(ae,{onClick:p,sx:{color:"white"},children:e.jsx(Mt,{style:{width:"30px",height:"30px"}})}):e.jsx(ae,{onClick:p,sx:{color:"white"},children:e.jsx(Wt,{style:{width:"30px",height:"30px"}})}),e.jsx("img",{src:Ht,alt:"wikitrak logo"})]}),e.jsx(o,{children:e.jsx(Ut,{style:N,children:t})})]}),e.jsxs(o,{style:{display:"flex",gap:"5px"},children:[e.jsxs(ae,{variant:"outlined",size:"small",sx:{color:r?"white":"black",backgroundColor:r?"transparent":"white",mt:"6px",mx:"5px",border:"1px solid white",width:"150px",height:"40px","&:hover":{color:"white",border:"1px solid black"}},onClick:()=>{s(!r),u(!1)},children:[e.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",style:{marginRight:"5px"},children:e.jsx("path",{d:_.path1})}),Object.keys(w).length>0?w.reg_id:"Vehicles"]}),(d||C||c||T||H||A)&&e.jsxs(ae,{variant:"outlined",size:"small",sx:{color:i?"blue":"white",backgroundColor:i?"white":"undefined",mt:"6px",mx:"5px",border:"1px solid white",height:"40px"},onClick:()=>{s(!1),u(!i)},children:[d&&"Live Parameter",C&&"Write Parameter",c&&"Actuator Test",T&&"Routine Test",H&&"Flashing",A&&"J1939 Parameter"]}),e.jsx(he,{onClick:()=>{k(Gt(!$))},sx:{color:"white"}})]})]})}const er=({vehicleData:t,handleChange:s})=>{const{selectedVehicle:r}=W(C=>C.diagnostics),[i,u]=y.useState(""),{mode:k}=W(C=>C.dashboard),g=ne(k),d=t&&t.length>0&&t.filter(C=>C.label.toLowerCase().includes(i));return e.jsxs(e.Fragment,{children:[e.jsx(bt,{style:{width:"85%",margin:"8px 20px",padding:"10px"},placeholder:"Search vehicle",onChange:C=>u(C.target.value)}),d.length>0?d.map((C,c)=>e.jsx(o,{sx:{align:"center",my:"8px",ml:"20px"},children:e.jsx(ae,{variant:"outlined",onClick:()=>{s(C)},sx:{width:"90%",bgcolor:C.label===(r==null?void 0:r.reg_id)?Te.bgColor:"undefined",color:C.label===(r==null?void 0:r.reg_id)?"white":g.grey[400],border:`1px solid ${Te.bgColor}`,"&:hover":{color:"black",border:"1px solid black",bgcolor:Te.bgShadow}},children:C.label})},c)):e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh"},children:e.jsx(Kt,{sx:{textAlign:"center",color:g.grey[400]},children:"Sorry! No vehicles"})})]})},tr=({options:t})=>{const{selectedMenu:s,selectedVehicle:r}=W(d=>d.diagnostics),i=de(),{mode:u}=W(d=>d.dashboard),k=ne(u),g=d=>{switch(st(d),i(st(d)),d){case"Terminal Application":i(ts());break;case"Write Parameters":i(es());break;case"Read DTC":i(Vt());break;case"Live Parameters":i(Zt());break;case"Actuator Test":i(Qt());break;case"Routine Test":i(Jt());break;case"ECU Information":i(qt());break;case"Flashing":i(Xt());break;case"J1939 Parameters":i(zt());break}};return e.jsx(e.Fragment,{children:e.jsx("div",{children:t.length>0&&t.map((d,C)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsxs(o,{sx:{border:s!==d.label?"1px solid #E8E8E8":"",p:"8px",borderRadius:"5px",m:"10px",display:"flex",cursor:"pointer",color:s===d.label?"white":k.grey[400],backgroundColor:s===d.label?"#8DA6C6":void 0},onClick:()=>{g(d.label)},children:[e.jsx(o,{sx:{mx:"5px"},children:d.icon}),e.jsx(o,{sx:{mx:"5px",fontSize:"16px"},children:e.jsx("span",{children:d.label})})]})},C))})})},Ct="https://cc.wikitrak.in/proxy-3031",sr=({deviceType:t})=>{var R,L,P;const s=de(),{liveParameters:r,isLiveParameter:i,isWriteParameter:u,isActuator:k,isRoutineTest:g,isFlashing:d,loading:C,isDtcLoader:c,isJ1939:T,j1939Parameters:H}=W(l=>l.diagnostics),{vehicleList:A,selectedVehicle:w}=W(l=>l.liveMap),{mode:_}=W(l=>l.dashboard);let B=(P=(L=(R=((A||[]).find(l=>{var n;return((n=l==null?void 0:l.imei[0])==null?void 0:n.mac_id)===(w==null?void 0:w.imei)})||{}).sub_model)==null?void 0:R.ecus[0])==null?void 0:L.ecu[0])==null?void 0:P.file;B=(B==null?void 0:B.map(l=>({...l,label:l.sw_part_no})))||[];const p=(l,n)=>{let S=r.map((b,h)=>(b.label,{...b,checked:b.label===n?l.target.checked:b.checked}));s(me(S))},N=(l,n)=>{let S=H.map((b,h)=>(b.label,{...b,checked:b.label===n?l.target.checked:b.checked}));s($e(S))},E=l=>{s(ss(l.label)),s(rs(l))},j=l=>{s(as(l.label)),s(os(l))},m=l=>{s(ns(l.label)),s(ls(l))},I=l=>{s(We(l.label)),s(He(l))};return e.jsxs("div",{children:[c&&e.jsx(Se,{}),i&&e.jsx(rr,{handleLiveParameter:p,deviceType:t}),u&&e.jsx(ar,{handleWriteParameter:E}),k&&e.jsx(or,{handleActuatorTest:j}),g&&e.jsx(nr,{handleRoutineTest:m}),d&&e.jsx(lr,{handleFlashing:I}),T&&e.jsx(ir,{handleJ1939Parameter:N})]})},rr=({handleLiveParameter:t,deviceType:s})=>{const r=de(),{liveParameters:i,liveParameterGroupList:u,selectedVehicle:k}=W(l=>l.diagnostics),{mode:g}=W(l=>l.dashboard),d=ne(g),{activeVehicle:C}=W(l=>l.liveMap),[c,T]=y.useState(""),[H,A]=y.useState(""),[w,_]=y.useState(!1),[$,B]=y.useState(!1),p=i.length>0&&i.filter(l=>l.label.toLowerCase().includes(c.toLowerCase())),N=u.length>0&&u.filter(l=>l.label.toLowerCase().includes(H.toLowerCase())),E=(l,n)=>{n==="group"&&A(l.target.value),n==="one"&&T(l.target.value)};function j(l){return l.match(/../g).reverse().join("")}function m(l,n){const{pidArray:S,frames:b}=l,h=b[b.length-1];let x=0;for(const f of S){const D=f.toLowerCase().padStart(4,"0").match(/../g).reverse().join(""),O=i.find(X=>X.code===D);if(!O||!Array.isArray(O.pi_code_variable)||O.pi_code_variable.length===0){console.warn(`Invalid or missing pi_code_variable for PID: ${D}`);continue}const a=O.pi_code_variable[0];if(console.log("byteInfo",a),!a||typeof a.length!="number"||!a.message_type||a.length<=0){console.warn(`Invalid byte definition for PID: ${D}`,a);continue}const Y=a.length,F=Y*2,M=h.slice(x*2,x*2+F);if(f===n){const{resolution:X=1,offset:K=0,message_type:U}=a,te=j(M);let re=null;switch(U){case"CONTINUOUS":re=Pe(te)*X+K;break;case"ASCII":re=Ie(te);break;case"eNUM":case"bcd-hex":re=te;break;case"FLOAT":re=is(te);break;default:return{pid:n,error:`Unknown message_type: ${U}`}}return{pidCheck:D,valueHex:M,valueHexLE:te,decimalValue:re}}x+=Y}return{pid:n,error:"PID not found or byte definition missing"}}const I=async()=>{var n;const l=i.filter(S=>S.checked);if(s==="Sinocastel"){r(le(!0));try{const b=l.map(v=>v.code).map(v=>v.toLowerCase().padStart(4,"0").match(/../g).reverse().join("")),{data:h}=await ie.post(`${Ct}/api/packet/latest`,{imei:k.imei,pid:b}),x=(n=h==null?void 0:h.results)!=null&&n.length?h.results.filter(v=>v==null?void 0:v.packet).map(v=>m(v.packet,v.pid)):[],f=i.map(v=>{const D=x.find(O=>O.pidCheck===v.code);return console.log("match",D,D==null?void 0:D.decimalValue),{...v,dataByte:D?D.decimalValue:""}});r(me(f)),r(le(!1))}catch(S){r(le(!1)),console.error("Error in Sinocastel flow:",S),G.error("Failed to read parameter data")}}else try{r(le(!0));const S=l.map(v=>({command:se("4",v.code,"00"),id:v.id})),b=S.map(v=>v.command),h=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:k.imei,commands:`{${b}}`}),x=h==null?void 0:h.data;if(!(x!=null&&x.success)||!Array.isArray(x.commands))throw new Error("Invalid API response");let f=[...i];x.commands.forEach((v,D)=>{var O;try{const a=mt(v),{id:Y}=S[D]||{};if(!Y)return;const F=f.find(U=>U.id===Y),M=(O=F==null?void 0:F.pi_code_variable)==null?void 0:O[0];if(!M||!a.startsWith("62")){M!=null&&M.short_name&&G.error(`Negative response from ECU for ${M.short_name}`);return}let X=a.toLowerCase().replace(F.code.toLowerCase().slice(2),"").slice(2),K;switch(M.message_type){case"CONTINUOUS":K=Pe(X)*M.resolution+M.offset;break;case"ASCII":K=Ie(X);break;case"eNUM":case"bcd-hex":K=X;break;default:return}f=f.map(U=>U.id===Y?{...U,dataByte:K}:U)}catch(a){console.error("Error decoding command:",a)}}),r(me(f))}catch(S){console.error("Error in handleSubmit:",S),G.error("Response timeout")}finally{r(le(!1))}},R=()=>{_(!w)},L=(l,n)=>{const S=l.target.checked;console.log("ischeckd",S);const b=u.find(x=>x.id===n);if(!b)return;const h=i.map(x=>{var v,D,O;const f=(O=(D=(v=x.pi_code_variable)==null?void 0:v[0])==null?void 0:D.group)==null?void 0:O.some(a=>a.id===b.id);return console.log("belongsToGroup",f),f?{...x,checked:S}:x});r(me(h))},P=l=>{if(l.target.checked){let n=i.map(S=>({...S,checked:!0}));r(me(n))}else{let n=i.map(S=>({...S,checked:!1}));r(me(n))}};return e.jsxs(e.Fragment,{children:[e.jsxs(o,{children:[!w&&e.jsxs(e.Fragment,{children:[e.jsxs(be,{sx:{width:"75%",mt:"15px",mx:"15px",backgroundColor:d.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:d.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:l=>{E(l,"one")},inputProps:{style:{padding:7,color:d.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(he,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]}),e.jsx("input",{type:"checkbox",style:{marginTop:"25px"},onChange:P})]}),w&&e.jsx(e.Fragment,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:d.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:d.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:l=>{E(l,"group")},inputProps:{style:{padding:7,color:d.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(he,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})})]}),!w&&e.jsxs("div",{style:{height:"67vh",overflow:"auto"},children:[p.length>0&&p.map((l,n)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},title:l.label,children:e.jsxs(o,{sx:{border:"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:d.grey[400]},children:[e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:l.label.length<=25?l.label:`${l.label.substring(0,25)}...`})}),e.jsx(o,{sx:{fontSize:"16px",position:"relative",right:"2px"},children:e.jsx("input",{type:"checkbox",onChange:S=>{t(S,l.label)},checked:l.checked,style:{width:"20px",padding:0}})})]})},n)),!(p.length>0)&&e.jsx("h3",{children:"No Data"})]}),w&&e.jsx("div",{style:{height:"67vh",overflow:"auto"},children:N.length>0&&N.map((l,n)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},title:l.label,children:e.jsxs(o,{sx:{border:"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:d.grey[400]},children:[e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:l.label.length<=25?l.label:`${l.label.substring(0,20)}...`})}),e.jsx(o,{sx:{fontSize:"16px",position:"relative",right:"2px"},children:e.jsx("input",{type:"checkbox",onChange:S=>{L(S,l.id)},checked:l.checked,style:{width:"20px",padding:0}})})]})},n))}),e.jsx(o,{sx:{mt:"25px"},children:e.jsx(ae,{variant:"contained",sx:{width:"90%",mx:"10px",backgroundColor:"#8DA6C6"},onClick:I,children:"Submit"})}),e.jsx(o,{sx:{mt:"10px"},children:e.jsx(ae,{variant:"contained",sx:{width:"90%",mx:"10px",backgroundColor:"white",color:"black"},onClick:R,children:w?"Select Parameter":"Select Group"})})]})},ar=({handleWriteParameter:t})=>{const{writeParameter:s,activeWriteParameter:r}=W(c=>c.diagnostics),{mode:i}=W(c=>c.dashboard),u=ne(i),[k,g]=y.useState(""),d=s.length>0&&s.filter(c=>c.label.toLowerCase().includes(k.toLowerCase())),C=c=>{g(c.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:u.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:u.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:C,inputProps:{style:{padding:7,color:u.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(he,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})}),d.length>0&&d.map((c,T)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(o,{sx:{p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",border:r===c.label?"1px solid #8DA6C6":"1px solid #E8E8E8",color:r===c.label?"white":u.grey[400],backgroundColor:r===c.label?"#8DA6C6":void 0},onClick:()=>{t(c)},children:e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:c.label.length<=25?c.label:`${c.label.substring(0,25)}...`})})})},T))]})},or=({handleActuatorTest:t})=>{const{liveParameters:s,writeParameter:r,actuatorTestList:i,routineTestList:u,isLiveParameter:k,isWriteParameter:g,isActuator:d,activeWriteParameter:C,activeActuatorTest:c,activeRoutineTest:T,activeFlashingFile:H,isRoutineTest:A,isFlashing:w}=W(j=>j.diagnostics),{mode:_}=W(j=>j.dashboard),$=ne(_),[B,p]=y.useState(""),N=i.length>0&&i.filter(j=>j.label.toLowerCase().includes(B.toLowerCase())),E=j=>{p(j.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:$.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:$.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:E,inputProps:{style:{padding:7,color:$.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(he,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})}),N.length>0&&N.map((j,m)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(o,{sx:{border:c===j.label?"1px solid #8DA6C6":"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:c===j.label?"white":$.grey[400],backgroundColor:c===j.label?"#8DA6C6":void 0},onClick:()=>{t(j)},children:e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:j.label.length<=25?j.label:`${j.label.substring(0,25)}...`})})})},m))]})},nr=({handleRoutineTest:t})=>{const{routineTestList:s,activeRoutineTest:r}=W(c=>c.diagnostics),{mode:i}=W(c=>c.dashboard),u=ne(i),[k,g]=y.useState(""),d=s.length>0&&s.filter(c=>c.label.toLowerCase().includes(k.toLowerCase())),C=c=>{g(c.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:u.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:u.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:C,inputProps:{style:{padding:7,color:u.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(he,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})}),d.length>0&&d.map((c,T)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(o,{sx:{border:r===c.label?"1px solid #8DA6C6":"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:r===c.label?"white":u.grey[400],backgroundColor:r===c.label?"#8DA6C6":void 0},onClick:()=>{t(c)},children:e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:c.label.length<=25?c.label:`${c.label.substring(0,25)}...`})})})},T)),!s.length>0&&e.jsx("div",{style:{marginTop:"40%",textAlign:"center",color:u.grey[400]},children:e.jsx("h3",{children:"Routine test not available"})})]})},lr=({handleFlashing:t})=>{const{activeFlashingFile:s,fotaFiles:r}=W(c=>c.diagnostics),{mode:i}=W(c=>c.dashboard),u=ne(i),[k,g]=y.useState(""),d=r.length>0&&r.filter(c=>c.label.toLowerCase().includes(k.toLowerCase())),C=c=>{g(c.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsxs(be,{sx:{width:"89%",mt:"15px",ml:"15px",backgroundColor:u.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:u.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:C,inputProps:{style:{padding:7,color:u.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(he,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]})}),e.jsx("div",{style:{height:"90vh",overflow:"auto"},children:d.length>0&&d.map((c,T)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},children:e.jsx(o,{sx:{border:s===c.label?"1px solid #8DA6C6":"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:s===c.label?"white":u.grey[400],backgroundColor:s===c.label?"#8DA6C6":u.grey[100]},onClick:()=>{t(c)},children:e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:c.label.length<=25?c.label:`${c.label.substring(0,25)}...`})})})},T))})]})},ir=({handleJ1939Parameter:t})=>{const s=de(),{j1939Parameters:r,selectedVehicle:i}=W(E=>E.diagnostics),{mode:u}=W(E=>E.dashboard),k=ne(u),{activeVehicle:g}=W(E=>E.liveMap),[d,C]=y.useState(""),[c,T]=y.useState(!1),[H,A]=y.useState(!1),w=r.length>0&&r.filter(E=>E.label.toLowerCase().includes(d.toLowerCase())),_=(E,j)=>{C(E.target.value)};function $(E){return E.match(/../g).reverse().join("")}function B(E,j){const{pidArray:m,frames:I}=E;I[I.length-1];for(const R of m){R.toLowerCase().padStart(4,"0");const L=R,P=r.find(S=>{var b;return((b=S==null?void 0:S.pgn)==null?void 0:b.toLowerCase())===(L==null?void 0:L.toLowerCase())});if(!P||!Array.isArray(P.spn)||P.spn.length===0){console.warn(`Invalid or missing pi_code_variable for PID: ${L}`);continue}const l=P.spn[0];if(!l||typeof l.no_of_bytes!="number"||!l.message_type||l.no_of_bytes<=0){console.warn(`Invalid byte definition for PID: ${L}`,l);continue}l.no_of_bytes;const n=I[m.indexOf(R)];if(R===j){const{resolution:S=1,offset:b=0,message_type:h,start_byte:x,start_bit:f,no_of_bit:v,endian:D,bitcoded:O,no_of_bytes:a}=l,Y=(x-1)*2,F=Y+a*2;let M=n.slice(Y,F),X;O?X=parseInt(M,16).toString(2).padStart(a*8,"0").slice(f-1,f-1+v):X=M;let K;D.toLowerCase()==="big"?K=X:K=$(X);let U=null;switch(h){case"CONTINUOUS":U=Pe(K)*S+b;break;case"ASCII":U=Ie(K);break;case"eNUM":case"bcd-hex":U=K;break;default:return{pid:j,error:`Unknown message_type: ${h}`}}return{pidCheck:L,valueHex:n,decimalValue:U}}}return{pid:j,error:"PID not found or byte definition missing"}}const p=async()=>{var E;s(le(!0));try{const m=r.filter(P=>P.checked).map(P=>P.pgn),{data:I}=await ie.post(`${Ct}/api/packet/latest`,{imei:i.imei,pid:m}),R=(E=I==null?void 0:I.results)!=null&&E.length?I.results.filter(P=>P==null?void 0:P.packet).map(P=>B(P.packet,P.pid)):[];console.log("pidArray",R);const L=r.map(P=>{const l=R.find(n=>n.pidCheck===P.pgn);return console.log("match",l,l==null?void 0:l.decimalValue),{...P,dataByte:l?l.decimalValue:""}});s($e(L)),s(le(!1))}catch(j){s(le(!1)),console.error("Error in Sinocastel flow:",j),G.error("Failed to read parameter data")}},N=E=>{if(E.target.checked){let j=r.map(m=>({...m,checked:!0}));s($e(j))}else{let j=r.map(m=>({...m,checked:!1}));s($e(j))}};return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:!c&&e.jsxs(e.Fragment,{children:[e.jsxs(be,{sx:{width:"75%",mt:"15px",mx:"15px",backgroundColor:k.grey[500],borderRadius:"5px"},variant:"outlined",children:[e.jsx(ye,{htmlFor:"outlined-adornment-password",style:{marginTop:"-8px",color:k.grey[400]},children:"Search"}),e.jsx(Ce,{onChange:E=>{_(E)},inputProps:{style:{padding:7,color:k.grey[400]}},id:"outlined-adornment-password",type:"text",endAdornment:e.jsx(je,{position:"end",children:e.jsx(he,{"aria-label":"toggle password visibility",edge:"end",children:e.jsx(_e,{})})}),label:"Search"})]}),e.jsx("input",{type:"checkbox",style:{marginTop:"25px"},onChange:N})]})}),!c&&e.jsxs("div",{style:{height:"67vh",overflow:"auto"},children:[w.length>0&&w.map((E,j)=>e.jsx(o,{sx:{align:"center",my:"8px",color:"grey"},title:E.label,children:e.jsxs(o,{sx:{border:"1px solid #E8E8E8",p:"8px",borderRadius:"5px",mx:"15px",display:"flex",cursor:"pointer",color:k.grey[400]},children:[e.jsx(o,{sx:{mx:"5px",width:"90%"},children:e.jsx("span",{children:E.label.length<=25?E.label:`${E.label.substring(0,25)}...`})}),e.jsx(o,{sx:{fontSize:"16px",position:"relative",right:"2px"},children:e.jsx("input",{type:"checkbox",onChange:m=>{t(m,E.label)},checked:E.checked,style:{width:"20px",padding:0}})})]})},j)),!(w.length>0)&&e.jsx("h3",{children:"No Data"})]}),e.jsx(o,{sx:{mt:"25px"},children:e.jsx(ae,{variant:"contained",sx:{width:"90%",mx:"10px",backgroundColor:"#8DA6C6"},onClick:p,children:"Submit"})})]})},cr=()=>{var R,L,P,l,n,S,b;const t=de(),{vehicleList:s}=W(h=>h.liveMap),{terminalAppLogs:r,dtcDataset:i,loading:u,isDtcLoader:k,selectedVehicle:g}=W(h=>h.diagnostics),{mode:d}=W(h=>h.dashboard),C=ne(d),[c,T]=y.useState(0),[H,A]=y.useState(""),[w,_]=y.useState([]),[$,B]=y.useState(!1),p=(s||[]).find(h=>{var x;return((x=h==null?void 0:h.imei[0])==null?void 0:x.mac_id)===(g==null?void 0:g.imei)})||{};console.log("active vehilce ",p,g),console.log("vehicle list",s),y.useEffect(()=>{var h,x,f,v,D,O;if(((h=Object.keys(p))==null?void 0:h.length)>0&&((f=(x=p==null?void 0:p.sub_model)==null?void 0:x.ecus)==null?void 0:f.length)>0){let a=(O=(D=(v=p==null?void 0:p.sub_model)==null?void 0:v.ecus[0])==null?void 0:D.datasets[0])==null?void 0:O.id;t(rt({id:a}))}},[]);const N=(h,x)=>{var M,X;T(x);let f=(X=(M=p==null?void 0:p.sub_model)==null?void 0:M.ecus[x].datasets[0])==null?void 0:X.id;t(rt({id:f}));const{tx_header:v,rx_header:D,protocol:O}=h,a=`02${O.autopeepal},04${v},06${D}`;switch(p.sub_model.ecus[x].read_dtc_fn_index.value.split("_")[0]){case"GENERICOBD":{const K=se("4","03","00"),U=se("4","07","00");G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:K})),G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:U}));let te={imei:g.imei,commands:`{${K}, ${U}}`,tranCmd:`{${K}, ${U}}`};t(ue(te));break}case"UDS":{a||G.error("Please click again");let K,U=a.split(","),te=U==null?void 0:U.map(re=>{if((U==null?void 0:U.length)%2===0){G.error("The Tx Frame format is not right. Must be odd length.");return}return K=se("2",re,"00"),K});if(te){G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:te}));let re={imei:g.imei,commands:`{${te}}`,tranCmd:te};t(ue(re))}break}case"KWP":{const K=se("4","1800AF","00");G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:K}));let U={imei:g.imei,commands:`{${K}}`,tranCmd:`{${K}}`};t(ue(U));break}default:{B(!1);break}}},E=async(h,x,f)=>{var v,D;if(B(!0),f==="clear")try{A("");let O;O=se(4,x,"00");const a=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:g.imei,commands:`{${O}}`});if(a!=null&&a.data&&B(!1),!((v=a==null?void 0:a.data)!=null&&v.success)){B(!1),A("Time Response is out");return}if(((D=a==null?void 0:a.data)==null?void 0:D.commands.filter(F=>F.toLowerCase()==="400000ffff")).length>0){A("No response from ECU");return}A("Ecu is clear dtc Success");return}catch{A("Time Response is out")}else if(f==="read"){A("");try{A("");let O;O=se(4,x,"00");const a=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:g.imei,commands:`{${O}}`});return a!=null&&a.data&&B(!1),a==null?void 0:a.data}catch{return{success:!1}}}},j=async()=>{if(B(!0),c===null)return G.error("Please select the tab");const h=p.sub_model.ecus[c].read_dtc_fn_index.value;if(h==="KWP_2BYTE_DTC"||h==="UDS_2BYTE12_DTC"||h==="UDS_2BYTE_DTC"||h==="UDS_2BYTE13_DTC"||h==="UDS_3BYTE_DTC"){let x=null,f=!1;if(h==="KWP_2BYTE_DTC"){let D=null;D=await E(4,"1800FFFF","read"),D.success?(x=D.commands[0],f=!0):f=!1}else{let D=null;D=await E(3,"1902FF","read"),D.success?(x=D.commands[0],f=!0):f=!1}f&&x==="400000ffff"?A("No response from ECU"):f||A("Time Response Out");let v=[];if(h!=="KWP_2BYTE_DTC"){x=x==null?void 0:x.slice(6),x=x==null?void 0:x.slice(6),x=x==null?void 0:x.slice(0,-4),console.log(x);const D=[];for(let a=0;a<(x==null?void 0:x.length);a+=8)D.push(x==null?void 0:x.slice(a,a+8));const O=(a,Y)=>((a&Y)>>6).toString(16).padStart(2,"0");v=D.map(a=>{let Y=0,F="",M="",X=a.slice(0,2),K=O(X,192);if(K==="00"?F="P":K==="01"?F="C":K==="02"?F="B":K==="03"&&(F="U"),h!=="KWP_2BYTE_DTC"){X=a.slice(0,-2);let U=O(X,129);switch(U){case"00":Y="Inactive:LampOff";break;case"01":Y="Active:LampOff";break;case"80":Y="Inactive:LampOn";break;case"81":Y="Active:LampOn";break}switch(h){case"UDS_3BYTE_DTC":X=a.slice(0,2),U=O(X,63),M=`${F}${U}${a.slice(2,4)}-${a.slice(4,6)}`;break}}return{type:M,value:Y}}),_(v)}}},m=async()=>{var x;if(c===null)return G.error("Please select the tab");const h=(x=p==null?void 0:p.sub_model)==null?void 0:x.ecus[c].clear_dtc_fn_index.value;if(h==="GENERICOBD"){const f=se("4","04","00");G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:f})),t(ue(g.imei,`{${f}}`))}else{let f=h,v=null,D=0;return f==="UDS_4BYTES"?(D=4,v=E(D,"14FFFFFF","clear")):f==="UDS_3BYTES"?(D=3,v=E(D,"14FFFF","clear")):f==="GENERIC_OBD"?(D=1,v=E(D,"04","clear")):f==="KWP_PRIMITIVE"&&(D=1,v=E(D,"14","clear")),v}},I=h=>{var f;let x=[];return x=i.filter(v=>(v==null?void 0:v.code)===h),(x==null?void 0:x.length)>0?(f=x[0])==null?void 0:f.description:"Description is Not found"};return e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[(u||k||$)&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((R=Object.keys(p))==null?void 0:R.length)>0&&((L=p==null?void 0:p.sub_model)==null?void 0:L.ecus.length)>0&&((P=p==null?void 0:p.sub_model)==null?void 0:P.ecus.map((h,x)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:c===x?"#333333":C.grey[400],mt:"20px",backgroundColor:c===x?"#D5E1FE":C.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{N(h,x)},children:e.jsx("b",{children:h.name})})})))}),e.jsx(o,{children:w&&w.length>0?e.jsx(o,{sx:{height:"65vh",overflow:"auto"},children:w&&w.length>0&&w.map((h,x)=>e.jsx(cs,{sx:{minWidth:275,mx:4,my:2,display:"flex",backgroundColor:C.grey[100],color:C.grey[400]},children:e.jsxs(ds,{sx:{display:"flex"},children:[e.jsxs(o,{sx:{width:"35vw"},children:[e.jsx(o,{sx:{fontSize:"15px"},children:h==null?void 0:h.type}),e.jsx(o,{sx:{fontSize:"15px"},children:I(h==null?void 0:h.type)})]}),e.jsx(o,{children:e.jsx(ae,{variant:"contained",sx:{color:"white",height:"25px",mt:"20px",ml:"50px",fontSize:"13px",backgroundColor:"#8DA6C6"},children:"Troubleshoot"})}),e.jsxs(o,{sx:{ml:"20px"},children:[e.jsx(o,{sx:{textAlign:"center"},children:"Status"}),e.jsxs(o,{children:[" ",e.jsx(ae,{variant:"contained",sx:{color:"white",height:"25px",width:"150px",fontSize:"13px",backgroundColor:"#8DA6C6"},children:h==null?void 0:h.value})]})]})]})},x))}):e.jsx(o,{children:H.length>0?e.jsx(o,{sx:{textAlign:"center",marginTop:"20%"},children:H}):e.jsx(o,{sx:{textAlign:"center",marginTop:"20%",color:C.grey[400]},children:"Wait!, Your request is in progress..."})})}),r&&r.length>0&&r[r.length-1].color==="green"&&r.length>0&&((l=r[r.length-1].log)==null?void 0:l.length)>0&&((n=r[r.length-1].log[0])==null?void 0:n.toLowerCase())==="20010000e1f0"&&((S=r[r.length-1].log[1])==null?void 0:S.toLowerCase())==="20010000e1f0"&&((b=r[r.length-1].log[2])==null?void 0:b.toLowerCase())==="20010000e1f0"&&e.jsxs(o,{sx:{display:"flex",position:"fixed",top:"85%",left:"38%"},children:[e.jsx(o,{sx:{mx:"20px"},children:e.jsx(ae,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:j,children:"Read Dtc"})}),e.jsx(o,{children:e.jsx(ae,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:()=>{m()},children:"Clear Dtc"})})]})]})},dr=()=>{var B,p,N,E,j;const t=de(),{vehicleList:s}=W(m=>m.liveMap),{selectedVehicle:r}=W(m=>m.diagnostics),{liveParameters:i,loading:u,isDtcLoader:k}=W(m=>m.diagnostics),{mode:g}=W(m=>m.dashboard),d=ne(g),[C,c]=y.useState(0),[T,H]=y.useState(!1),A=(s||[]).find(m=>{var I;return((I=m==null?void 0:m.imei[0])==null?void 0:I.mac_id)===(r==null?void 0:r.imei)})||{};y.useEffect(()=>{var m,I,R,L,P,l;if(((m=Object.keys(A))==null?void 0:m.length)>0&&((R=(I=A==null?void 0:A.sub_model)==null?void 0:I.ecus)==null?void 0:R.length)>0){let n=(l=(P=(L=A==null?void 0:A.sub_model)==null?void 0:L.ecus[C])==null?void 0:P.pid_datasets[0])==null?void 0:l.id;t(at({pid:n})),t(ot({pid:n}))}},[]);const w=(m,I)=>{var h,x;c(I);let R=(x=(h=A==null?void 0:A.sub_model)==null?void 0:h.ecus[I].pid_datasets[0])==null?void 0:x.id;t(at({pid:R})),t(ot({pid:R}));const{tx_header:L,rx_header:P,protocol:l}=m,n=`02${l.autopeepal},04${L},06${P}`;switch(A.sub_model.ecus[I].read_dtc_fn_index.value.split("_")[0]){case"GENERICOBD":{const f=se("4","03","00"),v=se("4","07","00");G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:f})),G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:v}));let D={imei:r.imei,commands:`{${f}, ${v}}`,tranCmd:`{${f}, ${v}}`};t(ue(D));break}case"UDS":{n||G.error("Please click again");let f,v=n.split(","),D=v==null?void 0:v.map(O=>{if((v==null?void 0:v.length)%2===0){G.error("The Tx Frame format is not right. Must be odd length.");return}return f=se("2",O,"00"),f});if(D){G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:D}));let O={imei:r.imei,commands:`{${D}}`,tranCmd:D};t(ue(O))}break}case"KWP":{const f=se("4","1800AF","00");G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:f}));let v={imei:r.imei,commands:`{${f}}`,tranCmd:`{${f}}`};t(ue(v));break}}};function _(m){return parseInt(m,16)}const $=async()=>{var P,l;let m=[],I=[];i.filter(n=>n.checked).forEach(n=>{const S=se("4",n.code,"00");m.push(S),I.push({command:S,id:n==null?void 0:n.id})}),G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:m.join(",")}));const R=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:r.imei,commands:`{${m}}`});let L;if((P=R==null?void 0:R.data)!=null&&P.success){let n=i;(l=R==null?void 0:R.data)==null||l.commands.forEach((S,b)=>{var a,Y;L="62100d02520970",L.slice(0,2)!=="62"&&G.error("Error From Device"),L=L==null?void 0:L.slice(6),L=L==null?void 0:L.slice(0,-4);let x=(a=I[b])==null?void 0:a.id,f=(Y=i.filter(F=>F.id===x)[0])==null?void 0:Y.pi_code_variable[0],v=(f==null?void 0:f.byte_position)-1,D=(f==null?void 0:f.length)*2,O=L.slice(v,D);if((f==null?void 0:f.message_type)==="CONTINUOUS"){let F=_(O),M=f==null?void 0:f.resolution,X=f==null?void 0:f.offset,K=F*M+X;n=n.map(U=>x===U.id?{...U,dataByt:K}:{...U})}else if((f==null?void 0:f.message_type)==="ASCII"){let F=hexToAscii(O);n=n.map(M=>x===M.id?{...M,dataByt:F}:{...M})}else(f==null?void 0:f.message_type)==="eNUM"?n=n.map(F=>x===F.id?{...F,dataByt:O}:{...F}):(f==null?void 0:f.message_type)==="bcd-hex"&&(n=n.map(F=>x===F.id?{...F,dataByt:O}:{...F}));t(me(n))})}};return console.log("ecus",A),e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[(u||k||T)&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((B=Object.keys(A))==null?void 0:B.length)>0&&((p=A==null?void 0:A.sub_model)==null?void 0:p.ecus.length)>0&&((N=A==null?void 0:A.sub_model)==null?void 0:N.ecus.map((m,I)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:C===I?"#333333":d.grey[400],mt:"20px",backgroundColor:C===I?"#D5E1FE":d.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{w(m,I)},children:e.jsx("b",{children:m.name})})})))}),e.jsxs(o,{children:[e.jsx(o,{sx:{ml:"30px",mt:"20px",color:d.grey[400]},children:e.jsx("span",{children:e.jsx("b",{children:C!==null&&((j=(E=A==null?void 0:A.sub_model)==null?void 0:E.ecus[C])==null?void 0:j.name)})})}),e.jsx("div",{style:{height:"60vh",overflow:"auto"},children:e.jsx(o,{sx:{mt:"20px"},children:i.filter(m=>m.checked).map((m,I)=>e.jsxs(o,{sx:{border:"1px solid grey",display:"flex",mx:"30px",mb:"10px",borderRadius:"5px",padding:"15px",color:d.grey[400]},children:[e.jsx(o,{sx:{width:"95%"},children:m.label}),e.jsxs(o,{children:[" ",m&&(m==null?void 0:m.dataByte)&&m.dataByte,m.pi_code_variable[0].unit]})]}))})}),e.jsx(o,{children:e.jsx(o,{sx:{display:"flex",mt:"20px",mx:"20px"},children:e.jsx(o,{children:e.jsx(ae,{variant:"contained",sx:{background:"#8DA6C6"},onClick:$,children:"Refresh"})})})})]})]})},pr=()=>{var K,U,te,re;const t=de(),{vehicleList:s}=W(z=>z.liveMap),{selectedVehicle:r}=W(z=>z.diagnostics);let i=JSON.parse(localStorage.getItem("w_userDetails"));const u={headers:{"Content-Type":"application/json",Authorization:`JWT ${(K=i==null?void 0:i.token)==null?void 0:K.access}`}},{mode:k}=W(z=>z.dashboard),g=ne(k),{selectedFlashingFile:d,ecuFotaId:C,fotaFiles:c}=W(z=>z.diagnostics),[T,H]=y.useState(0),[A,w]=y.useState(0),[_,$]=y.useState(0),[B,p]=y.useState(""),[N,E]=y.useState(""),[j,m]=y.useState(!1),[I,R]=y.useState(!1),[L,P]=y.useState(!1),[l,n]=y.useState(!1),[S,b]=y.useState(),[h,x]=y.useState(),[f,v]=y.useState({created_at:"",updated_at:""}),[D,O]=y.useState({created_at:"",updated_at:""}),a=(s||[]).find(z=>{var V;return((V=z==null?void 0:z.imei[0])==null?void 0:V.mac_id)===(r==null?void 0:r.imei)})||{};y.useEffect(()=>{var z,V,Z,J,Q,q,ee,oe,ce;if(((z=Object.keys(a))==null?void 0:z.length)>0&&((Z=(V=a==null?void 0:a.sub_model)==null?void 0:V.ecus)==null?void 0:Z.length)>0){let fe=(q=(Q=(J=a==null?void 0:a.sub_model)==null?void 0:J.ecus[T])==null?void 0:Q.pid_datasets[0])==null?void 0:q.id;t(Ue({pid:fe}));let pe=(ce=(oe=(ee=a==null?void 0:a.sub_model)==null?void 0:ee.ecus[T])==null?void 0:oe.ecu[0])==null?void 0:ce.file;pe=(pe==null?void 0:pe.map(xe=>({...xe,label:xe.sw_part_no})))||[],t(nt(pe))}},[a]),y.useEffect(()=>{var z,V,Z,J;if(r&&(r!=null&&r.imei)&&((z=a==null?void 0:a.sub_model)!=null&&z.ecus)&&((V=a==null?void 0:a.sub_model)==null?void 0:V.ecus.length)>0){let Q=(J=(Z=a==null?void 0:a.sub_model)==null?void 0:Z.ecus[T])==null?void 0:J.id;Y(Q)}},[r]),y.useEffect(()=>{},[d]);const Y=z=>{if(r&&(r!=null&&r.imei)){let V={created_by:JSON.parse(localStorage.getItem("w_userDetails")).user_id,imei:r.imei,ecu:z};ie.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/latest/ecu-fota/",V).then(J=>{var oe,ce,fe,pe,xe,Ye,Ke,ze,Xe,qe,Je,Qe,Ze,Ve;let Q=(oe=J==null?void 0:J.data)==null?void 0:oe.flashing_attempts,q=(ce=J==null?void 0:J.data)==null?void 0:ce.download_attempts;t(Oe((fe=J==null?void 0:J.data)==null?void 0:fe.id)),t(We((pe=J==null?void 0:J.data)==null?void 0:pe.server_sw));let ee=(Ke=(Ye=(xe=a.sub_model)==null?void 0:xe.ecus[T])==null?void 0:Ye.ecu[0])==null?void 0:Ke.file;if(ee&&ee.length>0){let _t=ee.find(St=>{var et;return St.sw_part_no===((et=J==null?void 0:J.data)==null?void 0:et.server_sw)});t(He(_t))}q&&(q==null?void 0:q.length)>0&&(b(q[0].id),w(q[0].latest_percentage),p(q[0].status),v({created_at:ve(new Date((ze=q[0])==null?void 0:ze.created)).format("DD-MM-YYYY HH:mm:ss"),updated_at:ve(new Date((Xe=q[0])==null?void 0:Xe.modified)).format("DD-MM-YYYY HH:mm:ss")}),q[0].latest_percentage<100&&q[0].status!=="Completed"&&q[0].status!=="Aborted"&&(P(!0),R(!0),n(!1),m(!1))),Q&&(Q==null?void 0:Q.length)>0&&($((qe=Q[0])==null?void 0:qe.latest_percentage),x((Je=Q[0])==null?void 0:Je.id),E((Qe=Q[0])==null?void 0:Qe.status),O({created_at:ve(new Date((Ze=Q[0])==null?void 0:Ze.created)).format("DD-MM-YYYY HH:mm:ss"),updated_at:ve(new Date((Ve=Q[0])==null?void 0:Ve.modified)).format("DD-MM-YYYY HH:mm:ss")}),Q[0].latest_percentage<100&&Q[0].status!=="Completed"&&Q[0].status!=="Aborted"&&(P(!1),R(!1),n(!0),m(!0)))}).catch(J=>{b(),x(),t(Oe("")),w(0),$(0),t(We("")),t(He({})),P(!1),R(!1),n(!1),m(!1)})}};y.useEffect(()=>{const z=setInterval(()=>{L&&I&&ie.get("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/ecufota/downloadattempt/list/?id="+S,u).then(Z=>{var Q,q,ee,oe;const J=parseInt(Z.data.results[0].latest_percentage);w(J),p(Z.data.results[0].status),v({created_at:ve(new Date((Q=Z.data.results[0])==null?void 0:Q.created)).format("DD-MM-YYYY HH:mm:ss"),updated_at:ve(new Date((q=Z.data.results[0])==null?void 0:q.modified)).format("DD-MM-YYYY HH:mm:ss")}),(J=="100"||Z.data.results[0].status==="Completed"||Z.data.results[0].status==="Aborted")&&(clearInterval(z),R(!1),P(!1),Y((oe=(ee=a==null?void 0:a.sub_model)==null?void 0:ee.ecus[T])==null?void 0:oe.id))}),l&&j&&ie.get("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/ecufota/flashingattempt/list/?id="+h,u).then(Z=>{var Q,q;const J=parseInt(Z.data.results[0].latest_percentage);$(J),E(Z.data.results[0].status),(J=="100"||Z.data.results[0].status==="Completed"||Z.data.results[0].status==="Aborted")&&(clearInterval(z),m(!1),Y((q=(Q=a==null?void 0:a.sub_model)==null?void 0:Q.ecus[T])==null?void 0:q.id))})},1e3);return()=>{clearInterval(z)}},[j,L,l,I,h,S]);const F=(z,V)=>{var Q,q,ee,oe;H(V);let Z=(Q=a==null?void 0:a.sub_model)==null?void 0:Q.ecus[V].id,J=(oe=(ee=(q=a.sub_model)==null?void 0:q.ecus[V])==null?void 0:ee.ecu[0])==null?void 0:oe.file;J=(J==null?void 0:J.map(ce=>({...ce,label:ce.sw_part_no})))||[],t(nt(J)),Y(Z)},M=()=>{var V,Z,J;if(d&&!Object.keys(d).length>0)return G.error("Please select the flashing file");R(!I),p(""),P(!1),w(0),m(!1),console.log("selected file",d);let z={};if(z.current_ws="null",z.server_sw=d==null?void 0:d.sw_part_no,z.status="OPEN",z.ecu=(Z=(V=a==null?void 0:a.sub_model)==null?void 0:V.ecus[T])==null?void 0:Z.id,z.imei=r.imei,z.created_by=JSON.parse(localStorage.getItem("w_userDetails")).user_id,!I)try{ie.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/create_ecufota/",z,u).then(q=>{let ee={};ee.ecu_fota=q.data.id,t(Oe(q.data.id)),ee.latest_percentage="0",ee.created_by=z.created_by,ee.status="New",ie.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/create/ecufota/downloadattempt/",ee,u).then(ce=>{P(!0),n(!1),b(ce.data.id)})}).catch(q=>{var ee;if(R(!1),P(!1),((ee=q==null?void 0:q.response)==null?void 0:ee.status)===401)return console.log("Session expired, dispatching logout"),t(lt()),G.error("Session Expired",{id:"clipboard"});q.message?G.error("Error occurred while downloading"):G.error("Internal server error")})}catch(Q){if(R(!1),P(!1),((J=Q==null?void 0:Q.response)==null?void 0:J.status)===401)return console.log("Session expired, dispatching logout"),t(lt()),G.error("Session Expired",{id:"clipboard"});Q.message?G.error("Error occurred while downloading"):G.error("Internal server error")}},X=()=>{if(d&&!Object.keys(d).length>0)return G.error("Please select the flashing file");if(!C)return G.error("Fota id missing. Please download the file first");if(A!="100"&&B!=="Aborted")return G.error("Start the download operation before proceeding");R(!1),m(!j),n(!1),$(0);let z={};if(z.ecu_fota=C,z.latest_percentage="0",z.created_by=d.created_by,z.status="New",z.latest_response="OK",!j)try{ie.post("https://cc.wikitrak.in/api-proxy/api/v1/devices/fotax/create/ecufota/flashingattempt/",z,u).then(Z=>{P(!1),n(!0),x(Z.data.id)}).catch(Z=>{m(!1),n(!1),m(!j),Z.message?G.error("error occurred while flashing"):G.error("Internal server error")})}catch{m(!1),n(!1),m(!j)}};return e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((U=Object.keys(a))==null?void 0:U.length)>0&&((te=a==null?void 0:a.sub_model)==null?void 0:te.ecus.length)>0&&((re=a==null?void 0:a.sub_model)==null?void 0:re.ecus.map((z,V)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:T===V?"#333333":g.grey[400],mt:"20px",backgroundColor:T===V?"#D5E1FE":g.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{F(z,V)},children:e.jsx("b",{children:z.name})})})))}),e.jsx(o,{children:e.jsxs(o,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-evenly",mt:"15px"},children:[e.jsxs("div",{children:["ECU Fota id :",C," "]}),e.jsxs("div",{children:["Download Status:",B," "]}),e.jsxs("div",{children:["Flashing Status :",N," "]})]}),e.jsx(o,{sx:{mt:"50px",color:g.grey[400]},children:e.jsx("h2",{style:{textAlign:"center"},children:"Start : Downloading"})}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-around"},children:[e.jsxs(o,{children:[e.jsx(o,{sx:{my:"50px",color:"white",textAlign:"center"},children:e.jsx(ft,{type:"circle",percent:A,size:180,strokeColor:"#8DA6C6",trailColor:"#d1d1d1",format:()=>e.jsxs("div",{style:{color:g.grey[400]},children:[A,"%"]})})}),e.jsx(o,{sx:{textAlign:"center"},children:e.jsx(ae,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:M,children:I?"Stop Downloading":"Start Downloading"})}),e.jsxs(o,{sx:{textAlign:"left"},children:[e.jsxs("p",{children:["Start Time: ",f.created_at]}),e.jsxs("p",{children:["Last Updated Time: ",f.updated_at]})]})]}),e.jsxs(o,{children:[e.jsx(o,{sx:{my:"50px",textAlign:"center"},children:e.jsx(ft,{type:"circle",percent:_,size:180,trailColor:"#d1d1d1",strokeColor:"#8DA6C6",format:()=>e.jsxs("div",{style:{color:g.grey[400]},children:[_,"%"]})})}),e.jsx(o,{sx:{textAlign:"center"},children:e.jsxs(ae,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:X,disabled:L,children:[" ",j?"Stop Flashing...":"Start Flashing"]})}),e.jsxs(o,{sx:{textAlign:"left"},children:[e.jsxs("p",{children:["Start Time: ",D.created_at]}),e.jsxs("p",{children:["Last Updated Time: ",D.updated_at]})]})]})]})]})})]})},ur="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALySURBVHgB7Zi/bxJhGMefOw6O6a4LnUpjUjrVoa1TnWwX6yKd7CIYE3VRE1EX/gIGNTFRFzVpog6CS3GxLoILdKk6wGSHJjDBAkxQNPh+X3sEz+NAkub10veTXODe97n3eb7Pj2uDQoxUKnVK8/u3iJRFdjtF/zk96m3/7HYTyWTyQPkdfOAreSBwG40f3cMl1acFHpP3ggdTml/fUhWFouRZeosqeZsprwsgKUA0UoBopADRSAGikQJEIwWI5uQK0HX9WO3HZSIBpxcW6Patm2QYxlj29+/dpTPLy3QcaKMMkLn5SIR/bzabVKlW+3vToRCZTESz1aIWuyKROQrqQWp32lSr1fmaBcSGZ2ao0+lQrV7nz7bZd8sGe1jHvpvPfxYQj12mYDDIA9L1AL16/aa/t7a2yj9zuTx3fGF9nTlskWka1G63uS3Wwfx8hGZnw+ycGm1n39PGRpRKpTIVikWehM3NS5ROZ3iwgz7xG0Q6824yATjYNE36sPORyuXyX/tvmcPBLD95+ox/Tk+HWBAxmg2H6fv+Pl/b2/vCgx1FCFVlPrNMpPWsG64C0BqVSpVl9jwr6RwVCkVeZifQIuhzZBplB4EJBrd11I7R6MV+hQaTZGfkEKczGV5ywzApHo/xXnXi7MoKD/4Ta6dCcfePPauN7Di9mWD7/MVL2mFVR8tdYT7d3mAjBSDgSqVCuXye36M3m9bghWd45nHBCR9Q1uO47EHBFoOLC2BWrDWDtcygKPgssZZF6+LeesaJkTOA4bJAO9XqNe4cQWJoAYa4uFukjWiUbly/1rc/PMo8+n919RyvINoBGc7lc9wea5ZIYDj4dHsLKQ8ePuqRC8iAVUJ7L1p/B+yvSydb65xxznDzaWfkaxSZGdbDTocPczjsHCd7N5925D9zopECRCMFiEYKEI0UIBopQDRSgGggoEEehglQvpFH6fUoq2o+5Sp5sAqKojT8mnpHTSQSB5pPXYIa8gAInMX62acqS4j9F+WkUOZ/3jqMAAAAAElFTkSuQmCC";var Ge={},xr=ps;Object.defineProperty(Ge,"__esModule",{value:!0});var jt=Ge.default=void 0,gr=xr(us()),hr=e;jt=Ge.default=(0,gr.default)((0,hr.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");const fr=()=>{const{vehicleList:t}=W(_=>_.liveMap),{terminalAppLogs:s,loading:r,selectedVehicle:i}=W(_=>_.diagnostics),{mode:u}=W(_=>_.dashboard),k=ne(!u),g=[5,2,4],d=de(),[C,c]=y.useState(5),[T,H]=y.useState();y.useEffect(()=>{Object.keys(i).length>0&&d(ue({imei:`${i==null?void 0:i.imei}`,commands:"{500a0047568afe56214e238000ffc3}",tranCmd:"500a0047568afe56214e238000ffc3"}))},[i]);const A=()=>{if(!T)return G.error("Please enter value");let _=T.split(","),$,B=!1;if(_=_.map(p=>{if((p==null?void 0:p.length)%2!==0){B=!0,G.error("The Tx Frame format is not right. Must be even length.");return}return $=se(C,p,"00"),$}),!B)if(Object.keys(i).length>0){let p={imei:i.imei,commands:`{${_}}`,tranCmd:_};d(ue(p))}else G.error("Please Select Vehicle",{id:"clipBoard"})},w=()=>{G.success("Copied to clipboard!");let _=[];_=s.map(B=>B.timestamp+" "+B.log);const $=document.createElement("textarea");$.value=_.length===0?" ":_.join(`
`),document.body.appendChild($),$.select(),document.execCommand("copy"),document.body.removeChild($)};return e.jsxs(o,{children:[r&&e.jsx(Se,{}),e.jsxs(o,{children:[e.jsxs(o,{children:[e.jsx(o,{sx:{display:"flex",justifyContent:"space-around"},children:g.map((_,$)=>e.jsxs("button",{style:{textAlign:"center",padding:"10px 20px",borderRadius:"5px",cursor:"pointer",width:"165px",margin:"20px",border:"1px solid #8DA6C6",backgroundColor:_===C?"#8DA6C6":"white",color:_===C?"white":"#8DA6C6"},onClick:B=>{c(_)},children:[_,"0"]}))}),e.jsxs(o,{sx:{display:"flex"},children:[e.jsx(bt,{name:"txFrame",type:"text",value:T,style:{width:"75%",height:"45px",border:"1px solid #8DA6C6",borderRadius:5,background:"#8DA6C6",color:"white",marginLeft:"9%"},pattern:"[A-Fa-f0-9,]+",onChange:_=>H(_.target.value),placeholder:"ENTER VALUE",className:"white-placeholder"}),e.jsx(xs,{onClick:A,style:{margin:"5px"},children:"Send"}),e.jsx("img",{src:ur,style:{height:"44px",marginLeft:"15px",cursor:"pointer"}})]})]}),e.jsxs(o,{style:{background:k.grey[100],width:"90%",minHeight:"68vh",borderRadius:"2px",display:"flex",justifyContent:"space-between",flexDirection:"row",margin:"30px 60px",overflowY:"auto",color:k.grey[400]},children:[s&&e.jsx("div",{style:{textTransform:"uppercase",fontSize:"12px",padding:"20px"},children:s.map(_=>e.jsxs("p",{style:{display:"flex"},children:[e.jsx("span",{style:{marginLeft:"5px"},children:_.timestamp}),e.jsx("span",{style:{height:"15px",width:"15px",backgroundColor:_.color,borderRadius:"50%",marginLeft:"5px"}}),e.jsx("span",{style:{marginLeft:"5px"},children:_.log})]}))}),e.jsxs(o,{style:{display:"flex",justifyContent:"flex-end",padding:"20px",gap:"10px"},children:[e.jsx(jt,{style:{cursor:"pointer"},onClick:()=>d(gs())}),e.jsx(hs,{style:{cursor:"pointer"},onClick:()=>w()})]})]})]})]})};let Ee={Sanitas_BOSCH_BS6_PROD:"01",Sanitas_ADVANTEK_BS6_PROD:"02",Sanitas_ADVANTEK_BS4_PROD:"03",KOEL_BOSCH_BS4:"04",FLASH_KOEL_BOSCH_F6_CPCB4:"05",GREAVES_BOSCH_BS6_PROD:"02",ATUL_ADVANTEK_BS6_A46:"04",TVS_ADVANTEK_BS6_A46:"05",GREAVES_SEDEMAC_BL_BS6:"07",GREAVES_SEDEMAC_APP_BS6:"08",SEEDKEYALGO_VECV_BOSCH_BS6_01:"11",KOEL_AUTO_BS4:"12",KOEL_CPCB4_LOW_HP_ECU:"03",KOEL_CPCB4_HIGH_HP_ECU:"14",KOEL_CPCB4_MID_HP_ECU:"04",TATA_DNOX:"31"},De=t=>{let s="";return t==="SML_BOSCH_BS6_PROD"||t==="KOEL_BOSCH_BS4"?s="08":t==="SEEDKEYALGO_VECV_DELPHI_BS6"||t==="SEEDKEYALGO_VECV_AMT_BS6"?s="04":t==="SEEDKEYALGO_VECV_DELPHI_TCIC"?s="02":t==="GREAVES_BOSCH_BS6_PROD"||t==="GREAVES_BOSCH_BS6_DEV"?s="04":t==="Sanitas_BOSCH_BS6_PROD"||t==="KOEL_BOSCH_BS4"?s="08":t==="SEEDKEYALGO_VECV_DELPHI_BS6"||t==="SEEDKEYALGO_VECV_AMT_BS6"?s="04":t==="SEEDKEYALGO_VECV_DELPHI_TCIC"||t==="SEEDKEYALGO_VECV_DELPHI_TCIC"?s="02":t==="GREAVES_BOSCH_BS6_PROD"||t==="GREAVES_BOSCH_BS6_DEV"?s="04":s="08",s};const mr=()=>{var L,P,l;const t=de(),{vehicleList:s}=W(n=>n.liveMap),{selectedVehicle:r}=W(n=>n.diagnostics),{mode:i}=W(n=>n.dashboard),u=ne(i),{activeWriteParameter:k,selectedWriteParam:g,loading:d,isDtcLoader:C}=W(n=>n.diagnostics),[c,T]=y.useState(0),[H,A]=y.useState(null),[w,_]=y.useState(null),[$,B]=y.useState(""),p=(s||[]).find(n=>{var S;return((S=n==null?void 0:n.imei[0])==null?void 0:S.mac_id)===(r==null?void 0:r.imei)})||{};y.useEffect(()=>{var n,S,b,h,x,f;if(((n=Object.keys(p))==null?void 0:n.length)>0&&((b=(S=p==null?void 0:p.sub_model)==null?void 0:S.ecus)==null?void 0:b.length)>0){let v=(f=(x=(h=p==null?void 0:p.sub_model)==null?void 0:h.ecus[c])==null?void 0:x.pid_datasets[0])==null?void 0:f.id;t(it({pid:v}))}},[]);const N={padding:"10px 10px",width:"28.5vw",borderRadius:"5px",border:"1px solid grey",backgroundColor:"white",color:"black"},E=(n,S)=>{var a,Y;T(S);let b=(Y=(a=p==null?void 0:p.sub_model)==null?void 0:a.ecus[S].pid_datasets[0])==null?void 0:Y.id;t(it({pid:b}));const{tx_header:h,rx_header:x,protocol:f}=n,v=`02${f.autopeepal},04${h},06${x}`;switch(p.sub_model.ecus[S].read_dtc_fn_index.value.split("_")[0]){case"GENERICOBD":{const F=se("4","03","00"),M=se("4","07","00");G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:F})),G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:M}));let X={imei:r.imei,commands:`{${F}, ${M}}`,tranCmd:`{${F}, ${M}}`};t(ue(X));break}case"UDS":{v||G.error("Please click again");let F,M=v.split(","),X=M==null?void 0:M.map(K=>{if((M==null?void 0:M.length)%2===0){G.error("The Tx Frame format is not right. Must be odd length.");return}return F=se("2",K,"00"),F});if(X){G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:X}));let K={imei:r.imei,commands:`{${X}}`,tranCmd:X};t(ue(K))}break}case"KWP":{const F=se("4","1800AF","00");G.success(e.jsx("span",{style:{wordBreak:"break-all"},children:F}));let M={imei:r.imei,commands:`{${F}}`,tranCmd:`{${F}}`};t(ue(M));break}}};function j(n,S){if(n.length>=S)return n;{const b=S-n.length;return"0".repeat(b)+n}}function m(n,S,b){return b<0?S+n:b>=n.length?n+S:(n.slice(b,b+S.length),n.slice(0,b)+S+n.slice(b+S.length))}const I=async()=>{var F,M,X,K,U,te,re,z,V,Z,J,Q;if(Object.keys(g).length===0)return G.error("Please select a write parameter");if(!H)return G.error("Please enter a write value");t(le(!0));let n="",S,b;const h=g==null?void 0:g.pi_code_variable[0];console.log("element",h.message_type);let x;isNaN(H)?x=[...H].map(q=>q.charCodeAt(0).toString(16).padStart(2,"0")).join(""):x=fs(parseInt(H));let f=j(x,(h==null?void 0:h.length)*2),v=h!=null&&h.byte_position?(h.byte_position-1)*2:0,D=m(n,f,v);D=`2E${g==null?void 0:g.write_pid}${D}`,D=se(4,D,"00");const a=p.sub_model.ecus[c],Y=(F=a==null?void 0:a.write_data_fn_index)==null?void 0:F.value;b=se(4,"1003","00"),Y==="UDS_DS1003_SK090A"?S=`35${Ee[(M=a==null?void 0:a.seedkeyalgo_fn_index)==null?void 0:M.value]}${De((X=a==null?void 0:a.seedkeyalgo_fn_index)==null?void 0:X.value)}02270902270A`:Y==="UDS_DS1003_SK0102"?S=`35${Ee[(K=a==null?void 0:a.seedkeyalgo_fn_index)==null?void 0:K.value]}${De((U=a==null?void 0:a.seedkeyalgo_fn_index)==null?void 0:U.value)}022701022702`:Y==="UDS_DS1003_SK0B0C"?S=`35${Ee[(te=a==null?void 0:a.seedkeyalgo_fn_index)==null?void 0:te.value]}${De((re=a==null?void 0:a.seedkeyalgo_fn_index)==null?void 0:re.value)}02270B02270C`:(Y==="UDS_DS1003_SK0304"||Y==="UDS_DS1003_SK0506")&&(S=`35${Ee[(z=a==null?void 0:a.seedkeyalgo_fn_index)==null?void 0:z.value]}${De((V=a==null?void 0:a.seedkeyalgo_fn_index)==null?void 0:V.value)}022703022704`),S=se(2,S,"00");try{const q=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:r.imei,commands:`{${b},${S},${D}}`});if((Z=q==null?void 0:q.data)!=null&&Z.success){t(le(!1));let ee="",oe="";(Q=(J=q==null?void 0:q.data)==null?void 0:J.commands)==null||Q.forEach(ce=>{const fe=ce.slice(0,2),pe=ce.slice(6),xe=pe.slice(0,2);fe==="40"&&(xe==="7f"?(oe=ct(pe.slice(4,6)),ee="Negative Response"):xe==="ff"&&(ee="No response from ecu")),fe==="20"&&xe==="01"&&(oe=ct(pe.slice(4,6)),ee="Negative Response")}),ee?(_(`${ee} ${oe}`),G.error(ee)):(_("Positive response from ecu"),G.success("Positive response from ecu"))}}catch{t(le(!1)),G.error("Failed to send command")}},R=async()=>{var b,h,x;t(le(!0));let n=se(4,g.code,"00"),S="";try{const f=await ie.post("https://cc.wikitrak.in/proxy-3031/api/commands/diagnostics",{imei:r.imei,commands:`{${n}}`});if((b=f==null?void 0:f.data)!=null&&b.success){t(le(!1)),S=(h=f==null?void 0:f.data)==null?void 0:h.commands[0];const v=mt(S);if(console.log("cmd val",v),!v.startsWith("62")){G.error(`Negative response from ecu for ${D==null?void 0:D.short_name}`);return}let D=g==null?void 0:g.pi_code_variable[0],O=g;const{byte_position:a,length:Y,resolution:F,offset:M,message_type:X}=D;let K=v==null?void 0:v.toLowerCase().replace((x=g==null?void 0:g.code)==null?void 0:x.toLowerCase().slice(2),"").slice(2);console.log("Decoded Data:",K);let U;switch(X){case"CONTINUOUS":U=Pe(K)*F+M;break;case"ASCII":U=Ie(K);break;case"eNUM":case"bcd-hex":U=K;break;default:return}B(U)}}catch{t(le(!1))}};return e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"80vh",borderRadius:"5px",margin:"10px 20px"},children:[(d||C)&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((L=Object.keys(p))==null?void 0:L.length)>0&&((P=p==null?void 0:p.sub_model)==null?void 0:P.ecus.length)>0&&((l=p==null?void 0:p.sub_model)==null?void 0:l.ecus.map((n,S)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:c===S?"#333333":u.grey[400],mt:"20px",backgroundColor:c===S?"#D5E1FE":u.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{E(n,S)},children:e.jsx("b",{children:n==null?void 0:n.name})})})))}),e.jsxs(o,{children:[e.jsx(o,{sx:{ml:"30px",my:"65px",color:u.grey[400],textAlign:"center",fontSize:"25px"},children:e.jsx("span",{children:e.jsx("b",{children:k||"Please select the parameter"})})}),e.jsx(o,{sx:{ml:"30px",color:k?"red":"green",textAlign:"center",fontSize:"15px"},children:e.jsx("span",{children:w})}),e.jsxs(o,{sx:{display:"flex",m:"20px",color:u.grey[400]},children:[e.jsxs(o,{children:[e.jsx("div",{style:{marginBottom:"5px"},children:e.jsx("b",{children:"Current value"})}),e.jsx("input",{style:N,value:$,disabled:!0}),e.jsx(o,{children:e.jsx(ae,{variant:"contained",sx:{m:"10px",backgroundColor:"#8DA6C6"},onClick:R,children:"Read Here"})})]}),e.jsx(o,{sx:{m:"20px",color:u.grey[400]},children:e.jsx("div",{style:{marginTop:"5px"},children:e.jsx("b",{children:"UNIT"})})}),e.jsxs(o,{children:[e.jsx("div",{style:{marginBottom:"5px"},children:e.jsx("b",{children:"Write value"})}),e.jsx("input",{style:N,placeholder:"Enter here",value:H,onChange:n=>A(n.target.value)})]})]}),e.jsx(o,{children:e.jsx(o,{sx:{display:"flex",justifyContent:"center",mt:"30px"},children:e.jsx(o,{children:e.jsx(ae,{variant:"contained",sx:{backgroundColor:"#8DA6C6"},onClick:I,children:"Submit"})})})})]})]})},Ne=()=>{var H,A,w;const{mode:t}=W(_=>_.dashboard),s=ne(t),r=de(),{vehicleList:i}=W(_=>_.liveMap),{selectedVehicle:u}=W(_=>_.diagnostics),{ecuInfo:k,loading:g}=W(_=>_.diagnostics),[d,C]=y.useState(0),c=(i||[]).find(_=>{var $;return(($=_==null?void 0:_.imei[0])==null?void 0:$.mac_id)===(u==null?void 0:u.imei)})||{};y.useEffect(()=>{var _,$,B,p,N,E;if(((_=Object.keys(c))==null?void 0:_.length)>0&&((B=($=c==null?void 0:c.sub_model)==null?void 0:$.ecus)==null?void 0:B.length)>0){let j=(E=(N=(p=c==null?void 0:c.sub_model)==null?void 0:p.ecus[0])==null?void 0:N.pid_datasets[0])==null?void 0:E.id;r(Ue({pid:j}))}},[]);const T=(_,$)=>{var p,N;C($);let B=(N=(p=c==null?void 0:c.sub_model)==null?void 0:p.ecus[$].pid_datasets[0])==null?void 0:N.id;r(Ue({pid:B}))};return e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[g&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:((H=Object.keys(c))==null?void 0:H.length)>0&&((A=c==null?void 0:c.sub_model)==null?void 0:A.ecus.length)>0&&((w=c==null?void 0:c.sub_model)==null?void 0:w.ecus.map((_,$)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:d===$?"#333333":s.grey[400],mt:"20px",backgroundColor:d===$?"#D5E1FE":s.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{T(_,$)},children:e.jsx("b",{children:_.name})})})))}),e.jsx(o,{sx:{color:s.grey[400]},children:k&&(k==null?void 0:k.length)>0&&k.map((_,$)=>e.jsxs(o,{sx:{border:"1px solid grey",display:"flex",m:"30px",borderRadius:"5px",padding:"15px"},children:[e.jsx(o,{sx:{width:"95%"},children:_.label}),e.jsx(o,{children:_.pi_code_variable[0].unit})]}))})]})},br=()=>{var $,B,p,N,E;const t=de(),{vehicleList:s}=W(j=>j.liveMap),{selectedVehicle:r}=W(j=>j.diagnostics),{j1939Parameters:i,liveParameters:u,loading:k,isDtcLoader:g}=W(j=>j.diagnostics),{mode:d}=W(j=>j.dashboard),C=ne(d),[c,T]=y.useState(0),[H,A]=y.useState(!1),w=(s||[]).find(j=>{var m;return((m=j==null?void 0:j.imei[0])==null?void 0:m.mac_id)===(r==null?void 0:r.imei)})||{};y.useEffect(()=>{var j,m,I,R,L,P;if(((j=Object.keys(w))==null?void 0:j.length)>0&&((I=(m=w==null?void 0:w.sub_model)==null?void 0:m.ecus)==null?void 0:I.length)>0){let l=(P=(L=(R=w==null?void 0:w.sub_model)==null?void 0:R.ecus[c])==null?void 0:L.j1939_datasets[0])==null?void 0:P.id;t(dt({pid:l}))}},[]);const _=(j,m)=>{var R,L;T(m);let I=(L=(R=w==null?void 0:w.sub_model)==null?void 0:R.ecus[m].j1939_datasets[0])==null?void 0:L.id;t(dt({pid:I}))};return console.log("ecus",w),e.jsxs(o,{sx:{border:"1px solid #dee0e3",height:"87vh",borderRadius:"5px",margin:"10px 20px"},children:[(k||g||H)&&e.jsx(Se,{}),e.jsx(o,{sx:{display:"flex",fontSize:"12px",pl:"30px"},children:(($=Object.keys(w))==null?void 0:$.length)>0&&((B=w==null?void 0:w.sub_model)==null?void 0:B.ecus.length)>0&&((p=w==null?void 0:w.sub_model)==null?void 0:p.ecus.map((j,m)=>e.jsx(o,{children:e.jsx(o,{variant:"contained",sx:{color:c===m?"#333333":C.grey[400],mt:"20px",backgroundColor:c===m?"#D5E1FE":C.grey[100],fontSize:"15px",padding:"10px 18px",borderTopRightRadius:"5px",borderTopLeftRadius:"5px",cursor:"pointer"},onClick:()=>{_(j,m)},children:e.jsx("b",{children:j.name})},j.id)})))}),e.jsxs(o,{children:[e.jsx(o,{sx:{ml:"30px",mt:"20px",color:C.grey[400]},children:e.jsx("span",{children:e.jsx("b",{children:c!==null&&((E=(N=w==null?void 0:w.sub_model)==null?void 0:N.ecus[c])==null?void 0:E.name)})})}),e.jsx("div",{style:{height:"60vh",overflow:"auto"},children:e.jsx(o,{sx:{mt:"20px"},children:i.filter(j=>j.checked).map((j,m)=>e.jsxs(o,{sx:{border:"1px solid grey",display:"flex",mx:"30px",mb:"10px",borderRadius:"5px",padding:"15px",color:C.grey[400]},children:[e.jsx(o,{sx:{width:"95%"},children:j.label}),e.jsxs(o,{children:[" ",j&&(j==null?void 0:j.dataByte)&&j.dataByte,j.spn[0].unit]})]}))})}),e.jsx(o,{children:e.jsx(o,{sx:{display:"flex",mt:"20px",mx:"20px"}})})]})]})};let yr=["RetroFotax","Sinocastel"];const vr=()=>{const t=de(),{isTerminal:s,isReadDtc:r,isLiveParameter:i,isWriteParameter:u,isActuator:k,isRoutineTest:g,isEcuInfo:d,isFlashing:C,selectedVehicle:c,isJ1939:T}=W(n=>n.diagnostics),{w_customer_id:H}=W(n=>n.auth),{mode:A}=W(n=>n.dashboard),[w,_]=y.useState(!1),[$,B]=y.useState(!0),[p,N]=y.useState(!1),[E,j]=y.useState([]),[m,I]=y.useState(null),R=ne(A);y.useEffect(()=>{L()},[]);const L=async()=>{try{const n=await t(ms({w_customer_id:H}));if(!Array.isArray(n.payload)){G.error("Unexpected data format");return}const S=n.payload.filter(b=>{var h;return Array.isArray(b.imei)&&((h=b.imei[0])==null?void 0:h.mac_id)}).map(b=>{var h,x;return{...b,id:b.id,label:b.registration_id,value:(h=b.imei[0])==null?void 0:h.mac_id,vehilce_type:b==null?void 0:b.segment,chassis_no:b==null?void 0:b.chassis_no,engine_no:b==null?void 0:b.engine_no,workShop:b==null?void 0:b.workshop,registration_id:b==null?void 0:b.registration_id,sell_date:b==null?void 0:b.sell_date,customer_name:b==null?void 0:b.customer_name,vehicle_model:(x=b==null?void 0:b.vehicle_model)==null?void 0:x.name,user:b==null?void 0:b.user,vehicle_group:b==null?void 0:b.vehicle_group}});j(S),t(bs(S))}catch(n){console.error("Error fetching vehicle data:",n),G.error("Error fetching vehicle data")}},P=n=>{var b,h;const S=(h=(b=n==null?void 0:n.imei)==null?void 0:b[0])==null?void 0:h.device_typ;I(S),t(js({imei:n.value,reg_id:n.label})),t(_s(n)),_(!1),N(!1)},l=()=>m==="RetroFotax"?e.jsxs(e.Fragment,{children:[k&&e.jsx(Ne,{}),d&&e.jsx(Ne,{}),s&&e.jsx(fr,{}),r&&e.jsx(cr,{}),u&&e.jsx(mr,{}),i&&e.jsx(dr,{}),g&&e.jsx(Ne,{}),C&&e.jsx(pr,{}),T&&e.jsx(br,{})]}):m==="Sinocastel"?e.jsxs(e.Fragment,{children:[s&&e.jsx(vs,{}),r&&e.jsx(ks,{}),i&&e.jsx(ws,{})]}):e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",color:"grey",height:"90%"},children:e.jsx("h1",{children:!Object.keys(c).length>0?"Please select a vehicle.":"Diagnostic not available for this device"})});return e.jsxs("div",{className:"app",children:[e.jsx(ys,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(Vs,{title:"Diagnostics",setShowVehicles:_,showParams:p,setShowParams:N,showVehicles:w}),e.jsxs(o,{sx:{display:"flex",background:"#F5F5F5"},children:[e.jsx(o,{sx:{width:"80%",background:R.grey[100]},children:l()}),e.jsxs(o,{sx:{width:"20%",backgroundColor:R.grey[100],height:"90vh"},children:[w&&e.jsx(er,{vehicleData:E.filter(n=>{var S;return yr.includes((S=n==null?void 0:n.imei[0])==null?void 0:S.device_typ)}),handleChange:P}),!w&&!p&&e.jsx(tr,{options:Cs.filter(n=>n.allowedDevice.includes(m)),handleChange:()=>{},dota:!0,trip:!0}),p&&e.jsx(sr,{deviceType:m})]})]})]})]})};export{vr as default};
