import{n as le,j as e,z as V,b as c,y as se,a_ as te,b7 as pe,b8 as me,b9 as re,ba as de,bb as xe,bc as ie,a5 as U,V as ce,C as E,bd as be,T as M,M as d,I as Q,G as Y,F as _e,be as ge,bf as fe,aB as je,aQ as ve,ae,a0 as we,a1 as ye,a3 as Se,a4 as Be,E as Ce}from"./index-D4iVSzVY.js";import{V as ke}from"./VehicleMenu-Cfekvmrq.js";import{t as Pe}from"./SearchTab-D1tuMu_p.js";import"./Loader-CbIoOgIR.js";import"./LiveMapServices-D3JXDEZp.js";import"./Socket-CiOS8h_I.js";import{P as Ve}from"./Parameters-kkuhm1Xk.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as qe}from"./LeftSideBar2-B6oYdQAC.js";import{I as Te}from"./InspectionsTable-u26TPaJm.js";import{c as Fe,a as y}from"./index.esm-BNwzxsMD.js";import{V as Ae}from"./VehicleGroups-40DHKEV7.js";import{P as K}from"./index-CCpCRYrZ.js";import{S as Le}from"./ServiceRecordTable-CC1T6Dsd.js";import{d as Re}from"./Close-EQ3RXBcM.js";import{a as Ee}from"./formik.esm-CFCkvUGl.js";import{B as f}from"./CircularProgress-Cwyu3UN0.js";import{A as X}from"./Autocomplete-UHtk6FJR.js";import{T as g}from"./TextField-C0bSE_Rq.js";import{F as Ie,a as We,S as Me,M as Z}from"./menu2-DSLJVsKq.js";import{D as Oe}from"./Delete-CdRCWNi4.js";import{S as $e}from"./SearchInput-UwGgNGaO.js";import{D as Ge,a as Ne,b as De}from"./DialogTitle-Doe521zb.js";import{T as ze,a as oe}from"./Tabs-BD-mh9zp.js";import{S as He}from"./ServicesTopBar-C3yP5kNa.js";import"./createSvgIcon-eLUiZ2Yl.js";import"./useControlled-B-zqb07e.js";import"./Card-CBXImXCC.js";import"./CardContent-Z1QbT6fN.js";import"./Edit-ROSlukWy.js";import"./TableRow-BVmcoVxJ.js";import"./TablePagination-C0ybdT36.js";import"./DateTimePicker-Bc7MgX3K.js";import"./NewLoader-DPAb9tcj.js";import"./index-BM9xfWjr.js";import"./usePreviousProps-BIpGGFJw.js";const Je=le(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),Qe=le(e.jsx("path",{d:"M19 13H5v-2h14z"}),"Remove");function Ye({searchTerm:b}){var R,N,x,D,z,H;const{vehicles_details:j}=V(t=>t.dashboard),{breakdownTopics:S,UpdatedBreakdownData:v}=V(t=>t.breakdown),{UpdatedInspectionData:r,sparePartList:B}=V(t=>t.inspection),{w_customer_id:P}=V(t=>t.auth),[O,C]=c.useState(null),[$,q]=c.useState(""),[A,T]=c.useState(!1);let p=se(),I=JSON.parse(localStorage.getItem("w_userDetails"));c.useEffect(()=>{console.log("UpdatedInspectionData1111",r)},[r]),c.useEffect(()=>{r&&C(r.resolve_attachment)},[r]);const W=t=>{const i=new FormData;return i.append("vehicle",t.vehicle),i.append("breakdown_topic",t.breakdown_topic),i.append("odometer_reading",t.odometer_reading),i.append("description",t.description),i.append("mob_no",t.mob_no),i.append("email",t.email),i.append("submitted_by",t.submitted_by),i.append("resolved_issue",t.resolved_issue),i.append("pending_issue",t.pending_issue),i.append("status",t.status),i.append("type",t.type),t.resolve_attachment instanceof File&&i.append("resolve_attachment",t.resolve_attachment),t.issued_attachment instanceof File&&i.append("issued_attachment",t.issued_attachment),i};let L=r==null?void 0:r.inspection_parts_inspection.map(t=>{var i;return{spare_parts:(i=t==null?void 0:t.spare_parts)==null?void 0:i.id,quantity:t==null?void 0:t.quantity}});console.log("spare parts",L);const s=Ee({initialValues:{id:r==null?void 0:r.id,vehicle:((R=r==null?void 0:r.vehicle)==null?void 0:R.id)||"",breakdown_topic:((x=(N=r==null?void 0:r.breakdown)==null?void 0:N.breakdown_topic)==null?void 0:x.id)||"",odometer_reading:(r==null?void 0:r.odometer_reading)||"",description:(r==null?void 0:r.description)||"",mob_no:((D=r==null?void 0:r.breakdown)==null?void 0:D.mob_no)||"",email:((z=r==null?void 0:r.breakdown)==null?void 0:z.email)||"",resolve_attachment:(r==null?void 0:r.resolve_attachment)||null,submitted_by:`${I.first_name} ${I.last_name}`||"",resolved_issue:(r==null?void 0:r.resolved_issue)||"",pending_issue:r==null?void 0:r.pending_issue,status:(r==null?void 0:r.status)||"Open",inspection_parts_inspection:L||null,issued_attachment:r==null?void 0:r.issued_attachment,type:r==null?void 0:r.type},validationSchema:Fe({vehicle:y().required("Vehicle is required"),breakdown_topic:y().required("Breakdown Topic is required"),odometer_reading:y().required("Odometer Reading is required"),description:y().required("Description is required"),mob_no:y().matches(/^\d{10,11}$/,"Mobile number must be 10-11 digits").required("Mobile number is required"),email:y().email("Invalid email format").required("Email is required"),resolved_issue:y().required("Resolved issue is required"),pending_issue:y().required("Pending issue is required"),status:y().oneOf(["Open","Close","Rejected"],"Invalid status").required("Status is required"),submitted_by:y().required("Submitted is required")}),onSubmit:async(t,{resetForm:i})=>{var o,u,m,n;try{T(!0),t.submitted_by=I.user_id,console.log("submit value",t);let h=null;t!=null&&t.issued_attachment&&(h=await te(t==null?void 0:t.issued_attachment));let a=null;t!=null&&t.resolve_attachment&&(a=await te(t==null?void 0:t.resolve_attachment)),t.issued_attachment=h||null,console.log("Submitted values:",t);let k=W(t);console.log("formdata11",k);const l=await p(pe({values:k,id:r==null?void 0:r.id}));if(console.log("response",(o=l==null?void 0:l.payload)==null?void 0:o.success),(u=l==null?void 0:l.payload)!=null&&u.success){console.log("response?.payload?.status",(m=l==null?void 0:l.payload)==null?void 0:m.data);const{id:F}=(n=l==null?void 0:l.payload)==null?void 0:n.data,{inspection_parts_inspection:ue}=t;let he=await p(me({inspection:F,parts:ue}));console.log("response2",he),i(),q(""),C(null),p(re(null)),p(de(!1)),p(xe(null)),p(ie(!1)),p(U(P)),p(ce()),T(!1)}else E.error("Error occurred during submission");const J=[];!0&&(i(),q(""),C(null),p(re(null)),p(ie(!1)),p(be(!1)),p(U(P))),T(!1)}catch(h){console.error("Submission Error:",h),E.error("Failed to submit breakdown or inspection. Please try again."),T(!1)}}}),G=t=>{const i=t.currentTarget.files[0];if(s.setFieldValue("resolve_attachment",i),q((i==null?void 0:i.name)||""),i&&i.type.startsWith("image/")){const o=new FileReader;o.onload=()=>C(o.result),o.readAsDataURL(i)}else C(null)},w=!!r;return e.jsx(f,{sx:{p:3,margin:"auto"},children:A?e.jsx(M,{children:"Submitted the form data..."}):e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:s.handleSubmit,children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(X,{options:j,getOptionLabel:t=>t.registration_id,disabled:w,value:j.find(t=>t.id===s.values.vehicle)||null,onChange:(t,i)=>s.setFieldValue("vehicle",(i==null?void 0:i.id)||""),renderInput:t=>e.jsx(g,{...t,label:"Vehicle",fullWidth:!0,error:s.touched.vehicle&&!!s.errors.vehicle,helperText:s.touched.vehicle&&s.errors.vehicle,disabled:w})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(X,{disabled:w,options:S,getOptionLabel:t=>t.topic,value:S.find(t=>t.id===s.values.breakdown_topic)||null,onChange:(t,i)=>s.setFieldValue("breakdown_topic",(i==null?void 0:i.id)||""),renderInput:t=>e.jsx(g,{...t,label:"Breakdown Topic",fullWidth:!0,error:s.touched.breakdown_topic&&!!s.errors.breakdown_topic,helperText:s.touched.breakdown_topic&&s.errors.breakdown_topic})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Odometer Reading",name:"odometer_reading",disabled:w,value:s.values.odometer_reading,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.odometer_reading&&!!s.errors.odometer_reading,helperText:s.touched.odometer_reading&&s.errors.odometer_reading,fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Description",name:"description",disabled:w,value:s.values.description,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.description&&!!s.errors.description,helperText:s.touched.description&&s.errors.description,fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Mobile Number",name:"mob_no",disabled:w,value:s.values.mob_no,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.mob_no&&!!s.errors.mob_no,helperText:s.touched.mob_no&&s.errors.mob_no,fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Email",name:"email",type:"email",disabled:w,value:s.values.email,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.email&&!!s.errors.email,helperText:s.touched.email&&s.errors.email,fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Resolved Issue",name:"resolved_issue",value:s.values.resolved_issue,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.resolved_issue&&!!s.errors.resolved_issue,helperText:s.touched.resolved_issue&&s.errors.resolved_issue,fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Pending Issue",name:"pending_issue",value:s.values.pending_issue,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.pending_issue&&!!s.errors.pending_issue,helperText:s.touched.pending_issue&&s.errors.pending_issue,fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(Ie,{fullWidth:!0,children:[e.jsx(We,{children:"Status"}),e.jsxs(Me,{name:"status",value:s.values.status,onChange:s.handleChange,error:s.touched.status&&!!s.errors.status,children:[e.jsx(Z,{value:"Open",children:"Open"}),e.jsx(Z,{value:"Close",children:"Close"}),e.jsx(Z,{value:"Rejected",children:"Rejected"})]})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Submitted By",name:"submitted_by",disabled:w,value:s.values.submitted_by,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.submitted_by&&!!s.errors.submitted_by,helperText:s.touched.submitted_by&&s.errors.submitted_by,fullWidth:!0})}),e.jsxs(d,{item:!0,xs:12,children:[e.jsx(M,{variant:"h6",gutterBottom:!0,children:"Spare Parts Used"}),(H=s==null?void 0:s.values)==null?void 0:H.inspection_parts_inspection.map((t,i)=>{var m;const o=(m=s.values)==null?void 0:m.inspection_parts_inspection.map(n=>n.spare_parts).filter((n,h)=>h!==i);console.log("selected part id",o),console.log("partlist",B);const u=B.filter(n=>!o.includes(n.id));return e.jsxs(d,{container:!0,spacing:2,marginTop:"0px",alignItems:"center",children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(X,{options:u,getOptionLabel:n=>n.description,value:B.find(n=>n.id===t.spare_parts)||null,onChange:(n,h)=>s.setFieldValue(`inspection_parts_inspection[${i}].spare_parts`,(h==null?void 0:h.id)||""),renderInput:n=>e.jsx(g,{...n,label:"Spare Part",fullWidth:!0})})}),e.jsx(d,{item:!0,xs:8,md:4,children:e.jsxs(f,{display:"flex",alignItems:"center",children:[e.jsx(Q,{onClick:()=>s.setFieldValue(`inspection_parts_inspection[${i}].quantity`,Math.max(1,t.quantity-1)),children:e.jsx(Qe,{})}),e.jsx(g,{value:t.quantity,type:"number",inputProps:{min:1},onChange:n=>s.setFieldValue(`inspection_parts_inspection[${i}].quantity`,parseInt(n.target.value,10)),sx:{width:90,mx:1,textAlign:"center"}}),e.jsx(Q,{onClick:()=>s.setFieldValue(`inspection_parts_inspection[${i}].quantity`,t.quantity+1),children:e.jsx(Je,{})})]})}),e.jsx(d,{item:!0,xs:4,md:2,children:e.jsx(Q,{color:"error",onClick:()=>{var h;const n=[...(h=s.values)==null?void 0:h.inspection_parts_inspection];n.splice(i,1),s.setFieldValue("inspection_parts_inspection",n)},children:e.jsx(Oe,{})})})]},i)}),e.jsx(Y,{variant:"outlined",onClick:()=>{var o,u;const t=(o=s.values)==null?void 0:o.inspection_parts_inspection.map(m=>m.spare_parts);if(B.filter(m=>!t.includes(m.id)).length===0){E.error("All available spare parts have already been added.");return}s.setFieldValue("inspection_parts_inspection",[...(u=s.values)==null?void 0:u.inspection_parts_inspection,{spare_parts:"",quantity:1}])},sx:{mt:2},children:"+ Add Spare Part"})]}),e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsxs(Y,{variant:"contained",component:"label",fullWidth:!0,children:["Upload Attachment",e.jsx("input",{type:"file",hidden:!0,onChange:G})]}),$&&e.jsx(M,{children:$})]}),e.jsx(d,{item:!0,xs:12,md:6,children:s.values.issued_attachment&&e.jsxs(M,{variant:"body2",children:[e.jsx("b",{children:"Submitted attachment:"})," ",e.jsx("a",{href:s.values.issued_attachment,target:"_blank",rel:"noopener noreferrer",children:"View File"})]})}),O&&e.jsx(d,{item:!0,xs:12,children:e.jsx(f,{component:"img",src:O,alt:"Preview",sx:{width:"100%",maxHeight:200,mt:2}})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(Y,{type:"submit",variant:"contained",fullWidth:!0,children:"Submit"})})]})})})})}function Ke({where:b}){const{isUpdateInspection:j,UpdatedInspectionData:S}=V(P=>P.inspection);let v=se();const r=()=>{v(de(!1))},B={fontSize:"18px",fontWeight:500,lineHeight:"18.38px",textAlign:"center",paddingTop:"5px",fontFamily:"ubuntu"};return e.jsxs(f,{sx:{bgcolor:"white",m:"10px",display:"flex",textAlign:"left",justifyContent:"space-between",alignItems:"center",borderRadius:"6px",padding:"20px"},children:[e.jsx($e,{}),e.jsx(M,{variant:"h6",sx:B,children:"New Breakdown Requests"}),e.jsxs(Ge,{open:j,onClose:r,maxWidth:"xl",fullWidth:!0,children:[e.jsxs(Ne,{children:["Update Inspection Status",e.jsx(Q,{"aria-label":"close",onClick:r,sx:{position:"absolute",right:8,top:8,color:P=>P.palette.grey[500]},children:e.jsx(Re,{})})]}),e.jsx(De,{children:e.jsx(Ye,{})})]})]})}function ee(b){const{children:j,value:S,index:v,...r}=b;return e.jsx("div",{role:"tabpanel",hidden:S!==v,id:`simple-tabpanel-${v}`,"aria-labelledby":`simple-tab-${v}`,...r,children:S===v&&e.jsx(f,{sx:{p:3},children:j})})}ee.propTypes={children:K.node,index:K.number.isRequired,value:K.number.isRequired};function ne(b){return{id:`simple-tab-${b}`,"aria-controls":`simple-tabpanel-${b}`}}function Xe(){const[b,j]=c.useState(0),S=(v,r)=>{j(r)};return e.jsxs(f,{sx:{width:"100%"},children:[e.jsx(f,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ze,{value:b,onChange:S,"aria-label":"basic tabs example",children:[e.jsx(oe,{label:"Breakdowns",...ne(0)}),e.jsx(oe,{label:"Services",...ne(1)})]})}),e.jsxs(ee,{value:b,index:0,children:[e.jsx(Ke,{where:"inspection"}),e.jsx(Te,{})]}),e.jsx(ee,{value:b,index:1,children:e.jsx(Le,{isInspection:!0})})]})}function Es(){const{locationData:b,selectedVehicle:j,selectedParameterList:S}=V(o=>o.liveMap),{mode:v,selectedVehicleGroup:r}=V(o=>o.dashboard),B=Pe(v),[P,O]=c.useState([]),{w_customer_id:C}=V(o=>o.auth),[$,q]=c.useState(),[A,T]=c.useState(!1),[p,I]=c.useState(!1),[W,L]=c.useState([]);c.useState(!0);const[s,G]=c.useState(!1),[w,R]=c.useState(!1),N=JSON.parse(localStorage.getItem("w_userDetails"));let x=se(),D=_e();c.useEffect(()=>{x(ge()),x(fe())},[]),c.useEffect(()=>{je.includes(N.role)?console.log("you can access this route"):(console.log("you can't access this route"),z())},[]);const z=()=>{console.log("oh! this route not allowed"),D("/dashboard"),E.error("You're not allowed to access inspection.")};c.useEffect(()=>{H(),x(ce()),x(U(C)),x(ve())},[]),c.useEffect(()=>{L([]),x(ae([{reg_id:"",imei:"",params:[]}]))},[j]);const H=async()=>{try{R(!0);let o=[],u=[];const m=await x(we({w_customer_id:C}));if(Array.isArray(m.payload)){m.payload.forEach(a=>{var k,l,J,_;Array.isArray(a.imei)&&a.imei.length>0&&((k=a.imei[0])!=null&&k.mac_id)?(o.push({id:a.id,label:a.registration_id,value:(l=a.imei[0])==null?void 0:l.mac_id,vehilce_type:a==null?void 0:a.segment,chassis_no:a==null?void 0:a.chassis_no,engine_no:a==null?void 0:a.engine_no,workShop:a==null?void 0:a.workshop,registration_id:a==null?void 0:a.registration_id,sell_date:a==null?void 0:a.sell_date,customer_name:a==null?void 0:a.customer_name,vehicle_model:(J=a==null?void 0:a.vehicle_model)==null?void 0:J.name,vehicle_group:a==null?void 0:a.vehicle_group}),u.push((_=a.imei[0])==null?void 0:_.mac_id)):console.error("IMEI data not found for item:",a)});const n="one",h=u;u.length>0&&x(ye({type:n,imei:h})),O(o),x(Se(o)),R(!1),x(Be({w_customer_id:C}))}else R(!1),console.error("Unexpected data format:",m),E.error("Unexpected data format:")}catch(o){console.error("Error fetching vehicle data:",o),E.error(`Error fetching vehicle data: ${o}`)}},t=async o=>{const{label:u,imei:m,id:n,reg_id:h,checked:a}=o;q(_=>_.map(F=>F.id===n?{...F,checked:!a}:F));let k=[...W],l=[...W];if(!a)b.forEach(_=>{_.latestDocument.imei===m&&(k.push({label:u,value:_.latestDocument[u==="maininputvoltage"?"mainInputVoltage":u]}),l=k,L(k))});else{let _=W.filter(F=>F.label!==u);l=_,L(_)}console.log("tempParamList",l),x(ae([{reg_id:h,imei:m,params:l}]))},i=P.filter(o=>Object.keys(r).length===0||o.vehicle_group===r.id);return e.jsxs("div",{className:"app",children:[e.jsx(qe,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[e.jsx(He,{title:"Inspections",setShowVehicles:T,showVehicles:A,setShowVehiclesGroup:G,showVehiclesGroup:s}),e.jsx(Ae,{setShowVehiclesGroup:G,showVehiclesGroup:s}),e.jsxs(f,{style:{display:"flex",width:"100%",height:"95vh"},children:[e.jsx(f,{style:{width:A||p?"80%":"100%",background:Ce.bgShadow},children:e.jsx(Xe,{})}),A&&e.jsx(f,{style:{width:"20%",backgroundColor:B.grey[100]},children:e.jsx(ke,{vehicleData:i,title:"Inspections",setParameterData:q,loadingVehicle:w,setShowVehicles:T,showVehicles:A,showParameters:p,setShowParameters:I})}),p&&e.jsx(f,{style:{width:"20%",backgroundColor:B.grey[100]},children:e.jsx(Ve,{parametersData:$,setParameterData:q,handleParameterChange:t})})]})]})]})}export{Es as default};
