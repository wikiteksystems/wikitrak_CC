import{ab as Ie,j as o,z as te,b as c,E as Oe,T as J,G as he,R as st,y as Te,B as we,a7 as rt,ac as at,ad as lt,I as ct,C as oe,ae as it,$ as ut,af as Ee,a1 as dt,a2 as ft,a4 as gt,a5 as pt,ag as Ne}from"./index-CAH-xv8n.js";import{L as ht}from"./LiveMapTopBar-pggSs2G2.js";import{V as xt}from"./VehicleMenu-DxE7S3hn.js";import{t as yt}from"./SearchTab-sjbg8p5F.js";import{F as bt}from"./Loader-DP7jwd7r.js";import{L as mt}from"./LiveMapServices-Dm2psG2d.js";import{s as De}from"./Socket-DLjvxrzW.js";import{P as kt}from"./Parameters-DU-Js3MU.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as vt}from"./LeftSideBar2-LgPjNrS6.js";import{V as jt}from"./VehicleGroups-BLex0gtS.js";import{u as wt,G as St,M as _t}from"./esm-BeI3PM2g.js";import{M as Dt,r as It,g as Ct,y as Mt,b as Lt,a as Rt,c as Vt,d as $t,e as Et,f as Nt,h as At,i as Ot,j as Tt,k as Bt,l as Ft,m as Wt,n as Gt,o as Pt,p as Ht,q as Ut,s as zt,t as qt,u as Kt,v as Xt}from"./black_bike-Bcmuh6eo.js";import{d as Be}from"./Close-DXIoOoe9.js";import{r as Ce}from"./createSvgIcon-BzSg70SL.js";import"./NewLoader-UTobpKvn.js";import{m as je}from"./motorbike-Ci4voNFa.js";import{d as Yt}from"./Info-CJcAWvRX.js";import{B as j,C as Jt}from"./CircularProgress-zNrF2vz_.js";import{r as Zt}from"./redTractor-NXgVJyvR.js";import{D as Qt,a as eo,b as to,c as oo}from"./DialogTitle-C0cq1nti.js";import{T as no}from"./TextField-D3DWquQm.js";import"./jcb-aCHXMCXy.js";import"./menu2-BAU1wSrv.js";import"./useControlled-CRWNCJKI.js";import"./Autocomplete-JDc7NRJw.js";import"./usePreviousProps-y4d1DEfq.js";import"./index-DeTtLTlA.js";import"./Card-B2fQ9fjo.js";import"./CardContent-BDcFf4jF.js";var Me={},so=Ie;Object.defineProperty(Me,"__esModule",{value:!0});var Fe=Me.default=void 0,ro=so(Ce()),ao=o;Fe=Me.default=(0,ro.default)((0,ao.jsx)("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"NorthEast");var Le={},lo=Ie;Object.defineProperty(Le,"__esModule",{value:!0});var We=Le.default=void 0,co=lo(Ce()),io=o;We=Le.default=(0,co.default)((0,io.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn");const uo=({label:b,value:y})=>o.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[o.jsx(J,{variant:"body2",color:"textSecondary",children:b}),o.jsx(J,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:y||"N/A"})]}),fo=(b,y)=>(b==null?void 0:b.find(I=>{var C,M;return((M=(C=I.imei)==null?void 0:C[0])==null?void 0:M.mac_id)===y}))||{},Ae=({title:b,details:y})=>o.jsx(j,{sx:{width:"45%"},children:y.map(({label:I,value:C})=>o.jsx(uo,{label:I,value:C},I))});function go({handleVehicleInfo:b,udpatedParams:y,handleClickOpen:I}){var se,L,P,q,R,K,Q,ee,T,H,ie,re;const{collapsed:C}=te(h=>h.auth),{vehicleList:M,selectedVehicle:m,selectedImei:G}=te(h=>h.liveMap),[d,fe]=c.useState({});let[s,ne]=c.useState(null);c.useEffect(()=>{let h=y&&(y==null?void 0:y.length)>0&&(y==null?void 0:y.find(k=>{var E;return Number((E=k==null?void 0:k.latestDocument)==null?void 0:E.imei)===Number(G)}));ne(h)},[y,G]),c.useEffect(()=>{fe(fo(M,G))},[M,G]);const Z=(h,k)=>{const E=`https://www.google.com/maps?q=${h},${k}`;window.open(E,"_blank")},U=h=>{var v,B;let k=(v=h==null?void 0:h.latestDocument)==null?void 0:v.ignition,E=(B=h==null?void 0:h.latestDocument)==null?void 0:B.speed;return k===!0||k===1?E:0},z=[{label:"Vehicle No:",value:d==null?void 0:d.registration_id},{label:"Model:",value:(se=d==null?void 0:d.vehicle_model)==null?void 0:se.name},{label:"IMEI No:",value:(P=(L=d==null?void 0:d.imei)==null?void 0:L[0])==null?void 0:P.mac_id},{label:"Chassis No:",value:d==null?void 0:d.chassis_no},{label:"Engine No:",value:d==null?void 0:d.engine_no}],xe=[{label:"Customer Name:",value:(q=d==null?void 0:d.user)!=null&&q.us_user?`${d.user.us_user.first_name.charAt(0).toUpperCase()}${d.user.us_user.first_name.slice(1)} ${d.user.us_user.last_name.charAt(0).toUpperCase()}${d.user.us_user.last_name.slice(1)}`:null},{label:"Mobile: ",value:((R=d==null?void 0:d.user)==null?void 0:R.us_user)&&d.user.us_user.mobile},{label:"Date of Sell:",value:d==null?void 0:d.sell_date},{label:"Workshop Name:",value:(K=d==null?void 0:d.workshop)==null?void 0:K.name}];let $={border:"2px solid black",borderRadius:"5px",padding:"5px",color:"black"};const ge=h=>{let k=M.find(v=>{var B,ae;return((B=v==null?void 0:v.imei)==null?void 0:B.length)>0&&((ae=v.imei[0])==null?void 0:ae.mac_id)==h.imei}),E=parseFloat((k==null?void 0:k.load_capacity)||0)/49*parseFloat((h==null?void 0:h.analogInput1)||0);return`${parseFloat(E).toFixed(2)} Kgs`||0};return o.jsxs(j,{sx:{position:"absolute",top:"600px",left:C?"280px":"450px",zIndex:1,background:Oe.bgShadow,p:2,borderRadius:2,color:"white",width:"72%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[o.jsx(J,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),o.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[o.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",width:"100%",marginLeft:"10px"},children:[o.jsx(j,{sx:$,children:o.jsxs(J,{children:["Ignition:"," ",((Q=s==null?void 0:s.latestDocument)==null?void 0:Q.ignition)===!0||((ee=s==null?void 0:s.latestDocument)==null?void 0:ee.ignition)===1?"On":"Off"]})}),o.jsx(j,{sx:$,children:o.jsxs(J,{children:["Speed: ",U(s)," km/h"]})}),o.jsx(j,{sx:$,children:o.jsxs(J,{children:["Main Voltage:"," ",s?`${(T=s==null?void 0:s.latestDocument)==null?void 0:T.mainInputVoltage} Voltage`:0]})}),o.jsx(j,{sx:$,children:o.jsxs(J,{children:["Heading:"," ",s?`${(H=s==null?void 0:s.latestDocument)==null?void 0:H.heading} deg`:0]})}),s&&((ie=s==null?void 0:s.latestDocument)==null?void 0:ie.venderId)==="VT200"&&o.jsx(j,{sx:$,children:o.jsxs(J,{children:["Load:"," ",s?ge(s==null?void 0:s.latestDocument):0]})}),s&&((re=s==null?void 0:s.latestDocument)==null?void 0:re.venderId)==="VT200"&&o.jsx(j,{sx:$,children:o.jsxs(J,{children:["Remaining fuel:"," ","0 Ltr"]})}),o.jsxs(he,{disabled:!s,onClick:()=>{var h,k;Z((h=s==null?void 0:s.latestDocument)==null?void 0:h.lat,(k=s==null?void 0:s.latestDocument)==null?void 0:k.lng)},children:["Navigate to map",o.jsx(Fe,{})]}),o.jsxs(he,{disabled:!s,onClick:()=>{I()},children:["Share live location",o.jsx(We,{})]})]}),o.jsx(Be,{sx:{cursor:"pointer",color:"black"},onClick:b})]}),o.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[o.jsx(Ae,{title:"Vehicle Details",details:z}),o.jsx(Ae,{title:"Customer Details",details:xe})]})]})}var Re={},po=Ie;Object.defineProperty(Re,"__esModule",{value:!0});var Ge=Re.default=void 0,ho=po(Ce()),xo=o;Ge=Re.default=(0,ho.default)((0,xo.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");const yo="https://cc.wikitrak.in/proxy-3031",bo="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function mo({showCard:b,loadingVehicle:y,vehicleData:I}){const{center:C,selectedParameterList:M,selectedVehicle:m,vehicleList:G,zoom:d,icons:fe,locationData:s,placesData:ne,imeiNumbers:Z,selectedImei:U,onlineVehicle:z,loading:xe,services_loading:$}=te(e=>e.liveMap),{mode:ge,styles:se,vehicles_details:L}=te(e=>e.dashboard),P=c.useRef(null),{collapsed:q}=te(e=>e.auth),[R,K]=c.useState(null),[Q,ee]=c.useState(""),[T,H]=c.useState([]),[ie,re]=c.useState(),[h,k]=c.useState(null);c.useState("");const[E,v]=c.useState(),[B,ae]=c.useState(!1),[F,pe]=c.useState(null),[ye,i]=st.useState(!1),[p,V]=c.useState(""),X=async()=>{var e;if(!U)return oe.error("Please select vehicle");try{const t=await it.post(`${yo}/api/generate-token`,{vehicleNo:U});if((e=t==null?void 0:t.data)!=null&&e.token){const n=`http://cc.wikitrak.in/live-location/${U}/${t.data.token}`;V(n),i(!0)}}catch(t){oe.error("Error occurred while generating link"),i(!1),V(!1),console.error("Error generating link",t)}},Y=()=>{X()},l=()=>{i(!1)},w=Te(),N={},W=c.useRef([]),S=c.useRef(null),A=c.useRef({}),{isLoaded:ue,loadError:be}=wt({googleMapsApiKey:`${bo}`,loadingElement:o.jsx(bt,{})});c.useEffect(()=>{ue&&K(window.google.maps)},[ue]),c.useEffect(()=>{},[d]),c.useEffect(()=>{var e,t,n,r;if(Object.keys(m).length>0){const a=(F==null?void 0:F.length)>0?F:s,u=a==null?void 0:a.filter(g=>{var f;return((f=g==null?void 0:g.latestDocument)==null?void 0:f.imei)===(m==null?void 0:m.imei)});if((u==null?void 0:u.length)>0){H(u);const g={lat:(t=(e=u[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(r=(n=u[0])==null?void 0:n.latestDocument)==null?void 0:r.lng};w(we(g))}}},[s,m]),c.useEffect(()=>{if(!(Object.keys(m).length>0)){const e=s==null?void 0:s.filter(t=>I.some(n=>n.value===t.latestDocument.imei));H(e),pe(e)}},[s,m,I]),c.useEffect(()=>{var e,t,n,r;if(Object.keys(m).length>0){const a=(F==null?void 0:F.length)>0?F:s,u=a==null?void 0:a.filter(g=>{var f;return((f=g==null?void 0:g.latestDocument)==null?void 0:f.imei)===(m==null?void 0:m.imei)});if((u==null?void 0:u.length)>0){H(u);const g={lat:(t=(e=u[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(r=(n=u[0])==null?void 0:n.latestDocument)==null?void 0:r.lng};w(we(g))}}else{const a=s==null?void 0:s.filter(u=>I.some(g=>g.value===u.latestDocument.imei));H(a),pe(a)}},[s,m]),c.useEffect(()=>{re(M)},[M]),c.useEffect(()=>{w(rt({})),ae(!0)},[m]),c.useEffect(()=>{if(console.log("before: ",T),!R)return;const e=S.current;let t=null;return(async()=>{console.log("after: ",T);const r=await me(T,e);t&&t.clearMarkers(),t=ze(r,e),De.on("locationinfo",a=>{console.log("locationinfo: ",a),Ke(a,W),pe(u=>{const g=Array.isArray(u)?u:[],f=g.findIndex(x=>Number(x.latestDocument.imei)===Number(a.imei));if(f!==-1){const x=[...g];return x[f]={...x[f],latestDocument:{...x[f].latestDocument,...a}},x}else return[...g,{_id:a.imei,latestDocument:a}]})})})(),()=>{t&&t.clearMarkers(),Object.keys(A.current).forEach(r=>cancelAnimationFrame(A.current[r])),De.off("locationinfo")}},[R,T,De,ie,W,s]);const me=(e,t)=>e.map(n=>{const r=n.latestDocument.imei,a=W.current[r]||ke(n,t);return W.current[r]&&ve(n,a),a}),ke=(e,t)=>{const n=e.latestDocument.imei,r=new R.Marker({position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},map:t,icon:Se(e)});return r.addListener("click",()=>Ue(e,r,t)),W.current[n]=r,r},ve=async(e,t)=>{var f;const n=t.getPosition(),r=((f=t.getIcon())==null?void 0:f.rotation)||0,a={lat:e.latestDocument.lat,lng:e.latestDocument.lng},u=e.latestDocument.heading||0;Ve(t,n,a,r,u);const g=await Se(e);t.setIcon(g)},Se=async e=>{var f,x,_,O,D;const t=(f=e==null?void 0:e.latestDocument)==null?void 0:f.imei,n=Xe(t),r=Je(e==null?void 0:e.latestDocument,n),a=((x=e==null?void 0:e.latestDocument)==null?void 0:x.heading)||0;return _e((_=e==null?void 0:e.latestDocument)==null?void 0:_.imei)&&Pe((O=e==null?void 0:e.latestDocument)==null?void 0:O.imei),{url:await He(r,a),fillOpacity:2,strokeWeight:1,scale:12,rotation:(D=e==null?void 0:e.latestDocument)==null?void 0:D.heading}},_e=e=>z.includes(Number(e)),Pe=e=>s==null?void 0:s.some(t=>Number(t.latestDocument.imei)===Number(e)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),He=(e,t,n,r=50,a=40,u=45)=>{const g=`${e}-${t}-${r}-${n}-${a}-${u}`;if(N[g])return Promise.resolve(N[g]);const f=document.createElement("canvas"),x=f.getContext("2d");f.width=r,f.height=r;const _=new Image;return _.src=e,new Promise(O=>{_.onload=()=>{x.clearRect(0,0,f.width,f.height),x.translate(r/2,r/2),x.rotate(t*Math.PI/180),x.translate(-r/2,-r/2);const D=(r-a)/2,de=(r-u)/2;if(x.drawImage(_,D,de,a,u),n){const ot=r-10-5,nt=r-10-5;x.beginPath(),x.arc(ot,nt,10/2,0,Math.PI*2),x.fillStyle=n,x.fill()}const le=f.toDataURL("image/png");N[g]=le,O(le)},_.onerror=D=>{console.error("Error loading image for rotation:",D),O(e)}})},Ue=(e,t,n)=>{Qe(e.latestDocument._id,e,t,n),et(e.latestDocument.imei)},Ve=(e,t,n,r,a)=>{const g=performance.now(),f=()=>{const x=performance.now()-g,_=Math.min(x/500,1),O=t.lat()+_*(n.lat-t.lat()),D=t.lng()+_*(n.lng-t.lng()),de=(a-r+360)%360-180,le=(r+de*_+360)%360;e.setPosition({lat:O,lng:D});const ce=e.getIcon();ce&&typeof ce=="object"&&e.setIcon({...ce,rotation:le}),_<1?A.current[e.getPosition()]=requestAnimationFrame(f):(e.setPosition(n),ce&&typeof ce=="object"&&e.setIcon({...ce,rotation:a}),delete A.current[e.getPosition()])};A.current[e.getPosition()]=requestAnimationFrame(f)},ze=(e,t)=>new Dt({map:t,markers:e,renderer:{render:({count:n,position:r})=>qe(n,r)}}),qe=(e,t)=>{const n=40+Math.min(e*2,40),r=30;let a;return e<10?a={start:"#76c7c0",end:"#34a853"}:e<50?a={start:"#fbbc05",end:"#f2994a"}:a={start:"#f45c42",end:"#d32f2f"},new R.Marker({position:t,icon:{url:`data:image/svg+xml,${encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 100 100">
            <defs>
              <radialGradient id="gradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="${a.start}" />
                <stop offset="100%" stop-color="${a.end}" />
              </radialGradient>
              <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0, 0, 0, 0.5)" />
              </filter>
            </defs>
            <!-- Outer Pulsating Ring -->
            <circle cx="50" cy="50" r="48" fill="url(#gradient)" filter="url(#shadow)" stroke="#ffffff" stroke-width="3" />
            <!-- Decorative Inner Ring -->
            <circle cx="50" cy="50" r="38" fill="none" stroke="#ffffff" stroke-width="2" stroke-dasharray="4 2" />
            <!-- Star Decoration -->
            <polygon points="50,15 54,38 70,38 57,50 62,68 50,57 38,68 43,50 30,38 46,38" fill="#ffffff" opacity="0.4" />
            <!-- Count Text -->
            <text x="50" y="55" font-size="${r}" fill="black" text-anchor="middle" font-family="'Courier New', monospace" font-weight="bold">
              ${e}
            </text>
          </svg>
        `)}`,scaledSize:new R.Size(n,n)},label:null})},Ke=async(e,t,n)=>{var u;const r=e.imei,a=t.current[r];if(a){const g=a.getPosition(),f=((u=a.getIcon())==null?void 0:u.rotation)||0,x={lat:e.lat,lng:e.lng},_=e.heading||0;Ve(a,g,x,f,_);const O=await Se({latestDocument:e});if(a.setIcon(O),U==(e==null?void 0:e.imei)){console.log("selected imei",U,e.imei);const D=S.current.getBounds();D&&!D.contains(x)&&S.current.panTo(x)}}},Xe=e=>{if(!e)return"motorBike";const t=Ye(e);return t||console.error(`No vehicle type found for IMEI: ${e}, defaulting to motorBike`),t||"motorBike"},Ye=e=>{if(!L||L.length===0)return console.error("vehicles_details is not available"),null;const t=L.find(n=>(n==null?void 0:n.value)===e&&(n==null?void 0:n.vehilce_type));return t||console.error(`No vehicle found for IMEI: ${e}`),t?t.vehilce_type:null},Je=(e,t)=>{let{speed:n,ignition:r,imei:a}=e,u=_e(a);const g={"2W":{red:It,green:Ct,yellow:Mt,black:Lt},"3W":{red:Rt,green:Vt,yellow:$t,black:Et},"4W":{red:Nt,green:At,yellow:Ot,black:Tt},Tractor:{red:Zt,green:Bt,yellow:Ft,black:Wt},Harvestor:{red:Gt,green:Pt,yellow:Ht,black:Ut},BUS:{red:zt,green:qt,yellow:Kt,black:Xt},default:{red:je,green:je,yellow:je,black:je}};let f=g[t]||g.default;if(!u)return f.black;if(u&&!r)return f.red;if(u&&r&&n>0)return f.green;if(u&&r&&n<=0)return f.yellow},Ze=e=>{console.log("packet and type",e);let{speed:t,ignition:n,imei:r}=e;console.log("speed",t,n,r);let a=_e(r);if(console.log("isONline",a),!a)return"Offline";if(a&&!n)return"Online";if(a&&n&&t>0)return"Running";if(a&&n&&t<=0)return"Idle"},Qe=(e,t,n,r)=>{var x,_,O;w(at(t.latestDocument.imei));const a={lat:(x=t==null?void 0:t.latestDocument)==null?void 0:x.lat,lng:(_=t==null?void 0:t.latestDocument)==null?void 0:_.lng};w(we(a)),w(lt(15)),P.current||(P.current=new R.InfoWindow);const u=P.current,f=`
      <div>
        <h3>Registration No: ${((O=G.find(D=>{var de,le;return((de=D==null?void 0:D.imei[0])==null?void 0:de.mac_id)===((le=t==null?void 0:t.latestDocument)==null?void 0:le.imei)}))==null?void 0:O.registration_id)||""}</h3>
        <h3>Status:${Ze(t==null?void 0:t.latestDocument)}</h3>
      </div>
    `;h===e?(u.close(),k(null)):(u.setContent(f),u.open(r,n),k(e))},et=e=>{const t=L&&(L==null?void 0:L.length)>0&&L.find(n=>(n==null?void 0:n.value)===e&&n);v(t||null)},$e=()=>{ae(!B)};if(be)return"Error loading maps";if(!ue)return"Loading maps";if(!R)return null;const tt={height:"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return o.jsxs(o.Fragment,{children:[o.jsx(j,{sx:{position:"absolute",top:"780px",left:q?"74px":"250px",zIndex:1,background:Oe.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:o.jsxs(he,{sx:{color:"white"},onClick:$e,children:[B?"Hide":"Show"," Vehicle Info",o.jsx(Yt,{})]})}),B===!0&&o.jsx(go,{handleVehicleInfo:$e,udpatedParams:F,handleClickOpen:Y}),o.jsxs(St,{id:"map",mapContainerStyle:tt,zoom:d,center:C,onLoad:e=>{S.current=e},options:{styles:ge?se:""},children:[Object.keys(m).length>0&&o.jsx(mt,{setPlace:ee,place:Q}),$||y?o.jsx(j,{sx:{position:"absolute",top:"50%",left:"50%"},children:o.jsx(Jt,{})}):ne&&ne.length>0&&ne.map((e,t)=>{var n,r;return o.jsx(_t,{position:{lat:parseFloat((n=e==null?void 0:e.location)==null?void 0:n.lat),lng:parseFloat((r=e==null?void 0:e.location)==null?void 0:r.lng)},animation:window.google.maps.Animation.DROP,icon:{path:fe[`${Q}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},t)}),o.jsx(ko,{open:ye,shareLink:p,handleClose:l})]})]})}const ko=({open:b,handleClose:y,shareLink:I})=>{c.useState("");const C=c.useRef(null);c.useEffect(()=>{},[]);const M=()=>{const m=C.current;m?(m.select(),m.setSelectionRange(0,99999),document.execCommand("copy")?oe.success("Text copied!"):oe.error("Failed to copy!"),window.getSelection().removeAllRanges()):oe.error("Failed to copy! No input found.")};return o.jsxs(Qt,{onClose:y,"aria-labelledby":"customized-dialog-title",open:b,fullWidth:!0,maxWidth:"lg",children:[!1,o.jsxs(eo,{sx:{m:0,p:2},id:"customized-dialog-title",children:["Vehicle live location link",o.jsx(ct,{"aria-label":"close",onClick:y,sx:m=>({position:"absolute",right:8,top:8,color:m.palette.grey[500]}),children:o.jsx(Be,{})})]}),o.jsx(to,{dividers:!0,children:o.jsxs(j,{display:"flex",alignItems:"center",gap:2,mt:1,children:[o.jsx(no,{fullWidth:!0,variant:"outlined",inputRef:C,value:I,onChange:m=>{},sx:{flex:9}}),o.jsx(he,{variant:"outlined",onClick:M,startIcon:o.jsx(Ge,{}),sx:{flex:1,minWidth:"auto"},children:"Copy"})]})}),o.jsx(oo,{children:o.jsx(he,{onClick:y,children:"Close"})})]})};function Zo(){const{locationData:b,selectedVehicle:y,selectedParameterList:I,onlineVehicle:C}=te(i=>i.liveMap),{mode:M,selectedVehicleGroup:m}=te(i=>i.dashboard),G=yt(M),[d,fe]=c.useState([]),[s,ne]=c.useState(""),[Z,U]=c.useState(""),[z,xe]=c.useState(""),[$,ge]=c.useState(""),{w_customer_id:se}=te(i=>i.auth),[L,P]=c.useState(),[q,R]=c.useState(!1),[K,Q]=c.useState(!1),[ee,T]=c.useState([]),[H,ie]=c.useState(!0),[re,h]=c.useState(!1),[k,E]=c.useState(!1);let v=Te();c.useEffect(()=>{v(ut({}))},[]),c.useEffect(()=>{B()},[]),c.useEffect(()=>{var i;if(Object.keys(y).length>0){const p=(b==null?void 0:b.length)>0&&(b==null?void 0:b.filter(l=>Number(l.latestDocument.imei)===Number(y==null?void 0:y.imei)));if((p==null?void 0:p.length)<=0){oe.error("Data not available for this vehicle",{id:"clipboard"});return}const{lat:V,lng:X}=((i=p==null?void 0:p[0])==null?void 0:i.latestDocument)??{},Y={lat:V||Ne.lat,lng:X||Ne.lat};v(we(Y))}},[y,b]),c.useEffect(()=>{T([]),v(Ee([{reg_id:"",imei:"",params:[]}]))},[y]);const B=async()=>{try{h(!0);let i=[],p=[];const V=await v(dt({w_customer_id:se}));if(Array.isArray(V.payload)){V.payload.forEach(l=>{var w,N,W,S;Array.isArray(l.imei)&&l.imei.length>0&&((w=l.imei[0])!=null&&w.mac_id)?(i.push({id:l.id,label:l.registration_id,value:(N=l.imei[0])==null?void 0:N.mac_id,vehilce_type:l==null?void 0:l.segment,chassis_no:l==null?void 0:l.chassis_no,engine_no:l==null?void 0:l.engine_no,workShop:l==null?void 0:l.workshop,registration_id:l==null?void 0:l.registration_id,sell_date:l==null?void 0:l.sell_date,customer_name:l==null?void 0:l.customer_name,vehicle_model:(W=l==null?void 0:l.vehicle_model)==null?void 0:W.name,vehicle_group:l==null?void 0:l.vehicle_group}),p.push((S=l.imei[0])==null?void 0:S.mac_id)):console.error("IMEI data not found for item:",l)});const X="one",Y=p;p.length>0&&v(ft({type:X,imei:Y})),fe(i),v(gt(i)),v(pt({w_customer_id:se})),h(!1)}else h(!1),console.error("Unexpected data format:",V),oe.error("Unexpected data format:")}catch(i){console.error("Error fetching vehicle data:",i),oe.error(`Error fetching vehicle data: ${i}`)}},ae=async i=>{const{label:p,imei:V,id:X,reg_id:Y,checked:l}=i;P(S=>S.map(A=>A.id===X?{...A,checked:!l}:A));let w=[...ee],N=[...ee];if(!l)b.forEach(S=>{S.latestDocument.imei===V&&(w.push({label:p,value:S.latestDocument[p==="maininputvoltage"?"mainInputVoltage":p]}),N=w,T(w))});else{let S=ee.filter(A=>A.label!==p);N=S,T(S)}v(Ee([{reg_id:Y,imei:V,params:N}]))},F=i=>b==null?void 0:b.some(p=>Number(p.latestDocument.imei)===Number(i)&&p.latestDocument.speed>0&&(p.latestDocument.ignition===!0||p.latestDocument.ignition===1)),pe=i=>b==null?void 0:b.some(p=>Number(p.latestDocument.imei)===Number(i)&&p.latestDocument.speed<=0&&(p.latestDocument.ignition===!0||p.latestDocument.ignition===1)),ye=d.filter(i=>{var ue,be,me,ke,ve;if(!(Object.keys(m).length===0||i.vehicle_group===m.id))return!1;const V=(ue=i==null?void 0:i.label)==null?void 0:ue.toLowerCase().includes(s.toLowerCase()),X=$===""||((be=i==null?void 0:i.workShop)==null?void 0:be.region)===$,Y=z===""||((ke=(me=i==null?void 0:i.workShop)==null?void 0:me.state)==null?void 0:ke.toLowerCase())===(((ve=z==null?void 0:z.toString())==null?void 0:ve.toLowerCase())||""),l=Number(i.value),w=C.includes(l),N=!w,W=w&&F(l),S=w&&pe(l);return V&&X&&Y&&(Z==="online"?w:Z==="offline"?N:Z==="running"?W:Z==="idling"?S:!0)}).sort((i,p)=>i.label.localeCompare(p.label));return o.jsxs("div",{className:"app",children:[o.jsx(vt,{}),o.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[o.jsx(ht,{title:"Live Map",setShowVehicles:R,showVehicles:q,showParameters:K,setShowParameters:Q,setShowCard:ie,showCard:H,setShowVehiclesGroup:E,showVehiclesGroup:k}),o.jsx(jt,{setShowVehiclesGroup:E,showVehiclesGroup:k,where:"livemap"}),o.jsxs(j,{style:{display:"flex",width:"100%",height:"95vh"},children:[o.jsx(j,{style:{width:q||K?"80%":"100%"},children:o.jsx(mo,{showCard:H,loadingVehicle:re,vehicleData:ye})}),q&&o.jsx(j,{style:{width:"20%",backgroundColor:G.grey[100]},children:o.jsx(xt,{vehicleData:ye,title:"Live Map",setParameterData:P,loadingVehicle:re,setShowVehicles:R,showVehicles:q,showParameters:K,setShowParameters:Q,setSearchedTerm:ne,setOptions:U,setState:xe,setRegion:ge,searchTerm:s,options:Z,state:z,region:$})}),K&&o.jsx(j,{style:{width:"20%",backgroundColor:G.grey[100]},children:o.jsx(kt,{parametersData:L,setParameterData:P,handleParameterChange:ae})})]})]})]})}export{Zo as default};
