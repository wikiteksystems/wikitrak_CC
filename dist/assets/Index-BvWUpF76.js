import{n as $e,j as s,a$ as E,b as l,a_ as ie,fi as Ie,fo as Re,fp as qe,fq as Oe,b7 as Y,bk as he,aW as $,ep as g,dK as W,bc as te,bY as Ee,T as fe,aY as B,f1 as ye,f2 as Ce,f3 as Se,R as Pe,ff as Fe,bm as ee,fg as pe,bf as Me,d4 as ge,cf as Ne,dT as We,dU as Ye,dV as He,dW as ve,dX as v,dY as De,f5 as Je,c4 as ze,ed as Ge,da as Qe,eM as Ke,eN as be,fa as Xe,fb as Ze,fh as ke,bH as je,bw as Be,bx as Ue,bz as we,bq as es,b5 as ss}from"./index-CgFQaM9K.js";import{V as ts}from"./VehicleMenu-D7NJkX_F.js";import{P as as}from"./Parameters-CIBWifO4.js";/* empty css           */import{c as ns,f as rs,a as se,e as cs}from"./index.esm-BwMU0PEu.js";import{u as is}from"./formik.esm-Bo79X3ND.js";import{A as ue}from"./Autocomplete-CTIjcy5F.js";import{R as ls,A as os,D as Te}from"./Remove-DXc2_Ie-.js";import{a as us,S as ds}from"./ServiceJobCardTable-DLm6wa0e.js";import{T as hs,d as ps,C as _s}from"./excelUtils-CefuL2h4.js";import{T as xs,E as fs}from"./Edit-24ncP_56.js";import{S as gs}from"./ServicesTopBar-Bbe2JplF.js";const vs=$e(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Le=({UpdatedBreakdownData:c,setOpen:p})=>{var S,A,J,z,i;const{w_customer_id:_}=E(t=>t.auth),[b,C]=l.useState(null),{vehicleList:I}=E(t=>t.liveMap),{vendorList:F,segMentList:H,loading:ae}=E(t=>t.services),{technicianList:P}=E(t=>t.breakdown),R=JSON.parse(localStorage.getItem("w_userDetails")),D=((S=R==null?void 0:R.oem)==null?void 0:S.name)=="VENUS TECHNO EQUIPMENT"?"Assign Service Engineer":"Assign technician",{sparePartList:L}=E(t=>t.inspection),T=ie(),[U,Z]=l.useState([]),[ne,w]=l.useState([]),[k,q]=l.useState(!1);l.useState(null),console.log("update service data",c),l.useEffect(()=>{},[P]);let M=c==null?void 0:c.service_parts.map(t=>{var r;return{spare_parts:(r=t==null?void 0:t.spare_parts)==null?void 0:r.id,quantity:t==null?void 0:t.quantity}});const a=is({initialValues:{start_date:(c==null?void 0:c.start_date)||Ie(new Date),vehicle:((A=c==null?void 0:c.vehicle)==null?void 0:A.id)||"",service_type:(c==null?void 0:c.service_type)||"",technician:((J=c==null?void 0:c.technician)==null?void 0:J.id)||"",mob_no:(c==null?void 0:c.mob_no)||"",attachment:(c==null?void 0:c.attachment)||"",location:(c==null?void 0:c.location)||"",contact_person:(c==null?void 0:c.contact_person)||"",service_parts:M||[],status:"Pending",user:_},validationSchema:ns({start_date:rs().required("Submission Date is required"),vehicle:se().required("Vehicle is required"),service_type:se().required("Service type is required"),technician:se().required("Technician is required"),mob_no:se().matches(/^\d{10,11}$/,"Mobile number must be 10-11 digits").required("Mobile number is required"),location:se().required("Location is required"),contact_person:se().required("Contact Person is required"),attachment:cs()}),onSubmit:async t=>{console.log("values",t);let r;if(c?((t==null?void 0:t.attachment)instanceof File||typeof(t==null?void 0:t.attachment)=="string"&&(t.attachment=""),r=await T(Re({payload:t,id:c.id}))):r=await T(qe(t)),r.payload){console.log(r.payload),console.log("values",t.service_parts);const{id:j}=r.payload,{service_parts:o}=t;await T(Oe({service:j,parts:o})),Y.success("Service created successfully"),a.resetForm(),C(null),T(he()),p(!1)}}}),re=["Routine","Overdue","Emergency"];l.useEffect(()=>{let t=I.map(r=>({label:r.registration_id,value:r.id}));Z(t)},[I]),l.useEffect(()=>{let t=H.map(r=>({label:r.segment_name,value:r.id}));w(t)},[H]);const x=async()=>{q(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(async t=>{const{latitude:r,longitude:j}=t.coords;try{const o=await getReadableAddress(r,j);a.setFieldValue("location",o)}catch{Y.error("Failed to convert coordinates to address.")}finally{q(!1)}},()=>{Y.error("Failed to retrieve location."),q(!1)}):(Y.error("Geolocation not supported."),q(!1))};return s.jsx($,{sx:{p:3,maxWidth:"100%",margin:"auto"},children:s.jsx("form",{onSubmit:a.handleSubmit,children:s.jsxs(g,{container:!0,spacing:2,children:[s.jsx(g,{item:!0,xs:12,sm:6,children:s.jsx(W,{label:"Start date",name:"start_date",type:"datetime-local",value:a.values.start_date,onChange:a.handleChange,onBlur:a.handleBlur,error:a.touched.start_date&&!!a.errors.start_date,helperText:a.touched.start_date&&a.errors.start_date,fullWidth:!0,InputLabelProps:{shrink:!0},disabled:!0})}),s.jsx(g,{item:!0,xs:12,sm:6,children:s.jsx(ue,{options:I,getOptionLabel:t=>t.registration_id||"",value:I.find(t=>t.id===a.values.vehicle)||null,onChange:(t,r)=>a.setFieldValue("vehicle",(r==null?void 0:r.id)||""),renderInput:t=>s.jsx(W,{...t,label:"Vehicle",error:a.touched.vehicle&&!!a.errors.vehicle,helperText:a.touched.vehicle&&a.errors.vehicle})})}),s.jsx(g,{item:!0,xs:12,sm:6,children:s.jsx(ue,{options:re,getOptionLabel:t=>t,value:a.values.service_type,onChange:(t,r)=>a.setFieldValue("service_type",r||""),renderInput:t=>s.jsx(W,{...t,label:"Service Type",error:a.touched.service_type&&!!a.errors.service_type,helperText:a.touched.service_type&&a.errors.service_type})})}),s.jsx(g,{item:!0,xs:12,sm:6,children:s.jsx(ue,{options:P,getOptionLabel:t=>`${t.first_name} ${t.last_name}`||"",value:P.find(t=>t.id===a.values.technician)||null,onChange:(t,r)=>a.setFieldValue("technician",(r==null?void 0:r.id)||""),renderInput:t=>s.jsx(W,{...t,label:D,error:a.touched.technician&&!!a.errors.technician,helperText:a.touched.technician&&a.errors.technician})})}),s.jsx(g,{item:!0,xs:12,sm:6,children:s.jsx(W,{label:"Contact Person Name*",name:"contact_person",value:a.values.contact_person,onChange:a.handleChange,onBlur:a.handleBlur,error:a.touched.contact_person&&!!a.errors.contact_person,helperText:a.touched.contact_person&&a.errors.contact_person,fullWidth:!0})}),s.jsx(g,{item:!0,xs:12,sm:6,children:s.jsx(W,{label:"Contact Person Mobile No*",name:"mob_no",value:a.values.mob_no,onChange:a.handleChange,onBlur:a.handleBlur,error:a.touched.mob_no&&!!a.errors.mob_no,helperText:a.touched.mob_no&&a.errors.mob_no,fullWidth:!0})}),s.jsxs(g,{item:!0,xs:12,sm:6,children:[s.jsx(W,{label:"Location",name:"location",value:a.values.location,onChange:a.handleChange,onBlur:a.handleBlur,error:a.touched.location&&!!a.errors.location,helperText:a.touched.location&&a.errors.location,fullWidth:!0}),s.jsx(te,{size:"small",onClick:x,disabled:k,sx:{mt:1},children:k?s.jsx(Ee,{size:16}):"Use Current Location"})]}),s.jsxs(g,{item:!0,xs:12,children:[s.jsx(fe,{variant:"h6",gutterBottom:!0,children:"Parts Requirement*(If any information available)"}),(i=(z=a==null?void 0:a.values)==null?void 0:z.service_parts)==null?void 0:i.map((t,r)=>{var m;const j=(m=a.values)==null?void 0:m.service_parts.map(u=>u.spare_parts).filter((u,O)=>O!==r),o=L.filter(u=>!j.includes(u.id));return s.jsxs(g,{container:!0,spacing:2,marginTop:"0px",alignItems:"center",children:[s.jsx(g,{item:!0,xs:12,md:6,children:s.jsx(ue,{options:o,getOptionLabel:u=>u.description,value:L.find(u=>u.id===t.spare_parts)||null,onChange:(u,O)=>a.setFieldValue(`service_parts[${r}].spare_parts`,(O==null?void 0:O.id)||""),renderInput:u=>s.jsx(W,{...u,label:"Spare Part",fullWidth:!0})})}),s.jsx(g,{item:!0,xs:8,md:4,children:s.jsxs($,{display:"flex",alignItems:"center",children:[s.jsx(B,{onClick:()=>a.setFieldValue(`service_parts[${r}].quantity`,Math.max(1,t.quantity-1)),children:s.jsx(ls,{})}),s.jsx(W,{value:t.quantity,type:"number",inputProps:{min:1},onChange:u=>a.setFieldValue(`service_parts[${r}].quantity`,parseInt(u.target.value,10)),sx:{width:90,mx:1,textAlign:"center"}}),s.jsx(B,{onClick:()=>a.setFieldValue(`service_parts[${r}].quantity`,t.quantity+1),children:s.jsx(os,{})})]})}),s.jsx(g,{item:!0,xs:4,md:2,children:s.jsx(B,{color:"error",onClick:()=>{var O;const u=[...(O=a.values)==null?void 0:O.service_parts];u.splice(r,1),a.setFieldValue("service_parts",u)},children:s.jsx(Te,{})})})]},r)}),s.jsx(te,{variant:"outlined",onClick:()=>{var j,o,m;const t=(o=(j=a.values)==null?void 0:j.service_parts)==null?void 0:o.map(u=>u.spare_parts);if(L.filter(u=>!(t!=null&&t.includes(u.id))).length===0){Y.error("All available spare parts have already been added.");return}a.setFieldValue("service_parts",[...(m=a.values)==null?void 0:m.service_parts,{spare_parts:"",quantity:1}])},sx:{mt:2},children:"+ Add Spare Part"})]}),s.jsxs(g,{item:!0,xs:6,children:[s.jsxs(te,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload File",s.jsx("input",{type:"file",hidden:!0,onChange:t=>{const r=t.currentTarget.files[0];r&&a.setFieldValue("attachment",r)}})]}),a.values.attachment&&s.jsxs(g,{container:!0,spacing:1,mt:1,alignItems:"center",children:[s.jsx(g,{item:!0,children:s.jsxs(fe,{variant:"body2",children:[s.jsx("b",{children:"Attachment:"})," ",typeof a.values.attachment=="string"?a.values.attachment.split("/").pop():a.values.attachment.name]})}),s.jsx(g,{item:!0,children:s.jsx(te,{size:"small",variant:"text",onClick:()=>{const t=typeof a.values.attachment=="string"?a.values.attachment:URL.createObjectURL(a.values.attachment);window.open(t,"_blank")},children:"View File"})})]})]}),s.jsx(g,{item:!0,xs:12,children:s.jsx(te,{variant:"contained",type:"submit",fullWidth:!0,disabled:ae,children:c?"Update Service request":"Raise Service request"})})]})})})};function bs({open:c,setOpen:p,data:_,isInspection:b}){const C=()=>p(!1);return s.jsxs(ye,{open:c,onClose:C,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[s.jsxs(Ce,{children:["Update service entry",s.jsx(B,{"aria-label":"close",onClick:()=>p(!1),sx:{position:"absolute",right:8,top:8},children:s.jsx(vs,{})})]}),s.jsx(Se,{dividers:!0,children:s.jsx(Le,{UpdatedBreakdownData:_,setOpen:p})})]})}const me=[{id:"service_record_id",label:"Service Record ID"},{id:"registration_id",label:"Registration ID"},{id:"service_type",label:"Service Type"},{id:"user_name",label:"Created by"},{id:"technician_name",label:"Technician Name"},{id:"contact_person",label:"Contact Person"},{id:"mob_no",label:"Mobile No"},{id:"start_date",label:"Start Date"},{id:"start_time",label:"Start Time"},{id:"status",label:"Status"}],js="https://cc.wikitrak.in/api-proxy/api/v1",ms=()=>{const{servicesData:c}=E(e=>e.services),[p,_]=l.useState(!1),[b,C]=l.useState(null),{searchTerm:I}=E(e=>e.inspection),F=ie(),[H,ae]=l.useState("asc"),[P,R]=l.useState("BDID"),[D,L]=l.useState(0),[T,U]=l.useState(8),[Z,ne]=l.useState(!1),[w,k]=l.useState(!1),[q,M]=l.useState(null),[a,re]=Pe.useState(null);l.useState({service_record_id:"",registration_id:"",service_type:"",user_name:"",technician_name:"",contact_person:"",mob_no:"",start_date:"",start_time:"",status:""});const[x,S]=l.useState("service_record_id");l.useEffect(()=>{F(Fe({})),F(he())},[]);const A=e=>{ae(P===e&&H==="asc"?"desc":"asc"),R(e)},J=(e,f)=>{L(f)},z=e=>{U(parseInt(e.target.value,10)),L(0)},i=(e,f,y)=>!f||!y?e:e.filter(n=>(()=>{var d,V,G,Q,K,X,N,de,ce;switch(f){case"service_record_id":return((n==null?void 0:n.service_record_id)||"").toString();case"registration_id":return((d=n==null?void 0:n.vehicle)==null?void 0:d.registration_id)||"";case"service_type":return(n==null?void 0:n.service_type)||"";case"user_name":return`${((G=(V=n==null?void 0:n.user)==null?void 0:V.us_user)==null?void 0:G.first_name)||""} ${((K=(Q=n==null?void 0:n.user)==null?void 0:Q.us_user)==null?void 0:K.last_name)||""}`;case"technician_name":return`${((N=(X=n==null?void 0:n.technician)==null?void 0:X.us_user)==null?void 0:N.first_name)||""} ${((ce=(de=n==null?void 0:n.technician)==null?void 0:de.us_user)==null?void 0:ce.last_name)||""}`;case"contact_person":return(n==null?void 0:n.contact_person)||"";case"mob_no":return(n==null?void 0:n.mob_no)||"";case"start_date":return n!=null&&n.start_date?ee(n.start_date).format("YYYY-MM-DD"):"";case"start_time":return n!=null&&n.start_date?ee(n.start_date).format("HH:mm A"):"";case"status":return(n==null?void 0:n.status)||"";default:return""}})().toLowerCase().includes(y.toLowerCase())),t=async()=>{console.log("breakdownData data deleting",b);try{await ze.delete(`${js}/vehicles/new/service-record/create/${b.id}/`),Y.success("service data deleted successfully!"),F(he())}catch(e){console.error("Error deleting service data:",e),Y.error("Failed to delete service data. Please try again.")}_(!1)},r=()=>{_(!1)},j=(e,f,y,n)=>{if(n==="User"){const h=`${e.user.us_user.first_name} ${e.user.us_user.last_name}`.toLowerCase(),d=`${f.user.us_user.first_name} ${f.user.us_user.last_name}`.toLowerCase();return y==="asc"?h.localeCompare(d):d.localeCompare(h)}if(n==="WorkshopGroup"){const h=e.workshop_group.group_name.toLowerCase(),d=f.workshop_group.group_name.toLowerCase();return y==="asc"?h.localeCompare(d):d.localeCompare(h)}if(n==="BDID"){const h=parseInt(e.service_record_id.replace("BD-",""),10),d=parseInt(f.service_record_id.replace("BD-",""),10);return y==="asc"?h-d:d-h}if(n==="SubmissionDate"){const h=new Date(e.submission_date),d=new Date(f.submission_date);return y==="asc"?h-d:d-h}if(n==="Status"){const h={Open:1,Close:2,Rejected:3},d=h[e.status]||0,V=h[f.status]||0;return y==="asc"?d-V:V-d}return 0},o=i((c==null?void 0:c.slice())||[],x,I).sort((e,f)=>j(e,f,H,P)),m=o.slice(D*T,D*T+T),u={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},O=e=>{k(!w),re(e)},Ae=e=>{C(e),_(!0)},Ve=o&&o.map(e=>{var y,n,h,d,V,G,Q,K,X;const f=e!=null&&e.service_parts&&(e==null?void 0:e.service_parts.length)>0?e==null?void 0:e.service_parts.map((N,de)=>{var ce;return`${(ce=N==null?void 0:N.spare_parts)==null?void 0:ce.description}: Qty ${N==null?void 0:N.quantity}`}).join(";"):"N/A";return{"Service Record ID":(e==null?void 0:e.service_record_id)||"","Registration ID":((y=e==null?void 0:e.vehicle)==null?void 0:y.registration_id)||"","Service Type":(e==null?void 0:e.service_type)||"","User Name":`${((h=(n=e==null?void 0:e.user)==null?void 0:n.us_user)==null?void 0:h.first_name)||""} ${((V=(d=e==null?void 0:e.user)==null?void 0:d.us_user)==null?void 0:V.last_name)||""}`,"Technician Name":`${((Q=(G=e==null?void 0:e.technician)==null?void 0:G.us_user)==null?void 0:Q.first_name)||""} ${((X=(K=e==null?void 0:e.technician)==null?void 0:K.us_user)==null?void 0:X.last_name)||""}`,"Contact Person":(e==null?void 0:e.contact_person)||"","Mobile No":(e==null?void 0:e.mob_no)||"","Start Date":e!=null&&e.start_date?ee(e.start_date).format("YYYY-MM-DD"):"","Start Time":e!=null&&e.start_date?ee(e.start_date).format("HH:mm A"):"",Status:(e==null?void 0:e.status)||"","Spare parts":f}});let le=pe("Service"),oe=pe("Job Card");const _e=(oe==null?void 0:oe.includes("Create"))||oe==="Read-Write-Only",xe=(le==null?void 0:le.includes("Update"))||le==="Read-Write-Only";return s.jsxs($,{sx:{m:"10px"},children:[s.jsxs($,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[s.jsx(hs,{columns:me,selectedColumn:x,onColumnChange:S,searchTerm:I,onSearchChange:e=>F(Me(e))}),s.jsx(ge,{variant:"contained",color:"success",onClick:()=>ps(Ve,"service-ticket.xlsx"),children:"Download Excel"})]}),s.jsxs(Ne,{children:[s.jsx(We,{sx:{height:"55vh",bgcolor:"white",borderRadius:"10px"},children:s.jsxs(Ye,{stickyHeader:!0,children:[s.jsx(He,{children:s.jsxs(ve,{children:[me.map(e=>s.jsx(v,{sx:u,children:s.jsx(xs,{active:P===e.id,direction:P===e.id?H:"asc",onClick:()=>A(e.id),children:e.label})},e.id)),xe&&s.jsx(v,{sx:u,children:"Action"}),_e&&s.jsx(v,{sx:u,children:"Job card"})]})}),s.jsx(De,{children:m.map((e,f)=>{var y,n,h,d,V,G,Q,K,X;return s.jsxs(ve,{children:[s.jsx(v,{children:e==null?void 0:e.service_record_id}),s.jsx(v,{children:(y=e==null?void 0:e.vehicle)==null?void 0:y.registration_id}),s.jsx(v,{children:e==null?void 0:e.service_type}),s.jsx(v,{children:`${(h=(n=e==null?void 0:e.user)==null?void 0:n.us_user)==null?void 0:h.first_name} ${(V=(d=e==null?void 0:e.user)==null?void 0:d.us_user)==null?void 0:V.last_name}`}),s.jsx(v,{children:`${((Q=(G=e==null?void 0:e.technician)==null?void 0:G.us_user)==null?void 0:Q.first_name)||""} ${((X=(K=e==null?void 0:e.technician)==null?void 0:K.us_user)==null?void 0:X.last_name)||""}`}),s.jsx(v,{children:e==null?void 0:e.contact_person}),s.jsx(v,{children:e==null?void 0:e.mob_no}),s.jsx(v,{children:(e==null?void 0:e.start_date)&&ee(e.start_date).format("YYYY-MM-DD")||"N/A"}),s.jsx(v,{children:(e==null?void 0:e.start_date)&&ee(e.start_date).format("HH:mm A")||"N/A"}),s.jsx(v,{sx:{color:e.status==="Open"?"blue":e.status==="Completed"?"green":"red"},children:e.status}),xe&&s.jsxs(v,{style:{display:"flex"},children:[s.jsx(B,{onClick:()=>O(e),color:"primary",disabled:(e==null?void 0:e.status.toLowerCase())==="completed","aria-label":"edit record",children:s.jsx(fs,{})}),s.jsx(B,{onClick:()=>Ae(e),"aria-label":"edit record",children:s.jsx(Te,{})})]}),_e&&s.jsx(v,{children:s.jsx(ge,{variant:"outlined",onClick:()=>{ne(!0),M(e)},disabled:e==null?void 0:e.jobcard,children:"Create job card"})})]},f)})})]})}),s.jsx(Je,{component:"div",count:o.length,page:D,onPageChange:J,rowsPerPage:T,onRowsPerPageChange:z,rowsPerPageOptions:[5,10,15]}),s.jsx(us,{rowData:q,open:Z,handleClose:()=>ne(!1),isTechnician:!0})]}),s.jsx(bs,{open:w,setOpen:k,data:a}),s.jsx(_s,{open:p,onClose:r,onConfirm:t})]})};function ys(){const[c,p]=Pe.useState(!1);ie();const _=()=>p(!0),b=()=>p(!1);return s.jsxs("div",{children:[s.jsx(te,{variant:"outlined",onClick:_,children:"+ Add New Entry"}),s.jsxs(ye,{open:c,onClose:b,maxWidth:"xl",fullWidth:!0,scroll:"paper",children:[s.jsxs(Ce,{children:["+ Add new service entry",s.jsx(B,{"aria-label":"close",onClick:b,sx:{position:"absolute",right:8,top:8},children:s.jsx(Ge,{})})]}),s.jsx(Se,{dividers:!0,children:s.jsx(Le,{setOpen:p})})]})]})}function Cs(){const[c]=Qe(),p=c.get("tab"),[_,b]=l.useState(0);l.useEffect(()=>{p&&b(Number(p))},[]);const C=(I,F)=>{b(F)};return s.jsxs($,{sx:{width:"100%"},children:[s.jsx($,{sx:{borderBottom:1,borderColor:"divider"},children:s.jsxs(Ke,{value:_,onChange:C,"aria-label":"Breakdown Tabs",children:[s.jsx(be,{label:"Service Tickets"}),s.jsx(be,{label:"Service Job Cards"})]})}),s.jsxs($,{sx:{mt:2},children:[_===0&&s.jsx(ms,{isInspection:!1}),_===1&&s.jsx(ds,{isInspection:!1})]})]})}const Ss=()=>{const c=ie(),p=JSON.parse(localStorage.getItem("w_userDetails"));l.useEffect(()=>{var C;c(Xe()),c(Ze()),c(ke({oem:(C=p==null?void 0:p.oem)==null?void 0:C.name}))},[]);let _=pe("Service");const b=(_==null?void 0:_.includes("Create"))||_==="Read-Write-Only";return s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[s.jsx("div",{style:{margin:"10px"},children:s.jsx("h3",{children:"Service Record"})}),b&&s.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:s.jsx(ys,{})}),"      "]}),s.jsxs("div",{children:[s.jsx("hr",{}),s.jsx("div",{style:{margin:"10px"},children:s.jsx(Cs,{})})]})]})},Ps=Ss;function Ns(){const{locationData:c,selectedVehicle:p,selectedParameterList:_}=E(x=>x.liveMap),{mode:b}=E(x=>x.dashboard),C=ss(b),[I,F]=l.useState([]),{w_customer_id:H}=E(x=>x.auth),[ae,P]=l.useState(),[R,D]=l.useState(!1),[L,T]=l.useState(!1),[U,Z]=l.useState([]),[ne,w]=l.useState(!0),[k,q]=l.useState(!1);let M=ie();l.useEffect(()=>{a()},[]),l.useEffect(()=>{Z([]),M(je([{reg_id:"",imei:"",params:[]}]))},[p]);const a=async()=>{try{q(!0);let x=[],S=[];const A=await M(Be({w_customer_id:H}));if(Array.isArray(A.payload)){A.payload.forEach(i=>{var t,r,j,o;Array.isArray(i.imei)&&i.imei.length>0&&((t=i.imei[0])!=null&&t.mac_id)?(x.push({id:i.id,label:i.registration_id,value:(r=i.imei[0])==null?void 0:r.mac_id,vehilce_type:i==null?void 0:i.segment,chassis_no:i==null?void 0:i.chassis_no,engine_no:i==null?void 0:i.engine_no,workShop:i==null?void 0:i.workshop,registration_id:i==null?void 0:i.registration_id,sell_date:i==null?void 0:i.sell_date,customer_name:i==null?void 0:i.customer_name,vehicle_model:(j=i==null?void 0:i.vehicle_model)==null?void 0:j.name}),S.push((o=i.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",i)});const J="one",z=S;S.length>0&&M(Ue({type:J,imei:z})),F(x),M(we(x)),q(!1)}else q(!1),console.error("Unexpected data format:",A),Y.error("Unexpected data format:")}catch(x){console.error("Error fetching vehicle data:",x),Y.error(`Error fetching vehicle data: ${x}`)}},re=async x=>{const{label:S,imei:A,id:J,reg_id:z,checked:i}=x;P(o=>o.map(m=>m.id===J?{...m,checked:!i}:m));let t=[...U],r=[...U];if(!i)c.forEach(o=>{o.latestDocument.imei===A&&(t.push({label:S,value:o.latestDocument[S==="maininputvoltage"?"mainInputVoltage":S]}),r=t,Z(t))});else{let o=U.filter(m=>m.label!==S);r=o,Z(o)}console.log("tempParamList",r),M(je([{reg_id:z,imei:A,params:r}]))};return s.jsxs("div",{className:"app",children:[s.jsx(es,{}),s.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[s.jsx(gs,{title:"services",setShowVehicles:D,showVehicles:R,showParameters:L,setShowParameters:T,setShowCard:w,showCard:ne}),s.jsxs($,{style:{display:"flex",width:"100%",height:"95vh"},children:[s.jsx($,{style:{width:R||L?"80%":"100%"},children:s.jsx(Ps,{})}),R&&s.jsx($,{style:{width:"20%",backgroundColor:C.grey[100]},children:s.jsx(ts,{vehicleData:I,title:"Inspections",setParameterData:P,loadingVehicle:k,setShowVehicles:D,showVehicles:R,showParameters:L,setShowParameters:T})}),L&&s.jsx($,{style:{width:"20%",backgroundColor:C.grey[100]},children:s.jsx(as,{parametersData:ae,setParameterData:P,handleParameterChange:re})})]})]})]})}export{Ns as default};
