import{a$ as k,b as t,a_ as ie,bl as he,b6 as ue,bH as F,bw as de,bx as pe,bz as ge,bA as fe,b7 as K,j as r,bq as Se,bs as we,aW as L,bI as ve,b5 as _e,bJ as Q}from"./index-C945ZWhn.js";import{L as be}from"./LiveMapTopBar-Bt-WjLq4.js";import{V as Le}from"./VehicleMenu-D1iH5B5J.js";import{P as xe}from"./Parameters-CfvymVOl.js";/* empty css           */import"./Autocomplete-BJEIpv50.js";function Ee(){const{locationData:n,selectedVehicle:g,selectedParameterList:ye,onlineVehicle:P}=k(s=>s.liveMap),{mode:X,selectedVehicleGroup:M}=k(s=>s.dashboard),E=_e(X),[Y,Z]=t.useState([]),[v,m]=t.useState(""),[f,ee]=t.useState(""),[S,se]=t.useState(""),[x,ae]=t.useState(""),{w_customer_id:I}=k(s=>s.auth),[te,y]=t.useState(),[_,A]=t.useState(!1),[b,G]=t.useState(!1),[j,C]=t.useState([]),[O,oe]=t.useState(!0),[R,D]=t.useState(!1),[N,B]=t.useState(!1);let h=ie();t.useEffect(()=>()=>{h(he({}))},[]),t.useEffect(()=>{re()},[]),t.useEffect(()=>{var s;if(Object.keys(g).length>0){const a=n==null?void 0:n.filter(e=>e.latestDocument.imei==(g==null?void 0:g.imei)),{lat:c,lng:u}=((s=a==null?void 0:a[0])==null?void 0:s.latestDocument)??{},d={lat:c||Q.lat,lng:u||Q.lat};h(ue(d))}},[g,n]),t.useEffect(()=>{C([]),h(F([{reg_id:"",imei:"",params:[]}]))},[g]);const re=async()=>{try{D(!0);let s=[],a=[];const c=await h(de({w_customer_id:I}));if(Array.isArray(c.payload)){c.payload.forEach(e=>{var i,l,w,o;Array.isArray(e.imei)&&e.imei.length>0&&((i=e.imei[0])!=null&&i.mac_id)?(s.push({id:e.id,label:e.registration_id,value:(l=e.imei[0])==null?void 0:l.mac_id,vehilce_type:e==null?void 0:e.segment,chassis_no:e==null?void 0:e.chassis_no,engine_no:e==null?void 0:e.engine_no,workShop:e==null?void 0:e.workshop,registration_id:e==null?void 0:e.registration_id,sell_date:e==null?void 0:e.sell_date,customer_name:e==null?void 0:e.customer_name,vehicle_model:(w=e==null?void 0:e.vehicle_model)==null?void 0:w.name,vehicle_group:e==null?void 0:e.vehicle_group,segment:e==null?void 0:e.segment}),a.push((o=e.imei[0])==null?void 0:o.mac_id)):console.error("IMEI data not found for item:",e)});const u="one",d=a;a.length>0&&h(pe({type:u,imei:d})),Z(s),h(ge(s)),h(fe({w_customer_id:I})),D(!1)}else D(!1),console.error("Unexpected data format:",c),K.error("Unexpected data format:")}catch(s){console.error("Error fetching vehicle data:",s),K.error(`Error fetching vehicle data: ${s}`)}},ne=async s=>{const{label:a,imei:c,id:u,reg_id:d,checked:e}=s;y(o=>o.map(p=>p.id===u?{...p,checked:!e}:p));let i=[...j],l=[...j];if(!e)n.forEach(o=>{o.latestDocument.imei===c&&(i.push({label:a,value:o.latestDocument[a==="maininputvoltage"?"mainInputVoltage":a]}),l=i,C(i))});else{let o=j.filter(p=>p.label!==a);l=o,C(o)}h(F([{reg_id:d,imei:c,params:l}]))},ce=s=>n==null?void 0:n.some(a=>String(a.latestDocument.imei)===String(s)&&a.latestDocument.speed>0&&(a.latestDocument.ignition===!0||a.latestDocument.ignition===1)),le=s=>n==null?void 0:n.some(a=>String(a.latestDocument.imei)===String(s)&&a.latestDocument.speed<=0&&(a.latestDocument.ignition===!0||a.latestDocument.ignition===1)),T=Y.filter(s=>{var z,U,$,q,H,J,W;if(!(Object.keys(M).length===0||s.vehicle_group===M.id))return!1;const c=((z=s==null?void 0:s.label)==null?void 0:z.toLowerCase().includes(v.toLowerCase()))||((U=s==null?void 0:s.chassis_no)==null?void 0:U.toLowerCase().includes(v.toLowerCase()))||(($=s==null?void 0:s.customer_name)==null?void 0:$.toLowerCase().includes(v.toLowerCase())),u=x===""||((q=s==null?void 0:s.workShop)==null?void 0:q.region)===x,d=S===""||((J=(H=s==null?void 0:s.workShop)==null?void 0:H.state)==null?void 0:J.toLowerCase())===(((W=S==null?void 0:S.toString())==null?void 0:W.toLowerCase())||""),e=s.value,i=String(s.value).toLowerCase(),l=P.some(V=>String(V).toLowerCase()===i),w=!P.some(V=>String(V).toLowerCase()===i),o=l&&ce(e),p=l&&le(e);return c&&u&&d&&(f==="online"?l:f==="offline"?w:f==="running"?o:f==="idling"?p:!0)}).sort((s,a)=>s.label.localeCompare(a.label));return r.jsxs("div",{className:"app",children:[r.jsx(Se,{}),r.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[r.jsx(be,{title:"Live Map",setShowVehicles:A,showVehicles:_,showParameters:b,setShowParameters:G,setShowCard:oe,showCard:O,setShowVehiclesGroup:B,showVehiclesGroup:N}),r.jsx(we,{setShowVehiclesGroup:B,showVehiclesGroup:N,where:"livemap"}),r.jsxs(L,{style:{display:"flex",width:"100%",height:"95vh"},children:[r.jsx(L,{style:{width:_||b?"80%":"100%"},children:r.jsx(ve,{showCard:O,loadingVehicle:R,vehicleData:T})}),_&&r.jsx(L,{style:{width:"20%",backgroundColor:E.grey[100]},children:r.jsx(Le,{vehicleData:T,title:"Live Map",setParameterData:y,loadingVehicle:R,setShowVehicles:A,showVehicles:_,showParameters:b,setShowParameters:G,setSearchedTerm:m,setOptions:ee,setState:se,setRegion:ae,searchTerm:v,options:f,state:S,region:x})}),b&&r.jsx(L,{style:{width:"20%",backgroundColor:E.grey[100]},children:r.jsx(xe,{parametersData:te,setParameterData:y,handleParameterChange:ne})})]})]})]})}export{Ee as default};
