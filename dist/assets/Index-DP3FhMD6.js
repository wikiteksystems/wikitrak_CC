import{R as P,b as I,z as je,y as He,j as i,T as Qe,ax as le,F as pe,aW as ns,C as ne,aX as Ne,aY as ls,aZ as os,a_ as we,a$ as Re,b0 as Ie,b1 as cs,I as it,au as us,a7 as ds,D as rt,b2 as fs,b3 as hs,b4 as ms,a8 as bt,V as gs,W as ys,Y as xs,Z as ps}from"./index-oCcClIVR.js";import{V as vs}from"./VehicleMenu-BJJQv1Ay.js";import{t as bs}from"./SearchTab-BIH25pLr.js";import"./Loader-Du2nzSGy.js";import"./LiveMapServices-CaH83CXm.js";import"./Socket-0N_gnJcr.js";import{P as _s}from"./Parameters-BHplQNUf.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{af as Xe,S as _t,ag as Je,d as js,L as Vs}from"./LeftSideBar2-D1dFanV7.js";import{d as Ss}from"./Close-SjTNqcL9.js";import{d as As}from"./Add-Bf-LOUjh.js";import{c as Es,a as be,d as jt,e as Cs}from"./index.esm-DaxjkOLt.js";import{B as ae}from"./CircularProgress-DrVUYvWS.js";import{T as Ue,S as De,M as he,P as Fs}from"./TextField-CpgzIzbu.js";import{F as ke,a as qe,L as Ds,O as ks,I as qs}from"./menu2-Cq-QiCPW.js";import{D as Lt,a as Ot,b as Ut,c as ws}from"./DialogTitle-C4kkRwwI.js";import{D as Ts,E as Ls,T as Se}from"./Edit-BlPSoJmH.js";import{T as Os,a as Us,b as Ps,c as Vt,d as X,e as Ns}from"./TableRow-Bz3Qogm_.js";import{T as Rs}from"./TablePagination-CG7oJMsi.js";import{V as Is}from"./VehicleGroups-B-ap7of7.js";import{S as Bs}from"./ServicesTopBar-CrPnQC_h.js";import"./Autocomplete-C1fNGI-Q.js";import"./useControlled-MXhu2rHQ.js";import"./index-BWl9NjEF.js";import"./createSvgIcon-DQJnhenv.js";import"./Card-BEm9TwcF.js";import"./CardContent-DyloKXxI.js";var Oe=e=>e.type==="checkbox",_e=e=>e instanceof Date,J=e=>e==null;const Pt=e=>typeof e=="object";var $=e=>!J(e)&&!Array.isArray(e)&&Pt(e)&&!_e(e),Nt=e=>$(e)&&e.target?Oe(e.target)?e.target.checked:e.target.value:e,Ms=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,Rt=(e,s)=>e.has(Ms(s)),Ws=e=>{const s=e.constructor&&e.constructor.prototype;return $(s)&&s.hasOwnProperty("isPrototypeOf")},nt=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function se(e){let s;const t=Array.isArray(e);if(e instanceof Date)s=new Date(e);else if(e instanceof Set)s=new Set(e);else if(!(nt&&(e instanceof Blob||e instanceof FileList))&&(t||$(e)))if(s=t?[]:{},!t&&!Ws(e))s=e;else for(const a in e)e.hasOwnProperty(a)&&(s[a]=se(e[a]));else return e;return s}var Ge=e=>Array.isArray(e)?e.filter(Boolean):[],M=e=>e===void 0,f=(e,s,t)=>{if(!s||!$(e))return t;const a=Ge(s.split(/[,[\].]+?/)).reduce((o,n)=>J(o)?o:o[n],e);return M(a)||a===e?M(e[s])?t:e[s]:a},oe=e=>typeof e=="boolean",lt=e=>/^\w*$/.test(e),It=e=>Ge(e.replace(/["|']|\]/g,"").split(/\.|\[/)),L=(e,s,t)=>{let a=-1;const o=lt(s)?[s]:It(s),n=o.length,u=n-1;for(;++a<n;){const y=o[a];let S=t;if(a!==u){const m=e[y];S=$(m)||Array.isArray(m)?m:isNaN(+o[a+1])?{}:[]}if(y==="__proto__")return;e[y]=S,e=e[y]}return e};const Be={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},ce={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},fe={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},$s=P.createContext(null),ot=()=>P.useContext($s);var Bt=(e,s,t,a=!0)=>{const o={defaultValues:s._defaultValues};for(const n in e)Object.defineProperty(o,n,{get:()=>{const u=n;return s._proxyFormState[u]!==ce.all&&(s._proxyFormState[u]=!a||ce.all),t&&(t[u]=!0),e[u]}});return o},re=e=>$(e)&&!Object.keys(e).length,Mt=(e,s,t,a)=>{t(e);const{name:o,...n}=e;return re(n)||Object.keys(n).length>=Object.keys(s).length||Object.keys(n).find(u=>s[u]===(!a||ce.all))},Te=e=>Array.isArray(e)?e:[e],Wt=(e,s,t)=>!e||!s||e===s||Te(e).some(a=>a&&(t?a===s:a.startsWith(s)||s.startsWith(a)));function ct(e){const s=P.useRef(e);s.current=e,P.useEffect(()=>{const t=!e.disabled&&s.current.subject&&s.current.subject.subscribe({next:s.current.next});return()=>{t&&t.unsubscribe()}},[e.disabled])}function Hs(e){const s=ot(),{control:t=s.control,disabled:a,name:o,exact:n}=e||{},[u,y]=P.useState(t._formState),S=P.useRef(!0),m=P.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),b=P.useRef(o);return b.current=o,ct({disabled:a,next:g=>S.current&&Wt(b.current,g.name,n)&&Mt(g,m.current,t._updateFormState)&&y({...t._formState,...g}),subject:t._subjects.state}),P.useEffect(()=>(S.current=!0,m.current.isValid&&t._updateValid(!0),()=>{S.current=!1}),[t]),Bt(u,t,m.current,!1)}var de=e=>typeof e=="string",$t=(e,s,t,a,o)=>de(e)?(a&&s.watch.add(e),f(t,e,o)):Array.isArray(e)?e.map(n=>(a&&s.watch.add(n),f(t,n))):(a&&(s.watchAll=!0),t);function Gs(e){const s=ot(),{control:t=s.control,name:a,defaultValue:o,disabled:n,exact:u}=e||{},y=P.useRef(a);y.current=a,ct({disabled:n,subject:t._subjects.values,next:b=>{Wt(y.current,b.name,u)&&m(se($t(y.current,t._names,b.values||t._formValues,!1,o)))}});const[S,m]=P.useState(t._getWatch(a,o));return P.useEffect(()=>t._removeUnmounted()),S}function Ys(e){const s=ot(),{name:t,disabled:a,control:o=s.control,shouldUnregister:n}=e,u=Rt(o._names.array,t),y=Gs({control:o,name:t,defaultValue:f(o._formValues,t,f(o._defaultValues,t,e.defaultValue)),exact:!0}),S=Hs({control:o,name:t,exact:!0}),m=P.useRef(o.register(t,{...e.rules,value:y,...oe(e.disabled)?{disabled:e.disabled}:{}}));return P.useEffect(()=>{const b=o._options.shouldUnregister||n,g=(B,W)=>{const k=f(o._fields,B);k&&k._f&&(k._f.mount=W)};if(g(t,!0),b){const B=se(f(o._options.defaultValues,t));L(o._defaultValues,t,B),M(f(o._formValues,t))&&L(o._formValues,t,B)}return()=>{(u?b&&!o._state.action:b)?o.unregister(t):g(t,!1)}},[t,o,u,n]),P.useEffect(()=>{f(o._fields,t)&&o._updateDisabledField({disabled:a,fields:o._fields,name:t,value:f(o._fields,t)._f.value})},[a,t,o]),{field:{name:t,value:y,...oe(a)||S.disabled?{disabled:S.disabled||a}:{},onChange:P.useCallback(b=>m.current.onChange({target:{value:Nt(b),name:t},type:Be.CHANGE}),[t]),onBlur:P.useCallback(()=>m.current.onBlur({target:{value:f(o._formValues,t),name:t},type:Be.BLUR}),[t,o]),ref:P.useCallback(b=>{const g=f(o._fields,t);g&&b&&(g._f.ref={focus:()=>b.focus(),select:()=>b.select(),setCustomValidity:B=>b.setCustomValidity(B),reportValidity:()=>b.reportValidity()})},[o._fields,t])},formState:S,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!f(S.errors,t)},isDirty:{enumerable:!0,get:()=>!!f(S.dirtyFields,t)},isTouched:{enumerable:!0,get:()=>!!f(S.touchedFields,t)},isValidating:{enumerable:!0,get:()=>!!f(S.validatingFields,t)},error:{enumerable:!0,get:()=>f(S.errors,t)}})}}const ue=e=>e.render(Ys(e));var Ht=(e,s,t,a,o)=>s?{...t[e],types:{...t[e]&&t[e].types?t[e].types:{},[a]:o||!0}}:{},St=e=>({isOnSubmit:!e||e===ce.onSubmit,isOnBlur:e===ce.onBlur,isOnChange:e===ce.onChange,isOnAll:e===ce.all,isOnTouch:e===ce.onTouched}),At=(e,s,t)=>!t&&(s.watchAll||s.watch.has(e)||[...s.watch].some(a=>e.startsWith(a)&&/^\.\w+/.test(e.slice(a.length))));const Le=(e,s,t,a)=>{for(const o of t||Object.keys(e)){const n=f(e,o);if(n){const{_f:u,...y}=n;if(u){if(u.refs&&u.refs[0]&&s(u.refs[0],o)&&!a)return!0;if(u.ref&&s(u.ref,u.name)&&!a)return!0;if(Le(y,s))break}else if($(y)&&Le(y,s))break}}};var zs=(e,s,t)=>{const a=Te(f(e,t));return L(a,"root",s[t]),L(e,t,a),e},ut=e=>e.type==="file",me=e=>typeof e=="function",Me=e=>{if(!nt)return!1;const s=e?e.ownerDocument:0;return e instanceof(s&&s.defaultView?s.defaultView.HTMLElement:HTMLElement)},Pe=e=>de(e),dt=e=>e.type==="radio",We=e=>e instanceof RegExp;const Et={value:!1,isValid:!1},Ct={value:!0,isValid:!0};var Gt=e=>{if(Array.isArray(e)){if(e.length>1){const s=e.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:s,isValid:!!s.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!M(e[0].attributes.value)?M(e[0].value)||e[0].value===""?Ct:{value:e[0].value,isValid:!0}:Ct:Et}return Et};const Ft={isValid:!1,value:null};var Yt=e=>Array.isArray(e)?e.reduce((s,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:s,Ft):Ft;function Dt(e,s,t="validate"){if(Pe(e)||Array.isArray(e)&&e.every(Pe)||oe(e)&&!e)return{type:t,message:Pe(e)?e:"",ref:s}}var Ae=e=>$(e)&&!We(e)?e:{value:e,message:""},kt=async(e,s,t,a,o)=>{const{ref:n,refs:u,required:y,maxLength:S,minLength:m,min:b,max:g,pattern:B,validate:W,name:k,valueAsNumber:H,mount:G,disabled:ie}=e._f,F=f(s,k);if(!G||ie)return{};const _=u?u[0]:n,N=C=>{a&&_.reportValidity&&(_.setCustomValidity(oe(C)?"":C||""),_.reportValidity())},E={},T=dt(n),Z=Oe(n),ee=T||Z,O=(H||ut(n))&&M(n.value)&&M(F)||Me(n)&&n.value===""||F===""||Array.isArray(F)&&!F.length,U=Ht.bind(null,k,t,E),Q=(C,q,j,x=fe.maxLength,v=fe.minLength)=>{const A=C?q:j;E[k]={type:C?x:v,message:A,ref:n,...U(C?x:v,A)}};if(o?!Array.isArray(F)||!F.length:y&&(!ee&&(O||J(F))||oe(F)&&!F||Z&&!Gt(u).isValid||T&&!Yt(u).isValid)){const{value:C,message:q}=Pe(y)?{value:!!y,message:y}:Ae(y);if(C&&(E[k]={type:fe.required,message:q,ref:_,...U(fe.required,q)},!t))return N(q),E}if(!O&&(!J(b)||!J(g))){let C,q;const j=Ae(g),x=Ae(b);if(!J(F)&&!isNaN(F)){const v=n.valueAsNumber||F&&+F;J(j.value)||(C=v>j.value),J(x.value)||(q=v<x.value)}else{const v=n.valueAsDate||new Date(F),A=te=>new Date(new Date().toDateString()+" "+te),R=n.type=="time",w=n.type=="week";de(j.value)&&F&&(C=R?A(F)>A(j.value):w?F>j.value:v>new Date(j.value)),de(x.value)&&F&&(q=R?A(F)<A(x.value):w?F<x.value:v<new Date(x.value))}if((C||q)&&(Q(!!C,j.message,x.message,fe.max,fe.min),!t))return N(E[k].message),E}if((S||m)&&!O&&(de(F)||o&&Array.isArray(F))){const C=Ae(S),q=Ae(m),j=!J(C.value)&&F.length>+C.value,x=!J(q.value)&&F.length<+q.value;if((j||x)&&(Q(j,C.message,q.message),!t))return N(E[k].message),E}if(B&&!O&&de(F)){const{value:C,message:q}=Ae(B);if(We(C)&&!F.match(C)&&(E[k]={type:fe.pattern,message:q,ref:n,...U(fe.pattern,q)},!t))return N(q),E}if(W){if(me(W)){const C=await W(F,s),q=Dt(C,_);if(q&&(E[k]={...q,...U(fe.validate,q.message)},!t))return N(q.message),E}else if($(W)){let C={};for(const q in W){if(!re(C)&&!t)break;const j=Dt(await W[q](F,s),_,q);j&&(C={...j,...U(q,j.message)},N(j.message),t&&(E[k]=C))}if(!re(C)&&(E[k]={ref:_,...C},!t))return E}}return N(!0),E};function Ks(e,s){const t=s.slice(0,-1).length;let a=0;for(;a<t;)e=M(e)?a++:e[s[a++]];return e}function Zs(e){for(const s in e)if(e.hasOwnProperty(s)&&!M(e[s]))return!1;return!0}function Y(e,s){const t=Array.isArray(s)?s:lt(s)?[s]:It(s),a=t.length===1?e:Ks(e,t),o=t.length-1,n=t[o];return a&&delete a[n],o!==0&&($(a)&&re(a)||Array.isArray(a)&&Zs(a))&&Y(e,t.slice(0,-1)),e}var et=()=>{let e=[];return{get observers(){return e},next:o=>{for(const n of e)n.next&&n.next(o)},subscribe:o=>(e.push(o),{unsubscribe:()=>{e=e.filter(n=>n!==o)}}),unsubscribe:()=>{e=[]}}},at=e=>J(e)||!Pt(e);function xe(e,s){if(at(e)||at(s))return e===s;if(_e(e)&&_e(s))return e.getTime()===s.getTime();const t=Object.keys(e),a=Object.keys(s);if(t.length!==a.length)return!1;for(const o of t){const n=e[o];if(!a.includes(o))return!1;if(o!=="ref"){const u=s[o];if(_e(n)&&_e(u)||$(n)&&$(u)||Array.isArray(n)&&Array.isArray(u)?!xe(n,u):n!==u)return!1}}return!0}var zt=e=>e.type==="select-multiple",Qs=e=>dt(e)||Oe(e),tt=e=>Me(e)&&e.isConnected,Kt=e=>{for(const s in e)if(me(e[s]))return!0;return!1};function $e(e,s={}){const t=Array.isArray(e);if($(e)||t)for(const a in e)Array.isArray(e[a])||$(e[a])&&!Kt(e[a])?(s[a]=Array.isArray(e[a])?[]:{},$e(e[a],s[a])):J(e[a])||(s[a]=!0);return s}function Zt(e,s,t){const a=Array.isArray(e);if($(e)||a)for(const o in e)Array.isArray(e[o])||$(e[o])&&!Kt(e[o])?M(s)||at(t[o])?t[o]=Array.isArray(e[o])?$e(e[o],[]):{...$e(e[o])}:Zt(e[o],J(s)?{}:s[o],t[o]):t[o]=!xe(e[o],s[o]);return t}var Ce=(e,s)=>Zt(e,s,$e(s)),Qt=(e,{valueAsNumber:s,valueAsDate:t,setValueAs:a})=>M(e)?e:s?e===""?NaN:e&&+e:t&&de(e)?new Date(e):a?a(e):e;function st(e){const s=e.ref;if(!(e.refs?e.refs.every(t=>t.disabled):s.disabled))return ut(s)?s.files:dt(s)?Yt(e.refs).value:zt(s)?[...s.selectedOptions].map(({value:t})=>t):Oe(s)?Gt(e.refs).value:Qt(M(s.value)?e.ref.value:s.value,e)}var Xs=(e,s,t,a)=>{const o={};for(const n of e){const u=f(s,n);u&&L(o,n,u._f)}return{criteriaMode:t,names:[...e],fields:o,shouldUseNativeValidation:a}},Fe=e=>M(e)?e:We(e)?e.source:$(e)?We(e.value)?e.value.source:e.value:e;const qt="AsyncFunction";var Js=e=>(!e||!e.validate)&&!!(me(e.validate)&&e.validate.constructor.name===qt||$(e.validate)&&Object.values(e.validate).find(s=>s.constructor.name===qt)),er=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function wt(e,s,t){const a=f(e,t);if(a||lt(t))return{error:a,name:t};const o=t.split(".");for(;o.length;){const n=o.join("."),u=f(s,n),y=f(e,n);if(u&&!Array.isArray(u)&&t!==n)return{name:t};if(y&&y.type)return{name:n,error:y};o.pop()}return{name:t}}var tr=(e,s,t,a,o)=>o.isOnAll?!1:!t&&o.isOnTouch?!(s||e):(t?a.isOnBlur:o.isOnBlur)?!e:(t?a.isOnChange:o.isOnChange)?e:!0,sr=(e,s)=>!Ge(f(e,s)).length&&Y(e,s);const rr={mode:ce.onSubmit,reValidateMode:ce.onChange,shouldFocusError:!0};function ar(e={}){let s={...rr,...e},t={submitCount:0,isDirty:!1,isLoading:me(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},a={},o=$(s.defaultValues)||$(s.values)?se(s.defaultValues||s.values)||{}:{},n=s.shouldUnregister?{}:se(o),u={action:!1,mount:!1,watch:!1},y={mount:new Set,unMount:new Set,array:new Set,watch:new Set},S,m=0;const b={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},g={values:et(),array:et(),state:et()},B=St(s.mode),W=St(s.reValidateMode),k=s.criteriaMode===ce.all,H=r=>l=>{clearTimeout(m),m=setTimeout(r,l)},G=async r=>{if(!e.disabled&&(b.isValid||r)){const l=s.resolver?re((await ee()).errors):await U(a,!0);l!==t.isValid&&g.state.next({isValid:l})}},ie=(r,l)=>{!e.disabled&&(b.isValidating||b.validatingFields)&&((r||Array.from(y.mount)).forEach(c=>{c&&(l?L(t.validatingFields,c,l):Y(t.validatingFields,c))}),g.state.next({validatingFields:t.validatingFields,isValidating:!re(t.validatingFields)}))},F=(r,l=[],c,p,h=!0,d=!0)=>{if(p&&c&&!e.disabled){if(u.action=!0,d&&Array.isArray(f(a,r))){const V=c(f(a,r),p.argA,p.argB);h&&L(a,r,V)}if(d&&Array.isArray(f(t.errors,r))){const V=c(f(t.errors,r),p.argA,p.argB);h&&L(t.errors,r,V),sr(t.errors,r)}if(b.touchedFields&&d&&Array.isArray(f(t.touchedFields,r))){const V=c(f(t.touchedFields,r),p.argA,p.argB);h&&L(t.touchedFields,r,V)}b.dirtyFields&&(t.dirtyFields=Ce(o,n)),g.state.next({name:r,isDirty:C(r,l),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else L(n,r,l)},_=(r,l)=>{L(t.errors,r,l),g.state.next({errors:t.errors})},N=r=>{t.errors=r,g.state.next({errors:t.errors,isValid:!1})},E=(r,l,c,p)=>{const h=f(a,r);if(h){const d=f(n,r,M(c)?f(o,r):c);M(d)||p&&p.defaultChecked||l?L(n,r,l?d:st(h._f)):x(r,d),u.mount&&G()}},T=(r,l,c,p,h)=>{let d=!1,V=!1;const D={name:r};if(!e.disabled){const z=!!(f(a,r)&&f(a,r)._f&&f(a,r)._f.disabled);if(!c||p){b.isDirty&&(V=t.isDirty,t.isDirty=D.isDirty=C(),d=V!==D.isDirty);const K=z||xe(f(o,r),l);V=!!(!z&&f(t.dirtyFields,r)),K||z?Y(t.dirtyFields,r):L(t.dirtyFields,r,!0),D.dirtyFields=t.dirtyFields,d=d||b.dirtyFields&&V!==!K}if(c){const K=f(t.touchedFields,r);K||(L(t.touchedFields,r,c),D.touchedFields=t.touchedFields,d=d||b.touchedFields&&K!==c)}d&&h&&g.state.next(D)}return d?D:{}},Z=(r,l,c,p)=>{const h=f(t.errors,r),d=b.isValid&&oe(l)&&t.isValid!==l;if(e.delayError&&c?(S=H(()=>_(r,c)),S(e.delayError)):(clearTimeout(m),S=null,c?L(t.errors,r,c):Y(t.errors,r)),(c?!xe(h,c):h)||!re(p)||d){const V={...p,...d&&oe(l)?{isValid:l}:{},errors:t.errors,name:r};t={...t,...V},g.state.next(V)}},ee=async r=>{ie(r,!0);const l=await s.resolver(n,s.context,Xs(r||y.mount,a,s.criteriaMode,s.shouldUseNativeValidation));return ie(r),l},O=async r=>{const{errors:l}=await ee(r);if(r)for(const c of r){const p=f(l,c);p?L(t.errors,c,p):Y(t.errors,c)}else t.errors=l;return l},U=async(r,l,c={valid:!0})=>{for(const p in r){const h=r[p];if(h){const{_f:d,...V}=h;if(d){const D=y.array.has(d.name),z=h._f&&Js(h._f);z&&b.validatingFields&&ie([p],!0);const K=await kt(h,n,k,s.shouldUseNativeValidation&&!l,D);if(z&&b.validatingFields&&ie([p]),K[d.name]&&(c.valid=!1,l))break;!l&&(f(K,d.name)?D?zs(t.errors,K,d.name):L(t.errors,d.name,K[d.name]):Y(t.errors,d.name))}!re(V)&&await U(V,l,c)}}return c.valid},Q=()=>{for(const r of y.unMount){const l=f(a,r);l&&(l._f.refs?l._f.refs.every(c=>!tt(c)):!tt(l._f.ref))&&Ye(r)}y.unMount=new Set},C=(r,l)=>!e.disabled&&(r&&l&&L(n,r,l),!xe(Ee(),o)),q=(r,l,c)=>$t(r,y,{...u.mount?n:M(l)?o:de(r)?{[r]:l}:l},c,l),j=r=>Ge(f(u.mount?n:o,r,e.shouldUnregister?f(o,r,[]):[])),x=(r,l,c={})=>{const p=f(a,r);let h=l;if(p){const d=p._f;d&&(!d.disabled&&L(n,r,Qt(l,d)),h=Me(d.ref)&&J(l)?"":l,zt(d.ref)?[...d.ref.options].forEach(V=>V.selected=h.includes(V.value)):d.refs?Oe(d.ref)?d.refs.length>1?d.refs.forEach(V=>(!V.defaultChecked||!V.disabled)&&(V.checked=Array.isArray(h)?!!h.find(D=>D===V.value):h===V.value)):d.refs[0]&&(d.refs[0].checked=!!h):d.refs.forEach(V=>V.checked=V.value===h):ut(d.ref)?d.ref.value="":(d.ref.value=h,d.ref.type||g.values.next({name:r,values:{...n}})))}(c.shouldDirty||c.shouldTouch)&&T(r,h,c.shouldTouch,c.shouldDirty,!0),c.shouldValidate&&te(r)},v=(r,l,c)=>{for(const p in l){const h=l[p],d=`${r}.${p}`,V=f(a,d);(y.array.has(r)||$(h)||V&&!V._f)&&!_e(h)?v(d,h,c):x(d,h,c)}},A=(r,l,c={})=>{const p=f(a,r),h=y.array.has(r),d=se(l);L(n,r,d),h?(g.array.next({name:r,values:{...n}}),(b.isDirty||b.dirtyFields)&&c.shouldDirty&&g.state.next({name:r,dirtyFields:Ce(o,n),isDirty:C(r,d)})):p&&!p._f&&!J(d)?v(r,d,c):x(r,d,c),At(r,y)&&g.state.next({...t}),g.values.next({name:u.mount?r:void 0,values:{...n}})},R=async r=>{u.mount=!0;const l=r.target;let c=l.name,p=!0;const h=f(a,c),d=()=>l.type?st(h._f):Nt(r),V=D=>{p=Number.isNaN(D)||_e(D)&&isNaN(D.getTime())||xe(D,f(n,c,D))};if(h){let D,z;const K=d(),ve=r.type===Be.BLUR||r.type===Be.FOCUS_OUT,rs=!er(h._f)&&!s.resolver&&!f(t.errors,c)&&!h._f.deps||tr(ve,f(t.touchedFields,c),t.isSubmitted,W,B),Ke=At(c,y,ve);L(n,c,K),ve?(h._f.onBlur&&h._f.onBlur(r),S&&S(0)):h._f.onChange&&h._f.onChange(r);const Ze=T(c,K,ve,!1),as=!re(Ze)||Ke;if(!ve&&g.values.next({name:c,type:r.type,values:{...n}}),rs)return b.isValid&&(e.mode==="onBlur"?ve&&G():G()),as&&g.state.next({name:c,...Ke?{}:Ze});if(!ve&&Ke&&g.state.next({...t}),s.resolver){const{errors:pt}=await ee([c]);if(V(K),p){const is=wt(t.errors,a,c),vt=wt(pt,a,is.name||c);D=vt.error,c=vt.name,z=re(pt)}}else ie([c],!0),D=(await kt(h,n,k,s.shouldUseNativeValidation))[c],ie([c]),V(K),p&&(D?z=!1:b.isValid&&(z=await U(a,!0)));p&&(h._f.deps&&te(h._f.deps),Z(c,z,D,Ze))}},w=(r,l)=>{if(f(t.errors,l)&&r.focus)return r.focus(),1},te=async(r,l={})=>{let c,p;const h=Te(r);if(s.resolver){const d=await O(M(r)?r:h);c=re(d),p=r?!h.some(V=>f(d,V)):c}else r?(p=(await Promise.all(h.map(async d=>{const V=f(a,d);return await U(V&&V._f?{[d]:V}:V)}))).every(Boolean),!(!p&&!t.isValid)&&G()):p=c=await U(a);return g.state.next({...!de(r)||b.isValid&&c!==t.isValid?{}:{name:r},...s.resolver||!r?{isValid:c}:{},errors:t.errors}),l.shouldFocus&&!p&&Le(a,w,r?h:y.mount),p},Ee=r=>{const l={...u.mount?n:o};return M(r)?l:de(r)?f(l,r):r.map(c=>f(l,c))},Ve=(r,l)=>({invalid:!!f((l||t).errors,r),isDirty:!!f((l||t).dirtyFields,r),error:f((l||t).errors,r),isValidating:!!f(t.validatingFields,r),isTouched:!!f((l||t).touchedFields,r)}),Jt=r=>{r&&Te(r).forEach(l=>Y(t.errors,l)),g.state.next({errors:r?t.errors:{}})},ft=(r,l,c)=>{const p=(f(a,r,{_f:{}})._f||{}).ref,h=f(t.errors,r)||{},{ref:d,message:V,type:D,...z}=h;L(t.errors,r,{...z,...l,ref:p}),g.state.next({name:r,errors:t.errors,isValid:!1}),c&&c.shouldFocus&&p&&p.focus&&p.focus()},es=(r,l)=>me(r)?g.values.subscribe({next:c=>r(q(void 0,l),c)}):q(r,l,!0),Ye=(r,l={})=>{for(const c of r?Te(r):y.mount)y.mount.delete(c),y.array.delete(c),l.keepValue||(Y(a,c),Y(n,c)),!l.keepError&&Y(t.errors,c),!l.keepDirty&&Y(t.dirtyFields,c),!l.keepTouched&&Y(t.touchedFields,c),!l.keepIsValidating&&Y(t.validatingFields,c),!s.shouldUnregister&&!l.keepDefaultValue&&Y(o,c);g.values.next({values:{...n}}),g.state.next({...t,...l.keepDirty?{isDirty:C()}:{}}),!l.keepIsValid&&G()},ht=({disabled:r,name:l,field:c,fields:p,value:h})=>{if(oe(r)&&u.mount||r){const d=r?void 0:M(h)?st(c?c._f:f(p,l)._f):h;L(n,l,d),T(l,d,!1,!1,!0)}},ze=(r,l={})=>{let c=f(a,r);const p=oe(l.disabled)||oe(e.disabled);return L(a,r,{...c||{},_f:{...c&&c._f?c._f:{ref:{name:r}},name:r,mount:!0,...l}}),y.mount.add(r),c?ht({field:c,disabled:oe(l.disabled)?l.disabled:e.disabled,name:r,value:l.value}):E(r,!0,l.value),{...p?{disabled:l.disabled||e.disabled}:{},...s.progressive?{required:!!l.required,min:Fe(l.min),max:Fe(l.max),minLength:Fe(l.minLength),maxLength:Fe(l.maxLength),pattern:Fe(l.pattern)}:{},name:r,onChange:R,onBlur:R,ref:h=>{if(h){ze(r,l),c=f(a,r);const d=M(h.value)&&h.querySelectorAll&&h.querySelectorAll("input,select,textarea")[0]||h,V=Qs(d),D=c._f.refs||[];if(V?D.find(z=>z===d):d===c._f.ref)return;L(a,r,{_f:{...c._f,...V?{refs:[...D.filter(tt),d,...Array.isArray(f(o,r))?[{}]:[]],ref:{type:d.type,name:r}}:{ref:d}}}),E(r,!1,void 0,d)}else c=f(a,r,{}),c._f&&(c._f.mount=!1),(s.shouldUnregister||l.shouldUnregister)&&!(Rt(y.array,r)&&u.action)&&y.unMount.add(r)}}},mt=()=>s.shouldFocusError&&Le(a,w,y.mount),ts=r=>{oe(r)&&(g.state.next({disabled:r}),Le(a,(l,c)=>{const p=f(a,c);p&&(l.disabled=p._f.disabled||r,Array.isArray(p._f.refs)&&p._f.refs.forEach(h=>{h.disabled=p._f.disabled||r}))},0,!1))},gt=(r,l)=>async c=>{let p;c&&(c.preventDefault&&c.preventDefault(),c.persist&&c.persist());let h=se(n);if(g.state.next({isSubmitting:!0}),s.resolver){const{errors:d,values:V}=await ee();t.errors=d,h=V}else await U(a);if(Y(t.errors,"root"),re(t.errors)){g.state.next({errors:{}});try{await r(h,c)}catch(d){p=d}}else l&&await l({...t.errors},c),mt(),setTimeout(mt);if(g.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:re(t.errors)&&!p,submitCount:t.submitCount+1,errors:t.errors}),p)throw p},ss=(r,l={})=>{f(a,r)&&(M(l.defaultValue)?A(r,se(f(o,r))):(A(r,l.defaultValue),L(o,r,se(l.defaultValue))),l.keepTouched||Y(t.touchedFields,r),l.keepDirty||(Y(t.dirtyFields,r),t.isDirty=l.defaultValue?C(r,se(f(o,r))):C()),l.keepError||(Y(t.errors,r),b.isValid&&G()),g.state.next({...t}))},yt=(r,l={})=>{const c=r?se(r):o,p=se(c),h=re(r),d=h?o:p;if(l.keepDefaultValues||(o=c),!l.keepValues){if(l.keepDirtyValues){const V=new Set([...y.mount,...Object.keys(Ce(o,n))]);for(const D of Array.from(V))f(t.dirtyFields,D)?L(d,D,f(n,D)):A(D,f(d,D))}else{if(nt&&M(r))for(const V of y.mount){const D=f(a,V);if(D&&D._f){const z=Array.isArray(D._f.refs)?D._f.refs[0]:D._f.ref;if(Me(z)){const K=z.closest("form");if(K){K.reset();break}}}}a={}}n=e.shouldUnregister?l.keepDefaultValues?se(o):{}:se(d),g.array.next({values:{...d}}),g.values.next({values:{...d}})}y={mount:l.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},u.mount=!b.isValid||!!l.keepIsValid||!!l.keepDirtyValues,u.watch=!!e.shouldUnregister,g.state.next({submitCount:l.keepSubmitCount?t.submitCount:0,isDirty:h?!1:l.keepDirty?t.isDirty:!!(l.keepDefaultValues&&!xe(r,o)),isSubmitted:l.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:h?{}:l.keepDirtyValues?l.keepDefaultValues&&n?Ce(o,n):t.dirtyFields:l.keepDefaultValues&&r?Ce(o,r):l.keepDirty?t.dirtyFields:{},touchedFields:l.keepTouched?t.touchedFields:{},errors:l.keepErrors?t.errors:{},isSubmitSuccessful:l.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1})},xt=(r,l)=>yt(me(r)?r(n):r,l);return{control:{register:ze,unregister:Ye,getFieldState:Ve,handleSubmit:gt,setError:ft,_executeSchema:ee,_getWatch:q,_getDirty:C,_updateValid:G,_removeUnmounted:Q,_updateFieldArray:F,_updateDisabledField:ht,_getFieldArray:j,_reset:yt,_resetDefaultValues:()=>me(s.defaultValues)&&s.defaultValues().then(r=>{xt(r,s.resetOptions),g.state.next({isLoading:!1})}),_updateFormState:r=>{t={...t,...r}},_disableForm:ts,_subjects:g,_proxyFormState:b,_setErrors:N,get _fields(){return a},get _formValues(){return n},get _state(){return u},set _state(r){u=r},get _defaultValues(){return o},get _names(){return y},set _names(r){y=r},get _formState(){return t},set _formState(r){t=r},get _options(){return s},set _options(r){s={...s,...r}}},trigger:te,register:ze,handleSubmit:gt,watch:es,setValue:A,getValues:Ee,reset:xt,resetField:ss,clearErrors:Jt,unregister:Ye,setError:ft,setFocus:(r,l={})=>{const c=f(a,r),p=c&&c._f;if(p){const h=p.refs?p.refs[0]:p.ref;h.focus&&(h.focus(),l.shouldSelect&&h.select())}},getFieldState:Ve}}function ir(e={}){const s=P.useRef(),t=P.useRef(),[a,o]=P.useState({isDirty:!1,isValidating:!1,isLoading:me(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:me(e.defaultValues)?void 0:e.defaultValues});s.current||(s.current={...ar(e),formState:a});const n=s.current.control;return n._options=e,ct({subject:n._subjects.state,next:u=>{Mt(u,n._proxyFormState,n._updateFormState,!0)&&o({...n._formState})}}),P.useEffect(()=>n._disableForm(e.disabled),[n,e.disabled]),P.useEffect(()=>{if(n._proxyFormState.isDirty){const u=n._getDirty();u!==a.isDirty&&n._subjects.state.next({isDirty:u})}},[n,a.isDirty]),P.useEffect(()=>{e.values&&!xe(e.values,t.current)?(n._reset(e.values,n._options.resetOptions),t.current=e.values,o(u=>({...u}))):n._resetDefaultValues()},[e.values,n]),P.useEffect(()=>{e.errors&&n._setErrors(e.errors)},[e.errors,n]),P.useEffect(()=>{n._state.mount||(n._updateValid(),n._state.mount=!0),n._state.watch&&(n._state.watch=!1,n._subjects.state.next({...n._formState})),n._removeUnmounted()}),P.useEffect(()=>{e.shouldUnregister&&n._subjects.values.next({values:n._getWatch()})},[e.shouldUnregister,n]),P.useEffect(()=>{s.current&&(s.current.watch=s.current.watch.bind({}))},[a]),s.current.formState=Bt(a,n),s.current}const Tt=(e,s,t)=>{if(e&&"reportValidity"in e){const a=f(t,s);e.setCustomValidity(a&&a.message||""),e.reportValidity()}},Xt=(e,s)=>{for(const t in s.fields){const a=s.fields[t];a&&a.ref&&"reportValidity"in a.ref?Tt(a.ref,t,e):a.refs&&a.refs.forEach(o=>Tt(o,t,e))}},nr=(e,s)=>{s.shouldUseNativeValidation&&Xt(e,s);const t={};for(const a in e){const o=f(s.fields,a),n=Object.assign(e[a]||{},{ref:o&&o.ref});if(lr(s.names||Object.keys(e),a)){const u=Object.assign({},f(t,a));L(u,"root",n),L(t,a,u)}else L(t,a,n)}return t},lr=(e,s)=>e.some(t=>t.startsWith(s+"."));function or(e,s,t){return s===void 0&&(s={}),t===void 0&&(t={}),function(a,o,n){try{return Promise.resolve(function(u,y){try{var S=(s.context,Promise.resolve(e[t.mode==="sync"?"validateSync":"validate"](a,Object.assign({abortEarly:!1},s,{context:o}))).then(function(m){return n.shouldUseNativeValidation&&Xt({},n),{values:t.raw?a:m,errors:{}}}))}catch(m){return y(m)}return S&&S.then?S.then(void 0,y):S}(0,function(u){if(!u.inner)throw u;return{values:{},errors:nr((y=u,S=!n.shouldUseNativeValidation&&n.criteriaMode==="all",(y.inner||[]).reduce(function(m,b){if(m[b.path]||(m[b.path]={message:b.message,type:b.type}),S){var g=m[b.path].types,B=g&&g[b.type];m[b.path]=Ht(b.path,S,m,b.type,B?[].concat(B,b.message):b.message)}return m},{})),n)};var y,S}))}catch(u){return Promise.reject(u)}}}const cr=Es().shape({name:be().required("Name is required"),vehicle_model:jt().required("Vehicle model is required"),operator:be().required("Operator is required"),equipment_type:be().required("Equipment type is required"),serial_no:be().required("Serial No is required."),chassis_no:be().required("Chassis No is required."),odometer:jt().required("Odometer is required."),status:be().required("Status is required"),oem:be().required("OEM is required"),attachment:Cs().nullable()});function ur(){var j;const{handleSubmit:e,control:s,formState:{errors:t},reset:a}=ir({resolver:or(cr),defaultValues:{name:"",vehicle_model:"",operator:"",equipment_type:"",serial_no:"",chassis_no:"",odometer:"",status:"Assigned",oem:"",attachment:null}}),[o,n]=I.useState([]),{oemList:u,userList:y,equipmentTypes:S,UpdatedEqipmentData:m,isUpdateEqipment:b,isAddEqipment:g}=je(x=>x.equipment),[B,W]=I.useState(null),[k,H]=I.useState(null),[G,ie]=I.useState(""),[F,_]=I.useState(null),[N,E]=I.useState("Upload Attachment"),T=He();I.useEffect(()=>{console.log("equipmentTypes",S)},[S]),I.useEffect(()=>{if(console.log("UpdatedEqipmentData",m),m){a({name:m.name,vehicle_model:m.vehicle_model.id,operator:m.operator.id,equipment_type:m.equipment_type.id,serial_no:m.serial_no,chassis_no:m.chassis_no,odometer:m.odometer,status:m.status,oem:m.vehicle_model.oem,attachment:m.attachment});let x=[];x.push(m.vehicle_model),n(x),H(m.operator.id),_(m.attachment),E("edit")}},[m,a]);const Z=async x=>{console.log("form data",x);const v=new FormData;if(Object.keys(x).forEach(A=>v.append(A,x[A])),!m)T(ns(v)).unwrap().then(()=>{ne.success("Equipment added successfully"),a(),T(Ne())}).catch(A=>{var R,w;ne.error("Failed to add equipment"),console.error("Error adding equipment:",A),((R=A==null?void 0:A.attachment)==null?void 0:R.length)>0&&A.attachment.map(te=>ne.error(`Error: ${te}`)),((w=A==null?void 0:A.name)==null?void 0:w.length)>0&&A.name.map(te=>ne.error(`Error: ${te}`))});else{const A=m.id;if(console.log("payload in action",v),typeof x.attachment=="string"){let w=await ls(x.attachment);console.log("file conversion",w),x.attachment=w}let R=new FormData;Object.keys(x).forEach(w=>{w==="attachment"&&x.attachment instanceof Blob?R.append(w,x.attachment,"attachment.jpg"):R.append(w,x[w])});for(let[w,te]of R.entries())console.log(w,te);T(os({formData:R,id:A})).unwrap().then(()=>{ne.success("Equipment updated successfully"),a(),T(Ne()),T(we(null)),T(Re(!1)),T(Ie(!1))}).catch(w=>{var te,Ee;ne.error("Failed to update equipment"),console.error("Error updating equipment:",w),((te=w==null?void 0:w.attachment)==null?void 0:te.length)>0&&w.attachment.map(Ve=>ne.error(`Error: ${Ve}`)),((Ee=w==null?void 0:w.name)==null?void 0:Ee.length)>0&&w.name.map(Ve=>ne.error(`Error: ${Ve}`))})}},ee=async x=>{try{const v=await T(cs({oem_id:x}));v!=null&&v.payload&&n(v.payload.map(A=>({id:A.id,name:A.name,oem:A.oem})))}catch(v){console.error("Error while getting submodels:",v)}},O=x=>W(x.currentTarget),U=()=>{T(we(null)),W(null)},Q=y==null?void 0:y.filter(x=>`${x.first_name} ${x.last_name}`.toLowerCase().includes(G.toLowerCase())),C=x=>{H(x),U()},q=()=>{T(Ie(!1)),T(Re(!1)),T(we(null)),console.log("Form Canceled")};return i.jsxs(ae,{component:"form",onSubmit:e(Z),sx:{p:3,backgroundColor:"#fff",borderRadius:2,boxShadow:3},children:[i.jsx(Qe,{variant:"h6",sx:{mb:2},children:"Add New Equipment"}),i.jsxs(le,{container:!0,spacing:2,children:[i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"name",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Name",fullWidth:!0,variant:"outlined",error:!!t.name,helperText:(v=t.name)==null?void 0:v.message})}})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"oem",control:s,render:({field:x})=>i.jsxs(ke,{fullWidth:!0,variant:"outlined",error:!!t.oem,children:[i.jsx(qe,{children:"OEM"}),i.jsxs(De,{...x,label:"OEM",onChange:v=>{x.onChange(v.target.value),ee(v.target.value)},children:[i.jsx(he,{value:"",children:"Select OEM"}),u==null?void 0:u.map((v,A)=>i.jsx(he,{value:v.id,children:v.name},A))]})]})})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"vehicle_model",control:s,render:({field:x})=>i.jsxs(ke,{fullWidth:!0,variant:"outlined",error:!!t.vehicle_model,children:[i.jsx(qe,{children:"Vehicle Model"}),i.jsx(De,{...x,label:"Vehicle Model",children:o.map(v=>i.jsx(he,{value:v.id,children:v.name},v.id))})]})})}),i.jsxs(le,{item:!0,xs:12,sm:6,children:[i.jsx(ue,{name:"operator",control:s,render:({field:x})=>i.jsxs(i.Fragment,{children:[i.jsx(pe,{fullWidth:!0,onClick:O,sx:{textAlign:"left",border:1,p:1.5},children:k?`${k.first_name} ${k.last_name}`:"Select Operator"}),i.jsx(Fs,{open:!!B,anchorEl:B,onClose:U,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{maxHeight:300,overflowY:"auto"}},children:i.jsxs(Ds,{children:[i.jsx(Xe,{children:i.jsx(ks,{autoFocus:!0,placeholder:"Search user",fullWidth:!0,value:G,onChange:v=>ie(v.target.value)})}),Q.length>0?Q.map((v,A)=>i.jsx(Xe,{button:!0,onClick:()=>{C(v),x.onChange(v.id)},children:i.jsx(_t,{primary:`${v.first_name} ${v.last_name}`,secondary:v.email})},A)):i.jsx(Xe,{children:i.jsx(_t,{primary:"No Operator found"})})]})})]})}),i.jsx(Qe,{variant:"caption",color:"error",children:(j=t.operator)==null?void 0:j.message})]}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"equipment_type",control:s,render:({field:x})=>i.jsxs(ke,{fullWidth:!0,variant:"outlined",error:!!t.equipment_type,children:[i.jsx(qe,{children:"Equipment Types"}),i.jsxs(De,{...x,label:"Equipment Type",onChange:v=>{x.onChange(v.target.value)},children:[i.jsx(he,{value:"",children:"Select Equipment Type"}),S==null?void 0:S.map((v,A)=>i.jsx(he,{value:v.id,children:v.name},A))]})]})})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"serial_no",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Serial Number",fullWidth:!0,variant:"outlined",error:!!t.serial_no,helperText:(v=t.serial_no)==null?void 0:v.message})}})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"chassis_no",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Chassis Number",fullWidth:!0,variant:"outlined",error:!!t.chassis_no,helperText:(v=t.chassis_no)==null?void 0:v.message})}})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"odometer",control:s,render:({field:x})=>{var v;return i.jsx(Ue,{...x,label:"Odometer",fullWidth:!0,type:"number",variant:"outlined",error:!!t.odometer,helperText:(v=t.odometer)==null?void 0:v.message})}})}),i.jsx(le,{item:!0,xs:12,sm:6,children:i.jsx(ue,{name:"status",control:s,render:({field:x})=>i.jsxs(ke,{fullWidth:!0,variant:"outlined",error:!!t.status,children:[i.jsx(qe,{children:"Status"}),i.jsxs(De,{...x,label:"Status",children:[i.jsx(he,{value:"Assigned",children:"Assigned"}),i.jsx(he,{value:"Unassigned",children:"Unassigned"})]})]})})}),i.jsxs(le,{item:!0,xs:12,sm:6,children:[i.jsx(ue,{name:"attachment",control:s,render:({field:x})=>i.jsxs(pe,{variant:"outlined",component:"label",fullWidth:!0,children:[N,i.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:v=>{const A=v.target.files[0];if(x.onChange(A),A){const R=URL.createObjectURL(A);_(R),E(A.name)}}})]})}),F&&i.jsxs(ae,{mt:2,textAlign:"center",children:[i.jsx(Qe,{variant:"subtitle1",children:"Uploaded Image:"}),i.jsx("img",{src:F,alt:"Preview",style:{width:"100%",maxHeight:"300px",objectFit:"contain"}})]})]}),i.jsxs(le,{item:!0,xs:12,children:[i.jsx(pe,{color:"primary",sx:{marginRight:"10px",border:"1px solid #f6f6f6"},onClick:q,children:"Cancel"}),i.jsx(pe,{variant:"contained",color:"primary",type:"submit",children:m?"Update":"Submit"})]})]})]})}const dr=({open:e,onClose:s,onConfirm:t})=>i.jsxs(Lt,{open:e,onClose:s,children:[i.jsx(Ot,{children:"Confirm Deletion"}),i.jsx(Ut,{children:i.jsxs(Ts,{children:["Are you sure you want to delete this vehicle data?"," ",i.jsx("span",{style:{color:"red"},children:"This action cannot be undone."})]})}),i.jsxs(ws,{children:[i.jsx(pe,{onClick:s,color:"primary",children:"Cancel"}),i.jsx(pe,{onClick:t,color:"secondary",children:"Delete"})]})]}),fr="http://134.209.145.234/api/v1",hr={display:"flex",alignItems:"left",justifyContent:"left",gap:"8px"},mr=({equipmentData:e})=>{const s=He(),{isUpdateEqipment:t}=je(m=>m.equipment),[a,o]=I.useState(!1),n=()=>{console.log("equipmentData",e);const m=localStorage.getItem("role");us.includes(m)?(s(Ie(!t)),s(we(e))):ne.error(`Sorry! Your role is ${m}. You're not allowed to add, edit or delete the vehicle`)},u=async()=>{console.log("Vehicle data deleting");try{await ds.delete(`${fr}/vehicles/delete/${vehicleData.id}/`),ne.success("Vehicle data deleted successfully!"),s(Ne())}catch(m){console.error("Error deleting vehicle data:",m),ne.error("Failed to delete vehicle data. Please try again.")}o(!1)},y=()=>{o(!1)},S={color:"#686868"};return i.jsxs(ae,{sx:hr,children:[i.jsx(it,{onClick:n,children:i.jsx(Ls,{sx:S})}),i.jsx(dr,{open:a,onClose:y,onConfirm:u})]})},gr=[{id:"all",name:"All"},{id:"assigned",name:"Assigned"},{id:"unassigned",name:"Unassigned"}],yr={assigned:!1,unAssgined:!1,all:!0},xr=()=>{const{isAddEqipment:e,equipmentTypes:s,isUpdateEqipment:t}=je(k=>k.equipment),[a,o]=I.useState(""),[n,u]=I.useState(yr),[y,S]=I.useState("");let m=He();const b=()=>{m(Re(!e))},g=()=>{m(Re(!1)),m(Ie(!1)),m(we(null))},B=k=>{console.log("equipment type selected",k),o(k.id)},W=k=>{const H={assigned:k.id==="assigned",unassigned:k.id==="unassigned",all:k.id==="all"};u(H)};return i.jsxs(ae,{sx:{bgcolor:"white",height:"89vh",m:"15px",borderRadius:"10px"},children:[i.jsx(pr,{handleAdd:b,handleFilters:W,appliedFilters:n}),i.jsx(Je,{}),i.jsxs(ae,{sx:{display:"flex",width:"100%",gap:"30px",padding:"10px"},children:[i.jsx(vr,{searchQuery:y,setSearchQuery:S}),i.jsx(br,{equipmentTypes:s,handleOnChange:B,selectedValue:a})]}),i.jsx(Je,{}),i.jsx(_r,{appliedFilters:n,selectedEquipmentType:a,searchQuery:y}),i.jsx(Je,{}),i.jsxs(Lt,{open:e||t,onClose:g,maxWidth:"md",fullWidth:!0,children:[i.jsx(Ot,{children:i.jsx(it,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8,color:k=>k.palette.grey[500]},children:i.jsx(Ss,{})})}),i.jsx(Ut,{children:i.jsx(ur,{})})]})]})},pr=({handleAdd:e,handleFilters:s,appliedFilters:t})=>i.jsxs(ae,{sx:{display:"flex",justifyContent:"space-between",padding:"10px"},children:[i.jsx(ae,{children:gr.map(a=>i.jsx(pe,{onClick:()=>{s(a)},sx:{background:t[a.id]?"lightblue":"transparent",color:t[a.id]?"white":"black",ml:"3px","&:hover":{background:t[a.id]?rt.bgColor:"lightgrey"}},children:a.name},a.id))}),i.jsxs(pe,{onClick:e,sx:{color:"black",background:rt.bgColor},children:[i.jsx(As,{}),"Equipment"]})]}),vr=({setSearchQuery:e,searchQuery:s})=>i.jsxs(ae,{component:"form",border:"1px solid #000000",backgroundColor:"white",borderRadius:"20px",opacity:"75%",m:"3px",width:300,children:[i.jsx(qs,{sx:{my:.5,mx:2},placeholder:"Search equipments...",value:s,onChange:t=>e(t.target.value)}),i.jsx(it,{type:"submit",sx:{p:1},children:i.jsx(js,{})})]}),br=({equipmentTypes:e,handleOnChange:s,selectedValue:t})=>i.jsx(ae,{sx:{width:"200px"},children:i.jsxs(ke,{fullWidth:!0,children:[i.jsx(qe,{id:"equipment-type-label",children:"Equipment Type"}),i.jsxs(De,{labelId:"equipment-type-label",id:"equipment-type-select",label:"Equipment Type",value:t,onChange:a=>{const o=e.find(n=>n.id===a.target.value);s(o||{id:"",name:"No Equipment"})},children:[i.jsx(he,{value:"",children:"No Equipment"}),e&&e.length>0&&e.map(a=>i.jsx(he,{value:a.id,children:a.name},a.id))]})]})}),ge={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},ye={fontSize:"14px",padding:"10px"},_r=({appliedFilters:e,selectedEquipmentType:s,searchQuery:t})=>{const a=[5,10,25],[o,n]=I.useState(0),[u,y]=I.useState(10),{equipmentList:S}=je(_=>_.equipment),[m,b]=I.useState("asc"),[g,B]=I.useState(""),W=(_,N)=>{n(N)},k=_=>{y(parseInt(_.target.value,10)),n(0)},H=_=>{b(g===_&&m==="asc"?"desc":"asc"),B(_)},G=(_,N)=>N.split(".").reduce((E,T)=>E&&E[T],_),F=(_=>[..._].sort((N,E)=>{const T=G(N,g)||"",Z=G(E,g)||"";return T<Z?m==="asc"?-1:1:T>Z?m==="asc"?1:-1:0}))(S.filter(_=>{var Z,ee,O,U,Q;const N=(e==null?void 0:e.all)||(e==null?void 0:e.assigned)&&(_==null?void 0:_.status.toLowerCase())==="assigned"||e.unassigned&&(_==null?void 0:_.status.toLowerCase())==="unassigned"||(e==null?void 0:e.archived)&&(_==null?void 0:_.archived)===!0,E=!s||((Z=_==null?void 0:_.equipment_type)==null?void 0:Z.id)===s,T=!t||_.name.toLowerCase().includes(t.toLowerCase())||((ee=_==null?void 0:_.serial_no)==null?void 0:ee.toLowerCase().includes(t.toLowerCase()))||((O=_==null?void 0:_.operator)==null?void 0:O.email)&&((U=_==null?void 0:_.operator)==null?void 0:U.email.toLowerCase().includes(t.toLowerCase()))||((Q=_==null?void 0:_.equipment_type)==null?void 0:Q.name.toLowerCase().includes(t.toLowerCase()));return N&&E&&T}));return i.jsxs(ae,{children:[i.jsx(Os,{sx:{height:"66vh",bgcolor:"white",borderRadius:"10px"},children:i.jsxs(Us,{stickyHeader:!0,children:[i.jsx(Ps,{children:i.jsxs(Vt,{children:[i.jsx(X,{sx:ge,children:i.jsx(Se,{active:g==="name",direction:g==="name"?m:"asc",onClick:()=>H("name"),children:"Name"})}),i.jsx(X,{sx:ge,children:i.jsx(Se,{active:g==="vehicle_model.name",direction:g==="vehicle_model.name"?m:"asc",onClick:()=>H("vehicle_model.name"),children:"Model"})}),i.jsx(X,{sx:ge,children:i.jsx(Se,{active:g==="serial_no",direction:g==="serial_no"?m:"asc",onClick:()=>H("serial_no"),children:"Serial"})}),i.jsx(X,{sx:ge,children:i.jsx(Se,{active:g==="operator.name",direction:g==="operator.name"?m:"asc",onClick:()=>H("operator.name"),children:"Operator"})}),i.jsx(X,{sx:ge,children:i.jsx(Se,{active:g==="equipment_type.name",direction:g==="equipment_type.name"?m:"asc",onClick:()=>H("equipment_type.name"),children:"Equipment Name"})}),i.jsx(X,{sx:ge,children:i.jsx(Se,{active:g==="status",direction:g==="status"?m:"asc",onClick:()=>H("status"),children:"Status"})}),i.jsx(X,{sx:ge,children:"Open Issues"}),i.jsx(X,{sx:ge,children:"Action"})]})}),i.jsx(Ns,{children:F.slice(o*u,o*u+u).map((_,N)=>{var E,T,Z;return i.jsxs(Vt,{hover:!0,children:[i.jsx(X,{sx:ye,children:_.name||"N/A"}),i.jsx(X,{sx:ye,children:((E=_.vehicle_model)==null?void 0:E.name)||"N/A"}),i.jsx(X,{sx:ye,children:_.serial_no||"N/A"}),i.jsx(X,{sx:ye,children:((T=_.operator)==null?void 0:T.name)||"N/A"}),i.jsx(X,{sx:ye,children:((Z=_.equipment_type)==null?void 0:Z.name)||"N/A"}),i.jsx(X,{sx:ye,children:_.status||"N/A"}),i.jsx(X,{sx:ye,children:N+1}),i.jsx(X,{sx:ye,children:i.jsx(mr,{equipmentData:_})})]},N)})})]})}),i.jsx(Rs,{component:"div",rowsPerPageOptions:a,count:F.length,rowsPerPage:u,page:o,onPageChange:W,onRowsPerPageChange:k,sx:{bgcolor:"white",borderTop:"1px solid #e0e0e0",boxShadow:"0px -2px 5px rgba(0,0,0,0.1)",mt:1,borderRadius:"0 0 10px 10px"}})]})},jr=xr;function ea(){const{locationData:e,selectedVehicle:s,selectedParameterList:t}=je(O=>O.liveMap),{mode:a,selectedVehicleGroup:o}=je(O=>O.dashboard),n=bs(a),[u,y]=I.useState([]),{w_customer_id:S}=je(O=>O.auth),[m,b]=I.useState(),[g,B]=I.useState(!1),[W,k]=I.useState(!1),[H,G]=I.useState([]);I.useState(!0);const[ie,F]=I.useState(!1),[_,N]=I.useState(!1);let E=He();I.useEffect(()=>{T(),E(fs()),E(hs()),E(ms()),E(Ne())},[E]),I.useEffect(()=>{G([]),E(bt([{reg_id:"",imei:"",params:[]}]))},[s]);const T=async()=>{try{F(!0);let O=[],U=[];const Q=await E(gs({w_customer_id:S}));if(Array.isArray(Q.payload)){Q.payload.forEach(j=>{var x,v,A,R;Array.isArray(j.imei)&&j.imei.length>0&&((x=j.imei[0])!=null&&x.mac_id)?(O.push({id:j.id,label:j.registration_id,value:(v=j.imei[0])==null?void 0:v.mac_id,vehilce_type:j==null?void 0:j.segment,chassis_no:j==null?void 0:j.chassis_no,engine_no:j==null?void 0:j.engine_no,workShop:j==null?void 0:j.workshop,registration_id:j==null?void 0:j.registration_id,sell_date:j==null?void 0:j.sell_date,customer_name:j==null?void 0:j.customer_name,vehicle_model:(A=j==null?void 0:j.vehicle_model)==null?void 0:A.name,vehicle_group:j==null?void 0:j.vehicle_group}),U.push((R=j.imei[0])==null?void 0:R.mac_id)):console.error("IMEI data not found for item:",j)});const C="one",q=U;U.length>0&&E(ys({type:C,imei:q})),y(O),E(xs(O)),F(!1),E(ps({w_customer_id:S}))}else F(!1),console.error("Unexpected data format:",Q),ne.error("Unexpected data format:")}catch(O){console.error("Error fetching vehicle data:",O),ne.error(`Error fetching vehicle data: ${O}`)}},Z=async O=>{const{label:U,imei:Q,id:C,reg_id:q,checked:j}=O;b(R=>R.map(w=>w.id===C?{...w,checked:!j}:w));let x=[...H],v=[...H];if(!j)e.forEach(R=>{R.latestDocument.imei===Q&&(x.push({label:U,value:R.latestDocument[U==="maininputvoltage"?"mainInputVoltage":U]}),v=x,G(x))});else{let R=H.filter(w=>w.label!==U);v=R,G(R)}console.log("tempParamList",v),E(bt([{reg_id:q,imei:Q,params:v}]))},ee=u.filter(O=>Object.keys(o).length===0||O.vehicle_group===o.id);return i.jsxs("div",{className:"app",children:[i.jsx(Vs,{}),i.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[i.jsx(Bs,{title:"Equipments",setShowVehicles:B,showVehicles:g,setShowVehiclesGroup:N,showVehiclesGroup:_}),i.jsx(Is,{setShowVehiclesGroup:N,showVehiclesGroup:_}),i.jsxs(ae,{style:{display:"flex",width:"100%",height:"95vh"},children:[i.jsx(ae,{style:{width:g||W?"80%":"100%",background:rt.bgShadow},children:i.jsx(jr,{})}),g&&i.jsx(ae,{style:{width:"20%",backgroundColor:n.grey[100]},children:i.jsx(vs,{vehicleData:ee,title:"Live Map",setParameterData:b,loadingVehicle:ie,setShowVehicles:B,showVehicles:g,showParameters:W,setShowParameters:k})}),W&&i.jsx(ae,{style:{width:"20%",backgroundColor:n.grey[100]},children:i.jsx(_s,{parametersData:m,setParameterData:b,handleParameterChange:Z})})]})]})]})}export{ea as default};
