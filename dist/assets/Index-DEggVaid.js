import{p as T,r as l,j as e,cq as he,aP as pe,cr as ue,cs as ge,ct as Q,cu as d,cv as xe,B as m,T as fe,E as U,y as W,o as B,d8 as ae,d9 as De,da as _e,db as be,R as se,N as X,a8 as me,dc as we,U as H,Q as Ae,D as Ce,cQ as te,S as Te,aK as ke,z as re,dd as je,aw as Ee,de as Ie,df as Ne,a2 as Oe,dg as ie,dh as le,di as oe,dj as ne,dk as Le,a3 as Re,a4 as Ve,a5 as Me,a7 as $e,a9 as Pe,Y as Ge,Z as Fe,$ as Be,dl as Ye,w as He}from"./index-BHh91Wj8.js";import{D as ve,P as J,V as We,a as ze}from"./DateTimePicker-BkfagNzP.js";import{u as Z,w as Ke}from"./excelUtils-nkemuwe4.js";import{S as V}from"./index-BcGt0iz7.js";import{I as Qe}from"./InspectionsTable-X9vGTQsx.js";import{S as Ue}from"./ServiceRecordTable-BIHdS_rc.js";import"./BarChart-Bh0qIGf3.js";import"./DialogContentText-CatQVA-g.js";import"./Edit-DFTp781V.js";import"./index.esm-CN5FttFa.js";import"./formik.esm-CJaKMlpI.js";import"./Autocomplete-CTBxuAXe.js";function qe({countAlerts:w}){T(a=>a.dashboard),T(a=>a.report);const{driver_behavior_data:g,multipleVehicleReportsData:o}=T(a=>a.dashboard);T(a=>a.liveMap),l.useEffect(()=>{},[o,g]);let k=o.reduce((a,n)=>{var v;return a+=parseFloat((v=n==null?void 0:n.data)==null?void 0:v.totalDistance_)||0},0),p=o.reduce((a,n)=>{var v;return a+=parseFloat((v=n==null?void 0:n.data)==null?void 0:v.runningTime_)||0},0),I=o.reduce((a,n)=>{var v;return a+=parseFloat((v=n==null?void 0:n.data)==null?void 0:v.averageSpeed_)||0},0),s=g.reduce((a,n)=>a+=parseFloat(n.steadyTime),0),u=g.reduce((a,n)=>a+=parseFloat(n.overSpeedTime),0);const i=a=>{const n=Math.floor(a/3600),v=Math.floor(a%3600/60);return(a%60).toFixed(0),`${n}.${v}`},_=[{category:"Driving Metrics",metric:"Km Driven",value:(o==null?void 0:o.length)>0?`${parseFloat(k).toFixed(2)} km`:"0 km"},{category:"Driving Metrics",metric:"Hrs Driven",value:`${parseFloat(i(p)).toFixed(2)} hrs`},{category:"Driving Metrics",metric:"Idle Time",value:g&&s&&!isNaN(s)?`${i(s)} hrs`:"0 hrs"},{category:"Driving Metrics",metric:"Overspeed Time",value:g&&u&&!isNaN(u)?i(u):"0 hrs  "},{category:"Driving Metrics",metric:"Avg. Speed",value:(o==null?void 0:o.length)>0?`${(I/o.length).toFixed(2)} km/h`:"0 km/h"},{category:"Alerts",metric:"Outward Alerts",value:w.outward},{category:"Alerts",metric:"Inward Alerts",value:w.inward},{category:"Alerts",metric:"Speed Alerts",value:w.speed}],j=_.filter(a=>a.category==="Driving Metrics"),b=_.filter(a=>a.category==="Alerts");return e.jsx(he,{component:pe,sx:{maxWidth:800,margin:"auto",mt:"20px"},children:e.jsxs(ue,{children:[e.jsx(ge,{children:e.jsxs(Q,{children:[e.jsx(d,{sx:{fontWeight:"bold",textAlign:"center",backgroundColor:"primary.light",color:"white"},colSpan:2,children:"Driving Metrics"}),e.jsx(d,{sx:{fontWeight:"bold",textAlign:"center",backgroundColor:"primary.light",color:"white"},colSpan:2,children:"Alerts"})]})}),e.jsx(xe,{children:j.map((a,n)=>e.jsxs(Q,{children:[e.jsx(d,{children:a.metric}),e.jsx(d,{sx:{textAlign:"right"},children:a.value}),b[n]?e.jsxs(e.Fragment,{children:[e.jsx(d,{children:b[n].metric}),e.jsx(d,{sx:{textAlign:"right"},children:b[n].value})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{}),e.jsx(d,{})]})]},n))})]})})}function q({handleBack:w,downloadData:g}){l.useEffect(()=>{},[g]);const o=()=>{if(g.length===0){W.error("No data available for download.");return}const k=Z.json_to_sheet(g),p=Z.book_new();Z.book_append_sheet(p,k,"Sheet1"),Ke(p,"Report.xlsx"),W.success("Excel file downloaded successfully!")};return e.jsx(m,{sx:{backgroundColor:"white",mb:2,display:"flex",textAlign:"center",justifyContent:"end",alignItems:"center",padding:"10px 20px",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(fe,{sx:{fontWeight:"bold",mr:1},children:"Download In:"}),e.jsx(U,{variant:"outlined",onClick:o,sx:{borderColor:"green",color:"green","&:hover":{backgroundColor:"green",color:"white"}},children:"EXCEL"})]})})}const Xe=w=>{const g=Math.floor(w/3600),o=Math.floor(w%3600/60);return(w%60).toFixed(0),`${g}.${o}`},ce={outward:0,inward:0,speed:0};function Ze({handleBack:w,setStartDate:g,startDate:o,setEndDate:k,endDate:p}){const{alerts:I,allAlerts:s}=T(r=>r.report),{driver_behavior:u,driver_behavior_data:i,multipleVehicleReportsData:_}=T(r=>r.dashboard);T(r=>r.report);const{vehicleGroup:j,vehicleList:b}=T(r=>r.liveMap),[a,n]=l.useState(ce),[v,A]=l.useState([]),[x,f]=l.useState([]),[y,L]=l.useState([]),[S,O]=l.useState("All"),[N,c]=l.useState(null),[t,E]=l.useState(!1),$=B();l.useEffect(()=>{const r={...ce};s.forEach(D=>{D.type==="Geofence Alert"?D.geofance_type==="inward"?r.inward+=1:D.geofance_type==="outward"&&(r.outward+=1):D.type==="Speed Alert"&&(r.speed+=1)}),n(r);const h=[{name:"Outward Alerts",value:r.outward},{name:"Inward Alerts",value:r.inward},{name:"Speed Alerts",value:r.speed}];f(h)},[s]),l.useEffect(()=>{if(j&&j.length>0){let r=j.map(h=>({...h,label:h.group_name,value:h.id}));L(r)}},[j,b]);const Y=r=>{let h=b.find(D=>{var M;return((M=D==null?void 0:D.imei[0])==null?void 0:M.mac_id)==r});return(h==null?void 0:h.registration_id)||r},P=(r,h,D)=>{console.log("data1",r),console.log("data2",h),console.log("data3",D);let M=r.map(C=>{var ee;let Se=(ee=h.find(F=>F.imei===C.imei))==null?void 0:ee.data;const K={outward:0,inward:0,speed:0};return D.forEach(F=>{F.imei===C.imei&&(F.type==="Geofence Alert"?F.geofance_type==="inward"?K.inward+=1:F.geofance_type==="outward"&&(K.outward+=1):F.type==="Speed Alert"&&(K.speed+=1))}),{...C,...Se,...K}});console.log("vehicle report data",M);let ye=M.map(C=>({"Vehicle Name":Y(C.imei),"IMEI NO":C.imei,"KM Driven":C.totalDistance,"Hrs Driven":C.runningTime,"Idel Time":C!=null&&C.steadyTime&&!isNaN(C==null?void 0:C.steadyTime)?`${Xe(C==null?void 0:C.steadyTime)} hrs`:"0 hrs","Over speed time":C.overSpeedTime,"Avg speed":C.averageSpeed,"Outward alert":C.outward,"Inward alert":C.inward,"Speed alert":C.speed}));A(ye)};l.useEffect(()=>{i.length>0&&ae.length>0&&P(i,_,s)},[i,_,s]);function G(r){console.log("value changed",r),O(r)}const z=async()=>{E(!0);try{const r=$(ae({imei:N,startDate:o,endDate:p})),h=$(_e({imei:N,startDate:o,endDate:p})),D=$(be({imeiList:N,startDate:o,endDate:p}));await Promise.all([r,h,D]),E(!1),console.log("Report fetched successfully.")}catch(r){E(!1),console.error("Error fetching report:",r),W.error("An error occurred while fetching the report.")}},R=S==="All"?b:b.filter(r=>r.vehicle_group===S);return e.jsxs(m,{sx:{width:"100%",padding:"10px"},children:[t&&e.jsx(De,{}),e.jsx(q,{handleBack:w,downloadData:v}),e.jsxs(m,{children:[e.jsxs(V,{size:"large",value:S,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:G,filterOption:(r,h)=>{var D;return typeof((D=h==null?void 0:h.props)==null?void 0:D.children)=="string"&&h.props.children.toLowerCase().indexOf(r.toLowerCase())>=0},children:[e.jsx(V.Option,{value:"All",children:"All"}),y.map((r,h)=>e.jsx(V.Option,{value:r.value,children:r.label},h))]}),e.jsxs(V,{size:"large",mode:"multiple",showSearch:!0,value:N||[],style:{width:300,margin:"10px"},placeholder:"Select vehicles",maxTagCount:1,maxTagPlaceholder:r=>`+${r.length} more`,optionFilterProp:"children",onChange:r=>{r.includes("all")?(N==null?void 0:N.length)===R.length?c([]):c(R.map(h=>{var D;return(D=h.imei[0])==null?void 0:D.mac_id})):c(r)},filterOption:(r,h)=>{var D,M;return(M=(D=h==null?void 0:h.children)==null?void 0:D.toLowerCase())==null?void 0:M.includes(r.toLowerCase())},children:[e.jsx(V.Option,{value:"all",children:"Select All Vehicles"},"all"),R&&R.length>0&&R.map((r,h)=>{var D;return e.jsx(V.Option,{value:(D=r.imei[0])==null?void 0:D.mac_id,children:r.registration_id},h)})]}),e.jsx(ve,{setStartDate:g,setEndDate:k,selectedDate:!1}),e.jsx(U,{variant:"contained",style:{width:200,marginLeft:"10px"},onClick:z,disabled:!N,children:"Generate report"})]}),e.jsxs(m,{sx:{display:"flex",gap:"10px"},children:[e.jsx(m,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(J,{chartData:x,title:"Alerts Distribution"})}),e.jsxs(m,{sx:{width:"60%",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(fe,{variant:"h6",sx:{fontWeight:600,textAlign:"center",m:"0 30px"}}),e.jsx(We,{})]})]}),e.jsx(qe,{countAlerts:a})]})}const de={vehicleNo:"B35965",type:"Sprayer",operator:"Arjun",inspectionDate:"15/09/24",status:"Open",partsFailure:"Oil Pump, Filter",submittedBy:"Yograj"};function Je({handleBack:w}){const{inspectionHistory:g}=T(x=>x.inspection),{breakdowns:o}=T(x=>x.breakdown),{w_customer_id:k}=T(x=>x.auth),[p,I]=l.useState([]),[s,u]=l.useState([]),[i,_]=l.useState({});l.useState(de);const[j,b]=se.useState(),[a,n]=se.useState();let v=B();l.useEffect(()=>{v(X()),v(me(k)),v(we())},[]),l.useEffect(()=>{if(g.length>0){let x={open:0,rejected:0,close:0};({...de},g.map(f=>{f.status==="Open"&&(f!=null&&f.breakdown)&&x.open++,f.status==="Close"&&(f!=null&&f.breakdown)&&x.close++,f.status==="Rejected"&&(f!=null&&f.breakdown)&&x.rejected++})),_(x)}},[g]),l.useEffect(()=>{const x=[{name:"Rejected",value:i.rejected},{name:"Pending",value:i.open},{name:"Approved",value:i.close}];u(x)},[i]),l.useEffect(()=>{let x=[];if(console.log("inspection history",g),g.forEach(f=>{var Y,P,G,z;const{breakdown:y,inspection_parts_inspection:L,status:S,submitted_by:O,resolved_issue:N,pending_issue:c,vehicle:t}=f;console.log("breakdown",y);const E=L&&L.length>0?L.map((R,r)=>{var h;return`${(h=R==null?void 0:R.spare_parts)==null?void 0:h.description}: Qty ${R==null?void 0:R.quantity}`}).join("; "):"N/A";let $={Vehicle:t==null?void 0:t.registration_id,BDID:(y==null?void 0:y.breakdown_id)||"","Breakdown Topic":(Y=y==null?void 0:y.breakdown_topic)==null?void 0:Y.topic,"Resolved issue":N,"Pending issue":c,"Spare Parts":E,user:`${((P=O==null?void 0:O.us_user)==null?void 0:P.first_name)||""} ${((G=O==null?void 0:O.us_user)==null?void 0:G.last_name)||""}`,"Submission Date":(y==null?void 0:y.submission_date)&&H.utc(y==null?void 0:y.submission_date).local().format("YYYY-MM-DD")||"N/A","Submission Time":(y==null?void 0:y.submission_date)&&H.utc(y==null?void 0:y.submission_date).local().format("HH:mm A")||"N/A",workshop:((z=f==null?void 0:f.workshop_group)==null?void 0:z.group_name)||"",status:S};x.push($)}),Object.keys(i).length>0){let f={BDID:"Inspection Status",user:"","Submission Date":"",workshop:`Rejected: ${i.rejected||0}, Pending: ${i.open||0}, Approved: ${i.close||0}`};x.push(f)}I(x)},[o,i]);const A=()=>{if(j&&a){let x={startDate:H(new Date(j)).format("YYYY-MM-DD"),endDate:H(new Date(a)).format("YYYY-MM-DD")};v(X(x))}else v(X())};return e.jsxs(m,{sx:{width:"100%",m:"auto"},children:[e.jsx(q,{handleBack:w,downloadData:p}),e.jsxs(m,{sx:{display:"flex",m:"10px"},children:[e.jsx(ze,{setStartDate:b,setEndDate:n,selectedDate:!1}),e.jsx(U,{sx:{ml:"20px",background:"rgb(141, 166, 198)",color:"white"},onClick:()=>A(),children:"Apply"})]}),e.jsxs(m,{sx:{display:"flex",gap:"40px"},children:[e.jsx(Qe,{where:"inspection report"}),e.jsx(m,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(J,{chartData:s,title:"Inspection Status"})})]})]})}function ea({handleBack:w}){const{overdueCount:g,completedCount:o,serviceSoonCount:k}=T(j=>j.dashboard),{servicesData:p}=T(j=>j.services),[I,s]=l.useState([]),[u,i]=l.useState([]);let _=B();return l.useEffect(()=>{_(Ae())},[]),l.useEffect(()=>{i([{name:"Over Due",value:g},{name:"Due Soon",value:k},{name:"Serviced",value:o}])},[g,k,o]),l.useEffect(()=>{console.log("servicesData",p);let j=[];p.forEach(a=>{var v,A,x,f,y,L,S,O;let n={SRID:a==null?void 0:a.service_record_id,Vehicle:((v=a==null?void 0:a.vehicle)==null?void 0:v.registration_id)||"",user:`${((x=(A=a==null?void 0:a.user)==null?void 0:A.us_user)==null?void 0:x.first_name)||""} ${((y=(f=a==null?void 0:a.user)==null?void 0:f.us_user)==null?void 0:y.last_name)||""}`,Vehicle_group:((S=(L=a==null?void 0:a.vehicle)==null?void 0:L.vehicle_group)==null?void 0:S.group_name)||"",Priority_Class:(a==null?void 0:a.priority_class)||"","Entry Date":H(new Date(a==null?void 0:a.created)).format("DD-MM-YYYY"),"Entry Time":H(new Date(a==null?void 0:a.created)).format("HH:mm A"),Completion_Date:(a==null?void 0:a.completion_date)||"",Next_Due_Date:(a==null?void 0:a.next_due_date)||"",Segment:((O=a==null?void 0:a.segment)==null?void 0:O.segment_name)||"",status:a==null?void 0:a.status};j.push(n)});let b={Vehicle:"Service Status",user:"",Priority_Class:"",Completion_Date:`Over Due: ${g||0}, Due Soon: ${k||0}, Serviced: ${o||0}`};j.push(b),s(j)},[p,o]),e.jsxs(m,{sx:{width:"100%",m:"auto"},children:[e.jsx(m,{sx:{ml:"10px"},children:e.jsx(q,{handleBack:w,downloadData:I})}),e.jsx(Ue,{where:"service report"}),e.jsx(m,{sx:{display:"flex",gap:"40px",justifyContent:"center",paddingBottom:"50px"},children:e.jsx(m,{sx:{width:"40%",textAlign:"center",bgcolor:"red",background:"white",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(J,{chartData:u,title:"Service Status"})})})]})}function aa({tableData:w}){const{vehicleList:g}=T(s=>s.liveMap),o=B(),k=Ce();console.log("tableData: ",w);let p=s=>g.find(u=>{var i;return((i=u==null?void 0:u.imei[0])==null?void 0:i.mac_id)==s||""});const I=s=>{var u;o(Te({imei:s==null?void 0:s.imei,reg_id:(u=p(s.imei))==null?void 0:u.registration_id})),o(ke({startDate:re(s.date).startOf("day").toISOString(),endDate:re(s.date).endOf("day").toISOString()})),k("/trip-monitor?source=TripDetail")};return e.jsx(he,{component:pe,sx:{maxHeight:"70vh"},children:e.jsxs(ue,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ge,{children:e.jsxs(Q,{children:[e.jsx(d,{align:"left",children:"Date"}),e.jsx(d,{align:"left",children:"Vehicle Name"}),e.jsx(d,{align:"left",children:"Start location"}),e.jsx(d,{align:"left",children:"End location"}),e.jsx(d,{align:"left",children:"Segment"}),e.jsx(d,{align:"left",children:"Operator"}),e.jsx(d,{align:"left",children:"Work done (acre)"}),e.jsx(d,{align:"left",children:"Engine hours"}),e.jsx(d,{align:"left",children:"Running Time"}),e.jsx(d,{align:"left",children:"Idle time"}),e.jsx(d,{align:"left",children:"Total Distance (km)"}),e.jsx(d,{align:"left",children:"Average Speed"}),e.jsx(d,{align:"left",children:"View Trips"})]})}),e.jsx(xe,{children:w.map((s,u)=>{var i,_,j,b,a,n,v;return e.jsxs(Q,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(d,{align:"left",children:s.date}),e.jsx(d,{align:"left",children:(i=p(s.imei))==null?void 0:i.registration_id}),e.jsx(d,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(te,{title:((_=s==null?void 0:s.startLocationName)==null?void 0:_.display_name)||(s==null?void 0:s.startLocationName)||"",children:e.jsx("span",{children:((j=s==null?void 0:s.startLocationName)==null?void 0:j.display_name)||(s==null?void 0:s.startLocationName)||""})})}),e.jsx(d,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(te,{title:((b=s==null?void 0:s.endLocationName)==null?void 0:b.display_name)||(s==null?void 0:s.endLocationName)||"",children:e.jsx("span",{children:((a=s==null?void 0:s.endLocationName)==null?void 0:a.display_name)||(s==null?void 0:s.endLocationName)||""})})}),e.jsx(d,{align:"left",children:(n=p(s.imei))==null?void 0:n.segment}),e.jsx(d,{align:"left",children:(v=p(s.imei))==null?void 0:v.customer_name}),e.jsx(d,{align:"left",children:s.acreageStr}),e.jsx(d,{align:"left",children:s.engineHours}),e.jsx(d,{align:"left",children:s.runningTime}),e.jsx(d,{align:"left",children:s.idleTime}),e.jsx(d,{align:"left",children:s.totalDistance}),e.jsx(d,{align:"left",children:s.averageSpeed}),e.jsx(d,{align:"left",children:e.jsx(m,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>I(s),children:"View on Map ðŸ”"})})]},u+1)})})]})})}function sa({handleBack:w,setStartDate:g,startDate:o,setEndDate:k,endDate:p}){const I=B(),{vehicleGroup:s,vehicleList:u}=T(c=>c.liveMap),{vehicleStatesData:i,loading:_,selectedGroup:j,selectedVehicle:b,distributorList:a}=T(c=>c.report),[n,v]=l.useState([]);l.useState([]);const[A,x]=l.useState([]);l.useEffect(()=>{},[_]),l.useEffect(()=>{if(s&&s.length>0){let c=s.map(t=>({...t,label:t.group_name,value:t.id}));v(c)}},[s,u,a]),l.useEffect(()=>{},[o,p]);let f=c=>u.find(t=>{var E;return((E=t==null?void 0:t.imei[0])==null?void 0:E.mac_id)==c||""});l.useEffect(()=>{let c=(i==null?void 0:i.data)&&i.data.map(t=>{var P,G;let{customer_name:E,registration_id:$,segment:Y}=f(t==null?void 0:t.imei);return{Date:t.date,vehicle:$,"Start Location":(P=t==null?void 0:t.startLocationName)==null?void 0:P.display_name,"End Location":(G=t==null?void 0:t.endLocationName)==null?void 0:G.display_name,operator:E,segment:Y,"Work Done":t==null?void 0:t.acreageStr,"Running Time":t.runningTime,"Idle Time":t.idleTime,"Engine hours":t.engineHours,"Total Distance (km)":t.totalDistance,"Average Speed":t.averageSpeed}});x(c)},[i]),l.useEffect(()=>{b||I(je())},[]);function y(c){console.log("value changed",c),I(Ie(c))}function L(c){I(Ne(c))}const S=async()=>{const c=`${o} 00:00`,t=`${p} 23:59`;if(!O())return;I(Oe({imei:b,startTime:c,endTime:t}))},O=()=>!o||!p||b==="all"?(W.error("Please select start date, end date, and vehicle."),!1):!0,N=j==="All"?u:u.filter(c=>c.vehicle_group===j);return e.jsxs(m,{sx:{width:"100%",m:"auto"},children:[e.jsx(m,{sx:{ml:"10px"},children:e.jsx(q,{handleBack:w,downloadData:A})}),e.jsxs(m,{children:[e.jsxs(V,{size:"large",value:j,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:y,filterOption:(c,t)=>{var E;return typeof((E=t==null?void 0:t.props)==null?void 0:E.children)=="string"&&t.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(V.Option,{value:"All",children:"All"}),n.map((c,t)=>e.jsx(V.Option,{value:c.value,children:c.label},t))]}),e.jsxs(V,{size:"large",value:b,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:L,filterOption:(c,t)=>{var E;return typeof((E=t==null?void 0:t.props)==null?void 0:E.children)=="string"&&t.props.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:[e.jsx(V.Option,{value:"all",children:"None"},"all"),N&&N.length>0&&N.map((c,t)=>{var E;return e.jsx(V.Option,{value:(E=c.imei[0])==null?void 0:E.mac_id,children:c.registration_id},t)})]}),e.jsx(ve,{setStartDate:g,setEndDate:k,selectedDate:!1,startDate:o,endDate:p}),e.jsx(U,{variant:"contained",style:{width:200,marginLeft:"10px"},onClick:S,disabled:!b,children:"Generate report"})]}),_&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(Ee,{})}),(i==null?void 0:i.data)&&(i==null?void 0:i.data.length)>0&&e.jsx(m,{ml:1.5,children:e.jsx(aa,{tableData:(i==null?void 0:i.data)||[]})})]})}function ta({showCard:w,setReportType:g,reportType:o}){T(_=>_.dashboard),T(_=>_.liveMap);const{startDate:k,endDate:p}=T(_=>_.report),[I,s]=l.useState(!0);l.useState({}),l.useState(!1);let u=B();l.useEffect(()=>{},[p]),l.useEffect(()=>{u(ie()),u(le())},[]);const i=()=>{u(je()),u(ie()),u(le()),u(g(null))};return e.jsx(e.Fragment,{children:e.jsx(m,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignItems:"center",gap:2,padding:2},children:o==="Vehicle"?e.jsx(Ze,{handleBack:i,selectedDate:I,setEndDate:oe,setStartDate:ne,startDate:k,endDate:p}):o==="Service"?e.jsx(ea,{handleBack:i}):o==="Inspection"?e.jsx(Je,{handleBack:i}):e.jsx(sa,{handleBack:i,selectedDate:I,setEndDate:oe,setStartDate:ne,startDate:k,endDate:p})})})}function fa(){const{mode:w,showVehicles:g,selectedVehicleGroup:o}=T(A=>A.dashboard),{w_customer_id:k}=T(A=>A.auth),{reportType:p}=T(A=>A.report),[I,s]=l.useState([]),[u,i]=l.useState(!0),[_,j]=l.useState(!1),b=He(w);let a=B();l.useEffect(()=>{v(),n()},[]);const n=()=>{a(Le())},v=async()=>{try{let A=[],x=[];const f=await a(Re({w_customer_id:k}));if(Array.isArray(f.payload)){f.payload.forEach(S=>{var O,N;Array.isArray(S.imei)&&S.imei.length>0?(A.push({id:S.id,label:S.registration_id,value:(O=S==null?void 0:S.imei[0])==null?void 0:O.mac_id,workShop:S==null?void 0:S.workshop,vehicle_group:S==null?void 0:S.vehicle_group}),x.push((N=S.imei[0])==null?void 0:N.mac_id)):console.error("IMEI data not found for item:",S)});const y="one",L=x;x.length>0&&(a(Ve({type:y,imei:L})),a(Me(L))),s(A),a($e({w_customer_id:k})),a(Pe({}))}else console.error("Unexpected data format:",f),W.error("Unexpected data format:")}catch(A){console.error("Error fetching vehicle data:",A),W.error(`Error fetching vehicle data: ${A}`)}};return I.filter(A=>Object.keys(o).length===0||A.vehicle_group===o.id),e.jsxs("div",{className:"app",children:[e.jsx(Ge,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:b.grey[100]},children:[e.jsx(Fe,{title:"Report",setShowVehiclesGroup:j,showVehiclesGroup:_,reportType:p}),e.jsx(Be,{setShowVehiclesGroup:j,showVehiclesGroup:_}),e.jsxs(m,{style:{display:"flex",width:"100%",height:"95vh",background:b.grey[200]},children:[e.jsx(m,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(m,{style:{width:"100%"},children:e.jsx(ta,{showCard:u,setReportType:Ye,reportType:p})})}),!1]})]})]})}export{fa as default};
