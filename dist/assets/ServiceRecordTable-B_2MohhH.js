import{a4 as ne,j as t,z as L,b as d,y as ie,P as O,I as W,ap as ce,C as re}from"./index-Duwx4iIZ.js";import{r as oe}from"./createSvgIcon-DvX-xLHX.js";import{U as he,D as ue,m as H}from"./DateTimePicker-zBtx-p5E.js";import{D as xe,a as pe,b as ge}from"./DialogTitle-C1PTK8_C.js";import{d as E}from"./dayjs.min-l8_mdBdQ.js";import"./NewLoader-DZPi68-A.js";import{B as S}from"./index-Dei4R7JH.js";import{B as ve}from"./CircularProgress-0G0NKanL.js";import{T as fe,a as _e,b as je,c as J,d as a,e as be}from"./TableRow-kscMxLPB.js";import{T as me}from"./TablePagination-Cy65Rg2X.js";var R={},De=ne;Object.defineProperty(R,"__esModule",{value:!0});var T=R.default=void 0,Ce=De(oe()),Se=t;T=R.default=(0,Ce.default)((0,Se.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");function ye({open:h,setOpen:j,data:b,isInspection:u}){const A=()=>j(!1);return t.jsxs(xe,{open:h,onClose:A,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[t.jsx(pe,{children:"Update Information"}),t.jsx(ge,{dividers:!0,children:t.jsx(he,{setOpen:j,data:b,isInspection:u})})]})}const o={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"};function Ue({where:h,isInspection:j}){const{collapsed:b}=L(e=>e.auth),{servicesData:u,loading:A,selectedService:y,statusBasedRecord:P}=L(e=>e.services),[B,I]=d.useState(!1),[K,Q]=d.useState(null),[x,m]=d.useState(null),[D,M]=d.useState(null),[p,Y]=d.useState(""),[k,X]=d.useState(),[C,U]=d.useState(0),[g,Z]=d.useState(8),[V,$]=d.useState(),[F,w]=d.useState(),z=ie();d.useEffect(()=>{z(O())},[]),d.useEffect(()=>{let e=u.map(s=>{var l,i,c,n,r;return{...s,vehicle_id:s.vehicle.id,vehicle:s.vehicle.registration_id,vehicle_group:((l=s==null?void 0:s.vehicle)==null?void 0:l.vehicle_group)||"N/A",sub_model:(c=(i=s==null?void 0:s.vehicle)==null?void 0:i.sub_model)==null?void 0:c.name,model:(r=(n=s==null?void 0:s.vehicle)==null?void 0:n.vehicle_model)==null?void 0:r.name}});m(e)},[u]),d.useEffect(()=>{var e,s;if(y&&P.length>0){const i={Overdue:2,"Due soon":1,Serviced:0}[y],c=i!==void 0&&((s=(e=P[i])==null?void 0:e.data)==null?void 0:s.map(n=>{var r,f,_;return{...n,vehicle_id:((r=n.vehicle)==null?void 0:r.id)||"N/A",vehicle:((f=n.vehicle)==null?void 0:f.registration_id)||"N/A",vehicle_group:((_=n.vehicle)==null?void 0:_.vehicle_group)||"N/A"}}))||[];console.log("Filtered Data:",c),X(c)}},[y,P]),d.useEffect(()=>{console.log("tableData: ",x),k&&m(k)},[k]),d.useEffect(()=>{console.log("tableData: ",x)},[x]);const q=e=>{console.log("handleEditClick",e);let s={id:e.id,vehicle:e.vehicle_id,user:e.user.id,priority_class:e.priority_class,completion_date:E(e.completion_date),next_due_date:E(e.next_due_date),segment:e.segment.id,chassis_no:e.chassis_no,odometer:e.odometer,attachment:e.attachment,status:e.status,entry_date:E(e.created)};console.log("objecct",s),I(!B),Q(s)};let v=b?150:140,ee=b?220:210;const[Pe,te]=d.useState([{field:"vehicle",headerName:"Vehicle",width:v},{field:"vehicle_group",headerName:"Vehicle group",width:v,valueGetter:e=>(e==null?void 0:e.group_name)||"N/A"},{field:"priority_class",headerName:"Priority Class",width:v},{field:"completion_date",headerName:"Completion Date",width:v},{field:"next_due_date",headerName:"Next Due Date",width:v},{field:"segment",headerName:"Segment",width:100,valueGetter:e=>(e==null?void 0:e.segment_name)||""},{field:"user",headerName:"User",width:ee,valueGetter:e=>(e==null?void 0:e.email)||""},{field:"status",headerName:"Status",width:130}]);d.useEffect(()=>{h!=="service report"&&te(e=>[...e,{field:"edit",headerName:"Edit",width:100,renderCell:s=>t.jsx(W,{onClick:()=>q(s.row),color:"primary","aria-label":"edit record",children:t.jsx(T,{})})}])},[h]);const le=e=>{let s=e.target.value;M(s)},G=x&&x.length>0?x.filter(e=>{var s;return(s=e.vehicle)==null?void 0:s.toLowerCase().includes((D==null?void 0:D.toLowerCase())||"")}):[],se=()=>{if(V&&F){Y("");let e={startDate:H(new Date(V)).format("YYYY-MM-DD"),endDate:H(new Date(F)).format("YYYY-MM-DD")};z(O(e))}else re.error("Please select start date and end date")},N=e=>{if(M(""),Y(e),e){let s=u.filter(l=>l.status===e).map(l=>{var i,c,n,r;return{...l,vehicle_id:l.vehicle.id,vehicle:l.vehicle.registration_id,vehicle_group:((i=l==null?void 0:l.vehicle)==null?void 0:i.vehicle_group)||"N/A",sub_model:(n=(c=l==null?void 0:l.vehicle)==null?void 0:c.sub_model)==null?void 0:n.name,model:(r=l==null?void 0:l.vehicle_model)==null?void 0:r.name}});m(s)}else{let s=u.map(l=>{var i,c,n,r;return{...l,vehicle_id:l.vehicle.id,vehicle:l.vehicle.registration_id,vehicle_group:((i=l==null?void 0:l.vehicle)==null?void 0:i.vehicle_group)||"N/A",sub_model:(n=(c=l==null?void 0:l.vehicle)==null?void 0:c.sub_model)==null?void 0:n.name,model:(r=l==null?void 0:l.vehicle_model)==null?void 0:r.name}});m(s)}},ae=(e,s)=>{U(s)},de=e=>{Z(parseInt(e.target.value,10)),U(0)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("input",{placeholder:"Search by vehicle ",value:D,type:"text",style:{padding:"10px",border:"1px solid grey",borderRadius:"5px",width:"250px",margin:"10px"},onChange:le}),t.jsx(S,{style:{margin:"10px",backgroundColor:p===""?"rgb(141, 166, 198)":void 0,color:p===""?"white":void 0},onClick:()=>N(""),children:"All"}),t.jsx(S,{style:{margin:"10px",backgroundColor:p==="Completed"?"rgb(141, 166, 198)":void 0,color:p==="Completed"?"white":void 0},onClick:()=>N("Completed"),children:"Completed"}),t.jsx(S,{style:{margin:"10px",backgroundColor:p==="Pending"?"rgb(141, 166, 198)":void 0,color:p==="Pending"?"white":void 0},onClick:()=>N("Pending"),children:"Pending"}),t.jsx(ue,{setStartDate:$,setEndDate:w,selectedDate:!1}),t.jsx(S,{style:{margin:"10px",background:"rgb(141, 166, 198)",color:"white"},onClick:()=>se(),children:"Apply"})]}),t.jsxs(ve,{sx:{overflow:"auto",margin:"10px",borderRadius:"5px",background:"white"},children:[t.jsxs(fe,{component:ce,children:[t.jsxs(_e,{children:[t.jsx(je,{children:t.jsxs(J,{children:[t.jsx(a,{sx:o,children:"Sr no"}),t.jsx(a,{sx:o,children:"Vehicle"}),t.jsx(a,{sx:o,children:"Vehicle group"}),t.jsx(a,{sx:o,children:"Vehicle model"}),t.jsx(a,{sx:o,children:"Vehicle submodel"}),t.jsx(a,{sx:o,children:"Priority class"}),t.jsx(a,{sx:o,children:"Completion date"}),t.jsx(a,{sx:o,children:"Next due date"}),t.jsx(a,{sx:o,children:"Segment"}),t.jsx(a,{sx:o,children:"User"}),t.jsx(a,{sx:o,children:"Status"}),h!=="service report"&&t.jsx(a,{sx:o,children:"Action"}),"          "]})}),t.jsx(be,{children:G.slice(C*g,C*g+g).map((e,s)=>{var l,i,c,n,r,f,_;return t.jsxs(J,{children:[t.jsx(a,{children:C*g+s+1}),t.jsx(a,{children:e==null?void 0:e.vehicle}),t.jsx(a,{children:(l=e==null?void 0:e.vehicle_group)==null?void 0:l.group_name}),t.jsx(a,{children:(i=e==null?void 0:e.vehicle_model)==null?void 0:i.name}),t.jsx(a,{children:e==null?void 0:e.sub_model}),t.jsx(a,{children:e==null?void 0:e.priority_class}),t.jsx(a,{children:e==null?void 0:e.completion_date}),t.jsx(a,{children:e==null?void 0:e.next_due_date}),t.jsx(a,{children:(c=e==null?void 0:e.segment)==null?void 0:c.segment_name}),t.jsx(a,{children:((r=(n=e==null?void 0:e.user)==null?void 0:n.us_user)==null?void 0:r.first_name)+" "+((_=(f=e==null?void 0:e.user)==null?void 0:f.us_user)==null?void 0:_.last_name)}),t.jsx(a,{children:e==null?void 0:e.status}),h!=="service report"&&t.jsx(a,{children:t.jsx(W,{onClick:()=>q(e),color:"primary","aria-label":"edit record",children:t.jsx(T,{})})})]},e==null?void 0:e.id)})})]}),t.jsx(me,{rowsPerPageOptions:[12],component:"div",count:G.length,rowsPerPage:g,page:C,onPageChange:ae,onRowsPerPageChange:de})]}),t.jsx(ye,{open:B,setOpen:I,data:K,isInspection:j})]})]})}export{Ue as S};
