import{l as Fe,o as ke,p as He,b,q as $e,f as Ye,_ as De,j as e,eB as We,g as Pe,k as Be,a$ as W,a_ as w,bb as ge,dT as te,cf as ae,dU as le,dV as se,dW as G,dX as a,dY as ne,eh as ce,aW as M,bm as B,bl as Re,ca as Ee,b8 as re,eC as ue,eD as pe,eE as $,bc as fe,bY as je,eF as me,eG as ve,bv as Ge,b7 as ie,eH as Ke,eI as Ue,eJ as Me,c4 as qe,eK as Ve,eL as Ie,eM as Je,eN as de,eO as he,eP as xe,eQ as Qe,bw as Xe,bx as Ze,by as we,bA as et,bC as tt,bq as at,br as lt,bs as st,eR as nt,b5 as it}from"./index-CgFQaM9K.js";import{D as ye,R as ct,a as rt}from"./BatchRecipt2-DJPNu8nT.js";import"./index.esm-BwMU0PEu.js";function dt(C){return Fe("MuiTableFooter",C)}ke("MuiTableFooter",["root"]);const ht=["className","component"],xt=C=>{const{classes:D}=C;return Be({root:["root"]},dt,D)},ot=He("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(C,D)=>D.root})({display:"table-footer-group"}),gt={variant:"footer"},Oe="tfoot",ut=b.forwardRef(function(D,N){const R=$e({props:D,name:"MuiTableFooter"}),{className:u,component:v=Oe}=R,_=Ye(R,ht),l=De({},R,{component:v}),i=xt(l);return e.jsx(We.Provider,{value:gt,children:e.jsx(ot,De({as:v,className:Pe(i.root,u),ref:N,role:v===Oe?null:"rowgroup",ownerState:l},_))})}),pt=ut,ze="/assets/reset-B7HQJz0a.png";function ft({tableData:C}){var c;const D=JSON.parse(localStorage.getItem("w_userDetails")),{vehicleList:N}=W(t=>t.liveMap),R=w(),u=ge();console.log("tableData: ",C);let v=t=>N.find(x=>{var p;return((p=x==null?void 0:x.imei[0])==null?void 0:p.mac_id)==t||""});const _=t=>{var x;R(Re({imei:t==null?void 0:t.imei,reg_id:(x=v(t.imei))==null?void 0:x.registration_id})),R(Ee({startDate:re(t.date).startOf("day").toISOString(),endDate:re(t.date).endOf("day").toISOString()})),u("/trip-monitor?source=TripDetail")},l=t=>{var x;R(Re({imei:t==null?void 0:t.imei,reg_id:(x=v(t.imei))==null?void 0:x.registration_id})),R(Ee({startDate:re(t.date).startOf("day").toISOString(),endDate:re(t.date).endOf("day").toISOString()})),u("/trip-report")},i=t=>{if(isNaN(t)||t===null)return"-";const x=Math.floor(t),f=(t-x)*60,A=Math.floor(f);return`${x.toString().padStart(2,"0")}:${A.toString().padStart(2,"0")}`},s=t=>{if(isNaN(t)||t===null)return"-";const x=Math.floor(t/3600),p=Math.floor(t%3600/60);return`${x.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`};return e.jsx(e.Fragment,{children:((c=D==null?void 0:D.oem)==null?void 0:c.name)=="Ajax Engineering"?e.jsx(e.Fragment,{children:e.jsx(te,{component:ae,sx:{maxHeight:"70vh"},children:e.jsxs(le,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(se,{children:e.jsxs(G,{children:[e.jsx(a,{align:"left",children:"Date"}),e.jsx(a,{align:"left",children:"Vehicle Number"}),e.jsx(a,{align:"left",children:"Start Location"}),e.jsx(a,{align:"left",children:"End Location"}),e.jsx(a,{align:"left",children:"Total Distance (Km)"}),e.jsx(a,{align:"left",children:"Average Speed"}),e.jsx(a,{align:"left",children:"Idle Time"}),e.jsx(a,{align:"left",children:"Running Time"}),e.jsx(a,{align:"left",children:"Daily Engine Hours"}),e.jsx(a,{align:"left",children:"Total Engine Hours"}),e.jsx(a,{align:"left",children:"Last Reset Engine Hours"}),e.jsx(a,{align:"left",children:"Duration Since Last Reset"}),e.jsx(a,{align:"left",children:"Reset Perform By"}),e.jsx(a,{align:"left",children:"View Trips"}),e.jsx(a,{align:"left",children:"View Trip Report"})]})}),e.jsx(ne,{children:C.map((t,x)=>{var p,f,A,k,V;return e.jsxs(G,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",children:t.date}),e.jsx(a,{align:"left",children:(p=v(t.imei))==null?void 0:p.registration_id}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ce,{title:((f=t==null?void 0:t.startLocationName)==null?void 0:f.display_name)||(t==null?void 0:t.startLocationName)||"",children:e.jsx("span",{children:((A=t==null?void 0:t.startLocationName)==null?void 0:A.display_name)||(t==null?void 0:t.startLocationName)||""})})}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ce,{title:((k=t==null?void 0:t.endLocationName)==null?void 0:k.display_name)||(t==null?void 0:t.endLocationName)||"",children:e.jsx("span",{children:((V=t==null?void 0:t.endLocationName)==null?void 0:V.display_name)||(t==null?void 0:t.endLocationName)||""})})}),e.jsx(a,{align:"left",children:t.totalDistance}),e.jsx(a,{align:"left",children:t.averageSpeed}),e.jsx(a,{align:"left",children:s(t==null?void 0:t.idleTimeSec)}),e.jsx(a,{align:"left",children:s(t==null?void 0:t.runningTimeSec)}),e.jsx(a,{align:"left",children:i((t==null?void 0:t.daily_engine_hours)||0)}),e.jsx(a,{align:"left",children:i((t==null?void 0:t.daily_total_engine_hours)||0)}),e.jsx(a,{align:"left",children:t!=null&&t.old_total_engine_hours?e.jsxs(M,{display:"flex",alignItems:"center",gap:1,children:[e.jsx("span",{children:i(t.old_total_engine_hours)}),e.jsx("img",{src:ze,alt:"icon",style:{width:16,height:16}})]}):"-"}),e.jsx(a,{align:"left",children:(()=>{v(t.imei);const E=t==null?void 0:t.reset_date;if(!E)return"-";const S=B(),I=B.utc(E).local(),O=B.duration(S.diff(I)),H=Math.floor(O.asDays()),m=O.hours(),g=O.minutes();return`${H}d ${m}h ${g}m`})()}),e.jsx(a,{align:"left",children:(t==null?void 0:t.reset_by_user)||"-"}),e.jsx(a,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>_(t),children:"View on Map ðŸ”"})}),e.jsx(a,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer"},onClick:()=>l(t),children:"View Trip Report"})})]},x+1)})})]})})}):e.jsx(e.Fragment,{children:e.jsx(te,{component:ae,sx:{maxHeight:"70vh"},children:e.jsxs(le,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(se,{children:e.jsxs(G,{children:[e.jsx(a,{align:"left",children:"Date"}),e.jsx(a,{align:"left",children:"Vehicle Number"}),e.jsx(a,{align:"left",children:"Start Location"}),e.jsx(a,{align:"left",children:"End Location"}),e.jsx(a,{align:"left",children:"Segment"}),e.jsx(a,{align:"left",children:"Operator"}),e.jsx(a,{align:"left",children:"Work Done (Acre)"}),e.jsx(a,{align:"left",children:"Engine Hours"}),e.jsx(a,{align:"left",children:"Total Trips Hours"}),e.jsx(a,{align:"left",children:"Running Time"}),e.jsx(a,{align:"left",children:"Idle Time"}),e.jsx(a,{align:"left",children:"Total Distance (Km)"}),e.jsx(a,{align:"left",children:"Average Speed"}),e.jsx(a,{align:"left",children:"Per Day Engine Hours"}),e.jsx(a,{align:"left",children:"Total Engine Hours"}),e.jsx(a,{align:"left",children:"Last Reset Engine Hours"}),e.jsx(a,{align:"left",children:"Last Reset Timestamp"}),e.jsx(a,{align:"left",children:"Duration Since Last Reset"}),e.jsx(a,{align:"left",children:"Reset Perform By"}),e.jsx(a,{align:"left",children:"View Trips"}),e.jsx(a,{align:"left",children:"View Trip Report"})]})}),e.jsx(ne,{children:C.map((t,x)=>{var p,f,A,k,V,E,S;return e.jsxs(G,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",children:t.date}),e.jsx(a,{align:"left",children:(p=v(t.imei))==null?void 0:p.registration_id}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ce,{title:((f=t==null?void 0:t.startLocationName)==null?void 0:f.display_name)||(t==null?void 0:t.startLocationName)||"",children:e.jsx("span",{children:((A=t==null?void 0:t.startLocationName)==null?void 0:A.display_name)||(t==null?void 0:t.startLocationName)||""})})}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ce,{title:((k=t==null?void 0:t.endLocationName)==null?void 0:k.display_name)||(t==null?void 0:t.endLocationName)||"",children:e.jsx("span",{children:((V=t==null?void 0:t.endLocationName)==null?void 0:V.display_name)||(t==null?void 0:t.endLocationName)||""})})}),e.jsx(a,{align:"left",children:(E=v(t.imei))==null?void 0:E.segment}),e.jsx(a,{align:"left",children:(S=v(t.imei))==null?void 0:S.customer_name}),e.jsx(a,{align:"left",children:t.acreageStr}),e.jsx(a,{align:"left",children:t.engineHours}),e.jsx(a,{align:"left",children:(t==null?void 0:t.tripHours)||"--"}),e.jsx(a,{align:"left",children:s(t==null?void 0:t.runningTimeSec)}),e.jsx(a,{align:"left",children:s(t==null?void 0:t.idleTimeSec)}),e.jsx(a,{align:"left",children:t.totalDistance}),e.jsx(a,{align:"left",children:t.averageSpeed}),e.jsx(a,{align:"left",children:i((t==null?void 0:t.daily_engine_hours)||0)}),e.jsx(a,{align:"left",children:i((t==null?void 0:t.daily_total_engine_hours)||0)}),e.jsx(a,{align:"left",children:t!=null&&t.old_total_engine_hours?e.jsxs(M,{display:"flex",alignItems:"center",gap:1,children:[e.jsx("span",{children:i(t.old_total_engine_hours)||"-"}),e.jsx("img",{src:ze,alt:"icon",style:{width:16,height:16}})]}):"-"}),e.jsx(a,{align:"left",children:(t==null?void 0:t.reset_date)||"-"}),e.jsx(a,{align:"left",children:(()=>{v(t.imei);const I=t==null?void 0:t.reset_date;if(!I)return"-";const O=B(),H=B.utc(I).local(),m=B.duration(O.diff(H)),g=Math.floor(m.asDays()),F=m.hours(),K=m.minutes();return`${g}d ${F}h ${K}m`})()}),e.jsx(a,{align:"left",children:(t==null?void 0:t.reset_by_user)||"-"}),e.jsx(a,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>_(t),children:"View on Map ðŸ”"})}),e.jsx(a,{align:"left",children:e.jsx(M,{sx:{color:"primary.main",cursor:"pointer"},onClick:()=>l(t),children:"View Trip Report"})})]},x+1)})})]})})})})}function jt({handleBack:C,setStartDate:D,startDate:N,setEndDate:R,endDate:u}){const v=w(),{vehicleGroup:_,vehicleList:l}=W(m=>m.liveMap),{vehicleStatesData:i,loading:s,selectedGroup:c,selectedVehicle:t,distributorList:x}=W(m=>m.report),[p,f]=b.useState([]);b.useState([]);const[A,k]=b.useState([]);b.useEffect(()=>{},[s]),b.useEffect(()=>{if(_&&_.length>0){let m=_.map(g=>({...g,label:g.group_name,value:g.id}));f(m)}},[_,l,x]),b.useEffect(()=>{},[N,u]);let V=m=>l.find(g=>{var F;return((F=g==null?void 0:g.imei[0])==null?void 0:F.mac_id)==m||""});b.useEffect(()=>{let m=(i==null?void 0:i.data)&&i.data.map(g=>{var P,r;let{customer_name:F,registration_id:K,segment:U,total_engine_hours:Q,old_total_engine_hours:j,updated_engine_hours_date:d,reset_by_user:T}=V(g==null?void 0:g.imei);return{Date:g.date,vehicle:K,"Start Location":(P=g==null?void 0:g.startLocationName)==null?void 0:P.display_name,"End Location":(r=g==null?void 0:g.endLocationName)==null?void 0:r.display_name,operator:F,segment:U,"Work Done":g==null?void 0:g.acreageStr,"Running Time":g.runningTime,"Idle Time":g.idleTime,"Engine hours":g.engineHours,"Total Distance (km)":g.totalDistance,"Average Speed":g.averageSpeed,"Total Engine Hours":Q,"Last Reset Engine Hours":j,"Last Reset Timestamp":d,"Reset Perform By":(T==null?void 0:T.email)||"--"}});k(m)},[i]),b.useEffect(()=>{t||v(ue())},[]);function E(m){console.log("value changed",m),v(me(m))}function S(m){v(ve(m))}const I=async()=>{const m=`${N} 00:00`,g=`${u} 23:59`;if(!O())return;v(Ge({imei:t,startTime:m,endTime:g}))},O=()=>!N||!u||t==="all"?(ie.error("Please select start date, end date, and vehicle."),!1):!0,H=c==="All"?l:l.filter(m=>m.vehicle_group===c);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(pe,{handleBack:C,downloadData:A})}),e.jsxs(M,{children:[e.jsxs($,{size:"large",value:c,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:E,filterOption:(m,g)=>{var F;return typeof((F=g==null?void 0:g.props)==null?void 0:F.children)=="string"&&g.props.children.toLowerCase().indexOf(m.toLowerCase())>=0},children:[e.jsx($.Option,{value:"All",children:"All"}),p.map((m,g)=>e.jsx($.Option,{value:m.value,children:m.label},g))]}),e.jsxs($,{size:"large",value:t,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:S,filterOption:(m,g)=>{var F;return typeof((F=g==null?void 0:g.props)==null?void 0:F.children)=="string"&&g.props.children.toLowerCase().indexOf(m.toLowerCase())>=0},children:[e.jsx($.Option,{value:"all",children:"None"},"all"),H&&H.length>0&&H.map((m,g)=>{var F;return e.jsx($.Option,{value:(F=m.imei[0])==null?void 0:F.mac_id,children:m.registration_id},g)})]}),e.jsx(ye,{setStartDate:D,setEndDate:R,selectedDate:!1,startDate:N,endDate:u}),e.jsx(fe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:I,disabled:!t,children:"Generate report"})]}),s&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(je,{})}),(i==null?void 0:i.data)&&(i==null?void 0:i.data.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(ft,{tableData:(i==null?void 0:i.data)||[]})})]})}function mt({tableData:C}){const{vehicleList:D}=W(s=>s.liveMap);w(),ge();const[N,R]=b.useState(null),[u,v]=b.useState(!1);let _=s=>D.find(c=>{var t;return((t=c==null?void 0:c.imei[0])==null?void 0:t.mac_id)==s||""});const l=(s,c)=>c.find(x=>{var p;return((p=x==null?void 0:x.name)==null?void 0:p.toLowerCase().trim())===s})||null,i={fontSize:"12px",fontWeight:"bold"};return e.jsxs(e.Fragment,{children:[e.jsx(te,{component:ae,sx:{maxHeight:"70vh"},children:e.jsxs(le,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(se,{children:e.jsxs(G,{children:[e.jsx(a,{align:"left",sx:i,children:"Date"}),e.jsx(a,{align:"left",sx:i,children:"Vehicle Name"}),e.jsx(a,{align:"left",sx:i,children:"Batch No"}),e.jsx(a,{align:"left",sx:i,children:"Start Time"}),e.jsx(a,{align:"left",sx:i,children:"End Time"}),e.jsx(a,{align:"left",sx:i,children:"Total Target Weight"}),e.jsx(a,{align:"left",sx:i,children:"Total Achieved Weight"}),e.jsx(a,{align:"left",sx:i,children:"Recipe 1"}),e.jsx(a,{align:"left",sx:i,children:"Cement"}),e.jsx(a,{align:"left",sx:i,children:"10mm"}),e.jsx(a,{align:"left",sx:i,children:"20mm"}),e.jsx(a,{align:"left",sx:i,children:"Sand"}),e.jsx(a,{align:"left",sx:i,children:"Crush Sand"}),e.jsx(a,{align:"left",sx:i,children:"River Sand"}),e.jsx(a,{align:"left",sx:i,children:"Fly Ash"}),e.jsx(a,{align:"left",sx:i,children:"30mm"}),e.jsx(a,{align:"left",sx:i,children:"Water"}),e.jsx(a,{align:"left",sx:i,children:"Admix"}),e.jsx(a,{align:"left",sx:i,children:"Receipt"})]})}),e.jsx(ne,{children:C.map((s,c)=>{var t,x,p,f,A,k,V,E,S,I,O,H,m,g,F,K,U,Q,j,d,T,P,r,h,y,o,Y,n,z,L,ee,X,q,J,Z,be,Se,Te,_e,Ae,Ce,Ne,Le;return e.jsxs(G,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(s==null?void 0:s.date)&&B(s==null?void 0:s.date,"DDMMYYYY").format("DD-MM-YYYY")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(t=_(s.imei))==null?void 0:t.registration_id}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:s.batch_no}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:s.start_time}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:s==null?void 0:s.end_time}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(x=s==null?void 0:s.total_target)==null?void 0:x.replace(/^0+/,"")}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(p=s==null?void 0:s.totalAcheived)==null?void 0:p.replace(/^0+/,"")}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:s==null?void 0:s.mix_name}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(A=(f=l("cement",s.materials||[]))==null?void 0:f.target)==null?void 0:A.replace(/^0+/,""),":",(V=(k=l("cement",s.materials||[]))==null?void 0:k.actual)==null?void 0:V.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(S=(E=l("10 mm",s.materials||[]))==null?void 0:E.target)==null?void 0:S.replace(/^0+/,""),":",(O=(I=l("10 mm",s.materials||[]))==null?void 0:I.actual)==null?void 0:O.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(m=(H=l("20 mm",s.materials||[]))==null?void 0:H.target)==null?void 0:m.replace(/^0+/,""),":",(F=(g=l("20 mm",s.materials||[]))==null?void 0:g.actual)==null?void 0:F.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(U=(K=l("sand",s.materials||[]))==null?void 0:K.target)==null?void 0:U.replace(/^0+/,""),":",(j=(Q=l("sand",s.materials||[]))==null?void 0:Q.actual)==null?void 0:j.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(T=(d=l("crush sand",s.materials||[]))==null?void 0:d.target)==null?void 0:T.replace(/^0+/,""),":",(r=(P=l("crush sand",s.materials||[]))==null?void 0:P.actual)==null?void 0:r.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(y=(h=l("river sand",s.materials||[]))==null?void 0:h.target)==null?void 0:y.replace(/^0+/,""),":",(Y=(o=l("river sand",s.materials||[]))==null?void 0:o.actual)==null?void 0:Y.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(z=(n=l("fly ash",s.materials||[]))==null?void 0:n.target)==null?void 0:z.replace(/^0+/,""),":",(ee=(L=l("fly ash",s.materials||[]))==null?void 0:L.actual)==null?void 0:ee.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(q=(X=l("30 mm",s.materials||[]))==null?void 0:X.target)==null?void 0:q.replace(/^0+/,""),":",(Z=(J=l("30 mm",s.materials||[]))==null?void 0:J.actual)==null?void 0:Z.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(Se=(be=l("water",s.materials||[]))==null?void 0:be.target)==null?void 0:Se.replace(/^0+/,""),":",(_e=(Te=l("water",s.materials||[]))==null?void 0:Te.actual)==null?void 0:_e.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(Ce=(Ae=l("admix",s.materials||[]))==null?void 0:Ae.target)==null?void 0:Ce.replace(/^0+/,""),":",(Le=(Ne=l("admix",s.materials||[]))==null?void 0:Ne.actual)==null?void 0:Le.replace(/^0+/,"")]}),e.jsx(a,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",s),R(s),v(!0)},children:"View Receipt"})]},c+1)})}),e.jsx(pt,{children:e.jsxs(G,{children:[e.jsx(a,{children:e.jsx("b",{children:"Total"})}),e.jsx(a,{colSpan:3}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"}}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:C.reduce((c,t)=>{const x=(t==null?void 0:t.total_target)||"0",p=String(x).replace(/^0+/,""),f=parseFloat(p)||0;return c+f},0).toFixed(2)}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:C.reduce((s,c)=>s+(c!=null&&c.totalAcheived&&parseFloat(c.totalAcheived.replace(/^0+/,""))||0),0)}),e.jsx(a,{}),["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"].map(s=>{const c=C.reduce((x,p)=>{var A;const f=(A=l(s,p.materials||[]))==null?void 0:A.target;return x+(f&&parseFloat(f.replace(/^0+/,""))||0)},0),t=C.reduce((x,p)=>{var A;const f=(A=l(s,p.materials||[]))==null?void 0:A.actual;return x+(f&&parseFloat(f.replace(/^0+/,""))||0)},0);return e.jsxs(a,{align:"left",sx:{fontSize:"10px",fontWeight:"bold"},children:[c,":",t]},s)}),e.jsx(a,{})]})})]})}),e.jsx(ct,{receiptData:N,open:u,setOpen:v})]})}function vt({tableData:C}){const{vehicleList:D}=W(t=>t.liveMap);w(),ge();const[N,R]=b.useState(null),[u,v]=b.useState(!1);let _=t=>D.find(x=>{var p;return((p=x==null?void 0:x.imei[0])==null?void 0:p.mac_id)==t})||{};const l=(t,x)=>x.find(p=>{var f;return((f=p==null?void 0:p.product)==null?void 0:f.toLowerCase())===t.toLowerCase()})||{},i={fontSize:"12px",fontWeight:"bold"},s={fontSize:"10px"};let c={totalTarget:0,totalAchieved:0,cement:{target:0,achieved:0},mm10:{target:0,achieved:0},mm20:{target:0,achieved:0},sand:{target:0,achieved:0},water:0,cubic:0,mm30:{target:0,achieved:0},crushSand:{target:0,achieved:0},riverSand:{target:0,achieved:0},flyAsh:{target:0,achieved:0},admix:{target:0,achieved:0}};return C.forEach(t=>{c.totalTarget+=Number((t==null?void 0:t.generalKeyInfo["Total Target"])||0),c.totalAchieved+=Number((t==null?void 0:t.generalKeyInfo["Total Achieved"])||0),c.water+=Number((t==null?void 0:t.generalKeyInfo.Water)||0),c.cubic+=Number((t==null?void 0:t.generalKeyInfo["Cubic Meter"])||0),c.cement.target+=Number(l("cement",t.productArr).target||0),c.cement.achieved+=Number(l("cement",t.productArr).achieved||0),c.mm10.target+=Number(l("10 mm agg",t.productArr).target||0),c.mm10.achieved+=Number(l("10 mm agg",t.productArr).achieved||0),c.mm20.target+=Number(l("20 mm agg",t.productArr).target||0),c.mm20.achieved+=Number(l("20 mm agg",t.productArr).achieved||0),c.sand.target+=Number(l("sand",t.productArr).target||0),c.sand.achieved+=Number(l("sand",t.productArr).achieved||0),c.mm30.target+=Number(l("30mm",t.productArr).target||0),c.mm30.achieved+=Number(l("30mm",t.productArr).achieved||0),c.crushSand.target+=Number(l("crush sand",t.productArr).target||0),c.crushSand.achieved+=Number(l("crush sand",t.productArr).achieved||0),c.riverSand.target+=Number(l("river sand",t.productArr).target||0),c.riverSand.achieved+=Number(l("river sand",t.productArr).achieved||0),c.flyAsh.target+=Number(l("fly ash",t.productArr).target||0),c.flyAsh.achieved+=Number(l("fly ash",t.productArr).achieved||0),c.admix.target+=Number(l("admix",t.productArr).target||0),c.admix.achieved+=Number(l("admix",t.productArr).achieved||0)}),e.jsxs(te,{component:ae,sx:{maxHeight:"70vh"},children:[e.jsxs(le,{stickyHeader:!0,children:[e.jsx(se,{children:e.jsxs(G,{children:[e.jsx(a,{sx:i,children:"Date"}),e.jsx(a,{sx:i,children:"Vehicle Name"}),e.jsx(a,{sx:i,children:"Batch No"}),e.jsx(a,{sx:i,children:"Start Time"}),e.jsx(a,{sx:i,children:"End Time"}),e.jsx(a,{sx:i,children:"Total Target Weight"}),e.jsx(a,{sx:i,children:"Total Achieved Weight"}),e.jsx(a,{sx:i,children:"Recipe 1"}),e.jsx(a,{sx:i,children:"Cycle"}),e.jsx(a,{sx:i,children:"Cement"}),e.jsx(a,{sx:i,children:"10mm"}),e.jsx(a,{sx:i,children:"20mm"}),e.jsx(a,{sx:i,children:"Sand"}),e.jsx(a,{sx:i,children:"Water"}),e.jsx(a,{sx:i,children:"Cubic Meter"}),e.jsx(a,{sx:i,children:"30mm"}),e.jsx(a,{sx:i,children:"Crush Sand"}),e.jsx(a,{sx:i,children:"River Sand"}),e.jsx(a,{sx:i,children:"Fly Ash"}),e.jsx(a,{sx:i,children:"Admix"}),e.jsx(a,{sx:i,children:"Receipt"})]})}),e.jsxs(ne,{children:[C.map((t,x)=>{var p;return e.jsxs(G,{children:[e.jsx(a,{sx:s,children:t.generalKeyInfo.Date}),e.jsx(a,{sx:s,children:((p=_(t.imei))==null?void 0:p.registration_id)||"-"}),e.jsx(a,{sx:s,children:t.generalKeyInfo["Batch No"]}),e.jsx(a,{sx:s,children:t.generalKeyInfo["Start Time"]}),e.jsx(a,{sx:s,children:t.generalKeyInfo["End Time"]}),e.jsx(a,{sx:s,children:t.generalKeyInfo["Total Target"]}),e.jsx(a,{sx:s,children:t.generalKeyInfo["Total Achieved"]}),e.jsx(a,{sx:s,children:t.generalKeyInfo["Recipe Name"]}),e.jsx(a,{sx:s,children:t.generalKeyInfo.Cycle}),e.jsxs(a,{sx:s,children:[l("cement",t.productArr).target||0," :",l("cement",t.productArr).achieved||0]}),e.jsxs(a,{sx:s,children:[l("10 mm agg",t.productArr).target||0," :",l("10 mm agg",t.productArr).achieved||0]}),e.jsxs(a,{sx:s,children:[l("20 mm agg",t.productArr).target||0," :",l("20 mm agg",t.productArr).achieved||0]}),e.jsxs(a,{sx:s,children:[l("sand",t.productArr).target||0," :",l("sand",t.productArr).achieved||0]}),e.jsx(a,{sx:s,children:t.generalKeyInfo.Water}),e.jsx(a,{sx:s,children:t.generalKeyInfo["Cubic Meter"]}),e.jsxs(a,{sx:s,children:[l("30mm",t.productArr).target||0," :",l("30mm",t.productArr).achieved||0]}),e.jsxs(a,{sx:s,children:[l("crush sand",t.productArr).target||0," :",l("crush sand",t.productArr).achieved||0]}),e.jsxs(a,{sx:s,children:[l("river sand",t.productArr).target||0," :",l("river sand",t.productArr).achieved||0]}),e.jsxs(a,{sx:s,children:[l("fly ash",t.productArr).target||0," :",l("fly ash",t.productArr).achieved||0]}),e.jsxs(a,{sx:s,children:[l("admix",t.productArr).target||0," :",l("admix",t.productArr).achieved||0]}),e.jsx(a,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",t),R(t),v(!0)},children:"View Receipt"})]},x)}),e.jsxs(G,{children:[e.jsx(a,{sx:s,children:e.jsx("b",{children:"TOTAL"})}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{sx:s,children:e.jsx("b",{children:c.totalTarget})}),e.jsx(a,{sx:s,children:e.jsx("b",{children:c.totalAchieved})}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{sx:s,children:e.jsxs("b",{children:[c.cement.target,":",c.cement.achieved]})}),e.jsx(a,{sx:s,children:e.jsxs("b",{children:[c.mm10.target,":",c.mm10.achieved]})}),e.jsx(a,{sx:s,children:e.jsxs("b",{children:[" ",c.mm20.target,":",c.mm20.achieved]})}),e.jsx(a,{sx:s,children:e.jsxs("b",{children:[c.sand.target,":",c.sand.achieved]})}),e.jsx(a,{sx:s,children:e.jsx("b",{children:c.water})}),e.jsx(a,{sx:s,children:e.jsx("b",{children:c.cubic})}),e.jsx(a,{sx:s,children:e.jsxs("b",{children:[c.mm30.target,":",c.mm30.achieved]})}),e.jsx(a,{sx:s,children:e.jsxs("b",{children:[" ",c.crushSand.target,":",c.crushSand.achieved]})}),e.jsxs(a,{sx:s,children:[c.riverSand.target,":",c.riverSand.achieved]}),e.jsx(a,{sx:s,children:e.jsxs("b",{children:[c.flyAsh.target,":",c.flyAsh.achieved]})}),e.jsx(a,{sx:s,children:e.jsxs("b",{children:[c.admix.target,":",c.admix.achieved]})})]})]})]}),e.jsx(rt,{receiptData:N,open:u,setOpen:v})]})}function yt({handleBack:C,setStartDate:D,startDate:N,setEndDate:R,endDate:u}){var P;const v=w(),{vehicleGroup:_,vehicleList:l}=W(r=>r.liveMap),{batchReportsData:i,batchReportsData2:s,loading:c,selectedGroup:t,selectedVehicle:x,distributorList:p}=W(r=>r.report),[f,A]=b.useState([]);b.useState([]);const[k,V]=b.useState([]),[E,S]=b.useState([]);let I=r=>(console.log(l.find(h=>{var y;return((y=h==null?void 0:h.imei[0])==null?void 0:y.mac_id)==r||""})),l.find(h=>{var y;return((y=h==null?void 0:h.imei[0])==null?void 0:y.mac_id)==r||""}));const O=(r,h)=>h.find(o=>{var Y;return((Y=o==null?void 0:o.name)==null?void 0:Y.toLowerCase().trim())===r})||null,H=(r,h)=>{if(!r||!r.length>0)return;const y=r.reduce((z,L)=>z+(L!=null&&L.total_target&&parseFloat(L.total_target.replace(/^0+/,""))||0),0),o=r.reduce((z,L)=>z+(L!=null&&L.totalAcheived&&parseFloat(L.totalAcheived.replace(/^0+/,""))||0),0),Y=["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"],n={};return Y.forEach(z=>{const L=r.reduce((X,q)=>{var Z;const J=(Z=h(z,q.materials||[]))==null?void 0:Z.target;return X+(J&&parseFloat(J.replace(/^0+/,""))||0)},0),ee=r.reduce((X,q)=>{var Z;const J=(Z=h(z,q.materials||[]))==null?void 0:Z.actual;return X+(J&&parseFloat(J.replace(/^0+/,""))||0)},0);n[z]=`${L}:${ee}`}),{"Total Target Weight":y,"Total Achieved Weight":o,...n}};b.useEffect(()=>{const r=n=>n&&String(n).replace(/^0+/,"")||"-",h=(n,z=[])=>{const L=O(n,z);return{target:r(L==null?void 0:L.target),actual:r(L==null?void 0:L.actual)}};let y=(i==null?void 0:i.map(n=>{const{customer_name:z="-",registration_id:L="-",segment:ee="-"}=I(n==null?void 0:n.imei)||{};return{Date:n!=null&&n.date&&B(n==null?void 0:n.date,"DDMMYYYY").isValid()?B(n==null?void 0:n.date,"DDMMYYYY").format("DD-MM-YYYY"):"-",Vehicle:L||"-","Batch No":(n==null?void 0:n.batch_no)||"-","Start Time":(n==null?void 0:n.start_time)||"-",EndTime:(n==null?void 0:n.end_time)||"-","Total Target Weight":r(n==null?void 0:n.total_target),"Total Achieved Weight":r(n==null?void 0:n.totalAcheived),"Recipe 1":(n==null?void 0:n.mix_name)||"-",Cement:`${h("cement",n==null?void 0:n.materials).target}:${h("cement",n==null?void 0:n.materials).actual}`,"10mm":`${h("10 mm",n==null?void 0:n.materials).target}:${h("10mm",n==null?void 0:n.materials).actual}`,"20mm":`${h("20 mm",n==null?void 0:n.materials).target}:${h("20mm",n==null?void 0:n.materials).actual}`,Sand:`${h("sand",n==null?void 0:n.materials).target}:${h("sand",n==null?void 0:n.materials).actual}`,"Crush Sand":`${h("crush sand",n==null?void 0:n.materials).target}:${h("crush sand",n==null?void 0:n.materials).actual}`,"River Sand":`${h("river sand",n==null?void 0:n.materials).target}:${h("river sand",n==null?void 0:n.materials).actual}`,"Fly Ash":`${h("fly ash",n==null?void 0:n.materials).target}:${h("fly ash",n==null?void 0:n.materials).actual}`,"30mm":`${h("30 mm",n==null?void 0:n.materials).target}:${h("30mm",n==null?void 0:n.materials).actual}`,Water:`${h("water",n==null?void 0:n.materials).target}:${h("water",n==null?void 0:n.materials).actual}`,Admix:`${h("admix",n==null?void 0:n.materials).target}:${h("admix",n==null?void 0:n.materials).actual}`}}))||[];const o=H(i,O),Y=[...y,{Date:"",Vehicle:"-","Batch No":"-","Start Time":"-",EndTime:"Total","Total Target Weight":(o==null?void 0:o["Total Target Weight"])||0,"Total Achieved Weight":(o==null?void 0:o["Total Achieved Weight"])||0,"Recipe 1":"-",Cement:(o==null?void 0:o.cement)||"-","10mm":(o==null?void 0:o["10 mm"])||"-","20mm":(o==null?void 0:o["20 mm"])||"-",Sand:(o==null?void 0:o.sand)||"-","Crush Sand":(o==null?void 0:o["crush sand"])||"-","River Sand":(o==null?void 0:o["river sand"])||"-","Fly Ash":(o==null?void 0:o["fly ash"])||"-","30mm":(o==null?void 0:o["30 mm"])||"-",Water:(o==null?void 0:o.water)||"-",Admix:(o==null?void 0:o.admix)||"-"}];V(Y)},[i]);const m=r=>{if(!r&&!r.length>0)return;let h=[];for(let y=0;y<r.length;y++)if(r[y].startsWith("Product:")){const o=r[y],Y=r[y+1]||"",n=o.match(/Product:\s*(.*?)\s*Target.*:\s*(\d+)/),z=Y.match(/Achieved.*:\s*(\d+)/);n&&h.push({product:n[1],target:Number(n[2]),achieved:z?Number(z[1]):0})}return h},g=["Batch No","Date","Start Time","Operator","Recipe Name","Cubic Meter","Cycle","End Time","Total Target","Total Achieved","Water","Admix"],F=r=>{if(!r&&!r.length>0)return;let h={};return r.forEach(y=>{g.forEach(o=>{var Y;if(y.includes(o)){const z=((Y=y.split(/[:\-](.+)/)[1])==null?void 0:Y.trim())||"";h[o]=z}})}),h};b.useEffect(()=>{if(console.log("bacth reports data11",s),s&&s.length>0){let r=s.map(h=>{let y=m((h==null?void 0:h.parts)||[]),o=F((h==null?void 0:h.parts)||[]);return{productArr:y,generalKeyInfo:o,imei:h==null?void 0:h.deviceId}});r&&r.length>0?S(r):S([]),console.log("formatted arr",r)}},[s]),b.useEffect(()=>{if(_&&_.length>0){let r=_.map(h=>({...h,label:h.group_name,value:h.id}));A(r)}},[_,l,p]),b.useEffect(()=>{x||v(ue())},[]);function K(r){console.log("value changed",r),v(me(r))}function U(r){console.log("value",r),v(ve(r))}const Q=async()=>{const r=`${N} 00:00`,h=`${u} 23:59`;let y=I(x);if(console.log("vehicle info",y),!j())return;let o={imei:x,startDate:r,endDate:h};y.vehicle_type==="Sprint"&&v(Ke(o)),y.vehicle_type==="Appalto"&&v(Ue(o))},j=()=>!N||!u||x==="all"?(ie.error("Please select start date, end date, and vehicle."),!1):!0,d=(P=I(x))==null?void 0:P.vehicle_type;console.log("device type",d);const T=t==="All"?l:l.filter(r=>r.vehicle_group===t);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(pe,{handleBack:C,downloadData:k})}),e.jsxs(M,{children:[e.jsxs($,{size:"large",value:t,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:K,filterOption:(r,h)=>{var y;return typeof((y=h==null?void 0:h.props)==null?void 0:y.children)=="string"&&h.props.children.toLowerCase().indexOf(r.toLowerCase())>=0},children:[e.jsx($.Option,{value:"All",children:"All"}),f.map((r,h)=>e.jsx($.Option,{value:r.value,children:r.label},h))]}),e.jsxs($,{size:"large",value:x,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:U,filterOption:(r,h)=>{var y;return typeof((y=h==null?void 0:h.props)==null?void 0:y.children)=="string"&&h.props.children.toLowerCase().indexOf(r.toLowerCase())>=0},children:[e.jsx($.Option,{value:"all",children:"None"},"all"),T&&T.length>0&&T.map((r,h)=>{var y;return e.jsx($.Option,{value:(y=r.imei[0])==null?void 0:y.mac_id,children:r.registration_id},h)})]}),e.jsx(ye,{setStartDate:D,setEndDate:R,selectedDate:!1,startDate:N,endDate:u}),e.jsx(fe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:Q,disabled:!x,children:"Generate report"})]}),c&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(je,{})}),d==="Sprint"&&(i==null?void 0:i.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(mt,{tableData:i})}),d==="Appalto"&&(E==null?void 0:E.length)>0&&e.jsx(M,{ml:1.5,children:e.jsx(vt,{tableData:E})})]})}function bt({tableData:C}){const{vehicleList:D}=W(l=>l.liveMap),{selectedVehicle:N}=W(l=>l.report);let R=l=>D.find(i=>{var s;return((s=i==null?void 0:i.imei[0])==null?void 0:s.mac_id)==l||""});b.useEffect(()=>{},[D]);const u={fontSize:"12px",fontWeight:"bold"};function v(l){return console.log("hex",l),l.match(/../g).reverse().join("")}const _=(l,i)=>{var x,p,f,A,k;console.log("pid",l);const s=i.find(V=>l===(V==null?void 0:V.pid));if(console.log("matched pid",s),!s)return"NA";const c=((A=(f=(p=(x=R(N))==null?void 0:x.sub_model)==null?void 0:p.model_modelecu)==null?void 0:f[0])==null?void 0:A.pgn)||[];console.log("j1939 parameter",c);const t=c.find(V=>{var E,S;return(l==null?void 0:l.toLowerCase())===((S=(E=V==null?void 0:V.spn[0])==null?void 0:E.spn)==null?void 0:S.toLowerCase())});if(console.log("matchedPidConfig",t),t){const{message_type:V,resolution:E,offset:S}=t==null?void 0:t.spn[0];console.log("message",V,E,S);let I=v(s==null?void 0:s.rawHex),O=Me(V,I,E,S);if(l==="0060"){let H=R(N),m=O/100*((k=H==null?void 0:H.sub_model)==null?void 0:k.tank_capacity)||0;return parseFloat(m.toFixed(2))||0}return O||0}return"NA"};return e.jsx(e.Fragment,{children:e.jsx(te,{component:ae,sx:{maxHeight:"70vh"},children:e.jsxs(le,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(se,{children:e.jsxs(G,{children:[e.jsx(a,{align:"left",sx:u,children:"Entry Date"}),e.jsx(a,{align:"left",sx:u,children:"Device Date"}),e.jsx(a,{align:"left",sx:u,children:"HWID"}),e.jsx(a,{align:"left",sx:u,children:"Latitude"}),e.jsx(a,{align:"left",sx:u,children:"Longitude"}),e.jsx(a,{align:"left",sx:u,children:"Engine Coolant Temperature"}),e.jsx(a,{align:"left",sx:u,children:"Adblue Level"}),e.jsx(a,{align:"left",sx:u,children:"Fuel Level"}),e.jsx(a,{align:"left",sx:u,children:"Engine RPM"}),e.jsx(a,{align:"left",sx:u,children:"Real time Fuel Consumtion"}),e.jsx(a,{align:"left",sx:u,children:"Total Engine Hours"}),e.jsx(a,{align:"left",sx:u,children:"Engine Oil Pressure"}),e.jsx(a,{align:"left",sx:u,children:"Equip Status"}),e.jsx(a,{align:"left",sx:u,children:"Battery Voltage"})]})}),e.jsx(ne,{children:C&&C.map((l,i)=>{var s,c,t,x;return e.jsxs(G,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(l==null?void 0:l.createdAt)&&B(l==null?void 0:l.createdAt).format("DD-MM-YYYY HH:mm:ss")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:((s=l==null?void 0:l.accOnTime)==null?void 0:s.utc)&&B((c=l==null?void 0:l.accOnTime)==null?void 0:c.utc).format("DD-MM-YYYY HH:mm:ss")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l==null?void 0:l.deviceId}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l!=null&&l.latitude?(t=parseFloat(l==null?void 0:l.latitude))==null?void 0:t.toFixed(2):"NA"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:l!=null&&l.longitude?(x=parseFloat(l==null?void 0:l.longitude))==null?void 0:x.toFixed(2):"NA"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("006e",l==null?void 0:l.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("06e1",l==null?void 0:l.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("0060",l==null?void 0:l.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("00be",l==null?void 0:l.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("00b7",l==null?void 0:l.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("00f7",l==null?void 0:l.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("0064",l==null?void 0:l.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("sas",l==null?void 0:l.pids)}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:_("00a8",l==null?void 0:l.pids)})]},i+1)})})]})})})}const St="https://cc.wikitrak.in/proxy-3031";function Tt({handleBack:C,setStartDate:D,startDate:N,setEndDate:R,endDate:u}){var Q;const v=w(),{vehicleGroup:_,vehicleList:l}=W(j=>j.liveMap),{selectedGroup:i,selectedVehicle:s,distributorList:c}=W(j=>j.report),[t,x]=b.useState([]);b.useState([]);const[p,f]=b.useState([]),[A,k]=b.useState([]),[V,E]=b.useState(!1);function S(j){return j.match(/../g).reverse().join("")}const I=(j,d)=>{var h,y,o,Y;console.log("pid",j);const T=d.find(n=>j===(n==null?void 0:n.pid));if(console.log("matched pid",T),!T)return"NA";const P=((Y=(o=(y=(h=O(s))==null?void 0:h.sub_model)==null?void 0:y.model_modelecu)==null?void 0:o[0])==null?void 0:Y.pgn)||[];console.log("j1939 parameter",P);const r=P.find(n=>{var z,L;return(j==null?void 0:j.toLowerCase())===((L=(z=n==null?void 0:n.spn[0])==null?void 0:z.spn)==null?void 0:L.toLowerCase())});if(console.log("matchedPidConfig",r),r){const{message_type:n,resolution:z,offset:L}=r==null?void 0:r.spn[0];console.log("message",n,z,L);let ee=S(T==null?void 0:T.rawHex),X=Me(n,ee,z,L);if(j==="0060"){let q=O(s),J=X/100*(q==null?void 0:q.tank_capacity)||0;return parseFloat(J.toFixed(2))||0}return X||0}return"NA"};b.useEffect(()=>{if(A&&A.length>0){let j=A.map(d=>{var T,P;return{"Entry Date":(d==null?void 0:d.createdAt)&&B(d==null?void 0:d.createdAt).format("DD-MM-YYYY HH:mm:ss")||"-","Device Date":((T=d==null?void 0:d.accOnTime)==null?void 0:T.utc)&&B((P=d==null?void 0:d.accOnTime)==null?void 0:P.utc).format("DD-MM-YYYY HH:mm:ss")||"-",HWID:d==null?void 0:d.deviceId,Latitude:d==null?void 0:d.latitude,Longitude:d.longitude,"Engine Coolant Temperature":I("006e",d==null?void 0:d.pids),"DFF Level":I("06e1",d==null?void 0:d.pids),"Fuel Level":I("0060",d==null?void 0:d.pids),"Engine Speed":I("00be",d==null?void 0:d.pids),"Real time Fuel Consumtion":I("00b7",d==null?void 0:d.pids),"Total Engine Hours":I("00f7",d==null?void 0:d.pids),"E,ngine Oil Pressure":I("0064",d==null?void 0:d.pids),"Equip Status":"NA","Battery Voltage":I("00a8",d==null?void 0:d.pids)}});f(j)}},[A]);let O=j=>(console.log(l.find(d=>{var T;return((T=d==null?void 0:d.imei[0])==null?void 0:T.mac_id)==j||""})),l.find(d=>{var T;return((T=d==null?void 0:d.imei[0])==null?void 0:T.mac_id)==j||""}));function H(j){console.log("value changed",j),v(me(j))}function m(j){console.log("value",j),v(ve(j))}const g=async()=>{E(!0);const j=`${N}`,d=`${u}`;let T=O(s);if(console.log("vehicle info",T),!F())return;let P={deviceId:s,startDate:j,endDate:d};try{const{data:r}=await qe.post(`${St}/api/ivn-pid/by-date`,P);console.log("data",r),r&&Array.isArray(r==null?void 0:r.packets)&&k(r==null?void 0:r.packets),E(!1)}catch(r){E(!1),console.log("error",r)}},F=()=>!N||!u||s==="all"?(ie.error("Please select start date, end date, and vehicle."),!1):!0,K=(Q=O(s))==null?void 0:Q.vehicle_type;console.log("device type",K);const U=i==="All"?l:l.filter(j=>j.vehicle_group===i);return e.jsxs(M,{sx:{width:"100%",m:"auto"},children:[e.jsx(M,{sx:{ml:"10px"},children:e.jsx(pe,{handleBack:C,downloadData:p})}),e.jsxs(M,{children:[e.jsxs($,{size:"large",value:i,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:H,filterOption:(j,d)=>{var T;return typeof((T=d==null?void 0:d.props)==null?void 0:T.children)=="string"&&d.props.children.toLowerCase().indexOf(j.toLowerCase())>=0},children:[e.jsx($.Option,{value:"All",children:"All"}),t.map((j,d)=>e.jsx($.Option,{value:j.value,children:j.label},d))]}),e.jsxs($,{size:"large",value:s,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:m,filterOption:(j,d)=>{var T;return typeof((T=d==null?void 0:d.props)==null?void 0:T.children)=="string"&&d.props.children.toLowerCase().indexOf(j.toLowerCase())>=0},children:[e.jsx($.Option,{value:"all",children:"None"},"all"),U&&U.length>0&&U.map((j,d)=>{var T;return e.jsx($.Option,{value:(T=j.imei[0])==null?void 0:T.mac_id,children:j.registration_id},d)})]}),e.jsx(ye,{setStartDate:D,setEndDate:R,selectedDate:!1,startDate:N,endDate:u}),e.jsx(fe,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:g,disabled:!s,children:"Generate report"})]}),V&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(je,{})}),e.jsx(bt,{tableData:A})]})}function oe({children:C,value:D,index:N}){return e.jsx("div",{role:"tabpanel",hidden:D!==N,children:D===N&&e.jsx(M,{p:2,children:C})})}function _t({showCard:C,setReportType:D,reportType:N}){W(t=>t.dashboard),W(t=>t.liveMap);const{startDate:R,endDate:u,tabValue:v}=W(t=>t.report),[_,l]=b.useState(!0);b.useState({}),b.useState(!1);let i=w();b.useEffect(()=>{},[u]),b.useEffect(()=>{i(Ve()),i(Ie())},[]);const s=()=>{i(ue()),i(Ve()),i(Ie()),i(D(null))},c=(t,x)=>{i(Qe(x))};return e.jsx(e.Fragment,{children:e.jsx(M,{sx:{},children:e.jsxs(M,{children:[e.jsxs(Je,{value:v,onChange:c,children:[e.jsx(de,{label:"Vehicle Report"}),e.jsx(de,{label:"Batch data report"}),e.jsx(de,{label:"PID Report"})]}),e.jsx(oe,{value:v,index:0,children:e.jsx(jt,{handleBack:s,selectedDate:_,setEndDate:he,setStartDate:xe,startDate:R,endDate:u})}),e.jsx(oe,{value:v,index:1,children:e.jsx(yt,{handleBack:s,selectedDate:_,setEndDate:he,setStartDate:xe,startDate:R,endDate:u})}),e.jsx(oe,{value:v,index:2,children:e.jsx(Tt,{handleBack:s,selectedDate:_,setEndDate:he,setStartDate:xe,startDate:R,endDate:u})})]})})})}function Lt(){const{mode:C,showVehicles:D,selectedVehicleGroup:N}=W(f=>f.dashboard),{w_customer_id:R}=W(f=>f.auth),{reportType:u}=W(f=>f.report),[v,_]=b.useState([]),[l,i]=b.useState(!0),[s,c]=b.useState(!1),t=it(C);let x=w();b.useEffect(()=>{p()},[]);const p=async()=>{try{let f=[],A=[];const k=await x(Xe({w_customer_id:R}));if(Array.isArray(k.payload)){k.payload.forEach(S=>{var I,O;Array.isArray(S.imei)&&S.imei.length>0?(f.push({id:S.id,label:S.registration_id,value:(I=S==null?void 0:S.imei[0])==null?void 0:I.mac_id,workShop:S==null?void 0:S.workshop,vehicle_group:S==null?void 0:S.vehicle_group}),A.push((O=S.imei[0])==null?void 0:O.mac_id)):console.error("IMEI data not found for item:",S)});const V="one",E=A;A.length>0&&(x(Ze({type:V,imei:E})),x(we(E))),_(f),x(et({w_customer_id:R})),x(tt({}))}else console.error("Unexpected data format:",k),ie.error("Unexpected data format:")}catch(f){console.error("Error fetching vehicle data:",f),ie.error(`Error fetching vehicle data: ${f}`)}};return v.filter(f=>Object.keys(N).length===0||f.vehicle_group===N.id),e.jsxs("div",{className:"app",children:[e.jsx(at,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:t.grey[100]},children:[e.jsx(lt,{title:"Report",setShowVehiclesGroup:c,showVehiclesGroup:s,reportType:u}),e.jsx(st,{setShowVehiclesGroup:c,showVehiclesGroup:s}),e.jsxs(M,{style:{display:"flex",width:"100%",height:"95vh",background:t.grey[200]},children:[e.jsx(M,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(M,{style:{width:"100%"},children:e.jsx(_t,{showCard:l,setReportType:nt,reportType:u})})}),!1]})]})]})}export{Lt as default};
