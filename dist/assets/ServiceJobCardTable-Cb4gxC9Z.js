import{y as I,x as ee,b as n,be as se,bl as ae,L as i,bf as te,j as a,I as ne}from"./index-DUOvzgoN.js";import{a as ce}from"./ServiceRecordTable-C6Mnl1u-.js";import{T as de,d as ie}from"./excelUtils-DQOXw_UG.js";import{B as O}from"./CircularProgress-pwhYdd0J.js";import{B as le}from"./button-Dbk0gHw0.js";import{P as ue}from"./Paper-B1lO8R0B.js";import{T as re,a as _e,b as be,c as L,d as t,e as pe}from"./TableRow-BmSylAaQ.js";import{T as oe,E as he}from"./Edit-BX6yNRCo.js";import{I as xe}from"./IconButton-CXNJcYw0.js";import{T as ve}from"./TablePagination-DzmmSPab.js";const J=[{id:"service_record_id",label:"SRID"},{id:"registration_id",label:"Vehicle No"},{id:"service_type",label:"Service Type"},{id:"submission_date",label:"Submission Date"},{id:"submission_time",label:"Submission Time"},{id:"completion_date",label:"Completion date"},{id:"submitted_by",label:"Created By"},{id:"reviewed_by",label:"Reviewed By"},{id:"service_status",label:"Approval status"},{id:"status",label:"Status"}],fe=({isInspection:m})=>{const{breakdowns:ye,breakdownJobCardList:ge,serviceJobCardList:j}=I(e=>e.breakdown),{searchTerm:T}=I(e=>e.inspection),S=ee(),[A,V]=n.useState("asc"),[C,U]=n.useState("BDID"),[D,P]=n.useState(0),[f,q]=n.useState(8),[F,$]=n.useState(!1),[W,z]=n.useState(null),[B,Q]=n.useState("service_record_id");n.useState({id:"",status:"",workshop:"",user:""}),n.useEffect(()=>{S(se({}))},[]),n.useEffect(()=>{S(ae({job_card_type:"ServiceRecord",isInspection:m}))},[]);const G=e=>{V(C===e&&A==="asc"?"desc":"asc"),U(e)},K=(e,c)=>{P(c)},X=e=>{q(parseInt(e.target.value,10)),P(0)},y=((e,c,l)=>!c||!l?e:e.filter(s=>(()=>{var u,r,_,b,p,o,h,d,Y,v,k,M,N,E;switch(c){case"service_record_id":return(((u=s==null?void 0:s.service)==null?void 0:u.service_record_id)||"").toString();case"registration_id":return((r=s==null?void 0:s.vehicle)==null?void 0:r.registration_id)||"";case"service_type":return(s==null?void 0:s.service_type)||"";case"user_name":return`${((b=(_=s==null?void 0:s.user)==null?void 0:_.us_user)==null?void 0:b.first_name)||""} ${((o=(p=s==null?void 0:s.user)==null?void 0:p.us_user)==null?void 0:o.last_name)||""}`;case"submission_date":return s!=null&&s.submission_date?i(s.submission_date).format("YYYY-MM-DD"):"";case"submission_time":return s!=null&&s.submission_date?i(s.submission_date).format("HH:mm A"):"";case"completion_date":return s!=null&&s.completion_date?i(s.completion_date).format("YYYY-MM-DD"):"";case"submitted_by":return`${((d=(h=s==null?void 0:s.submitted_by)==null?void 0:h.us_user)==null?void 0:d.first_name)||""} ${((v=(Y=s==null?void 0:s.submitted_by)==null?void 0:Y.us_user)==null?void 0:v.last_name)||""}`;case"reviewed_by":return`${((M=(k=s==null?void 0:s.reviewed_by)==null?void 0:k.us_user)==null?void 0:M.first_name)||""} ${((E=(N=s==null?void 0:s.reviewed_by)==null?void 0:N.us_user)==null?void 0:E.last_name)||""}`||"";case"service_status":return(s==null?void 0:s.service_status)||"";case"status":return(s==null?void 0:s.status)||"";default:return""}})().toLowerCase().includes(l.toLowerCase())))((j==null?void 0:j.slice())||[],B,T),Z=y.slice(D*f,D*f+f),R={fontSize:"14px",fontWeight:"bold",fontFamily:"Ubuntu",color:"black",cursor:"pointer",background:"#f2f2f2"},w=y&&y.map(e=>{var l,s,x,u,r,_,b,p,o,h;const c=e!=null&&e.jobcard_parts&&(e==null?void 0:e.jobcard_parts.length)>0?e==null?void 0:e.jobcard_parts.map((d,Y)=>{var v;return`${(v=d==null?void 0:d.spare_parts)==null?void 0:v.description}: Qty ${d==null?void 0:d.quantity}`}).join(";"):"N/A";return{SRID:((l=e==null?void 0:e.service)==null?void 0:l.service_record_id)||"","Vehicle No":((s=e==null?void 0:e.vehicle)==null?void 0:s.registration_id)||"","Service Type":(e==null?void 0:e.service_type)||"","Submission Date":e!=null&&e.submission_date?i(e.submission_date).format("YYYY-MM-DD"):"","Submission Time":e!=null&&e.submission_date?i(e.submission_date).format("HH:mm A"):"","Completion date":e!=null&&e.completion_date?i(e.completion_date).format("YYYY-MM-DD HH:mm A"):"","Created By":`${((u=(x=e==null?void 0:e.submitted_by)==null?void 0:x.us_user)==null?void 0:u.first_name)||""} ${((_=(r=e==null?void 0:e.submitted_by)==null?void 0:r.us_user)==null?void 0:_.last_name)||""}`,"Reviewed By":`${((p=(b=e==null?void 0:e.reviewed_by)==null?void 0:b.us_user)==null?void 0:p.first_name)||""} ${((h=(o=e==null?void 0:e.reviewed_by)==null?void 0:o.us_user)==null?void 0:h.last_name)||""}`,"Approval status":(e==null?void 0:e.service_status)||"",Status:(e==null?void 0:e.status)||"","Spare parts":c}});let g=te("Job Card");const H=(g==null?void 0:g.includes("Update"))||g==="Read-Write-Only";return a.jsxs(O,{sx:{m:"10px"},children:[a.jsxs(O,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsx(de,{columns:J,selectedColumn:B,onColumnChange:Q,searchTerm:T,onSearchChange:e=>S(ne(e))}),a.jsx(le,{variant:"contained",color:"success",onClick:()=>ie(w,"service-job-card.xlsx"),children:"Download Excel"})]}),a.jsxs(ue,{children:[a.jsx(re,{sx:{height:"73vh",bgcolor:"white",borderRadius:"10px"},children:a.jsxs(_e,{stickyHeader:!0,children:[a.jsx(be,{children:a.jsxs(L,{children:[J.map(e=>a.jsx(t,{sx:R,children:a.jsx(oe,{active:C===e.id,direction:C===e.id?A:"asc",onClick:()=>G(e.id),children:e.label})},e.id)),H&&a.jsx(t,{sx:R,children:"Action"}),"              "]})}),a.jsx(pe,{children:Z.map((e,c)=>{var l,s,x,u,r,_,b,p,o,h;return a.jsxs(L,{children:[a.jsx(t,{children:(l=e==null?void 0:e.service)==null?void 0:l.service_record_id}),a.jsx(t,{children:(s=e==null?void 0:e.vehicle)==null?void 0:s.registration_id}),a.jsx(t,{children:e==null?void 0:e.service_type}),a.jsx(t,{children:(e==null?void 0:e.submission_date)&&i(e.submission_date).format("YYYY-MM-DD")||"N/A"}),a.jsx(t,{children:(e==null?void 0:e.submission_date)&&i(e.submission_date).format("HH:mm A")||"N/A"}),a.jsx(t,{children:(e==null?void 0:e.completion_date)&&i(e.completion_date).format("YYYY-MM-DD HH:mm A")||"N/A"}),a.jsx(t,{children:`${(u=(x=e==null?void 0:e.submitted_by)==null?void 0:x.us_user)==null?void 0:u.first_name} ${(_=(r=e==null?void 0:e.submitted_by)==null?void 0:r.us_user)==null?void 0:_.last_name}`||"N/A"}),a.jsx(t,{children:`${((p=(b=e==null?void 0:e.reviewed_by)==null?void 0:b.us_user)==null?void 0:p.first_name)||""} ${((h=(o=e==null?void 0:e.reviewed_by)==null?void 0:o.us_user)==null?void 0:h.last_name)||""}`||"N/A"}),a.jsx(t,{sx:{color:e.service_status==="Open"?"blue":e.service_status==="Approved"?"green":"red"},children:(e==null?void 0:e.service_status)||"N/A"}),a.jsx(t,{sx:{color:e.status==="Open"?"blue":e.status==="Close"?"green":"red"},children:e.status}),H&&a.jsx(t,{children:a.jsx(xe,{onClick:()=>{$(!0),z(e)},color:"primary",disabled:(e==null?void 0:e.status.toLowerCase())==="close","aria-label":"edit record",children:a.jsx(he,{})})})]},c)})})]})}),a.jsx(ve,{component:"div",count:y.length,page:D,onPageChange:K,rowsPerPage:f,onRowsPerPageChange:X,rowsPerPageOptions:[5,10,15]}),a.jsx(ce,{updateData:W,open:F,handleClose:()=>$(!1),isTechnician:!0,isInspection:m})]})]})},Re=fe;export{Re as S};
