import{l as De,o as We,p as ze,b as j,q as Oe,f as Me,_ as me,j as e,eB as Fe,g as $e,k as Ye,aW as R,T as Be,bc as le,b7 as Z,a$ as I,a_ as P,bb as se,dT as re,cf as ne,dU as ce,dV as ie,dW as B,dX as a,dY as de,eh as be,bl as Ge,ca as Ke,b8 as ye,eC as he,eD as D,bY as Re,eE as Le,eF as Ee,bv as Pe,bm as te,eG as He,eH as Ue,eI as Se,eJ as Te,eK as qe,eL as Ae,eM as Ce,eN as _e,eO as Xe,bw as Je,bx as Qe,by as Ze,bA as we,bC as ea,bq as aa,br as ta,bs as la,eP as sa,b5 as ra}from"./index-Hdh_iyJ6.js";import{D as Ie,R as na,a as ca}from"./BatchRecipt2-CDC2M03n.js";import"./index.esm-m7vJqz6u.js";import{u as ae,w as ia}from"./xlsx-D5JNrnKm.js";function da(y){return De("MuiTableFooter",y)}We("MuiTableFooter",["root"]);const ha=["className","component"],oa=y=>{const{classes:T}=y;return Ye({root:["root"]},da,T)},xa=ze("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(y,T)=>T.root})({display:"table-footer-group"}),ga={variant:"footer"},Ne="tfoot",ua=j.forwardRef(function(T,S){const _=Oe({props:T,name:"MuiTableFooter"}),{className:m,component:b=Ne}=_,d=Me(_,ha),r=me({},_,{component:b}),n=oa(r);return e.jsx(Fe.Provider,{value:ga,children:e.jsx(xa,me({as:b,className:$e(n.root,m),ref:S,role:b===Ne?null:"rowgroup",ownerState:r},d))})}),pa=ua;function ke({handleBack:y,downloadData:T}){j.useEffect(()=>{},[T]);const S=()=>{if(T.length===0){Z.error("No data available for download.");return}const _=ae.json_to_sheet(T),m=ae.book_new();ae.book_append_sheet(m,_,"Sheet1"),ia(m,"Report.xlsx"),Z.success("Excel file downloaded successfully!")};return e.jsx(R,{sx:{backgroundColor:"white",mb:2,display:"flex",textAlign:"center",justifyContent:"end",alignItems:"center",padding:"10px 20px",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:e.jsxs(R,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Be,{sx:{fontWeight:"bold",mr:1},children:"Download In:"}),e.jsx(le,{variant:"outlined",onClick:S,sx:{borderColor:"green",color:"green","&:hover":{backgroundColor:"green",color:"white"}},children:"EXCEL"})]})})}function fa({tableData:y}){const{vehicleList:T}=I(d=>d.liveMap),S=P(),_=se();console.log("tableData: ",y);let m=d=>T.find(r=>{var n;return((n=r==null?void 0:r.imei[0])==null?void 0:n.mac_id)==d||""});const b=d=>{var r;S(Ge({imei:d==null?void 0:d.imei,reg_id:(r=m(d.imei))==null?void 0:r.registration_id})),S(Ke({startDate:ye(d.date).startOf("day").toISOString(),endDate:ye(d.date).endOf("day").toISOString()})),_("/trip-monitor?source=TripDetail")};return e.jsx(re,{component:ne,sx:{maxHeight:"70vh"},children:e.jsxs(ce,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(B,{children:[e.jsx(a,{align:"left",children:"Date"}),e.jsx(a,{align:"left",children:"Vehicle Name"}),e.jsx(a,{align:"left",children:"Start location"}),e.jsx(a,{align:"left",children:"End location"}),e.jsx(a,{align:"left",children:"Segment"}),e.jsx(a,{align:"left",children:"Operator"}),e.jsx(a,{align:"left",children:"Work done (acre)"}),e.jsx(a,{align:"left",children:"Engine hours"}),e.jsx(a,{align:"left",children:"Running Time"}),e.jsx(a,{align:"left",children:"Idle time"}),e.jsx(a,{align:"left",children:"Total Distance (km)"}),e.jsx(a,{align:"left",children:"Average Speed"}),e.jsx(a,{align:"left",children:"View Trips"})]})}),e.jsx(de,{children:y.map((d,r)=>{var n,t,c,s,g,v,p;return e.jsxs(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",children:d.date}),e.jsx(a,{align:"left",children:(n=m(d.imei))==null?void 0:n.registration_id}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(be,{title:((t=d==null?void 0:d.startLocationName)==null?void 0:t.display_name)||(d==null?void 0:d.startLocationName)||"",children:e.jsx("span",{children:((c=d==null?void 0:d.startLocationName)==null?void 0:c.display_name)||(d==null?void 0:d.startLocationName)||""})})}),e.jsx(a,{align:"left",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(be,{title:((s=d==null?void 0:d.endLocationName)==null?void 0:s.display_name)||(d==null?void 0:d.endLocationName)||"",children:e.jsx("span",{children:((g=d==null?void 0:d.endLocationName)==null?void 0:g.display_name)||(d==null?void 0:d.endLocationName)||""})})}),e.jsx(a,{align:"left",children:(v=m(d.imei))==null?void 0:v.segment}),e.jsx(a,{align:"left",children:(p=m(d.imei))==null?void 0:p.customer_name}),e.jsx(a,{align:"left",children:d.acreageStr}),e.jsx(a,{align:"left",children:d.engineHours}),e.jsx(a,{align:"left",children:d.runningTime}),e.jsx(a,{align:"left",children:d.idleTime}),e.jsx(a,{align:"left",children:d.totalDistance}),e.jsx(a,{align:"left",children:d.averageSpeed}),e.jsx(a,{align:"left",children:e.jsx(R,{sx:{color:"primary.main",cursor:"pointer",display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:"4px",border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",borderColor:"primary.dark"}},onClick:()=>b(d),children:"View on Map ðŸ”"})})]},r+1)})})]})})}function ja({handleBack:y,setStartDate:T,startDate:S,setEndDate:_,endDate:m}){const b=P(),{vehicleGroup:d,vehicleList:r}=I(f=>f.liveMap),{vehicleStatesData:n,loading:t,selectedGroup:c,selectedVehicle:s,distributorList:g}=I(f=>f.report),[v,p]=j.useState([]);j.useState([]);const[L,z]=j.useState([]);j.useEffect(()=>{},[t]),j.useEffect(()=>{if(d&&d.length>0){let f=d.map(x=>({...x,label:x.group_name,value:x.id}));p(f)}},[d,r,g]),j.useEffect(()=>{},[S,m]);let M=f=>r.find(x=>{var N;return((N=x==null?void 0:x.imei[0])==null?void 0:N.mac_id)==f||""});j.useEffect(()=>{let f=(n==null?void 0:n.data)&&n.data.map(x=>{var G,K;let{customer_name:N,registration_id:H,segment:U}=M(x==null?void 0:x.imei);return{Date:x.date,vehicle:H,"Start Location":(G=x==null?void 0:x.startLocationName)==null?void 0:G.display_name,"End Location":(K=x==null?void 0:x.endLocationName)==null?void 0:K.display_name,operator:N,segment:U,"Work Done":x==null?void 0:x.acreageStr,"Running Time":x.runningTime,"Idle Time":x.idleTime,"Engine hours":x.engineHours,"Total Distance (km)":x.totalDistance,"Average Speed":x.averageSpeed}});z(f)},[n]),j.useEffect(()=>{s||b(he())},[]);function k(f){console.log("value changed",f),b(Le(f))}function A(f){b(Ee(f))}const W=async()=>{const f=`${S} 00:00`,x=`${m} 23:59`;if(!O())return;b(Pe({imei:s,startTime:f,endTime:x}))},O=()=>!S||!m||s==="all"?(Z.error("Please select start date, end date, and vehicle."),!1):!0,F=c==="All"?r:r.filter(f=>f.vehicle_group===c);return e.jsxs(R,{sx:{width:"100%",m:"auto"},children:[e.jsx(R,{sx:{ml:"10px"},children:e.jsx(ke,{handleBack:y,downloadData:L})}),e.jsxs(R,{children:[e.jsxs(D,{size:"large",value:c,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:k,filterOption:(f,x)=>{var N;return typeof((N=x==null?void 0:x.props)==null?void 0:N.children)=="string"&&x.props.children.toLowerCase().indexOf(f.toLowerCase())>=0},children:[e.jsx(D.Option,{value:"All",children:"All"}),v.map((f,x)=>e.jsx(D.Option,{value:f.value,children:f.label},x))]}),e.jsxs(D,{size:"large",value:s,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:A,filterOption:(f,x)=>{var N;return typeof((N=x==null?void 0:x.props)==null?void 0:N.children)=="string"&&x.props.children.toLowerCase().indexOf(f.toLowerCase())>=0},children:[e.jsx(D.Option,{value:"all",children:"None"},"all"),F&&F.length>0&&F.map((f,x)=>{var N;return e.jsx(D.Option,{value:(N=f.imei[0])==null?void 0:N.mac_id,children:f.registration_id},x)})]}),e.jsx(Ie,{setStartDate:T,setEndDate:_,selectedDate:!1,startDate:S,endDate:m}),e.jsx(le,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:W,disabled:!s,children:"Generate report"})]}),t&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(Re,{})}),(n==null?void 0:n.data)&&(n==null?void 0:n.data.length)>0&&e.jsx(R,{ml:1.5,children:e.jsx(fa,{tableData:(n==null?void 0:n.data)||[]})})]})}function va({tableData:y}){const{vehicleList:T}=I(t=>t.liveMap);P(),se();const[S,_]=j.useState(null),[m,b]=j.useState(!1);let d=t=>T.find(c=>{var s;return((s=c==null?void 0:c.imei[0])==null?void 0:s.mac_id)==t||""});const r=(t,c)=>c.find(g=>{var v;return((v=g==null?void 0:g.name)==null?void 0:v.toLowerCase().trim())===t})||null,n={fontSize:"12px",fontWeight:"bold"};return e.jsxs(e.Fragment,{children:[e.jsx(re,{component:ne,sx:{maxHeight:"70vh"},children:e.jsxs(ce,{stickyHeader:!0,"aria-label":"simple table",children:[e.jsx(ie,{children:e.jsxs(B,{children:[e.jsx(a,{align:"left",sx:n,children:"Date"}),e.jsx(a,{align:"left",sx:n,children:"Vehicle Name"}),e.jsx(a,{align:"left",sx:n,children:"Batch No"}),e.jsx(a,{align:"left",sx:n,children:"Start Time"}),e.jsx(a,{align:"left",sx:n,children:"End Time"}),e.jsx(a,{align:"left",sx:n,children:"Total Target Weight"}),e.jsx(a,{align:"left",sx:n,children:"Total Achieved Weight"}),e.jsx(a,{align:"left",sx:n,children:"Recipe 1"}),e.jsx(a,{align:"left",sx:n,children:"Cement"}),e.jsx(a,{align:"left",sx:n,children:"10mm"}),e.jsx(a,{align:"left",sx:n,children:"20mm"}),e.jsx(a,{align:"left",sx:n,children:"Sand"}),e.jsx(a,{align:"left",sx:n,children:"Crush Sand"}),e.jsx(a,{align:"left",sx:n,children:"River Sand"}),e.jsx(a,{align:"left",sx:n,children:"Fly Ash"}),e.jsx(a,{align:"left",sx:n,children:"30mm"}),e.jsx(a,{align:"left",sx:n,children:"Water"}),e.jsx(a,{align:"left",sx:n,children:"Admix"}),e.jsx(a,{align:"left",sx:n,children:"Receipt"})]})}),e.jsx(de,{children:y.map((t,c)=>{var s,g,v,p,L,z,M,k,A,W,O,F,f,x,N,H,U,G,K,q,X,w,h,i,u,o,E,l,V,C,ee,J,Q,$,Y,oe,xe,ge,ue,pe,fe,je,ve;return e.jsxs(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(t==null?void 0:t.date)&&te(t==null?void 0:t.date,"DDMMYYYY").format("DD-MM-YYYY")||"-"}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(s=d(t.imei))==null?void 0:s.registration_id}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t.batch_no}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t.start_time}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t==null?void 0:t.end_time}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(g=t==null?void 0:t.total_target)==null?void 0:g.replace(/^0+/,"")}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:(v=t==null?void 0:t.totalAcheived)==null?void 0:v.replace(/^0+/,"")}),e.jsx(a,{align:"left",sx:{fontSize:"10px"},children:t==null?void 0:t.mix_name}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(L=(p=r("cement",t.materials||[]))==null?void 0:p.target)==null?void 0:L.replace(/^0+/,""),":",(M=(z=r("cement",t.materials||[]))==null?void 0:z.actual)==null?void 0:M.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(A=(k=r("10 mm",t.materials||[]))==null?void 0:k.target)==null?void 0:A.replace(/^0+/,""),":",(O=(W=r("10 mm",t.materials||[]))==null?void 0:W.actual)==null?void 0:O.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(f=(F=r("20 mm",t.materials||[]))==null?void 0:F.target)==null?void 0:f.replace(/^0+/,""),":",(N=(x=r("20 mm",t.materials||[]))==null?void 0:x.actual)==null?void 0:N.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(U=(H=r("sand",t.materials||[]))==null?void 0:H.target)==null?void 0:U.replace(/^0+/,""),":",(K=(G=r("sand",t.materials||[]))==null?void 0:G.actual)==null?void 0:K.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(X=(q=r("crush sand",t.materials||[]))==null?void 0:q.target)==null?void 0:X.replace(/^0+/,""),":",(h=(w=r("crush sand",t.materials||[]))==null?void 0:w.actual)==null?void 0:h.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(u=(i=r("river sand",t.materials||[]))==null?void 0:i.target)==null?void 0:u.replace(/^0+/,""),":",(E=(o=r("river sand",t.materials||[]))==null?void 0:o.actual)==null?void 0:E.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(V=(l=r("fly ash",t.materials||[]))==null?void 0:l.target)==null?void 0:V.replace(/^0+/,""),":",(ee=(C=r("fly ash",t.materials||[]))==null?void 0:C.actual)==null?void 0:ee.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(Q=(J=r("30 mm",t.materials||[]))==null?void 0:J.target)==null?void 0:Q.replace(/^0+/,""),":",(Y=($=r("30 mm",t.materials||[]))==null?void 0:$.actual)==null?void 0:Y.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(xe=(oe=r("water",t.materials||[]))==null?void 0:oe.target)==null?void 0:xe.replace(/^0+/,""),":",(ue=(ge=r("water",t.materials||[]))==null?void 0:ge.actual)==null?void 0:ue.replace(/^0+/,"")]}),e.jsxs(a,{align:"left",sx:{fontSize:"10px"},children:[(fe=(pe=r("admix",t.materials||[]))==null?void 0:pe.target)==null?void 0:fe.replace(/^0+/,""),":",(ve=(je=r("admix",t.materials||[]))==null?void 0:je.actual)==null?void 0:ve.replace(/^0+/,"")]}),e.jsx(a,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",t),_(t),b(!0)},children:"View Receipt"})]},c+1)})}),e.jsx(pa,{children:e.jsxs(B,{children:[e.jsx(a,{children:e.jsx("b",{children:"Total"})}),e.jsx(a,{colSpan:3}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"}}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:y.reduce((c,s)=>{const g=(s==null?void 0:s.total_target)||"0",v=String(g).replace(/^0+/,""),p=parseFloat(v)||0;return c+p},0).toFixed(2)}),e.jsx(a,{align:"left",sx:{fontWeight:"bold",fontSize:"12px"},children:y.reduce((t,c)=>t+(c!=null&&c.totalAcheived&&parseFloat(c.totalAcheived.replace(/^0+/,""))||0),0)}),e.jsx(a,{}),["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"].map(t=>{const c=y.reduce((g,v)=>{var L;const p=(L=r(t,v.materials||[]))==null?void 0:L.target;return g+(p&&parseFloat(p.replace(/^0+/,""))||0)},0),s=y.reduce((g,v)=>{var L;const p=(L=r(t,v.materials||[]))==null?void 0:L.actual;return g+(p&&parseFloat(p.replace(/^0+/,""))||0)},0);return e.jsxs(a,{align:"left",sx:{fontSize:"10px",fontWeight:"bold"},children:[c,":",s]},t)}),e.jsx(a,{})]})})]})}),e.jsx(na,{receiptData:S,open:m,setOpen:b})]})}function ma({tableData:y}){const{vehicleList:T}=I(s=>s.liveMap);P(),se();const[S,_]=j.useState(null),[m,b]=j.useState(!1);let d=s=>T.find(g=>{var v;return((v=g==null?void 0:g.imei[0])==null?void 0:v.mac_id)==s})||{};const r=(s,g)=>g.find(v=>{var p;return((p=v==null?void 0:v.product)==null?void 0:p.toLowerCase())===s.toLowerCase()})||{},n={fontSize:"12px",fontWeight:"bold"},t={fontSize:"10px"};let c={totalTarget:0,totalAchieved:0,cement:{target:0,achieved:0},mm10:{target:0,achieved:0},mm20:{target:0,achieved:0},sand:{target:0,achieved:0},water:0,cubic:0,mm30:{target:0,achieved:0},crushSand:{target:0,achieved:0},riverSand:{target:0,achieved:0},flyAsh:{target:0,achieved:0},admix:{target:0,achieved:0}};return y.forEach(s=>{c.totalTarget+=Number((s==null?void 0:s.generalKeyInfo["Total Target"])||0),c.totalAchieved+=Number((s==null?void 0:s.generalKeyInfo["Total Achieved"])||0),c.water+=Number((s==null?void 0:s.generalKeyInfo.Water)||0),c.cubic+=Number((s==null?void 0:s.generalKeyInfo["Cubic Meter"])||0),c.cement.target+=Number(r("cement",s.productArr).target||0),c.cement.achieved+=Number(r("cement",s.productArr).achieved||0),c.mm10.target+=Number(r("10 mm agg",s.productArr).target||0),c.mm10.achieved+=Number(r("10 mm agg",s.productArr).achieved||0),c.mm20.target+=Number(r("20 mm agg",s.productArr).target||0),c.mm20.achieved+=Number(r("20 mm agg",s.productArr).achieved||0),c.sand.target+=Number(r("sand",s.productArr).target||0),c.sand.achieved+=Number(r("sand",s.productArr).achieved||0),c.mm30.target+=Number(r("30mm",s.productArr).target||0),c.mm30.achieved+=Number(r("30mm",s.productArr).achieved||0),c.crushSand.target+=Number(r("crush sand",s.productArr).target||0),c.crushSand.achieved+=Number(r("crush sand",s.productArr).achieved||0),c.riverSand.target+=Number(r("river sand",s.productArr).target||0),c.riverSand.achieved+=Number(r("river sand",s.productArr).achieved||0),c.flyAsh.target+=Number(r("fly ash",s.productArr).target||0),c.flyAsh.achieved+=Number(r("fly ash",s.productArr).achieved||0),c.admix.target+=Number(r("admix",s.productArr).target||0),c.admix.achieved+=Number(r("admix",s.productArr).achieved||0)}),e.jsxs(re,{component:ne,sx:{maxHeight:"70vh"},children:[e.jsxs(ce,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsxs(B,{children:[e.jsx(a,{sx:n,children:"Date"}),e.jsx(a,{sx:n,children:"Vehicle Name"}),e.jsx(a,{sx:n,children:"Batch No"}),e.jsx(a,{sx:n,children:"Start Time"}),e.jsx(a,{sx:n,children:"End Time"}),e.jsx(a,{sx:n,children:"Total Target Weight"}),e.jsx(a,{sx:n,children:"Total Achieved Weight"}),e.jsx(a,{sx:n,children:"Recipe 1"}),e.jsx(a,{sx:n,children:"Cycle"}),e.jsx(a,{sx:n,children:"Cement"}),e.jsx(a,{sx:n,children:"10mm"}),e.jsx(a,{sx:n,children:"20mm"}),e.jsx(a,{sx:n,children:"Sand"}),e.jsx(a,{sx:n,children:"Water"}),e.jsx(a,{sx:n,children:"Cubic Meter"}),e.jsx(a,{sx:n,children:"30mm"}),e.jsx(a,{sx:n,children:"Crush Sand"}),e.jsx(a,{sx:n,children:"River Sand"}),e.jsx(a,{sx:n,children:"Fly Ash"}),e.jsx(a,{sx:n,children:"Admix"}),e.jsx(a,{sx:n,children:"Receipt"})]})}),e.jsxs(de,{children:[y.map((s,g)=>{var v;return e.jsxs(B,{children:[e.jsx(a,{sx:t,children:s.generalKeyInfo.Date}),e.jsx(a,{sx:t,children:((v=d(s.imei))==null?void 0:v.registration_id)||"-"}),e.jsx(a,{sx:t,children:s.generalKeyInfo["Batch No"]}),e.jsx(a,{sx:t,children:s.generalKeyInfo["Start Time"]}),e.jsx(a,{sx:t,children:s.generalKeyInfo["End Time"]}),e.jsx(a,{sx:t,children:s.generalKeyInfo["Total Target"]}),e.jsx(a,{sx:t,children:s.generalKeyInfo["Total Achieved"]}),e.jsx(a,{sx:t,children:s.generalKeyInfo["Recipe Name"]}),e.jsx(a,{sx:t,children:s.generalKeyInfo.Cycle}),e.jsxs(a,{sx:t,children:[r("cement",s.productArr).target||0," :",r("cement",s.productArr).achieved||0]}),e.jsxs(a,{sx:t,children:[r("10 mm agg",s.productArr).target||0," :",r("10 mm agg",s.productArr).achieved||0]}),e.jsxs(a,{sx:t,children:[r("20 mm agg",s.productArr).target||0," :",r("20 mm agg",s.productArr).achieved||0]}),e.jsxs(a,{sx:t,children:[r("sand",s.productArr).target||0," :",r("sand",s.productArr).achieved||0]}),e.jsx(a,{sx:t,children:s.generalKeyInfo.Water}),e.jsx(a,{sx:t,children:s.generalKeyInfo["Cubic Meter"]}),e.jsxs(a,{sx:t,children:[r("30mm",s.productArr).target||0," :",r("30mm",s.productArr).achieved||0]}),e.jsxs(a,{sx:t,children:[r("crush sand",s.productArr).target||0," :",r("crush sand",s.productArr).achieved||0]}),e.jsxs(a,{sx:t,children:[r("river sand",s.productArr).target||0," :",r("river sand",s.productArr).achieved||0]}),e.jsxs(a,{sx:t,children:[r("fly ash",s.productArr).target||0," :",r("fly ash",s.productArr).achieved||0]}),e.jsxs(a,{sx:t,children:[r("admix",s.productArr).target||0," :",r("admix",s.productArr).achieved||0]}),e.jsx(a,{align:"left",sx:{fontSize:"10px",color:"blue",textDecoration:"underline",cursor:"pointer","&:hover":{color:"darkblue"}},onClick:()=>{console.log("download clicked",s),_(s),b(!0)},children:"View Receipt"})]},g)}),e.jsxs(B,{children:[e.jsx(a,{sx:t,children:e.jsx("b",{children:"TOTAL"})}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{sx:t,children:e.jsx("b",{children:c.totalTarget})}),e.jsx(a,{sx:t,children:e.jsx("b",{children:c.totalAchieved})}),e.jsx(a,{}),e.jsx(a,{}),e.jsx(a,{sx:t,children:e.jsxs("b",{children:[c.cement.target,":",c.cement.achieved]})}),e.jsx(a,{sx:t,children:e.jsxs("b",{children:[c.mm10.target,":",c.mm10.achieved]})}),e.jsx(a,{sx:t,children:e.jsxs("b",{children:[" ",c.mm20.target,":",c.mm20.achieved]})}),e.jsx(a,{sx:t,children:e.jsxs("b",{children:[c.sand.target,":",c.sand.achieved]})}),e.jsx(a,{sx:t,children:e.jsx("b",{children:c.water})}),e.jsx(a,{sx:t,children:e.jsx("b",{children:c.cubic})}),e.jsx(a,{sx:t,children:e.jsxs("b",{children:[c.mm30.target,":",c.mm30.achieved]})}),e.jsx(a,{sx:t,children:e.jsxs("b",{children:[" ",c.crushSand.target,":",c.crushSand.achieved]})}),e.jsxs(a,{sx:t,children:[c.riverSand.target,":",c.riverSand.achieved]}),e.jsx(a,{sx:t,children:e.jsxs("b",{children:[c.flyAsh.target,":",c.flyAsh.achieved]})}),e.jsx(a,{sx:t,children:e.jsxs("b",{children:[c.admix.target,":",c.admix.achieved]})})]})]})]}),e.jsx(ca,{receiptData:S,open:m,setOpen:b})]})}function ba({handleBack:y,setStartDate:T,startDate:S,setEndDate:_,endDate:m}){var w;const b=P(),{vehicleGroup:d,vehicleList:r}=I(h=>h.liveMap),{batchReportsData:n,batchReportsData2:t,loading:c,selectedGroup:s,selectedVehicle:g,distributorList:v}=I(h=>h.report),[p,L]=j.useState([]);j.useState([]);const[z,M]=j.useState([]),[k,A]=j.useState([]);let W=h=>(console.log(r.find(i=>{var u;return((u=i==null?void 0:i.imei[0])==null?void 0:u.mac_id)==h||""})),r.find(i=>{var u;return((u=i==null?void 0:i.imei[0])==null?void 0:u.mac_id)==h||""}));const O=(h,i)=>i.find(o=>{var E;return((E=o==null?void 0:o.name)==null?void 0:E.toLowerCase().trim())===h})||null,F=(h,i)=>{if(!h||!h.length>0)return;const u=h.reduce((V,C)=>V+(C!=null&&C.total_target&&parseFloat(C.total_target.replace(/^0+/,""))||0),0),o=h.reduce((V,C)=>V+(C!=null&&C.totalAcheived&&parseFloat(C.totalAcheived.replace(/^0+/,""))||0),0),E=["cement","10 mm","20 mm","sand","crush sand","river sand","fly ash","30 mm","water","admix"],l={};return E.forEach(V=>{const C=h.reduce((J,Q)=>{var Y;const $=(Y=i(V,Q.materials||[]))==null?void 0:Y.target;return J+($&&parseFloat($.replace(/^0+/,""))||0)},0),ee=h.reduce((J,Q)=>{var Y;const $=(Y=i(V,Q.materials||[]))==null?void 0:Y.actual;return J+($&&parseFloat($.replace(/^0+/,""))||0)},0);l[V]=`${C}:${ee}`}),{"Total Target Weight":u,"Total Achieved Weight":o,...l}};j.useEffect(()=>{const h=l=>l&&String(l).replace(/^0+/,"")||"-",i=(l,V=[])=>{const C=O(l,V);return{target:h(C==null?void 0:C.target),actual:h(C==null?void 0:C.actual)}};let u=(n==null?void 0:n.map(l=>{const{customer_name:V="-",registration_id:C="-",segment:ee="-"}=W(l==null?void 0:l.imei)||{};return{Date:l!=null&&l.date&&te(l==null?void 0:l.date,"DDMMYYYY").isValid()?te(l==null?void 0:l.date,"DDMMYYYY").format("DD-MM-YYYY"):"-",Vehicle:C||"-","Batch No":(l==null?void 0:l.batch_no)||"-","Start Time":(l==null?void 0:l.start_time)||"-",EndTime:(l==null?void 0:l.end_time)||"-","Total Target Weight":h(l==null?void 0:l.total_target),"Total Achieved Weight":h(l==null?void 0:l.totalAcheived),"Recipe 1":(l==null?void 0:l.mix_name)||"-",Cement:`${i("cement",l==null?void 0:l.materials).target}:${i("cement",l==null?void 0:l.materials).actual}`,"10mm":`${i("10 mm",l==null?void 0:l.materials).target}:${i("10mm",l==null?void 0:l.materials).actual}`,"20mm":`${i("20 mm",l==null?void 0:l.materials).target}:${i("20mm",l==null?void 0:l.materials).actual}`,Sand:`${i("sand",l==null?void 0:l.materials).target}:${i("sand",l==null?void 0:l.materials).actual}`,"Crush Sand":`${i("crush sand",l==null?void 0:l.materials).target}:${i("crush sand",l==null?void 0:l.materials).actual}`,"River Sand":`${i("river sand",l==null?void 0:l.materials).target}:${i("river sand",l==null?void 0:l.materials).actual}`,"Fly Ash":`${i("fly ash",l==null?void 0:l.materials).target}:${i("fly ash",l==null?void 0:l.materials).actual}`,"30mm":`${i("30 mm",l==null?void 0:l.materials).target}:${i("30mm",l==null?void 0:l.materials).actual}`,Water:`${i("water",l==null?void 0:l.materials).target}:${i("water",l==null?void 0:l.materials).actual}`,Admix:`${i("admix",l==null?void 0:l.materials).target}:${i("admix",l==null?void 0:l.materials).actual}`}}))||[];const o=F(n,O),E=[...u,{Date:"",Vehicle:"-","Batch No":"-","Start Time":"-",EndTime:"Total","Total Target Weight":(o==null?void 0:o["Total Target Weight"])||0,"Total Achieved Weight":(o==null?void 0:o["Total Achieved Weight"])||0,"Recipe 1":"-",Cement:(o==null?void 0:o.cement)||"-","10mm":(o==null?void 0:o["10 mm"])||"-","20mm":(o==null?void 0:o["20 mm"])||"-",Sand:(o==null?void 0:o.sand)||"-","Crush Sand":(o==null?void 0:o["crush sand"])||"-","River Sand":(o==null?void 0:o["river sand"])||"-","Fly Ash":(o==null?void 0:o["fly ash"])||"-","30mm":(o==null?void 0:o["30 mm"])||"-",Water:(o==null?void 0:o.water)||"-",Admix:(o==null?void 0:o.admix)||"-"}];M(E)},[n]);const f=h=>{if(!h&&!h.length>0)return;let i=[];for(let u=0;u<h.length;u++)if(h[u].startsWith("Product:")){const o=h[u],E=h[u+1]||"",l=o.match(/Product:\s*(.*?)\s*Target.*:\s*(\d+)/),V=E.match(/Achieved.*:\s*(\d+)/);l&&i.push({product:l[1],target:Number(l[2]),achieved:V?Number(V[1]):0})}return i},x=["Batch No","Date","Start Time","Operator","Recipe Name","Cubic Meter","Cycle","End Time","Total Target","Total Achieved","Water","Admix"],N=h=>{if(!h&&!h.length>0)return;let i={};return h.forEach(u=>{x.forEach(o=>{var E;if(u.includes(o)){const V=((E=u.split(/[:\-](.+)/)[1])==null?void 0:E.trim())||"";i[o]=V}})}),i};j.useEffect(()=>{if(console.log("bacth reports data11",t),t&&t.length>0){let h=t.map(i=>{let u=f((i==null?void 0:i.parts)||[]),o=N((i==null?void 0:i.parts)||[]);return{productArr:u,generalKeyInfo:o,imei:i==null?void 0:i.deviceId}});h&&h.length>0?A(h):A([]),console.log("formatted arr",h)}},[t]),j.useEffect(()=>{if(d&&d.length>0){let h=d.map(i=>({...i,label:i.group_name,value:i.id}));L(h)}},[d,r,v]),j.useEffect(()=>{g||b(he())},[]);function H(h){console.log("value changed",h),b(Le(h))}function U(h){console.log("value",h),b(Ee(h))}const G=async()=>{const h=`${S} 00:00`,i=`${m} 23:59`;let u=W(g);if(console.log("vehicle info",u),!K())return;let o={imei:g,startDate:h,endDate:i};u.vehicle_type==="Sprint"&&b(He(o)),u.vehicle_type==="Appalto"&&b(Ue(o))},K=()=>!S||!m||g==="all"?(Z.error("Please select start date, end date, and vehicle."),!1):!0,q=(w=W(g))==null?void 0:w.vehicle_type;console.log("device type",q);const X=s==="All"?r:r.filter(h=>h.vehicle_group===s);return e.jsxs(R,{sx:{width:"100%",m:"auto"},children:[e.jsx(R,{sx:{ml:"10px"},children:e.jsx(ke,{handleBack:y,downloadData:z})}),e.jsxs(R,{children:[e.jsxs(D,{size:"large",value:s,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle group",optionFilterProp:"children",onChange:H,filterOption:(h,i)=>{var u;return typeof((u=i==null?void 0:i.props)==null?void 0:u.children)=="string"&&i.props.children.toLowerCase().indexOf(h.toLowerCase())>=0},children:[e.jsx(D.Option,{value:"All",children:"All"}),p.map((h,i)=>e.jsx(D.Option,{value:h.value,children:h.label},i))]}),e.jsxs(D,{size:"large",value:g,showSearch:!0,style:{width:200,margin:"10px"},placeholder:"Select vehicle",optionFilterProp:"children",onChange:U,filterOption:(h,i)=>{var u;return typeof((u=i==null?void 0:i.props)==null?void 0:u.children)=="string"&&i.props.children.toLowerCase().indexOf(h.toLowerCase())>=0},children:[e.jsx(D.Option,{value:"all",children:"None"},"all"),X&&X.length>0&&X.map((h,i)=>{var u;return e.jsx(D.Option,{value:(u=h.imei[0])==null?void 0:u.mac_id,children:h.registration_id},i)})]}),e.jsx(Ie,{setStartDate:T,setEndDate:_,selectedDate:!1,startDate:S,endDate:m}),e.jsx(le,{variant:"contained",style:{width:200,marginLeft:"10px",backgroundColor:"#43556C"},onClick:G,disabled:!g,children:"Generate report"})]}),c&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1050},children:e.jsx(Re,{})}),q==="Sprint"&&(n==null?void 0:n.length)>0&&e.jsx(R,{ml:1.5,children:e.jsx(va,{tableData:n})}),q==="Appalto"&&(k==null?void 0:k.length)>0&&e.jsx(R,{ml:1.5,children:e.jsx(ma,{tableData:k})})]})}function Ve({children:y,value:T,index:S}){return e.jsx("div",{role:"tabpanel",hidden:T!==S,children:T===S&&e.jsx(R,{p:2,children:y})})}function ya({showCard:y,setReportType:T,reportType:S}){I(s=>s.dashboard),I(s=>s.liveMap);const{startDate:_,endDate:m,tabValue:b}=I(s=>s.report),[d,r]=j.useState(!0);j.useState({}),j.useState(!1);let n=P();j.useEffect(()=>{},[m]),j.useEffect(()=>{n(Se()),n(Te())},[]);const t=()=>{n(he()),n(Se()),n(Te()),n(T(null))},c=(s,g)=>{n(Xe(g))};return e.jsx(e.Fragment,{children:e.jsx(R,{sx:{},children:e.jsxs(R,{children:[e.jsxs(qe,{value:b,onChange:c,children:[e.jsx(Ae,{label:"Vehicle Report"}),e.jsx(Ae,{label:"Batch data report"})]}),e.jsx(Ve,{value:b,index:0,children:e.jsx(ja,{handleBack:t,selectedDate:d,setEndDate:Ce,setStartDate:_e,startDate:_,endDate:m})}),e.jsx(Ve,{value:b,index:1,children:e.jsx(ba,{handleBack:t,selectedDate:d,setEndDate:Ce,setStartDate:_e,startDate:_,endDate:m})})]})})})}function _a(){const{mode:y,showVehicles:T,selectedVehicleGroup:S}=I(p=>p.dashboard),{w_customer_id:_}=I(p=>p.auth),{reportType:m}=I(p=>p.report),[b,d]=j.useState([]),[r,n]=j.useState(!0),[t,c]=j.useState(!1),s=ra(y);let g=P();j.useEffect(()=>{v()},[]);const v=async()=>{try{let p=[],L=[];const z=await g(Je({w_customer_id:_}));if(Array.isArray(z.payload)){z.payload.forEach(A=>{var W,O;Array.isArray(A.imei)&&A.imei.length>0?(p.push({id:A.id,label:A.registration_id,value:(W=A==null?void 0:A.imei[0])==null?void 0:W.mac_id,workShop:A==null?void 0:A.workshop,vehicle_group:A==null?void 0:A.vehicle_group}),L.push((O=A.imei[0])==null?void 0:O.mac_id)):console.error("IMEI data not found for item:",A)});const M="one",k=L;L.length>0&&(g(Qe({type:M,imei:k})),g(Ze(k))),d(p),g(we({w_customer_id:_})),g(ea({}))}else console.error("Unexpected data format:",z),Z.error("Unexpected data format:")}catch(p){console.error("Error fetching vehicle data:",p),Z.error(`Error fetching vehicle data: ${p}`)}};return b.filter(p=>Object.keys(S).length===0||p.vehicle_group===S.id),e.jsxs("div",{className:"app",children:[e.jsx(aa,{}),e.jsxs("main",{className:"content",style:{width:"100%",background:s.grey[100]},children:[e.jsx(ta,{title:"Report",setShowVehiclesGroup:c,showVehiclesGroup:t,reportType:m}),e.jsx(la,{setShowVehiclesGroup:c,showVehiclesGroup:t}),e.jsxs(R,{style:{display:"flex",width:"100%",height:"95vh",background:s.grey[200]},children:[e.jsx(R,{style:{display:"flex",width:"100%",overflowY:"auto",height:"95vh"},children:e.jsx(R,{style:{width:"100%"},children:e.jsx(ya,{showCard:r,setReportType:sa,reportType:m})})}),!1]})]})]})}export{_a as default};
