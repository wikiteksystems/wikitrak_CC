import{b as o,y as w,x as k,ag as N,bi as W,J as O,j as a,B as Y,bf as X,bg as G,a9 as $,X as K,Y as Q,$ as Z}from"./index-CLXmKO9l.js";import{V as ee}from"./VehicleMenu-BTTj2D9f.js";import{t as ae}from"./SearchTab-BBmlRp8R.js";import"./Loader-CtwdMdvW.js";import"./LiveMapServices-DY1xO-_c.js";import"./Socket-0N_gnJcr.js";import{P as re}from"./Parameters-LacIjCO7.js";/* empty css           */import"./proj-XQwXs9DQ.js";import{L as te}from"./LeftSideBar2-fsH77pSX.js";import{S as se}from"./ServiceRecordTable-BDW159Dm.js";import{a as oe}from"./formik.esm-BD6A5zxw.js";import{c as le,a as D,f as R,e as ne}from"./index.esm-DfMsjMuD.js";import{L as ie,A as ce,D as J}from"./moment-B1gXbMh0.js";import{T as u,M as F}from"./TextField-Dx1xnSeb.js";import{B as g,M as de}from"./menu2-DKh_djjf.js";import{S as he}from"./ServicesTopBar-Cfpwgure.js";import"./Autocomplete-CiC-MuyU.js";import"./useControlled-DolBPKsO.js";import"./index-Ci1TuyIq.js";import"./createSvgIcon-nbF4Nr6P.js";import"./Card--6AJ0W0e.js";import"./CardContent-BcixHAbL.js";import"./dayjs.min-KJH-_OFv.js";import"./customParseFormat-ocC5Vqbi.js";import"./index-BXtxbbnI.js";import"./TableRow-BoXu6B2E.js";import"./TablePagination-CX7cA0ms.js";const pe=({setOpen:i})=>{const[d,y]=o.useState(null),{vehicleList:m}=w(r=>r.liveMap),{vendorList:j,segMentList:P}=w(r=>r.services),L=k(),[M,q]=o.useState([]),[h,x]=o.useState([]),e=oe({initialValues:{vehicle:"",vendor:"",priority_class:"",completion_date:null,next_due_date:null,chassis_no:"",odometer:"",attachment:null,status:"Pending"},validationSchema:le().shape({vehicle:D().required("Vehicle is required"),vendor:D().required("Vendor is required"),priority_class:D().required("Priority class is required"),completion_date:R().nullable().required("Completion date is required"),next_due_date:R().nullable().required("Next due date is required"),chassis_no:D().required("Chassis number is required"),odometer:D().required("Odometer is required"),attachment:ne().nullable().required("Attachment is required")}),onSubmit:async r=>{const s=new FormData;s.append("vehicle",r.vehicle),s.append("segment",r.vendor),s.append("priority_class",r.priority_class),s.append("completion_date",N(new Date(r.completion_date)).format("YYYY-MM-DD")),s.append("next_due_date",N(new Date(r.next_due_date)).format("YYYY-MM-DD")),s.append("chassis_no",r.chassis_no),s.append("odometer",r.odometer),s.append("attachment",d),s.append("status",r.status),s.append("user",JSON.parse(localStorage.getItem("w_userDetails")).user_id),console.log("form data",r),(await L(W(s))).payload&&(O.success("Service created successfully"),e.resetForm(),y(null),i(!1))}}),v=r=>{const s=r.target.files[0];y(s),e.setFieldValue("attachment",s)},V=["On Time","Over Due","Emergency"];o.useEffect(()=>{let r=m.map(s=>({label:s.registration_id,value:s.id}));q(r)},[m]),o.useEffect(()=>{let r=P.map(s=>({label:s.segment_name,value:s.id}));x(r)},[P]);const b={PaperProps:{style:{maxHeight:300,overflowY:"auto"}}};return a.jsx(ie,{dateAdapter:ce,children:a.jsxs("form",{onSubmit:e.handleSubmit,style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[a.jsx(u,{select:!0,name:"vehicle",label:"Select Vehicle",value:e.values.vehicle,onChange:e.handleChange,error:e.touched.vehicle&&!!e.errors.vehicle,helperText:e.touched.vehicle&&e.errors.vehicle,SelectProps:{MenuProps:b},children:M.map(r=>a.jsx(F,{value:r.value,children:r.label},r.value))}),a.jsx(u,{select:!0,name:"vendor",label:"Select segment",value:e.values.vendor,onChange:e.handleChange,error:e.touched.vendor&&!!e.errors.vendor,helperText:e.touched.vendor&&e.errors.vendor,children:h&&h.length>0&&h.map(r=>a.jsx(F,{value:r.value,children:r.label},r.value))}),a.jsx(u,{select:!0,name:"priority_class",label:"Priority Class",value:e.values.priority_class,onChange:e.handleChange,error:e.touched.priority_class&&!!e.errors.priority_class,helperText:e.touched.priority_class&&e.errors.priority_class,children:V.map(r=>a.jsx(F,{value:r,children:r},r))}),a.jsx(J,{label:"Completion Date",value:e.values.completion_date,onChange:r=>e.setFieldValue("completion_date",r),renderInput:r=>a.jsx(u,{...r,error:e.touched.completion_date&&!!e.errors.completion_date,helperText:e.touched.completion_date&&e.errors.completion_date})}),a.jsx(J,{label:"Next Due Date",value:e.values.next_due_date,onChange:r=>e.setFieldValue("next_due_date",r),renderInput:r=>a.jsx(u,{...r,error:e.touched.next_due_date&&!!e.errors.next_due_date,helperText:e.touched.next_due_date&&e.errors.next_due_date})}),a.jsx(u,{name:"chassis_no",label:"Chassis Number",value:e.values.chassis_no,onChange:e.handleChange,error:e.touched.chassis_no&&!!e.errors.chassis_no,helperText:e.touched.chassis_no&&e.errors.chassis_no}),a.jsx(u,{name:"odometer",label:"Odometer",value:e.values.odometer,onChange:e.handleChange,error:e.touched.odometer&&!!e.errors.odometer,helperText:e.touched.odometer&&e.errors.odometer}),a.jsxs(g,{children:[a.jsx("input",{type:"file",name:"attachment",onChange:v}),e.touched.attachment&&e.errors.attachment&&a.jsx("div",{style:{color:"red"},children:e.errors.attachment})]}),a.jsxs("div",{style:{display:"flex",justifyContent:"end"},children:[a.jsx(Y,{type:"submit",variant:"contained",color:"primary",sx:{mr:2},children:"Save"}),a.jsx(Y,{variant:"outlined",onClick:()=>i(!1),children:"Cancel"})]})]})})},ue={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid black",borderRadius:"5px",boxShadow:24,p:4,height:"600px",overflowY:"auto",scrollbarWidth:"50%"};function me(){const[i,d]=o.useState(!1);k();const y=()=>d(!0),m=()=>d(!1);return a.jsxs("div",{children:[a.jsx(Y,{variant:"outlined",onClick:y,children:"+ Add New Entry"}),a.jsx(de,{open:i,onClose:m,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",BackdropProps:{onClick:j=>j.stopPropagation()},children:a.jsx(g,{sx:ue,children:a.jsx(pe,{setOpen:d})})})]})}const xe=()=>{const i=k();return o.useEffect(()=>{i(X()),i(G())},[]),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",height:"70px"},children:[a.jsx("div",{style:{margin:"10px"},children:a.jsx("h3",{children:"Service Record"})}),a.jsx("div",{style:{margin:"10px",marginTop:"20px"},children:a.jsx(me,{})})]}),a.jsxs("div",{children:[a.jsx("hr",{}),a.jsx("div",{style:{margin:"10px"},children:a.jsx(se,{isInspection:!1})})]})]})},ve=xe;function Ue(){const{locationData:i,selectedVehicle:d,selectedParameterList:y}=w(l=>l.liveMap),{mode:m}=w(l=>l.dashboard),j=ae(m),[P,L]=o.useState([]),{w_customer_id:M}=w(l=>l.auth),[q,h]=o.useState(),[x,e]=o.useState(!1),[v,V]=o.useState(!1),[b,r]=o.useState([]),[s,I]=o.useState(!0),[U,B]=o.useState(!1);let S=k();o.useEffect(()=>{z()},[]),o.useEffect(()=>{r([]),S($([{reg_id:"",imei:"",params:[]}]))},[d]);const z=async()=>{try{B(!0);let l=[],c=[];const _=await S(K({w_customer_id:M}));if(Array.isArray(_.payload)){_.payload.forEach(t=>{var f,p,A,n;Array.isArray(t.imei)&&t.imei.length>0&&((f=t.imei[0])!=null&&f.mac_id)?(l.push({id:t.id,label:t.registration_id,value:(p=t.imei[0])==null?void 0:p.mac_id,vehilce_type:t==null?void 0:t.segment,chassis_no:t==null?void 0:t.chassis_no,engine_no:t==null?void 0:t.engine_no,workShop:t==null?void 0:t.workshop,registration_id:t==null?void 0:t.registration_id,sell_date:t==null?void 0:t.sell_date,customer_name:t==null?void 0:t.customer_name,vehicle_model:(A=t==null?void 0:t.vehicle_model)==null?void 0:A.name}),c.push((n=t.imei[0])==null?void 0:n.mac_id)):console.error("IMEI data not found for item:",t)});const E="one",T=c;c.length>0&&S(Q({type:E,imei:T})),L(l),S(Z(l)),B(!1)}else B(!1),console.error("Unexpected data format:",_),O.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),O.error(`Error fetching vehicle data: ${l}`)}},H=async l=>{const{label:c,imei:_,id:E,reg_id:T,checked:t}=l;h(n=>n.map(C=>C.id===E?{...C,checked:!t}:C));let f=[...b],p=[...b];if(!t)i.forEach(n=>{n.latestDocument.imei===_&&(f.push({label:c,value:n.latestDocument[c==="maininputvoltage"?"mainInputVoltage":c]}),p=f,r(f))});else{let n=b.filter(C=>C.label!==c);p=n,r(n)}console.log("tempParamList",p),S($([{reg_id:T,imei:_,params:p}]))};return a.jsxs("div",{className:"app",children:[a.jsx(te,{}),a.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[a.jsx(he,{title:"services",setShowVehicles:e,showVehicles:x,showParameters:v,setShowParameters:V,setShowCard:I,showCard:s}),a.jsxs(g,{style:{display:"flex",width:"100%",height:"95vh"},children:[a.jsx(g,{style:{width:x||v?"80%":"100%"},children:a.jsx(ve,{})}),x&&a.jsx(g,{style:{width:"20%",backgroundColor:j.grey[100]},children:a.jsx(ee,{vehicleData:P,title:"Inspections",setParameterData:h,loadingVehicle:U,setShowVehicles:e,showVehicles:x,showParameters:v,setShowParameters:V})}),v&&a.jsx(g,{style:{width:"20%",backgroundColor:j.grey[100]},children:a.jsx(re,{parametersData:q,setParameterData:h,handleParameterChange:H})})]})]})]})}export{Ue as default};
