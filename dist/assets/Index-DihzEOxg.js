import{aa as Me,ab as Le,j as n,p as re,r as u,B as j,z as We,T as z,C as ve,ac as Ge,R as rt,o as Ue,w as _e,a6 as lt,S as Ce,ad as ct,O as it,ae as ut,af as dt,ag as ft,ah as gt,m as pt,ai as ht,aj as xt,V as ue,ak as yt,N as kt,al as Ne,am as Be,a0 as vt,a1 as bt,a3 as St,a4 as jt,U as wt,X as Dt,v as _t}from"./index-BG4yWcwg.js";import{L as It}from"./LiveMapTopBar-BYeMBMAC.js";import{V as mt}from"./VehicleMenu-DeUxZOH1.js";import"./Loader-DKR_OpKq.js";import{P as Ct}from"./Parameters-Dq9xSFVd.js";/* empty css           */import{u as Mt,G as Lt,M as Rt}from"./esm-DryNXoII.js";import{L as Vt,M as $t,b as Et,y as Ot,g as At,r as Tt,a as Nt,c as Bt,d as Ft,e as Wt,f as Gt,h as Ut,i as Ht,j as zt,k as qt,l as Yt,m as Kt,n as Xt,o as Jt,p as Zt,q as Qt,s as Pt,t as en,u as tn,v as nn}from"./black_bike-ZTr7vHW6.js";import{d as on}from"./ContentCopy-nuIfViAU.js";import{m as De}from"./motorbike-Ci4voNFa.js";import{r as sn}from"./redTractor-NXgVJyvR.js";import{T as an}from"./TextField-xwf6t2U4.js";import"./Autocomplete-DiNMJ2oo.js";import"./Card-CKiYdaAJ.js";import"./CardContent-D8jJM2Wh.js";import"./index-BIyco3rD.js";var Re={},rn=Me;Object.defineProperty(Re,"__esModule",{value:!0});var He=Re.default=void 0,ln=rn(Le()),cn=n;He=Re.default=(0,ln.default)((0,cn.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info");var Ve={},un=Me;Object.defineProperty(Ve,"__esModule",{value:!0});var ze=Ve.default=void 0,dn=un(Le()),fn=n;ze=Ve.default=(0,dn.default)((0,fn.jsx)("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"NorthEast");var $e={},gn=Me;Object.defineProperty($e,"__esModule",{value:!0});var qe=$e.default=void 0,pn=gn(Le()),hn=n;qe=$e.default=(0,pn.default)((0,hn.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn");const xn=({label:k,value:h})=>n.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",py:.5},children:[n.jsx(z,{variant:"body2",color:"textSecondary",children:k}),n.jsx(z,{variant:"body2",color:"textPrimary",fontWeight:"medium",children:h||"N/A"})]}),yn=(k,h)=>(k==null?void 0:k.find(B=>{var V,$;return(($=(V=B.imei)==null?void 0:V[0])==null?void 0:$.mac_id)===h}))||{},Fe=({title:k,details:h})=>n.jsx(j,{sx:{width:"45%"},children:h.map(({label:B,value:V})=>n.jsx(xn,{label:B,value:V},B))});let kn=["vt200","wtkpltf001"];function vn({handleVehicleInfo:k,udpatedParams:h,handleClickOpen:B}){var ce,C,U,Y,M,K,te,ne,W,X,fe,ie,oe,se,ge,E,xe;const{collapsed:V}=re(x=>x.auth),{vehicleList:$,selectedVehicle:w,selectedImei:F}=re(x=>x.liveMap),[i,de]=u.useState({});let[s,le]=u.useState(null);u.useEffect(()=>{let x=h&&(h==null?void 0:h.length)>0&&(h==null?void 0:h.find(v=>{var O;return((O=v==null?void 0:v.latestDocument)==null?void 0:O.imei)==F}));le(x)},[h,F]),u.useEffect(()=>{de(yn($,F))},[$,F]);const P=(x,v)=>{const O=`https://www.google.com/maps?q=${x},${v}`;window.open(O,"_blank")},ee=x=>{var S,l;let v=(S=x==null?void 0:x.latestDocument)==null?void 0:S.ignition,O=(l=x==null?void 0:x.latestDocument)==null?void 0:l.speed;return v===!0||v===1?O:0},q=[{label:"Vehicle No:",value:i==null?void 0:i.registration_id},{label:"Model:",value:(ce=i==null?void 0:i.vehicle_model)==null?void 0:ce.name},{label:"IMEI No:",value:(U=(C=i==null?void 0:i.imei)==null?void 0:C[0])==null?void 0:U.mac_id},{label:"Chassis No:",value:i==null?void 0:i.chassis_no},{label:"Engine No:",value:i==null?void 0:i.engine_no}],be=[{label:"Customer Name:",value:(Y=i==null?void 0:i.user)!=null&&Y.us_user?`${i.user.us_user.first_name.charAt(0).toUpperCase()}${i.user.us_user.first_name.slice(1)} ${i.user.us_user.last_name.charAt(0).toUpperCase()}${i.user.us_user.last_name.slice(1)}`:null},{label:"Mobile: ",value:((M=i==null?void 0:i.user)==null?void 0:M.us_user)&&i.user.us_user.mobile},{label:"Date of Sell:",value:i==null?void 0:i.sell_date},{label:"Workshop Name:",value:(K=i==null?void 0:i.workshop)==null?void 0:K.name}];let m={border:"2px solid black",borderRadius:"5px",padding:"5px",color:"black"};const he=x=>{let v=$.find(S=>{var l,p;return((l=S==null?void 0:S.imei)==null?void 0:l.length)>0&&((p=S.imei[0])==null?void 0:p.mac_id)==x.imei}),O=parseFloat((v==null?void 0:v.load_capacity)||0)/49*parseFloat((x==null?void 0:x.analogInput1)||0);return`${parseFloat(O).toFixed(2)} Kgs`||0};return n.jsxs(j,{sx:{position:"absolute",top:"600px",left:V?"280px":"450px",zIndex:1,background:We.bgShadow,p:2,borderRadius:2,color:"white",width:"72%",boxShadow:"0px 4px 12px rgba(0,0,0,0.4)"},children:[n.jsx(z,{variant:"h5",sx:{fontWeight:"bold",color:"black"},children:"Vehicle Information"}),n.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[n.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",width:"100%",marginLeft:"10px"},children:[n.jsx(j,{sx:m,children:n.jsxs(z,{children:[((te=s==null?void 0:s.latestDocument)==null?void 0:te.venderId)==="Sinocastel"?"Cranking status":"Ignition",":"," ",((ne=s==null?void 0:s.latestDocument)==null?void 0:ne.ignition)===!0||((W=s==null?void 0:s.latestDocument)==null?void 0:W.ignition)===1?"On":"Off"]})}),kn.includes((fe=(X=s==null?void 0:s.latestDocument)==null?void 0:X.venderId)==null?void 0:fe.toLowerCase())&&n.jsx(j,{sx:m,children:n.jsxs(z,{children:["Pump:"," ",((ie=s==null?void 0:s.latestDocument)==null?void 0:ie.isAcreage)===!0||((oe=s==null?void 0:s.latestDocument)==null?void 0:oe.isAcreage)===1?"On":"Off"]})}),n.jsx(j,{sx:m,children:n.jsxs(z,{children:["Speed: ",ee(s)," km/h"]})}),n.jsx(j,{sx:m,children:n.jsxs(z,{children:["Main Voltage:"," ",s?`${((se=s==null?void 0:s.latestDocument)==null?void 0:se.mainInputVoltage)||0} Voltage`:0]})}),n.jsx(j,{sx:m,children:n.jsxs(z,{children:["Heading:"," ",s?`${(ge=s==null?void 0:s.latestDocument)==null?void 0:ge.heading} deg`:0]})}),s&&((E=s==null?void 0:s.latestDocument)==null?void 0:E.venderId)==="VT200"&&n.jsx(j,{sx:m,children:n.jsxs(z,{children:["Load:"," ",s?he(s==null?void 0:s.latestDocument):0]})}),s&&((xe=s==null?void 0:s.latestDocument)==null?void 0:xe.venderId)==="VT200"&&n.jsx(j,{sx:m,children:n.jsxs(z,{children:["Remaining fuel:"," ","0 Ltr"]})}),n.jsxs(ve,{disabled:!s,onClick:()=>{var x,v;P((x=s==null?void 0:s.latestDocument)==null?void 0:x.lat,(v=s==null?void 0:s.latestDocument)==null?void 0:v.lng)},children:["Navigate to map",n.jsx(ze,{})]}),n.jsxs(ve,{disabled:!s,onClick:()=>{B()},children:["Share live location",n.jsx(qe,{})]})]}),n.jsx(Ge,{sx:{cursor:"pointer",color:"black"},onClick:k})]}),n.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[n.jsx(Fe,{title:"Vehicle Details",details:q}),n.jsx(Fe,{title:"Customer Details",details:be})]})]})}const bn="https://cc.wikitrak.in/proxy-3031",Sn="AIzaSyD8TrUWS9FRTu-MRP339mJF_iWlORvEGUA";function jn({showCard:k,loadingVehicle:h,vehicleData:B}){const{center:V,selectedParameterList:$,selectedVehicle:w,vehicleList:F,zoom:i,icons:de,locationData:s,placesData:le,imeiNumbers:P,selectedImei:ee,onlineVehicle:q,loading:be,services_loading:m}=re(e=>e.liveMap),{mode:he,styles:ce,vehicles_details:C}=re(e=>e.dashboard),U=u.useRef(null),{collapsed:Y}=re(e=>e.auth),[M,K]=u.useState(null),[te,ne]=u.useState(""),[W,X]=u.useState([]),[fe,ie]=u.useState(),[oe,se]=u.useState(null),[ge,E]=u.useState(""),[xe,x]=u.useState(),[v,O]=u.useState(!1),[S,l]=u.useState(null),[p,_]=rt.useState(!1),[J,H]=u.useState(""),c=async()=>{var e;if(!ee)return ue.error("Please select vehicle");try{const t=await yt.post(`${bn}/api/generate-token`,{vehicleNo:ee});if((e=t==null?void 0:t.data)!=null&&e.token){const o=`http://cc.wikitrak.in/live-location/${ee}/${t.data.token}`;H(o),_(!0)}}catch(t){ue.error("Error occurred while generating link"),_(!1),H(!1),console.error("Error generating link",t)}},G=()=>{c()},A=()=>{_(!1)},T=Ue(),D={},L=u.useRef([]),ye=u.useRef(null),ae=u.useRef({}),{isLoaded:pe,loadError:Se}=Mt({googleMapsApiKey:`${Sn}`});u.useEffect(()=>{pe&&K(window.google.maps)},[pe]),u.useEffect(()=>{},[i]),u.useEffect(()=>{var e,t,o,r;if(Object.keys(w).length>0){const a=(S==null?void 0:S.length)>0?S:s,d=a==null?void 0:a.filter(f=>{var g;return((g=f==null?void 0:f.latestDocument)==null?void 0:g.imei)===(w==null?void 0:w.imei)});if((d==null?void 0:d.length)>0){X(d);const f={lat:(t=(e=d[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(r=(o=d[0])==null?void 0:o.latestDocument)==null?void 0:r.lng};T(_e(f))}}},[s,w]),u.useEffect(()=>{var e,t,o,r;if(Object.keys(w).length>0){const a=(S==null?void 0:S.length)>0?S:s,d=a==null?void 0:a.filter(f=>{var g;return((g=f==null?void 0:f.latestDocument)==null?void 0:g.imei)===(w==null?void 0:w.imei)});if((d==null?void 0:d.length)>0){X(d);const f={lat:(t=(e=d[0])==null?void 0:e.latestDocument)==null?void 0:t.lat,lng:(r=(o=d[0])==null?void 0:o.latestDocument)==null?void 0:r.lng};T(_e(f))}}else{const a=s==null?void 0:s.filter(d=>B.some(f=>f.value===d.latestDocument.imei));X(a),l(a)}},[s,w]),u.useEffect(()=>{ie($)},[$]),u.useEffect(()=>{T(lt({}))},[w]),u.useEffect(()=>{if(console.log("before: ",W),!M)return;const e=ye.current;let t=null;return(async()=>{console.log("after: ",W);const r=await je(W,e);t&&t.clearMarkers(),t=Je(r,e),Ce.on("locationinfo",a=>{console.log("locationinfo: ",a),Qe(a,L),l(d=>{const f=Array.isArray(d)?d:[],g=f.findIndex(y=>y.latestDocument.imei==a.imei);if(g!==-1){const y=[...f];return y[g]={...y[g],latestDocument:{...y[g].latestDocument,...a}},y}else return[...f,{_id:a.imei,latestDocument:a}]})})})(),()=>{t&&t.clearMarkers(),Object.keys(ae.current).forEach(r=>cancelAnimationFrame(ae.current[r])),Ce.off("locationinfo")}},[M,W,Ce,fe,L,s]);const je=(e,t)=>e.map(o=>{const r=o.latestDocument.imei,a=L.current[r]||we(o,t);return L.current[r]&&ke(o,a),a}),we=(e,t)=>{const o=e.latestDocument.imei,r=new M.Marker({position:{lat:e.latestDocument.lat,lng:e.latestDocument.lng},map:t,icon:Ie(e,0)});return r.addListener("click",()=>Xe(e,r,t)),L.current[o]=r,r},ke=async(e,t)=>{var g;const o=t.getPosition(),r=((g=t.getIcon())==null?void 0:g.rotation)||0,a={lat:e.latestDocument.lat,lng:e.latestDocument.lng},d=Oe(o,a);console.log("update marker",d),Ee(t,o,a,r,d);const f=await Ie(e,d);t.setIcon(f)},Ie=async(e,t)=>{var g,y,b,I;const o=(g=e==null?void 0:e.latestDocument)==null?void 0:g.imei,r=Pe(o),a=tt(e==null?void 0:e.latestDocument,r);return me((y=e==null?void 0:e.latestDocument)==null?void 0:y.imei)&&Ye((b=e==null?void 0:e.latestDocument)==null?void 0:b.imei),{url:await Ke(a,t),fillOpacity:2,strokeWeight:1,scale:12,rotation:(I=e==null?void 0:e.latestDocument)==null?void 0:I.heading}},me=e=>{if(!e)return!1;const t=String(e).toLowerCase();return q.some(o=>String(o).toLowerCase()===t)},Ye=e=>s==null?void 0:s.some(t=>String(t.latestDocument.imei)===String(e)&&t.latestDocument.speed>0&&(t.latestDocument.ignition===!0||t.latestDocument.ignition===1)),Ke=(e,t,o,r=50,a=40,d=45)=>{const f=`${e}-${t}-${r}-${o}-${a}-${d}`;if(D[f])return Promise.resolve(D[f]);const g=document.createElement("canvas"),y=g.getContext("2d");g.width=r,g.height=r;const b=new Image;return b.src=e,new Promise(I=>{b.onload=()=>{y.clearRect(0,0,g.width,g.height),y.translate(r/2,r/2),y.rotate(t*Math.PI/180),y.translate(-r/2,-r/2);const R=(r-a)/2,Z=(r-d)/2;y.drawImage(b,R,Z,a,d);const N=g.toDataURL("image/png");D[f]=N,I(N)},b.onerror=R=>{console.error("Error loading image for rotation:",R),I(e)}})},Xe=(e,t,o)=>{ot(e.latestDocument._id,e,t,o),st(e.latestDocument.imei)},Ee=(e,t,o,r,a)=>{const f=performance.now(),g=()=>{const y=performance.now()-f,b=Math.min(y/500,1),I=t.lat()+b*(o.lat-t.lat()),R=t.lng()+b*(o.lng-t.lng()),Z=(a-r+360)%360-180,N=(r+Z*b+360)%360;e.setPosition({lat:I,lng:R});const Q=e.getIcon();Q&&typeof Q=="object"&&e.setIcon({...Q,rotation:N}),b<1?ae.current[e.getPosition()]=requestAnimationFrame(g):(e.setPosition(o),Q&&typeof Q=="object"&&e.setIcon({...Q,rotation:a}),delete ae.current[e.getPosition()])};ae.current[e.getPosition()]=requestAnimationFrame(g)},Je=(e,t)=>new $t({map:t,markers:e,renderer:{render:({count:o,position:r})=>Ze(o,r)}}),Ze=(e,t)=>{const o=40+Math.min(e*2,40),r=30;let a;return e<10?a={start:"#76c7c0",end:"#34a853"}:e<50?a={start:"#fbbc05",end:"#f2994a"}:a={start:"#f45c42",end:"#d32f2f"},new M.Marker({position:t,icon:{url:`data:image/svg+xml,${encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="${o}" height="${o}" viewBox="0 0 100 100">
            <defs>
              <radialGradient id="gradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="${a.start}" />
                <stop offset="100%" stop-color="${a.end}" />
              </radialGradient>
              <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="rgba(0, 0, 0, 0.5)" />
              </filter>
            </defs>
            <!-- Outer Pulsating Ring -->
            <circle cx="50" cy="50" r="48" fill="url(#gradient)" filter="url(#shadow)" stroke="#ffffff" stroke-width="3" />
            <!-- Decorative Inner Ring -->
            <circle cx="50" cy="50" r="38" fill="none" stroke="#ffffff" stroke-width="2" stroke-dasharray="4 2" />
            <!-- Star Decoration -->
            <polygon points="50,15 54,38 70,38 57,50 62,68 50,57 38,68 43,50 30,38 46,38" fill="#ffffff" opacity="0.4" />
            <!-- Count Text -->
            <text x="50" y="55" font-size="${r}" fill="black" text-anchor="middle" font-family="'Courier New', monospace" font-weight="bold">
              ${e}
            </text>
          </svg>
        `)}`,scaledSize:new M.Size(o,o)},label:null})},Oe=(e,t)=>{const o=N=>N*Math.PI/180,r=N=>N*180/Math.PI,a=o(typeof e.lat=="function"?e.lat():e.lat),d=o(typeof e.lng=="function"?e.lng():e.lng),f=o(typeof t.lat=="function"?t.lat():t.lat),y=o(typeof t.lng=="function"?t.lng():t.lng)-d,b=Math.sin(y)*Math.cos(f),I=Math.cos(a)*Math.sin(f)-Math.sin(a)*Math.cos(f)*Math.cos(y),R=Math.atan2(b,I),Z=(r(R)+360)%360;return console.log("From:",e,"To:",t),console.log("Calculated heading (degrees):",Z),Z},Qe=async(e,t,o)=>{var d;const r=e.imei,a=t.current[r];if(a){const f=a.getPosition(),g=((d=a.getIcon())==null?void 0:d.rotation)||0,y={lat:e.lat,lng:e.lng},b=Oe(f,y);console.log("location update",b,g),Ee(a,f,y,g,b);const I=await Ie({latestDocument:e},b);if(a.setIcon(I),ee==(e==null?void 0:e.imei)){const R=ye.current.getBounds();R&&!R.contains(y)&&ye.current.panTo(y)}}},Pe=e=>{if(!e)return"motorBike";const t=et(e);return t||console.error(`No vehicle type found for IMEI: ${e}, defaulting to motorBike`),t||"motorBike"},et=e=>{if(!C||C.length===0)return console.error("vehicles_details is not available"),null;const t=C.find(o=>(o==null?void 0:o.value)===e&&(o==null?void 0:o.vehilce_type));return t||console.error(`No vehicle found for IMEI: ${e}`),t?t.vehilce_type:null},tt=(e,t)=>{let{speed:o,ignition:r,imei:a}=e,d=me(a);const f={"2W":{red:nn,green:tn,yellow:en,black:Pt},"3W":{red:Qt,green:Zt,yellow:Jt,black:Xt},"4W":{red:Kt,green:Yt,yellow:qt,black:zt},Tractor:{red:sn,green:Ht,yellow:Ut,black:Gt},Harvestor:{red:Wt,green:Ft,yellow:Bt,black:Nt},BUS:{red:Tt,green:At,yellow:Ot,black:Et},default:{red:De,green:De,yellow:De,black:De}};let g=f[t]||f.default;if(!d)return g.black;if(d&&!r)return g.red;if(d&&r&&o>0)return g.green;if(d&&r&&o<=0)return g.yellow},nt=e=>{console.log("packet and type",e);let{speed:t,ignition:o,imei:r}=e;console.log("speed",t,o,r);let a=me(r);if(console.log("isONline",a),!a)return"Offline";if(a&&!o)return"Online";if(a&&o&&t>0)return"Running";if(a&&o&&t<=0)return"Idle"},ot=(e,t,o,r)=>{var b,I,R,Z;let a=it(new Date((b=t==null?void 0:t.latestDocument)==null?void 0:b.Date)).format("DD-MM-YYYY HH:mm");T(ut(t.latestDocument.imei));const d={lat:(I=t==null?void 0:t.latestDocument)==null?void 0:I.lat,lng:(R=t==null?void 0:t.latestDocument)==null?void 0:R.lng};T(_e(d)),T(dt(15)),U.current||(U.current=new M.InfoWindow);const f=U.current,y=`
      <div>
        <h3>Registration No: ${((Z=F.find(N=>{var Q,Te;return((Q=N==null?void 0:N.imei[0])==null?void 0:Q.mac_id)===((Te=t==null?void 0:t.latestDocument)==null?void 0:Te.imei)}))==null?void 0:Z.registration_id)||""}</h3>
        <h3>Status:${nt(t==null?void 0:t.latestDocument)}</h3>
        <h3>Last updated time:${a}</h3>
      </div>
    `;oe===e?(f.close(),se(null)):(f.setContent(y),f.open(r,o),se(e))},st=e=>{const t=C&&(C==null?void 0:C.length)>0&&C.find(o=>(o==null?void 0:o.value)===e&&o);x(t||null)},Ae=()=>{O(!v)};if(Se)return"Error loading maps";if(!pe)return"Loading maps";if(!M)return null;const at={height:"93vh",width:"100%",transition:"transform 0.5s ease-in-out"};return n.jsxs(n.Fragment,{children:[n.jsx(j,{sx:{position:"absolute",top:"780px",left:Y?"74px":"250px",zIndex:1,background:We.bgColor,padding:"5px",borderRadius:"10px",color:"white"},children:n.jsxs(ve,{sx:{color:"white"},onClick:Ae,children:[v?"Hide":"Show"," Vehicle Info",n.jsx(He,{})]})}),v===!0&&n.jsx(vn,{handleVehicleInfo:Ae,udpatedParams:S,handleClickOpen:G}),n.jsxs(Lt,{id:"map",mapContainerStyle:at,zoom:i,center:V,onLoad:e=>{ye.current=e},options:{styles:he?ce:""},children:[Object.keys(w).length>0&&n.jsx(Vt,{setPlace:ne,place:te}),m||h?n.jsx(j,{sx:{position:"absolute",top:"50%",left:"50%"},children:n.jsx(ct,{})}):le&&le.length>0&&le.map((e,t)=>{var o,r;return n.jsx(Rt,{position:{lat:parseFloat((o=e==null?void 0:e.location)==null?void 0:o.lat),lng:parseFloat((r=e==null?void 0:e.location)==null?void 0:r.lng)},animation:window.google.maps.Animation.DROP,icon:{path:de[`${te}`],fillOpacity:2,strokeWeight:1,scale:1,fillColor:"orange"}},t)}),n.jsx(wn,{open:p,shareLink:J,handleClose:A})]})]})}const wn=({open:k,handleClose:h,shareLink:B})=>{const[V,$]=u.useState(""),w=u.useRef(null);u.useEffect(()=>{},[]);const F=()=>{const i=w.current;i?(i.select(),i.setSelectionRange(0,99999),document.execCommand("copy")?ue.success("Text copied!"):ue.error("Failed to copy!"),window.getSelection().removeAllRanges()):ue.error("Failed to copy! No input found.")};return n.jsxs(ft,{onClose:h,"aria-labelledby":"customized-dialog-title",open:k,fullWidth:!0,maxWidth:"lg",children:[!1,n.jsxs(gt,{sx:{m:0,p:2},id:"customized-dialog-title",children:["Vehicle live location link",n.jsx(pt,{"aria-label":"close",onClick:h,sx:i=>({position:"absolute",right:8,top:8,color:i.palette.grey[500]}),children:n.jsx(Ge,{})})]}),n.jsx(ht,{dividers:!0,children:n.jsxs(j,{display:"flex",alignItems:"center",gap:2,mt:1,children:[n.jsx(an,{fullWidth:!0,variant:"outlined",inputRef:w,value:B,onChange:i=>{},sx:{flex:9}}),n.jsx(ve,{variant:"outlined",onClick:F,startIcon:n.jsx(on,{}),sx:{flex:1,minWidth:"auto"},children:"Copy"})]})}),n.jsx(xt,{children:n.jsx(ve,{onClick:h,children:"Close"})})]})};function Fn(){const{locationData:k,selectedVehicle:h,selectedParameterList:B,onlineVehicle:V}=re(l=>l.liveMap),{mode:$,selectedVehicleGroup:w}=re(l=>l.dashboard),F=_t($),[i,de]=u.useState([]),[s,le]=u.useState(""),[P,ee]=u.useState(""),[q,be]=u.useState(""),[m,he]=u.useState(""),{w_customer_id:ce}=re(l=>l.auth),[C,U]=u.useState(),[Y,M]=u.useState(!1),[K,te]=u.useState(!1),[ne,W]=u.useState([]),[X,fe]=u.useState(!0),[ie,oe]=u.useState(!1),[se,ge]=u.useState(!1);let E=Ue();u.useEffect(()=>()=>{E(kt({}))},[]),u.useEffect(()=>{xe()},[]),u.useEffect(()=>{var l;if(Object.keys(h).length>0){const p=k==null?void 0:k.filter(c=>c.latestDocument.imei==(h==null?void 0:h.imei)),{lat:_,lng:J}=((l=p==null?void 0:p[0])==null?void 0:l.latestDocument)??{},H={lat:_||Ne.lat,lng:J||Ne.lat};E(_e(H))}},[h,k]),u.useEffect(()=>{W([]),E(Be([{reg_id:"",imei:"",params:[]}]))},[h]);const xe=async()=>{try{oe(!0);let l=[],p=[];const _=await E(vt({w_customer_id:ce}));if(Array.isArray(_.payload)){_.payload.forEach(c=>{var G,A,T,D;Array.isArray(c.imei)&&c.imei.length>0&&((G=c.imei[0])!=null&&G.mac_id)?(l.push({id:c.id,label:c.registration_id,value:(A=c.imei[0])==null?void 0:A.mac_id,vehilce_type:c==null?void 0:c.segment,chassis_no:c==null?void 0:c.chassis_no,engine_no:c==null?void 0:c.engine_no,workShop:c==null?void 0:c.workshop,registration_id:c==null?void 0:c.registration_id,sell_date:c==null?void 0:c.sell_date,customer_name:c==null?void 0:c.customer_name,vehicle_model:(T=c==null?void 0:c.vehicle_model)==null?void 0:T.name,vehicle_group:c==null?void 0:c.vehicle_group}),p.push((D=c.imei[0])==null?void 0:D.mac_id)):console.error("IMEI data not found for item:",c)});const J="one",H=p;p.length>0&&E(bt({type:J,imei:H})),de(l),E(St(l)),E(jt({w_customer_id:ce})),oe(!1)}else oe(!1),console.error("Unexpected data format:",_),ue.error("Unexpected data format:")}catch(l){console.error("Error fetching vehicle data:",l),ue.error(`Error fetching vehicle data: ${l}`)}},x=async l=>{const{label:p,imei:_,id:J,reg_id:H,checked:c}=l;U(D=>D.map(L=>L.id===J?{...L,checked:!c}:L));let G=[...ne],A=[...ne];if(!c)k.forEach(D=>{D.latestDocument.imei===_&&(G.push({label:p,value:D.latestDocument[p==="maininputvoltage"?"mainInputVoltage":p]}),A=G,W(G))});else{let D=ne.filter(L=>L.label!==p);A=D,W(D)}E(Be([{reg_id:H,imei:_,params:A}]))},v=l=>k==null?void 0:k.some(p=>String(p.latestDocument.imei)===String(l)&&p.latestDocument.speed>0&&(p.latestDocument.ignition===!0||p.latestDocument.ignition===1)),O=l=>k==null?void 0:k.some(p=>String(p.latestDocument.imei)===String(l)&&p.latestDocument.speed<=0&&(p.latestDocument.ignition===!0||p.latestDocument.ignition===1)),S=i.filter(l=>{var ae,pe,Se,je,we;if(!(Object.keys(w).length===0||l.vehicle_group===w.id))return!1;const _=(ae=l==null?void 0:l.label)==null?void 0:ae.toLowerCase().includes(s.toLowerCase()),J=m===""||((pe=l==null?void 0:l.workShop)==null?void 0:pe.region)===m,H=q===""||((je=(Se=l==null?void 0:l.workShop)==null?void 0:Se.state)==null?void 0:je.toLowerCase())===(((we=q==null?void 0:q.toString())==null?void 0:we.toLowerCase())||""),c=l.value,G=String(l.value).toLowerCase(),A=V.some(ke=>String(ke).toLowerCase()===G),T=!V.some(ke=>String(ke).toLowerCase()===G),D=A&&v(c),L=A&&O(c);return _&&J&&H&&(P==="online"?A:P==="offline"?T:P==="running"?D:P==="idling"?L:!0)}).sort((l,p)=>l.label.localeCompare(p.label));return n.jsxs("div",{className:"app",children:[n.jsx(wt,{}),n.jsxs("main",{className:"content",style:{width:"100%",background:"#dad6d626"},children:[n.jsx(It,{title:"Live Map",setShowVehicles:M,showVehicles:Y,showParameters:K,setShowParameters:te,setShowCard:fe,showCard:X,setShowVehiclesGroup:ge,showVehiclesGroup:se}),n.jsx(Dt,{setShowVehiclesGroup:ge,showVehiclesGroup:se,where:"livemap"}),n.jsxs(j,{style:{display:"flex",width:"100%",height:"95vh"},children:[n.jsx(j,{style:{width:Y||K?"80%":"100%"},children:n.jsx(jn,{showCard:X,loadingVehicle:ie,vehicleData:S})}),Y&&n.jsx(j,{style:{width:"20%",backgroundColor:F.grey[100]},children:n.jsx(mt,{vehicleData:S,title:"Live Map",setParameterData:U,loadingVehicle:ie,setShowVehicles:M,showVehicles:Y,showParameters:K,setShowParameters:te,setSearchedTerm:le,setOptions:ee,setState:be,setRegion:he,searchTerm:s,options:P,state:q,region:m})}),K&&n.jsx(j,{style:{width:"20%",backgroundColor:F.grey[100]},children:n.jsx(Ct,{parametersData:C,setParameterData:U,handleParameterChange:x})})]})]})]})}export{Fn as default};
